function SCOBot(a){"use strict";function b(){return y=scorm.initialize(),scorm.debug(x.prefix+": SCO Loaded from window.onload "+y,4),y&&(C.start(),$(C).triggerHandler({type:"load"})),y}function c(){if(scorm.debug("SCO is being asked, *cough* forced to exit ...",3),z){switch($(C).triggerHandler({type:"unload"}),scorm.get("exit_type")){case"finish":C.finish();break;case"suspend":C.suspend();break;case"timeout":C.timeout();break;default:scorm.debug(x.prefix+": unknown exit type",2)}scorm.debug(x.prefix+": SCO is done unloading.",4),z=!1}}function d(a){return scorm.debug(B[a],2),!0}function e(a){$(C).triggerHandler({type:"exception",error:a})}function f(){var a=scorm.getvalue("cmi.success_status");return!("passed"!==a&&"failed"!==a)}function g(){"passed"===scorm.getvalue("cmi.success_status")&&"finish"===scorm.get("exit_type")&&"false"===scorm.getvalue("cmi.score.scaled")&&"1"===scorm.getvalue("cmi.score.max")&&scorm.setvalue("cmi.score.scaled","1")}function h(a){return A.indexOf("|"+a+"|")>=0}function i(a){var b=/[^\f\r\n\t\v\0\s\S\w\W\d\D\b\\B\\cX\\xhh\\uhhh]/gi;return a.replace(b,"")}function j(a){var b;switch(scorm.get("time_type")){case"UTC":b=/^(\d{4})-0?(\d+)-0?(\d+)[T ]0?(\d+):0?(\d+):0?(\d+)(?:\.(\d+))(|Z)$/;break;case"GMT":b=/^(\d{4})-0?(\d+)-0?(\d+)[T ]0?(\d+):0?(\d+):0?(\d+)(?:\.(\d+))[\+\-]\d{2}:\d{2}$/;break;default:b=/^(\d{4})-0?(\d+)-0?(\d+)[T ]0?(\d+):0?(\d+):0?(\d+)$/}return b.test(a)}function k(a){return/^(?:P)([^T]*)(?:T)?(.*)?$/.test(a)}function l(){return scorm.debug(x.prefix+": You didn't call 'start()' yet, or you already terminated, ignoring.",2),"false"}function m(){return(new Date).getTime()}function n(a,b){var c=parseFloat(a);return parseFloat(c.toPrecision(b))}function o(a,b){var c=0;switch(a){case"order_matters":c=/^\{order_matters=.*?\}/;break;case"case_matters":c=/^\{case_matters=.*?\}/;break;case"lang":c=/^\{lang=.*?\}/;break;default:scorm.debug(x.prefix+": Sorry, this is not a valid Response type.",1)}return c.exec(b)}function p(){scorm.debug("Times Up!");var a=scorm.getvalue("cmi.time_limit_action").split(",");!("message"!==a[1])&&$(C).triggerHandler({type:"message",text:"Time Limit Exceeded"}),scorm.set("exit_type","timeout"),"exit"===a[0]?c():$(C).triggerHandler({type:"continue"})}function q(a,b){var c,d="",e="",f=0,g=[],h=[];switch(a){case"true-false":return"true"===(b=b.toString())||"false"===b?b:(scorm.debug(x.prefix+": Developer, you're not passing true or false for true-false.  I got "+b+" instead",1),"");case"choice":case"sequencing":if($.isArray(b)){c=0,b.length>36&&x.scorm_strict&&(scorm.debug(x.prefix+": Developer, you're passing a sum of values that exceeds SCORM's limit of 36 for this pattern.",2),b=b.slice(0,36));for(c in b)b.hasOwnProperty(c)&&b[c].length>10&&x.scorm_strict&&(scorm.debug(x.prefix+": Developer, you're passing values that exceed SCORM's limit of 10 characters.  Yours have "+b[c].length+". I will truncate this as not to lose data.",2),b[c]=b[c].substring(0,10));d=b.join("[,]"),b=d}else scorm.debug(x.prefix+": Developer, you're not passing a array type for sequencing/choice.  I got "+typeof b+" instead\n"+JSON.stringify(b),1),b="";return b;case"fill-in":return $.isPlainObject(b)?(void 0!==b.case_matters&&(d+="{case_matters="+b.case_matters+"}"),void 0!==b.order_matters&&(d+="{order_matters="+b.order_matters+"}"),void 0!==b.lang&&(d+="{lang="+b.lang+"}"),d+=b.words.join("[,]"),b=d):(scorm.debug(x.prefix+": Developer, you're not passing a object type for fill in.  I got "+typeof b+" instead",1),b=""),b;case"long-fill-in":return $.isPlainObject(b)?(void 0!==b.case_matters&&(d+="{case_matters="+b.case_matters+"}"),void 0!==b.lang&&(d+="{lang="+b.lang+"}"),d+=b.text,b=d):(scorm.debug(x.prefix+": Developer, you're not passing a object type for long fill in.  I got "+typeof b+" instead",1),b=""),b;case"matching":if($.isArray(b)){for(f=0;f<b.length;f+=1){if(!$.isArray(b[f]))return scorm.debug(x.prefix+": Developer, you're not passing a array type for matching/performance.  I got "+typeof b+" instead",1),"";g.push(b[f].join("[.]"))}d=g.join("[,]"),b=d}else scorm.debug(x.prefix+": Developer, you're not passing a array type for matching/performance.  I got "+typeof b+" instead",1),b="";return b;case"performance":if($.isArray(b))if($.isArray(b),0)scorm.debug(x.prefix+": Developer, you're not passing a array type for performance learner response.  I got "+typeof b+" instead",1),b="";else{for(f=0;f<b.length;f+=1){if(!$.isArray(b[f]))return scorm.debug(x.prefix+": Developer, you're not passing a array type for performance learner response.  I got "+typeof b[f]+" instead on "+f,1),scorm.debug(b,1),"";g.push(b[f].join("[.]"))}d=g.join("[,]")}else if(void 0!==b.order_matters&&(d+="{order_matters="+b.order_matters+"}"),$.isArray(b.answers)){for(f=0;f<b.answers.length;f+=1){if(!$.isArray(b.answers[f]))return scorm.debug(x.prefix+": Developer, you're not passing a array type for performance correct response.  I got "+typeof b.answers[f]+" instead on "+f,1),scorm.debug(b,1),"";$.isPlainObject(b.answers[f][1])&&(h=[n(b.answers[f][1].min,7),n(b.answers[f][1].max,7)],e=h.join("[:]"),b.answers[f][1]=e),g.push(b.answers[f].join("[.]"))}d+=g.join("[,]")}else scorm.debug(x.prefix+": Developer, you're not passing a array type for performance correct response.  I got "+typeof b.answers+" instead",1),scorm.debug(b,1);return b=d;case"numeric":return"number"==typeof b?d=b.toString():$.isPlainObject(b)?(g=[n(b.min,7),n(b.max,7)],d=g.join("[:]")):(d=parseFloat(b),"NaN"===d&&scorm.debug(x.prefix+": Developer, your not passing a number for a numeric interaction.  I got "+b+" instead",1),d+=""),d;case"likert":case"other":return b.toString();default:return scorm.debug(x.prefix+": Sorry, invalid interaction type detected for "+a+" on "+b,1),!1}}function r(a,b){var c=0,d=[],e={},f=!1;switch(a){case"true-false":return b;case"choice":case"sequencing":return d=b.split("[,]"),b=d;case"fill-in":return d=o("case_matters",b),null!==d&&-1!==d[0].search(/^\{case_matters=(true|false)\}$/)&&(e.case_matters=d[0].substring("{case_matters=".length,d[0].length-1),b=b.substring(d[0].length,b.length),scorm.debug("=== case matters"+b,4)),d=o("order_matters",b),null!==d&&-1!==d[0].search(/^\{order_matters=(true|false)\}$/)&&(e.order_matters=d[0].substring("{order_matters=".length,d[0].length-1),b=b.substring(d[0].length,b.length),scorm.debug("=== order matters"+b,4)),d=o("lang",b),null!==d&&-1!==d[0].search(/^\{lang=.*?\}$/)&&(e.lang=d[0].substring("{lang=".length,d[0].length-1),b=b.substring(d[0].length,b.length)),e.words=b.split("[,]"),e;case"long-fill-in":return d=o("case_matters",b),null!==d&&-1!==d[0].search(/^\{case_matters=(true|false)\}$/)&&(e.case_matters=d[0].substring("{case_matters=".length,d[0].length-1),b=b.substring(d[0].length,b.length),scorm.debug("=== case matters"+b,4)),d=o("lang",b),null!==d&&-1!==d[0].search(/^\{lang=.*?\}$/)&&(e.lang=d[0].substring("{lang=".length,d[0].length-1),b=b.substring(d[0].length,b.length)),e.text=b,e;case"matching":for(d=b.split("[,]"),c=0;c<d.length;c+=1)d[c]=d[c].split("[.]");return d;case"performance":for(d=o("order_matters",b),null!==d&&-1!==d[0].search(/^\{order_matters=(true|false)\}$/)&&(f=!0,e.order_matters=d[0].substring("{order_matters=".length,d[0].length-1),b=b.substring(d[0].length,b.length),scorm.debug("=== order matters"+b,4)),d=b.split("[,]"),c=0;c<d.length;c+=1)d[c]=d[c].split("[.]");return f?(e.answers=d,e):d;case"numeric":case"likert":case"other":return b;default:return scorm.debug(x.prefix+": Sorry, invalid interaction type detected for "+a+" on "+b,1),!1}}function s(){return"true"===scorm.setvalue("cmi.suspend_data",i(JSON.stringify(x.suspend_data)))?(scorm.debug(x.prefix+": Suspend Data saved",4),scorm.debug(x.suspend_data,4),"true"):(scorm.debug(x.prefix+": Sorry, there was an issue saving your suspend data, please review the SCORM Logs",1),"false")}function t(){if(z){var a,b,c=0,d=0,e=1,f=0,g=0;if(0===x.totalInteractions||0===x.totalObjectives)return scorm.debug(x.prefix+": Sorry, I cannot calculate Progress as the totalInteractions and or Objectives are zero",2),"false";if(b=parseInt(scorm.getvalue("cmi.objectives._count"),10),scorm.debug(x.prefix+" Count is "+b),b>0)for(b-=1,g=b;g>=0;g-=1)d=parseFloat(scorm.getvalue("cmi.objectives."+g+".score.raw")),scorm.debug("Score Raw: "+d),isNaN(d)?scorm.debug(x.prefix+" We got a NaN converting objectives."+g+".score.raw",2):c+=parseFloat(d),"completed"===scorm.getvalue("cmi.objectives."+g+".completion_status")&&(f+=1);return scorm.debug(x.prefix+" Setting score "+scorm.setvalue("cmi.score.raw",c.toString())),x.scoreMax-x.scoreMin==0?(scorm.debug(x.prefix+": Division by Zero for scoreMax - scoreMin "+x.scoreMax,2),scorm.setvalue("cmi.score.scaled",e)):(e=((c-x.scoreMin)/(x.scoreMax-x.scoreMin)).toString(),scorm.debug(x.prefix+": Score Scaled = "+e,3),scorm.setvalue("cmi.score.scaled",n(e,7))),a=(f/x.totalObjectives).toString(),scorm.setvalue("cmi.progress_measure",n(a,7)),x.completion_status=parseFloat(a)>=parseFloat(x.completion_threshold)?"completed":"incomplete",scorm.setvalue("cmi.completion_status",x.completion_status),x.success_status=parseFloat(e)>=parseFloat(x.scaled_passing_score)?"passed":"failed",scorm.setvalue("cmi.success_status",x.success_status),{score_scaled:scorm.getvalue("cmi.score.scaled"),success_status:scorm.getvalue("cmi.success_status"),progress_measure:scorm.getvalue("cmi.progress_measure"),completion_status:scorm.getvalue("cmi.completion_status")}}return l()}function u(){if(z){var a,b="cmi.comments_from_lms.",c=scorm.getvalue(b+"_count"),d=[],e={};if(!h(c))return"false";for(c-=1,a=0;a<=c;a+=1)b+=a+".",e.comment=scorm.getvalue(b+"comment"),e.location=scorm.getvalue(b+"location"),e.timestamp=scorm.getvalue(b+"timestamp"),d.push(e),e={};return d}return l()}function v(){g(),f()||scorm.setvalue("cmi.success_status","unknown"),"passed"===scorm.get("success_status")&&scorm.setvalue("cmi.success_status","passed"),"completed"!==scorm.getvalue("cmi.completion_status")&&scorm.setvalue("cmi.completion_status","incomplete"),"completed"===scorm.get("completion_status")&&scorm.setvalue("cmi.completion_status","completed")}var w={version:"2.0",createDate:"04/07/2011 09:33AM",modifiedDate:"03/05/2013 5:10PM",prefix:"SCOBot",launch_data:{},interaction_mode:"state",launch_data_type:"querystring",initiate_timer:!0,scorm_strict:!0,scorm_edition:"3rd",success_status:"unknown",location:"",completion_status:"",suspend_data:{pages:[]},mode:"",completion_threshold:0,scaled_passing_score:.7,max_time_allowed:"",totalInteractions:0,totalObjectives:0,startTime:0},x=$.extend(w,a),y=!1,z=!1,A="|null|undefined|false|NaN|| |",B=scorm.get("error"),C=this;this.start=function(){var a="",b="",c="";return scorm.debug(x.prefix+": I am starting...",3),z?(scorm.debug(x.prefix+": You already called start!  I don't see much point in doing this more than once.",2),!1):(z=!0,x.startTime=m(),c=scorm.getvalue("cmi.launch_data"),"json"===x.launch_data_type?x.launch_data=JSON.parse(c):c.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(a,b,c,d){x.launch_data[b]=d}),scorm.debug(x.prefix+": Launch Data:",4),scorm.debug(x.launch_data,4),x.mode=scorm.getvalue("cmi.mode"),x.entry=scorm.getvalue("cmi.entry"),""===x.entry||"resume"===x.entry?(x.location=scorm.getvalue("cmi.location"),x.suspend_data=scorm.getvalue("cmi.suspend_data"),x.suspend_data.length>0&&!h(x.suspend_data)?(scorm.debug(x.prefix+": Returning suspend data object from a prior session",4),x.suspend_data=JSON.parse(x.suspend_data),scorm.debug(x.suspend_data,4),""===x.entry&&(x.entry="resume")):scorm.debug(x.prefix+": Creating new suspend data object",4)):(scorm.debug(x.prefix+": First time running this SCO based on LMS entry value.",4),scorm.debug(x.prefix+": Creating new suspend data object",4)),a=scorm.getvalue("cmi.completion_threshold"),h(a)||"-1"===a||(x.completion_threshold=a),b=scorm.getvalue("cmi.scaled_passing_score"),h(b)||"-1"===b||(x.scaled_passing_score=b),x.completion_status=scorm.getvalue("cmi.completion_status"),x.success_status=scorm.getvalue("cmi.success_status"),x.comments_from_lms=u(),"false"!==x.comments_from_lms&&$(C).triggerHandler({type:"comments_lms",data:x.comments_from_lms}),x.max_time_allowed=scorm.getvalue("cmi.max_time_allowed"),k(x.max_time_allowed)?x.initiate_timer&&(scorm.debug(x.prefix+" This SCO has a set time, I am starting the timer for "+x.max_time_allowed+"..."),C.startTimer()):scorm.debug(x.prefix+"This is not ISO8601 time duration. "+x.max_time_allowed),!0)},this.setTotals=function(a){return z?(h(a.totalInteractions)||(x.totalInteractions=a.totalInteractions),h(a.totalObjectives)||(x.totalObjectives=a.totalObjectives),h(a.scoreMin)||(x.scoreMin=n(a.scoreMin,7),scorm.setvalue("cmi.score.min",a.scoreMin.toString())),h(a.scoreMax)||(x.scoreMax=n(a.scoreMax,7),scorm.setvalue("cmi.score.max",a.scoreMax.toString())),"true"):l()},this.startTimer=function(){var a=10*scorm.ISODurationToCentisec(x.max_time_allowed);setTimeout(p,a)},this.debug=scorm.debug,this.getvalue=scorm.getvalue,this.setvalue=scorm.setvalue,this.getMode=function(){return z?x.mode:l()},this.getEntry=function(){return z?x.entry:l()},this.setBookmark=function(a){return z?(x.location=a.toString(),scorm.setvalue("cmi.location",x.location)):l()},this.getBookmark=function(){return z?x.location:l()},this.progress=t,this.setSuspendDataByPageID=function(a,b,c){if(""===x.suspend_data&&(x.suspend_data={pages:[]}),z){var d;for(d=0;d<x.suspend_data.pages.length;d+=1)if(x.suspend_data.pages[d].id===a)return x.suspend_data.pages[d].data=c,scorm.debug(x.prefix+": Suspend Data Set",4),scorm.debug(x.suspend_data,4),s();return x.suspend_data.pages.push({id:a,title:b,data:c}),scorm.debug(x.prefix+": Suspend Data set:",4),scorm.debug(x.suspend_data,4),s()}return l()},this.getSuspendDataByPageID=function(a){if(z){var b;for(b=0;b<x.suspend_data.pages.length;b+=1)if(x.suspend_data.pages[b].id===a)return x.suspend_data.pages[b].data;return"false"}return l()},this.getSecondsFromStart=function(){return x.startTime-m()},this.setInteraction=function(a){if(z){var b,c,d,e,f,g,i,j,k,m,n="cmi.interactions.",o=a.timestamp||scorm.isoStringToDate(scorm.getvalue(n+scorm.getInteractionByID(a.id)+".timestamp"));if(!$.isPlainObject(a))return scorm.debug(x.prefix+": Developer, your not passing a {object} argument!!  Got "+typeof a+" instead.",1),"false";if(h(a.id)){scorm.debug(x.prefix+": Developer, your passing a interaction without a ID\nSee question:\n"+a.description,1);for(m in a)a.hasOwnProperty(m)&&scorm.debug("key: "+m+"\n value: "+a[m]);return"false"}if("date"===$.type(a.timestamp)&&(i=scorm.isoDateToString(a.timestamp)),a.timestamp=i,"date"===$.type(a.latency)?(j=(a.latency.getTime()-o.getTime())/1e3,a.latency=scorm.centisecsToISODuration(100*j,!0)):a.learner_response.length>0&&!h(a.learner_response)&&(a.latency=new Date,j=(a.latency.getTime()-o.getTime())/1e3,a.latency=scorm.centisecsToISODuration(100*j,!0)),g="_count","journaled"===x.interaction_mode?b="-1"===scorm.getvalue(n+g)?"0":scorm.getvalue(n+g):(b=scorm.getInteractionByID(a.id),h(b)&&(b="-1"===scorm.getvalue(n+g)?"0":scorm.getvalue(n+g))),n+=b+".",h(a.id)||(k=scorm.setvalue(n+"id",a.id)),h(a.type)||(k=scorm.setvalue(n+"type",a.type)),g="objectives._count",void 0!==a.objectives)for(d=0;d<a.objectives.length;d+=1)c=scorm.getInteractionObjectiveByID(b,a.objectives[d].id),"false"===c&&(c="-1"===scorm.getvalue(n+g)?"0":scorm.getvalue(n+g)),k=scorm.setvalue(n+"objectives."+c+".id",a.objectives[d].id);if(void 0!==a.timestamp&&(k=scorm.setvalue(n+"timestamp",a.timestamp)),g="correct_responses._count",$.isArray(a.correct_responses))for(e=0;e<a.correct_responses.length;e+=1)f=scorm.getInteractionCorrectResponsesByPattern(b,a.correct_responses[e].pattern),scorm.debug(x.prefix+": Trying to locate pattern "+a.correct_responses[e].pattern+" resulted in "+f,4),"false"===f&&(f="-1"===scorm.getvalue(n+g)?0:scorm.getvalue(n+g),scorm.debug(x.prefix+": p is now "+f,4)),"match"===f?scorm.debug(x.prefix+": Developer, I've already added this correct response type '"+a.correct_responses[e].pattern+"'",2):k=scorm.setvalue(n+"correct_responses."+f+".pattern",q(a.type,a.correct_responses[e].pattern));else scorm.debug(x.prefix+": Something went wrong with Correct Responses, it wasn't an Array.",1);return h(a.weighting)||(k=scorm.setvalue(n+"weighting",a.weighting)),h(a.learner_response)||(k=scorm.setvalue(n+"learner_response",q(a.type,a.learner_response))),h(a.result)||(k=scorm.setvalue(n+"result",a.result)),h(a.latency)||(k=scorm.setvalue(n+"latency",a.latency)),h(a.description)||(k=scorm.setvalue(n+"description",a.description)),k}return l()},this.getInteraction=function(a){if(z){var b,c,d,e,f,g,h,i="cmi.interactions.",k=0,m={};if("false"===(b=scorm.getInteractionByID(a)))return b;if(i+=b+".",m.id=a,m.type=scorm.getvalue(i+"type"),c=scorm.getvalue(i+"objectives._count"),e=scorm.getvalue(i+"timestamp"),f=scorm.getvalue(i+"latency"),g=j(e)?scorm.isoStringToDate(e):e,h=j(f)?scorm.isoStringToDate(f):f,m.objectives=[],"false"!==c)for(k=0;k<c;k+=1)m.objectives.push({id:scorm.getvalue(i+"objectives."+k+".id")});if(m.timestamp=g,d=scorm.getvalue(i+"correct_responses._count"),m.correct_responses=[],"false"!==d)for(k=0;k<d;k+=1)m.correct_responses.push({pattern:r(m.type,scorm.getvalue(i+"correct_responses."+k+".pattern"))});return m.weighting=scorm.getvalue(i+"weighting"),m.learner_response=r(m.type,scorm.getvalue(i+"learner_response")),m.result=scorm.getvalue(i+"result"),m.latency=h,m.description=scorm.getvalue(i+"description"),m}return l()},this.setObjective=function(a){if(z){var b,c="cmi.objectives.",d=scorm.getObjectiveByID(a.id),e="false",f=!1,g=": Passed no or bad ",i=" ignored.",j=scorm.setvalue;if(scorm.debug(x.prefix+": Setting Objective at "+d+" (This may be false)"),h(d)){if("false"===(d=scorm.getvalue(c+"_count")))return scorm.debug(x.prefix+": LMS is return false, can not proceed, check error codes"),d;scorm.debug(x.prefix+": Objective "+a.id+" was not found.  Adding new at "+d+" "+a.description),f=!0}if(c+=d+".",f){if(h(a.id)){scorm.debug(x.prefix+": You did not pass an objective ID!!  What I did get below:",1);for(b in a)a.hasOwnProperty(b)&&scorm.debug("key: "+b+"\n value: "+a[b]);return"false"}j(c+"id",a.id.toString())}return $.isPlainObject(a.score)?(e=h(a.score.scaled)?scorm.debug(x.prefix+g+c+"score.scaled: "+a.score.scaled+i,3):j(c+"score.scaled",n(a.score.scaled,7).toString()),e=h(a.score.raw)?scorm.debug(x.prefix+g+c+"score.raw: "+a.score.raw+i,3):j(c+"score.raw",n(a.score.raw,7).toString()),e=h(a.score.min)?scorm.debug(x.prefix+g+c+"score.min: "+a.score.min+i,3):j(c+"score.min",n(a.score.min,7).toString()),e=h(a.score.max)?scorm.debug(x.prefix+g+c+"score.max: "+a.score.max+i,3):j(c+"score.max",n(a.score.max,7).toString())):scorm.debug(x.prefix+": Did not receive a score object.  May or may not be an issue.",4),e=h(a.success_status)?scorm.debug(x.prefix+g+c+"success_status: "+a.success_status+i,3):j(c+"success_status",a.success_status),e=h(a.completion_status)?scorm.debug(x.prefix+g+c+"completion_status: "+a.completion_status+i,3):j(c+"completion_status",a.completion_status),e=h(a.progress_measure)?scorm.debug(x.prefix+g+c+"progress_measure: "+a.progress_measure+i,3):j(c+"progress_measure",a.progress_measure),e=h(a.description)?scorm.debug(x.prefix+g+c+"description: "+a.description+i,3):j(c+"description",a.description),scorm.debug(x.prefix+": Progress\n"+JSON.stringify(t(),null," "),4),e.toString()}return l()},this.getObjective=function(a){if(z){var b=scorm.getObjectiveByID(a),c="cmi.objectives.";return"false"===b?b:(c+=b+".",{id:scorm.getvalue(c+"id"),score:{scaled:scorm.getvalue(c+"score.scaled"),raw:scorm.getvalue(c+"score.raw"),min:scorm.getvalue(c+"score.min"),max:scorm.getvalue(c+"score.max")},success_status:scorm.getvalue(c+"success_status"),completion_status:scorm.getvalue(c+"completion_status"),progress_measure:scorm.getvalue(c+"progress_measure"),description:scorm.getvalue(c+"description")})}return l()},this.setCommentFromLearner=function(a,b,c){if(z){var d="cmi.comments_from_learner.",e=scorm.getvalue(d+"_count");return"false"===e?(scorm.debug(x.prefix+": Sorry, LMS returned a comments count of 'false'.  Review error logs."),e):((0===a.length||a.length>4e3)&&scorm.debug(x.prefix+": Sorry, message from learner was empty or exceeded the limit. Length:"+a.length,2),d+=e+".",scorm.setvalue(d+"comment",a),scorm.setvalue(d+"location",b),scorm.setvalue(d+"timestamp",scorm.isoDateToString(c)))}return l()},this.gradeIt=function(){var a=1,b=scorm.getvalue("cmi.score.raw"),c=scorm.getvalue("cmi.score.min"),d=scorm.getvalue("cmi.score.max"),e=scorm.getvalue("cmi.progress_measure");return d-c==0?(scorm.debug(x.prefix+": Division by Zero for scoreMax - scoreMin "+d,2),scorm.setvalue("cmi.score.scaled",a)):(a=((b-c)/(d-c)).toString(),scorm.debug(x.prefix+": Score Scaled = "+a,3),scorm.setvalue("cmi.score.scaled",n(a,7))),x.completion_status=parseFloat(e)>=parseFloat(x.completion_threshold)?"completed":"incomplete",scorm.setvalue("cmi.completion_status",x.completion_status),x.success_status=parseFloat(a)>=parseFloat(x.scaled_passing_score)?"passed":"failed",scorm.setvalue("cmi.success_status",x.success_status),"true"},this.happyEnding=function(){return z?(scorm.setvalue("cmi.score.scaled","1"),scorm.setvalue("cmi.score.min","0"),scorm.setvalue("cmi.score.max","1"),scorm.setvalue("cmi.score.raw","1"),scorm.setvalue("cmi.success_status","passed"),scorm.setvalue("cmi.progress_measure","1"),scorm.setvalue("cmi.completion_status","completed")):l()},this.commit=function(){return z?scorm.commit(""):l()},this.suspend=function(){return z?(scorm.debug(x.prefix+": I am suspending...",3),scorm.setvalue("cmi.exit","suspend"),v(),z=!1,scorm.terminate()):l()},this.finish=function(){return z?(scorm.debug(x.prefix+": I am finishing...",3),scorm.setvalue("cmi.exit","normal"),v(),z=!1,scorm.terminate()):l()},this.timeout=function(){return z?(scorm.debug(x.prefix+": I am timing out...",3),scorm.setvalue("cmi.exit","time-out"),v(),z=!1,scorm.terminate()):l()},this.isISO8601=j,this.set=function(a,b){switch(a){case"version":case"createDate":case"modifiedDate":case"prefix":d(405);break;default:x[a]=b}return!0},this.get=function(a){return void 0===x[a]?(d(404),!1):x[a]},this.init=b,this.exit=function(){var a=t();scorm.debug("Progress\n"+JSON.stringify(a,null," "),4),c()},$(window).bind("load",b),$(scorm).on("exception",function(a){e(a.error)})}function scobot_local(){var a=PearsonGL.globals.metadata&&PearsonGL.globals.metadata.scoId?PearsonGL.globals.metadata.scoId:"SCO_Id",b=window.localStorage.getItem(a);try{if(null!==b)return b=JSON.parse(b),void 0!==b.exit&&""!==b.exit||(b.exit="suspend",b.entry="resume"),PearsonGL.globals.useLocalStorage?b:null}catch(a){return null}}function Local_API_1484_11(a){"use strict";function b(a,b){return p.diganostic="The "+a+" of "+b+" must be a proper vocabulary element.",p.errorCode=406,"false"}function c(a){var b="";if(-1!=window.location.href.indexOf("?")){for(var c,d=[],e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),f=0;f<e.length;f++)c=e[f].split("="),d[c[0]]=c[1];b=d[a]?d[a]:(PearsonGL.globals.useLocalStorage,"normal")}else b=(PearsonGL.globals.useLocalStorage,"normal");return PearsonGL.productConfig=PearsonGL.productConfig||{},PearsonGL.productConfig.cmimode&&PearsonGL.productConfig.cmimode.length>0&&(b=PearsonGL.productConfig.cmimode),b}function d(a){return p.errorCode=402,p.diagnostic="The value for key "+a+" has not been created yet.","false"}function e(a,b,c){return p.errorCode="351",p.diagnostic="The "+a+" element must be unique.  The value '"+b+"' has already been set in #"+c,"false"}function f(a,b,c){var d=a.split(/\./);d.length<2?c[d[0]]=b:(c[d[0]]||(c[d[0]]={}),c=c[d.shift()],f(d.join("."),b,c))}function g(a,b){scorm.debug(p.prefix+": GetData Checking "+a,4);var c,e=a.split(/\./);if(!(e.length<2))return c=e.shift(),b[c]?String(g(e.join("."),b[c])):(d(a),"false");try{return scorm.debug(p.prefix+":  getData returning -   key:"+e[0]+" value:"+b[e[0]],4),b[e[0]]}catch(b){return d(a),"false"}}function h(a){var b="false";switch(a){case"cmi.exit":case"cmi.session_time":p.errorCode=405,p.diagnostic="Sorry, this has been specified as a read-only value for "+a;break;default:b=g(a.substr(4,a.length),q),"undefined"===b&&(p.errorCode=401,p.diagnostic="Sorry, there was a undefined response from "+a,b="false"),scorm.debug(p.prefix+": GetValue "+a+" = "+b,4)}return b}function i(a){var b=a.split("."),c=b[b.length-1];return"adl"===b[0]&&"id"===b[4]||("comments_from_lms"===b[1]||"comments_from_learner"!==b[1]&&r.indexOf("|"+c+"|")>=0)}function j(a){var b=a.split("."),c=b[b.length-1];return s.indexOf("|"+c+"|")>=0}function k(a){var b=2;return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}function l(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&(c+=1);return c}function m(){"suspend"===q.exit&&(q.entry="resume")}function n(){return k(q.suspend_data.length/64e3*100)+"%"}var o={version:"2.2",moddate:"03/05/2013 5:10PM",createdate:"07/17/2010 08:15AM",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,CMI:{_version:"Local 1.0",comments_from_learner:{_children:"comment,location,timestamp",_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",credit:"no-credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"?name1=value1&name2=value2&name3=value3",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",audio_captioning:"0"},location:"",max_time_allowed:"",mode:c("cmimode"),objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},p=$.extend(o,a),q={},r="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|",s="|exit|session_time|",t={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},u=this;this.isRunning=function(){return 1===p.initialized&&0===p.terminated},this.Initialize=function(){return scorm.debug(p.prefix+":  Initializing...",3),null!==p.cmi?(q=p.cmi,m()):q=p.CMI,p.initialized=1,p.terminated=0,"true"},this.GetValue=function(a){p.errorCode=0;var b="false",c=a.toString(),d=[];if(this.isRunning()){if(j(c))return scorm.debug(p.prefix+": This "+c+" is write only",4),p.errorCode=405,"false";switch(d=c.toLowerCase().split("."),d[0]){case"cmi":b=h(c)}return b}return p.errorCode=123,b},this.SetValue=function(a,c){scorm.debug(p.prefix+": SetValue: "+a+" = "+c,4),p.errorCode=0;var d=[],g=a.toString(),h=c.toString(),j=0,k=0,m=[];if(this.isRunning()){if(i(g))return scorm.debug(p.prefix+": This "+g+" is read only",4),p.errorCode=404,"false";switch(d=g.split("."),d[0]){case"cmi":switch(a){case"cmi.location":h.length>1e3&&scorm.debug(p.prefix+": Some LMS's might truncate your bookmark as you've passed "+h.length+" characters of bookmarking data",2);break;case"cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+h+"|"))return b(a,h);break;case"cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+h+"|"))return b(a,h);break;default:switch(d[1]){case"comments_from_lms":return p.errorCode="404",p.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case"comments_from_learner":return-1===q.comments_from_learner._children.indexOf(d[3])?b(a,h):(f(g.substr(4,g.length),h,q),q.comments_from_learner._count=(l(q.comments_from_learner)-2).toString(),"true");case"interactions":if(-1===q.interactions._children.indexOf(d[3]))return b(a,h);if(q.interactions._count=(l(q.interactions)-2).toString(),isNaN(parseInt(d[2],10)))return"false";if(!$.isPlainObject(q.interactions[d[2]]))return"id"===d[3]?(q.interactions[d[2]]={},f(g.substr(4,g.length),h,q),q.interactions._count=(l(q.interactions)-2).toString(),$.isPlainObject(q.interactions[d[2]].objectives)||(scorm.debug(p.prefix+": Constructing objectives object for new interaction",4),q.interactions[d[2]].objectives={},q.interactions[d[2]].objectives._count="-1"),$.isPlainObject(q.interactions[d[2]].correct_responses)||(scorm.debug(p.prefix+": Constructing correct responses object for new interaction",4),q.interactions[d[2]].correct_responses={},q.interactions[d[2]].correct_responses._count="-1"),"true"):(scorm.debug("Can't add interaction without ID first!",3),"false");if("objectives"===d[3]){if("id"!==d[5])return b(a,h);for(k=parseInt(q.interactions[d[2]].objectives._count,10),j=0;j<k;j+=1)if(q.interactions[d[2]].objectives[j].id===h)return e(a,h,j);return f(g.substr(4,g.length),h,q),q.interactions[d[2]].objectives._count=(l(q.interactions[d[2]].objectives)-1).toString(),"true"}return"correct_responses"===d[3]&&(f(g.substr(4,g.length),h,q),q.interactions[d[2]].correct_responses._count=(l(q.interactions[d[2]].correct_responses)-1).toString()),f(g.substr(4,g.length),h,q),q.interactions._count=(l(q.interactions)-2).toString(),"true";case"objectives":if("id"===d[3])for(k=parseInt(q.objectives._count,10),j=0;j<k;j+=1)if(q.objectives[j].id===h)return p.errorCode="351",p.diagnostic="The objectives.id element must be unique.  The value '"+h+"' has already been set in objective #"+j,"false";return"id"!==d[3]&&(m=parseInt(d[2],10),void 0===q.objectives[m])?(p.errorCode="408",p.diagnostic="The objectives.id element must be set before other elements can be set","false"):isNaN(parseInt(d[2],10))?"false":(f(g.substr(4,g.length),h,q),q.objectives._count=(l(q.objectives)-2).toString(),"true")}}f(g.substr(4,g.length),h,q)}return"true"}return p.terminated?p.errorCode=133:p.errorCode=132,"false"},this.Commit=function(){return scorm.debug(p.prefix+": Commit CMI Object:",4),scorm.debug(q),scorm.debug(p.prefix+": Suspend Data Usage "+n()),$(u).triggerHandler({type:"StoreData",runtimedata:q}),"true"},this.Terminate=function(){return u.Commit(),p.terminated=1,p.initialized=0,"true"},this.GetErrorString=function(a){if(""!==a){var b=parseInt(a,10);if(void 0!==t[b])return t[b]}return""},this.GetLastError=function(){return p.errorCode},this.GetDiagnostic=function(){return p.diagnostic}}function SCORM_API(a){"use strict";function b(a,b){$(v).triggerHandler({type:"debug",msg:a,lvl:b})}function c(a,c){if(s.debug){switch(window.console||(window.console={},window.console.info=b,window.console.log=b,window.console.warn=b,window.console.error=b,window.console.trace=b),c){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),!1}return!0}return c<3&&s.throw_alerts&&alert(a),!1}function d(a){for(var b=0,c=500;!a.API&&!a.API_1484_11&&a.parent&&a.parent!==a&&b<=c;)b+=1,a=a.parent;if(a.API_1484_11)u.version="2004",u.path=a.API_1484_11;else{if(!a.API)return!1;u.version="1.2",u.path=a.API}return!0}function e(a,b){var c,d,e="P",f=Math.max(a,0),g=0,h=0,i=0;return f=Math.round(f),!0===b?i=Math.floor(f/864e4):(g=Math.floor(f/315576e4),f-=315576e4*g,h=Math.floor(f/26298e4),f-=26298e4*h,i=Math.floor(f/864e4)),f-=864e4*i,c=Math.floor(f/36e4),f-=36e4*c,d=Math.floor(f/6e3),f-=6e3*d,g>0&&(e+=g+"Y"),h>0&&(e+=h+"M"),i>0&&(e+=i+"D"),(c>0||d>0||f>0)&&(e+="T",c>0&&(e+=c+"H"),d>0&&(e+=d+"M"),f>0&&(e+=f/100+"S")),"P"===e&&(e="PT0H0M0S"),e}function f(a){var b=[0,0,0,0,0,0],c=!(0===a.indexOf("P")),d=!1,e=["Y","M","D","H","M","S"],f=0,g=0;if(!c){for(a=a.substr(1),g=0;g<e.length;g+=1)if(0===a.indexOf("T")&&(a=a.substr(1),g=Math.max(g,3),d=!0),(f=a.indexOf(e[g]))>-1){if(1===g&&a.indexOf("T")>-1&&a.indexOf("T")<f)continue;if("S"===e[g]?b[g]=parseFloat(a.substr(0,f)):b[g]=parseInt(a.substr(0,f),10),isNaN(b[g])){c=!0;break}if(g>2&&!d){c=!0;break}a=a.substr(f+1)}c=!(c||0===a.length)}return c?0:315576e4*b[0]+26298e4*b[1]+864e4*b[2]+36e4*b[3]+6e3*b[4]+Math.round(100*b[5])}function g(a){return a<10?"0"+a:a}function h(a){return a.getUTCFullYear()+"-"+g(a.getUTCMonth()+1)+"-"+g(a.getUTCDate())+"T"+g(a.getUTCHours())+":"+g(a.getUTCMinutes())+":"+g(a.getUTCSeconds())+"."+Math.round(a.getUTCMilliseconds()/1e3%1e3)+"Z"}function i(a){var b=a.getTimezoneOffset()>0?"-":"+";return a.getFullYear()+"-"+g(a.getMonth()+1)+"-"+g(a.getDate())+"T"+g(a.getHours())+":"+g(a.getMinutes())+":"+g(a.getSeconds())+"."+Math.round(a.getMilliseconds()/1e3%1e3)+b+g(a.getTimezoneOffset()/60)+":00"}function j(a){var b,c,d,e=["January","February","March","April","May","June","July","August","September","October","November","December"],f=0,g=0;switch(s.time_type){case"UTC":return b=a.replace(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))(|Z)/,function(a,b,c,d,f,g,h){return e[c-1]+" "+d+", "+b+" "+f+":"+g+":"+h}),d=new Date.UTC(b);case"GMT":return b=a.replace(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))([\+|\-]\d+:\d+)/,function(a,b,c,d,h,i,j,k,l){return f=60*parseInt(l.substring(1,l.length),10)*60*60,g=k,e[c-1]+" "+d+", "+b+" "+h+":"+i+":"+j}),d=new Date(b),c=60*d.getTimezoneOffset()*60,c!==f&&(d=new Date(d.getTime()+f+c),d.setMilliseconds(g)),d;default:return b=a.replace(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/,function(a,b,c,d,f,g,h){return e[c-1]+" "+d+", "+b+" "+f+":"+g+":"+h}),d=new Date(b)}}function k(a){var b,c,d,e,f;return a=Math.round(a),c=Math.floor(a/36e4),d=a-36e4*c,e=Math.floor(d/6e3),d-=6e3*e,f=Math.floor(d/100),d-=100*f,b="0000"+c+":",b=b.substr(b.length-5,5),e<10&&(b+="0"),b+=e+":",f<10&&(b+="0"),b+=f,d>0&&(b+=".",d<10&&(b+="0"),b+=d),b}function l(a){if(void 0===a)return c(s.prefix+" : makeBoolean was given empty string, converting to false",2),!1;if(!0===a||!1===a)return Boolean(a);switch(a.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(a)}}function m(a){return c(t[a],2),!0}function n(a){$(v).triggerHandler({type:"exception",error:a})}function o(){var a=u.path,b=0;if(a)switch(u.version){case"1.2":b=parseInt(a.LMSGetLastError(),10);break;case"2004":b=parseInt(a.GetLastError(),10)}return b}function p(a){var b=u.path,c="No LMS Connectivity";if(b)switch(u.version){case"1.2":c=b.LMSGetErrorString(a.toString());break;case"2004":c=b.GetErrorString(a.toString())}return String(c)}function q(a){var b=u.path,c="No LMS Connectivity";if(b)switch(u.version){case"1.2":c=b.LMSGetDiagnostic(a.toString());break;case"2004":c=b.GetDiagnostic(a.toString())}return String(c)}var r={version:"1.5",createDate:"04/05/2011 08:56AM",modifiedDate:"03/05/2013 5:10PM",debug:!1,isActive:!1,throw_alerts:!1,prefix:"SCORM_API",exit_type:"suspend",success_status:"unknown",use_standalone:!0,standalone:!1,completion_status:"unknown",time_type:"GMT",cmi:null},s=$.extend(r,a),t={0:"No Error",404:"Not Found",405:"Prevented on a read only resource"},u={connection:!1,version:"none",mode:"",path:!1,data:{completion_status:s.completion_status,success_status:s.success_status,exit_type:s.exit_type},isActive:s.isActive},v=this;s.error=t,s.startDate={},this.getvalue=function(a){var b=null,d=u.path,e=0,f=null,g=!1;if($(v).triggerHandler({type:"getvalue",n:a}),u.isActive){switch(u.version){case"1.2":switch(a){case"cmi.location":f="cmi.core.lesson_location";break;case"cmi.completion_threshold":g=!0;break;case"cmi.mode":f="cmi.core.lesson_mode";break;case"cmi.exit":f="cmi.core.exit";break;case"cmi.score.raw":f="cmi.core.score.raw";break;case"cmi.score.min":f="cmi.core.score.min";break;case"cmi.score.max":f="cmi.core.score.max";break;case"cmi.success_status":case"cmi.completion_status":f="cmi.core.lesson_status";break;case"cmi.session_time":f="cmi.core.session_time";break;case"cmi.suspend_data":default:f=a}if(g)return"false";b=d.LMSGetValue(f);break;case"2004":b=d.GetValue(a)}return 0===(e=o())||403===e?("undefined"!==b&&null!==b&&"null"!==b||(b=""),c(s.prefix+" : getvalue("+a+")='"+b+"' with errorCode="+e,4),String(b)):(c(s.prefix+" : getvalue("+a+")='"+b+"' with errorCode="+e,4),c(s.prefix+": Error\nError Code: "+e+"\nError Message: "+p(e)+"\nDiagnostic: "+q(e),1),"false")}return c(s.prefix+": "+a+" Get Aborted, connection not initialized! "+u.isActive,2),"false"},this.setvalue=function(a,b){var d="false",e=u.path,f=0,g=null,h=!1;if($(v).triggerHandler({type:"setvalue",n:a,v:b}),u.isActive){switch(u.version){case"1.2":if(u.mode=""===u.mode?e.LMSGetValue("cmi.core.lesson_mode"):u.mode,"normal"!==u.mode)return c(s.prefix+": Warning, you are not in normal mode.  Ignoring 'set' requests.",2),"false";switch(a){case"cmi.location":b.length>255&&c(s.prefix+": Warning, your bookmark is over the limit!!",2),g="cmi.core.lesson_location";break;case"cmi.completion_threshold":h=!0;break;case"cmi.mode":g="cmi.core.lesson_mode";break;case"cmi.exit":g="cmi.core.exit",u.exit_type=b;break;case"cmi.score.raw":g="cmi.core.score.raw";break;case"cmi.score.min":g="cmi.core.score.min";break;case"cmi.score.max":g="cmi.core.score.max";break;case"cmi.success_status":case"cmi.completion_status":g="cmi.core.lesson_status",u.data.completion_status=b;break;case"cmi.session_time":g="cmi.core.session_time";break;case"cmi.suspend_data":b.length>4096&&c(s.prefix+": Warning, your suspend data is over the limit!!",2),g=a;break;default:g=a}if(h)return"false";d=e.LMSSetValue(g,b);break;case"2004":if(u.mode=""===u.mode?e.GetValue("cmi.mode"):u.mode,"normal"!==u.mode)return c(s.prefix+": Warning, you are not in normal mode.  Ignoring 'set' requests.",2),"false";switch(a){case"cmi.location":b.length>1e3&&c(s.prefix+": Warning, your bookmark is over the limit!!",2);break;case"cmi.completion_status":u.data.completion_status=b;break;case"cmi.success_status":u.data.success_status=b;break;case"cmi.exit":u.data.exit_type=b;break;case"suspend_data":b.length>64e3&&c(s.prefix+": Warning, your suspend data is over the limit!!",2)}d=e.SetValue(a,b)}return f=o(),c(s.prefix+" : setvalue("+a+",'"+b+"') returned "+d+" with errorCode="+f,4),0===f||403===f?d:(c(s.prefix+": Error\nError Code: "+f+"\nError Message: "+p(f)+" for "+a+"\nDiagnostic: "+q(f),1),d)}return c(s.prefix+": "+a+" Set Aborted, connection not initialized! Locate where you called it after you Terminated.",2),"false"},this.commit=function(){var a,b="false",d=u.path,f=0;if(a=((new Date).getTime()-s.startDate.getTime())/1e3,u.isActive){switch(c(s.prefix+": Committing data",3),u.version){case"1.2":v.setvalue("cmi.core.session_time",k(100*a)),b=d.LMSCommit("");break;case"2004":v.setvalue("cmi.session_time",e(100*a,!0)),b=d.Commit("")}return 0===(f=o())?b:(c(s.prefix+": Error\nError Code: "+f+"\nError Message: "+p(f)+" for Commit.\nDiagnostic: "+q(f),1),"false")}return c(s.prefix+": Commit Aborted, connection not initialized!",2),"false"},this.initialize=function(){c(s.prefix+": Initialize Called. \n\tversion: "+s.version+"\n\tModified: "+s.modifiedDate,3);var a=!1,b=u.path,d=0;if(u.isActive)c(s.prefix+": Aborted, connection already initialized!.",2);else if(b){switch(u.version){case"1.2":a=l(b.LMSInitialize(""));break;case"2004":a=l(b.Initialize(""))}if(d=o(),a&&0===d){switch(u.isActive=!0,u.data.completion_status=v.getvalue("cmi.completion_status"),s.startDate=new Date,v.setvalue("cmi.exit",s.exit_type),v.commit(),c(s.prefix+": SCO is initialized.",3),u.data.completion_status){case"not attempted":case"unknown":v.setvalue("cmi.completion_status","incomplete");break;default:""===u.data.completion_status&&n("LMS compatibility issue, Please notify a administrator.  Completion Status is empty.")}return"true"}c(s.prefix+": Error\nError Code: "+d+"\nError Message: "+p(d)+" for Initialize.\nDiagnostic: "+q(d),1)}else c(s.prefix+": Aborted, LMS could not be located!.",2);return"false"},this.terminate=function(){var a=!1,b=u.path,d=0;if(c(s.prefix+": Terminating "+u.isActive+" "+b,4),u.isActive)if(b){switch(c(s.prefix+": completion_status = "+u.data.completion_status+"|| success_status = "+u.data.success_status,3),v.commit(),u.version){case"1.2":a=b.LMSFinish("");break;case"2004":a=b.Terminate("")}l(a)?(c(s.prefix+": Terminated.",3),u.isActive=!1):(d=o(),c(s.prefix+": Error\nError Code: "+d+"\nError Message: "+p(d)+" for Commit.\nDiagnostic: "+q(d),1))}else c(s.prefix+": Lost connection to LMS",2);else c(s.prefix+": Terminate Aborted, connection not initialized!",2);return a},this.getObjectiveByID=function(a){var b,c,d=v.getvalue("cmi.objectives._count");if(scorm.debug(s.prefix+": Set Objective - Begin search, Objective count is "+d,4),""===d||"false"===d||"-1"===d)return"false";for(d=parseInt(d,10)-1,b=d;b>=0;b-=1)if(c=v.getvalue("cmi.objectives."+b+".id"),a===c)return scorm.debug(s.prefix+": Objective ID Match on "+b,4),b;return"false"},this.getInteractionByID=function(a){var b,c,d=v.getvalue("cmi.interactions._count");if(""===d||"false"===d||"-1"===d)return"false";for(d=parseInt(d,10)-1,scorm.debug(s.prefix+": Getting interactions from count "+d,4),b=d;b>=0;b-=1)if(c=this.getvalue("cmi.interactions."+b+".id"),a===c)return scorm.debug(s.prefix+": Interaction By ID Returning "+b),b;return"false"},this.getInteractionObjectiveByID=function(a,b){var c,d,e=v.getvalue("cmi.interactions."+a+".objectives._count");if(""===e||"false"===e)return"0";for(e=parseInt(e,10)-1,scorm.debug(s.prefix+": Getting interaction objectives from count "+e,4),c=e;c>=0;c-=1)if(d=v.getvalue("cmi.interactions."+a+".objectives."+c+".id"),b===d)return scorm.debug(s.prefix+": Interaction Objective By ID Returning "+c),c;return"false"},this.getInteractionCorrectResponsesByPattern=function(a,b){var c,d,e=v.getvalue("cmi.interactions."+a+".correct_responses._count");if(""===e||"false"===e)return scorm.debug(s.prefix+": Correct Responses pattern was empty or false",4),"0";for(e=parseInt(e,10)-1,scorm.debug(s.prefix+": Getting interaction correct responses from count "+e,4),c=e;c>=0;c-=1)if(d=v.getvalue("cmi.interactions."+a+".correct_responses."+c+".pattern"),b===d)return scorm.debug(s.prefix+": Interaction Correct Responses By Pattern Returning "+c),"match";return"false"},this.init=function(){var a;try{(a=window.parent)&&a!==window&&d(window.parent)}catch(a){}if(!u.path)try{a=window.top.opener,d(a)}catch(a){}return u.path?(u.connection=!0,!0):(c(s.prefix+": I was unable to locate an API for communication",2),!!s.use_standalone&&(c(s.prefix+": If you included Local_API_1484_11 I'll mimic the LMS.  If not, all SCORM calls will fail.",4),s.standalone=!0,u.version="2004",u.path="function"==typeof Local_API_1484_11?new Local_API_1484_11({cmi:s.cmi}):null,$(u.path).on("StoreData",function(a){$(v).triggerHandler({type:"StoreData",runtimedata:a.runtimedata})}),!0))},this.getLastError=function(a){return t[a]},this.isLMSConnected=function(){return u.connection},this.set=function(a,b){switch(a){case"version":case"createDate":case"modifiedDate":case"prefix":return m(405),!1;case"isActive":u.isActive=b,s[a]=b;break;case"startDate":s[a]=new Date(b);break;default:s[a]=b}return!1},this.get=function(a){return void 0===s[a]?(m(404),!1):s[a]},this.centisecsToSCORM12Duration=k,this.centisecsToISODuration=e,this.ISODurationToCentisec=f,this.isoDateToStringUTC=h,this.isoDateToString=i,this.isoStringToDate=j,this.makeBoolean=l,this.debug=c,this.init()}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}if(function(a){function b(){var a=arguments[0],c=b.cache;return c[a]&&c.hasOwnProperty(a)||(c[a]=b.parse(a)),b.format.call(null,c[a],arguments)}function c(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function d(a,b){return Array(b+1).join(a)}var e={not_string:/[^s]/,number:/[diefg]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};b.format=function(a,f){var g,h,i,j,k,l,m,n=1,o=a.length,p="",q=[],r=!0,s="";for(h=0;o>h;h++)if("string"===(p=c(a[h])))q[q.length]=a[h];else if("array"===p){if(j=a[h],j[2])for(g=f[n],i=0;i<j[2].length;i++){if(!g.hasOwnProperty(j[2][i]))throw new Error(b("[sprintf] property '%s' does not exist",j[2][i]));g=g[j[2][i]]}else g=j[1]?f[j[1]]:f[n++];if("function"==c(g)&&(g=g()),e.not_string.test(j[8])&&e.not_json.test(j[8])&&"number"!=c(g)&&isNaN(g))throw new TypeError(b("[sprintf] expecting number but found %s",c(g)));switch(e.number.test(j[8])&&(r=g>=0),j[8]){case"b":g=g.toString(2);break;case"c":g=String.fromCharCode(g);break;case"d":case"i":g=parseInt(g,10);break;case"j":g=JSON.stringify(g,null,j[6]?parseInt(j[6]):0);break;case"e":g=j[7]?g.toExponential(j[7]):g.toExponential();break;case"f":g=j[7]?parseFloat(g).toFixed(j[7]):parseFloat(g);break;case"g":g=j[7]?parseFloat(g).toPrecision(j[7]):parseFloat(g);break;case"o":g=g.toString(8);break;case"s":g=(g=String(g))&&j[7]?g.substring(0,j[7]):g;break;case"u":g>>>=0;break;case"x":g=g.toString(16);break;case"X":g=g.toString(16).toUpperCase()}e.json.test(j[8])?q[q.length]=g:(!e.number.test(j[8])||r&&!j[3]?s="":(s=r?"+":"-",g=g.toString().replace(e.sign,"")),l=j[4]?"0"===j[4]?"0":j[4].charAt(1):" ",m=j[6]-(s+g).length,k=j[6]&&m>0?d(l,m):"",q[q.length]=j[5]?s+g+k:"0"===l?s+k+g:k+s+g)}return q.join("")},b.cache={},b.parse=function(a){for(var b=a,c=[],d=[],f=0;b;){if(null!==(c=e.text.exec(b)))d[d.length]=c[0];else if(null!==(c=e.modulo.exec(b)))d[d.length]="%";else{if(null===(c=e.placeholder.exec(b)))throw new SyntaxError("[sprintf] unexpected placeholder");if(c[2]){f|=1;var g=[],h=c[2],i=[];if(null===(i=e.key.exec(h)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(g[g.length]=i[1];""!==(h=h.substring(i[0].length));)if(null!==(i=e.key_access.exec(h)))g[g.length]=i[1];else{if(null===(i=e.index_access.exec(h)))throw new SyntaxError("[sprintf] failed to parse named argument key");g[g.length]=i[1]}c[2]=g}else f|=2;if(3===f)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");d[d.length]=c}b=b.substring(c[0].length)}return d};var f=function(a,c,d){return d=(c||[]).slice(0),d.splice(0,0,a),b.apply(null,d)};"undefined"!=typeof exports?(exports.sprintf=b,exports.vsprintf=f):(a.sprintf=b,a.vsprintf=f,"function"==typeof define&&define.amd&&define(function(){return{sprintf:b,vsprintf:f}}))}("undefined"==typeof window?this:window),function(a,b,c,d,e,f){function g(a,b,c,d,e){return p(a,a,c,d,b,a.defaultView.pageXOffset,a.defaultView.pageYOffset).then(function(f){I("Document cloned");var g=Va+e,i="["+g+"='"+e+"']";a.querySelector(i).removeAttribute(g);var j=f.contentWindow,k=j.document.querySelector(i);return Promise.resolve("function"!=typeof b.onclone||b.onclone(j.document)).then(function(){return h(k,f,b,c,d)})})}function h(a,c,d,e,f){var g=c.contentWindow,h=new La(g.document),m=new G(d,h),n=Q(a),o="view"===d.type?e:k(g.document),p="view"===d.type?f:l(g.document),q=new d.renderer(o,p,m,d,b);return new S(a,q,h,m,d).ready.then(function(){I("Finished rendering");var b;return b="view"===d.type?j(q.canvas,{width:q.canvas.width,height:q.canvas.height,top:0,left:0,x:0,y:0}):a===g.document.body||a===g.document.documentElement||null!=d.canvas?q.canvas:j(q.canvas,{width:null!=d.width?d.width:n.width,height:null!=d.height?d.height:n.height,top:n.top,left:n.left,x:g.pageXOffset,y:g.pageYOffset}),i(c,d),b})}function i(a,b){b.removeContainer&&(a.parentNode.removeChild(a),I("Cleaned up container"))}function j(a,c){var d=b.createElement("canvas"),e=Math.min(a.width-1,Math.max(0,c.left)),f=Math.min(a.width,Math.max(1,c.left+c.width)),g=Math.min(a.height-1,Math.max(0,c.top)),h=Math.min(a.height,Math.max(1,c.top+c.height));return d.width=c.width,d.height=c.height,I("Cropping canvas at:","left:",c.left,"top:",c.top,"width:",f-e,"height:",h-g),I("Resulting crop with width",c.width,"and height",c.height," with x",e,"and y",g),d.getContext("2d").drawImage(a,e,g,f-e,h-g,c.x,c.y,f-e,h-g),d}function k(a){return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))}function l(a){return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}function m(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}function n(){return b.documentMode&&b.documentMode<=9}function o(a,c){for(var d=3===a.nodeType?b.createTextNode(a.nodeValue):a.cloneNode(!1),e=a.firstChild;e;)(!0===c||1!==e.nodeType||"SCRIPT"!==e.nodeName)&&d.appendChild(o(e,c)),e=e.nextSibling;return d}function p(a,b,c,d,e,f,g){u(a);var h=n()?o(a.documentElement,e.javascriptEnabled):a.documentElement.cloneNode(!0),i=b.createElement("iframe");return i.className="html2canvas-container",i.style.visibility="hidden",i.style.position="fixed",i.style.left="-10000px",i.style.top="0px",i.style.border="0",i.width=c,i.height=d,i.scrolling="no",b.body.appendChild(i),new Promise(function(b){var c=i.contentWindow.document;q(a.documentElement,h,"textarea"),q(a.documentElement,h,"select"),i.contentWindow.onload=i.onload=function(){var d=setInterval(function(){c.body.childNodes.length>0&&(v(a,c),clearInterval(d),"view"===e.type&&i.contentWindow.scrollTo(f,g),b(i))},50)},c.open(),c.write("<!DOCTYPE html><html></html>"),r(a,f,g),c.replaceChild(!0===e.javascriptEnabled?c.adoptNode(h):w(c.adoptNode(h)),c.documentElement),c.close()})}function q(a,b,c){for(var d=a.getElementsByTagName(c),e=b.getElementsByTagName(c),f=d.length,g=0;f>g;g++)e[g].value=d[g].value}function r(a,b,c){!a.defaultView||b===a.defaultView.pageXOffset&&c===a.defaultView.pageYOffset||a.defaultView.scrollTo(b,c)}function s(b,c,d,e,f,g){return new Ca(b,c,a.document).then(t(b)).then(function(a){return p(a,d,e,f,g,0,0)})}function t(a){return function(c){var d,e=new DOMParser;try{d=e.parseFromString(c,"text/html")}catch(a){I("DOMParser not supported, falling back to createHTMLDocument"),d=b.implementation.createHTMLDocument("");try{d.open(),d.write(c),d.close()}catch(a){I("createHTMLDocument write not supported, falling back to document.body.innerHTML"),d.body.innerHTML=c}}var f=d.querySelector("base");if(!f||!f.href.host){var g=d.createElement("base");g.href=a,d.head.insertBefore(g,d.head.firstChild)}return d}}function u(a){[].slice.call(a.querySelectorAll("canvas"),0).forEach(function(a){a.setAttribute(Wa,"canvas-"+Xa++)})}function v(a,b){[].slice.call(a.querySelectorAll("["+Wa+"]"),0).forEach(function(a){try{var c=b.querySelector("["+Wa+'="'+a.getAttribute(Wa)+'"]');c&&(c.width=a.width,c.height=a.height,c.getContext("2d").putImageData(a.getContext("2d").getImageData(0,0,a.width,a.height),0,0))}catch(b){I("Unable to copy canvas content from",a,b)}a.removeAttribute(Wa)})}function w(a){return[].slice.call(a.childNodes,0).filter(x).forEach(function(b){"SCRIPT"===b.tagName?a.removeChild(b):w(b)}),a}function x(a){return a.nodeType===Node.ELEMENT_NODE}function y(a){var c=b.createElement("a");return c.href=a,c.href=c.href,c}function z(a){this.r=0,this.g=0,this.b=0,this.a=null,this.fromArray(a)||this.namedColor(a)||this.rgb(a)||this.rgba(a)||this.hex6(a)||this.hex3(a)}function A(a){if(this.src=a,I("DummyImageContainer for",a),!this.promise||!this.image){I("Initiating DummyImageContainer"),A.prototype.image=new Image;var b=this.image;A.prototype.promise=new Promise(function(a,c){b.onload=a,b.onerror=c,b.src=m(),!0===b.complete&&a(b)})}}function B(a,c){var d,e,f=b.createElement("div"),g=b.createElement("img"),h=b.createElement("span"),i="Hidden Text";f.style.visibility="hidden",f.style.fontFamily=a,f.style.fontSize=c,f.style.margin=0,f.style.padding=0,b.body.appendChild(f),g.src=m(),g.width=1,g.height=1,g.style.margin=0,g.style.padding=0,g.style.verticalAlign="baseline",h.style.fontFamily=a,h.style.fontSize=c,h.style.margin=0,h.style.padding=0,h.appendChild(b.createTextNode(i)),f.appendChild(h),f.appendChild(g),d=g.offsetTop-h.offsetTop+1,f.removeChild(h),f.appendChild(b.createTextNode(i)),f.style.lineHeight="normal",g.style.verticalAlign="super",e=g.offsetTop-f.offsetTop+1,b.body.removeChild(f),this.baseline=d,this.lineWidth=1,this.middle=e}function C(){this.data={}}function D(a,b,c){this.image=null,this.src=a;var d=this,e=Q(a);this.promise=(b?new Promise(function(b){"about:blank"===a.contentWindow.document.URL||null==a.contentWindow.document.documentElement?a.contentWindow.onload=a.onload=function(){b(a)}:b(a)}):this.proxyLoad(c.proxy,e,c)).then(function(a){return html2canvas(a.contentWindow.document.documentElement,{type:"view",width:a.width,height:a.height,proxy:c.proxy,javascriptEnabled:c.javascriptEnabled,removeContainer:c.removeContainer,allowTaint:c.allowTaint,imageTimeout:c.imageTimeout/2})}).then(function(a){return d.image=a})}function E(a){this.src=a.value,this.colorStops=[],this.type=null,this.x0=.5,this.y0=.5,this.x1=.5,this.y1=.5,this.promise=Promise.resolve(!0)}function F(a,b){this.src=a,this.image=new Image;var c=this;this.tainted=null,this.promise=new Promise(function(d,e){c.image.onload=d,c.image.onerror=e,b&&(c.image.crossOrigin="anonymous"),c.image.src=a,!0===c.image.complete&&d(c.image)})}function G(b,c){this.link=null,this.options=b,this.support=c,this.origin=this.getOrigin(a.location.href)}function H(a){E.apply(this,arguments),this.type=this.TYPES.LINEAR;var b=null===a.args[0].match(this.stepRegExp);b?a.args[0].split(" ").reverse().forEach(function(a){switch(a){case"left":this.x0=0,this.x1=1;break;case"top":this.y0=0,this.y1=1;break;case"right":this.x0=1,this.x1=0;break;case"bottom":this.y0=1,this.y1=0;break;case"to":var b=this.y0,c=this.x0;this.y0=this.y1,this.x0=this.x1,this.x1=c,this.y1=b}},this):(this.y0=0,this.y1=1),this.colorStops=a.args.slice(b?1:0).map(function(a){var b=a.match(this.stepRegExp);return{color:new z(b[1]),stop:"%"===b[3]?b[2]/100:null}},this),null===this.colorStops[0].stop&&(this.colorStops[0].stop=0),null===this.colorStops[this.colorStops.length-1].stop&&(this.colorStops[this.colorStops.length-1].stop=1),this.colorStops.forEach(function(a,b){null===a.stop&&this.colorStops.slice(b).some(function(c,d){return null!==c.stop&&(a.stop=(c.stop-this.colorStops[b-1].stop)/(d+1)+this.colorStops[b-1].stop,!0)},this)},this)}function I(){a.html2canvas.logging&&a.console&&a.console.log&&Function.prototype.bind.call(a.console.log,a.console).apply(a.console,[Date.now()-a.html2canvas.start+"ms","html2canvas:"].concat([].slice.call(arguments,0)))}function J(a,b){this.node=a,this.parent=b,this.stack=null,this.bounds=null,this.borders=null,this.clip=[],this.backgroundClip=[],this.offsetBounds=null,this.visible=null,this.computedStyles=null,this.colors={},this.styles={},this.backgroundImages=null,this.transformData=null,this.transformMatrix=null,this.isPseudoElement=!1,this.opacity=null}function K(a){var b=a.options[a.selectedIndex||0];return b?b.text||"":""}function L(a){return a&&"matrix"===a[1]?a[2].split(",").map(function(a){return parseFloat(a.trim())}):void 0}function M(a){return-1!==a.toString().indexOf("%")}function N(a){var b,c,d,e,f,g,h,i=[],j=0,k=0,l=function(){b&&('"'===c.substr(0,1)&&(c=c.substr(1,c.length-2)),c&&h.push(c),"-"===b.substr(0,1)&&(e=b.indexOf("-",1)+1)>0&&(d=b.substr(0,e),b=b.substr(e)),i.push({prefix:d,method:b.toLowerCase(),value:f,args:h,image:null})),h=[],b=d=c=f=""};return h=[],b=d=c=f="",a.split("").forEach(function(a){if(!(0===j&&" \r\n\t".indexOf(a)>-1)){switch(a){case'"':g?g===a&&(g=null):g=a;break;case"(":if(g)break;if(0===j)return j=1,void(f+=a);k++;break;case")":if(g)break;if(1===j){if(0===k)return j=0,f+=a,void l();k--}break;case",":if(g)break;if(0===j)return void l();if(1===j&&0===k&&!b.match(/^url$/i))return h.push(c),c="",void(f+=a)}f+=a,0===j?b+=a:c+=a}}),l(),i}function O(a){return a.replace("px","")}function P(a){return parseFloat(a)}function Q(a){if(a.getBoundingClientRect){var b=a.getBoundingClientRect(),c=null==a.offsetWidth?b.width:a.offsetWidth;return{top:b.top,bottom:b.bottom||b.top+b.height,right:b.left+c,left:b.left,width:c,height:null==a.offsetHeight?b.height:a.offsetHeight}}return{}}function R(a){var b=a.offsetParent?R(a.offsetParent):{top:0,left:0};return{top:a.offsetTop+b.top,bottom:a.offsetTop+a.offsetHeight+b.top,right:a.offsetLeft+b.left+a.offsetWidth,left:a.offsetLeft+b.left,width:a.offsetWidth,height:a.offsetHeight}}function S(a,b,c,d,e){I("Starting NodeParser"),this.renderer=b,this.options=e,this.range=null,this.support=c,this.renderQueue=[],this.stack=new Ka(!0,1,a.ownerDocument,null);var f=new J(a,null);if(e.background&&b.rectangle(0,0,b.width,b.height,new z(e.background)),a===a.ownerDocument.documentElement){var g=new J(f.color("backgroundColor").isTransparent()?a.ownerDocument.body:a.ownerDocument.documentElement,null);b.rectangle(0,0,b.width,b.height,g.color("backgroundColor"))}f.visibile=f.isElementVisible(),this.createPseudoHideStyles(a.ownerDocument),this.disableAnimations(a.ownerDocument),this.nodes=xa([f].concat(this.getChildren(f)).filter(function(a){return a.visible=a.isElementVisible()}).map(this.getPseudoElements,this)),this.fontMetrics=new C,I("Fetched nodes, total:",this.nodes.length),I("Calculate overflow clips"),this.calculateOverflowClips(),I("Start fetching images"),this.images=d.fetch(this.nodes.filter(oa)),this.ready=this.images.ready.then(ta(function(){return I("Images loaded, starting parsing"),I("Creating stacking contexts"),this.createStackingContexts(),I("Sorting stacking contexts"),this.sortStackingContexts(this.stack),this.parse(this.stack),I("Render queue created with "+this.renderQueue.length+" items"),new Promise(ta(function(a){e.async?"function"==typeof e.async?e.async.call(this,this.renderQueue,a):this.renderQueue.length>0?(this.renderIndex=0,this.asyncRenderer(this.renderQueue,a)):a():(this.renderQueue.forEach(this.paint,this),a())},this))},this))}function T(a){return a.parent&&a.parent.clip.length}function U(a){return a.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})}function V(){}function W(a,b,c,d){return a.map(function(e,f){if(e.width>0){var g=b.left,h=b.top,i=b.width,j=b.height-a[2].width;switch(f){case 0:j=a[0].width,e.args=$({c1:[g,h],c2:[g+i,h],c3:[g+i-a[1].width,h+j],c4:[g+a[3].width,h+j]},d[0],d[1],c.topLeftOuter,c.topLeftInner,c.topRightOuter,c.topRightInner);break;case 1:g=b.left+b.width-a[1].width,i=a[1].width,e.args=$({c1:[g+i,h],c2:[g+i,h+j+a[2].width],c3:[g,h+j],c4:[g,h+a[0].width]},d[1],d[2],c.topRightOuter,c.topRightInner,c.bottomRightOuter,c.bottomRightInner);break;case 2:h=h+b.height-a[2].width,j=a[2].width,e.args=$({c1:[g+i,h+j],c2:[g,h+j],c3:[g+a[3].width,h],c4:[g+i-a[3].width,h]},d[2],d[3],c.bottomRightOuter,c.bottomRightInner,c.bottomLeftOuter,c.bottomLeftInner);break;case 3:i=a[3].width,e.args=$({c1:[g,h+j+a[2].width],c2:[g,h],c3:[g+i,h+a[0].width],c4:[g+i,h+j]},d[3],d[0],c.bottomLeftOuter,c.bottomLeftInner,c.topLeftOuter,c.topLeftInner)}}return e})}function X(a,b,c,d){var e=(Math.sqrt(2)-1)/3*4,f=c*e,g=d*e,h=a+c,i=b+d;return{topLeft:Z({x:a,y:i},{x:a,y:i-g},{x:h-f,y:b},{x:h,y:b}),topRight:Z({x:a,y:b},{x:a+f,y:b},{x:h,y:i-g},{x:h,y:i}),bottomRight:Z({x:h,y:b},{x:h,y:b+g},{x:a+f,y:i},{x:a,y:i}),bottomLeft:Z({x:h,y:i},{x:h-f,y:i},{x:a,y:b+g},{x:a,y:b})}}function Y(a,b,c){var d=a.left,e=a.top,f=a.width,g=a.height,h=b[0][0],i=b[0][1],j=b[1][0],k=b[1][1],l=b[2][0],m=b[2][1],n=b[3][0],o=b[3][1],p=f-j,q=g-m,r=f-l,s=g-o;return{topLeftOuter:X(d,e,h,i).topLeft.subdivide(.5),topLeftInner:X(d+c[3].width,e+c[0].width,Math.max(0,h-c[3].width),Math.max(0,i-c[0].width)).topLeft.subdivide(.5),topRightOuter:X(d+p,e,j,k).topRight.subdivide(.5),topRightInner:X(d+Math.min(p,f+c[3].width),e+c[0].width,p>f+c[3].width?0:j-c[3].width,k-c[0].width).topRight.subdivide(.5),bottomRightOuter:X(d+r,e+q,l,m).bottomRight.subdivide(.5),bottomRightInner:X(d+Math.min(r,f-c[3].width),e+Math.min(q,g+c[0].width),Math.max(0,l-c[1].width),m-c[2].width).bottomRight.subdivide(.5),bottomLeftOuter:X(d,e+s,n,o).bottomLeft.subdivide(.5),bottomLeftInner:X(d+c[3].width,e+s,Math.max(0,n-c[3].width),o-c[2].width).bottomLeft.subdivide(.5)}}function Z(a,b,c,d){var e=function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+(b.y-a.y)*c}};return{start:a,startControl:b,endControl:c,end:d,subdivide:function(f){var g=e(a,b,f),h=e(b,c,f),i=e(c,d,f),j=e(g,h,f),k=e(h,i,f),l=e(j,k,f);return[Z(a,g,j,l),Z(l,k,i,d)]},curveTo:function(a){a.push(["bezierCurve",b.x,b.y,c.x,c.y,d.x,d.y])},curveToReversed:function(d){d.push(["bezierCurve",c.x,c.y,b.x,b.y,a.x,a.y])}}}function $(a,b,c,d,e,f,g){var h=[];return b[0]>0||b[1]>0?(h.push(["line",d[1].start.x,d[1].start.y]),d[1].curveTo(h)):h.push(["line",a.c1[0],a.c1[1]]),c[0]>0||c[1]>0?(h.push(["line",f[0].start.x,f[0].start.y]),f[0].curveTo(h),h.push(["line",g[0].end.x,g[0].end.y]),g[0].curveToReversed(h)):(h.push(["line",a.c2[0],a.c2[1]]),h.push(["line",a.c3[0],a.c3[1]])),b[0]>0||b[1]>0?(h.push(["line",e[1].end.x,e[1].end.y]),e[1].curveToReversed(h)):h.push(["line",a.c4[0],a.c4[1]]),h}function _(a,b,c,d,e,f,g){b[0]>0||b[1]>0?(a.push(["line",d[0].start.x,d[0].start.y]),d[0].curveTo(a),d[1].curveTo(a)):a.push(["line",f,g]),(c[0]>0||c[1]>0)&&a.push(["line",e[0].start.x,e[0].start.y])}function aa(a){return a.cssInt("zIndex")<0}function ba(a){return a.cssInt("zIndex")>0}function ca(a){return 0===a.cssInt("zIndex")}function da(a){return-1!==["inline","inline-block","inline-table"].indexOf(a.css("display"))}function ea(a){return a instanceof Ka}function fa(a){return a.node.data.trim().length>0}function ga(a){return/^(normal|none|0px)$/.test(a.parent.css("letterSpacing"))}function ha(a){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(b){var c=a.css("border"+b+"Radius"),d=c.split(" ");return d.length<=1&&(d[1]=d[0]),d.map(ua)})}function ia(a){return a.nodeType===Node.TEXT_NODE||a.nodeType===Node.ELEMENT_NODE}function ja(a){return"auto"!==(-1!==["absolute","relative","fixed"].indexOf(a.css("position"))?a.css("zIndex"):"auto")}function ka(a){return"static"!==a.css("position")}function la(a){return"none"!==a.css("float")}function ma(a){return-1!==["inline-block","inline-table"].indexOf(a.css("display"))}function na(a){var b=this;return function(){return!a.apply(b,arguments)}}function oa(a){return a.node.nodeType===Node.ELEMENT_NODE}function pa(a){return!0===a.isPseudoElement}function qa(a){return a.node.nodeType===Node.TEXT_NODE}function ra(a){return function(b,c){return b.cssInt("zIndex")+a.indexOf(b)/a.length-(c.cssInt("zIndex")+a.indexOf(c)/a.length)}}function sa(a){return a.getOpacity()<1}function ta(a,b){return function(){return a.apply(b,arguments)}}function ua(a){return parseInt(a,10)}function va(a){return a.width}function wa(a){return a.node.nodeType!==Node.ELEMENT_NODE||-1===["SCRIPT","HEAD","TITLE","OBJECT","BR","OPTION"].indexOf(a.node.nodeName)}function xa(a){return[].concat.apply([],a)}function ya(a){var b=a.substr(0,1);return b===a.substr(a.length-1)&&b.match(/'|"/)?a.substr(1,a.length-2):a}function za(b){for(var c,d=[],e=0,f=!1;b.length;)Aa(b[e])===f?(c=b.splice(0,e),c.length&&d.push(a.html2canvas.punycode.ucs2.encode(c)),f=!f,e=0):e++,e>=b.length&&(c=b.splice(0,e),c.length&&d.push(a.html2canvas.punycode.ucs2.encode(c)));return d}function Aa(a){return-1!==[32,13,10,9,45].indexOf(a)}function Ba(a){return/[^\u0000-\u00ff]/.test(a)}function Ca(a,b,c){if(!b)return Promise.reject("No proxy configured");var d=Fa(eb),e=Ga(b,a,d);return eb?Sa(e):Ea(c,e,d).then(function(a){return Na(a.content)})}function Da(a,b,c){var d=Fa(fb),e=Ga(b,a,d);return fb?Promise.resolve(e):Ea(c,e,d).then(function(a){return"data:"+a.type+";base64,"+a.content})}function Ea(b,c,d){return new Promise(function(e,f){var g=b.createElement("script"),h=function(){delete a.html2canvas.proxy[d],b.body.removeChild(g)};a.html2canvas.proxy[d]=function(a){h(),e(a)},g.src=c,g.onerror=function(a){h(),f(a)},b.body.appendChild(g)})}function Fa(a){return a?"":"html2canvas_"+Date.now()+"_"+ ++db+"_"+Math.round(1e5*Math.random())}function Ga(a,b,c){return a+"?url="+encodeURIComponent(b)+(c.length?"&callback=html2canvas.proxy."+c:"")}function Ha(a,c){var d=b.createElement("a");d.href=a,a=d.href,this.src=a,this.image=new Image;var e=this;this.promise=new Promise(function(d,f){e.image.crossOrigin="Anonymous",e.image.onload=d,e.image.onerror=f,new Da(a,c,b).then(function(a){e.image.src=a}).catch(f)})}function Ia(a,b,c){J.call(this,a,b),this.isPseudoElement=!0,this.before=":before"===c}function Ja(a,b,c,d,e){this.width=a,this.height=b,this.images=c,this.options=d,this.document=e}function Ka(a,b,c,d){J.call(this,c,d),this.ownStacking=a,this.contexts=[],this.children=[],this.opacity=(this.parent?this.parent.stack.opacity:1)*b}function La(a){this.rangeBounds=this.testRangeBounds(a),this.cors=this.testCORS(),this.svg=this.testSVG()}function Ma(a){this.src=a,this.image=null;var b=this;this.promise=this.hasFabric().then(function(){return b.isInline(a)?Promise.resolve(b.inlineFormatting(a)):Sa(a)}).then(function(a){return new Promise(function(c){html2canvas.fabric.loadSVGFromString(a,b.createCanvas.call(b,c))})})}function Na(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=a.length,l="";for(b=0;k>b;b+=4)c=j.indexOf(a[b]),d=j.indexOf(a[b+1]),e=j.indexOf(a[b+2]),f=j.indexOf(a[b+3]),g=c<<2|d>>4,h=(15&d)<<4|e>>2,i=(3&e)<<6|f,l+=64===e?String.fromCharCode(g):64===f||-1===f?String.fromCharCode(g,h):String.fromCharCode(g,h,i);return l}function Oa(a,b){this.src=a,this.image=null;var c=this;this.promise=b?new Promise(function(b,d){c.image=new Image,c.image.onload=b,c.image.onerror=d,c.image.src="data:image/svg+xml,"+(new XMLSerializer).serializeToString(a),!0===c.image.complete&&b(c.image)}):this.hasFabric().then(function(){return new Promise(function(b){html2canvas.fabric.parseSVGDocument(a,c.createCanvas.call(c,b))})})}function Pa(a,b){J.call(this,a,b)}function Qa(a,b,c){return a.length>0?b+c.toUpperCase():void 0}function Ra(a){E.apply(this,arguments),this.type="linear"===a.args[0]?this.TYPES.LINEAR:this.TYPES.RADIAL}function Sa(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a),d.onload=function(){200===d.status?b(d.responseText):c(new Error(d.statusText))},d.onerror=function(){c(new Error("Network Error"))},d.send()})}function Ta(a,b){Ja.apply(this,arguments),this.canvas=this.options.canvas||this.document.createElement("canvas"),this.options.canvas||(this.canvas.width=a,this.canvas.height=b),this.ctx=this.canvas.getContext("2d"),this.taintCtx=this.document.createElement("canvas").getContext("2d"),this.ctx.textBaseline="bottom",this.variables={},I("Initialized CanvasRenderer with size",a,"x",b)}function Ua(a){return a.length>0}if(function(){function c(a,b){F[C]=a,F[C+1]=b,2===(C+=2)&&A()}function f(a){return"function"==typeof a}function g(){return function(){process.nextTick(k)}}function h(){var a=0,c=new E(k),d=b.createTextNode("");return c.observe(d,{characterData:!0}),function(){d.data=a=++a%2}}function i(){var a=new MessageChannel;return a.port1.onmessage=k,function(){a.port2.postMessage(0)}}function j(){return function(){setTimeout(k,1)}}function k(){for(var a=0;C>a;a+=2)F[a](F[a+1]),F[a]=void 0,F[a+1]=void 0;C=0}function l(){}function m(a,b,c,d){try{a.call(b,c,d)}catch(a){return a}}function n(a,b,d){c(function(a){var c=!1,e=m(d,b,function(d){c||(c=!0,b!==d?p(a,d):r(a,d))},function(b){c||(c=!0,s(a,b))});!c&&e&&(c=!0,s(a,e))},a)}function o(a,b){1===b.a?r(a,b.b):2===a.a?s(a,b.b):t(b,void 0,function(b){p(a,b)},function(b){s(a,b)})}function p(a,b){if(a===b)s(a,new TypeError("You cannot resolve a promise with itself"));else if("function"==typeof b||"object"==typeof b&&null!==b)if(b.constructor===a.constructor)o(a,b);else{var c;try{c=b.then}catch(a){G.error=a,c=G}c===G?s(a,G.error):void 0===c?r(a,b):f(c)?n(a,b,c):r(a,b)}else r(a,b)}function q(a){a.f&&a.f(a.b),u(a)}function r(a,b){void 0===a.a&&(a.b=b,a.a=1,0!==a.e.length&&c(u,a))}function s(a,b){void 0===a.a&&(a.a=2,a.b=b,c(q,a))}function t(a,b,d,e){var f=a.e,g=f.length;a.f=null,f[g]=b,f[g+1]=d,f[g+2]=e,0===g&&a.a&&c(u,a)}function u(a){var b=a.e,c=a.a;if(0!==b.length){for(var d,e,f=a.b,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?w(c,d,e,f):e(f);a.e.length=0}}function v(){this.error=null}function w(a,b,c,d){var e,g,h,i,j=f(c);if(j){try{e=c(d)}catch(a){H.error=a,e=H}if(e===H?(i=!0,g=e.error,e=null):h=!0,b===e)return void s(b,new TypeError("A promises callback cannot return that same promise."))}else e=d,h=!0;void 0===b.a&&(j&&h?p(b,e):i?s(b,g):1===a?r(b,e):2===a&&s(b,e))}function x(a,b){try{b(function(b){p(a,b)},function(b){s(a,b)})}catch(b){s(a,b)}}function y(a,b,c,d){this.n=a,this.c=new a(l,d),this.i=c,this.o(b)?(this.m=b,this.d=this.length=b.length,this.l(),0===this.length?r(this.c,this.b):(this.length=this.length||0,this.k(),0===this.d&&r(this.c,this.b))):s(this.c,this.p())}function z(a){if(I++,this.b=this.a=void 0,this.e=[],l!==a){if(!f(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof z))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");x(this,a)}}var A,B=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},C=0,D=void 0!==a?a:{},E=D.MutationObserver||D.WebKitMutationObserver,D="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,F=Array(1e3);A="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?g():E?h():D?i():j();var G=new v,H=new v;y.prototype.o=function(a){return B(a)},y.prototype.p=function(){return Error("Array Methods must be provided an Array")},y.prototype.l=function(){this.b=Array(this.length)},y.prototype.k=function(){for(var a=this.length,b=this.c,c=this.m,d=0;void 0===b.a&&a>d;d++)this.j(c[d],d)},y.prototype.j=function(a,b){var c=this.n;"object"==typeof a&&null!==a?a.constructor===c&&void 0!==a.a?(a.f=null,this.g(a.a,b,a.b)):this.q(c.resolve(a),b):(this.d--,this.b[b]=this.h(a))},y.prototype.g=function(a,b,c){var d=this.c;void 0===d.a&&(this.d--,this.i&&2===a?s(d,c):this.b[b]=this.h(c)),0===this.d&&r(d,this.b)},y.prototype.h=function(a){return a},y.prototype.q=function(a,b){var c=this;t(a,void 0,function(a){c.g(1,b,a)},function(a){c.g(2,b,a)})};var I=0;z.all=function(a,b){return new y(this,a,!0,b).c},z.race=function(a,b){function c(a){p(e,a)}function d(a){s(e,a)}var e=new this(l,b);if(!B(a))return s(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;void 0===e.a&&f>g;g++)t(this.resolve(a[g]),void 0,c,d);return e},z.resolve=function(a,b){if(a&&"object"==typeof a&&a.constructor===this)return a;var c=new this(l,b);return p(c,a),c},z.reject=function(a,b){var c=new this(l,b);return s(c,a),c},z.prototype={constructor:z,then:function(a,b){var d=this.a;if(1===d&&!a||2===d&&!b)return this;var e=new this.constructor(l),f=this.b;if(d){var g=arguments[d-1];c(function(){w(d,e,g,f)})}else t(this,e,a,b);return e},catch:function(a){return this.then(null,a)}};var J={Promise:z,polyfill:function(){var b;"Promise"in(b=void 0!==d?d:void 0!==a&&a.document?a:self)&&"resolve"in b.Promise&&"reject"in b.Promise&&"all"in b.Promise&&"race"in b.Promise&&function(){var a;return new b.Promise(function(b){a=b}),f(a)}()||(b.Promise=z)}};"function"==typeof e&&e.amd?e(function(){return J}):"undefined"!=typeof module&&module.exports?module.exports=J:void 0!==this&&(this.ES6Promise=J)}.call(a),a&&a.ES6Promise.polyfill(),void 0===b||"function"!=typeof Object.create||"function"!=typeof b.createElement("canvas").getContext)return void((a||module.exports).html2canvas=function(){return Promise.reject("No canvas support")});!function(a){function b(a){throw RangeError(H[a])}function f(a,b){for(var c=a.length,d=[];c--;)d[c]=b(a[c]);return d}function g(a,b){var c=a.split("@"),d="";return c.length>1&&(d=c[0]+"@",a=c[1]),d+f(a.split(G),b).join(".")}function h(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function i(a){return f(a,function(a){var b="";return a>65535&&(a-=65536,b+=K(a>>>10&1023|55296),a=56320|1023&a),b+=K(a)}).join("")}function j(a){return 10>a-48?a-22:26>a-65?a-65:26>a-97?a-97:w}function k(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function l(a,b,c){var d=0;for(a=c?J(a/A):a>>1,a+=J(a/b);a>I*y>>1;d+=w)a=J(a/I);return J(d+(I+1)*a/(a+z))}function m(a){var c,d,e,f,g,h,k,m,n,o,p=[],q=a.length,r=0,s=C,t=B;for(d=a.lastIndexOf(D),0>d&&(d=0),e=0;d>e;++e)a.charCodeAt(e)>=128&&b("not-basic"),p.push(a.charCodeAt(e));for(f=d>0?d+1:0;q>f;){for(g=r,h=1,k=w;f>=q&&b("invalid-input"),m=j(a.charCodeAt(f++)),(m>=w||m>J((v-r)/h))&&b("overflow"),r+=m*h,!((n=t>=k?x:k>=t+y?y:k-t)>m);k+=w)o=w-n,h>J(v/o)&&b("overflow"),h*=o;c=p.length+1,t=l(r-g,c,0==g),J(r/c)>v-s&&b("overflow"),s+=J(r/c),r%=c,p.splice(r++,0,s)}return i(p)}function n(a){var c,d,e,f,g,i,j,m,n,o,p,q,r,s,t,u=[];for(a=h(a),q=a.length,c=C,d=0,g=B,i=0;q>i;++i)128>(p=a[i])&&u.push(K(p));for(e=f=u.length,f&&u.push(D);q>e;){for(j=v,i=0;q>i;++i)(p=a[i])>=c&&j>p&&(j=p);for(r=e+1,j-c>J((v-d)/r)&&b("overflow"),d+=(j-c)*r,c=j,i=0;q>i;++i)if(p=a[i],c>p&&++d>v&&b("overflow"),p==c){for(m=d,n=w;!((o=g>=n?x:n>=g+y?y:n-g)>m);n+=w)t=m-o,s=w-o,u.push(K(k(o+t%s,0))),m=J(t/s);u.push(K(k(m,0))),g=l(d,r,e==f),d=0,++e}++d,++c}return u.join("")}function o(a){return g(a,function(a){return E.test(a)?m(a.slice(4).toLowerCase()):a})}function p(a){return g(a,function(a){return F.test(a)?"xn--"+n(a):a})}var q="object"==typeof c&&c&&!c.nodeType&&c,r="object"==typeof module&&module&&!module.nodeType&&module,s="object"==typeof d&&d;(s.global===s||s.window===s||s.self===s)&&(a=s);var t,u,v=2147483647,w=36,x=1,y=26,z=38,A=700,B=72,C=128,D="-",E=/^xn--/,F=/[^\x20-\x7E]/,G=/[\x2E\u3002\uFF0E\uFF61]/g,H={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=w-x,J=Math.floor,K=String.fromCharCode;if(t={version:"1.3.1",ucs2:{decode:h,encode:i},decode:m,encode:n,toASCII:p,toUnicode:o},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return t});else if(q&&r)if(module.exports==q)r.exports=t;else for(u in t)t.hasOwnProperty(u)&&(q[u]=t[u]);else a.punycode=t}(this);var Va="data-html2canvas-node",Wa="data-html2canvas-canvas-clone",Xa=0,Ya=0;a.html2canvas=function(c,d){var e=Ya++;if(d=d||{},d.logging&&(a.html2canvas.logging=!0,a.html2canvas.start=Date.now()),d.async=void 0===d.async||d.async,d.allowTaint=void 0!==d.allowTaint&&d.allowTaint,d.removeContainer=void 0===d.removeContainer||d.removeContainer,d.javascriptEnabled=void 0!==d.javascriptEnabled&&d.javascriptEnabled,d.imageTimeout=void 0===d.imageTimeout?1e4:d.imageTimeout,d.renderer="function"==typeof d.renderer?d.renderer:Ta,d.strict=!!d.strict,"string"==typeof c){if("string"!=typeof d.proxy)return Promise.reject("Proxy must be used when rendering url");var i=null!=d.width?d.width:a.innerWidth,j=null!=d.height?d.height:a.innerHeight;return s(y(c),d.proxy,b,i,j,d).then(function(a){return h(a.contentWindow.document.documentElement,a,d,i,j)})}var k=(c===f?[b.documentElement]:c.length?c:[c])[0];return k.setAttribute(Va+e,e),g(k.ownerDocument,d,k.ownerDocument.defaultView.innerWidth,k.ownerDocument.defaultView.innerHeight,e).then(function(a){return"function"==typeof d.onrendered&&(I("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"),d.onrendered(a)),a})},a.html2canvas.punycode=this.punycode,a.html2canvas.proxy={},z.prototype.darken=function(a){var b=1-a;return new z([Math.round(this.r*b),Math.round(this.g*b),Math.round(this.b*b),this.a])},z.prototype.isTransparent=function(){return 0===this.a},z.prototype.isBlack=function(){return 0===this.r&&0===this.g&&0===this.b},z.prototype.fromArray=function(a){return Array.isArray(a)&&(this.r=Math.min(a[0],255),this.g=Math.min(a[1],255),this.b=Math.min(a[2],255),a.length>3&&(this.a=a[3])),Array.isArray(a)};var Za=/^#([a-f0-9]{3})$/i;z.prototype.hex3=function(a){var b=null;return null!==(b=a.match(Za))&&(this.r=parseInt(b[1][0]+b[1][0],16),this.g=parseInt(b[1][1]+b[1][1],16),this.b=parseInt(b[1][2]+b[1][2],16)),null!==b};var $a=/^#([a-f0-9]{6})$/i;z.prototype.hex6=function(a){var b=null;return null!==(b=a.match($a))&&(this.r=parseInt(b[1].substring(0,2),16),this.g=parseInt(b[1].substring(2,4),16),this.b=parseInt(b[1].substring(4,6),16)),null!==b};var _a=/^rgb\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3})\)$/;z.prototype.rgb=function(a){var b=null;return null!==(b=a.match(_a))&&(this.r=Number(b[1]),this.g=Number(b[2]),this.b=Number(b[3])),null!==b};var ab=/^rgba\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3}) *, *(\d+\.?\d*)\)$/;z.prototype.rgba=function(a){var b=null;return null!==(b=a.match(ab))&&(this.r=Number(b[1]),this.g=Number(b[2]),this.b=Number(b[3]),this.a=Number(b[4])),null!==b},z.prototype.toString=function(){return null!==this.a&&1!==this.a?"rgba("+[this.r,this.g,this.b,this.a].join(",")+")":"rgb("+[this.r,this.g,this.b].join(",")+")"},z.prototype.namedColor=function(a){var b=bb[a.toLowerCase()];if(b)this.r=b[0],this.g=b[1],this.b=b[2];else if("transparent"===a.toLowerCase())return this.r=this.g=this.b=this.a=0,!0;return!!b},z.prototype.isColor=!0;var bb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};C.prototype.getMetrics=function(a,b){return this.data[a+"-"+b]===f&&(this.data[a+"-"+b]=new B(a,b)),this.data[a+"-"+b]},D.prototype.proxyLoad=function(a,b,c){var d=this.src;return s(d.src,a,d.ownerDocument,b.width,b.height,c)},E.prototype.TYPES={LINEAR:1,RADIAL:2},G.prototype.findImages=function(a){var b=[];return a.reduce(function(a,b){switch(b.node.nodeName){case"IMG":return a.concat([{args:[b.node.src],method:"url"}]);case"svg":case"IFRAME":return a.concat([{args:[b.node],method:b.node.nodeName}])}return a},[]).forEach(this.addImage(b,this.loadImage),this),b},G.prototype.findBackgroundImage=function(a,b){return b.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(a,this.loadImage),this),a},G.prototype.addImage=function(a,b){return function(c){c.args.forEach(function(d){this.imageExists(a,d)||(a.splice(0,0,b.call(this,c)),I("Added image #"+a.length,"string"==typeof d?d.substring(0,100):d))},this)}},G.prototype.hasImageBackground=function(a){return"none"!==a.method},G.prototype.loadImage=function(a){if("url"===a.method){var b=a.args[0];return!this.isSVG(b)||this.support.svg||this.options.allowTaint?b.match(/data:image\/.*;base64,/i)?new F(b.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),!1):this.isSameOrigin(b)||!0===this.options.allowTaint||this.isSVG(b)?new F(b,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new F(b,!0):this.options.proxy?new Ha(b,this.options.proxy):new A(b):new Ma(b)}return"linear-gradient"===a.method?new H(a):"gradient"===a.method?new Ra(a):"svg"===a.method?new Oa(a.args[0],this.support.svg):"IFRAME"===a.method?new D(a.args[0],this.isSameOrigin(a.args[0].src),this.options):new A(a)},G.prototype.isSVG=function(a){return"svg"===a.substring(a.length-3).toLowerCase()||Ma.prototype.isInline(a)},G.prototype.imageExists=function(a,b){return a.some(function(a){return a.src===b})},G.prototype.isSameOrigin=function(a){return this.getOrigin(a)===this.origin},G.prototype.getOrigin=function(a){var c=this.link||(this.link=b.createElement("a"));return c.href=a,c.href=c.href,c.protocol+c.hostname+c.port},G.prototype.getPromise=function(a){return this.timeout(a,this.options.imageTimeout).catch(function(){return new A(a.src).promise.then(function(b){a.image=b})})},G.prototype.get=function(a){var b=null;return this.images.some(function(c){return(b=c).src===a})?b:null},G.prototype.fetch=function(a){return this.images=a.reduce(ta(this.findBackgroundImage,this),this.findImages(a)),this.images.forEach(function(a,b){a.promise.then(function(){I("Succesfully loaded image #"+(b+1),a)},function(c){I("Failed loading image #"+(b+1),a,c)})}),this.ready=Promise.all(this.images.map(this.getPromise,this)),I("Finished searching images"),this},G.prototype.timeout=function(a,b){var c,d=Promise.race([a.promise,new Promise(function(d,e){c=setTimeout(function(){I("Timed out loading image",a),e(a)},b)})]).then(function(a){return clearTimeout(c),a});return d.catch(function(){clearTimeout(c)}),d},H.prototype=Object.create(E.prototype),H.prototype.stepRegExp=/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/,J.prototype.cloneTo=function(a){a.visible=this.visible,a.borders=this.borders,a.bounds=this.bounds,a.clip=this.clip,a.backgroundClip=this.backgroundClip,a.computedStyles=this.computedStyles,a.styles=this.styles,a.backgroundImages=this.backgroundImages,a.opacity=this.opacity},J.prototype.getOpacity=function(){return null===this.opacity?this.opacity=this.cssFloat("opacity"):this.opacity},J.prototype.assignStack=function(a){this.stack=a,a.children.push(this)},J.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:"none"!==this.css("display")&&"hidden"!==this.css("visibility")&&!this.node.hasAttribute("data-html2canvas-ignore")&&("INPUT"!==this.node.nodeName||"hidden"!==this.node.getAttribute("type"))},J.prototype.css=function(a){return this.computedStyles||(this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?":before":":after"):this.computedStyle(null)),this.styles[a]||(this.styles[a]=this.computedStyles[a])},J.prototype.prefixedCss=function(a){var b=["webkit","moz","ms","o"],c=this.css(a);return c===f&&b.some(function(b){return(c=this.css(b+a.substr(0,1).toUpperCase()+a.substr(1)))!==f},this),c===f?null:c},J.prototype.computedStyle=function(a){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,a)},J.prototype.cssInt=function(a){var b=parseInt(this.css(a),10);return isNaN(b)?0:b},J.prototype.color=function(a){return this.colors[a]||(this.colors[a]=new z(this.css(a)))},J.prototype.cssFloat=function(a){var b=parseFloat(this.css(a));return isNaN(b)?0:b},J.prototype.fontWeight=function(){var a=this.css("fontWeight");switch(parseInt(a,10)){case 401:a="bold";break;case 400:a="normal"}return a},J.prototype.parseClip=function(){var a=this.css("clip").match(this.CLIP);return a?{top:parseInt(a[1],10),right:parseInt(a[2],10),bottom:parseInt(a[3],10),left:parseInt(a[4],10)}:null},J.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=N(this.css("backgroundImage")))},J.prototype.cssList=function(a,b){var c=(this.css(a)||"").split(",");return c=c[b||0]||c[0]||"auto",c=c.trim().split(" "),1===c.length&&(c=[c[0],M(c[0])?"auto":c[0]]),c},J.prototype.parseBackgroundSize=function(a,b,c){var d,e,f=this.cssList("backgroundSize",c);if(M(f[0]))d=a.width*parseFloat(f[0])/100;else{if(/contain|cover/.test(f[0])){var g=a.width/a.height,h=b.width/b.height;return h>g^"contain"===f[0]?{width:a.height*h,height:a.height}:{width:a.width,height:a.width/h}}d=parseInt(f[0],10)}return e="auto"===f[0]&&"auto"===f[1]?b.height:"auto"===f[1]?d/b.width*b.height:M(f[1])?a.height*parseFloat(f[1])/100:parseInt(f[1],10),"auto"===f[0]&&(d=e/b.height*b.width),{width:d,height:e}},J.prototype.parseBackgroundPosition=function(a,b,c,d){var e,f,g=this.cssList("backgroundPosition",c);return e=M(g[0])?(a.width-(d||b).width)*(parseFloat(g[0])/100):parseInt(g[0],10),f="auto"===g[1]?e/b.width*b.height:M(g[1])?(a.height-(d||b).height)*parseFloat(g[1])/100:parseInt(g[1],10),"auto"===g[0]&&(e=f/b.height*b.width),{left:e,top:f}},J.prototype.parseBackgroundRepeat=function(a){return this.cssList("backgroundRepeat",a)[0]},J.prototype.parseTextShadows=function(){var a=this.css("textShadow"),b=[];if(a&&"none"!==a)for(var c=a.match(this.TEXT_SHADOW_PROPERTY),d=0;c&&d<c.length;d++){var e=c[d].match(this.TEXT_SHADOW_VALUES);b.push({color:new z(e[0]),offsetX:e[1]?parseFloat(e[1].replace("px","")):0,offsetY:e[2]?parseFloat(e[2].replace("px","")):0,blur:e[3]?e[3].replace("px",""):0})}return b},J.prototype.parseTransform=function(){if(!this.transformData)if(this.hasTransform()){var a=this.parseBounds(),b=this.prefixedCss("transformOrigin").split(" ").map(O).map(P);b[0]+=a.left,b[1]+=a.top,this.transformData={origin:b,matrix:this.parseTransformMatrix()}}else this.transformData={origin:[0,0],matrix:[1,0,0,1,0,0]};return this.transformData},J.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var a=this.prefixedCss("transform"),b=a?L(a.match(this.MATRIX_PROPERTY)):null;this.transformMatrix=b||[1,0,0,1,0,0]}return this.transformMatrix},J.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?R(this.node):Q(this.node))},J.prototype.hasTransform=function(){return"1,0,0,1,0,0"!==this.parseTransformMatrix().join(",")||this.parent&&this.parent.hasTransform()},J.prototype.getValue=function(){var a=this.node.value||"";return"SELECT"===this.node.tagName?a=K(this.node):"password"===this.node.type&&(a=Array(a.length+1).join("")),0===a.length?this.node.placeholder||"":a},J.prototype.MATRIX_PROPERTY=/(matrix)\((.+)\)/,J.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,J.prototype.TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g,J.prototype.CLIP=/^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/,S.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(a){if(oa(a)){pa(a)&&a.appendToDOM(),a.borders=this.parseBorders(a);var b="hidden"===a.css("overflow")?[a.borders.clip]:[],c=a.parseClip();c&&-1!==["absolute","fixed"].indexOf(a.css("position"))&&b.push([["rect",a.bounds.left+c.left,a.bounds.top+c.top,c.right-c.left,c.bottom-c.top]]),a.clip=T(a)?a.parent.clip.concat(b):b,a.backgroundClip="hidden"!==a.css("overflow")?a.clip.concat([a.borders.clip]):a.clip,pa(a)&&a.cleanDOM()}else qa(a)&&(a.clip=T(a)?a.parent.clip:[]);pa(a)||(a.bounds=null)},this)},S.prototype.asyncRenderer=function(a,b,c){c=c||Date.now(),this.paint(a[this.renderIndex++]),a.length===this.renderIndex?b():c+20>Date.now()?this.asyncRenderer(a,b,c):setTimeout(ta(function(){this.asyncRenderer(a,b)},this),0)},S.prototype.createPseudoHideStyles=function(a){this.createStyles(a,"."+Ia.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: "" !important; display: none !important; }.'+Ia.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: "" !important; display: none !important; }')},S.prototype.disableAnimations=function(a){this.createStyles(a,"* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")},S.prototype.createStyles=function(a,b){var c=a.createElement("style");c.innerHTML=b,a.body.appendChild(c)},S.prototype.getPseudoElements=function(a){var b=[[a]];if(a.node.nodeType===Node.ELEMENT_NODE){var c=this.getPseudoElement(a,":before"),d=this.getPseudoElement(a,":after");c&&b.push(c),d&&b.push(d)}return xa(b)},S.prototype.getPseudoElement=function(a,c){var d=a.computedStyle(c);if(!d||!d.content||"none"===d.content||"-moz-alt-content"===d.content||"none"===d.display)return null;for(var e=ya(d.content),f="url"===e.substr(0,3),g=b.createElement(f?"img":"html2canvaspseudoelement"),h=new Ia(g,a,c),i=d.length-1;i>=0;i--){var j=U(d.item(i));g.style[j]=d[j]}if(g.className=Ia.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+Ia.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER,f)return g.src=N(e)[0].args[0],[h];var k=b.createTextNode(e);return g.appendChild(k),[h,new Pa(k,h)]},S.prototype.getChildren=function(a){return xa([].filter.call(a.node.childNodes,ia).map(function(b){var c=[b.nodeType===Node.TEXT_NODE?new Pa(b,a):new J(b,a)].filter(wa);return b.nodeType===Node.ELEMENT_NODE&&c.length&&"TEXTAREA"!==b.tagName?c[0].isElementVisible()?c.concat(this.getChildren(c[0])):[]:c},this))},S.prototype.newStackingContext=function(a,b){var c=new Ka(b,a.getOpacity(),a.node,a.parent);a.cloneTo(c),(b?c.getParentStack(this):c.parent.stack).contexts.push(c),a.stack=c},S.prototype.createStackingContexts=function(){this.nodes.forEach(function(a){oa(a)&&(this.isRootElement(a)||sa(a)||ja(a)||this.isBodyWithTransparentRoot(a)||a.hasTransform())?this.newStackingContext(a,!0):oa(a)&&(ka(a)&&ca(a)||ma(a)||la(a))?this.newStackingContext(a,!1):a.assignStack(a.parent.stack)},this)},S.prototype.isBodyWithTransparentRoot=function(a){return"BODY"===a.node.nodeName&&a.parent.color("backgroundColor").isTransparent()},S.prototype.isRootElement=function(a){return null===a.parent},S.prototype.sortStackingContexts=function(a){a.contexts.sort(ra(a.contexts.slice(0))),a.contexts.forEach(this.sortStackingContexts,this)},S.prototype.parseTextBounds=function(a){return function(b,c,d){if("none"!==a.parent.css("textDecoration").substr(0,4)||0!==b.trim().length){if(this.support.rangeBounds&&!a.parent.hasTransform()){var e=d.slice(0,c).join("").length;return this.getRangeBounds(a.node,e,b.length)}if(a.node&&"string"==typeof a.node.data){var f=a.node.splitText(b.length),g=this.getWrapperBounds(a.node,a.parent.hasTransform());return a.node=f,g}}else(!this.support.rangeBounds||a.parent.hasTransform())&&(a.node=a.node.splitText(b.length));return{}}},S.prototype.getWrapperBounds=function(a,b){var c=a.ownerDocument.createElement("html2canvaswrapper"),d=a.parentNode,e=a.cloneNode(!0);c.appendChild(a.cloneNode(!0)),d.replaceChild(c,a);var f=b?R(c):Q(c);return d.replaceChild(e,c),f},S.prototype.getRangeBounds=function(a,b,c){var d=this.range||(this.range=a.ownerDocument.createRange());return d.setStart(a,b),d.setEnd(a,b+c),d.getBoundingClientRect()},S.prototype.parse=function(a){var b=a.contexts.filter(aa),c=a.children.filter(oa),d=c.filter(na(la)),e=d.filter(na(ka)).filter(na(da)),f=c.filter(na(ka)).filter(la),g=d.filter(na(ka)).filter(da),h=a.contexts.concat(d.filter(ka)).filter(ca),i=a.children.filter(qa).filter(fa),j=a.contexts.filter(ba);b.concat(e).concat(f).concat(g).concat(h).concat(i).concat(j).forEach(function(a){this.renderQueue.push(a),ea(a)&&(this.parse(a),this.renderQueue.push(new V))},this)},S.prototype.paint=function(a){try{a instanceof V?this.renderer.ctx.restore():qa(a)?(pa(a.parent)&&a.parent.appendToDOM(),this.paintText(a),pa(a.parent)&&a.parent.cleanDOM()):this.paintNode(a)}catch(a){if(I(a),this.options.strict)throw a}},S.prototype.paintNode=function(a){ea(a)&&(this.renderer.setOpacity(a.opacity),this.renderer.ctx.save(),a.hasTransform()&&this.renderer.setTransform(a.parseTransform())),"INPUT"===a.node.nodeName&&"checkbox"===a.node.type?this.paintCheckbox(a):"INPUT"===a.node.nodeName&&"radio"===a.node.type?this.paintRadio(a):this.paintElement(a)},S.prototype.paintElement=function(a){var b=a.parseBounds();this.renderer.clip(a.backgroundClip,function(){this.renderer.renderBackground(a,b,a.borders.borders.map(va))},this),this.renderer.clip(a.clip,function(){this.renderer.renderBorders(a.borders.borders)},this),this.renderer.clip(a.backgroundClip,function(){switch(a.node.nodeName){case"svg":case"IFRAME":var c=this.images.get(a.node);c?this.renderer.renderImage(a,b,a.borders,c):I("Error loading <"+a.node.nodeName+">",a.node);break;case"IMG":var d=this.images.get(a.node.src);d?this.renderer.renderImage(a,b,a.borders,d):I("Error loading <img>",a.node.src);break;case"CANVAS":this.renderer.renderImage(a,b,a.borders,{image:a.node});break;case"SELECT":case"INPUT":case"TEXTAREA":this.paintFormValue(a)}},this)},S.prototype.paintCheckbox=function(a){var b=a.parseBounds(),c=Math.min(b.width,b.height),d={width:c-1,height:c-1,top:b.top,left:b.left},e=[3,3],f=[e,e,e,e],g=[1,1,1,1].map(function(a){return{color:new z("#A5A5A5"),width:a}}),h=Y(d,f,g);this.renderer.clip(a.backgroundClip,function(){this.renderer.rectangle(d.left+1,d.top+1,d.width-2,d.height-2,new z("#DEDEDE")),this.renderer.renderBorders(W(g,d,h,f)),a.node.checked&&(this.renderer.font(new z("#424242"),"normal","normal","bold",c-3+"px","arial"),this.renderer.text("",d.left+c/6,d.top+c-1))},this)},S.prototype.paintRadio=function(a){var b=a.parseBounds(),c=Math.min(b.width,b.height)-2;this.renderer.clip(a.backgroundClip,function(){this.renderer.circleStroke(b.left+1,b.top+1,c,new z("#DEDEDE"),1,new z("#A5A5A5")),a.node.checked&&this.renderer.circle(Math.ceil(b.left+c/4)+1,Math.ceil(b.top+c/4)+1,Math.floor(c/2),new z("#424242"))},this)},S.prototype.paintFormValue=function(a){var b=a.getValue();if(b.length>0){var c=a.node.ownerDocument,d=c.createElement("html2canvaswrapper");["lineHeight","textAlign","fontFamily","fontWeight","fontSize","color","paddingLeft","paddingTop","paddingRight","paddingBottom","width","height","borderLeftStyle","borderTopStyle","borderLeftWidth","borderTopWidth","boxSizing","whiteSpace","wordWrap"].forEach(function(b){try{d.style[b]=a.css(b)}catch(a){I("html2canvas: Parse: Exception caught in renderFormValue: "+a.message)}});var e=a.parseBounds();d.style.position="fixed",d.style.left=e.left+"px",d.style.top=e.top+"px",d.textContent=b,c.body.appendChild(d),this.paintText(new Pa(d.firstChild,a)),c.body.removeChild(d)}},S.prototype.paintText=function(b){b.applyTextTransform();var c=a.html2canvas.punycode.ucs2.decode(b.node.data),d=this.options.letterRendering&&!ga(b)||Ba(b.node.data)?c.map(function(b){return a.html2canvas.punycode.ucs2.encode([b])}):za(c),e=b.parent.fontWeight(),f=b.parent.css("fontSize"),g=b.parent.css("fontFamily"),h=b.parent.parseTextShadows();this.renderer.font(b.parent.color("color"),b.parent.css("fontStyle"),b.parent.css("fontVariant"),e,f,g),h.length?this.renderer.fontShadow(h[0].color,h[0].offsetX,h[0].offsetY,h[0].blur):this.renderer.clearShadow(),this.renderer.clip(b.parent.clip,function(){d.map(this.parseTextBounds(b),this).forEach(function(a,c){a&&(this.renderer.text(d[c],a.left,a.bottom),this.renderTextDecoration(b.parent,a,this.fontMetrics.getMetrics(g,f)))},this)},this)},S.prototype.renderTextDecoration=function(a,b,c){switch(a.css("textDecoration").split(" ")[0]){case"underline":this.renderer.rectangle(b.left,Math.round(b.top+c.baseline+c.lineWidth),b.width,1,a.color("color"));break;case"overline":this.renderer.rectangle(b.left,Math.round(b.top),b.width,1,a.color("color"));break;case"line-through":this.renderer.rectangle(b.left,Math.ceil(b.top+c.middle+c.lineWidth),b.width,1,a.color("color"))}};var cb={inset:[["darken",.6],["darken",.1],["darken",.1],["darken",.6]]};S.prototype.parseBorders=function(a){var b=a.parseBounds(),c=ha(a),d=["Top","Right","Bottom","Left"].map(function(b,c){var d=a.css("border"+b+"Style"),e=a.color("border"+b+"Color");"inset"===d&&e.isBlack()&&(e=new z([255,255,255,e.a]));var f=cb[d]?cb[d][c]:null;return{width:a.cssInt("border"+b+"Width"),color:f?e[f[0]](f[1]):e,args:null}}),e=Y(b,c,d);return{clip:this.parseBackgroundClip(a,e,d,c,b),borders:W(d,b,e,c)}},S.prototype.parseBackgroundClip=function(a,b,c,d,e){var f=a.css("backgroundClip"),g=[];switch(f){case"content-box":case"padding-box":_(g,d[0],d[1],b.topLeftInner,b.topRightInner,e.left+c[3].width,e.top+c[0].width),_(g,d[1],d[2],b.topRightInner,b.bottomRightInner,e.left+e.width-c[1].width,e.top+c[0].width),_(g,d[2],d[3],b.bottomRightInner,b.bottomLeftInner,e.left+e.width-c[1].width,e.top+e.height-c[2].width),_(g,d[3],d[0],b.bottomLeftInner,b.topLeftInner,e.left+c[3].width,e.top+e.height-c[2].width);break;default:_(g,d[0],d[1],b.topLeftOuter,b.topRightOuter,e.left,e.top),_(g,d[1],d[2],b.topRightOuter,b.bottomRightOuter,e.left+e.width,e.top),_(g,d[2],d[3],b.bottomRightOuter,b.bottomLeftOuter,e.left+e.width,e.top+e.height),_(g,d[3],d[0],b.bottomLeftOuter,b.topLeftOuter,e.left,e.top+e.height)}return g};var db=0,eb="withCredentials"in new XMLHttpRequest,fb="crossOrigin"in new Image;Ia.prototype.cloneTo=function(a){Ia.prototype.cloneTo.call(this,a),a.isPseudoElement=!0,a.before=this.before},Ia.prototype=Object.create(J.prototype),Ia.prototype.appendToDOM=function(){this.before?this.parent.node.insertBefore(this.node,this.parent.node.firstChild):this.parent.node.appendChild(this.node),this.parent.node.className+=" "+this.getHideClass()},Ia.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node),this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),"")},Ia.prototype.getHideClass=function(){return this["PSEUDO_HIDE_ELEMENT_CLASS_"+(this.before?"BEFORE":"AFTER")]},Ia.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before",Ia.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after",Ja.prototype.renderImage=function(a,b,c,d){var e=a.cssInt("paddingLeft"),f=a.cssInt("paddingTop"),g=a.cssInt("paddingRight"),h=a.cssInt("paddingBottom"),i=c.borders,j=b.width-(i[1].width+i[3].width+e+g),k=b.height-(i[0].width+i[2].width+f+h);this.drawImage(d,0,0,d.image.width||j,d.image.height||k,b.left+e+i[3].width,b.top+f+i[0].width,j,k)},Ja.prototype.renderBackground=function(a,b,c){b.height>0&&b.width>0&&(this.renderBackgroundColor(a,b),this.renderBackgroundImage(a,b,c))},Ja.prototype.renderBackgroundColor=function(a,b){var c=a.color("backgroundColor");c.isTransparent()||this.rectangle(b.left,b.top,b.width,b.height,c)},Ja.prototype.renderBorders=function(a){a.forEach(this.renderBorder,this)},Ja.prototype.renderBorder=function(a){a.color.isTransparent()||null===a.args||this.drawShape(a.args,a.color)},Ja.prototype.renderBackgroundImage=function(a,b,c){a.parseBackgroundImages().reverse().forEach(function(d,e,f){switch(d.method){case"url":var g=this.images.get(d.args[0]);g?this.renderBackgroundRepeating(a,b,g,f.length-(e+1),c):I("Error loading background-image",d.args[0]);break;case"linear-gradient":case"gradient":var h=this.images.get(d.value);h?this.renderBackgroundGradient(h,b,c):I("Error loading background-image",d.args[0]);break;case"none":break;default:I("Unknown background-image type",d.args[0])}},this)},Ja.prototype.renderBackgroundRepeating=function(a,b,c,d,e){var f=a.parseBackgroundSize(b,c.image,d),g=a.parseBackgroundPosition(b,c.image,d,f);switch(a.parseBackgroundRepeat(d)){case"repeat-x":case"repeat no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+e[3],b.top+g.top+e[0],99999,f.height,e);break;case"repeat-y":case"no-repeat repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+e[3],b.top+e[0],f.width,99999,e);break;case"no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+e[3],b.top+g.top+e[0],f.width,f.height,e);break;default:this.renderBackgroundRepeat(c,g,f,{top:b.top,left:b.left},e[3],e[0])}},Ka.prototype=Object.create(J.prototype),Ka.prototype.getParentStack=function(a){var b=this.parent?this.parent.stack:null;return b?b.ownStacking?b:b.getParentStack(a):a.stack},La.prototype.testRangeBounds=function(a){var b,c,d,e,f=!1;return a.createRange&&(b=a.createRange(),b.getBoundingClientRect&&(c=a.createElement("boundtest"),c.style.height="123px",c.style.display="block",a.body.appendChild(c),b.selectNode(c),d=b.getBoundingClientRect(),e=d.height,123===e&&(f=!0),a.body.removeChild(c))),f},La.prototype.testCORS=function(){return void 0!==(new Image).crossOrigin},La.prototype.testSVG=function(){var a=new Image,c=b.createElement("canvas"),d=c.getContext("2d");a.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{d.drawImage(a,0,0),c.toDataURL()}catch(a){return!1}return!0},Ma.prototype.hasFabric=function(){return html2canvas.fabric?Promise.resolve():Promise.reject(new Error("html2canvas.svg.js is not loaded, cannot render svg"))},Ma.prototype.inlineFormatting=function(a){return/^data:image\/svg\+xml;base64,/.test(a)?this.decode64(this.removeContentType(a)):this.removeContentType(a)},Ma.prototype.removeContentType=function(a){return a.replace(/^data:image\/svg\+xml(;base64)?,/,"")},Ma.prototype.isInline=function(a){return/^data:image\/svg\+xml/i.test(a)},Ma.prototype.createCanvas=function(a){var b=this;return function(c,d){var e=new html2canvas.fabric.StaticCanvas("c");b.image=e.lowerCanvasEl,e.setWidth(d.width).setHeight(d.height).add(html2canvas.fabric.util.groupSVGElements(c,d)).renderAll(),a(e.lowerCanvasEl)}},Ma.prototype.decode64=function(b){return"function"==typeof a.atob?a.atob(b):Na(b)},Oa.prototype=Object.create(Ma.prototype),Pa.prototype=Object.create(J.prototype),Pa.prototype.applyTextTransform=function(){this.node.data=this.transform(this.parent.css("textTransform"))},Pa.prototype.transform=function(a){var b=this.node.data;switch(a){case"lowercase":return b.toLowerCase();case"capitalize":return b.replace(/(^|\s|:|-|\(|\))([a-z])/g,Qa);case"uppercase":return b.toUpperCase();default:return b}},Ra.prototype=Object.create(E.prototype),Ta.prototype=Object.create(Ja.prototype),Ta.prototype.setFillStyle=function(a){return this.ctx.fillStyle="object"==typeof a&&a.isColor?a.toString():a,this.ctx},Ta.prototype.rectangle=function(a,b,c,d,e){this.setFillStyle(e).fillRect(a,b,c,d)},Ta.prototype.circle=function(a,b,c,d){this.setFillStyle(d),this.ctx.beginPath(),this.ctx.arc(a+c/2,b+c/2,c/2,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill()},Ta.prototype.circleStroke=function(a,b,c,d,e,f){this.circle(a,b,c,d),this.ctx.strokeStyle=f.toString(),this.ctx.stroke()},Ta.prototype.drawShape=function(a,b){this.shape(a),this.setFillStyle(b).fill()},Ta.prototype.taints=function(a){if(null===a.tainted){this.taintCtx.drawImage(a.image,0,0);try{this.taintCtx.getImageData(0,0,1,1),a.tainted=!1}catch(c){this.taintCtx=b.createElement("canvas").getContext("2d"),a.tainted=!0}}return a.tainted},Ta.prototype.drawImage=function(a,b,c,d,e,f,g,h,i){(!this.taints(a)||this.options.allowTaint)&&this.ctx.drawImage(a.image,b,c,d,e,f,g,h,i)},Ta.prototype.clip=function(a,b,c){this.ctx.save(),a.filter(Ua).forEach(function(a){this.shape(a).clip()},this),b.call(c),this.ctx.restore()},Ta.prototype.shape=function(a){return this.ctx.beginPath(),a.forEach(function(a,b){"rect"===a[0]?this.ctx.rect.apply(this.ctx,a.slice(1)):this.ctx[0===b?"moveTo":a[0]+"To"].apply(this.ctx,a.slice(1))},this),this.ctx.closePath(),this.ctx},Ta.prototype.font=function(a,b,c,d,e,f){this.setFillStyle(a).font=[b,c,d,e,f].join(" ").split(",")[0]},Ta.prototype.fontShadow=function(a,b,c,d){this.setVariable("shadowColor",a.toString()).setVariable("shadowOffsetY",b).setVariable("shadowOffsetX",c).setVariable("shadowBlur",d)},Ta.prototype.clearShadow=function(){this.setVariable("shadowColor","rgba(0,0,0,0)")},Ta.prototype.setOpacity=function(a){this.ctx.globalAlpha=a},Ta.prototype.setTransform=function(a){this.ctx.translate(a.origin[0],a.origin[1]),this.ctx.transform.apply(this.ctx,a.matrix),this.ctx.translate(-a.origin[0],-a.origin[1])},Ta.prototype.setVariable=function(a,b){return this.variables[a]!==b&&(this.variables[a]=this.ctx[a]=b),this},Ta.prototype.text=function(a,b,c){this.ctx.fillText(a,b,c)},Ta.prototype.backgroundRepeatShape=function(a,b,c,d,e,f,g,h,i){var j=[["line",Math.round(e),Math.round(f)],["line",Math.round(e+g),Math.round(f)],["line",Math.round(e+g),Math.round(h+f)],["line",Math.round(e),Math.round(h+f)]];this.clip([j],function(){this.renderBackgroundRepeat(a,b,c,d,i[3],i[0])},this)},Ta.prototype.renderBackgroundRepeat=function(a,b,c,d,e,f){var g=Math.round(d.left+b.left+e),h=Math.round(d.top+b.top+f);this.setFillStyle(this.ctx.createPattern(this.resizeImage(a,c),"repeat")),this.ctx.translate(g,h),this.ctx.fill(),this.ctx.translate(-g,-h)},Ta.prototype.renderBackgroundGradient=function(a,b){if(a instanceof H){var c=this.ctx.createLinearGradient(b.left+b.width*a.x0,b.top+b.height*a.y0,b.left+b.width*a.x1,b.top+b.height*a.y1);a.colorStops.forEach(function(a){c.addColorStop(a.stop,a.color.toString())}),this.rectangle(b.left,b.top,b.width,b.height,c)}},Ta.prototype.resizeImage=function(a,c){var d=a.image;if(d.width===c.width&&d.height===c.height)return d;var e,f=b.createElement("canvas");return f.width=c.width,f.height=c.height,e=f.getContext("2d"),e.drawImage(d,0,0,d.width,d.height,0,0,c.width,c.height),f}}.call({},"undefined"!=typeof window?window:void 0,"undefined"!=typeof document?document:void 0),"undefined"==typeof jQuery)throw new Error("Bootstrap requires jQuery");+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]}}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one(a.support.transition.end,function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b()})}(window.jQuery),function(a){"use strict";var b='[data-dismiss="alert"]',c=function(c){a(c).on("click",b,this.close)};c.prototype.close=function(b){function c(){f.trigger("closed.bs.alert").remove()}var d=a(this),e=d.attr("data-target");e||(e=d.attr("href"),e=e&&e.replace(/.*(?=#[^\s]*$)/,""));var f=a(e);b&&b.preventDefault(),f.length||(f=d.hasClass("alert")?d:d.parent()),f.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one(a.support.transition.end,c).emulateTransitionEnd(150):c())};var d=a.fn.alert;a.fn.alert=function(b){return this.each(function(){var d=a(this),e=d.data("bs.alert");e||d.data("bs.alert",e=new c(this)),"string"==typeof b&&e[b].call(d)})},a.fn.alert.Constructor=c,a.fn.alert.noConflict=function(){return a.fn.alert=d,this},a(document).on("click.bs.alert.data-api",b,c.prototype.close)}(window.jQuery),function(a){"use strict";var b=function(c,d){this.$element=a(c),this.options=a.extend({},b.DEFAULTS,d)};b.DEFAULTS={loadingText:"loading..."},b.prototype.setState=function(a){var b="disabled",c=this.$element,d=c.is("input")?"val":"html",e=c.data();a+="Text",e.resetText||c.data("resetText",c[d]()),c[d](e[a]||this.options[a]),setTimeout(function(){"loadingText"==a?c.addClass(b).attr(b,b):c.removeClass(b).removeAttr(b)},0)},b.prototype.toggle=function(){var a=this.$element.closest('[data-toggle="buttons"]');if(a.length){"radio"===this.$element.find("input").prop("checked",!this.$element.hasClass("active")).trigger("change").prop("type")&&a.find(".active").removeClass("active")}this.$element.toggleClass("active")};var c=a.fn.button;a.fn.button=function(c){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof c&&c;e||d.data("bs.button",e=new b(this,f)),"toggle"==c?e.toggle():c&&e.setState(c)})},a.fn.button.Constructor=b,a.fn.button.noConflict=function(){return a.fn.button=c,this},a(document).on("click.bs.button.data-api","[data-toggle^=button]",function(b){var c=a(b.target);c.hasClass("btn")||(c=c.closest(".btn")),c.button("toggle"),b.preventDefault()})}(window.jQuery),function(a){"use strict";var b=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",a.proxy(this.pause,this)).on("mouseleave",a.proxy(this.cycle,this))};b.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},b.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},b.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},b.prototype.to=function(b){var c=this,d=this.getActiveIndex();return b>this.$items.length-1||0>b?void 0:this.sliding?this.$element.one("slid",function(){c.to(b)}):d==b?this.pause().cycle():this.slide(b>d?"next":"prev",a(this.$items[b]))},b.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition.end&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},b.prototype.next=function(){return this.sliding?void 0:this.slide("next")},b.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},b.prototype.slide=function(b,c){var d=this.$element.find(".item.active"),e=c||d[b](),f=this.interval,g="next"==b?"left":"right",h="next"==b?"first":"last",i=this;if(!e.length){if(!this.options.wrap)return;e=this.$element.find(".item")[h]()}this.sliding=!0,f&&this.pause();var j=a.Event("slide.bs.carousel",{relatedTarget:e[0],direction:g});if(!e.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var b=a(i.$indicators.children()[i.getActiveIndex()]);b&&b.addClass("active")})),a.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(j),j.isDefaultPrevented())return;e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),d.one(a.support.transition.end,function(){e.removeClass([b,g].join(" ")).addClass("active"),d.removeClass(["active",g].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger("slid")},0)}).emulateTransitionEnd(600)}else{if(this.$element.trigger(j),j.isDefaultPrevented())return;d.removeClass("active"),e.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return f&&this.cycle(),this}};var c=a.fn.carousel;a.fn.carousel=function(c){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},b.DEFAULTS,d.data(),"object"==typeof c&&c),g="string"==typeof c?c:f.slide;e||d.data("bs.carousel",e=new b(this,f)),"number"==typeof c?e.to(c):g?e[g]():f.interval&&e.pause().cycle()})},a.fn.carousel.Constructor=b,a.fn.carousel.noConflict=function(){return a.fn.carousel=c,this},a(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(b){var c,d=a(this),e=a(d.attr("data-target")||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"")),f=a.extend({},e.data(),d.data()),g=d.attr("data-slide-to");g&&(f.interval=!1),e.carousel(f),(g=d.attr("data-slide-to"))&&e.data("bs.carousel").to(g),b.preventDefault()}),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var b=a(this);b.carousel(b.data())})})}(window.jQuery),function(a){"use strict";var b=function(c,d){this.$element=a(c),this.options=a.extend({},b.DEFAULTS,d),this.transitioning=null,this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};b.DEFAULTS={toggle:!0},b.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},b.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b=a.Event("show.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.$parent&&this.$parent.find("> .panel > .in");if(c&&c.length){var d=c.data("bs.collapse");if(d&&d.transitioning)return;c.collapse("hide"),d||c.data("bs.collapse",null)}var e=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[e](0),this.transitioning=1;var f=function(){this.$element.removeClass("collapsing").addClass("in")[e]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return f.call(this);var g=a.camelCase(["scroll",e].join("-"));this.$element.one(a.support.transition.end,a.proxy(f,this)).emulateTransitionEnd(350)[e](this.$element[0][g])}}},b.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var d=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return a.support.transition?void this.$element[c](0).one(a.support.transition.end,a.proxy(d,this)).emulateTransitionEnd(350):d.call(this)}}},b.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var c=a.fn.collapse;a.fn.collapse=function(c){return this.each(function(){var d=a(this),e=d.data("bs.collapse"),f=a.extend({},b.DEFAULTS,d.data(),"object"==typeof c&&c);e||d.data("bs.collapse",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.collapse.Constructor=b,a.fn.collapse.noConflict=function(){return a.fn.collapse=c,this},a(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(b){var c,d=a(this),e=d.attr("data-target")||b.preventDefault()||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),f=a(e),g=f.data("bs.collapse"),h=g?"toggle":d.data(),i=d.attr("data-parent"),j=i&&a(i);g&&g.transitioning||(j&&j.find('[data-toggle=collapse][data-parent="'+i+'"]').not(d).addClass("collapsed"),d[f.hasClass("in")?"addClass":"removeClass"]("collapsed")),f.collapse(h)})}(window.jQuery),function(a){"use strict";function b(){a(d).remove(),a(e).each(function(b){var d=c(a(this));d.hasClass("open")&&(d.trigger(b=a.Event("hide.bs.dropdown")),b.isDefaultPrevented()||d.removeClass("open").trigger("hidden.bs.dropdown"))})}function c(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}var d=".dropdown-backdrop",e="[data-toggle=dropdown]",f=function(b){a(b).on("click.bs.dropdown",this.toggle)};f.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=c(e),g=f.hasClass("open");if(b(),!g){if("ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",b),f.trigger(d=a.Event("show.bs.dropdown")),d.isDefaultPrevented())return;f.toggleClass("open").trigger("shown.bs.dropdown"),e.focus()}return!1}},f.prototype.keydown=function(b){if(/(38|40|27)/.test(b.keyCode)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var f=c(d),g=f.hasClass("open");if(!g||g&&27==b.keyCode)return 27==b.which&&f.find(e).focus(),d.click();var h=a("[role=menu] li:not(.divider):visible a",f);if(h.length){var i=h.index(h.filter(":focus"));38==b.keyCode&&i>0&&i--,40==b.keyCode&&i<h.length-1&&i++,~i||(i=0),h.eq(i).focus()}}}};var g=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("dropdown");d||c.data("dropdown",d=new f(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=f,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=g,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",e,f.prototype.toggle).on("keydown.bs.dropdown.data-api",e+", [role=menu]",f.prototype.keydown)}(window.jQuery),function(a){"use strict";var b=function(b,c){this.options=c,this.$element=a(b),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.load(this.options.remote)};b.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},b.prototype.toggle=function(a){return this[this.isShown?"hide":"show"](a)},b.prototype.show=function(b){var c=this,d=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(d),this.isShown||d.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var d=a.support.transition&&c.$element.hasClass("fade");c.$element.parent().length||c.$element.appendTo(document.body),c.$element.show(),d&&c.$element[0].offsetWidth,c.$element.addClass("in").attr("aria-hidden",!1),c.enforceFocus();var e=a.Event("shown.bs.modal",{relatedTarget:b});d?c.$element.find(".modal-dialog").one(a.support.transition.end,function(){c.$element.focus().trigger(e)}).emulateTransitionEnd(300):c.$element.focus().trigger(e)}))},b.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one(a.support.transition.end,a.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},b.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.focus()},this))},b.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},b.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.removeBackdrop(),a.$element.trigger("hidden.bs.modal")})},b.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},b.prototype.backdrop=function(b){var c=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var d=a.support.transition&&c;if(this.$backdrop=a('<div class="modal-backdrop '+c+'" />').appendTo(document.body),this.$element.on("click.dismiss.modal",a.proxy(function(a){a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),d&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;d?this.$backdrop.one(a.support.transition.end,b).emulateTransitionEnd(150):b()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,b).emulateTransitionEnd(150):b()):b&&b()};var c=a.fn.modal;a.fn.modal=function(c,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},b.DEFAULTS,e.data(),"object"==typeof c&&c);f||e.data("bs.modal",f=new b(this,g)),"string"==typeof c?f[c](d):g.show&&f.show(d)})},a.fn.modal.Constructor=b,a.fn.modal.noConflict=function(){return a.fn.modal=c,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d=c.attr("href"),e=a(c.attr("data-target")||d&&d.replace(/.*(?=#[^\s]+$)/,"")),f=e.data("modal")?"toggle":a.extend({remote:!/#/.test(d)&&d},e.data(),c.data());b.preventDefault(),e.modal(f,this).one("hide",function(){c.is(":visible")&&c.focus()})}),a(document).on("show.bs.modal",".modal",function(){a(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){a(document.body).removeClass("modal-open")})}(window.jQuery),function(a){"use strict";var b=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};b.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},b.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focus",i="hover"==g?"mouseleave":"blur";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},b.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},b.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show()},b.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},b.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(b),b.isDefaultPrevented())return;var c=this.tip();this.setContent(),this.options.animation&&c.addClass("fade");var d="function"==typeof this.options.placement?this.options.placement.call(this,c[0],this.$element[0]):this.options.placement,e=/\s?auto?\s?/i,f=e.test(d);f&&(d=d.replace(e,"")||"top"),c.detach().css({top:0,left:0,display:"block"}).addClass(d),this.options.container?c.appendTo(this.options.container):c.insertAfter(this.$element);var g=this.getPosition(),h=c[0].offsetWidth,i=c[0].offsetHeight;if(f){var j=this.$element.parent(),k=d,l=document.documentElement.scrollTop||document.body.scrollTop,m="body"==this.options.container?window.innerWidth:j.outerWidth(),n="body"==this.options.container?window.innerHeight:j.outerHeight(),o="body"==this.options.container?0:j.offset().left;d="bottom"==d&&g.top+g.height+i-l>n?"top":"top"==d&&g.top-l-i<0?"bottom":"right"==d&&g.right+h>m?"left":"left"==d&&g.left-h<o?"right":d,c.removeClass(k).addClass(d)}var p=this.getCalculatedOffset(d,g,h,i);this.applyPlacement(p,d),this.$element.trigger("shown.bs."+this.type)}},b.prototype.applyPlacement=function(a,b){var c,d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),a.top=a.top+g,a.left=a.left+h,d.offset(a).addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;if("top"==b&&j!=f&&(c=!0,a.top=a.top+f-j),/bottom|top/.test(b)){var k=0;a.left<0&&(k=-2*a.left,a.left=0,d.offset(a),i=d[0].offsetWidth,j=d[0].offsetHeight),this.replaceArrow(k-e+i,i,"left")}else this.replaceArrow(j-f,j,"top");c&&d.offset(a)},b.prototype.replaceArrow=function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},b.prototype.hide=function(){function b(){"in"!=c.hoverState&&d.detach()}var c=this,d=this.tip(),e=a.Event("hide.bs."+this.type);return this.$element.trigger(e),e.isDefaultPrevented()?void 0:(d.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?d.one(a.support.transition.end,b).emulateTransitionEnd(150):b(),this.$element.trigger("hidden.bs."+this.type),this)},b.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},b.prototype.hasContent=function(){return this.getTitle()},b.prototype.getPosition=function(){var b=this.$element[0];return a.extend({},"function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},b.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},b.prototype.getTitle=function(){var a=this.$element,b=this.options;return a.attr("data-original-title")||("function"==typeof b.title?b.title.call(a[0]):b.title)},b.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},b.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},b.prototype.enable=function(){this.enabled=!0},b.prototype.disable=function(){this.enabled=!1},b.prototype.toggleEnabled=function(){this.enabled=!this.enabled},b.prototype.toggle=function(b){var c=b?a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;c.tip().hasClass("in")?c.leave(c):c.enter(c)},b.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var c=a.fn.tooltip;a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof c&&c;e||d.data("bs.tooltip",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.tooltip.Constructor=b,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=c,this}}(window.jQuery),function(a){"use strict";var b=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");b.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),b.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),b.prototype.constructor=b,b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content")[this.options.html?"html":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},b.prototype.hasContent=function(){return this.getTitle()||this.getContent()},b.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},b.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var c=a.fn.popover;a.fn.popover=function(c){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof c&&c;e||d.data("bs.popover",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.popover.Constructor=b,a.fn.popover.noConflict=function(){return a.fn.popover=c,this}}(window.jQuery),function(a){"use strict";function b(c,d){var e,f=a.proxy(this.process,this);this.$element=a(a(c).is("body")?window:c),this.$body=a("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",f),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||(e=a(c).attr("href"))&&e.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=a([]),this.targets=a([]),this.activeTarget=null,this.refresh(),this.process()}b.DEFAULTS={offset:10},b.prototype.refresh=function(){var b=this.$element[0]==window?"offset":"position";this.offsets=a([]),this.targets=a([]);var c=this;this.$body.find(this.selector).map(function(){var d=a(this),e=d.data("target")||d.attr("href"),f=/^#\w/.test(e)&&a(e);return f&&f.length&&[[f[b]().top+(!a.isWindow(c.$scrollElement.get(0))&&c.$scrollElement.scrollTop()),e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){c.offsets.push(this[0]),c.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,d=c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(b>=d)return g!=(a=f.last()[0])&&this.activate(a);for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,a(this.selector).parents(".active").removeClass("active");var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate")};var c=a.fn.scrollspy;a.fn.scrollspy=function(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=c,this},a(window).on("load",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);b.scrollspy(b.data())})})}(window.jQuery),function(a){"use strict";var b=function(b){this.element=a(b)};b.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a")[0],f=a.Event("show.bs.tab",{relatedTarget:e});if(b.trigger(f),!f.isDefaultPrevented()){var g=a(d);this.activate(b.parent("li"),c),this.activate(g,g.parent(),function(){b.trigger({type:"shown.bs.tab",relatedTarget:e})})}}},b.prototype.activate=function(b,c,d){function e(){f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),g?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var f=c.find("> .active"),g=d&&a.support.transition&&f.hasClass("fade");g?f.one(a.support.transition.end,e).emulateTransitionEnd(150):e(),f.removeClass("in")};var c=a.fn.tab;a.fn.tab=function(c){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new b(this)),"string"==typeof c&&e[c]()})},a.fn.tab.Constructor=b,a.fn.tab.noConflict=function(){return a.fn.tab=c,this},a(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(b){b.preventDefault(),a(this).tab("show")})}(window.jQuery),function(a){"use strict";var b=function(c,d){this.options=a.extend({},b.DEFAULTS,d),this.$window=a(window).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(c),this.affixed=this.unpin=null,this.checkPosition()};b.RESET="affix affix-top affix-bottom",b.DEFAULTS={offset:0},b.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},b.prototype.checkPosition=function(){if(this.$element.is(":visible")){var c=a(document).height(),d=this.$window.scrollTop(),e=this.$element.offset(),f=this.options.offset,g=f.top,h=f.bottom;"object"!=typeof f&&(h=g=f),"function"==typeof g&&(g=f.top()),"function"==typeof h&&(h=f.bottom());var i=!(null!=this.unpin&&d+this.unpin<=e.top)&&(null!=h&&e.top+this.$element.height()>=c-h?"bottom":null!=g&&g>=d&&"top");this.affixed!==i&&(this.unpin&&this.$element.css("top",""),this.affixed=i,this.unpin="bottom"==i?e.top-d:null,this.$element.removeClass(b.RESET).addClass("affix"+(i?"-"+i:"")),"bottom"==i&&this.$element.offset({top:document.body.offsetHeight-h-this.$element.height()}))}};var c=a.fn.affix;a.fn.affix=function(c){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof c&&c;e||d.data("bs.affix",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.affix.Constructor=b,a.fn.affix.noConflict=function(){return a.fn.affix=c,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var b=a(this),c=b.data();c.offset=c.offset||{},c.offsetBottom&&(c.offset.bottom=c.offsetBottom),c.offsetTop&&(c.offset.top=c.offsetTop),b.affix(c)})})}(window.jQuery);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};window.PearsonGL=window.PearsonGL||{},window.PearsonGL.globals=PearsonGL.globals||{},PearsonGL.utils=function(){function a(a){a=a.toLowerCase();var b=/(edge)[ \/]([\w.]+)/.exec(a)||/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}}var b,c=[],d={},e=0,f=!1,g=["Sun","Mon","Tues","Wed","Thurs","Fri","Sat"],h=["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"];return b=a(navigator.userAgent),b.browser&&(d[b.browser]=!0,d.version=b.version),d.chrome?d.webkit=!0:d.webkit&&(d.safari=!0),{keyCode:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,v:86},rootURL:window.location.href,browser:d,mathJaxInstances:e,getGadgetId:function(a){return a?a.split("_").slice(2)[0]:""},getWasIE:function(){return!!(window.XDomainRequest&&this.rootURL.indexOf("http")<0)},encodeSingleAndDoubleQuotes:function(a){var b,c,d;for(b in a)if("object"===_typeof(a[b]))if(a[b].length)for(c=0,il=a[b].length;c<il;c++)this.encodeSingleAndDoubleQuotes(a[b][c]);else for(d in a[b])"string"==typeof a[b][d]?a[b][d]=this.encodeTheJsonString(a[b][d]):this.encodeSingleAndDoubleQuotes(a[b][d]);else"string"==typeof a[b]&&(a[b]=this.encodeTheJsonString(a[b]));return a},encodeTheJsonString:function(a){if(!/<[a-z][\s\S]*>/i.test(a)){var b=new RegExp('\\"',"g"),c=new RegExp("\\'","g"),d=new RegExp("'","g");a=a.replace(b,"&quot;"),a=a.replace(c,"&#39;"),a=a.replace(d,"&#39;")}return a},getXmlHttp:function(a){return void 0!==window.ActiveXObject&&window.location.href.indexOf("http")<0?new ActiveXObject("Microsoft.XMLHTTP"):(window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:void 0!==window.ActiveXObject&&(xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")),null==xmlhttp&&alert("Your browser does not support XMLHTTP."),xmlhttp)},initMathJax:function(a){function b(){$(document).trigger("mathjaxComplete",a),0===--e&&(f=!0)}e++,f=!1;try{MathJax.Hub.Queue(["Typeset",MathJax.Hub,a,b]),MathJax.Hub.Queue(function(){$(".iphone,.ipad,.mac").find(".math-alt-text").each(function(){var a,b,c=$(this).height();if(c>0)for(a=$(this).parent().height(),b=0;b++<100&&c<a;)$(this).html($(this).html()+" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"),c=$(this).height()})})}catch(a){}},iOSMathJaxFix:function(){var a=PearsonGL.globals.player||{},b=a.settings&&a.settings.authoring&&a.settings.authoring.HasMathML;if(PearsonGL.globals.browserData.specialFlags.isiOS&&b){var c=document.body,d=c.style.display;c.style.display="none",c.offsetHeight,c.style.display=d}},enableTranslation:function(){return f},detectZoom:function(){if($("body").hasClass("firefox")){var a=function(a,b,c,d,e,f){function g(c,d,e){var i=(c+d)/2;return e<=0||d-c<f?i:h("("+a+":"+i+b+")").matches?g(i,d,e-1):g(c,i,e-1)}var h=void 0,i=void 0,j=void 0,k=void 0;window.matchMedia?h=window.matchMedia:(i=document.getElementsByTagName("head")[0],j=document.createElement("style"),i.appendChild(j),k=document.createElement("div"),k.className="mediaQueryBinarySearch",k.style.display="none",document.body.appendChild(k),h=function(a){j.sheet.insertRule("@media "+a+"{.mediaQueryBinarySearch {text-decoration: underline} }",0);var b="underline"==getComputedStyle(k,null).textDecoration;return j.sheet.deleteRule(0),{matches:b}});var l=g(c,d,e);return k&&(i.removeChild(j),document.body.removeChild(k)),l},b=a("min--moz-device-pixel-ratio","",0,10,20,1e-4);return b=Math.round(100*b)/100}if($("body").hasClass("edge")){return Math.round(screen.deviceXDPI/screen.logicalXDPI*100)/100}if($("body").hasClass("chrome"))return $("body").hasClass("mac")&&window.devicePixelRatio>=2?window.devicePixelRatio/2:$("body").hasClass("windows")&&window.devicePixelRatio>2?window.devicePixelRatio/2:window.devicePixelRatio;if($("body").hasClass("safari")&&!$("body").hasClass("ipad")){return Math.round(window.outerWidth/window.innerWidth*100)/100}},isDevToolsOpen:function(){var a=window.outerWidth-window.innerWidth>160,b=window.outerHeight-window.innerHeight>160;return!(b&&a||!(window.Firebug&&window.Firebug.chrome&&window.Firebug.chrome.isInitialized||a||b))},getQuerystring:function(a,b,c){null===b&&(b="");try{a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var d=new RegExp("[\\?&]"+a+"=([^&#]*)"),e=c?d.exec(window.top.location.href):d.exec(window.location.href);return null===e?b:"undefined"===e[1]||""===e[1]?b:e[1]}catch(a){return b}},addJavascriptFileToDOM:function(a){var b=document.createElement("script");b.setAttribute("type","text/javascript"),b.setAttribute("src",a),$("head").append(b)},encodeChar:function(a){var b,c,d="";if(void 0!=a&&a.indexOf("&")>-1)return a;for(b=0;b<a.length;++b)c=a.charCodeAt(b),d+=c>=128?"&#"+c+";":a.charAt(b);return d},stripHTML:function(a){return a?jQuery("<div />",{html:a}).text():""},isnot_int:function(a){return isNaN(parseInt(1*a))},randomString:function(a){var b,c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",e=a,f="";for(void 0===a&&(e=5),c=0;c<e;c++)b=Math.floor(Math.random()*d.length),f+=d.substring(b,b+1);return f},shuffleArray:function(a){for(var b,c,d=a.length;d>0;)c=Math.floor(Math.random()*d),d--,b=a[d],a[d]=a[c],a[c]=b;return a},updateChartData:function(a,b,c,d){var e;if(void 0!==a)for(e=0;e<a.length;e++)$(document).trigger("gadget."+a[e],[b,c,d])},updateGadgetData:function(a,b){$(document).trigger("GadgetTrigger",a,b)},focusItemOn:function(a){$(".text-button-focus").removeClass("text-button-focus"),$(a).addClass("text-button-focus")},focusItemOff:function(a){$(a).removeClass("text-button-focus")},rgbColorToHex:function(a){var b,c,d,e;"#"==a.charAt(0)&&(a=a.substr(1,6)),a=a.replace(/ /g,""),a=a.toLowerCase();var f=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}}];for(b=0;b<f.length;b++){var g=f[b].re,h=f[b].process,i=g.exec(a);i&&(channels=h(i),c=channels[0],d=channels[1],e=channels[2])}c=c<0||isNaN(c)?0:c>255?255:c,d=d<0||isNaN(d)?0:d>255?255:d,e=e<0||isNaN(e)?0:e>255?255:e;var j=c.toString(16),k=d.toString(16),l=e.toString(16);return 1==j.length&&(j="0"+j),1==k.length&&(k="0"+k),1==l.length&&(l="0"+l),"#"+j+k+l},isTouch:function(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|edge|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),!!!document.documentMode&&!!window.StyleMedia&&(a=!1),a},browserDetect:function(){var a,b={os:"unknown",osVersion:{major:void 0,minor:void 0,micro:void 0},specialFlags:{isiOS:!1,isiOS8OrGreater:!1,isIE:!1,isAndroid:/Android/i.test(navigator.userAgent)}};$.each(d,function(a){return(navigator.userAgent.match(/Trident\/7\./)||window.navigator.userAgent.indexOf("Edge")>-1)&&(a="msie"),$("body").addClass(a+" ver"+parseInt(d.version,10)),!1}),!(navigator.userAgent.indexOf("Safari")>-1)||d.chrome||d.edge||$("body").addClass("safari"),navigator.userAgent.indexOf("Firefox")>-1&&$("body").addClass("firefox"),window.navigator.userAgent.indexOf("Edge")>-1&&$("body").addClass("edge");var c=["iphone","ipad","windows","mac","linux","android"],e=navigator.appVersion.toLowerCase().match(new RegExp(c.join("|")));return e&&($("body").addClass(e[0]),b.os=e[0],"iphone"!==e[0]&&"ipad"!==e[0]||(a=navigator.appVersion.match(/OS\s+(\d+)_(\d+)_?(\d+)?/),b.osVersion.major=a&&a[1]?parseInt(a[1],10):void 0,b.osVersion.minor=a&&a[2]?parseInt(a[2],10):void 0,b.osVersion.micro=a&&a[3]?parseInt(a[3],10):void 0,b.specialFlags.isiOS=!0,b.specialFlags.isiOS8OrGreater=b.osVersion.major>=8)),b.specialFlags.isIE=window.navigator.userAgent.indexOf("MSIE")>-1||window.navigator.userAgent.indexOf("Trident")>-1,this.isTouch()&&$("body").addClass("touch-supported"),$("body").data("browserData",b),b},getScoId:function(){if(PearsonGL.globals&&PearsonGL.globals.metadata&&PearsonGL.utils.isNonEmptyString(PearsonGL.globals.metadata.scoId))return PearsonGL.globals.metadata.scoId;var a=window.location+"",b=[];return b=a.split("/"),b[b.length-2]},getFormattedDate:function(a){var b,c,d,e;return e=Math.floor(a/1e3),d=Math.floor(e/60),e%=60,c=Math.floor(d/60),d%=60,b=Math.floor(c/24),c%=24,c<10&&(c="0"+c),d<10&&(d="0"+d),e<10&&(e="0"+e),b+"."+c+":"+d+":"+e},getFormattedDateTime:function(a){a=new Date(a);var b=a.getHours(),c=b>=12?"PM":"AM",d=a.getMinutes(),e=a.getSeconds();return b=0===b?12:b,b=b>12?b-12:b,d=(d<10?"0":"")+d,e=(e<10?"0":"")+e,g[a.getDay()]+" "+h[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear()+"  "+b+":"+d+":"+e+" "+c+"  "+Intl.DateTimeFormat().resolvedOptions().timeZone},isNumber:function(a,b,c){var d=a.toString().replace(/,/g,"");return b&&b.length>0&&0===d.indexOf(b)&&(d=d.substring(b.length,d.length)),c&&d.indexOf("%")===d.length-1&&(d=d.substring(0,d.length-1)),{isNumber:$.isNumeric(d),value:d}},formatNumber:function(a,b,c,d,e){var f=a,g=this.isNumber(a,d,e);if(g.isNumber)return f=g.value,(b||b>-1)&&(f=parseFloat(f).toFixed(b)),c&&(num=f.toString().split("."),num[0]=num[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),f=num.join(".")),d&&d.length>0&&(f=d+f),e&&(f+="%"),f},formatString:function(){var a,b,c=arguments[0];for(a=0;a<arguments.length-1;a++)b=new RegExp("\\{"+a+"\\}","gi"),c=c.replace(b,arguments[1*a+1]);return c},findAuthAssetUrl:function(a){var b=this;if("object"==(void 0===a?"undefined":_typeof(a)))if(a.length)for(var c=0,d=a.length;c<d;c++)b.findAuthAssetUrl(a[c]);else for(var e in a)"string"==typeof a[e]?-1!==a[e].indexOf("auth/asset/")&&a[e].indexOf("auth/asset/samples/")<0&&(a[e]=global_player.globalScoRootPath+a[e]):b.findAuthAssetUrl(a[e]);return a},firePostMessageEvent:function(a){try{d.msie?window.parent.postMessage(JSON.stringify(a),"*"):window.parent.postMessage(a,"*")}catch(a){}},openBrowserPopupWindow:function(){if(!(arguments.length<1)){var a=$("base").attr("href")||"";arguments[0]=arguments[0]||"",a.length>0&&arguments[0].length>0&&d.msie&&!/^http/.test(arguments[0])&&!/^file/.test(arguments[0])&&("/"!==a.charAt(a.length-1)&&"/"!==arguments[0].charAt(0)?arguments[0]=a+"/"+arguments[0]:arguments[0]=a+arguments[0]),window.open.apply(window,arguments)}},setGlobalLabels:function(a,b,d,e){var f,g=!0;for(f=0;f<c.length;f++)if(c[f][b]&&JSON.stringify(c[f][b].labelOpts)===JSON.stringify(e)){g=!1;break}g&&c.push(a),d(e)},urlResolver:function(a,b,c){var d;d=a&&a.authoring?a.authoring.Domains:void 0;var e,f="",g="",h="",i="";if("URL"===b)return c.indexOf("=")<0?c:c.indexOf("?")<0?(g=c.split("="),g[1].indexOf("&")>-1?(g=g[1].split("&"),i=g[0]):i=c,i):c;if(d)for(e=0;e<d.length;e++)if(g=d[e],b===g.optionValue)for(h=0;h<g.map.length;h++){if(f=g.map[h],f.destination.indexOf("$DOMAIN")>-1){var j=window.location.href.split("/"),k=j[0],l=j[2];f.destination=f.destination.replace("$DOMAIN",k+"//"+l)}if("*"===f.host)return f.destination+c;var m=new RegExp(f.host);if(m.test(window.location.href))return f.destination+c}return null},getGlobalizedLabel:function(a,b,d){var e,f,g=!0;for(d="en-GB"===d?"en":d,f=0;f<c.length;f++)if(c[f][a])return void b(c[f][a].labelOpts);if(g){if(this.rootURL=window.location.href,"en"==d)return void b();var h="globalization/"+a+"_"+d+".json",i=this.getXmlHttp(h);if(this.getWasIE())k=$.parseJSON(j),e=k[a].labelOpts,this.setGlobalLabels(k,a,b,e);else if(d&&(i.open("GET",h,!1),i.send(null),200===i.status||0===i.status)){var j=i.responseText,k=$.parseJSON(j);e=k[a].labelOpts,this.setGlobalLabels(k,a,b,e)}}else b(e)},isNonEmptyString:function(a){return("string"==typeof a||a instanceof String)&&a.length>0},isNonEmptyArray:function(a){return Array.isArray(a)&&a.length>0},isArrayContains:function(a,b){if(!$.isArray(a))return!1;for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},hasParmContent:function(){return PearsonGL.globals&&PearsonGL.globals.player&&PearsonGL.globals.player.hasParmContent&&!this.isOnDCATEditMode()},isOnDCAT:function(){var a=document.location.href.split("player.html")[0];return-1!==a.indexOf("/authored/")&&-1!==a.indexOf(".pearson.com")&&-1!==a.indexOf("dcat")},isOnDCATEditMode:function(){return!!window.skipExecution},escapeRegExp:function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},executeFunctionName:function(a){for(var b=window,c=a.split("."),d=c.pop(),e=0;e<c.length&&b[c[e]];e++)b=b[c[e]];"function"==typeof b[d]&&b[d]()},ieAjaxOfflineSupport:function(){$.ajaxTransport("* text html xml json",function(a,b,c){if(void 0!==window.ActiveXObject&&a.url.indexOf("http")<0)return{send:function(b,c){var d=new ActiveXObject("Microsoft.XMLHTTP");d.open("GET",a.url,!0),d.onreadystatechange=function(){4!=d.readyState||200!==d.status&&0!==d.status||d.responseText&&c(200,"OK",{iframe:d.responseText})},d.send(null)},abort:function(){}}})},setActiveInputField:function(a){this.activeInputField=a},getActiveInputField:function(a){return this.activeInputField},actionOnActiveInputField:function(a,b,c){var d,e=this.activeInputField,f=e[0].value.substr(e[0].selectionStart,e[0].selectionEnd-e[0].selectionStart).length;switch(a){case"reset":case"enter":break;case"delete":if(null===b){d="";break}var g=b.substring(0,c),h=b.substring(c);f>0?d=g+h.slice(f):(d=g.slice(0,-1)+h,c--);break;default:if(null===b)d=a;else{var i=b,g=i.substring(0,c),h=i.substring(c);d=f>0?g+a+h.slice(f):h.length?g+a+h:g+a}c++}return{caret:c,value:d}},doTabbable:function(){function a(a,c){a||(a=t[0]),c=c||{};var d=a.ownerDocument||a,e=[],h=[],i=new q(d),j=a.querySelectorAll(s);c.includeContainer&&u.call(a,s)&&(j=Array.prototype.slice.apply(j),j.unshift(a));var k=void 0,l=void 0,m=void 0;for(k=0;k<j.length;k++)l=j[k],b(l,i)&&(m=f(l),0===m?e.push(l):h.push({documentOrder:k,tabIndex:m,node:l}));return h.sort(g).map(function(a){return a.node}).concat(e)}function b(a,b){return!(!d(a,b)||m(a)||n(a)||f(a)<0)}function c(a,c){if(!a)throw new Error("No node provided");return!1!==u.call(a,s)&&b(a,c)}function d(a,b){return b=b||new q(a.ownerDocument||a),!(a.disabled||k(a)||b.isUntouchable(a))}function e(a,b){if(!a)throw new Error("No node provided");return!1!==u.call(a,v)&&d(a,b)}function f(a){var b=parseInt(a.getAttribute("tabindex"),10);return isNaN(b)?i(a)?0:a.tabIndex:b}function g(a,b){return a.tabIndex===b.tabIndex?a.documentOrder-b.documentOrder:a.tabIndex-b.tabIndex}function h(a,b){for(var c=0,d=a.length;c<d;c++)if(b(a[c]))return a[c]}function i(a){return"true"===a.contentEditable}function j(a){return"INPUT"===a.tagName}function k(a){return j(a)&&"hidden"===a.type}function l(a){return j(a)&&"radio"===a.type}function m(a){return l(a)&&!p(a)}function n(a){}function o(a){for(var b=0;b<a.length;b++)if(a[b].checked)return a[b]}function p(a){if(!a.name)return!0;var b=a.ownerDocument.querySelectorAll('input[type="radio"][name="'+a.name+'"]'),c=o(b);return!c||c===a}function q(a){this.doc=a,this.cache=[]}var r=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'],s=r.join(","),t=$("body").find(".sco"),u="undefined"==typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;a.isTabbable=c,a.isFocusable=e;var v=r.concat("iframe").join(",");return q.prototype.hasDisplayNone=function(a,b){if(a===this.doc.documentElement)return!1;var c=h(this.cache,function(b){return b===a});if(c)return c[1];b=b||this.doc.defaultView.getComputedStyle(a);var d=!1;return"none"===b.display?d=!0:a.parentNode&&(d=this.hasDisplayNone(a.parentNode)),this.cache.push([a,d]),d},q.prototype.isUntouchable=function(a){if(a===this.doc.documentElement)return!1;var b=this.doc.defaultView.getComputedStyle(a);return!!this.hasDisplayNone(a,b)||"hidden"===b.visibility},{tabbable:a}},getActiveElement:function(){var a=void 0;return"body"!==document.activeElement.nodeName.toLowerCase()&&(a=document.activeElement),PearsonGL.logger.log("GET ACTIVE ELEMENT",a),a},doFocusTrap:function(a,b){function c(a){return a.tagName&&"input"===a.tagName.toLowerCase()&&"function"==typeof a.select}function d(a){return"Escape"===a.key||"Esc"===a.key||27===a.keyCode}function e(a){return"Tab"===a.key||9===a.keyCode}function f(a){return setTimeout(a,0)}var g=new PearsonGL.utils.doTabbable,h=null;return{focusTrap:function(a,b){function i(a){if(!A.active){v(),A.active=!0,A.paused=!1,A.nodeFocusedBeforeActivation=z.nodeFocusedBeforeActivation?z.nodeFocusedBeforeActivation:x.activeElement;var b=a&&a.onActivate?a.onActivate:z.onActivate;return b&&b(),m(),B}}function j(a){if(A.active){n(),A.active=!1,A.paused=!1;var b=a&&void 0!==a.onDeactivate?a.onDeactivate:z.onDeactivate;b&&b();return(a&&void 0!==a.returnFocus?a.returnFocus:z.returnFocusOnDeactivate)&&f(function(){w(A.nodeFocusedBeforeActivation)}),B}}function k(){!A.paused&&A.active&&(A.paused=!0,n())}function l(){A.paused&&A.active&&(A.paused=!1,m())}function m(){if(A.active)return h&&h.pause(),h=B,v(),f(function(){w(p())}),x.addEventListener("focusin",r,!0),x.addEventListener("mousedown",q,!0),x.addEventListener("touchstart",q,!0),x.addEventListener("click",u,!0),x.addEventListener("keydown",s,!0),B}function n(){A.active&&h===B&&(x.removeEventListener("focusin",r,!0),x.removeEventListener("mousedown",q,!0),x.removeEventListener("touchstart",q,!0),x.removeEventListener("click",u,!0),x.removeEventListener("keydown",s,!0),h=null)}function o(a){var b=z[a],c=b;if(!b)return null;if("string"==typeof b&&!(c=x.querySelector(b)))throw new Error(a+" refers to no known node");if("function"==typeof b&&!(c=b()))throw new Error(a+" did not return a node");return c}function p(){var a=void 0;if(!(a=null!==o("initialFocus")?o("initialFocus"):y.contains(x.activeElement)?x.activeElement:A.firstTabbableNode||o("fallbackFocus")))throw new Error("You can't have a focus-trap without at least one focusable element");return a}function q(a){y.contains(a.target)||(z.clickOutsideDeactivates?j({returnFocus:!g.isFocusable(a.target)}):a.preventDefault())}function r(a){y.contains(a.target)||a.target instanceof Document||(a.stopImmediatePropagation(),w(A.mostRecentlyFocusedNode||p()))}function s(a){return z.escapeDeactivates&&d(a)?(a.preventDefault(),void j()):e(a)?void t(a):void 0}function t(a){return v(),a.shiftKey&&a.target===A.firstTabbableNode?(a.preventDefault(),void w(A.lastTabbableNode)):a.shiftKey||a.target!==A.lastTabbableNode?void 0:(a.preventDefault(),void w(A.firstTabbableNode))}function u(a){z.clickOutsideDeactivates||y.contains(a.target)||(a.preventDefault(),a.stopImmediatePropagation())}function v(){var a=g.tabbable(y);A.firstTabbableNode=a[0]||p(),A.lastTabbableNode=a[a.length-1]||p()}function w(a){if(a!==x.activeElement){if(!a||!a.focus)return void w(p());a.focus(),A.mostRecentlyFocusedNode=a,c(a)&&a.select()}}var x=document,y="string"==typeof a?x.querySelector(a):a,z=$.extend({returnFocusOnDeactivate:!0,escapeDeactivates:!0},b),A={firstTabbableNode:null,lastTabbableNode:null,nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1},B={activate:i,deactivate:j,pause:k,unpause:l};return B}}},getPhysicalProps:function(a){var b=a.offset(),c={width:a.outerWidth(),height:a.outerHeight()};return $.extend({},b,c)},smartTooltip:function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,e=this.getPhysicalProps(b),f=this.getPhysicalProps(c),g=this.getPhysicalProps(a);e.top>g.top-(d+f.height)?f.top=g.top+g.height+d:f.top=g.top-d-f.height,f.width>g.width?e.left>g.left-(f.width-g.width)/2?f.left=e.left:e.left+e.width<g.left+g.width+(f.width-g.width)/2?f.left=e.left+e.width-f.width:f.left=g.left+(g.width-f.width)/2:f.left=g.left+(g.width-f.width)/2,"relative"==a.css("position")?(f.top-=g.top,f.left-=g.left):(f.top-=e.top,f.left-=e.left),c.css({top:f.top,left:f.left})},suppressIframeEvents:function(){arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?$("iframe").each(function(a,b){var c=$(b),d=c.data("iframePointerEvents");c.css("pointer-events",d||"")}):$("iframe").each(function(a,b){var c=$(b),d=b.style;c.data("iframePointerEvents",d.getPropertyValue("pointer-events")),d.setProperty("pointer-events","none")})}}}(),window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Media=window.PearsonGL.Media||{},PearsonGL.Media.textToSpeech=function(){function a(a,g){function k(b){v="";for(var c=b;c<r&&(p=a.charAt(c),$.isNumeric(p)||"."===p);c++)v+=p;return t+=v.length,/^\\_/.test(a.substring(t))?(g="e",t+=2):/^_/.test(a.substring(t))&&(g="e",t++),v}for(var o,p,r=a.length,t=0,v="";t<r;)if("."===(o=a.charAt(t)))v=".",t++;else if(n(o+a.charAt(t+1)))c(o+a.charAt(t+1)),t+=2;else if(l(o))d(o,t,a),t++;else if($.isNumeric(o))j(k(t),g);else if("("===o){var y=a.substring(t,a.length).indexOf(")"),z=a.substring(t+1,y+t);$.isNumeric(z)||w.push("opQuantityOf.mp3"),t++}else if("["===o){$.isNumeric(v)&&w.push(u);var A=a.indexOf("]",t),B=a.substring(t+1,A);t+=B.length+2;var C=B.split("/");e(C,g)}else o===q&&m(a.charAt(t+1))?(specialCharAudoMap[a.charAt(t+1)]&&(w.push(x[a.charAt(t+1)]),t+=1),t+=1):o===q&&l(a.charAt(t+1))?(b(a.charAt(t+1)),t+=2):"$"===o||"#"===o||""===o?(l(a.charAt(t+1))?(d(a.charAt(t+1),t+1,a),t++):a.charAt(t+1)===q&&l(a.charAt(t+2))&&(b(a.charAt(t+2)),t+=2),h(o,k(++t),g),g=""):f(o)?(i(o),t++):o===s?(v=void 0,w.push("opPause.mp3"),t++):(v=void 0,PearsonGL.logger.log("Ignoring character %s in the audio text",a.charAt(t)),t++)}function b(a){switch(a){case"+":w.push("opPositive.mp3");break;case"-":w.push("opNegative.mp3");break;case"*":case"":case"'":w.push("opTimes.mp3")}}function c(a){"<="===a?audioFile="opLessThanOrEqual.mp3":">="===a&&(audioFile="opGreaterThanOrEqual.mp3"),w.push(audioFile)}function d(a,b,c){var d,e={"*":"opTimes.mp3","-":"opNegative.mp3","+":"opAdd.mp3","%":"opPercent.mp3","/":"opDividedBy.mp3","=":"opEquals.mp3",">":"opGreaterThan.mp3","<":"opLessThan.mp3"};"-"===a?(prevLetter=c.charAt(b-1),nextLetter=c.charAt(b+1),""==nextLetter&&""==prevLetter?d="opMinus.mp3":/[\[|(]/.test(nextLetter)?d="opOppositeOf.mp3":prevLetter===q?curVal=e["-"]:d=l(nextLetter)||n(nextLetter+c.charAt(b+2))||$.isNumeric(nextLetter)||f(nextLetter)?""==prevLetter||l(prevLetter)||n(nextLetter+c.charAt(b+2))||"$"===prevLetter||"("===prevLetter||"["===prevLetter?e["-"]:"opMinus.mp3":("("===nextLetter||"["===nextLetter)&&(""==prevLetter||"("===prevLetter||"["===prevLetter||l(prevLetter)||n(c.charAt(b-2)+prevLetter))?"opOppositeOf.mp3":"opMinus.mp3",w.push(d)):w.push(e[a])}function e(a,b){var c=a[0],d=2===a.length?a[1]:"",e=parseFloat(c),g=parseFloat(d),h=b+t;if(c.charAt(c.length-1)===r&&(h="e"+t,b="e",c="\\"===c.charAt(c.length-2)?c.substring(0,c.length-2):c.substring(0,c.length-1)),$.isNumeric(c)?j(c,b):/^[a-z]+$/i.test(c)&&""!=c?(i(c),""!==d&&"1"!==d&&"1_"!==d&&"0"!==d&&"0_"!==d&&"1_"!==d&&"0_"!==d&&w.push(v)):c.length>1&&c[0]===q&&m(c[1])&&x[c[1]]&&w.push(x[c[1]]),d.charAt(d.length-1)===r&&(h="e"+t,b="e",d="\\"===d.charAt(d.length-2)?d.substring(0,d.length-2):d.substring(0,d.length-1)),"0"===d)return w.push(v),void w.push("n0"+h);if($.isNumeric(d))if("1"===d)w.push(v),w.push("n1e.mp3");else{var l=d.charAt(d.length-1);if(1==e&&$.isNumeric(c))if(2===g)w.push("f2Half.mp3");else if(g<23)w.push("f"+g+h);else if(0===parseInt(d.substring(1,d.length)))w.push("n"+d.charAt(0)+h),w.push("d1"+d.substring(1,d.length)+".mp3");else{var n=d.charAt(d.length-2)+d.charAt(d.length-1);parseInt(n,10)<23?(d=d.substring(0,d.length-2)+"00",l=n):d=d.substring(0,d.length-1)+"0",parseInt(l,10)>0&&(k(d,b),w.push("f"+parseInt(l,10)+h))}else if(g<=99)2===g?w.push("f2Halves_p"+h):w.push("f"+d+"p"+h);else if(0===parseInt(d.substring(1,d.length)))w.push("n"+d.charAt(0)+h),w.push("f1"+d.substring(1,d.length)+"p"+h);else{var n=d.charAt(d.length-2)+d.charAt(d.length-1);d=d.substring(0,d.length-2)+"00",k(d,b),parseInt(n,10)>0&&w.push("f"+parseInt(n,10)+"p"+h)}}else f(d)&&i(d)}function f(a){return/^[a-z]+$/i.test(a)}function g(a,b){function c(a){var b=a.toString();a<=20?w.push(f+a+e):a<100&&(w.push(f+b.charAt(0)+"0"+e),"0"!==b.charAt(1)&&w.push(f+b.charAt(1)+e))}a.replace(/^0+/,"");var d=parseInt(a,10),e=b+t,f="n";if(d<100)c(d);else if(d<1e3){w.push(f+a.charAt(0)+"00"+e);var g=d%100;g>0&&c(g)}}function h(a,b,c){c=c;var d=b.indexOf("."),e=-1===d?b:b.substring(0,d),f=-1===d?"":b.substring(d+1),g={$:["cDollar.mp3","cDollarp.mp3","cCent.mp3","cCentp.mp3"],"#":["cPound.mp3","cPoundp.mp3","cPenny.mp3","cPennyp.mp3"],"":["cPound.mp3","cPoundp.mp3","cPenny.mp3","cPennyp.mp3"]};e.length>0&&(k(e,c),w.push(0===parseInt(e,10)||parseInt(e,10)>1?g[a][1]:g[a][0]),f.length>0&&w.push(u)),f.length>0&&(1===f.length&&(f+="0"),k(f,""),w.push(1!==parseInt(f,10)?g[a][3]:g[a][2]))}function i(a,b){var c;for(c=0;c<a.length;c++)w.push("letter"+a.charAt(c).toUpperCase()+".mp3")}function j(a,b){b=b;var c=a.indexOf("."),d=-1===c?a:a.substring(0,c),e=-1===c?"":a.substring(c+1),f=t;if(c>-1&&(b=""),d.length>0&&(k(d,b),e.length>0&&parseInt(e,10)>=0&&w.push(u)),e.length>0)switch(k(e,b),1!==parseInt(e,10)&&(f="p"+t),e.length){case 1:w.push("d10"+f);break;case 2:w.push("d100"+f);break;case 3:w.push("d1000"+f);break;case 4:w.push("d10000"+f);break;case 5:w.push("d100t"+t),w.push("d1000"+f)}}function k(a,b){var c=[],d=".mp3",e=b+d;a=a.replace(/^0+/,""),0===a.length&&(a="0");var f=a.length;"-"===a.charAt(0)&&(w.push("opNegative.mp3"),a=a.substring(1,f),f-=1);var h,i=f%3,j=Math.floor(f/3),k=j,l=a;switch(k){case 1:i>0&&(c=["n1000"]);break;case 2:0===i?(j--,c=["n1000"]):c=["n1000","n1000000"];break;case 3:c=["n1000","n1000000"],0===i&&j--}for(i>0&&(g(l.substring(0,i),b),j>0&&w.push(c[--j]+e)),h=0;h<k;h++)curValue=a.substring(i+3*h,3+i+3*h),"000"!=curValue?(g(curValue,b),--j>=0&&j<c.length&&w.push(c[j]+e)):--j}function f(a){return/[a-zA-Z]/.test(a)}function l(a){return/\*|-|\+|%|\/|=|>|</.test(a)}function m(a){return/p/.test(a)}function n(a){return"<="===a||">="===a}function o(b){var c,d,e=b.length;for(w=[],c=0;c<e;c++)(d=b[c])&&(/.mp3$/.test(d)?w.push(PearsonGL.qtiEvaluator.evaluateAsset(d)):a(d,""));return w}var p={},q="`",r="_",s=",",t=".mp3",u="opAnd.mp3",v="opOver.mp3",w=[],x={p:"sPI.mp3"};return p.getAudios=o,p}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Parameters=window.PearsonGL.Parameters||{},window.PearsonGL.External=window.PearsonGL.External||{},window.PearsonGL.External.rootJS=window.PearsonGL.External.rootJS||{},window.PearsonGL.External.masterJS=window.PearsonGL.External.masterJS||{},PearsonGL.Parameters.Parameter=function(a,b,c,d){this.cardinality=b||null,this.type=c||null,this.value=a,this.expression=d,this.evalExpression=!1,this.evalExpressionAlways=!1,"multiple"===this.cardinality&&this.dedupe()},PearsonGL.Parameters.Parameter.prototype={dedupe:function(a){var b=function(a){var b=[];return a=Array.isArray(a)?a:[],a.forEach(function(a){if("object"===(void 0===a?"undefined":_typeof(a))&&null!==a){for(var c=0;c<b.length;c++)if(a.x===b[c].x&&a.y===b[c].y)return}else if(-1!==b.indexOf(a))return;b.push(a)}),b};if(void 0!==a)return b(a);"multiple"===this.cardinality&&(this.value=b(this.value),0===this.value.length&&(this.value=null))},serialize:function(){return{val:this.value,exp:this.expression,ev:this.evalExpression,eva:this.evalExpressionAlways}},toString:function(){var a=this,b="";return null===this.cardinality||null===this.value?b="ordered"===this.cardinality?"[]":"multiple"===this.cardinality?"[[]]":"null":void 0===this.cardinality||void 0===this.value?b="undefined":"single"===this.cardinality?b="point"===this.type?"{'x': "+this.value.x+", 'y': "+this.value.y+"}":this.value:Array.isArray(this.value)&&(b=this.value.map(function(b){switch(a.type){case"string":return null===b?'""':'"'+b.replace(/"/g,'\\"')+'"';case"boolean":return b?"true":"false";case"integer":case"float":return b;case"point":return'{"x": '+b.x+', "y": '+b.y+"}"}}).join(", "),b="ordered"===this.cardinality?"["+b+"]":"[["+b+"]]"),b},clone:function(){var a=new PearsonGL.Parameters.Parameter(this.value,this.cardinality,this.type);return Array.isArray(a.value)&&(a.value=a.value.slice(0)),a.expression=this.expression,a.evalExpression=this.evalExpression,a.evalExpressionAlways=this.evalExpressionAlways,a}},PearsonGL.qtiEvaluator=function(){function a(a){return""===a?"":n()?PearsonGL.parmMgr.replaceParameters(a):a}function b(a){if(n()){var b=c(a,"single","string");try{b.value=PearsonGL.parmMgr.getAsset(b.value)}catch(a){}return b.value}return a}function c(a,b,c,d,e,f){a+="";var g,h,i,j=[],k=!1,l=!1,o=Sa[c];if(e=e||(n()?PearsonGL.parmMgr.getEvaluatedParameters():{}),f="boolean"!=typeof f||f,"function"!=typeof o)throw"Unsupported evaluateExpression type: "+c;if("single"===b)return o(a,d,e,"single",f);if(/^\[.*\]$/.test(a)&&(l=!0,a=a.substring(1,a.length-1),"multiple"===b&&/^\[.*\]$/.test(a)&&(a=a.substring(1,a.length-1))),h=m(a),1===h.length){if(i=o(a,d,e,"*",f),k=i.evalExpression||i.evalExpressionAlways,"single"===i.cardinality)i=new PearsonGL.Parameters.Parameter([i.value],b,c,a);else if(l)throw"Cannot have "+i.cardinality+" cardinality element in a "+b+" cardinality expression";return i.evalExpression=k,i}return h.forEach(function(a){i=o(a,d,e,"single",f),j.push(i.value),k=k||i.evalExpression||i.evalExpressionAlways}),0===j.length&&(j=null),g=new PearsonGL.Parameters.Parameter(j,b,c,a),g.evalExpression=k,g}function d(a,b,c,d,e){a+="",d=d||"single",e="boolean"!=typeof e||e;var f,g,h=[],i=0,k=0,l=!1,m=!1,n=!1,o=!1;return""===(a=p(a))?new PearsonGL.Parameters.Parameter(null,d,"string",a):(a.split("").forEach(function(b,c){l?m?"("===b?i++:")"===b&&0===--i&&(h.push(a.substring(k,c+1)),k=c+1,l=!1):"("===b?(m=!0,i=1):/[^\w-]/.test(b)&&(h.push(a.substring(k,c)),k="\\"===b?c+1:c,l=!1,"~"===b&&(l=!0,m=!1)):"\\"===b?n=!0:"~"===b?(n?(h.push(a.substring(k,c-1)),k=c-1):(h.push(a.substring(k,c)),k=c,l=!0,m=!1),n=!1):n=!1}),h.push(a.substring(k,a.length)),h=h.filter(function(a){return a.length>0}),h=h.map(function(a){return/^\\~/.test(a)?q(a.substring(1),!0):"~"===a.charAt(0)?a:q(a,!0)}),!(1===h.length&&"~"===h[0].charAt(0))||(g=j(h[0],b,c),g.cardinality!==d&&"*"!==d||"string"!==g.type)?(f=h.reduce(function(a,d){var e=j(d,b,c);return o=o||e.evalExpression||e.evalExpressionAlways,a+e.toString()},""),g=new PearsonGL.Parameters.Parameter(f,"single","string",a),g.evalExpression=o,g):(g=g.clone(),g.expression=a,g))}function e(a,b,c,d,e){return i(a,b,c,d,e,"boolean")}function f(a,b,c,d,e){return i(a,b,c,d,e,"integer")}function g(a,b,c,d,e){return i(a,b,c,d,e,"float")}function h(a,b,c,d,e){return i(a,b,c,d,e,"point")}function i(a,b,c,d,e,f){a+="",d=d||"single",e="boolean"!=typeof e||e;var g="evaluate"+f,h=Ta[f];if(""===a)return new PearsonGL.Parameters.Parameter(null,d,f,a);var i=j(a,b,c);if(i.cardinality!==d&&null!==i.cardinality&&"*"!==d)throw"the "+g+" function was expecting that the expression generate a "+d+" cardinality parameter, found "+i.cardinality;if(null!==i.cardinality&&null!==i.type||(i.value=null),null!==i.value&&i.type!==f){if(!e)throw"the "+g+" function was expecting that the expression generate a "+f+" result, found "+i.type;if("single"===i.cardinality)i.value=h(i.value);else for(var k=0;k<i.value.length;k++)i.value[k]=h(i[k])}return i.type=f,i.expression=a,i}function j(a,b,d,e){a+="";var f,g,h=!1;if(d=d||(n()?PearsonGL.parmMgr.getEvaluatedParameters():{}),e=e||(n()?PearsonGL.parmMgr.getAssets():{}),/^~/.test(a)){var i=a.match(/^~(.+?)\((.*)\)$/);if(i){var o=i[1],p=m(i[2]),q=!1;if(p=p.map(function(a){var c=j(a,b,d);return(c.evalExpression||c.evalExpressionAlways)&&(h=!0),c}),Ra&&PearsonGL.parmMgr.getNextSubstitutionFunctionName()==="~"+o&&(f=PearsonGL.parmMgr.getNextSubstitution().parameter,f.evalExpression=h,"*"===f.value?(PearsonGL.logger.log("expression evaluator skipping function '"+o+"', value: "+f.value),f=null):(PearsonGL.logger.log("expression evaluator substituting function '"+o+"', value: "+f.value),q=!0)),q)return f;if("function"==typeof PearsonGL.External.masterJS[o]){if(!((f=PearsonGL.External.masterJS[o].apply(PearsonGL.External.masterJS,p))instanceof PearsonGL.Parameters.Parameter))throw"custom JavaScript functions must return a Parameter object";return f.evalExpression=h,f}if("function"==typeof PearsonGL.External.rootJS[o]){if(!((f=PearsonGL.External.rootJS[o].apply(PearsonGL.External.rootJS,p))instanceof PearsonGL.Parameters.Parameter))throw"custom JavaScript functions must return a Parameter object";return f.evalExpression=h,f}if("variable"===o)return f=PearsonGL.qtiEvaluator.variable(b,p.length>0?p[0]:void 0),f.evalExpression=!0,f;if("getAsset"===o)return f=PearsonGL.qtiEvaluator.getAsset(e,p.length>0?p[0]:void 0);if("function"==typeof PearsonGL.qtiEvaluator[o])return f=PearsonGL.qtiEvaluator[o].apply(this,p),f.evalExpression=h,f;throw"unrecognized QTI or custom function: '"+o+"'"}if(a in d)return f=d[a],(f.evalExpression||f.evalExpressionAlways)&&Pa.isNonEmptyString(f.expression)&&(g=c(f.expression,f.cardinality,f.type,b,d),f.value=g.value,f.evalExpression=g.evalExpression),f.clone();throw"unrecognized parameter or function: '"+a+"'"}return/^\[.*\]$/.test(a)?l(a,b,d,e):k(a,b,d)}function k(a,b,c){a+="";var e,f,g,h,i,j=a.replace(/\s+/g,"");if(/^'[\s\S]*'$/.test(a)||/^"[\s\S]*"$/.test(a))e="string",f=a.substring(1,a.length-1),f=""===f?null:f;else if("true"===a.toLowerCase()||"false"===a.toLowerCase())e="boolean",f="true"===a.toLowerCase();else if(/^\-?\d+$/.test(a))e="integer",f=parseInt(a,10);else if(/^\-?\d*\.\d+$/.test(a))e="float",f=parseFloat(a);else if(/^{x:\-?\d+,y:\-?\d+}$/i.test(j))g=j.match(/^{x:(\-?\d+),y:(\-?\d+)}$/i),e="point",f={x:parseFloat(g[1]),y:parseFloat(g[2])};else if(/^{x:\-?\d*\.\d+,y:\-?\d+}$/i.test(j))g=j.match(/^{x:(\-?\d*\.\d+),y:(\-?\d+)}$/i),e="point",f={x:parseFloat(g[1]),y:parseFloat(g[2])};else if(/^{x:\-?\d+,y:\-?\d*\.\d+}$/i.test(j))g=j.match(/^{x:(\-?\d+),y:(\-?\d*\.\d+)}$/i),e="point",f={x:parseFloat(g[1]),y:parseFloat(g[2])};else{if(!/^{x:\-?\d*\.\d+,y:\-?\d*\.\d+}$/i.test(j)){if(/^{.*~.*}$/.test(j))return h=d(a,b,c),i=k(h.value,b,c),i.evalExpression=h.evalExpression||h.evalExpressionAlways,i;throw"unable to parse primitive value, does not match any supported pattern: "+a}g=j.match(/^{x:(\-?\d*\.\d+),y:(\-?\d*\.\d+)}$/i),e="point",f={x:parseFloat(g[1]),y:parseFloat(g[2])}}return new PearsonGL.Parameters.Parameter(f,"single",e,f)}function l(a,b,c,d){a+="";var e,f=a,g="ordered",h=[],i=null;if(!/^\[.*\]$/.test(a))throw"unsupported expression for a container, must be wrapped in []";return a=a.substring(1,a.length-1),/^\[.*\]$/.test(a)&&(g="multiple",a=a.substring(1,a.length-1)),e=m(a),e=e.map(function(a){return j(a,b,c,d)}),e.forEach(function(a){if("ordered"===a.cardinality||"multiple"===a.cardinality)throw"Cannot have "+a.cardinality+" cardinality element in a "+g+" cardinality expression";if(null===a.type||null===a.cardinality||null===a.value)return void h.push(null);if(i){if("float"===i&&"integer"===a.type||"integer"===i&&"float"===a.type)i="float";else if(i!==a.type)throw"parsed array element type mismatch, found "+a.type+", expecting: "+i}else i=a.type;h.push(a.value)}),0===h.length&&(h=null),new PearsonGL.Parameters.Parameter(h,g,i,f)}function m(a){var b=[],c=null,d=null,e=null,f=0,g=0,h={"[":"]","(":")","{":"}"};return Pa.isNonEmptyString(a)?(a.split("").forEach(function(i,j){c?i===c&&(c=null):'"'===i||"'"===i?c=i:null===d&&i in h||d===i?(d=i,e=h[d],f++):f>0&&i===e?0===--f&&(d=null,e=null):","===i&&0===f&&(b.push(a.substring(g,j).trim()),g=j+1)}),b.push(a.substring(g,a.length).trim()),b):b}function n(){return"boolean"==typeof Qa?Qa:Qa=!(!Pa.hasParmContent()||!PearsonGL.parmMgr)}function o(){Ra=!0}function p(a){return(/^".*"$/.test(a)||/^'.*'$/.test(a))&&(a=a.substring(1,a.length-1)),a}function q(a,b){return!/^".*"$/.test(a)&&!/^'.*'$/.test(a)||b?'"'+a+'"':a}function r(a,b){return b?r(b,a%b):a}function s(a,b,c,d,e){b="string"==typeof b?b:"";var f=a<0,g=f?d?"&minus;":"-":"";if(a=Math.abs(a),"number"==typeof e?a=a.toFixed(Math.max(e,0)):a+="",c){var h=a.indexOf("."),i="";for(h>=0&&(i=a.substring(h),a=a.substring(0,h));/(\d+)(\d{3})/.test(a);)a=a.replace(/(\d+)(\d{3})/,"$1,$2");a+=i}return g+b+a}function t(a,b,c,d,e,f){var g,h=null;if(a.length<b)h="too few arguments provided";else for(var i=0;i<a.length;i++)if(g=u(a[i],c,d)){f||(f=0),h="argument "+(i+f)+" "+g;break}if(h&&Pa.isNonEmptyString(e))throw e+h;return h}function u(a,b,c){return a instanceof PearsonGL.Parameters.Parameter?null===a.type||null===a.cardinality?null:"*"!==b&&b!==a.type&&("numeric"!==b||"integer"!==a.type&&"float"!==a.type)?"not of the correct type ("+a.type+")":"*"!==c&&c!==a.cardinality&&("container"!==c||"multiple"!==a.cardinality&&"ordered"!==a.cardinality)?"not of the correct cardinality ("+a.cardinality+")":null:"not a valid parameter"}function v(a){for(var b=0;b<a.length;b++)if(w(a[b]))return!0;return!1}function w(a){return null===a.value||null===a.type||null===a.cardinality||"string"===a.type&&0===a.value.length||("ordered"===a.cardinality||"multiple"===a.cardinality)&&0===a.value.length}function x(a,b){return t(arguments,2,"numeric","single","The 'equal' function requires two single cardinality numeric parameters: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","boolean"):new PearsonGL.Parameters.Parameter(a.value===b.value,"single","boolean")}function y(a,b){return t(arguments,2,"numeric","single","The 'gt' function requires two single cardinality numeric parameters: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","boolean"):new PearsonGL.Parameters.Parameter(a.value>b.value,"single","boolean")}function z(a,b){return t(arguments,2,"numeric","single","The 'gt' function requires two single cardinality numeric parameters: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","boolean"):new PearsonGL.Parameters.Parameter(a.value>=b.value,"single","boolean")}function A(a,b){return t(arguments,2,"numeric","single","The 'lt' function requires two single cardinality numeric parameters: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","boolean"):new PearsonGL.Parameters.Parameter(a.value<b.value,"single","boolean")}function B(a,b){return t(arguments,2,"numeric","single","The 'lt' function requires two single cardinality numeric parameters: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","boolean"):new PearsonGL.Parameters.Parameter(a.value<=b.value,"single","boolean")}function C(){if(t(arguments,1,"boolean","single","The 'and' function requires one or more single cardinality boolean parameters: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","boolean");var a=Array.prototype.slice.call(arguments),b=a.every(function(a){return a.value});return new PearsonGL.Parameters.Parameter(b,"single","boolean")}function D(){if(t(arguments,1,"boolean","single","The 'or' function requires one or more single cardinality boolean parameters: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","boolean");var a=Array.prototype.slice.call(arguments),b=a.some(function(a){return a.value});return new PearsonGL.Parameters.Parameter(b,"single","boolean")}function E(a){return t(arguments,1,"boolean","single","The 'not' function requires one single cardinality boolean parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","boolean"):new PearsonGL.Parameters.Parameter(!a.value,"single","boolean")}function F(a){return t(arguments,1,"*","*","The 'isNull' function requires one parameter of any type or cardinality: "),new PearsonGL.Parameters.Parameter(w(a),"single","boolean")}function G(a,b,c){var d="The 'ternary' function requires one single cardinality boolean parameter and two parameters or any type and cardinality: ";if(t([a],1,"boolean","single",d),t([b,c],2,"*","*",d,1),PearsonGL.qtiEvaluator.anyParamsNull([a]))return new PearsonGL.Parameters.Parameter(null,null,null);var e=a.value?b:c;return new PearsonGL.Parameters.Parameter(e.value,e.cardinality,e.type)}function H(a,b,c){var d="The 'substring' function requires two single cardinality string parameters and an optional single cardinality boolean parameter: ";if(t([a,b],2,"string","single",d),arguments.length>2&&t([c],1,"boolean","single",d,2),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","boolean");var e=2===arguments.length||c.value,f=e?a.value:a.value.toLowerCase(),g=e?b.value:b.value.toLowerCase();return new PearsonGL.Parameters.Parameter(g.indexOf(f)>-1,"single","boolean")}function I(a,b,c){var d="The 'stringMatch' function requires two single cardinality string parameters and a single cardinality boolean parameter: ";if(t([a,b],2,"string","single",d),t([c],1,"boolean","single",d,2),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","boolean");var e=2===arguments.length||c.value,f=e?a.value:a.value.toLowerCase(),g=e?b.value:b.value.toLowerCase();return new PearsonGL.Parameters.Parameter(f===g,"single","boolean")}function J(){t(arguments,1,"string","single","The 'concat' function requires one or more single cardinality string parameters: ");for(var a="",b=0;b<arguments.length;b++)a+=null===arguments[b].value?"":arguments[b].value;return new PearsonGL.Parameters.Parameter(a,"single","string")}function K(a,b,c,d){var e="The 'stringReplace' function requires three single cardinality string parameters and an optional single cardinality boolean parameter: ";if(t([a,b,c],3,"string","single",e),arguments.length>3&&t([d],1,"boolean","single",e,3),v(arguments.length>3?[a,b,d]:[a,b]))return new PearsonGL.Parameters.Parameter(null,"single","string");var f=Pa.escapeRegExp(b.value),g=null===c.value?"":c.value,h=4===arguments.length&&d.value,i=new RegExp(f,h?"g":"");return new PearsonGL.Parameters.Parameter(a.value.replace(i,g),"single","string")}function L(a,b,c){var d="The 'partial' function requires either one single cardinality string parameter or one ordered cardinality parameter of any type, ";if(d+="followed by a single cardinality integer parameter and an optional single cardinality integer parameter: ",t([a],1,"*","*",d),("string"!==a.type||"single"!==a.cardinality)&&"ordered"!==a.cardinality)throw d+="argument 1 is not the correct type or cardinality.  Found "+a.cardinality+" "+a.type;if(t([b],1,"integer","single",d,1),arguments.length>2&&t([c],1,"integer","single",d,2),v(arguments.length>2?[a,b,c]:[a,b]))return new PearsonGL.Parameters.Parameter(null,null,null);var e=a.value.length,f=Math.max(b.value-1,0);f=Math.min(f,e);var g=arguments.length>2?c.value:e;if(g=Math.max(g,f),g=Math.min(g,e),"ordered"===a.cardinality){var h=a.value.slice(f,g);return h=0===h.length?null:h,new PearsonGL.Parameters.Parameter(h,"ordered",a.type)}var h=a.value.substring(f,g);return h=0===h.length?null:h,new PearsonGL.Parameters.Parameter(h,"single","string")}function M(a){if(t(arguments,1,"numeric","single","The 'numCommas' function requires one single cardinality numeric parameter: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","string");var b=s(a.value,"",!0,!0,null);return new PearsonGL.Parameters.Parameter(b,"single","string")}function N(a){if(t(arguments,1,"numeric","single","The 'numMinusSign' function requires one single cardinality numeric parameter: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","string");var b=s(a.value,"",!1,!0,null);return new PearsonGL.Parameters.Parameter(b,"single","string")}function O(a){if(t(arguments,1,"numeric","single","The 'numMinusSign' function requires one single cardinality numeric parameter: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","string");var b=s(a.value,"$",!0,!0,2);return new PearsonGL.Parameters.Parameter(b,"single","string")}function P(a,b){var c="The 'numDecimals' function requires one single cardinality numeric parameter and one single cardinality integer parameter: ";if(t([a],1,"numeric","single",c),t([b],1,"integer","single",c,1),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","string");var d=s(a.value,"",!1,!0,b.value);return new PearsonGL.Parameters.Parameter(d,"single","string")}function Q(a,b){var c="The 'numToString' function requires one single cardinality numeric parameter and optionally one single cardinality string parameter: ";if(t([a],1,"numeric","single",c),arguments.length>1&&t([b],1,"string","single",c,1),v([a]))return new PearsonGL.Parameters.Parameter(null,"single","string");var d=arguments.length>1&&null!==b.value?b.value:"",e=/,/.test(d),f=/\$/.test(d)?"$":"",g=!/-/.test(d),h=d.replace(/\D/g,""),i=h.length>0?parseInt(h,10):null;f.length>0&&(e=!0,i=null===i?2:i);var j=s(a.value,f,e,g,i);return new PearsonGL.Parameters.Parameter(j,"single","string")}function R(){t(arguments,1,"numeric","*","The 'sum' function requires one or more numeric parameters: ");var a,b,c="integer",d=0;for(a=0;a<arguments.length;a++)"float"===arguments[a].type&&(c="float");if(v(arguments))return new PearsonGL.Parameters.Parameter(null,"single",c);for(a=0;a<arguments.length;a++)if("single"===arguments[a].cardinality)d+=arguments[a].value;else for(b=0;b<arguments[a].value.length;b++)d+=arguments[a].value[b];return new PearsonGL.Parameters.Parameter(d,"single",c)}function S(a,b){t(arguments,2,"numeric","single","The 'subtract' function requires two single cardinality numeric parameters: ");var c="integer"===a.type&&"integer"===b.type?"integer":"float";return v(arguments)?new PearsonGL.Parameters.Parameter(null,"single",c):new PearsonGL.Parameters.Parameter(a.value-b.value,"single",c)}function T(){t(arguments,1,"numeric","*","The 'product' function requires one or more numeric parameters: ");var a,b,c="integer",d=1;for(a=0;a<arguments.length;a++)"float"===arguments[a].type&&(c="float");if(v(arguments))return new PearsonGL.Parameters.Parameter(null,"single",c);for(a=0;a<arguments.length;a++)if("single"===arguments[a].cardinality)d*=arguments[a].value;else for(b=0;b<arguments[a].value.length;b++)d*=arguments[a].value[b];return new PearsonGL.Parameters.Parameter(d,"single",c)}function U(a,b){return t(arguments,2,"numeric","single","The 'divide' function requires two single cardinality numeric parameters: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","float"):new PearsonGL.Parameters.Parameter(a.value/b.value,"single","float")}function V(a,b){return t(arguments,2,"numeric","single","The 'power' function requires two single cardinality numeric parameters: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","float"):new PearsonGL.Parameters.Parameter(Math.pow(a.value,b.value),"single","float")}function W(){t(arguments,1,"numeric","*","The 'max' function requires one or more numeric parameters: ");var a,b,c="integer",d=-999999999;for(a=0;a<arguments.length;a++)"float"===arguments[a].type&&(c="float");if(v(arguments))return new PearsonGL.Parameters.Parameter(null,"single",c);for(a=0;a<arguments.length;a++)if("single"===arguments[a].cardinality)arguments[a].value>d&&(d=arguments[a].value);else for(b=0;b<arguments[a].value.length;b++)arguments[a].value[b]>d&&(d=arguments[a].value[b]);return new PearsonGL.Parameters.Parameter(d,"single",c)}function X(){t(arguments,1,"numeric","*","The 'min' function requires one or more numeric parameters: ");var a,b,c="integer",d=99999999999;for(a=0;a<arguments.length;a++)"float"===arguments[a].type&&(c="float");if(v(arguments))return new PearsonGL.Parameters.Parameter(null,"single",c);for(a=0;a<arguments.length;a++)if("single"===arguments[a].cardinality)arguments[a].value<d&&(d=arguments[a].value);else for(b=0;b<arguments[a].value.length;b++)arguments[a].value[b]<d&&(d=arguments[a].value[b]);return new PearsonGL.Parameters.Parameter(d,"single",c)}function Y(a,b){if(t(arguments,2,"integer","single","The 'integerDivide' function requires two single cardinality integer parameters: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","integer");var c=a.value/b.value;return c=c>=0?Math.floor(c):Math.ceil(c),new PearsonGL.Parameters.Parameter(c,"single","integer")}function Z(a,b){if(t(arguments,2,"integer","single","The 'integerModulus' function requires two single cardinality integer parameters: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","integer");var c=a.value%b.value;return new PearsonGL.Parameters.Parameter(c,"single","integer")}function _(a){if(t(arguments,1,"numeric","container","The 'mean' function requires one multiple or ordered cardinality numeric parameter: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","float");for(var b=0,c=0;c<a.value.length;c++)b+=arguments[0].value[c];return b/=a.value.length,new PearsonGL.Parameters.Parameter(b,"single","float")}function aa(a,b,c){var d="The 'createNumSequence' function requires two single cardinality numeric parameters and one optional single cardinality numeric parameter: ",e="integer",f=[];if(t([a,b],2,"numeric","single",d),arguments.length>2&&t([c],1,"numeric","single",d,2),v(arguments.length>2?[a,b,c]:[a,b]))return new PearsonGL.Parameters.Parameter(null,"ordered","integer");var g=a.value<=b.value,h=arguments.length>2?Math.abs(c.value):1;if(("float"===a.type||"float"===b.type||arguments.length>2&&"float"===c.type)&&(e="float"),g)for(var i=a.value;i<=b.value;i+=h)f.push(i);else for(var i=a.value;i>=b.value;i-=h)f.push(i);return new PearsonGL.Parameters.Parameter(f,"ordered",e)}function ba(a){if(t(arguments,1,"*","container","The 'random' function requires one multiple or ordered cardinality parameter of any type: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single",a.type?a.type:null);var b=Math.floor(Math.random()*a.value.length),c=a.value[b];return new PearsonGL.Parameters.Parameter(c,"single",a.type)}function ca(a,b,c){if(t(arguments,3,"integer","single","The 'randomInteger' function requires three single cardinality integer parameters: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","integer");if(b.value<a.value)return new PearsonGL.Parameters.Parameter(a.value,"single","integer");var d=Math.floor((b.value-a.value)/c.value),e=Math.floor(Math.random()*(d+1));return e*=c.value,new PearsonGL.Parameters.Parameter(a.value+e,"single","integer")}function da(a,b){if(t(arguments,2,"numeric","single","The 'randomFloat' function requires two single cardinality numeric parameters: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","float");var c=b.value<a.value?a.value:Math.random()*(b.value-a.value)+a.value;return new PearsonGL.Parameters.Parameter(c,"single","float")}function ea(a){return t(arguments,1,"*","container","The 'containerSize' function requires one multiple or ordered cardinality parameter of any type: "),v(arguments)?new PearsonGL.Parameters.Parameter(0,"single","integer"):new PearsonGL.Parameters.Parameter(a.value.length,"single","integer")}function fa(a,b){var c="The 'index' function requires one multiple or ordered cardinality parameter and one single cardinality integer parameter: ";if(t(arguments,0,"*","*",c),v(arguments))return new PearsonGL.Parameters.Parameter(null,a.cardinality,a.type);if("ordered"!==a.cardinality&&"multiple"!==a.cardinality)throw c+"the first parameter is not multiple/ordered cardinality ("+a.cardinality+")";if("single"!==b.cardinality)throw c+"the second parameter is not single cardinality ("+b.cardinality+")";if("integer"!==b.type)throw c+"the second parameter is not an integer type ("+b.type+")";var d=Math.max(0,b.value-1);return d<a.value.length?new PearsonGL.Parameters.Parameter(a.value[d],"single",a.type):new PearsonGL.Parameters.Parameter(null,"single",a.type)}function ga(a){if(t(arguments,1,"*","*","The 'length' function requires one parameter that is a single cardinality string, or a container of any type: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","integer");if("string"!==a.type&&"ordered"!==a.cardinality&&"multiple"!==a.cardinality)throw"The 'length' function requires one parameter that is a single cardinality string, or a container of any type: found "+a.cardinality+" cardinality "+a.type;return new PearsonGL.Parameters.Parameter(a.value.length,"single","integer")}function ha(){t(arguments,0,"*","*","The 'multiple' function requires 0 or more single or multiple cardinality parameters of any type: ");for(var a=[],b=null,c=0;c<arguments.length;c++){if(null===b&&(b=arguments[c].type),arguments[c].type!==b){if(!("float"===arguments[c].type&&"integer"===b||"integer"===arguments[c].type&&"float"===b))throw"The 'multiple' function requires all parameters to be of the same type. Found '"+arguments[c].type+"', expected '"+b+"'";b="float"}null!==arguments[c].value&&(a=a.concat(arguments[c].value))}return 0===a.length&&(a=null),new PearsonGL.Parameters.Parameter(a,"multiple",b)}function ia(){t(arguments,0,"*","*","The 'ordered' function requires 0 or more single or ordered cardinality parameters of any type: ");for(var a=[],b=null,c=0;c<arguments.length;c++){if(null===b&&(b=arguments[c].type),arguments[c].type!==b){if(!("float"===arguments[c].type&&"integer"===b||"integer"===arguments[c].type&&"float"===b))throw"The 'ordered' function requires all parameters to be of the same type. Found '"+arguments[c].type+"', expected '"+b+"'";b="float"}null!==arguments[c].value&&(a=a.concat(arguments[c].value))}return 0===a.length&&(a=null),new PearsonGL.Parameters.Parameter(a,"ordered",b)}function ja(a,b){var c="The 'member' function requires two arguments of the same type, the first of single cardinality and the second multiple or ordered cardinality: ";if(t(arguments,0,"*","*",c),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","boolean");if("single"!==a.cardinality)throw c+"the first parameter is not single cardinality ("+a.cardinality+")";if("ordered"!==b.cardinality&&"multiple"!==b.cardinality)throw c+"the second parameter is not single cardinality ("+a.cardinality+")";if(a.type!==b.type)throw c+"the parameters must be of the same type, found: "+a.type+" and "+b.type;if("float"===a.type)throw c+"the 'member' function does not support float types";for(var d=0;d<b.value.length;d++)if("point"===a.type){if(a.value.x===b.value[d].x&&a.value.y===b.value[d].y)return new PearsonGL.Parameters.Parameter(!0,"single","boolean")}else if(a.value===b.value[d])return new PearsonGL.Parameters.Parameter(!0,"single","boolean");return new PearsonGL.Parameters.Parameter(!1,"single","boolean")}function ka(a){if(t(arguments,1,"*","ordered","The 'shuffleContainer' function requires one ordered cardinality parameter of any type: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"ordered",null);for(var b,c,d=a.value.slice(),e=d.length;0!==e;)c=Math.floor(Math.random()*e),e-=1,b=d[e],d[e]=d[c],d[c]=b;return new PearsonGL.Parameters.Parameter(d,"ordered",a.type)}function la(a){return t(arguments,1,"numeric","single","The 'integerToFloat' function requires one single cardinality integer parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","float"):new PearsonGL.Parameters.Parameter(a.value,"single","float")}function ma(a){var b="The 'sprintf' function requires one single cardinality string parameter and any number of single cardinality string parameters",c=Array.prototype.slice.call(arguments,1);t([a],1,"string","single",b),t(c,0,"*","single",b,1),c=c.map(function(a){return a.toString()});var d=vsprintf(a.value,c);return new PearsonGL.Parameters.Parameter(d,"single","string")}function na(a){if(t(arguments,1,"string","single","The 'stringToInteger' function requires one single cardinality string parameter: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","integer");var b=parseInt(a.value,10);return b=isNaN(b)?null:b,new PearsonGL.Parameters.Parameter(b,"single","integer")}function oa(a){return t(arguments,1,"numeric","single","The 'sin' function requires one single cardinality numeric parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","float"):new PearsonGL.Parameters.Parameter(Math.sin(a.value),"single","float")}function pa(a){return t(arguments,1,"numeric","single","The 'cos' function requires one single cardinality numeric parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","float"):new PearsonGL.Parameters.Parameter(Math.cos(a.value),"single","float")}function qa(a){return t(arguments,1,"numeric","single","The 'tan' function requires one single cardinality numeric parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","float"):new PearsonGL.Parameters.Parameter(Math.tan(a.value),"single","float")}function ra(a){return t(arguments,1,"numeric","single","The 'toDegrees' function requires one single cardinality numeric parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","float"):new PearsonGL.Parameters.Parameter(180*a.value/Math.PI,"single","float")}function sa(a){return t(arguments,1,"numeric","single","The 'toRadians' function requires one single cardinality numeric parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","float"):new PearsonGL.Parameters.Parameter(a.value*Math.PI/180,"single","float")}function ta(a){return t(arguments,1,"numeric","single","The 'abs' function requires one single cardinality numeric parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","float"):new PearsonGL.Parameters.Parameter(Math.abs(a.value),"single","float")}function ua(a,b,c){var d=arguments.length>2&&c.value,e="The 'reduce' function requires two single cardinality integer parameters and one optional single cardinality boolean parameter: ";if(t([a,b],2,"integer","single",e),arguments.length>2&&t([c],1,"boolean","single",e,2),v(arguments))return new PearsonGL.Parameters.Parameter(null,"ordered","integer");if(0===a.value)return d?new PearsonGL.Parameters.Parameter([0,a.value,Math.abs(b.value)],"ordered","integer"):new PearsonGL.Parameters.Parameter([a.value,Math.abs(b.value)],"ordered","integer");var f=r(a.value,b.value),g=(a.value<0||b.value<0)&&!(a.value<0&&b.value<0),h=0,i=Math.abs(a.value/f),j=Math.abs(b.value/f);return d?(i>j&&(h=Math.floor(i/j),i%=j),g&&(h>0?h*=-1:i*=-1),new PearsonGL.Parameters.Parameter([h,i,j],"ordered","integer")):(g&&(i*=-1),new PearsonGL.Parameters.Parameter([i,j],"ordered","integer"))}function va(a,b){if(t(arguments,2,"integer","single","The 'lcm' function requires two single cardinality integer parameters: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","integer");if(0===a.value||0===b.value)return new PearsonGL.Parameters.Parameter(0,"single","integer");var c=Math.abs(a.value*b.value)/Math.abs(r(a.value,b.value));return new PearsonGL.Parameters.Parameter(c,"single","integer")}function wa(a,b){if(t(arguments,2,"integer","single","The 'gcd' function requires two single cardinality integer parameters: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","integer");var c=Math.abs(r(a.value,b.value));return new PearsonGL.Parameters.Parameter(c,"single","integer")}function xa(a){return t(arguments,1,"numeric","single","The 'ceil' function requires one single cardinality numeric parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","integer"):new PearsonGL.Parameters.Parameter(Math.ceil(a.value),"single","integer")}function ya(a){return t(arguments,1,"numeric","single","The 'floor' function requires one single cardinality numeric parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","integer"):new PearsonGL.Parameters.Parameter(Math.floor(a.value),"single","integer")}function za(a){return t(arguments,1,"numeric","single","The 'round' function requires one single cardinality numeric parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","integer"):new PearsonGL.Parameters.Parameter(Math.round(a.value),"single","integer")}function Aa(a,b){if(t(arguments,2,"numeric","single","The 'roundTo' function requires one numeric and one integer single cardinality parameters: "),"integer"!==b.type)throw"The 'roundTo' function requires one numeric and one integer single cardinality parameters: ";if(v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","float");var c=Math.pow(10,Math.max(b.value,0)),d=a.value*c;return d=Math.round(d),d/=c,new PearsonGL.Parameters.Parameter(d,"single","float")}function Ba(a){return t(arguments,1,"numeric","single","The 'truncate' function requires one single cardinality numeric parameter: "),v(arguments)?new PearsonGL.Parameters.Parameter(null,"single","integer"):new PearsonGL.Parameters.Parameter(parseInt(a.value,10),"single","integer")}function Ca(a,b){t([b],1,"string","single","The 'variable' function requires one single cardinality string parameter: ");var c,d=b.value,e=d.match(/(.+?)\.(.+)/);if(e&&(a=PearsonGL.globals.player.getGadgetByID(e[1]),d=e[2]),a&&"function"==typeof a.getVariable){if(!((c=a.getVariable(d))instanceof PearsonGL.Parameters.Parameter))throw"The 'variable' function required that a gadget return a Parameter object.  Found: '"+c+"'";return c}return new PearsonGL.Parameters.Parameter(null,null,null)}function Da(a,b){t([b],1,"string","single","The 'getAsset' function requires one single cardinality string parameter: ");for(assetKey in a)if(assetKey.indexOf(b.value)>=0)return new PearsonGL.Parameters.Parameter(a[assetKey],"single","string");throw"The 'getAsset' function could not access undefined asset name '"+b.value+"'"}function Ea(a,b){var c="The 'urlParameter' function requires one single cardinality string parameter and one parameter of any cardinality and type: ";if(t([a],1,"string","single",c),t([b],1,"*","*",c,1),v(arguments))return new PearsonGL.Parameters.Parameter(null,null,null);var d=b.value+"",e=Pa.getQuerystring(a.value,d);return e===d?b.clone():j(decodeURIComponent(e))}function Fa(a){return/<svg/i.test(a)}function Ga(a,b,c,d,e){var f="";if(d=d||0,e=e||0,Fa(a.value)){var g=$(a.value);g.attr("x",d),g.attr("y",e),f+=$("<div></div>").append(g).html()}else f+='<image xlink:href="'+PearsonGL.qtiEvaluator.evaluateAsset(a.value)+'" x="'+d+'" y="'+e+'" width="'+b+'" height="'+c+'"/>';return f}function Ha(a){var b=100,c=100;if(Fa(a.value)){var d=$(a.value);b=parseFloat(d.attr("width")),c=parseFloat(d.attr("height"))}return{width:b,height:c}}function Ia(a,b,c){var d="The 'createSVG' function requires two single cardinality numeric parameters and one single cardinality string parameter: ";if(t([a,b],2,"numeric","single",d),arguments.length>2&&t([c],1,"string","single",d,2),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","string");a=a.value||100,b=b.value||100;var e='<svg width="'+a+'" height="'+b+'" viewBox="0 0 '+a+" "+b+'">';return c&&(e+=Ga(c,a,b)),e+="</svg>",new PearsonGL.Parameters.Parameter(e,"single","string")}function Ja(a,b,c,d){var e="The 'repeatSVG' function requires a single cardinality string parameter, a single cardinality integer parameter, a single cardinality string parameter and an optional single cardinality numeric parameter: ";if(t([a],1,"string","single",e),t([b],1,"integer","single",e,1),t([c],1,"string","single",e,2),arguments.length>3?t([d],1,"numeric","single",e,3):d=new PearsonGL.Parameters.Parameter(0,"single","integer"),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","string");if(b.value<=0)return new PearsonGL.Parameters.Parameter('<svg width="0" height="0" viewBox="0 0 0 0" x="0" y="0"></svg>',"single","string");b=b.value;var f,g,h=Ha(a),i=h.width*b,j=h.height,k='<svg width="',l=0,m=0;switch(c.value){case"horizontal":for(i+=d.value*(b-1),k+=i+'" height="'+j+'" viewBox="0 0 '+i+" "+j+'">',f=0;f<b;f++)k+=Ga(a,h.width,h.height,l,m),l=l+h.width+d.value;break;case"9dot":i=3*h.width+2*d.value,j=3*h.height+2*d.value,k+=i+'" height="'+j+'" viewBox="0 0 '+i+" "+j+'">';var n=[];for(f=0;f<3;f++){for(g=0;g<3;g++)n.push({x:l,y:m}),l=l+h.width+d.value;m=m+h.height+d.value,l=0}var o=[];switch(b){case 1:o=[4];break;case 2:o=[2,6];break;case 3:o=[2,4,6];break;case 4:o=[0,2,6,8];break;case 5:o=[0,2,4,6,8];break;case 6:o=[0,2,3,5,6,8];break;case 7:o=[0,2,3,4,5,6,8];break;case 8:o=[0,1,2,3,5,6,7,8];break;case 9:o=[0,1,2,3,4,5,6,7,8]}for(f=0;f<o.length;f++)k+=Ga(a,h.width,h.height,n[o[f]].x,n[o[f]].y);break;case"vertical":for(i=h.width,j=h.height*b+d.value*(b-1),k+=i+'" height="'+j+'" viewBox="0 0 '+i+" "+j+'">',f=0;f<b;f++)k+=Ga(a,h.width,h.height,l,m),m=m+h.height+d.value}return new PearsonGL.Parameters.Parameter(k+"</svg>","single","string")}function Ka(a,b,c,d,e){var f="The 'textOnSVG' function requires a single cardinality string parameter, two single cardinality numeric parameters, a single cardinality string parameter and an optional single cardinality string parameter: ";if(t([a],1,"string","single",f),t([b,c],2,"numeric","single",f,1),t([d],1,"string","single",f,3),arguments.length>4?t([e],1,"string","single",f,4):e=new PearsonGL.Parameters.Parameter("","single","string"),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","boolean");var g=Ha(a),h='<svg width="'+g.width+'" height="'+g.height+'" viewBox="0 0 '+g.width+" "+g.height+'">';return h+=a.value,d.value.indexOf("<math ")>-1||d.value.indexOf("<math>")>-1?h+='<foreignObject x="'+b+'" y="'+c+'" width="100" height="100"><body xmlns="http://www.w3.org/1999/xhtml"><div class="'+e+'">'+d+"</div></body></foreignObject></svg>":h+='<text x="'+b+'" y="'+c+'" class="'+e.value+'">'+d+"</text></svg>",new PearsonGL.Parameters.Parameter(h,"single","string")}function La(a,b,c,d){var e="The 'compositeSVG' function requires a single cardinality string parameter, two single cardinality numeric parameters, and a single cardinality string parameter: ";if(t([a],1,"string","single",e),t([b,c],2,"numeric","single",e,1),t([d],1,"string","single",e,3),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","string");var f=Ha(a),b=b&&b.value||0,c=c&&c.value||0,g='<svg width="'+f.width+'" height="'+f.height+'" viewBox="0 0 '+f.width+" "+f.height+'">';return g+=Ga(a,f.width,f.height),f=Ha(d),g+=Ga(d,f.width,f.height,b,c),new PearsonGL.Parameters.Parameter(g+"</svg>","single","string")}function Ma(a,b){if(t(arguments,2,"string","single","The 'transformSVG' function requires two single cardinality string parameters: "),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","string");var c=Ha(a),d=$(a.value),e=$('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>'),f=$("<g></g>");e.attr("width",c.width),e.attr("height",c.height),e.attr("viewBox",d.attr("viewBox")),e.append(f),f.attr("transform",b.value),f.append(d);var g=$("<div></div>").append(e).html();return new PearsonGL.Parameters.Parameter(g,"single","string")}function Na(a,b){var c="The 'rotateSVG' function requires one single cardinality string parameter and one single cardinality numeric parameter: ";if(t([a],1,"string","single",c),t([b],1,"numeric","single",c,1),v(arguments))return new PearsonGL.Parameters.Parameter(null,"single","string");var d=Ha(a),e=$(a.value),f=$('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>'),g=$("<g></g>"),h="rotate("+b.value+", "+d.width/2+", "+d.height/2+")";f.attr("width",d.width),f.attr("height",d.height),f.attr("viewBox",e.attr("viewBox")),f.append(g),g.attr("transform",h),g.append(e);var i=$("<div></div>").append(f).html();return new PearsonGL.Parameters.Parameter(i,"single","string")}var Oa={},Pa=PearsonGL.utils,Qa=null,Ra=!1,Sa={string:d,boolean:e,integer:f,float:g,point:h},Ta={boolean:function(a){return!!a},integer:function(a){var b=parseInt(a);if(isNaN(b))throw"cannot convert the value '"+a+"' to an integer";return b},float:function(a){var b=parseFloat(a);if(isNaN(b))throw"cannot convert the value '"+a+"' to a float";return b},point:function(a){throw"cannot convert value '"+a+"' to a point"}};return this.delete=function(a,b){var c="The 'delete' function requires two parameters of the same type, the first parameter must be single cardinality, the second must be multiple or ordered: ";if(t(arguments,2,"*","*",c),v(arguments))return new PearsonGL.Parameters.Parameter(null,b.cardinality?b.cardinality:null,b.type?b.type:null);if(a.type!==b.type)throw c+"the parameter types do not match ('"+a.type+"', '"+b.type+"')";if("single"!==a.cardinality)throw c+"the first parameter is not single cardinality ("+b.cardinality+")";if("multiple"!==b.cardinality&&"ordered"!==b.cardinality)throw c+"the second parameter is not multiple/ordered cardinality ("+b.cardinality+")";for(var d=[],e=0;e<b.value.length;e++)"point"===a.type?a.value.x===b.value[e].x&&a.value.y===b.value[e].y||d.push(b.value[e]):a.value!==b.value[e]&&d.push(b.value[e]);return new PearsonGL.Parameters.Parameter(d,b.cardinality,b.type)},Oa.replaceParameters=a,Oa.evaluateAsset=b,Oa.evaluateExpression=c,Oa.evaluateString=d,Oa.evaluateInteger=f,Oa.evaluateFloat=g,Oa.evaluateBoolean=e,Oa.evaluatePoint=h,Oa.getQTIFunctionArgs=m,Oa.validateParameterArgs=t,Oa.validateParameter=u,Oa.anyParamsNull=v,Oa.isParamNull=w,Oa.enableTestCaseMode=o,Oa.equal=x,Oa.gt=y,Oa.gte=z,Oa.lt=A,Oa.lte=B,Oa.and=C,Oa.or=D,Oa.not=E,Oa.isNull=F,Oa.ternary=G,Oa.substring=H,Oa.stringMatch=I,Oa.concat=J,Oa.stringReplace=K,Oa.partial=L,Oa.numCommas=M,Oa.numMinusSign=N,Oa.numCurrency=O,Oa.numDecimals=P,Oa.numToString=Q,Oa.sum=R,Oa.subtract=S,Oa.product=T,Oa.divide=U,Oa.power=V,Oa.max=W,Oa.min=X,Oa.integerDivide=Y,Oa.integerModulus=Z,Oa.mean=_,Oa.createNumSequence=aa,Oa.random=ba,Oa.randomInteger=ca,Oa.randomFloat=da,Oa.containerSize=ea,Oa.delete=this.delete,Oa.index=fa,Oa.length=ga,Oa.multiple=ha,Oa.ordered=ia,Oa.member=ja,Oa.shuffleContainer=ka,Oa.integerToFloat=la,Oa.sprintf=ma,Oa.stringToInteger=na,Oa.sin=oa,Oa.cos=pa,Oa.tan=qa,Oa.toDegrees=ra,Oa.toRadians=sa,Oa.abs=ta,Oa.reduce=ua,Oa.lcm=va,Oa.gcd=wa,Oa.ceil=xa,Oa.floor=ya,Oa.round=za,Oa.roundTo=Aa,Oa.truncate=Ba,Oa.variable=Ca,Oa.getAsset=Da,Oa.urlParameter=Ea,Oa.textOnSVG=Ka,Oa.repeatSVG=Ja,Oa.compositeSVG=La,Oa.createSVG=Ia,Oa.transformSVG=Ma,Oa.rotateSVG=Na,Oa}(),window.PearsonGL=window.PearsonGL||{},window.PearsonGL.globals=window.PearsonGL.globals||{},window.PearsonGL.Parameters=window.PearsonGL.Parameters||{},PearsonGL.parmMgr=function(){function a(a,b,c){this.type=a,this.parm=b,this.expression=c,this.children=[]}function b(a){["images","audio","video","asset"].forEach(function(b){var c=L[b];G.isNonEmptyArray(a[b])&&a[b].forEach(function(a){if(G.isNonEmptyString(a.src)){var b=a.src.replace(/^.*[\\\/]/,"");K[b]=a.src,c[b]=a.src}})})}function c(a){G.isNonEmptyArray(a.parameters)&&a.parameters.forEach(function(a){if(G.isNonEmptyString(a.name))try{M[g(a.name)]=H.evaluateExpression(a.value,a.cardinality,a.type,null,M)}catch(b){throw"Unable to parse default basic parameter '"+a.name+"': "+b}}),G.isNonEmptyArray(a.richtext)&&a.richtext.forEach(function(a){if(G.isNonEmptyString(a.name))try{var b=a.value.replace(/^<p>/,"").replace(/<\/p>$/,"");M[g(a.name)]=H.evaluateExpression(b,"single","string",null,M)}catch(b){throw"Unable to parse default rich text value '"+a.name+"': "+b}}),G.isNonEmptyArray(a.plaintext)&&a.plaintext.forEach(function(a){if(G.isNonEmptyString(a.name))try{M[g(a.name)]=H.evaluateExpression(a.value,"single","string",null,M)}catch(b){throw"Unable to parse default plain text value '"+a.name+"': "+b}}),G.isNonEmptyArray(a.audioseq)&&a.audioseq.forEach(function(a){if(G.isNonEmptyString(a.name))try{var b=g(a.name),c=[],d="";G.isNonEmptyArray(a.seq)&&a.seq.forEach(function(a){G.isNonEmptyString(a.src)&&c.push(h(a.src)),G.isNonEmptyString(a.exp)&&c.push(h(a.exp))}),d="["+c.join(", ")+"]",M[b]=H.evaluateExpression(d,"ordered","string",null,M),M[b].evalExpressionAlways=!0,P.push(b)}catch(b){throw"Unable to parse default audio sequence value '"+a.name+"': "+b}})}function d(a){G.isNonEmptyArray(a)&&a.forEach(function(a){O.push(e(a))})}function e(b){var c=new a(b.rule,b.parm,b.exp),d=b.rules;return G.isNonEmptyArray(d)&&d.forEach(function(a){c.children.push(e(a))}),c}function f(a){var b=G.getQuerystring("testcase",null),c=/^\d+$/.test(b)?parseInt(b,10)-1:null;if(null!==c&&c>=0&&c<a.length){var d=a[c];G.isNonEmptyArray(d.functions)&&(Q={description:d.description,origParameters:[],parameters:[]},d.functions.forEach(function(a){try{"*"===a.value?Q.origParameters.push({name:g(a.name),parameter:new PearsonGL.Parameters.Parameter("*",null,null,null)}):Q.origParameters.push({name:g(a.name),parameter:H.evaluateExpression(a.value,a.cardinality,a.type,null,M)})}catch(b){throw"Unable to parse test case substitution '"+a.name+"': "+b}}),Q.parameters=l(Q.origParameters),H.enableTestCaseMode(),PearsonGL.logger.log("parameter manager loading test case "+(c+1)),PearsonGL.logger.table(Q.origParameters))}else PearsonGL.utils.isNonEmptyString(b)&&PearsonGL.logger.warn("invalid test case ID given to parameter manager: "+b)}function g(a){return/^~/.test(a)?a:"~"+a}function h(a){return/^".*"$/.test(a)||/^'.*'$/.test(a)?a:'"'+a+'"'}function i(a){var b,d,e=0,f=Date.now();do{d={constraintsSatisfied:!0,hasExited:!1,constraintRules:[]},e>0&&(Q&&(R=0,Q.parameters=l(Q.origParameters)),M={},c(a)),N=k(M),PearsonGL.logger.groupCollapsed("Evaluating rules, attempt "+e),j(O,N,d,0),PearsonGL.logger.groupEnd(),d.constraintsSatisfied&&(d.constraintsSatisfied=d.constraintRules.every(function(a){return H.evaluateBoolean(a.expression,null,N).value})),e++}while(!d.constraintsSatisfied&&e<I);d.constraintsSatisfied||(N=k(M)),b=Date.now()-f,d.constraintsSatisfied?(PearsonGL.logger.log("Rule evaluation succeeded in %s ms, %s attempts. Using evaluated parameter values:",b,e),n("parameters_success",e)):(PearsonGL.logger.log("Rule evaluation failed in %s ms, %s attempts. Using default parameter values:",b,e),n("parameters_failure",e)),PearsonGL.logger.table(N,["expression","cardinality","type","value"])}function j(a,b,c,d){var e,f,h,i,k,l=null,m=void 0,n="";for(e=0;e<d;e++)n+="  ";a:for(e=0;e<a.length&&(h=a[e],f=!0,c.constraintsSatisfied&&!c.hasExited);e++)if("elseif"!==h.type&&"else"!==h.type||(f=("if"===l||"elseif"===l)&&!m),PearsonGL.logger.log("%c%s%s %s %s",f?"":"color: #CCC;",n,h.type,h.parm?h.parm:"",h.expression?h.expression:""),f)switch(l=h.type,m=null,h.type){case"if":case"elseif":m=H.evaluateBoolean(h.expression,null,b).value,m&&G.isNonEmptyArray(h.children)&&j(h.children,b,c,d+1);break;case"else":G.isNonEmptyArray(h.children)&&j(h.children,b,c,d+1);break;case"set":if(!((k=g(h.parm))in b))throw"Unable to set undefined parameter '"+k+"'";i=b[k];try{b[k]=H.evaluateExpression(h.expression,i.cardinality,i.type,null,N),b[k].evalExpressionAlways=i.evalExpressionAlways}catch(a){throw"Unable to set parameter '"+k+"': "+a}break;case"constraint":if(c.constraintRules.push(h),!H.evaluateBoolean(h.expression,null,b).value){c.constraintsSatisfied=!1;break a}break;case"exit":c.hasExited=!0;break a}}function k(a){var b,c={};for(parameterName in a)b=a[parameterName],c[parameterName]=b.clone();return c}function l(a){return a.map(function(a){return{name:a.name,parameter:a.parameter.clone()}})}function m(){PearsonGL.globals&&PearsonGL.globals.comm&&PearsonGL.globals.comm.sendMessage&&PearsonGL.globals.comm.sendMessage("setDebugData",N)}function n(a,b){S.label=a,S.value=b,PearsonGL.globals.comm&&PearsonGL.globals.comm.sendAnalytics(S)}function o(a){return a?(PearsonGL.globals.player&&PearsonGL.globals.player.runtimeJson&&(S.action=PearsonGL.globals.player.runtimeJson.product+" "+PearsonGL.utils.getScoId()),b(a),f(a.test),c(a),d(a.rules),i(a),p(),PearsonGL.logger.isEnabled()&&m(),N):void console.log("no parameters json data available")}function p(){var a,b,c,d=!1;if(PearsonGL.globals&&PearsonGL.globals.comm&&"normal"===PearsonGL.globals.comm.getMode()){b=PearsonGL.globals.comm.getSuspendData();try{if((b=JSON.parse(b))&&b.pages&&Array.isArray(b.pages))for(c=0;c<b.pages.length;c++)if(a=b.pages[c],a.id&&"playerParms"===a.id&&a.data){d=!0,r(a.data);break}}catch(a){}d||PearsonGL.globals.comm.setSuspendDataById("playerParms","playerParms",q())}}function q(){var a={};for(paramName in N)a[paramName]=N[paramName].serialize();return a}function r(a){var b,c;for(paramName in a)v(paramName)&&(b=a[paramName],c=N[paramName],c.value=b.val,c.expression=b.exp,c.evalExpression=b.ev,c.evalExpressionAlways=b.eva)}function s(){M={},N={},P.length=0,O.length=0}function t(a){return a?k(N):N}function u(a){return a?k(M):M}function v(a){return(a=g(a))in N}function w(a,b){return a=g(a),v(a)?b?N[a]:N[a].clone():null}function x(a,b,c){if(a=g(a),b+="",!v(a))throw"Unable to set undefined parameter '"+a+"'";try{var d=N[a],e=H.evaluateExpression(b,d.cardinality,d.type,null,N);d.value=e.value,d.expression=b,d.evalExpression=e.evalExpression,"boolean"==typeof c&&(d.evalExpressionAlways=c)}catch(b){throw"Unable to set parameter '"+a+"': "+b}}function y(a){if(a=g(a),v(a)){var b=N[a];if((b.evalExpression||b.evalExpressionAlways)&&G.isNonEmptyString(b.expression)){var c=H.evaluateExpression(b.expression,b.cardinality,b.type,null,N);b.value=c.value,b.evalExpression=c.evalExpression}return b.value}throw"Unable to get value for undefined parameter '"+a+"'"}function z(a){a=g(a);var b=N[a];return b?Array.isArray(b.value)?b.value.join(""):b.value:a}function A(a){return H.evaluateString(a,null,N).value}function B(a){for(assetKey in K)if(assetKey.indexOf(a)>=0)return K[assetKey];throw"Unable to get path for undefined asset '"+a+"'"}function C(a){return a in L?L[a]:K}function D(){return P}function E(){return Q&&R<Q.parameters.length?Q.parameters[R].name:null}function F(){return Q&&R<Q.parameters.length?Q.parameters[R++]:null}var G=PearsonGL.utils,H=PearsonGL.qtiEvaluator,I=100,J={},K={},L={images:{},audio:{},video:{},asset:{}},M={},N={},O=[],P=[],Q=null,R=0,S={category:"ParametersManager",eventType:"event"};return J.parseParmJson=o,J.clear=s,J.getEvaluatedParameters=t,J.getDefaultParameters=u,J.getParmJsonObj=q,J.restoreParmJsonObj=r,J.isParm=v,J.getParm=w,J.getParameter=w,J.getValue=y,J.getDisplay=z,J.replaceParameters=A,J.getAsset=B,J.getAssets=C,J.getAudioSeqParms=D,J.setParameter=x,J.getNextSubstitutionFunctionName=E,J.getNextSubstitution=F,J}(),window.PearsonGL=window.PearsonGL||{},window.PearsonGL.globals=window.PearsonGL.globals||{},PearsonGL.GoogleAnalytics=function(a){this.setAllowSendAnalytics(!1),this.initialize(a)},PearsonGL.GoogleAnalytics.prototype={initialize:function(a){this.setAllowSendAnalytics(a.useGoogleAnalytics),this.productNameId=a.product+" "+PearsonGL.utils.getScoId(),this.allowSendAnalytics&&(this.findFile("analytics.js")&&this.findFile("analytics.min.js")||function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",a.googleAnalytics,{userId:PearsonGL.globals.player.settings.user.userId,cookieDomain:"none"}))},setAllowSendAnalytics:function(a){this.allowSendAnalytics=!!a},findFile:function(a){var b,c=document.getElementsByTagName("script");for(b=0;b<c.length;b++)if(c[b].src.substr(-a.length)===a)return!0;return!1},sendAnalytics:function(a){this.allowSendAnalytics&&(ga("set","dimension1",PearsonGL.globals.player.settings.user.userRole),ga("set","dimension2",PearsonGL.globals.player.settings.user.userOrg),ga("send",a.eventType,a.category,a.action,a.label,$.isNumeric(a.value)?Math.round(a.value):void 0),ga("send","pageview",{hitCallback:function(){}}))}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.GadgetBase=function(a,b){this.gadgetUniqueId=b,this.state={doFocusTrap:null,focusTrap:null,focusDialog:$()};var c={playalt:"Play",pausealt:"Pause"},d={runtimejson:{lang:"en",authoring:{}},domain:[],scorm:{id:this.gadgetUniqueId,interactions:[]},keyCodes:{enter:13,space:32,tab:9,backspace:8,left:37,up:38,right:39,down:40},objectType:"gadget"};"object"===_typeof(this.labelOpts)?$.extend(this.labelOpts,c):this.labelOpts=c,"object"===_typeof(this.options)?$.extend(this.options,d):this.options=d,this.isTouchDevice=window.PearsonGL.utils.isTouch(),this.config&&(this.options.scormOn=this.config.scormOn),$.extend(!0,this.options,a),this.productName="na",PearsonGL.globals.player&&PearsonGL.globals.player.settings&&PearsonGL.globals.player.settings.product&&(this.productName=PearsonGL.globals.player.settings.product),this.analyticsData={category:this.options.gadgetName,eventType:"event",action:this.productName+" "+window.PearsonGL.utils.getScoId()},this.isDirty=!1,0===$(".popupsound").length&&$("body").prepend("<div class='popupsound'></div>");var e=this;$(document).on("componentRequest",function(a,b){switch(a.stopImmediatePropagation(),b.call){case"addAccessibility":e.addAccessibility(b.selector);break;case"addLongDescription":e.addLongDescription(b.selector,b.longDesc);break;case"sendAnalytics":e.sendAnalytics(b.action,b.value)}})},PearsonGL.Gadget.GadgetBase.prototype.constructor=window.PearsonGL.Gadget.GadgetBase,PearsonGL.Gadget.GadgetBase.prototype.initGadget=function(a){this.options.gadgetName=a,this.analyticsData.category=this.options.gadgetName},PearsonGL.Gadget.GadgetBase.prototype.isCommEnabled=function(a){return!(!PearsonGL.globals||!PearsonGL.globals.comm)&&(!(!a||!a.windowPostMessage)||this.options.scorm.interactions.length>0)},PearsonGL.Gadget.GadgetBase.prototype.addAccessibility=function(a){try{if(void 0!==this.options.dlink&&this.options.dlink.length>0){var b=this,c=$('<div class="skip-link accessibility-links">'+global_player.utilSkipLinkText+"</div>");c.attr({role:"button",tabindex:"0"}).click(function(a){a.preventDefault(),a.stopPropagation(),b.openDLink()}).keypress(function(a){13==a.which&&(a.preventDefault(),a.stopPropagation(),b.openDLink())}),a.prepend(c)}}catch(a){}},PearsonGL.Gadget.GadgetBase.prototype.addLongDescription=function(a,b,c,d){try{if(void 0!==b&&b.length>0){var e=this,f=$('<div class="long-desc-link hidden-label">'+global_player.utilLongDescText+"</div>"),g=0,h=0;-1===d&&(h=-1),void 0!==c&&(g=c),f.attr({role:"button",tabindex:h,"data-id":g}).click(function(a){a.preventDefault(),a.stopPropagation(),e.openDLink(b)}).keypress(function(a){13!=a.which&&32!=a.which||(a.preventDefault(),a.stopPropagation(),e.openDLink(b))}),f.insertAfter(a)}}catch(a){}},PearsonGL.Gadget.GadgetBase.prototype.skipCurrentGadget=function(){var a=this.jObject;0===a.find(".skipGadgetEnd").length&&a.append('<div class="skipGadgetEnd" tabindex="0" aria-hidden="true" role="presentation"></div>'),a.find(".skipGadgetEnd").focus()},PearsonGL.Gadget.GadgetBase.prototype.activateFocusTrap=function(){this.state.focusTrap.activate()},PearsonGL.Gadget.GadgetBase.prototype.deactivateFocusTrap=function(){this.state.focusTrap.deactivate()},PearsonGL.Gadget.GadgetBase.prototype.addFocusTrap=function(a){var b=a.focusDialog[0];this.state.focusDialog=a.focusDialog;var c={nodeFocusedBeforeActivation:a.returnFocusTo};this.state.doFocusTrap=new PearsonGL.utils.doFocusTrap(b,c),this.state.focusTrap=this.state.doFocusTrap.focusTrap(b,{onActivate:function(){b.classList.add("trap","is-active")},onDeactivate:function(){b.classList.remove("trap","is-active")},initialFocus:this.state.focusDialog,escapeDeactivates:!0,nodeFocusedBeforeActivation:c.nodeFocusedBeforeActivation})},PearsonGL.Gadget.GadgetBase.prototype.openDLink=function(a){var b,c,d=this,e="",f="",g=PearsonGL.utils.randomString(8)+PearsonGL.utils.randomString(8),h=$(".description-pop-up"),i=!1,j=$(".dialog-modal");if(0===j.length?($("body").append('<div class="dialog-modal"></div>'),j.show()):j.show(),void 0!==this.options.dlink&&this.options.dlink.length>0&&(i=!0,this.sendAnalytics("accessed_equivalent_activity"),this.options.scorm.interactions.length>0&&this.options.scorm.interactions[0].objectives.length>0&&(e='<div class="altActivityPoints hidden-label" role="button" aria-label="'+global_player.utilDlinkPointsText+'" tabindex="0"></div>'),$("body").prepend('<div aria-labelledby="'+g+'" class="description-pop-up"><label id="'+g+'" class="popup-disc hidden-label"></label><div class="popup-header"><div class="dlink-title" aria-hidden="true" role="presentation">'+global_player.utilDlinkWinTitle+'</div></div><div class="dialog-content" tabindex="0"></div>'+e+'<div class="dialog-close-btn" title="'+global_player.utilCloseDlinkText+'" data-icon="ic-close-btn" role="button"></div></div>'),b=$(".dialog-content"),b.html(""),b.append(this.options.dlink),b.focus(),f=$(".altActivityPoints"),f.click(function(a){if(a.preventDefault(),d.giveAllPoints=!0,d.options.scorm.interactions.length>0)for(c=0;c<d.options.scorm.interactions.length;c++)d.options.scorm.interactions[c].objectives[0].success_status="passed",d.options.scorm.interactions[c].objectives[0].completion_status="completed",d.options.scorm.interactions[c].objectives[0].score.raw=d.options.scorm.interactions[c].objectives[0].score.max;d.options.scormOn&&d.setScormData()})),this.giveAllPoints=!1,a&&a.length>0){i=!1,this.sendAnalytics("accessed_long_description"),f&&f.remove(),$("body").prepend('<div aria-labelledby="'+g+'" class="description-pop-up"><label id="'+g+'" class="popup-disc hidden-label"></label><div class="popup-header"><div class="dlink-title" aria-hidden="true" role="presentation">'+global_player.utilLongDescTitle+'</div></div><div class="dialog-content" tabindex="0"></div><div class="dialog-close-btn" aria-label="'+global_player.utilCloseDescText+'" data-icon="ic-close-btn" role="button" tabindex="0"></div></div>'),b=$(".dialog-content"),b.html(""),b.append(a);var k={focusDialog:$("body").find(".description-pop-up"),returnFocusTo:PearsonGL.utils.getActiveElement()};this.addFocusTrap(k),this.activateFocusTrap(),a=""}h.show(),$(document).unbind().keydown(function(a){"Escape"!==a.key&&"Esc"!==a.key&&27!==a.keyCode||($(".description-pop-up").remove(),$(".dialog-modal").hide(),i?d.skipCurrentGadget():$(".long-desc-link").focus())}),$(".description-pop-up .dialog-close-btn").unbind().click(function(){$(".description-pop-up").remove(),$(".dialog-modal").hide(),d.deactivateFocusTrap(),i?d.skipCurrentGadget():$(".long-desc-link").focus()}).keypress(function(a){13!==a.keyCode&&32!==a.keyCode||($(".description-pop-up").remove(),$(".dialog-modal").hide(),d.deactivateFocusTrap(),i?d.skipCurrentGadget():$(".long-desc-link").focus())}).keydown(function(a){9===a.keyCode&&(i?d.skipCurrentGadget():$(".long-desc-link").focus())}).sliderbutton({buttonClassName:"dialog-close-btn",slider:!1}),$(".description-pop-up .dialog-close-btn").hover(function(){$(this).toggleClass("dialog-close-btn-over")}).mousedown(function(){$(this).addClass("dialog-close-btn-down")}).mouseup(function(){$(this).removeClass("dialog-close-btn-down"),i?d.skipCurrentGadget():$(".long-desc-link").focus()}),$(".dialog-content").focus(),PearsonGL.utils.initMathJax()},PearsonGL.Gadget.GadgetBase.prototype.sendAnalytics=function(a,b){if(PearsonGL.globals&&PearsonGL.globals.comm&&this.analyticsData){var c=$(this.jObject.closest().find("[data-id]").context);this.gadgetUniqueId&&void 0!==this.gadgetUniqueId||(this.gadgetUniqueId=c.attr("data-id")),this.analyticsData.label=this.gadgetUniqueId+" "+a,this.analyticsData.value=b,this.gadgetUniqueId&&void 0!==this.gadgetUniqueId&&PearsonGL.globals.comm.sendAnalytics(this.analyticsData)}},PearsonGL.Gadget.GadgetBase.prototype.gadgetPageShowEvent=function(){},PearsonGL.Gadget.GadgetBase.prototype.getjObject=function(){return this.jObject},PearsonGL.Gadget.GadgetBase.prototype.createRichTextObj=function(a,b,c){var d=this;return void 0==b&&(b=!1),{value:a,noTabIndex:b,highlightingEnabled:d.options.runtimejson.highlightingEnabled,domains:d.options.runtimejson.authoring.Domains,saveText:function(){d.saveHighLightTextInGadget()},sendAnalytics:function(a,b){d.sendAnalytics(a,b)},highlightArea:c}},PearsonGL.Gadget.GadgetBase.prototype.saveHighLightTextInGadget=function(){this.jObject},PearsonGL.Gadget.GadgetBase.prototype.goThroughHighLights=function(a){var b=(this.jObject,"%%%%%%");a.find(".highlight-identifier").each(function(){$(this).before(b).after(b),$(this).contents().unwrap()})},PearsonGL.Gadget.GadgetBase.prototype.getVariable=function(a){return console.error(this.options.gadgetName+" gadget ID "+this.gadgetUniqueId+" must override the getVariable function"),new PearsonGL.Parameters.Parameter(null,"single","string")},PearsonGL.Gadget.GadgetBase.prototype.getLearnerData=function(a){if(this.isCommEnabled()){var b={id:this.gadgetUniqueId,objectiveDesc:this.options.objectiveDescription,name:this.options.gadgetName,objectType:this.options.objectType,data:this.options.scorm,weighting:1,results:[{correctResponses:"not played",learnerResponse:[]}]};$.extend(!0,b,a),PearsonGL.globals.comm.getLearnerData(b),this.options.scorm.suspendData&&this.parseLearnerData()}},PearsonGL.Gadget.GadgetBase.prototype.setLearnerData=function(a){var b={id:this.gadgetUniqueId,data:this.options.scorm,weighting:1};$.extend(!0,b,a),this.isCommEnabled()&&PearsonGL.globals.comm.setLearnerData(b)},PearsonGL.Gadget.GadgetBase.prototype.parseLearnerData=function(){},PearsonGL.Gadget.GadgetBase.prototype.saveIfNeeded=function(){},PearsonGL.Gadget.GadgetBase.prototype.pause=function(){},PearsonGL.Gadget.GadgetBase.prototype.resume=function(){},PearsonGL.Gadget.GadgetBase.prototype.start=function(){},PearsonGL.Gadget.GadgetBase.prototype.stop=function(){},PearsonGL.Gadget.GadgetBase.prototype.destroy=function(){},PearsonGL.Gadget.GadgetBase.prototype.enable=function(){},PearsonGL.Gadget.GadgetBase.prototype.authMode=function(a){},PearsonGL.Gadget.GadgetBase.prototype.gadgetUnload=function(){this.setLearnerData()},PearsonGL.Gadget.GadgetBase.prototype.gadgetPageShowEvent=function(){},PearsonGL.Gadget.GadgetBase.prototype.completeActivity=function(){},window.PearsonGL=window.PearsonGL||{},window.PearsonGL.CommunicatorBase=function(){this.passingScore=.6,this.completionThreshold=1},window.PearsonGL.CommunicatorBase.prototype={isReady:function(){},sendKeepAlive:function(){},sendShowLogoutDialog:function(){},sendMessage:function(a,b){},getLearnerData:function(a){},setLearnerData:function(a){},getSuspendData:function(a){},setSuspendDataById:function(a,b,c){},isExceededSuspendDataLimit:function(a,b){return!1},getPassingScore:function(){return-1},isConnected:function(){return!1},commit:function(){},submit:function(){},setScoreStatus:function(a){},setTotalScore:function(a){},getBookmark:function(){},setBookmark:function(a){},startAudioByClicked:function(){},getMode:function(){},finish:function(){},exit:function(){},saveState:function(){}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};window.PearsonGL=window.PearsonGL||{},PearsonGL.CommunicatorScorm=function(){if(window.PearsonGL.CommunicatorBase.call(this),"true"!==this.init())throw new Error("Failed to initialize SCOBOT")},PearsonGL.CommunicatorScorm.prototype=Object.create(window.PearsonGL.CommunicatorBase.prototype),PearsonGL.CommunicatorScorm.prototype.init=function(){var a;if(!window.skipExecution){var b=this;if(PearsonGL.globals.useLocalStorage&&"function"==typeof scobot_local){"browse"===PearsonGL.utils.getQuerystring("cmimode",null)?PearsonGL.globals.useLocalStorage=!1:a=scobot_local();try{PearsonGL.globals.hasLocalStorage="localStorage"in window&&null!=window.localStorage}catch(a){}}if(scorm=new SCORM_API({debug:!1,throw_alerts:!1,exit_type:"suspend",success_status:"unknown",cmi:a}),SB=new SCOBot({completion_threshold:1,scaled_passing_score:.6}),this.scoBot=SB,$(scorm).on("StoreData",function(a){"use strict";PearsonGL.globals.hasLocalStorage&&PearsonGL.globals.useLocalStorage&&(localStorage.setItem(PearsonGL.utils.getScoId(),JSON.stringify(a.runtimedata)),b.scoBot.debug("Call to Store Data was made.",3),b.scoBot.debug(a.runtimedata))}),$(this.scoBot).on("exception",function(a){return!1}),"function"==typeof this.scoBot.init)return this.scoBot.init()}},PearsonGL.CommunicatorScorm.prototype.getBookmark=function(){return this.scoBot?this.scoBot.getBookmark():""},PearsonGL.CommunicatorScorm.prototype.setBookmark=function(a){this.scoBot&&this.scoBot.setBookmark(a)},PearsonGL.CommunicatorScorm.prototype.setTotalScore=function(a){this.scoBot&&this.scoBot.setTotals(a)},PearsonGL.CommunicatorScorm.prototype.getPassingScore=function(){return this.scoBot?parseFloat(this.scoBot.get("scaled_passing_score")):this.passingScore},PearsonGL.CommunicatorScorm.prototype.isConnected=function(){return!!scorm.hasOwnProperty("isLMSConnected")&&scorm.isLMSConnected()},PearsonGL.CommunicatorScorm.prototype.isExceededSuspendDataLimit=function(a,b){var c={low:2e4,medium:35e3,high:5e4},d=JSON.stringify(a),e=d.replace(/[^\f\r\n\t\v\0\s\S\w\W\d\D\b\\B\\cX\\xhh\\uhhh]/gi,"");if(void 0!==b&&c.hasOwnProperty(b.toLowerCase())||(b="low"),e.length>c[b.toLowerCase()])return!0},PearsonGL.CommunicatorScorm.prototype.getSuspendData=function(){if(this.scoBot){var a=this.scoBot.getvalue("cmi.suspend_data");return""===a&&(a='{"pages": []}'),a}return""},PearsonGL.CommunicatorScorm.prototype.getLearnerData=function(a){this.getScormData(a)},PearsonGL.CommunicatorScorm.prototype.setLearnerData=function(a){this.setScormData(a)},PearsonGL.CommunicatorScorm.prototype.getScormData=function(a){if(this.scoBot){var b=a.id;PearsonGL.logger.log(a.name+" Gadget getScormData("+b+")");var c,d=a.data.interactions,e={},f=[],g=0,h={id:b,title:a.name,data:void 0},i="",j={},k="",l={};if($.isArray(d)&&d.length>0)if("resume"===this.scoBot.getEntry()){for($.extend(e,d),g=0;g<d.length;g++){if(i=b+"_"+g,"false"===(j=this.scoBot.getInteraction(i))){this.initInteractionAndObjectives(d,a);break}for(d[g]=j,f=d[g].objectives,c=0;c<f.length;c++)k=i+"_"+c,l=this.scoBot.getObjective(k),l.completionThreshold=e[g].objectives[c].completionThreshold,f[c]=l}h.data=this.scoBot.getSuspendDataByPageID(b),PearsonGL.logger.log("SuspendData loaded from the LMS: "),PearsonGL.logger.dir(h.data)}else PearsonGL.logger.log("No previous interactions loaded from SCORM, creating new..."),this.initInteractionAndObjectives(d,a);else void 0!==d?PearsonGL.logger.error("Incorrect interactions datatype loaded from JSON: "+(void 0===d?"undefined":_typeof(d))):PearsonGL.logger.error("No interactions loaded from JSON, ignoring...");a.data.suspendData=h}},PearsonGL.CommunicatorScorm.prototype.initInteractionAndObjectives=function(a,b){var c,d,e,f,g,f=[];for(c=0;c<a.length;c++){for(e=a[c],e.id=b.id+"_"+c,PearsonGL.logger.log("Creating new interaction with ID "+e.id),f=e.objectives,g=b.results&&c<b.results.length?b.results[c]:void 0,b&&b.objectiveDesc&&(g?g.objectiveDesc=b.objectiveDesc:g={objectiveDesc:b.objectiveDesc}),d=0;d<f.length;d++)this.initScormObjectiveValues(f[d],g),f[d].id=e.id+"_"+d;this.initScormInteractionValues(e,b,g),e.objectives=f,PearsonGL.logger.log("Interaction object"),PearsonGL.logger.dir(e)}},PearsonGL.CommunicatorScorm.prototype.setScormData=function(a){if(this.scoBot){var b,c,d,d,e=a.data.suspendData,f=a.data.interactions,g=[];if($.isArray(f)&&f.length>0){for(b=0;b<f.length;b++){var h=f[b];for(g=f[b].objectives,c=0;c<g.length;c++){var i=g[c];"false"!==i&&(d=a.results&&b<a.results.length?a.results[b]:void 0,this.setScormObjectiveValues(i,d),this.scoBot.setObjective(i))}this.setScormInteractionValues(h,d),this.scoBot.setInteraction(h)}if($(window).trigger("LearnerDataLoaded"),!e)return;e.data&&"page"!==a.objectType&&this.scoBot.setSuspendDataByPageID(e.id,e.title,e.data)}PearsonGL.globals.useLocalStorage&&"function"==typeof scobot_local&&this.scoBot.commit()}},PearsonGL.CommunicatorScorm.prototype.initScormInteractionValues=function(a,b,c){a.timestamp=new Date,a.type="other",a.weighting=1,a.learner_response="",a.correct_responses="not played",a.result="neutral",a.latency="",b.hasOwnProperty("type")&&(a.type=b.type),c.hasOwnProperty("learnerResponse")&&(a.learner_response=c.learnerResponse),c.hasOwnProperty("correctResponses")&&(a.correct_responses=c.correctResponses),c.hasOwnProperty("result")&&(a.result=c.result),c.hasOwnProperty("weighting")&&(a.weighting=c.weighting)},PearsonGL.CommunicatorScorm.prototype.initScormObjectiveValues=function(a,b){var c={};try{c.scaled=0,c.raw=0,c.min=$.isNumeric(a.score.min)?a.score.min:0,c.max=a.score.max,a.score=c,a.success_status="unknown",a.completion_status="not attempted",a.progress_measure=0,a.description=b.objectiveDesc?b.objectiveDesc:""}catch(a){}},PearsonGL.CommunicatorScorm.prototype.setScormInteractionValues=function(a,b){a.latency=new Date,a.timestamp=new Date,b&&(b.hasOwnProperty("learnerResponse")&&(a.learner_response=b.learnerResponse),b.hasOwnProperty("correctResponses")&&(a.correct_responses=b.correctResponses),b.hasOwnProperty("result")&&(a.result=b.result),b.hasOwnProperty("type")&&(a.type=b.type))},PearsonGL.CommunicatorScorm.prototype.setScormObjectiveValues=function(a,b){try{a.score.min=isNaN(b.min)?0:parseFloat(b.min),b.hasOwnProperty("max")&&(a.score.max=b.max),b.hasOwnProperty("raw")&&(a.score.raw=b.raw),b.hasOwnProperty("scaled")?a.score.scaled=b.scaled:a.score.max-a.score.min!=0?a.score.scaled=(a.score.raw-a.score.min)/(a.score.max-a.score.min):a.score.scaled=1,0===a.score.max&&(a.score.raw=0,a.score.scaled=1),b.completionStatus&&(a.completion_status=b.completionStatus),b.successStatus&&(a.success_status=b.successStatus),b.hasOwnProperty("progressMeasure")&&(a.progress_measure=b.progressMeasure)}catch(a){}},PearsonGL.CommunicatorScorm.prototype.setSuspendDataById=function(a,b,c){this.scoBot&&this.scoBot.setSuspendDataByPageID(a,b,c)},PearsonGL.CommunicatorScorm.prototype.getMode=function(){if(this.scoBot)return this.scoBot.getMode()},PearsonGL.CommunicatorScorm.prototype.finish=function(){this.scoBot&&this.scoBot.finish()},PearsonGL.CommunicatorScorm.prototype.commit=function(){this.scoBot&&this.scoBot.commit()},PearsonGL.CommunicatorScorm.prototype.exit=function(){this.scoBot&&this.scoBot.exit()},window.PearsonGL=window.PearsonGL||{},PearsonGL.CommunicatorTinCan=function(a){window.PearsonGL.CommunicatorBase.call(this),this.deferred=a,this.init()},PearsonGL.CommunicatorTinCan.prototype=Object.create(window.PearsonGL.CommunicatorBase.prototype),PearsonGL.CommunicatorTinCan.prototype.init=function(){this.hostingWindow,this.config,this.requestHeaders={"Content-Type":"application/json"},this.modifiedIds=[],this.progress={min:0,totalInteractions:0,totalObjectives:0},this.useClientMessaging=!1,this.isEstablished=!1,this.startTime=null,this.failedRequest=null,this.requestNewToken=!1,this.data={result:{score:{scaled:0,raw:0,max:0},successStatus:"unknown",progressMeasure:1,completionStatus:"incomplete",location:"",totalTime:0,exit:""},suspendData:{}},this.subscribeToPostMessageListener(),this.requestTinCanConfig()},PearsonGL.CommunicatorTinCan.prototype.subscribeToPostMessageListener=function(){var a=this,b=function(b){if("string"==typeof b)try{if(!(b=$.parseJSON(messageData)))return}catch(a){return}switch(a.hostingWindow||"tcConfig"!==b.data.action||(a.hostingWindow=b.source),b.data.action){case"tcConfig":PearsonGL.logger.log("Received tcConfig message"),PearsonGL.logger.info(b.data),a.processTCConfig(b.data);break;case"authorization":PearsonGL.logger.log("Received authorization message"),a.processAuthorization(b.data);break;case"commit":PearsonGL.logger.log("Received commit message"),a.processCommitEvent();break;case"submit":PearsonGL.logger.log("Received submit message"),a.processSubmitEvent();break;case"exit":PearsonGL.logger.log("Received exit message"),PearsonGL.globals.player.exit();break;case"clearData":a.data=a.config.session?{session:{id:a.config.session.id}}:{},a.sendPutRequest(a.data);break;case"setLearnerData":PearsonGL.logger.log("Received setLearnerData message"),a.processLearnerData(b.data.data);break;default:PearsonGL.logger.log("Received unknown postMessage "+b.data.action)}};window.addEventListener?window.addEventListener("message",b,!1):window.attachEvent("onmessage",b)},PearsonGL.CommunicatorTinCan.prototype.sendPutRequest=function(a){(a||"normal"===this.config.mode)&&$.ajax({url:this.getDocumentStateURL(),headers:this.requestHeaders,method:"PUT",data:JSON.stringify(a),success:function(){PearsonGL.logger.log("Learner data is saved successfully")},fail:function(a,b,c){PearsonGL.logger.log("Unable to save the Learner data.")}})},PearsonGL.CommunicatorTinCan.prototype.requestTinCanConfig=function(){function a(){try{b.postMessage(PearsonGL.utils.browser.msie?JSON.stringify(c):c,"*"),PearsonGL.logger.log("Sent getTCConfig message")}catch(a){}}var b,c={action:"getTCConfig",scoId:PearsonGL.utils.getScoId()},d=0;if(window.opener)b=window.opener,a();else do{d++,b=b?b.parent:window.parent,a()}while(b&&b!=window.top&&d<5)},PearsonGL.CommunicatorTinCan.prototype.processTCConfig=function(a){if(this.config=a,(a.scaledPassingScore||$.isNumeric(a.scaledPassingScore))&&(this.passingScore=a.scaledPassingScore),(a.completionThreshold||$.isNumeric(a.completionThreshold))&&(this.completionThreshold=a.completionThreshold),this.config.session&&(this.config.session.id||""===this.config.session.id)&&(this.data.session||(this.data.session={}),this.data.session.id=this.config.session.id),this.useClientMessaging="true"===a.clientMessaging||!0===a.clientMessaging,a.authorization&&this.saveAuthHeaders(a.authorization.header),"browse"===this.config.mode)this.deferred&&this.deferred.resolve();else if(this.useClientMessaging){PearsonGL.logger.log("Sending getLearnerData message to host");var b=this.getDocumentStatePostMessageObject("getLearnerData");this.hostingWindow.postMessage(PearsonGL.utils.browser.msie?JSON.stringify(b):b,"*")}else this.requestAuthorization(),this.retrieveLearnerData()},PearsonGL.CommunicatorTinCan.prototype.processAuthorization=function(a){this.config&&a&&(a.authorization&&(this.config.authorization=a.authorization,this.saveAuthHeaders(a.authorization.header)),a.session&&(a.session.id||""===a.session.id)&&(this.config.session||(this.config.session={}),this.config.session.id=a.session.id)),this.failedRequest?this.failedRequest():this.requestAuthorization()},PearsonGL.CommunicatorTinCan.prototype.saveAuthHeaders=function(a){var b={"Content-Type":"application/json"};PearsonGL.utils.isNonEmptyArray(a)&&a.forEach(function(a){b[a.name]=a.value}),this.requestHeaders=b},PearsonGL.CommunicatorTinCan.prototype.processCommitEvent=function(){function a(a){var c={action:"commit",result:"failed"};a&&(c.result="succeeded"),b.hostingWindow.postMessage(PearsonGL.utils.browser.msie?JSON.stringify(c):c,"*"),PearsonGL.logger.log("Sent commit message")}var b=this;if("normal"===this.config.mode){var c=this.data.session?{session:{id:this.data.session.id}}:{};this.getModifiedData(c),c.result.exit="suspend",this.sendPostRequest(c,!0,a)}},PearsonGL.CommunicatorTinCan.prototype.processSubmitEvent=function(){function a(a){var c={action:"submit",result:"failed"};a&&(c.result="succeeded",b.config.mode="review"),b.hostingWindow.postMessage(PearsonGL.utils.browser.msie?JSON.stringify(c):c,"*"),PearsonGL.logger.log("Sent submit message")}var b=this;if("normal"===this.config.mode){var c=this.data.session?{session:{id:this.data.session.id}}:{};this.getModifiedData(c),c.result.exit="normal",this.sendPostRequest(c,!0,a)}},PearsonGL.CommunicatorTinCan.prototype.requestAuthorization=function(a){if(this.config.authorization){var b=this,c=a>=0?a:1e3*(parseInt(this.config.authorization.expiration,10)-5),d={action:"getAuthorization"};setTimeout(function(){b.requestNewToken=!1,b.hostingWindow.postMessage(PearsonGL.utils.browser.msie?JSON.stringify(d):d,"*")},c)}},PearsonGL.CommunicatorTinCan.prototype.getDocumentStateURL=function(){var a=encodeURIComponent(JSON.stringify({objectType:"Agent",account:this.config.account}));return encodeURI(this.config.endpoint+"/activities/state?activityId=http://dcat.pearson.com/dcatweb/view/"+PearsonGL.utils.getScoId()+"&agent=")+a+encodeURI("&stateId=state&registration="+this.config.registration)},PearsonGL.CommunicatorTinCan.prototype.getDocumentStatePostMessageObject=function(a,b){return{action:a,data:b,scoId:PearsonGL.utils.getScoId(),activityId:"http://dcat.pearson.com/dcatweb/view/"+PearsonGL.utils.getScoId(),stateId:"state",registration:this.config.registration,agent:{objectType:"Agent",account:this.config.account}}},PearsonGL.CommunicatorTinCan.prototype.processLearnerData=function(a){a=a||{},$.extend(!0,this.data,a),this.isEstablished=!0,this.startTime=new Date,this.deferred&&this.deferred.resolve(),this.failedRequest=null},PearsonGL.CommunicatorTinCan.prototype.retrieveLearnerData=function(){var a=this;$.ajax({url:this.getDocumentStateURL(),headers:this.requestHeaders,method:"GET",dataType:"json",async:!1,success:function(b){a.processLearnerData(b)},statusCode:{401:function(){a.handle401Response(a.retrieveLearnerData)},404:function(){a.processLearnerData({})}},fail:function(a,b,c){PearsonGL.logger.log("Failed in retriving data (GET request): "+a.status)}})},PearsonGL.CommunicatorTinCan.prototype.getRequestAuthorizationDelay=function(){return this.failedRequest?5e3:0},PearsonGL.CommunicatorTinCan.prototype.sendPostRequest=function(a,b,c){if(this.failedRequest!==this.sendPostRequest||!this.requestNewToken){var d=this;if("normal"===this.config.mode){null!==a&&this.failedRequest!==this.sendPostRequest||(a=this.data),void 0===b&&(b=!0);var e=new Date,f=0;if(this.startTime?(f=this.trueRound((e.getTime()-this.startTime.getTime())/1e3),isNaN(f)&&(f=0)):this.startTime=new Date,this.data.result.totalTime+=f,this.startTime=e,this.useClientMessaging){var g=this.getDocumentStatePostMessageObject("setLearnerData",a);this.hostingWindow.postMessage(PearsonGL.utils.browser.msie?JSON.stringify(g):g,"*"),PearsonGL.logger.log("Sent setLearnerData request to host to save learner data")}else $.ajax({url:this.getDocumentStateURL(),headers:this.requestHeaders,method:"POST",data:JSON.stringify(a),async:b,success:function(){PearsonGL.logger.log("Learner data is saved successfully"),d.failedRequest=null,c&&c(!0)},statusCode:{401:function(){PearsonGL.logger.log("Received 401 HTTP response"),d.handle401Response(d.sendPostRequest)}},fail:function(a,b,d){PearsonGL.logger.log("Failed to save learner data (POST request): "+a.status),c&&c(!1)}})}}},PearsonGL.CommunicatorTinCan.prototype.handle401Response=function(a){this.requestNewToken=!0,this.requestAuthorization(this.getRequestAuthorizationDelay()),this.failedRequest=a},PearsonGL.CommunicatorTinCan.prototype.setTotalScore=function(a){this.progress.totalInteractions=a.totalInteractions,this.progress.totalObjectives=a.totalObjectives,this.data.result.score.max=a.scoreMax},PearsonGL.CommunicatorTinCan.prototype.getPassingScore=function(){return this.passingScore},PearsonGL.CommunicatorTinCan.prototype.isConnected=function(){return this.isEstablished},PearsonGL.CommunicatorTinCan.prototype.getBookmark=function(){return this.data.result.location},PearsonGL.CommunicatorTinCan.prototype.setBookmark=function(a){this.data.result.location=a},PearsonGL.CommunicatorTinCan.prototype.getLearnerData=function(a){if(this.data){var b,c=a.id,d=a.data.interactions,e=[],f=0,g={id:c,title:a.name,data:void 0};if($.isArray(d)&&d.length>0){for(f=0;f<d.length;f++)if(score=this.data[c]&&this.data[c].scores.length>f?this.data[c].scores[f]:null,this.initInteractionAndObjectives(d,a),score){for(e=d[f].objectives,b=0;b<e.length;b++)e[b].progress_measure=score.progressMeasure,e[b].score.scaled=score.scaled,e[b].score.raw=score.raw,e[b].success_status=score.successStatus,e[b].completion_status=score.completionStatus;d[f].learner_response=this.data[c].data.learnerResponses[f],d[f].correct_responses=this.data[c].data.correctResponses[f]}this.data[c].data.suspendData&&(g.data=this.data[c].data.suspendData)}a.data.suspendData=g}},PearsonGL.CommunicatorTinCan.prototype.setLearnerData=function(a){if(this.data){var b,c,d,e,f=a.data.suspendData,g=a.data.interactions,h=[];if($.isArray(g)&&g.length>0){for(b=0;b<g.length;b++)if(d=a.results&&b<a.results.length?a.results[b]:void 0){var i=g[b];for(h=g[b].objectives,c=0;c<h.length;c++){var j=h[c];"false"!==j&&this.setObjectiveValues(j,d)}this.setInteractionValues(i,d),e=this.data[a.id].scores[b],h.length>0&&(h[0].score.scaled&&(e.scaled=h[0].score.scaled),e.raw=h[0].score.raw,e.max=h[0].score.max,e.progressMeasure=h[0].progress_measure,e.successStatus=h[0].success_status,e.completionStatus=h[0].completion_status,this.data[a.id].data.learnerResponses[b]=i.learner_response,this.data[a.id].data.correctResponses[b]=i.correct_responses)}f&&(this.data[a.id].data.suspendData=f.data),$(window).trigger("LearnerDataLoaded"),this.hasGadgetChanged(a.id)||this.modifiedIds.push(a.id)}}},PearsonGL.CommunicatorTinCan.prototype.initInteractionAndObjectives=function(a,b){var c,d,e,f,g,f=[],h=b.id,i=!1;for(this.data[h]||(this.data[h]={scores:[],data:{learnerResponses:[],correctResponses:[],suspendData:null}},i=!0),c=0;c<a.length;c++){for(e=a[c],e.id=b.id+"_"+c,PearsonGL.logger.log("Creating new interaction with ID "+e.id),f=e.objectives,g=b.results&&c<b.results.length?b.results[c]:void 0,b&&b.objectiveDesc&&(g?g.objectiveDesc=b.objectiveDesc:g={objectiveDesc:b.objectiveDesc}),d=0;d<f.length;d++)this.initScormObjectiveValues(f[d],g),f[d].id=e.id+"_"+d;this.initScormInteractionValues(e,b,g),e.objectives=f,i&&(this.data[h].scores.push({desc:g.objectiveDesc,scaled:f[0].score.scaled,raw:f[0].score.raw,max:f[0].score.max,progressMeasure:f[0].progress_measure,successStatus:f[0].success_status,completionStatus:f[0].completion_status}),this.data[h].data.learnerResponses.push(e.learner_response),this.data[h].data.correctResponses.push(e.correct_responses))}},PearsonGL.CommunicatorTinCan.prototype.initScormObjectiveValues=function(a,b){var c={};try{c.scaled=0,c.raw=0,c.min=$.isNumeric(a.score.min)?a.score.min:0,c.max=a.score.max,a.score=c,a.success_status="unknown",a.completion_status="not attempted",a.progress_measure=0,a.description=b.objectiveDesc?b.objectiveDesc:""}catch(a){}},PearsonGL.CommunicatorTinCan.prototype.initScormInteractionValues=function(a,b,c){a.timestamp=new Date,a.type="other",a.weighting=1,a.learner_response="",a.correct_responses="not played",a.result="neutral",a.latency="",b.hasOwnProperty("type")&&(a.type=b.type),c.hasOwnProperty("learnerResponse")&&(a.learner_response=c.learnerResponse),c.hasOwnProperty("correctResponses")&&(a.correct_responses=c.correctResponses),c.hasOwnProperty("result")&&(a.result=c.result),c.hasOwnProperty("weighting")&&(a.weighting=c.weighting)},PearsonGL.CommunicatorTinCan.prototype.initInteractionValues=function(a,b,c){a.timestamp=new Date,a.type="other",a.weighting=1,a.learner_response="",a.correct_responses="not played",a.result="neutral",a.latency=new Date,a.startTime||(a.startTime=a.timestamp),b.hasOwnProperty("type")&&(a.type=b.type),c.hasOwnProperty("learnerResponse")&&(a.learner_response=c.learnerResponse),c.hasOwnProperty("correctResponses")&&(a.correct_responses=c.correctResponses),c.hasOwnProperty("result")&&(a.result=c.result),c.hasOwnProperty("weighting")&&(a.weighting=c.weighting)},PearsonGL.CommunicatorTinCan.prototype.initObjectiveValues=function(a,b){try{a.scaled=0,a.raw=0,a.max=currObjective.score.max,a.score=a,a.successStatus="unknown",a.completionStatus="not attempted",a.progressMeasure=0,a.desc=b.objectiveDesc?b.objectiveDesc:""}catch(a){}},PearsonGL.CommunicatorTinCan.prototype.setInteractionValues=function(a,b){a.timestamp=new Date,b&&(b.hasOwnProperty("learnerResponse")&&(a.learner_response=b.learnerResponse),b.hasOwnProperty("correctResponses")&&(a.correct_responses=b.correctResponses),b.hasOwnProperty("result")&&(a.result=b.result),b.hasOwnProperty("type")&&(a.type=b.type))},PearsonGL.CommunicatorTinCan.prototype.setObjectiveValues=function(a,b){try{a.score.min=isNaN(b.min)?0:parseFloat(b.min),b.hasOwnProperty("max")&&(a.score.max=b.max),b.hasOwnProperty("raw")&&(a.score.raw=b.raw.toFixed(3)),b.hasOwnProperty("scaled")?a.score.scaled=b.scaled.toFixed(3):a.score.max-a.score.min!=0?a.score.scaled=((a.score.raw-a.score.min)/(a.score.max-a.score.min)).toFixed(3):a.score.scaled=1,b.completionStatus&&(a.completion_status=b.completionStatus),b.successStatus&&(a.success_status=b.successStatus),b.hasOwnProperty("progressMeasure")&&(a.progress_measure=b.progressMeasure)}catch(a){}},PearsonGL.CommunicatorTinCan.prototype.updateProgress=function(){var a,b,c,d=0,e=0,f=0;if(0===this.progress.totalInteractions||0===this.progress.totalObjectives)return PearsonGL.logger.log("Unable to calculate Progress since the totalInteractions or Objectives are zero"),"false";for(c in this.data)if(b=this.data[c],b.hasOwnProperty("scores"))for(f=0;f<b.scores.length;f++)"completed"===b.scores[f].completionStatus&&e++,isNaN(b.scores[f].raw)||(d+=parseFloat(b.scores[f].raw));this.data.result.score.raw=d,this.data.result.score.max-this.progress.min==0?this.data.result.score.scaled=1:this.data.result.score.scaled=(d-this.progress.min)/(this.data.result.score.max-this.progress.min),e>0&&(a=e/this.progress.totalObjectives,this.data.result.progressMeasure=this.trueRound(a,7)),this.data.result.completionStatus=parseFloat(a)>=parseFloat(this.completionThreshold)?"completed":"incomplete",this.data.result.successStatus=parseFloat(this.data.result.score.scaled)>=parseFloat(this.passingScore)?"passed":"failed"},PearsonGL.CommunicatorTinCan.prototype.setSuspendDataById=function(a,b,c){this.data.suspendData[a]=c},PearsonGL.CommunicatorTinCan.prototype.getSuspendData=function(){return this.data.suspendData?JSON.stringify(this.data.suspendData):""},PearsonGL.CommunicatorTinCan.prototype.getMode=function(){return this.config.mode},PearsonGL.CommunicatorTinCan.prototype.finish=function(){this.commit("normal"),this.config.mode="review"},PearsonGL.CommunicatorTinCan.prototype.submit=function(){},PearsonGL.CommunicatorTinCan.prototype.getModifiedData=function(a){var b;for(b=0;b<this.modifiedIds.length;b++)a[this.modifiedIds[b]]||(a[this.modifiedIds[b]]=this.data[this.modifiedIds[b]]);this.updateProgress(),a.result=this.data.result,a.suspendData=this.data.suspendData,this.modifiedIds.splice(0,this.modifiedIds.length)},PearsonGL.CommunicatorTinCan.prototype.saveState=function(){var a={};"normal"===this.config.mode&&(this.data.result.exit="suspend",this.getModifiedData(a),this.sendPostRequest(a,!0))},PearsonGL.CommunicatorTinCan.prototype.exit=function(){var a={};"normal"===this.config.mode&&(this.data.result.exit="suspend",this.getModifiedData(a),this.sendPostRequest(a,!1))},PearsonGL.CommunicatorTinCan.prototype.commit=function(a){if("normal"===this.config.mode&&!PearsonGL.globals.isUnloading){var b=this.data.session?{session:{id:this.data.session.id}}:{};this.getModifiedData(b),b.result.exit=PearsonGL.utils.isNonEmptyString(a)?a:"",this.sendPostRequest(b,!0)}},PearsonGL.CommunicatorTinCan.prototype.sendLearnerData=function(){},PearsonGL.CommunicatorTinCan.prototype.sendLearnerResult=function(){},PearsonGL.CommunicatorTinCan.prototype.trueRound=function(a,b){var c=parseFloat(a);return parseFloat(c.toPrecision(b))},PearsonGL.CommunicatorTinCan.prototype.hasGadgetChanged=function(a){return $.inArray(a,this.modifiedIds,0)>-1},window.PearsonGL=window.PearsonGL||{},window.PearsonGL.CommunicationLayer=function(a,b){this.settings=a,this.postMessageSubscribers=[],this.deferred=b,this.initialize()},window.PearsonGL.CommunicationLayer.prototype={initialize:function(){this.analytics,"tinCan"!==PearsonGL.globals.commType&&this.deferred.resolve();try{switch(PearsonGL.globals.commType){case"psoc":this.communicator=new window.PearsonGL.CommunicatorPSoC;break;case"sm":this.communicator=window.PearsonGL.CommunicatorSM?new window.PearsonGL.CommunicatorSM:null;break;case"tinCan":this.communicator=window.PearsonGL.CommunicatorTinCan?new window.PearsonGL.CommunicatorTinCan(this.deferred):null;break;default:this.deferred.resolve(),this.communicator=new window.PearsonGL.CommunicatorScorm}}catch(a){PearsonGL.logger.error(a.message),this.communicator=null}this.initGoogleAnalytics(),this.initPostMessageListener()},initGoogleAnalytics:function(){if(this.settings.useGoogleAnalytics)try{this.analytics=new PearsonGL.GoogleAnalytics(this.settings)}catch(a){PearsonGL.logger.log("Unable to load analytics")}},initPostMessageListener:function(){var a=this,b=function(b){a.postMessageSubscribers.forEach(function(a){a(b.data)})};window.addEventListener?window.addEventListener("message",b,!1):window.attachEvent("onmessage",b)},sendAnalytics:function(a){this.analytics&&this.analytics.sendAnalytics(a)},isReady:function(){if(this.communicator)return this.communicator.isReady()},sendKeepAlive:function(){if(this.communicator)return this.communicator.sendKeepAlive()},sendShowLogoutDialog:function(){if(this.communicator)return this.communicator.sendShowLogoutDialog()},stopIdleTimer:function(){if(this.communicator)return this.communicator.stopIdleTimer()},sendMessage:function(a,b){if(this.communicator)return this.communicator.sendMessage(a,b)},isConnected:function(){return!!this.communicator&&this.communicator.isConnected()},exit:function(){this.communicator&&"function"==typeof this.communicator.exit&&this.communicator.exit()},saveState:function(){this.communicator&&"function"==typeof this.communicator.saveState&&this.communicator.saveState()},setTotalScore:function(a){this.communicator&&this.communicator.setTotalScore(a)},getBookmark:function(){return this.communicator?this.communicator.getBookmark():""},setBookmark:function(a){this.communicator&&this.communicator.setBookmark(a)},getSuspendData:function(){return this.communicator?this.communicator.getSuspendData():{}},getLearnerData:function(a){this.communicator&&this.communicator.getLearnerData(a)},setLearnerData:function(a){this.communicator&&this.communicator.setLearnerData(a)},getPassingScore:function(){return this.communicator?this.communicator.getPassingScore():.6},setSuspendDataById:function(a,b,c){this.communicator&&this.communicator.setSuspendDataById(a,b,c)},isExceededSuspendDataLimit:function(a,b){return!!this.communicator&&this.communicator.isExceededSuspendDataLimit(a,b)},getMode:function(){return this.communicator?this.communicator.getMode():"browse"},finish:function(){this.communicator&&this.communicator.finish()},commit:function(){this.communicator&&this.communicator.commit()},submit:function(){this.communicator&&this.communicator.submit()},setScoreStatus:function(a){this.communicator&&this.communicator.setScoreStatus(a)},startAudioByClicked:function(){this.communicator&&this.communicator.startAudioByClicked()},subscribeToPostMessages:function(a){"function"==typeof a&&this.postMessageSubscribers.push(a)},firePostMessageEvent:function(a){try{window.parent.postMessage(PearsonGL.utils.browser.msie?JSON.stringify(a):a,"*")}catch(a){}},sendPlatformPostMessage:function(a){function b(){try{c.postMessage(a,"*"),PearsonGL.logger.info("sent message to platform (lvl "+d+"): "+JSON.stringify(a))}catch(a){}}var c,d=0,e=5;if(window.opener)c=window.opener,b();else do{d++,c=c?c.parent:window.parent,b()}while(c&&c!=window.top&&d<e)}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(){function a(){}function b(a){var b=a.length-1;return function(){var c=v.call(arguments,0,b),d=v.call(arguments,b);return a.apply(this,c.concat([d]))}}function c(a){return b(function(b,c){"function"!=typeof b&&(b=w(b));var d=function(a){return b.apply(a,[a].concat(c))};return a.call(this,d)})}function d(a){var b=v.call(arguments,1);return function(){return a.apply(this,b)}}function e(a,b){if(!b)throw new Error("prayer failed: "+a)}function f(a){e("a direction was passed",a===y||a===z)}function g(a,b,c){e("a parent is always present",a),e("leftward is properly set up",function(){return b?b[z]===c&&b.parent===a:a.ends[y]===c}()),e("rightward is properly set up",function(){return c?c[y]===b&&c.parent===a:a.ends[z]===b}())}function h(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (20142015)  v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function i(a){return h(),Qa(a)}function j(b){function c(a){if(!a||!a.nodeType)return null;var b=A(a).children(".mq-root-block").attr(s),c=b&&C.byId[b].controller;return c?e[c.KIND_OF_MQ](c):null}function d(a,b){b&&b.handlers&&(b.handlers={fns:b.handlers,APIClasses:e});for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],f=L[c];a[c]=f?f(d):d}}if(!(O<=b&&b<=P))throw"Only interface versions between "+O+" and "+P+" supported. You specified: "+b;var e={};c.L=y,c.R=z,c.config=function(a){return d(K.p,a),this},c.registerEmbed=function(a,b){if(!/^[a-z][a-z0-9]*$/i.test(a))throw"Embed name must start with letter and be only letters and digits";N[a]=b};var f=e.AbstractMathQuill=x(M,function(a){a.init=function(a){this.__controller=a,this.__options=a.options,this.id=a.id,this.data=a.data},a.__mathquillify=function(a){var b=this.__controller,c=b.root,d=b.container;b.createTextarea();var e=d.addClass(a).contents().detach();c.jQ=A('<span class="mq-root-block"/>').attr(s,c.id).appendTo(d),this.latex(e.text()),this.revert=function(){return d.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(e)}},a.config=function(a){return d(this.__options,a),this},a.el=function(){return this.__controller.container[0]},a.text=function(){return this.__controller.exportText()},a.latex=function(a){return arguments.length>0?(this.__controller.renderLatexMath(a),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},a.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},a.reflow=function(){return this.__controller.root.postOrder("reflow"),this}});c.prototype=f.prototype,e.EditableField=x(f,function(b,c){b.__mathquillify=function(){return c.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},b.focus=function(){return this.__controller.textarea.focus(),this},b.blur=function(){return this.__controller.textarea.blur(),this},b.write=function(a){return this.__controller.writeLatex(a),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},b.cmd=function(a){var b=this.__controller.notify(),c=b.cursor;if(/^\\[a-z]+$/i.test(a)){a=a.slice(1);var d=E[a]||Ma[a];d&&(a=d(a),c.selection&&a.replaces(c.replaceSelection()),a.createLeftOf(c.show()),this.__controller.scrollHoriz())}else c.parent.write(c,a);return b.blurred&&c.hide().parent.blur(),this},b.select=function(){var a=this.__controller;for(a.notify("move").cursor.insAtRightEnd(a.root);a.cursor[y];)a.selectLeft();return this},b.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},b.moveToDirEnd=function(a){return this.__controller.notify("move").cursor.insAtDirEnd(a,this.__controller.root),this},b.moveToLeftEnd=function(){return this.moveToDirEnd(y)},b.moveToRightEnd=function(){return this.moveToDirEnd(z)},b.keystroke=function(b){for(var b=b.replace(/^\s+|\s+$/g,"").split(/\s+/),c=0;c<b.length;c+=1)this.__controller.keystroke(b[c],{preventDefault:a});return this},b.typedText=function(a){for(var b=0;b<a.length;b+=1)this.__controller.typedText(a.charAt(b));return this},b.dropEmbedded=function(a,b,c){var d=a-A(window).scrollLeft(),e=b-A(window).scrollTop(),f=document.elementFromPoint(d,e);this.__controller.seek(A(f),a,b),La().setOptions(c).createLeftOf(this.__controller.cursor)},b.clickAt=function(a,b,c){c=c||document.elementFromPoint(a,b);var d=this.__controller,e=d.root;return q.contains(e.jQ[0],c)||(c=e.jQ[0]),d.seek(A(c),a+pageXOffset,b+pageYOffset),d.blurred&&this.focus(),this},b.ignoreNextMousedown=function(a){return this.__controller.cursor.options.ignoreNextMousedown=a,this}}),c.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},c.EditableField.prototype=e.EditableField.prototype;for(var g in J)!function(a,d){var f=e[a]=d(e);c[a]=function(d,e){var g=c(d);if(g instanceof f||!d||!d.nodeType)return g;var h=I(f.RootBlock(),A(d),K());return h.KIND_OF_MQ=a,f(h).__mathquillify(e,b)},c[a].prototype=f.prototype}(g,J[g]);return c}function k(a){for(var b="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" "),c=0;c<b.length;c+=1)!function(b){a[b]=function(a){this.controller.handle(b,a)}}(b[c]);a.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function l(a,b,c){return x(aa,{ctrlSeq:a,htmlTemplate:"<"+b+" "+c+">&0</"+b+">"})}function m(a){var b=this.parent,c=a;do{if(c[z])return a.insLeftOf(b);c=c.parent.parent}while(c!==b);a.insRightOf(b)}function n(a,b){a.jQadd=function(){b.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},a.reflow=function(){var a=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));ra(this.delimjQs,t(1+.2*(a-1),1.2),1.2*a)}}function o(a,b){var b=b||a,c=Ja[a],e=Ja[b];F[a]=d(Ia,y,a,c,b,e),F[c]=d(Ia,z,a,c,b,e)}var p,q=window.jQuery,r="mathquill-command-id",s="mathquill-block-id",t=Math.min,u=Math.max;if(!q)throw"MathQuill requires jQuery 1.4.3+ to be loaded first";var v=[].slice,w=b(function(a,c){return b(function(b,d){if(a in b)return b[a].apply(b,c.concat(d))})}),x=function(a,b,c){function d(a){return"object"===(void 0===a?"undefined":_typeof(a))}function e(a){return"function"==typeof a}function f(){}return function g(h,i){function j(){var a=new k;return e(a.init)&&a.init.apply(a,arguments),a}function k(){}i===c&&(i=h,h=Object),j.Bare=k;var l,m=f[a]=h[a],n=k[a]=j[a]=j.p=new f;return n.constructor=j,j.extend=function(a){return g(j,a)},(j.open=function(a){if(l={},e(a)?l=a.call(j,n,m,j,h):d(a)&&(l=a),d(l))for(var c in l)b.call(l,c)&&(n[c]=l[c]);return e(n.init)||(n.init=h),j})(i)}}("prototype",{}.hasOwnProperty),y=-1,z=1,A=x(q,function(a){a.insDirOf=function(a,b){return a===y?this.insertBefore(b.first()):this.insertAfter(b.last())},a.insAtDirEnd=function(a,b){return a===y?this.prependTo(b):this.appendTo(b)}}),B=x(function(a){a.parent=0,a[y]=0,a[z]=0,a.init=function(a,b,c){this.parent=a,this[y]=b,this[z]=c},this.copy=function(a){return B(a.parent,a[y],a[z])}}),C=x(function(a){function b(){return d+=1}a[y]=0,a[z]=0,a.parent=0;var d=0;this.byId={},a.init=function(){this.id=b(),C.byId[this.id]=this,this.ends={},this.ends[y]=0,this.ends[z]=0},a.dispose=function(){delete C.byId[this.id]},a.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},a.jQ=A(),a.jQadd=function(a){return this.jQ=this.jQ.add(a)},a.jQize=function(a){function b(a){if(a.getAttribute){var c=a.getAttribute("mathquill-command-id"),d=a.getAttribute("mathquill-block-id");c&&C.byId[c].jQadd(a),d&&C.byId[d].jQadd(a)}for(a=a.firstChild;a;a=a.nextSibling)b(a)}for(var a=A(a||this.html()),c=0;c<a.length;c+=1)b(a[c]);return a},a.createDir=function(a,b){f(a);var c=this;return c.jQize(),c.jQ.insDirOf(a,b.jQ),b[a]=c.adopt(b.parent,b[y],b[z]),c},a.createLeftOf=function(a){return this.createDir(y,a)},a.selectChildren=function(a,b){return H(a,b)},a.bubble=c(function(a){for(var b=this;b;b=b.parent){if(!1===a(b))break}return this}),a.postOrder=c(function(a){return function b(c){c.eachChild(b),a(c)}(this),this}),a.isEmpty=function(){return 0===this.ends[y]&&0===this.ends[z]},a.children=function(){return D(this.ends[y],this.ends[z])},a.eachChild=function(){var a=this.children();return a.each.apply(a,arguments),this},a.foldChildren=function(a,b){return this.children().fold(a,b)},a.withDirAdopt=function(a,b,c,d){return D(this,this).withDirAdopt(a,b,c,d),this},a.adopt=function(a,b,c){return D(this,this).adopt(a,b,c),this},a.disown=function(){return D(this,this).disown(),this},a.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),D=x(function(a){a.init=function(a,b,c){if(c===p&&(c=y),f(c),e("no half-empty fragments",!a==!b),this.ends={},a){e("withDir is passed to Fragment",a instanceof C),e("oppDir is passed to Fragment",b instanceof C),e("withDir and oppDir have the same parent",a.parent===b.parent),this.ends[c]=a,this.ends[-c]=b;var d=this.fold([],function(a,b){return a.push.apply(a,b.jQ.get()),a});this.jQ=this.jQ.add(d)}},a.jQ=A(),a.withDirAdopt=function(a,b,c,d){return a===y?this.adopt(b,c,d):this.adopt(b,d,c)},a.adopt=function(a,b,c){g(a,b,c);var d=this;d.disowned=!1;var e=d.ends[y];if(!e)return this;var f=d.ends[z];return b||(a.ends[y]=e),c?c[y]=f:a.ends[z]=f,d.ends[z][z]=c,d.each(function(c){c[y]=b,c.parent=a,b&&(b[z]=c),b=c}),d},a.disown=function(){var a=this,b=a.ends[y];if(!b||a.disowned)return a;a.disowned=!0;var c=a.ends[z],d=b.parent;return g(d,b[y],b),g(d,c,c[z]),b[y]?b[y][z]=c[z]:d.ends[y]=c[z],c[z]?c[z][y]=b[y]:d.ends[z]=b[y],a},a.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},a.each=c(function(a){var b=this,c=b.ends[y];if(!c)return b;for(;c!==b.ends[z][z];c=c[z]){if(!1===a(c))break}return b}),a.fold=function(a,b){return this.each(function(c){a=b.call(this,a,c)}),a}}),E={},F={},G=x(B,function(a){a.init=function(a,b){this.parent=a,this.options=b;var c=this.jQ=this._jQ=A('<span class="mq-cursor">&#8203;</span>');this.blink=function(){c.toggleClass("mq-blink")},this.upDownCache={}},a.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[z]?this.selection&&this.selection.ends[y][y]===this[y]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[z].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},a.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=A(),this},a.withDirInsertAt=function(a,b,c,d){var e=this.parent;this.parent=b,this[a]=c,this[-a]=d,e!==b&&e.blur&&e.blur(this)},a.insDirOf=function(a,b){return f(a),this.jQ.insDirOf(a,b.jQ),this.withDirInsertAt(a,b.parent,b[a],b),this.parent.jQ.addClass("mq-hasCursor"),this},a.insLeftOf=function(a){return this.insDirOf(y,a)},a.insRightOf=function(a){return this.insDirOf(z,a)},a.insAtDirEnd=function(a,b){return f(a),this.jQ.insAtDirEnd(a,b.jQ),this.withDirInsertAt(a,b,0,b.ends[a]),b.focus(),this},a.insAtLeftEnd=function(a){return this.insAtDirEnd(y,a)},a.insAtRightEnd=function(a){return this.insAtDirEnd(z,a)},a.jumpUpDown=function(a,b){var c=this;c.upDownCache[a.id]=B.copy(c);var d=c.upDownCache[b.id];if(d)d[z]?c.insLeftOf(d[z]):c.insAtRightEnd(d.parent);else{var e=c.offset().left;b.seek(e,c)}},a.offset=function(){var a=this,b=a.jQ.removeClass("mq-cursor").offset();return a.jQ.addClass("mq-cursor"),b},a.unwrapGramp=function(){var a=this.parent.parent,b=a.parent,c=a[z],d=this,e=a[y];if(a.disown().eachChild(function(d){d.isEmpty()||(d.children().adopt(b,e,c).each(function(b){b.jQ.insertBefore(a.jQ.first())}),e=d.ends[z])}),!this[z])if(this[y])this[z]=this[y][z];else for(;!this[z];){if(this.parent=this.parent[z],!this.parent){this[z]=a[z],this.parent=b;break}this[z]=this.parent.ends[y]}this[z]?this.insLeftOf(this[z]):this.insAtRightEnd(b),a.jQ.remove(),a[y].siblingDeleted&&a[y].siblingDeleted(d.options,z),a[z].siblingDeleted&&a[z].siblingDeleted(d.options,y)},a.startSelection=function(){for(var a=this.anticursor=B.copy(this),b=a.ancestors={},c=a;c.parent;c=c.parent)b[c.parent.id]=c},a.endSelection=function(){delete this.anticursor},a.select=function(){var a=this.anticursor;if(this[y]===a[y]&&this.parent===a.parent)return!1;for(var b=this;b.parent;b=b.parent)if(b.parent.id in a.ancestors){var c=b.parent;break}e("cursor and anticursor in the same tree",c);var d,f,g=a.ancestors[c.id],h=z;if(b[y]!==g)for(var i=b;i;i=i[z])if(i[z]===g[z]){h=y,d=b,f=g;break}return h===z&&(d=g,f=b),d instanceof B&&(d=d[z]),f instanceof B&&(f=f[y]),this.hide().selection=c.selectChildren(d,f),this.insDirOf(h,this.selection.ends[h]),this.selectionChanged(),!0},a.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},a.deleteSelection=function(){this.selection&&(this[y]=this.selection.ends[y][y],this[z]=this.selection.ends[z][z],this.selection.remove(),this.selectionChanged(),delete this.selection)},a.replaceSelection=function(){var a=this.selection;return a&&(this[y]=a.ends[y][y],this[z]=a.ends[z][z],delete this.selection),a}}),H=x(D,function(a,b){a.init=function(){b.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},a.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),b.adopt.apply(this,arguments)},a.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},a.join=function(a){return this.fold("",function(b,c){return b+c[a]()})}}),I=x(function(a){a.init=function(a,b,c){this.id=a.id,this.data={},this.root=a,this.container=b,this.options=c,a.controller=this,this.cursor=a.cursor=G(a,c)},a.handle=function(a,b){var c=this.options.handlers;if(c&&c.fns[a]){var d=c.APIClasses[this.KIND_OF_MQ](this);b===y||b===z?c.fns[a](b,d):c.fns[a](d)}};var b=[];this.onNotify=function(a){b.push(a)},a.notify=function(){for(var a=0;a<b.length;a+=1)b[a].apply(this.cursor,arguments);return this}}),J={},K=x(),L={},M=x(),N={};i.prototype=M.p,i.interfaceVersion=function(a){if(1!==a)throw"Only interface version 1 supported. You specified: "+a;return h=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (20142015)  v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},h(),i},i.getInterface=j;var O=j.MIN=1,P=j.MAX=2;i.noConflict=function(){return window.MathQuill=Q,i};var Q=window.MathQuill;window.MathQuill=i;var R=x(function(a,b,c){function d(a,b){throw a=a?"'"+a+"'":"EOF","Parse Error: "+b+" at "+a}a.init=function(a){this._=a},a.parse=function(a){function b(a,b){return b}return this.skip(h)._(""+a,b,d)},a.or=function(a){e("or is passed a parser",a instanceof c);var b=this;return c(function(c,d,e){function f(b){return a._(c,d,e)}return b._(c,d,f)})},a.then=function(a){var b=this;return c(function(d,f,g){function h(b,d){var h=a instanceof c?a:a(d);return e("a parser is returned",h instanceof c),h._(b,f,g)}return b._(d,h,g)})},a.many=function(){var a=this;return c(function(b,c,d){function e(a,c){return b=a,g.push(c),!0}function f(){return!1}for(var g=[];a._(b,e,f););return c(b,g)})},a.times=function(a,b){arguments.length<2&&(b=a);var d=this;return c(function(c,e,f){function g(a,b){return k.push(b),c=a,!0}function h(a,b){return j=b,c=a,!1}function i(a,b){return!1}for(var j,k=[],l=!0,m=0;m<a;m+=1)if(!(l=d._(c,g,h)))return f(c,j);for(;m<b&&l;m+=1)l=d._(c,g,i);return e(c,k)})},a.result=function(a){return this.then(g(a))},a.atMost=function(a){return this.times(0,a)},a.atLeast=function(a){var b=this;return b.times(a).then(function(a){return b.many().map(function(b){return a.concat(b)})})},a.map=function(a){return this.then(function(b){return g(a(b))})},a.skip=function(a){return this.then(function(b){return a.result(b)})};var f=(this.string=function(a){var b=a.length,d="expected '"+a+"'";return c(function(c,e,f){var g=c.slice(0,b);return g===a?e(c.slice(b),g):f(c,d)})},this.regex=function(a){e("regexp parser is anchored","^"===a.toString().charAt(1));var b="expected "+a;return c(function(c,d,e){var f=a.exec(c);if(f){var g=f[0];return d(c.slice(g.length),g)}return e(c,b)})}),g=c.succeed=function(a){return c(function(b,c){return c(b,a)})},h=(c.fail=function(a){return c(function(b,c,d){return d(b,a)})},c.letter=f(/^[a-z]/i),c.letters=f(/^[a-z]*/i),c.digit=f(/^[0-9]/),c.digits=f(/^[0-9]*/),c.whitespace=f(/^\s+/),c.optWhitespace=f(/^\s*/),c.any=c(function(a,b,c){return a?b(a.slice(1),a.charAt(0)):c(a,"expected any character")}),c.all=c(function(a,b,c){return b("",a)}),c.eof=c(function(a,b,c){return a?c(a,"expected EOF"):b(a,a)}))}),S=function(){function b(a){var b,d=a.which||a.keyCode,e=c[d],f=[];return a.ctrlKey&&f.push("Ctrl"),a.originalEvent&&a.originalEvent.metaKey&&f.push("Meta"),a.altKey&&f.push("Alt"),a.shiftKey&&f.push("Shift"),b=e||String.fromCharCode(d),f.length||e?(f.push(b),f.join("-")):b}var c={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(c,d){function e(a){u=a,clearTimeout(o),o=setTimeout(a)}function f(b){u(),u=a,clearTimeout(o),s.val(b),b&&s[0].select&&s[0].select(),v=!!b}function g(){var a=s[0];return"selectionStart"in a&&a.selectionStart!==a.selectionEnd}function h(){d.keystroke(b(p),p)}function i(b){p=b,r=null,v&&e(function(b){b&&"focusout"===b.type||!s[0].select||s[0].select(),u=a,clearTimeout(o)}),h()}function j(a){p&&r&&h(),r=a,e(k)}function k(){if(!g()){var a=s.val();1===a.length?(s.val(""),d.typedText(a)):a&&s[0].select&&s[0].select()}}function l(){p=r=null}function m(a){s.focus(),e(n)}function n(){var a=s.val();s.val(""),a&&d.paste(a)}var o,p=null,r=null,s=q(c),t=q(d.container||s),u=a;t.bind("keydown keypress input keyup focusout paste",function(a){u(a)});var v=!1;return t.bind({keydown:i,keypress:j,focusout:l,paste:m}),{select:f}}}();I.open(function(a,b){a.exportText=function(){return this.root.foldChildren("",function(a,b){return a+b.text()})}}),I.open(function(a){a.focusBlurEvents=function(){function a(){clearTimeout(c),f.selection&&f.selection.jQ.addClass("mq-blur"),b()}function b(){f.hide().parent.blur(),d.container.removeClass("mq-focused"),A(window).off("blur",a)}var c,d=this,e=d.root,f=d.cursor;d.textarea.focus(function(){d.blurred=!1,clearTimeout(c),d.container.addClass("mq-focused"),f.parent||f.insAtRightEnd(e),f.selection?(f.selection.jQ.removeClass("mq-blur"),d.selectionChanged()):f.show()}).blur(function(){d.blurred=!0,c=setTimeout(function(){e.postOrder("intentionalBlur"),f.clearSelection().endSelection(),b()}),A(window).on("blur",a)}),d.blurred=!0,f.hide().parent.blur()}}),I.open(function(a){a.keystroke=function(a,b){this.cursor.parent.keystroke(a,b,this)}}),C.open(function(a){a.keystroke=function(a,b,c){var d=c.cursor;if("Home"===a||"End"===a){var e="Home"===a,f=d._jQ,g=f.parentsUntil(".mq-root-block").last(),h=0===g.length;if(h){var i=e?f.prevUntil(".nl"):f.nextUntil(".nl"),j=i.filter(":visible").last(),k=0===j.length;if(!k)var l=j.offset(),m=l.left+(e?1:j.width()-1),n=l.top+2}}switch(a){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":c.ctrlDeleteDir(y);break;case"Shift-Backspace":case"Backspace":A(A(this.jQ[0]).find(".mq-cursor")[0]).prev(".mq-font").length>0&&c.backspace(),A(this.jQ[0]).find(".mq-font.mq-hasCursor").length>0&&c.backspace(),A(this.jQ[0]).hasClass("mq-hasCursor")&&A(this.jQ[0]).hasClass("mq-font")&&c.backspace(),c.backspace();break;case"Esc":case"Tab":return void c.escapeDir(z,a,b);case"Shift-Tab":case"Shift-Esc":return void c.escapeDir(y,a,b);case"End":h?k||c.seek(j,m,n):c.notify("move").cursor.insAtRightEnd(d.parent);break;case"Ctrl-End":c.notify("move").cursor.insAtRightEnd(c.root);break;case"Shift-End":for(;d[z];)c.selectRight();break;case"Ctrl-Shift-End":for(;d[z]||d.parent!==c.root;)c.selectRight();break;case"Home":h?k||c.seek(j,m,n):c.notify("move").cursor.insAtLeftEnd(d.parent);break;case"Ctrl-Home":c.notify("move").cursor.insAtLeftEnd(c.root);break;case"Shift-Home":for(;d[y];)c.selectLeft();break;case"Ctrl-Shift-Home":for(;d[y]||d.parent!==c.root;)c.selectLeft();break;case"Left":c.moveLeft();break;case"Shift-Left":c.selectLeft();break;case"Ctrl-Left":break;case"Right":c.moveRight();break;case"Shift-Right":c.selectRight();break;case"Ctrl-Right":break;case"Up":c.moveUp();break;case"Down":c.moveDown();break;case"Shift-Up":if(d[y])for(;d[y];)c.selectLeft();else c.selectLeft();case"Shift-Down":if(d[z])for(;d[z];)c.selectRight();else c.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":c.ctrlDeleteDir(z);break;case"Shift-Del":case"Del":c.deleteForward();break;case"Meta-A":case"Ctrl-A":for(c.notify("move").cursor.insAtRightEnd(c.root);d[y];)c.selectLeft();break;default:return}b.preventDefault(),c.scrollHoriz()},a.moveOutOf=a.moveTowards=a.deleteOutOf=a.deleteTowards=a.unselectInto=a.selectOutOf=a.selectTowards=function(){e("overridden or never called on this node")}}),I.open(function(a){function b(a,b){var c=a.notify("upDown").cursor,d=b+"Into",e=b+"OutOf";return c[z][d]?c.insAtLeftEnd(c[z][d]):c[y][d]?c.insAtRightEnd(c[y][d]):c.parent.bubble(function(a){var d=a[e];if(d){if("function"==typeof d&&(d=a[e](c)),d instanceof C)c.jumpUpDown(a,d);else{var f=this.controller,g=c._jQ,h=g.parentsUntil(".mq-root-block").last();0===h.length&&(h=g);var i=h.prevUntil(".nl").filter(":visible"),j=i.length;if("up"===b){var k=0===i.length?h.prev():i.last().prev(),l=k.prevUntil(".nl").filter(":visible");l=A(q.makeArray(l).reverse())}else{var m=h.next().hasClass("nl")?h.next():h.nextUntil(".nl").last().next(),l=m.nextUntil(".nl").filter(":visible");0===l.length&&(l=l.add(m))}if(l.length>0){var n=Math.min(l.length,j),o=A(l[Math.max(n-1,0)]),p=o.offset(),r=0!==n||o.hasClass("nl")?o.width()-1:1;f.seek(o,p.left+r,p.top+2),h.closest(".component_mathquill").trigger("scrollToCursor")}}if(!0!==d)return!1}}),a}this.onNotify(function(a){"move"!==a&&"upDown"!==a||this.show().clearSelection()}),a.escapeDir=function(a,b,c){f(a);var d=this.cursor;if(d.parent!==this.root&&c.preventDefault(),d.parent!==this.root)return d.parent.moveOutOf(a,d),this.notify("move")},L.leftRightIntoCmdGoes=function(a){if(a&&"up"!==a&&"down"!==a)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+a+'"';return a},a.moveDir=function(a){f(a);var b=this.cursor,c=b.options.leftRightIntoCmdGoes;return b.selection?b.insDirOf(a,b.selection.ends[a]):b[a]?b[a].moveTowards(a,b,c):b.parent.moveOutOf(a,b,c),this.notify("move")},a.moveLeft=function(){return this.moveDir(y)},a.moveRight=function(){return this.moveDir(z)},a.moveUp=function(){return b(this,"up")},a.moveDown=function(){return b(this,"down")},this.onNotify(function(a){"upDown"!==a&&(this.upDownCache={})}),this.onNotify(function(a){"edit"===a&&this.show().deleteSelection()}),a.deleteDir=function(a){f(a);var b=this.cursor,c=b.selection;return this.notify("edit"),c||(b[a]?b[a].deleteTowards(a,b):b.parent.deleteOutOf(a,b)),b[y].siblingDeleted&&b[y].siblingDeleted(b.options,z),b[z].siblingDeleted&&b[z].siblingDeleted(b.options,y),b.parent.bubble("reflow"),this},a.ctrlDeleteDir=function(a){f(a);var b=this.cursor;return!b[y]||b.selection?ctrlr.deleteDir():(this.notify("edit"),D(b.parent.ends[y],b[y]).remove(),b.insAtDirEnd(y,b.parent),b[y].siblingDeleted&&b[y].siblingDeleted(b.options,z),b[z].siblingDeleted&&b[z].siblingDeleted(b.options,y),b.parent.bubble("reflow"),this)},a.backspace=function(){return this.deleteDir(y)},a.deleteForward=function(){return this.deleteDir(z)},this.onNotify(function(a){"select"!==a&&this.endSelection()}),a.selectDir=function(a){var b=this.notify("select").cursor,c=b.selection;f(a),b.anticursor||b.startSelection();var d=b[a];d?c&&c.ends[a]===d&&b.anticursor[-a]!==d?d.unselectInto(a,b):d.selectTowards(a,b):b.parent.selectOutOf(a,b),b.clearSelection(),b.select()||b.show()},a.selectLeft=function(){return this.selectDir(y)},a.selectRight=function(){return this.selectDir(z)}});var T=function(){function a(a){var b=$();return a.adopt(b,0,0),b}function b(a){for(var b=a[0]||$(),c=1;c<a.length;c+=1)a[c].children().adopt(b,b.ends[z],0);return b}var c=R.string,d=R.regex,e=R.letter,f=R.any,g=R.optWhitespace,h=R.succeed,i=R.fail,j=e.map(function(a){return ga(a)}),k=d(/^[^${}\\_^]/).map(function(a){return X(a)}),l=d(/^[^\\a-eg-zA-Z]/).or(c("\\").then(d(/^[a-z]+/i).or(d(/^\s+/).result(" ")).or(f))).then(function(a){var b=E[a];return b?b(a).parser():i("unknown command: \\"+a)}),m=l.or(j).or(k),n=c("{").then(function(){return p}).skip(c("}")),o=g.then(n.or(m.map(a))),p=o.many().map(b).skip(g),q=c("[").then(o.then(function(a){return"]"!==a.join("latex")?h(a):i()}).many().map(b).skip(g)).skip(c("]")),r=p;return r.block=o,r.optBlock=q,r}();I.open(function(a,b){a.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},a.writeLatex=function(a){var b=this.notify("edit").cursor,c=R.all,d=R.eof,e=T.skip(d).or(c.result(!1)).parse(a);if(e&&!e.isEmpty()){e.children().adopt(b.parent,b[y],b[z]);e.jQize().insertBefore(b.jQ),b[y]=e.ends[z],e.finalizeInsert(b.options,b),e.ends[z][z].siblingCreated&&e.ends[z][z].siblingCreated(b.options,y),e.ends[y][y].siblingCreated&&e.ends[y][y].siblingCreated(b.options,z),b.parent.bubble("reflow")}return this},a.renderLatexMath=function(a){var b=this.root,c=this.cursor,d=R.all,e=R.eof,f=T.skip(e).or(d.result(!1)).parse(a);b.eachChild("postOrder","dispose"),b.ends[y]=b.ends[z]=0,f&&f.children().adopt(b,0,0);var g=b.jQ;if(f){var h=f.join("html");g.html(h),b.jQize(g.children()),b.finalizeInsert(c.options)}else g.empty();delete c.selection,c.insAtRightEnd(b)},a.renderLatexText=function(a){var b=this.root,c=this.cursor;b.jQ.children().slice(1).remove(),b.eachChild("postOrder","dispose"),b.ends[y]=b.ends[z]=0,delete c.selection,c.show().insAtRightEnd(b);var d=R.regex,e=R.string,f=R.eof,g=R.all,h=e("$").then(T).skip(e("$").or(f)).map(function(a){var b=ca(c);b.createBlocks();var d=b.ends[y];return a.children().adopt(d,0,0),b}),i=e("\\$").result("$"),j=i.or(d(/^[^$]/)).map(X),k=h.or(j).many(),l=k.skip(f).or(g.result(!1)).parse(a);if(l){for(var m=0;m<l.length;m+=1)l[m].adopt(b,b.ends[z],0);b.jQize().appendTo(b.jQ),b.finalizeInsert(c.options)}}}),I.open(function(b){K.p.ignoreNextMousedown=a,b.delegateMouseEvents=function(){var b=this.root.jQ;this.container.bind("mousedown.mathquill",function(c){function d(a){n=A(a.target)}function e(a){j.anticursor||j.startSelection(),i.seek(n,a.pageX,a.pageY).cursor.select(),n=p}function f(a){j.blink=k,j.selection||(i.editable?j.show():l.detach()),g.unbind("mousemove",d),A(a.target.ownerDocument).unbind("mousemove",e).unbind("mouseup",f)}var g=A(c.target).closest(".mq-root-block"),h=C.byId[g.attr(s)||b.attr(s)],i=h.controller,j=i.cursor,k=j.blink,l=i.textareaSpan,m=i.textarea;if(c.preventDefault(),c.target.unselectable=!0,!j.options.ignoreNextMousedown(c)){j.options.ignoreNextMousedown=a;var n;i.blurred&&(i.editable||g.prepend(l),m.focus()),j.blink=a;var o=A(c.target),q=c.pageX,r=c.pageY;if(o.hasClass("component_mathquill")||o.hasClass("mq-root-block")){var t=o.closest(".component_mathquill").find(".mq-root-block").first(),u=t.find(".nl"),v=t.children().first(),w=c.pageX<t.offset().left,x=!1;u.each(function(a,b){A(b).offset().top<c.pageY&&(v=A(b),x=a+1===u.length)});var y=v.nextUntil(".nl").filter(":visible").not(".mq-cursor"),z=w?y.first():y.last();z.length>0?(o=z,q=z.offset().left+(w?1:z.width()),r=z.offset().top+1):x&&(o=o.closest(".component_mathquill"),q=o.offset().left+o.outerWidth()-5,r=o.offset().top+o.outerHeight()-2)}i.seek(o,q,r).cursor.startSelection(),g.mousemove(d),A(c.target.ownerDocument).mousemove(e).mouseup(f)}})}}),I.open(function(a){a.seek=function(a,b,c){var d=this.notify("select").cursor;if(a){var f=a.attr(s)||a.attr(r);if(!f){var g=a.parent();f=g.attr(s)||g.attr(r)}}var h=f?C.byId[f]:this.root;return e("nodeId is the id of some Node that exists",h),d.clearSelection().show(),h.seek(b,d),this.scrollHoriz(),this}}),I.open(function(a){a.scrollHoriz=function(){var a=this.cursor,b=a.selection,c=this.root.jQ[0].getBoundingClientRect();if(b){var d=b.jQ[0].getBoundingClientRect(),e=d.left-(c.left+20),f=d.right-(c.right-20);if(b.ends[y]===a[z])if(e<0)var g=e;else{if(!(f>0))return;if(d.left-f<c.left+20)var g=e;else var g=f}else if(f>0)var g=f;else{if(!(e<0))return;if(d.right-e>c.right-20)var g=f;else var g=e}}else{var h=a.jQ[0].getBoundingClientRect().left;if(h>c.right-20)var g=h-(c.right-20);else{if(!(h<c.left+20))return;var g=h-(c.left+20)}}this.root.jQ.stop().animate({scrollLeft:"+="+g},100)}}),I.open(function(a){K.p.substituteTextarea=function(){return A("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},a.createTextarea=function(){var a=this.textareaSpan=A('<span class="mq-textarea"></span>'),b=this.options.substituteTextarea();if(!b.nodeType)throw"substituteTextarea() must return a DOM element, got "+b;b=this.textarea=A(b).appendTo(a);var c=this;c.cursor.selectionChanged=function(){c.selectionChanged()},c.container.bind("copy",function(){c.setTextareaSelection()})},a.selectionChanged=function(){var a=this;ta(a.container[0]),a.textareaSelectionTimeout===p&&(a.textareaSelectionTimeout=setTimeout(function(){a.setTextareaSelection()}))},a.setTextareaSelection=function(){this.textareaSelectionTimeout=p;var a="";this.cursor.selection&&(a=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(a="$"+a+"$")),this.selectFn(a)},a.staticMathTextareaEvents=function(){function a(){e.detach(),b.blurred=!0}var b=this,c=(b.root,b.cursor),d=b.textarea,e=b.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+b.exportLatex()+"$</span>"),b.blurred=!0,d.bind("cut paste",!1).focus(function(){b.blurred=!1}).blur(function(){c.selection&&c.selection.clear(),setTimeout(a)}),b.selectFn=function(a){d.val(a),a&&d.select()}},a.editablesTextareaEvents=function(){var a=this,b=(a.root,a.cursor),c=a.textarea,d=a.textareaSpan,e=S(c,this);this.selectFn=function(a){e.select(a)},this.container.prepend(d).on("cut",function(c){b.selection&&setTimeout(function(){a.notify("edit"),b.parent.bubble("reflow")})}),this.focusBlurEvents()},a.typedText=function(a){if("\n"===a)return this.handle("enter");var b=this.notify().cursor;b.parent.write(b,a),this.scrollHoriz()},a.paste=function(a){this.options.statelessClipboard&&(a="$"===a.slice(0,1)&&"$"===a.slice(-1)?a.slice(1,-1):"\\text{"+a+"}"),this.writeLatex(a).cursor.show()}});var U=x(C,function(a,b){a.finalizeInsert=function(a,b){var c=this;c.postOrder("finalizeTree",a),c.postOrder("contactWeld",b),c.postOrder("blur"),c.postOrder("reflow"),c[z].siblingCreated&&c[z].siblingCreated(a,y),c[y].siblingCreated&&c[y].siblingCreated(a,z),c.bubble("reflow")}}),V=x(U,function(a,b){a.init=function(a,c,d){var e=this;b.init.call(e),e.ctrlSeq||(e.ctrlSeq=a),c&&(e.htmlTemplate=c),d&&(e.textTemplate=d)},a.replaces=function(a){a.disown(),this.replacedFragment=a},a.isEmpty=function(){return this.foldChildren(!0,function(a,b){return a&&b.isEmpty()})},a.parser=function(){var a=T.block,b=this;return a.times(b.numBlocks()).map(function(a){b.blocks=a;for(var c=0;c<a.length;c+=1)a[c].adopt(b,b.ends[z],0);return b})},a.createLeftOf=function(a){var c=this,d=c.replacedFragment;c.createBlocks(),b.createLeftOf.call(c,a),d&&(d.adopt(c.ends[y],0,0),d.jQ.appendTo(c.ends[y].jQ)),c.finalizeInsert(a.options),c.placeCursor(a)},a.createBlocks=function(){for(var a=this,b=a.numBlocks(),c=a.blocks=Array(b),d=0;d<b;d+=1){(c[d]=$()).adopt(a,a.ends[z],0)}},a.placeCursor=function(a){a.insAtRightEnd(this.foldChildren(this.ends[y],function(a,b){return a.isEmpty()?a:b}))},a.moveTowards=function(a,b,c){var d=c&&this[c+"Into"];b.insAtDirEnd(-a,d||this.ends[-a])},a.deleteTowards=function(a,b){this.isEmpty()?b[a]=this.remove()[a]:this.moveTowards(a,b,null)},a.selectTowards=function(a,b){b[-a]=this,b[a]=this[a]},a.selectChildren=function(){return H(this,this)},a.unselectInto=function(a,b){b.insAtDirEnd(-a,b.anticursor.ancestors[this.id])},a.seek=function(a,b){function c(a){var b={};return b[y]=a.jQ.offset().left,b[z]=b[y]+a.jQ.outerWidth(),b}var d=this,e=c(d);if(a<e[y])return b.insLeftOf(d);if(a>e[z])return b.insRightOf(d);var f=e[y];d.eachChild(function(g){var h=c(g);return a<h[y]?(a-f<h[y]-a?g[y]?b.insAtRightEnd(g[y]):b.insLeftOf(d):b.insAtLeftEnd(g),!1):a>h[z]?void(g[z]?f=h[z]:e[z]-a<a-h[z]?b.insRightOf(d):b.insAtRightEnd(g)):(g.seek(a,b),!1)})},a.numBlocks=function(){var a=this.htmlTemplate.match(/&\d+/g);return a?a.length:0},a.html=function(){var a=this,b=a.blocks,c=" mathquill-command-id="+a.id,d=a.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);e("no unmatched angle brackets",d.join("")===this.htmlTemplate);for(var f=0,g=d[0];g;f+=1,g=d[f])if("/>"===g.slice(-2))d[f]=g.slice(0,-2)+c+"/>";else if("<"===g.charAt(0)){e("not an unmatched top-level close tag","/"!==g.charAt(1)),d[f]=g.slice(0,-1)+c+">";var h=1;do{f+=1,g=d[f],e("no missing close tags",g),"</"===g.slice(0,2)?h-=1:"<"===g.charAt(0)&&"/>"!==g.slice(-2)&&(h+=1)}while(h>0)}return d.join("").replace(/>&(\d+)/g,function(a,c){return" mathquill-block-id="+b[c].id+">"+b[c].join("html")})},a.latex=function(){return this.foldChildren(this.ctrlSeq,function(a,b){return a+"{"+(b.latex()||" ")+"}"})},a.textTemplate=[""],a.text=function(){var a=this,b=0;return a.foldChildren(a.textTemplate[b],function(c,d){b+=1;var e=d.text();return c&&"("===a.textTemplate[b]&&"("===e[0]&&")"===e.slice(-1)?c+e.slice(1,-1)+a.textTemplate[b]:c+d.text()+(a.textTemplate[b]||"")})}}),W=x(V,function(b,c){b.init=function(a,b,d){d||(d=a&&a.length>1?a.slice(1):a),c.init.call(this,a,b,[d])},b.parser=function(){return R.succeed(this)},b.numBlocks=function(){return 0},b.replaces=function(a){a.remove()},b.createBlocks=a,b.moveTowards=function(a,b){b.jQ.insDirOf(a,this.jQ),b[-a]=this,b[a]=this[a]},b.deleteTowards=function(a,b){b[a]=this.remove()[a]},b.seek=function(a,b){a-this.jQ.offset().left<this.jQ.outerWidth()/2?b.insLeftOf(this):b.insRightOf(this)},b.latex=function(){return this.ctrlSeq},b.text=function(){return this.textTemplate},b.placeCursor=a,b.isEmpty=function(){return!0}}),X=x(W,function(a,b){a.init=function(a,c){b.init.call(this,a,"<span>"+(c||a)+"</span>")}}),Y=x(W,function(a,b){a.init=function(a,c){b.init.call(this,a,'<span class="space-char">'+(c||a)+"</span>")}}),Z=x(W,function(a,b){a.init=function(a,c,d){b.init.call(this,a,'<span class="mq-binary-operator">'+c+"</span>",d)}}),$=x(U,function(a,b){a.join=function(a){return this.foldChildren("",function(b,c){return b+c[a]()})},a.html=function(){return this.join("html")},a.latex=function(){return this.join("latex")},a.text=function(){return this.ends[y]===this.ends[z]&&0!==this.ends[y]?this.ends[y].text():this.join("text")},a.keystroke=function(a,c,d){return!d.options.spaceBehavesLikeTab||"Spacebar"!==a&&"Shift-Spacebar"!==a?b.keystroke.apply(this,arguments):(c.preventDefault(),void d.escapeDir("Shift-Spacebar"===a?y:z,a,c))},a.moveOutOf=function(a,b,c){c&&this.parent[c+"Into"]||!this[a]?b.insDirOf(a,this.parent):b.insAtDirEnd(-a,this[a])},a.selectOutOf=function(a,b){b.insDirOf(a,this.parent)},a.deleteOutOf=function(a,b){b.unwrapGramp()},a.seek=function(a,b){var c=this.ends[z];if(!c||c.jQ.offset().left+c.jQ.outerWidth()<a)return b.insAtRightEnd(this);if(a<this.ends[y].jQ.offset().left)return b.insAtLeftEnd(this);for(;a<c.jQ.offset().left;)c=c[y];return c.seek(a,b)},a.chToCmd=function(a){var b;return a.match(/^[a-eg-zA-Z]$/)?ga(a):/^\d$/.test(a)?ea(a):(b=F[a]||E[a])?b(a):X(a)},a.write=function(a,b){var c=this.chToCmd(b);a.selection&&c.replaces(a.replaceSelection()),c.createLeftOf(a.show())},a.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},a.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}});J.StaticMath=function(a){return x(a.AbstractMathQuill,function(b,c){this.RootBlock=$,b.__mathquillify=function(){return c.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},b.init=function(){c.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],a.MathField)},b.latex=function(){var b=c.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],a.MathField),b}})};var _=x($,k);J.MathField=function(b){return x(b.EditableField,function(b,c){this.RootBlock=_,b.__mathquillify=function(b,d){return this.config(b),d>1&&(this.__controller.root.reflow=a),c.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})};var aa=x(C,function(a,b){function c(a){a.jQ[0].normalize();var b=a.jQ[0].firstChild;if(b){e("only node in TextBlock span is Text node",3===b.nodeType);var c=ba(b.data);return c.jQadd(b),a.children().disown(),c.adopt(a,0,0)}}a.ctrlSeq="\\text",a.replaces=function(a){a instanceof D?this.replacedText=a.remove().jQ.text():"string"==typeof a&&(this.replacedText=a)},a.jQadd=function(a){b.jQadd.call(this,a),this.ends[y]&&this.ends[y].jQadd(this.jQ[0].firstChild)},a.createLeftOf=function(a){var c=this;if(b.createLeftOf.call(this,a),c[z].siblingCreated&&c[z].siblingCreated(a.options,y),c[y].siblingCreated&&c[y].siblingCreated(a.options,z),c.bubble("reflow"),a.insAtRightEnd(c),c.replacedText)for(var d=0;d<c.replacedText.length;d+=1)c.write(a,c.replacedText.charAt(d))},a.parser=function(){var a=this,b=R.string,c=R.regex;return R.optWhitespace.then(b("{")).then(c(/^[^}]*/)).skip(b("}")).map(function(b){return 0===b.length?D():(ba(b).adopt(a,0,0),a)})},a.textContents=function(){return this.foldChildren("",function(a,b){return a+b.text})},a.text=function(){return'"'+this.textContents()+'"'},a.latex=function(){var a=this.textContents();return 0===a.length?"":"\\text{"+a+"}"},a.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},a.moveTowards=function(a,b){b.insAtDirEnd(-a,this)},a.moveOutOf=function(a,b){b.insDirOf(a,this)},a.unselectInto=a.moveTowards,a.selectTowards=V.prototype.selectTowards,a.deleteTowards=V.prototype.deleteTowards,a.selectOutOf=function(a,b){b.insDirOf(a,this)},a.deleteOutOf=function(a,b){this.isEmpty()&&b.insRightOf(this)},a.write=function(a,c){if(a.show().deleteSelection(),"$"!==c)a[y]?a[y].appendText(c):ba(c).createLeftOf(a);else if(this.isEmpty())a.insRightOf(this),X("\\$","$").createLeftOf(a);else if(a[z])if(a[y]){var d=aa(),e=this.ends[y];e.disown().jQ.detach(),e.adopt(d,0,0),a.insLeftOf(this),b.createLeftOf.call(d,a)}else a.insLeftOf(this);else a.insRightOf(this)},a.seek=function(a,b){b.hide();var d=c(this),e=this.jQ.width()/this.text.length,f=Math.round((a-this.jQ.offset().left)/e);f<=0?b.insAtLeftEnd(this):f>=d.text.length?b.insAtRightEnd(this):b.insLeftOf(d.splitRight(f));for(var g=a-b.show().offset().left,h=g&&g<0?y:z,i=h;b[h]&&g*i>0;)b[h].moveTowards(h,b),i=g,g=a-b.offset().left;if(h*g<-h*i&&b[-h].moveTowards(-h,b),b.anticursor){if(b.anticursor.parent===this){var j=b[y]&&b[y].text.length;if(this.anticursorPosition===j)b.anticursor=B.copy(b);else{if(this.anticursorPosition<j){var k=b[y].splitRight(this.anticursorPosition);b[y]=k}else var k=b[z].splitRight(this.anticursorPosition-j);b.anticursor=B(this,k[y],k)}}}else this.anticursorPosition=b[y]&&b[y].text.length},a.blur=function(a){$.prototype.blur.call(this),a&&(""===this.textContents()?(this.remove(),a[y]===this?a[y]=this[y]:a[z]===this&&(a[z]=this[z])):c(this))},a.focus=$.prototype.focus}),ba=x(C,function(a,b){function c(a,b){return b.charAt(a===y?0:-1+b.length)}a.init=function(a){b.init.call(this),this.text=a},a.jQadd=function(a){this.dom=a,this.jQ=A(a)},a.jQize=function(){return this.jQadd(document.createTextNode(this.text))},a.appendText=function(a){this.text+=a,this.dom.appendData(a)},a.prependText=function(a){this.text=a+this.text,this.dom.insertData(0,a)},a.insTextAtDirEnd=function(a,b){f(b),b===z?this.appendText(a):this.prependText(a)},a.splitRight=function(a){var b=ba(this.text.slice(a)).adopt(this.parent,this,this[z]);return b.jQadd(this.dom.splitText(a)),this.text=this.text.slice(0,a),b},a.moveTowards=function(a,b){f(a);var d=c(-a,this.text),e=this[-a];return e?e.insTextAtDirEnd(d,a):ba(d).createDir(-a,b),this.deleteTowards(a,b)},a.latex=function(){return this.text},a.deleteTowards=function(a,b){this.text.length>1?a===z?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),b[a]=this[a])},a.selectTowards=function(a,b){f(a);var d=b.anticursor,e=c(-a,this.text);if(d[a]===this){var g=ba(e).createDir(a,b);d[a]=g,b.insDirOf(a,g)}else{var h=this[-a];if(h)h.insTextAtDirEnd(e,a);else{var g=ba(e).createDir(-a,b);g.jQ.insDirOf(-a,b.selection.jQ)}1===this.text.length&&d[-a]===this&&(d[-a]=this[-a])}return this.deleteTowards(a,b)}});E.text=E.textnormal=E.textrm=E.textup=E.textmd=aa,E.em=E.italic=E.italics=E.emph=E.textit=E.textsl=l("\\textit","i",'class="mq-text-mode"'),E.strong=E.bold=E.textbf=l("\\textbf","b",'class="mq-text-mode"'),E.sf=E.textsf=l("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),E.tt=E.texttt=l("\\texttt","span",'class="mq-monospace mq-text-mode"'),E.textsc=l("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),E.uppercase=l("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),E.lowercase=l("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"');var ca=x(V,function(a,b){a.init=function(a){b.init.call(this,"$"),this.cursor=a},a.htmlTemplate='<span class="mq-math-mode">&0</span>',a.createBlocks=function(){b.createBlocks.call(this),this.ends[y].cursor=this.cursor,this.ends[y].write=function(a,b){"$"!==b?$.prototype.write.call(this,a,b):this.isEmpty()?(a.insRightOf(this.parent),this.parent.deleteTowards(dir,a),X("\\$","$").createLeftOf(a.show())):a[z]?a[y]?$.prototype.write.call(this,a,b):a.insLeftOf(this.parent):a.insRightOf(this.parent)}},a.latex=function(){return"$"+this.ends[y].latex()+"$"}}),da=x(_,function(a,b){a.keystroke=function(a){if("Spacebar"!==a&&"Shift-Spacebar"!==a)return b.keystroke.apply(this,arguments)},a.write=function(a,b){if(a.show().deleteSelection(),"$"===b)ca(a).createLeftOf(a);else{var c;"<"===b?c="&lt;":">"===b&&(c="&gt;"),X(b,c).createLeftOf(a)}}});J.TextField=function(a){return x(a.EditableField,function(a,b){this.RootBlock=da,a.__mathquillify=function(){return b.__mathquillify.call(this,"mq-editable-field mq-text-mode")},a.latex=function(a){return arguments.length>0?(this.__controller.renderLatexText(a),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})};F["\\"]=x(V,function(a,b){a.ctrlSeq="\\",a.replaces=function(a){this._replacedFragment=a.disown(),this.isEmpty=function(){return!1}},a.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',a.textTemplate=["\\"],a.createBlocks=function(){b.createBlocks.call(this),this.ends[y].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[y].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[y].write=function(a,b){a.show().deleteSelection(),b.match(/[a-z]/i)?X(b).createLeftOf(a):(this.parent.renderCommand(a),"\\"===b&&this.isEmpty()||this.parent.parent.write(a,b))},this.ends[y].keystroke=function(a,c,d){return"Tab"===a||"Enter"===a||"Spacebar"===a?(this.parent.renderCommand(d.cursor),void c.preventDefault()):b.keystroke.apply(this,arguments)}},a.createLeftOf=function(a){if(b.createLeftOf.call(this,a),this._replacedFragment){var c=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(a){return A(a.target=c).trigger(a),!1}).insertBefore(this.jQ).add(this.jQ)}},a.latex=function(){return"\\"+this.ends[y].latex()+" "},a.renderCommand=function(a){this.jQ=this.jQ.last(),this.remove(),this[z]?a.insLeftOf(this[z]):a.insAtRightEnd(this.parent);var b=this.ends[y].latex();b||(b=" ");var c=E[b]||Ma[b];c?(c=c(b),this._replacedFragment&&c.replaces(this._replacedFragment),c.createLeftOf(a)):(c=aa(),c.replaces(b),c.createLeftOf(a),a.insRightOf(c),this._replacedFragment&&this._replacedFragment.remove())}});E.notin=E.cong=E.equiv=E.oplus=E.otimes=x(Z,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","&"+a+";")}}),E[""]=E.ne=E.neq=d(Z,"\\ne ","&ne;"),E.ast=E.star=E.loast=E.lowast=d(Z,"\\ast ","&lowast;"),E.therefor=E.therefore=d(Z,"\\therefore ","&there4;"),E.cuz=E.because=d(Z,"\\because ","&#8757;"),E.prop=E.propto=d(Z,"\\propto ","&prop;"),E[""]=E.asymp=E.approx=d(Z,"\\approx ","&asymp;"),E.isin=E.in=d(Z,"\\in ","&isin;"),E.ni=E.contains=d(Z,"\\ni ","&ni;"),E.notni=E.niton=E.notcontains=E.doesnotcontain=d(Z,"\\not\\ni ","&#8716;"),E.sub=E.subset=d(Z,"\\subset ","&sub;"),E.sup=E.supset=E.superset=d(Z,"\\supset ","&sup;"),E.nsub=E.notsub=E.nsubset=E.notsubset=d(Z,"\\not\\subset ","&#8836;"),E.nsup=E.notsup=E.nsupset=E.notsupset=E.nsuperset=E.notsuperset=d(Z,"\\not\\supset ","&#8837;"),E.sube=E.subeq=E.subsete=E.subseteq=d(Z,"\\subseteq ","&sube;"),E.supe=E.supeq=E.supsete=E.supseteq=E.supersete=E.superseteq=d(Z,"\\supseteq ","&supe;"),E.nsube=E.nsubeq=E.notsube=E.notsubeq=E.nsubsete=E.nsubseteq=E.notsubsete=E.notsubseteq=d(Z,"\\not\\subseteq ","&#8840;"),E.nsupe=E.nsupeq=E.notsupe=E.notsupeq=E.nsupsete=E.nsupseteq=E.notsupsete=E.notsupseteq=E.nsupersete=E.nsuperseteq=E.notsupersete=E.notsuperseteq=d(Z,"\\not\\supseteq ","&#8841;"),E.N=E.naturals=E.Naturals=d(X,"\\mathbb{N}","&#8469;"),E.P=E.primes=E.Primes=E.projective=E.Projective=E.probability=E.Probability=d(X,"\\mathbb{P}","&#8473;"),E.Z=E.integers=E.Integers=d(X,"\\mathbb{Z}","&#8484;"),E.Q=E.rationals=E.Rationals=d(X,"\\mathbb{Q}","&#8474;"),E.R=E.reals=E.Reals=d(X,"\\mathbb{R}","&#8477;"),E.C=E.complex=E.Complex=E.complexes=E.Complexes=E.complexplane=E.Complexplane=E.ComplexPlane=d(X,"\\mathbb{C}","&#8450;"),E.H=E.Hamiltonian=E.quaternions=E.Quaternions=d(X,"\\mathbb{H}","&#8461;"),E.quad=E.emsp=d(X,"\\quad ","    "),E.qquad=d(X,"\\qquad ","        "),E.diamond=d(X,"\\diamond ","&#9671;"),E.bigtriangleup=d(X,"\\bigtriangleup ","&#9651;"),E.ominus=d(X,"\\ominus ","&#8854;"),E.uplus=d(X,"\\uplus ","&#8846;"),E.bigtriangledown=d(X,"\\bigtriangledown ","&#9661;"),E.sqcap=d(X,"\\sqcap ","&#8851;"),E.triangleleft=d(X,"\\triangleleft ","&#8882;"),E.sqcup=d(X,"\\sqcup ","&#8852;"),E.triangleright=d(X,"\\triangleright ","&#8883;"),E.odot=E.circledot=d(X,"\\odot ","&#8857;"),E.bigcirc=d(X,"\\bigcirc ","&#9711;"),E.dagger=d(X,"\\dagger ","&#0134;"),E.ddagger=d(X,"\\ddagger ","&#135;"),E.wr=d(X,"\\wr ","&#8768;"),E.amalg=d(X,"\\amalg ","&#8720;"),E.models=d(X,"\\models ","&#8872;"),E.prec=d(X,"\\prec ","&#8826;"),E.succ=d(X,"\\succ ","&#8827;"),E.preceq=d(X,"\\preceq ","&#8828;"),E.succeq=d(X,"\\succeq ","&#8829;"),E.simeq=d(X,"\\simeq ","&#8771;"),E.mid=d(X,"\\mid ","&#8739;"),E.ll=d(X,"\\ll ","&#8810;"),E.gg=d(X,"\\gg ","&#8811;"),E.parallel=d(X,"\\parallel ","&#8741;"),E.nparallel=d(X,"\\nparallel ","&#8742;"),E.bowtie=d(X,"\\bowtie ","&#8904;"),E.sqsubset=d(X,"\\sqsubset ","&#8847;"),E.sqsupset=d(X,"\\sqsupset ","&#8848;"),E.smile=d(X,"\\smile ","&#8995;"),E.sqsubseteq=d(X,"\\sqsubseteq ","&#8849;"),E.sqsupseteq=d(X,"\\sqsupseteq ","&#8850;"),E.doteq=d(X,"\\doteq ","&#8784;"),E.frown=d(X,"\\frown ","&#8994;"),E.vdash=d(X,"\\vdash ","&#8870;"),E.dashv=d(X,"\\dashv ","&#8867;"),E.nless=d(X,"\\nless ","&#8814;"),E.ngtr=d(X,"\\ngtr ","&#8815;"),E.longleftarrow=d(X,"\\longleftarrow ","&#8592;"),E.longrightarrow=d(X,"\\longrightarrow ","&#8594;"),E.Longleftarrow=d(X,"\\Longleftarrow ","&#8656;"),E.Longrightarrow=d(X,"\\Longrightarrow ","&#8658;"),E.longleftrightarrow=d(X,"\\longleftrightarrow ","&#8596;"),E.updownarrow=d(X,"\\updownarrow ","&#8597;"),E.Longleftrightarrow=d(X,"\\Longleftrightarrow ","&#8660;"),E.Updownarrow=d(X,"\\Updownarrow ","&#8661;"),E.mapsto=d(X,"\\mapsto ","&#8614;"),E.nearrow=d(X,"\\nearrow ","&#8599;"),E.hookleftarrow=d(X,"\\hookleftarrow ","&#8617;"),E.hookrightarrow=d(X,"\\hookrightarrow ","&#8618;"),E.searrow=d(X,"\\searrow ","&#8600;"),E.leftharpoonup=d(X,"\\leftharpoonup ","&#8636;"),E.rightharpoonup=d(X,"\\rightharpoonup ","&#8640;"),E.swarrow=d(X,"\\swarrow ","&#8601;"),E.leftharpoondown=d(X,"\\leftharpoondown ","&#8637;"),E.rightharpoondown=d(X,"\\rightharpoondown ","&#8641;"),E.nwarrow=d(X,"\\nwarrow ","&#8598;"),E.ldots=d(X,"\\ldots ","&#8230;"),E.cdots=d(X,"\\cdots ","&#8943;"),E.vdots=d(X,"\\vdots ","&#8942;"),E.ddots=d(X,"\\ddots ","&#8945;"),E.surd=d(X,"\\surd ","&#8730;"),E.triangle=d(X,"\\triangle ","&#9651;"),E.ell=d(X,"\\ell ","&#8467;"),E.top=d(X,"\\top ","&#8868;"),E.flat=d(X,"\\flat ","&#9837;"),E.natural=d(X,"\\natural ","&#9838;"),E.sharp=d(X,"\\sharp ","&#9839;"),E.wp=d(X,"\\wp ","&#8472;"),E.bot=d(X,"\\bot ","&#8869;"),E.clubsuit=d(X,"\\clubsuit ","&#9827;"),E.diamondsuit=d(X,"\\diamondsuit ","&#9826;"),E.heartsuit=d(X,"\\heartsuit ","&#9825;"),E.spadesuit=d(X,"\\spadesuit ","&#9824;"),E.parallelogram=d(X,"\\parallelogram ","&#9649;"),E.square=d(X,"\\square ","&#11036;"),E.oint=d(X,"\\oint ","&#8750;"),E.bigcap=d(X,"\\bigcap ","&#8745;"),E.bigcup=d(X,"\\bigcup ","&#8746;"),E.bigsqcup=d(X,"\\bigsqcup ","&#8852;"),E.bigvee=d(X,"\\bigvee ","&#8744;"),E.bigwedge=d(X,"\\bigwedge ","&#8743;"),E.bigodot=d(X,"\\bigodot ","&#8857;"),E.bigotimes=d(X,"\\bigotimes ","&#8855;"),E.bigoplus=d(X,"\\bigoplus ","&#8853;"),E.biguplus=d(X,"\\biguplus ","&#8846;"),E.lfloor=d(X,"\\lfloor ","&#8970;"),E.rfloor=d(X,"\\rfloor ","&#8971;"),E.lceil=d(X,"\\lceil ","&#8968;"),E.rceil=d(X,"\\rceil ","&#8969;"),E.opencurlybrace=E.lbrace=d(X,"\\lbrace ","{"),E.closecurlybrace=E.rbrace=d(X,"\\rbrace ","}"),E.lbrack=d(X,"["),E.rbrack=d(X,"]"),E.lparenth=d(X,"("),E.rparenth=d(X,")"),E.slash=d(X,"/"),E.vert=d(X,"|"),E.perp=E.perpendicular=d(X,"\\perp ","&perp;"),E.nabla=E.del=d(X,"\\nabla ","&nabla;"),E.hbar=d(X,"\\hbar ","&#8463;"),E.AA=E.Angstrom=E.angstrom=d(X,"\\text\\AA ","&#8491;"),E.ring=E.circ=E.circle=d(X,"\\circ ","&#8728;"),E.bull=E.bullet=d(X,"\\bullet ","&bull;"),E.setminus=E.smallsetminus=d(X,"\\setminus ","&#8726;"),E.not=E[""]=E.neg=d(X,"\\neg ","&not;"),E[""]=E.dots=E.ellip=E.hellip=E.ellipsis=E.hellipsis=d(X,"\\dots ","&hellip;"),E.converges=E.darr=E.dnarr=E.dnarrow=E.downarrow=d(X,"\\downarrow ","&darr;"),E.dArr=E.dnArr=E.dnArrow=E.Downarrow=d(X,"\\Downarrow ","&dArr;"),E.diverges=E.uarr=E.uparrow=d(X,"\\uparrow ","&uarr;"),E.uArr=E.Uparrow=d(X,"\\Uparrow ","&uArr;"),E.to=d(Z,"\\to ","&rarr;"),E.rarr=E.rightarrow=d(X,"\\rightarrow ","&rarr;"),E.implies=d(Z,"\\Rightarrow ","&rArr;"),E.rArr=E.Rightarrow=d(X,"\\Rightarrow ","&rArr;"),E.gets=d(Z,"\\gets ","&larr;"),E.larr=E.leftarrow=d(X,"\\leftarrow ","&larr;"),E.impliedby=d(Z,"\\Leftarrow ","&lArr;"),E.lArr=E.Leftarrow=d(X,"\\Leftarrow ","&lArr;"),E.harr=E.lrarr=E.leftrightarrow=d(X,"\\leftrightarrow ","&harr;"),E.iff=d(Z,"\\Leftrightarrow ","&hArr;"),E.hArr=E.lrArr=E.Leftrightarrow=d(X,"\\Leftrightarrow ","&hArr;"),E.Re=E.Real=E.real=d(X,"\\Re ","&real;"),E.Im=E.imag=E.image=E.imagin=E.imaginary=E.Imaginary=d(X,"\\Im ","&image;"),E.part=E.partial=d(X,"\\partial ","&part;"),E.infty=E.infin=E.infinity=d(X,"\\infty ","&infin;"),E.alef=E.alefsym=E.aleph=E.alephsym=d(X,"\\aleph ","&alefsym;"),E.xist=E.xists=E.exist=E.exists=d(X,"\\exists ","&exist;"),E.nexists=E.nexist=d(X,"\\nexists ","&#8708;"),E.and=E.land=E.wedge=d(X,"\\wedge ","&and;"),E.or=E.lor=E.vee=d(X,"\\vee ","&or;"),E.o=E.O=E.empty=E.emptyset=E.oslash=E.Oslash=E.nothing=E.varnothing=d(Z,"\\varnothing ","&empty;"),E.cup=E.union=d(Z,"\\cup ","&cup;"),E.cap=E.intersect=E.intersection=d(Z,"\\cap ","&cap;"),E.deg=E.degree=d(X,"\\degree ","&deg;"),E.ang=E.angle=d(X,"\\angle ","&ang;"),E.measuredangle=d(X,"\\measuredangle ","&#8737;");var ea=x(X,function(a,b){a.createLeftOf=function(a){a.options.autoSubscriptNumerals&&a.parent!==a.parent.parent.sub&&(a[y]instanceof fa&&!1!==a[y].isItalic||a[y]instanceof Ca&&a[y][y]instanceof fa&&!1!==a[y][y].isItalic)?(E._().createLeftOf(a),b.createLeftOf.call(this,a),a.insRightOf(a.parent.parent)):b.createLeftOf.call(this,a)}}),fa=x(W,function(a,b){a.init=function(a,c){b.init.call(this,a,"<var>"+(c||a)+"</var>")},a.text=function(){var a=this.ctrlSeq;return!this[y]||this[y]instanceof fa||this[y]instanceof Z||"\\ "===this[y].ctrlSeq||(a="*"+a),!this[z]||this[z]instanceof Z||this[z]instanceof Ca||(a+="*"),a}});K.p.autoCommands={_maxLength:0},L.autoCommands=function(a){if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw'"'+a+'" not a space-delimited list of only letters';for(var b=a.split(" "),c={},d=0,e=0;e<b.length;e+=1){var f=b[e];if(f.length<2)throw'autocommand "'+f+'" not minimum length of 2';if(E[f]===ia)throw'"'+f+'" is a built-in operator name';c[f]=1,d=u(d,f.length)}return c._maxLength=d,c};var ga=x(fa,function(a,b){a.init=function(a){return b.init.call(this,this.letter=a)},a.createLeftOf=function(a){b.createLeftOf.apply(this,arguments);var c=a.options.autoCommands,d=c._maxLength;if(d>0){for(var e="",f=this,g=0;f instanceof ga&&f.ctrlSeq===f.letter&&g<d;)e=f.letter+e,f=f[y],g+=1;for(;e.length;){if(c.hasOwnProperty(e)){for(var g=1,f=this;g<e.length;g+=1,f=f[y]);return D(f,this).remove(),a[y]=f[y],E[e](e).createLeftOf(a)}e=e.slice(1)}}},a.italicize=function(a){return this.isItalic=a,this.jQ.toggleClass("mq-operator-name",!a),this},a.finalizeTree=a.siblingDeleted=a.siblingCreated=function(a,b){b!==y&&this[z]instanceof ga||this.autoUnItalicize(a)},a.autoUnItalicize=function(a){if(0!==a.autoOperatorNames._maxLength){for(var b=this.letter,c=this[y];c instanceof ga;c=c[y])b=c.letter+b;for(var d=this[z];d instanceof ga;d=d[z])b+=d.letter;D(c[z]||this.parent.ends[y],d[y]||this.parent.ends[z]).each(function(a){a.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),a.ctrlSeq=a.letter});for(var e=0,f=c[z]||this.parent.ends[y];e<b.length;e+=1,f=f[z]);}}}),ha=K.p.autoOperatorNames={_maxLength:9};L.autoOperatorNames=function(a){if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw'"'+a+'" not a space-delimited list of only letters';for(var b=a.split(" "),c={},d=0,e=0;e<b.length;e+=1){var f=b[e];if(f.length<2)throw'"'+f+'" not minimum length of 2';c[f]=1,d=u(d,f.length)}return c._maxLength=d,c};var ia=x(W,function(a,b){a.init=function(a){this.ctrlSeq=a},a.createLeftOf=function(a){for(var b=this.ctrlSeq,c=0;c<b.length;c+=1)ga(b.charAt(c)).createLeftOf(a)},a.parser=function(){for(var a=this.ctrlSeq,b=$(),c=0;c<a.length;c+=1)ga(a.charAt(c)).adopt(b,b.ends[z],0);return R.succeed(b.children())}});for(var ja in ha)ha.hasOwnProperty(ja)&&(E[ja]=ia);E.operatorname=x(V,function(b){b.createLeftOf=a,b.numBlocks=function(){return 1},b.parser=function(){return T.block.map(function(a){return a.children()})}}),E.f=x(ga,function(a,b){a.init=function(){W.p.init.call(this,this.letter="f","<var>f</var>")}}),E[" "]=E.space=d(Y,"\\ ","&nbsp;"),E["'"]=E.prime=d(X,"'","&prime;"),E.backslash=d(X,"\\backslash ","\\"),F["\\"]||(F["\\"]=E.backslash),E.$=d(X,"\\$","$");var ka=x(W,function(a,b){a.init=function(a,c){b.init.call(this,a,'<span class="mq-nonSymbola">'+(c||a)+"</span>")}});E["@"]=ka,E["&"]=d(ka,"\\&","&amp;"),E["%"]=d(ka,"\\%","%"),E.alpha=E.beta=E.gamma=E.delta=E.zeta=E.eta=E.theta=E.iota=E.kappa=E.mu=E.nu=E.xi=E.rho=E.sigma=E.tau=E.chi=E.psi=E.omega=x(fa,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","&"+a+";")}}),E.phi=d(fa,"\\phi ","&#981;"),E.phiv=E.varphi=d(fa,"\\varphi ","&phi;"),E.epsilon=d(fa,"\\epsilon ","&#1013;"),E.epsiv=E.varepsilon=d(fa,"\\varepsilon ","&epsilon;"),E.piv=E.varpi=d(fa,"\\varpi ","&piv;"),E.sigmaf=E.sigmav=E.varsigma=d(fa,"\\varsigma ","&sigmaf;"),E.thetav=E.vartheta=E.thetasym=d(fa,"\\vartheta ","&thetasym;"),E.upsilon=E.upsi=d(fa,"\\upsilon ","&upsilon;"),E.gammad=E.Gammad=E.digamma=d(fa,"\\digamma ","&#989;"),E.kappav=E.varkappa=d(fa,"\\varkappa ","&#1008;"),E.rhov=E.varrho=d(fa,"\\varrho ","&#1009;"),E.pi=E[""]=d(ka,"\\pi ","&pi;"),E.lambda=d(ka,"\\lambda ","&lambda;"),E.Upsilon=E.Upsi=E.upsih=E.Upsih=d(W,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),E.Gamma=E.Delta=E.Theta=E.Lambda=E.Xi=E.Pi=E.Sigma=E.Phi=E.Psi=E.Omega=E.forall=x(X,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","&"+a+";")}});var la=x(V,function(a){a.init=function(a){this.latex=a},a.createLeftOf=function(a){var b=T.parse(this.latex);b.children().adopt(a.parent,a[y],a[z]),a[y]=b.ends[z],b.jQize().insertBefore(a.jQ),b.finalizeInsert(a.options,a),b.ends[z][z].siblingCreated&&b.ends[z][z].siblingCreated(a.options,y),b.ends[y][y].siblingCreated&&b.ends[y][y].siblingCreated(a.options,z),a.parent.bubble("reflow")},a.parser=function(){var a=T.parse(this.latex).children();return R.succeed(a)}});E[""]=d(la,"^1"),E[""]=d(la,"^2"),E[""]=d(la,"^3"),E[""]=d(la,"\\frac14"),E[""]=d(la,"\\frac12"),E[""]=d(la,"\\frac34");var ma=x(Z,function(a){a.init=X.prototype.init,a.contactWeld=a.siblingCreated=a.siblingDeleted=function(a,b){if(b!==z)return this.jQ[0].className=!this[y]||this[y]instanceof Z||/^[,;:\(\[]$/.test(this[y].ctrlSeq)?"":"mq-binary-operator",this}});E["+"]=d(ma,"+","+"),E[""]=E["-"]=d(ma,"-","&minus;"),E[""]=E.pm=E.plusmn=E.plusminus=d(ma,"\\pm ","&plusmn;"),E.mp=E.mnplus=E.minusplus=d(ma,"\\mp ","&#8723;"),F["*"]=E.sdot=E.cdot=d(Z,"\\cdot ","&middot;","*");var na=x(Z,function(a,b){a.init=function(a,c){this.data=a,this.strict=c;var d=c?"Strict":"";b.init.call(this,a["ctrlSeq"+d],a["html"+d],a["text"+d])},a.swap=function(a){this.strict=a;var b=a?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+b],this.jQ.html(this.data["html"+b]),this.textTemplate=[this.data["text"+b]]},a.deleteTowards=function(a,c){if(a===y&&!this.strict)return this.swap(!0),void this.bubble("reflow");b.deleteTowards.apply(this,arguments)}}),oa={ctrlSeq:"\\le ",html:"&le;",text:"",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},pa={ctrlSeq:"\\ge ",html:"&ge;",text:"",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};E["<"]=E.lt=d(na,oa,!0),E[">"]=E.gt=d(na,pa,!0),E[""]=E.le=E.leq=d(na,oa,!1),E[""]=E.ge=E.geq=d(na,pa,!1);var qa=x(Z,function(a,b){a.init=function(){b.init.call(this,"=","=")},a.createLeftOf=function(a){if(a[y]instanceof na&&a[y].strict)return a[y].swap(!1),void a[y].bubble("reflow");b.createLeftOf.apply(this,arguments)}});E["="]=qa,E[""]=E.times=d(Z,"\\times ","&times;","[x]"),E[""]=E.div=E.divide=E.divides=d(Z,"\\div ","&divide;","[/]"),F["~"]=E.sim=d(Z,"\\sim ","~","~");var ra,sa,ta=a,ua=document.createElement("div"),va=ua.style,wa={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(var xa in wa)if(xa in va){sa=xa;break}sa?ra=function(a,b,c){a.css(sa,"scale("+b+","+c+")")}:"filter"in va?(ta=function(a){a.className=a.className},ra=function(a,b,c){function d(){a.css("marginRight",(e.width()-1)*(b-1)/b+"px")}b/=1+(c-1)/2,a.css("fontSize",c+"em"),a.hasClass("mq-matrixed-container")||a.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var e=a.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+b+",SizingMethod='auto expand')");d();var f=setInterval(d);A(window).load(function(){clearTimeout(f),d()})}):ra=function(a,b,c){a.css("fontSize",c+"em")};var ya=x(W,function(a,b){a.init=function(a,c){b.init.call(this,a,'<div class="nl">'+(c||a)+"</div>")},a.text=function(){var a=this.ctrlSeq;return!this[y]||this[y]instanceof fa||this[y]instanceof Z||"\\ "===this[y].ctrlSeq||(a="*"+a),!this[z]||this[z]instanceof Z||this[z]instanceof Ca||(a+="*"),a}});E.gadgetnewline=d(ya,"\\gadgetnewline"," ");var za=x(V,function(a,b){a.init=function(a,c,d){b.init.call(this,a,"<"+c+" "+d+">&0</"+c+">")}});E.overfrown=d(za,"\\overfrown","span",'class="mq-non-leaf mq-overfrown"'),E.overleftrightarrow=d(za,"\\overleftrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-both"');var Aa=x(W,function(a,b){a.init=function(a,c){b.init.call(this,a,'<var class="mq-'+(c||a)+'">'+(c||a)+"</var>")},a.text=function(){var a=this.ctrlSeq;return!this[y]||this[y]instanceof fa||this[y]instanceof Z||"\\ "===this[y].ctrlSeq||(a="*"+a),!this[z]||this[z]instanceof Z||this[z]instanceof Ca||(a+="*"),a}});E.arg=d(Aa,"\\arg ","arg"),E.deg=d(Aa,"\\deg ","deg"),E.det=d(Aa,"\\det ","det"),E.dim=d(Aa,"\\dim ","dim"),E.exp=d(Aa,"\\exp ","exp"),E.gcd=d(Aa,"\\gcd ","gcd"),E.hom=d(Aa,"\\hom ","hom"),E.inf=d(Aa,"\\inf ","inf"),E.ker=d(Aa,"\\ker ","ker"),E.lg=d(Aa,"\\lg ","lg"),E.lim=d(Aa,"\\lim ","lim"),E.ln=d(Aa,"\\ln ","Ln"),E.log=d(Aa,"\\log ","Log"),E.max=d(Aa,"\\max ","max"),E.min=d(Aa,"\\min ","min"),E.sup=d(Aa,"\\sup ","sup"),E.limsup=d(Aa,"\\limsup ","limsup"),E.liminf=d(Aa,"\\liminf ","liminf"),E.injlim=d(Aa,"\\injlim ","injlim"),E.projlim=d(Aa,"\\projlim ","projlim"),E.Pr=d(Aa,"\\Pr ","Pr"),E.sin=d(Aa,"\\sin ","sin"),E.cos=d(Aa,"\\cos ","cos"),E.tan=d(Aa,"\\tan ","tan"),E.arcsin=d(Aa,"\\arcsin ","arcsin"),E.arccos=d(Aa,"\\arccos ","arccos"),E.arctan=d(Aa,"\\arctan ","arctan"),E.sinh=d(Aa,"\\sinh ","sinh"),E.cosh=d(Aa,"\\cosh ","cosh"),E.tanh=d(Aa,"\\tanh ","tanh"),E.sec=d(Aa,"\\sec ","sec"),E.csc=d(Aa,"\\csc ","csc"),E.cot=d(Aa,"\\cot ","cot"),E.coth=d(Aa,"\\coth ","coth"),E.cosec=d(Aa,"\\cosec ","cosec"),E.cotan=d(Aa,"\\cotan ","cotan"),E.ctg=d(Aa,"\\ctg ","ctg"),E.gcf=d(Aa,"\\gcf ","gcf"),E.hcf=d(Aa,"\\hcf ","hcf"),E.lcm=d(Aa,"\\lcm ","lcm"),E.proj=d(Aa,"\\proj ","proj"),E.span=d(Aa,"\\span ","span"),E.cis=d(Aa,"\\cis ","cis"),E.leftrightharpoons=d(X,"\\leftrightharpoons ","&#8652;"),E.rightleftharpoons=d(X,"\\rightleftharpoons ","&#8651;"),E.tripleprime=d(fa,"\\tripleprime ","&#8244;"),E.cent=d(fa,"\\cent ","&#162;"),E.unknownequality=d(fa,"\\unknownequality ","&#8799;"),E.notsimilar=d(fa,"\\notsimilar ","&#8769;"),E.proportional=d(fa,"\\proportional ","&#8733;"),E.congruentto=d(fa,"\\congruentto ","&#8773;"),E.notcongruentto=d(fa,"\\notcongruentto ","&#8775;");var Ba=(x(W,function(a,b){a.init=function(a,c){b.init.call(this,a,"<var>"+(c||a)+"</var>")},a.text=function(){var a=this.ctrlSeq;return!this[y]||this[y]instanceof fa||this[y]instanceof Z||"\\ "===this[y].ctrlSeq||(a="*"+a),!this[z]||this[z]instanceof Z||this[z]instanceof Ca||(a+="*"),a}}),x(V,function(a,b){a.init=function(a,c,d){b.init.call(this,a,"<"+c+" "+d+">&0</"+c+">")}}));E.mathrm=d(Ba,"\\mathrm","span",'class="mq-roman mq-font"'),E.mathit=d(Ba,"\\mathit","i",'class="mq-font"'),E.mathbf=d(Ba,"\\mathbf","b",'class="mq-font"'),E.mathsf=d(Ba,"\\mathsf","span",'class="mq-sans-serif mq-font"'),E.mathtt=d(Ba,"\\mathtt","span",'class="mq-monospace mq-font"'),E.underline=d(Ba,"\\underline","span",'class="mq-non-leaf mq-underline"'),E.overline=E.bar=d(Ba,"\\overline","span",'class="mq-non-leaf mq-overline"'),E.overrightarrow=d(Ba,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),E.overleftarrow=d(Ba,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"');var Ca=(E.textcolor=x(V,function(a,b){a.setColor=function(a){this.color=a,this.htmlTemplate='<span class="mq-textcolor" style="color:'+a+'">&0</span>'},a.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},a.parser=function(){var a=this,c=R.optWhitespace,d=R.string,e=R.regex;return c.then(d("{")).then(e(/^[#\w\s.,()%-]*/)).skip(d("}")).then(function(c){return a.setColor(c),b.parser.call(a)})}}),E.class=x(V,function(a,b){a.parser=function(){var a=this,c=R.string,d=R.regex;return R.optWhitespace.then(c("{")).then(d(/^[-\w\s\\\xA0-\xFF]*/)).skip(c("}")).then(function(c){return a.htmlTemplate='<span class="mq-class '+c+'">&0</span>',b.parser.call(a)})}}),x(V,function(a,b){a.ctrlSeq="_{...}^{...}",a.createLeftOf=function(a){if(this.replacedFragment||a[y]||!a.options.supSubsRequireOperand)return b.createLeftOf.apply(this,arguments)},a.contactWeld=function(a){for(var b=y;b;b=b===y&&z)if(this[b]instanceof Ca){for(var c="sub";c;c="sub"===c&&"sup"){var d=this[c],e=this[b][c];if(d){if(e)if(d.isEmpty())var f=B(e,0,e.ends[y]);else{d.jQ.children().insAtDirEnd(-b,e.jQ);var g=d.children().disown(),f=B(e,g.ends[z],e.ends[y]);b===y?g.adopt(e,e.ends[z],0):g.adopt(e,0,e.ends[y])}else this[b].addBlock(d.disown());this.placeCursor=function(a,c){return function(d){d.insAtDirEnd(-b,a||c)}}(e,d)}}this.remove(),a&&a[y]===this&&(b===z&&f?f[y]?a.insRightOf(f[y]):a.insAtLeftEnd(f.parent):a.insRightOf(this[b]));break}},K.p.charsThatBreakOutOfSupSub="",a.finalizeTree=function(){this.ends[y].write=function(a,b){if(a.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===b)return;var c=this.chToCmd(b);return c instanceof W?a.deleteSelection():a.clearSelection().insRightOf(this.parent),c.createLeftOf(a.show())}a[y]&&!a[z]&&!a.selection&&a.options.charsThatBreakOutOfSupSub.indexOf(b)>-1&&a.insRightOf(this.parent),$.p.write.apply(this,arguments)}},a.moveTowards=function(a,c,d){c.options.autoSubscriptNumerals&&!this.sup?c.insDirOf(a,this):b.moveTowards.apply(this,arguments)},a.deleteTowards=function(a,c){if(c.options.autoSubscriptNumerals&&this.sub){var d=this.sub.ends[-a];d instanceof W?d.remove():d&&d.deleteTowards(a,c.insAtDirEnd(-a,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(y,c.insAtLeftEnd(this.sub)),this.sup&&c.insDirOf(-a,this))}else b.deleteTowards.apply(this,arguments)},a.latex=function(){function a(a,b){var c=b&&b.latex();return b?a+(1===c.length?c:"{"+(c||" ")+"}"):""}return a("_",this.sub)+a("^",this.sup)},a.addBlock=function(a){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=a,a.adopt(this,this.sub,0).downOutOf=this.sub,a.jQ=A('<span class="mq-sup"/>').append(a.jQ.children()).attr(s,a.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=a,a.adopt(this,0,this.sup).upOutOf=this.sup,a.jQ=A('<span class="mq-sub"></span>').append(a.jQ.children()).attr(s,a.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var b=0;b<2;b+=1)!function(a,b,c,d){a[b].deleteOutOf=function(e,f){if(f.insDirOf(this[e]?-e:e,this.parent),!this.isEmpty()){var g=this.ends[e];this.children().disown().withDirAdopt(e,f.parent,f[e],f[-e]).jQ.insDirOf(-e,f.jQ),f[-e]=g}a.supsub=c,delete a[b],delete a[d+"Into"],a[c][d+"OutOf"]=m,delete a[c].deleteOutOf,"sub"===b&&A(a.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[b],"sup sub".split(" ")[b],"down up".split(" ")[b])}}));E.subscript=E._=x(Ca,function(a,b){a.supsub="sub",a.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',a.textTemplate=["_"],a.finalizeTree=function(){this.downInto=this.sub=this.ends[y],this.sub.upOutOf=m,b.finalizeTree.call(this)}}),E.superscript=E.supscript=E["^"]=x(Ca,function(a,b){a.supsub="sup",a.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',a.textTemplate=["^"],a.finalizeTree=function(){this.upInto=this.sup=this.ends[z],this.sup.downOutOf=m,b.finalizeTree.call(this)}});var Da=x(V,function(a,b){a.init=function(a,b){var c='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+b+'</big><span class="mq-from"><span>&0</span></span></span>';W.prototype.init.call(this,a,c)},a.createLeftOf=function(a){b.createLeftOf.apply(this,arguments),a.options.sumStartsWithNEquals&&(ga("n").createLeftOf(a),qa().createLeftOf(a))},a.latex=function(){function a(a){return 1===a.length?a:"{"+(a||" ")+"}"}return this.ctrlSeq+"_"+a(this.ends[y].latex())+"^"+a(this.ends[z].latex())},a.parser=function(){for(var a=R.string,b=R.optWhitespace,c=R.succeed,d=T.block,e=this,f=e.blocks=[$(),$()],g=0;g<f.length;g+=1)f[g].adopt(e,e.ends[z],0);return b.then(a("_").or(a("^"))).then(function(a){var b=f["_"===a?0:1];return d.then(function(a){return a.children().adopt(b,b.ends[z],0),c(e)})}).many().result(e)},a.finalizeTree=function(){this.downInto=this.ends[y],this.upInto=this.ends[z],this.ends[y].upOutOf=this.ends[z],this.ends[z].downOutOf=this.ends[y]}});E[""]=E.sum=E.summation=d(Da,"\\sum ","&sum;"),E[""]=E.prod=E.product=d(Da,"\\prod ","&prod;"),E.coprod=E.coproduct=d(Da,"\\coprod ","&#8720;"),E[""]=E.int=E.integral=x(Da,function(a,b){a.init=function(){W.prototype.init.call(this,"\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},a.createLeftOf=V.p.createLeftOf});var Ea=E.frac=E.dfrac=E.cfrac=E.fraction=x(V,function(a,b){a.ctrlSeq="\\frac",a.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',a.textTemplate=["(",")/(",")"],a.finalizeTree=function(){this.upInto=this.ends[z].upOutOf=this.ends[y],this.downInto=this.ends[y].downOutOf=this.ends[z]}});E.mixfrac=x(V,function(a,b){a.ctrlSeq="\\mixfrac",a.htmlTemplate='<span class="mq-mixed-fraction mq-non-leaf"><span class="mq-whole">&0</span><span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&1</span><span class="mq-denominator">&2</span><span style="display:inline-block;width:0">&#8203;</span></span></span>',a.textTemplate=["(",")/(",")"],a.finalizeTree=function(){this.upInto=this.ends[z].upOutOf=this.ends[y],this.downInto=this.ends[y].downOutOf=this.ends[z]}});var Fa=E.over=F["/"]=x(Ea,function(b,c){b.createLeftOf=function(b){if(!this.replacedFragment){for(var d=b[y];d&&!(d instanceof Z||d instanceof(E.text||a)||d instanceof Da||"\\ "===d.ctrlSeq||/^[,;:]$/.test(d.ctrlSeq));)d=d[y];d instanceof Da&&d[z]instanceof Ca&&(d=d[z],d[z]instanceof Ca&&d[z].ctrlSeq!=d.ctrlSeq&&(d=d[z])),d!==b[y]&&(this.replaces(D(d[z]||b.parent.ends[y],b[y])),b[y]=d)}c.createLeftOf.call(this,b)}}),Ga=E.sqrt=E[""]=x(V,function(a,b){a.ctrlSeq="\\sqrt",a.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',a.textTemplate=["sqrt(",")"],a.parser=function(){return T.optBlock.then(function(a){return T.block.map(function(b){var c=Ha();return c.blocks=[a,b],a.adopt(c,0,0),b.adopt(c,a,0),c})}).or(b.parser.call(this))},a.reflow=function(){var a=this.ends[z].jQ;ra(a.prev(),1,a.innerHeight()/+a.css("fontSize").slice(0,-2)-.1)}}),Ha=(E.vec=x(V,function(a,b){a.ctrlSeq="\\vec",a.htmlTemplate='<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>',a.textTemplate=["vec(",")"]}),E.nthroot=x(Ga,function(a,b){a.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',a.textTemplate=["sqrt[","](",")"],a.latex=function(){return"\\sqrt["+this.ends[y].latex()+"]{"+this.ends[z].latex()+"}"}})),Ia=x(x(V,n),function(b,c){b.init=function(a,b,d,e,f){c.init.call(this,"\\left"+e,p,[b,d]),this.side=a,this.sides={},this.sides[y]={ch:b,ctrlSeq:e},this.sides[z]={ch:d,ctrlSeq:f}},b.numBlocks=function(){return 1},b.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===z?" mq-ghost":"")+'">'+this.sides[y].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===y?" mq-ghost":"")+'">'+this.sides[z].ch+"</span></span>",c.html.call(this)},b.latex=function(){return"\\left"+this.sides[y].ctrlSeq+this.ends[y].latex()+"\\right"+this.sides[z].ctrlSeq},b.oppBrack=function(a,b,c){return b instanceof Ia&&b.side&&b.side!==-c&&("|"===this.sides[this.side].ch||b.side===-this.side)&&(!a.restrictMismatchedBrackets||Ja[this.sides[this.side].ch]===b.sides[b.side].ch||{"(":"]","[":")"}[this.sides[y].ch]===b.sides[z].ch)&&b},b.closeOpposing=function(a){a.side=0,a.sides[this.side]=this.sides[this.side],a.delimjQs.eq(this.side===y?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},b.createLeftOf=function(a){if(!this.replacedFragment)var b=a.options,d=this.oppBrack(b,a[y],y)||this.oppBrack(b,a[z],z)||this.oppBrack(b,a.parent.parent);if(d){var e=this.side=-d.side;this.closeOpposing(d),d===a.parent.parent&&a[e]&&(D(a[e],a.parent.ends[e],-e).disown().withDirAdopt(-e,d.parent,d,d[e]).jQ.insDirOf(e,d.jQ),d.bubble("reflow"))}else d=this,e=d.side,d.replacedFragment?d.side=0:a[-e]&&(d.replaces(D(a[-e],a.parent.ends[-e],e)),a[-e]=0),c.createLeftOf.call(d,a);e===y?a.insAtLeftEnd(d.ends[y]):a.insRightOf(d)},b.placeCursor=a,b.unwrap=function(){this.ends[y].children().disown().adopt(this.parent,this,this[z]).jQ.insertAfter(this.jQ),this.remove()},b.deleteSide=function(a,b,c){var d=this.parent,e=this[a],f=d.ends[a];if(a===this.side)return this.unwrap(),void(e?c.insDirOf(-a,e):c.insAtDirEnd(a,d));var g=c.options,h=!this.side;if(this.side=-a,this.oppBrack(g,this.ends[y].ends[this.side],a)){this.closeOpposing(this.ends[y].ends[this.side]);var i=this.ends[y].ends[a];this.unwrap(),i.siblingCreated&&i.siblingCreated(c.options,a),e?c.insDirOf(-a,e):c.insAtDirEnd(a,d)}else{if(this.oppBrack(g,this.parent.parent,a))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(b&&h)return this.unwrap(),void(e?c.insDirOf(-a,e):c.insAtDirEnd(a,d));this.sides[a]={ch:Ja[this.sides[this.side].ch],ctrlSeq:Ja[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(a===y?0:1).addClass("mq-ghost").html(this.sides[a].ch)}if(e){var i=this.ends[y].ends[a];D(e,f,-a).disown().withDirAdopt(-a,this.ends[y],i,0).jQ.insAtDirEnd(a,this.ends[y].jQ.removeClass("mq-empty")),i.siblingCreated&&i.siblingCreated(c.options,a),c.insDirOf(-a,e)}else b?c.insDirOf(a,this):c.insAtDirEnd(a,this.ends[y])}},b.deleteTowards=function(a,b){this.deleteSide(-a,!1,b)},b.finalizeTree=function(){this.ends[y].deleteOutOf=function(a,b){this.parent.deleteSide(a,!0,b)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===y?1:0).removeClass("mq-ghost"),this.side=0}},b.siblingCreated=function(a,b){b===-this.side&&this.finalizeTree()}}),Ja={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","\\lceiling ":"\\rceiling ","\\rceiling ":"\\lceiling ","\\lflooring ":"\\rflooring ","\\rflooring ":"\\lflooring ","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"};o("("),o("["),o("{","\\{"),E.lceiling=d(Ia,y,"&lceil;","&rceil;","\\lceiling ","\\rceiling "),E.rceiling=d(Ia,z,"&lceil;","&rceil;","\\lceiling ","\\rceiling "),E.lflooring=d(Ia,y,"&lfloor;","&rfloor;","\\lflooring ","\\rflooring "),E.rflooring=d(Ia,z,"&lfloor;","&rfloor;","\\lflooring ","\\rflooring "),E.langle=d(Ia,y,"&lang;","&rang;","\\langle ","\\rangle "),E.rangle=d(Ia,z,"&lang;","&rang;","\\langle ","\\rangle "),E.lbracing=d(Ia,y,"{","}","\\lbrace ","\\rbrace "),E.rbracing=d(Ia,z,"{","}","\\lbrace ","\\rbrace "),E.absolutevalue=d(Ia,y,"|","|","|","|"),F["|"]=d(Ia,y,"|","|","|","|"),E.left=x(V,function(a){a.parser=function(){var a=R.regex,b=R.string,c=(R.succeed,R.optWhitespace);return c.then(a(/^(?:[([|]|\\\{)/)).then(function(d){var e="\\"===d.charAt(0)?d.slice(1):d;return T.then(function(f){return b("\\right").skip(c).then(a(/^(?:[\])|]|\\\})/)).map(function(a){var b="\\"===a.charAt(0)?a.slice(1):a,c=Ia(0,e,b,d,a);return c.blocks=[f],f.adopt(c,0,0),c})})})}}),E.right=x(V,function(a){a.parser=function(){return R.fail("unmatched \\right")}});var Ka=E.binom=E.binomial=x(x(V,n),function(a,b){a.ctrlSeq="\\binom",a.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',a.textTemplate=["choose(",",",")"]});E.choose=x(Ka,function(a){a.createLeftOf=Fa.prototype.createLeftOf});E.editable=E.MathQuillMathField=x(V,function(a,b){a.ctrlSeq="\\MathQuillMathField",a.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',a.parser=function(){var a=this,c=R.string,d=R.regex,e=R.succeed;return c("[").then(d(/^[a-z][a-z0-9]*/i)).skip(c("]")).map(function(b){a.name=b}).or(e()).then(b.parser.call(a))},a.finalizeTree=function(){var a=I(this.ends[y],this.jQ,K());a.KIND_OF_MQ="MathField",a.editable=!0,a.createTextarea(),a.editablesTextareaEvents(),a.cursor.insAtRightEnd(a.root),k(a.root)},a.registerInnerField=function(a,b){a.push(a[this.name]=b(this.ends[y].controller))},a.latex=function(){return this.ends[y].latex()},a.text=function(){return this.ends[y].text()}});var La=E.embed=x(W,function(a,b){a.setOptions=function(a){function b(){return""}return this.text=a.text||b,this.htmlTemplate=a.htmlString||"",this.latex=a.latex||b,this},a.parser=function(){var a=this;return string=R.string,regex=R.regex,succeed=R.succeed,string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then(function(b){return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map(function(c){return a.setOptions(N[b](c))})})}}),Ma={};E.begin=x(V,function(a,b){a.parser=function(){var a=R.string,b=R.regex;return a("{").then(b(/^[a-z]+/i)).skip(a("}")).then(function(b){return(Ma[b]?Ma[b]().parser():R.fail("unknown environment type: "+b)).skip(a("\\end{"+b+"}"))})}});var Na=x(V,function(a,b){a.template=[["\\begin{","}"],["\\end{","}"]],a.wrappers=function(){return[a.template[0].join(this.environment),a.template[1].join(this.environment)]}}),Oa=Ma.matrix=x(Na,function(a,b){var c={column:"&",row:"\\\\"};a.parentheses={left:null,right:null},a.environment="matrix",a.reflow=function(){var a=this.jQ.children("table"),b=a.outerHeight()/+a.css("fontSize").slice(0,-2),c=this.jQ.children(".mq-paren");c.length&&ra(c,t(1+.2*(b-1),1.2),1.05*b)},a.latex=function(){var a,b="";return this.eachChild(function(d){void 0!==a&&(b+=a!==d.row?c.row:c.column),a=d.row,b+=d.latex()}),this.wrappers().join(b)},a.html=function(){function a(a){return a?'<span class="mq-scaled mq-paren">'+a+"</span>":""}var c,d=[],e="",f=0;return this.eachChild(function(a){c!==a.row&&(c=a.row,e+="<tr>$tds</tr>",d[c]=[]),d[c].push("<td>&"+f+++"</td>")}),this.htmlTemplate='<span class="mq-matrix mq-non-leaf">'+a(this.parentheses.left)+'<table class="mq-non-leaf">'+e.replace(/\$tds/g,function(){return d.shift().join("")})+"</table>"+a(this.parentheses.right)+"</span>",b.html.call(this)},a.createBlocks=function(){this.blocks=[Pa(0,this),Pa(0,this),Pa(1,this),Pa(1,this)]},a.parser=function(){var a=this,b=R.optWhitespace,d=R.string;return b.then(d(c.column).or(d(c.row)).or(T.block)).many().skip(b).then(function(b){function d(){a.blocks.push(Pa(f,a,e)),e=[]}var e=[],f=0;a.blocks=[];for(var g=0;g<b.length;g+=1)b[g]instanceof $?e.push(b[g]):(d(),b[g]===c.row&&(f+=1));return d(),a.autocorrect(),R.succeed(a)})},a.finalizeTree=function(){var a=this.jQ.find("table");a.toggleClass("mq-rows-1",1===a.find("tr").length),this.relink()},a.relink=function(){for(var a,b,c,d=this.blocks,e=[],f=0;f<d.length;f+=1)c=d[f],a!==c.row&&(a=c.row,e[a]=[],b=0),e[a][b]=c,c[z]=d[f+1],c[y]=d[f-1],e[a-1]&&e[a-1][b]&&(c.upOutOf=e[a-1][b],e[a-1][b].downOutOf=c),b+=1;this.ends[y]=d[0],this.ends[z]=d[d.length-1]},a.autocorrect=function(a){var b,c,d,e,f,g=[],a=[],h=this.blocks;for(f=0;f<h.length;f+=1)e=h[f].row,a[e]=a[e]||[],a[e].push(h[f]),g[e]=a[e].length;if((b=Math.max.apply(null,g))!==Math.min.apply(null,g)){for(f=0;f<a.length;f+=1)for(c=b-a[f].length;c;)d=b*f+a[f].length,h.splice(d,0,Pa(f,this)),c-=1;this.relink()}},a.deleteCell=function(a){function b(a){for(var b=[],c=0;c<a.length;c+=1)a[c].isEmpty()&&b.push(a[c]);return b.length===a.length}function c(a){for(var b=0;b<a.length;b+=1)j.indexOf(a[b])>-1&&(a[b].remove(),j.splice(j.indexOf(a[b]),1))}var d,e,f=[],g=[],h=[],i=[],j=this.blocks;this.eachChild(function(b){d!==b.row&&(d=b.row,f[d]=[],e=0),g[e]=g[e]||[],g[e].push(b),f[d].push(b),b===a&&(h=f[d],i=g[e]),e+=1}),b(h)&&i.length>1&&(d=f.indexOf(h),this.eachChild(function(a){a.row>d&&(a.row-=1)}),c(h),this.jQ.find("tr").eq(d).remove()),b(i)&&h.length>1&&c(i),this.finalizeTree()},a.addRow=function(a){var b,c,d=[],e=[],f=[],g=A("<tr></tr>"),h=a.row,i=0;this.eachChild(function(b){b.row<=h&&d.push(b),b.row===h&&(b===a&&(c=i),i+=1),b.row>h&&(b.row+=1,f.push(b))});for(var j=0;j<i;j+=1)b=Pa(h+1),b.parent=this,e.push(b),b.jQ=A('<td class="mq-empty">').attr(s,b.id).appendTo(g);return this.jQ.find("tr").eq(h).after(g),this.blocks=d.concat(e,f),e[c]},a.addColumn=function(a){var b,c,d=[],e=[];this.eachChild(function(c){d[c.row]=d[c.row]||[],d[c.row].push(c),c===a&&(b=d[c.row].length)});for(var f=0;f<d.length;f+=1)c=Pa(f),c.parent=this,e.push(c),d[f].splice(b,0,c),c.jQ=A('<td class="mq-empty">').attr(s,c.id);return this.jQ.find("tr").each(function(a){A(this).find("td").eq(b-1).after(d[a][b].jQ)}),this.blocks=[].concat.apply([],d),e[a.row]},a.insert=function(a,b){var c=this[a](b);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow").cursor.insAtRightEnd(c)},a.backspace=function(a,b,c,d){var e=a[b];if(a.isEmpty()){for(this.deleteCell(a);e&&e[b]&&-1===this.blocks.indexOf(e);)e=e[b];e&&c.insAtDirEnd(-b,e),1===this.blocks.length&&this.blocks[0].isEmpty()&&(d(),this.finalizeTree()),this.bubble("edited")}}});Ma.pmatrix=x(Oa,function(a,b){a.environment="pmatrix",a.parentheses={left:"(",right:")"}}),Ma.bmatrix=x(Oa,function(a,b){a.environment="bmatrix",a.parentheses={left:"[",right:"]"}}),Ma.Bmatrix=x(Oa,function(a,b){a.environment="Bmatrix",a.parentheses={left:"{",right:"}"}}),Ma.vmatrix=x(Oa,function(a,b){a.environment="vmatrix",a.parentheses={left:"|",right:"|"}}),Ma.Vmatrix=x(Oa,function(a,b){a.environment="Vmatrix",a.parentheses={left:"&#8214;",right:"&#8214;"}});var Pa=x($,function(a,b){a.init=function(a,c,d){if(b.init.call(this),this.row=a,c&&this.adopt(c,c.ends[z],0),d)for(var e=0;e<d.length;e++)d[e].children().adopt(this,this.ends[z],0)},a.keystroke=function(a,c,d){switch(a){case"Shift-Spacebar":return c.preventDefault(),this.parent.insert("addColumn",this);case"Shift-Enter":return this.parent.insert("addRow",this)}return b.keystroke.apply(this,arguments)},a.deleteOutOf=function(a,c){var d=this,e=arguments;this.parent.backspace(this,a,c,function(){return b.deleteOutOf.apply(d,e)})}}),Qa=j(1);for(var Ra in Qa)!function(a,b){"function"==typeof b?(i[a]=function(){return h(),b.apply(this,arguments)},i[a].prototype=b.prototype):i[a]=b}(Ra,Qa[Ra])}(),window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.ComponentMathquill=function(a,b){this.options={allowEnterKey:!1,onlySaveSupportedLatex:!1,onChange:function(){},onFocus:function(a){},onBlur:function(a){},hasMaxLengthExceeded:function(a){},textAreaId:null},$.extend(!0,this.options,b),this.jObject=$(a),this.initialize(a,b)},PearsonGL.Gadget.ComponentMathquill.prototype.initialize=function(){var a=this;a.isDisabled=!1,a.lastGoodLatex="",a.jObject.addClass("component_mathquill"),a.options.allowEnterKey&&a.jObject.addClass("mq-hide-overflow"),a.MQ=MathQuill.getInterface(2),a.options.onlySaveSupportedLatex&&(a.shadowMathFieldElement=$('<div class="shadow-mathquill" style="display: none"></div>'),a.shadowMathFieldElement.insertAfter(this.jObject),a.shadowMathField=a.MQ.MathField(a.shadowMathFieldElement[0])),a.mathField=a.MQ.MathField(this.jObject[0],{spaceBehavesLikeTab:!1,restrictMismatchedBrackets:!0,handlers:{edit:function(){if(a.options.maxLength&&a.mathField.latex().length>a.options.maxLength&&(a.onKeypressed("delete"),a.options.hasMaxLengthExceeded(a)),a.options.onlySaveSupportedLatex){var b=a.mathField.latex();b=b.replace(/\\gadgetnewline/g,"\\gadgetnewline "),a.shadowMathField.latex(b);var c=a.shadowMathField.latex();c=c.replace(/\\gadgetnewline/g,"\\gadgetnewline "),b===c?a.lastGoodLatex=b:PearsonGL.logger.log("unsupported latex: "+b)}a.scrollToCursor(),a.showHidePlaceholder(),a.options.onChange(a)},enter:function(){var b=a.mathField.__controller.cursor.jQ.prev(),c=a.mathField.__controller.cursor.jQ.next();if(0!==b.length&&!b.hasClass("placeholder")&&!b.hasClass("nl"))return c.hasClass("nl")?void a.mathField.__controller.moveRight():void(a.options.allowEnterKey&&a.mathField.cmd("\\gadgetnewline").focus())},moveOutOf:function(b,c){a.scrollToCursor()}}}),a.placeholderElement=null,a.options.placeholder&&(a.placeholderElement=$("<span class='placeholder'>"+a.options.placeholder+"</span>"),a.jObject.find(".mq-root-block").prepend(a.placeholderElement),$(a.mathField.__controller.textarea).attr("placeholder",a.options.placeholder)),$(a.mathField.__controller.textarea).blur(function(b){a.showHidePlaceholder(),a.options.onBlur(a)}),$(a.mathField.__controller.textarea).focus(function(b){if(a.isDisabled)return void a.mathField.blur();a.options.onFocus(a),a.showHidePlaceholder(),a.jObject.find(".aria-live-region").text(a.jObject[0].innerText)}),$(a.mathField.__controller.container).on("paste",function(){a.scrollToCursor()}),a.jObject.find(".mq-root-block").on("mouseup touchend",function(b){a.isDisabled&&a.mathField.blur()}),this.options.textAreaId&&$(a.mathField.__controller.textarea).attr("id",this.options.textAreaId),$(a.mathField.__controller.textarea).attr("aria-label","math input field"),this.setupKeyEvents(),this.jObject.on("scrollToCursor",this.scrollToCursor.bind(this))},PearsonGL.Gadget.ComponentMathquill.prototype.scrollToCursor=function(){var a=this,b=this.jObject;this.options.allowEnterKey&&setTimeout(function(){var c=b.find(".mq-cursor"),d=isNaN(parseInt(b.css("padding-top"),10))?0:parseInt(b.css("padding-top")),e=isNaN(parseInt(b.css("border-top"),10))?0:parseInt(b.css("border-top")),f=d+e,g=b.scrollTop(),h=b.offset().top,i=h+b.outerHeight(),j=c&&c.offset()?c.offset().top:null,k=j+c.height();if(j&&j-f<h){var l=h-j+f,m=g-l;b.scrollTop(m),clearTimeout(a.scrollTopTimeoutId),a.scrollTopTimeoutId=setTimeout(function(){b.scrollTop(m)},600)}else if(k>i){var l=k-i,m=g+l;b.scrollTop(m),clearTimeout(a.scrollTopTimeoutId),a.scrollTopTimeoutId=setTimeout(function(){b.scrollTop(m)},600)}},20)},PearsonGL.Gadget.ComponentMathquill.prototype.showHidePlaceholder=function(){var a=this;a.options.placeholder&&(0==a.mathField.latex().length?a.placeholderElement.show():a.placeholderElement.hide())},PearsonGL.Gadget.ComponentMathquill.prototype.placeholderReset=function(a){var b=this;b.placeholderElement=$("<span class='placeholder'>"+a+"</span>"),b.jObject.find(".mq-root-block").prepend(b.placeholderElement)},PearsonGL.Gadget.ComponentMathquill.prototype.disable=function(){this.jObject.addClass("disabled-mathquill"),this.jObject.find("textarea").attr({disabled:"disabled",readonly:"readonly"}),this.isDisabled=!0},PearsonGL.Gadget.ComponentMathquill.prototype.enable=function(){this.jObject.removeClass("disabled-mathquill"),this.jObject.find("textarea").removeAttr("disabled").removeAttr("readonly"),this.isDisabled=!1},PearsonGL.Gadget.ComponentMathquill.prototype.setLatex=function(a){a&&a.length>0&&this.mathField.latex(a)},PearsonGL.Gadget.ComponentMathquill.prototype.getLatex=function(){return this.options.onlySaveSupportedLatex?this.lastGoodLatex:this.mathField.latex()},PearsonGL.Gadget.ComponentMathquill.prototype.clear=function(){this.mathField.latex("")},PearsonGL.Gadget.ComponentMathquill.prototype.onKeypressed=function(a,b){var c=this,d=a.split(", ");c.keyPressLoop(d,b)},PearsonGL.Gadget.ComponentMathquill.prototype.keyPressLoop=function(a,b){var c=this,d=a[0];if("boolean"==typeof b){if(0==d.indexOf("\\"))c.mathField.cmd(d);else switch(d){case"left":$(c.mathField.el()).trigger(c.leftArrow);break;case"right":$(c.mathField.el()).trigger(c.rightArrow);break;case"delete":b&&c.mathField.focus(),$(c.mathField.el()).trigger(c.deleteKey);break;case"space":c.mathField.cmd(" ");break;default:c.mathField.write(d)}b&&c.mathField.focus()}else if(0==d.indexOf("\\"))c.mathField.cmd(d);else switch(d){case"left":$(c.mathField.el()).trigger(c.leftArrow);break;case"right":$(c.mathField.el()).trigger(c.rightArrow);break;case"delete":$(c.mathField.el()).trigger(c.deleteKey);break;case"space":c.mathField.cmd(" ");break;default:c.mathField.write(d)}a.shift(),a.length>0&&setTimeout(function(){c.keyPressLoop(a,b)},1)},PearsonGL.Gadget.ComponentMathquill.prototype.setupKeyEvents=function(){this.leftArrow=$.Event("keydown"),this.leftArrow.bubbles=!0,this.leftArrow.cancelable=!0,this.leftArrow.charCode=37,this.leftArrow.keyCode=37,this.leftArrow.which=37,this.rightArrow=$.Event("keydown"),this.rightArrow.bubbles=!0,this.rightArrow.cancelable=!0,this.rightArrow.charCode=39,this.rightArrow.keyCode=39,this.rightArrow.which=39,this.deleteKey=$.Event("keydown"),this.deleteKey.bubbles=!0,this.deleteKey.cancelable=!0,this.deleteKey.charCode=8,this.deleteKey.keyCode=8,this.deleteKey.which=8},PearsonGL.Gadget.ComponentMathquill.prototype.removeFormat=function(a){for(a=a.replace(new RegExp("\\mathbf|\\mathit|\\gadgetnewline","g"),"~GG~");a.indexOf("~GG~")>-1;){for(var b=a.indexOf("~GG~")+5,c=[];b<a.length;b++)if("{"==a[b]&&c.push(b),"}"==a[b]){if(0==c.length){a=a.substring(0,b)+a.substring(b+1,a.length);break}c.pop()}a=a.replace("\\~GG~{","")}return a},PearsonGL.Gadget.ComponentMathquill.prototype.compare=function(a,b,c,d){var e=!1,f=a.trim(),g=b.trim();return d||(f=this.removeFormat(f)),c||(f=f.toLowerCase()),f===g&&(e=!0),e};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.ImgAnimate=function(){function a(b,c){_classCallCheck(this,a),this.options={image:"",fps:24,isReady:function(a,b){},loops:-1,responsive:!1},this.jObject=$(b),this.initialize(b,c)}return _createClass(a,[{key:"initialize",value:function(a,b){var c=this;if(void 0!==a){$.extend(!0,this.options,b),this.jObject.addClass("imgAnimate-identifier"),this.options.image=PearsonGL.qtiEvaluator.evaluateAsset(this.options.image),PearsonGL.utils.hasParmContent()&&(this.options.fps=PearsonGL.qtiEvaluator.evaluateFloat(this.options.fps+"").value,this.options.loops=PearsonGL.qtiEvaluator.evaluateFloat(this.options.loops+"").value);var d=this;this.xpos=0,this.ypos=0,this.index=0,this.loopCount=0,void 0===this.options.frameWidth||void 0===this.options.frameHeight?(this.options.frameWidth=parseFloat(this.jObject.width()),this.options.frameHeight=parseFloat(this.jObject.height())):(PearsonGL.utils.hasParmContent()&&(this.options.frameWidth=PearsonGL.qtiEvaluator.evaluateFloat(this.options.frameWidth+"").value,this.options.frameHeight=PearsonGL.qtiEvaluator.evaluateFloat(this.options.frameHeight+"").value),this.jObject.css({width:this.options.frameWidth,height:this.options.frameHeight})),this.image=document.createElement("img"),this.image.src=this.options.image;(function(a){return new Promise(function(b,d){var e=c.image;e.addEventListener("load",function(a){return b(e)}),e.addEventListener("error",function(){d(new Error("Failed to load image's URL: "+a))})})})(this.image.src).then(function(a){d.imageWidth=parseFloat(a.width),d.imageHeight=parseFloat(a.height),d.numFrames_X=d.imageWidth/d.options.frameWidth,d.numFrames_Y=d.imageHeight/d.options.frameHeight,d.numFrames=d.imageWidth*d.imageHeight/(d.options.frameWidth*d.options.frameHeight),$(c.jObject).show(),d.animationReady()}).catch(function(a){return PearsonGL.logger.log(a)}),this.jObject.css("background",'url("'+this.image.src+'") no-repeat')}return!0}},{key:"_gameLoop",value:function(){var a=this,b=this.jObject,c=1*this.options.frameWidth,d=1*this.options.frameHeight,e=1*this.options.fps,f=this.xpos/(this.imageWidth-c)*100,g=0;this.imageHeight-d>0&&(g=this.ypos/(this.imageHeight-d)*100),!0===this.state&&(this.options.responsive?b.css("background-position",f+"% "+g+"%"):b.css("background-position",-this.xpos+"px "+-this.ypos+"px")),this.xpos+=c,this.index+=1,this.index>=this.numFrames?(this.xpos=0,this.ypos=0,this.index=0,this.loopCount++):this.xpos+c>this.imageWidth&&(this.xpos=0,this.ypos+=d),this.state&&(this.gLoop=setTimeout(function(){a._gameLoop()},1e3/e)),this.loopCount>=this.options.loops&&-1!==this.options.loops&&(this.stopLoop(),this.loopCount=0)}},{key:"startLoop",value:function(){this.state=!0,this._gameLoop()}},{key:"stopLoop",value:function(){this.xpos=0,this.ypos=0,this.index=0,this.state=!1}},{key:"animationReady",value:function(){this.options.isReady(this,this.jObject)}},{key:"updateAnimation",value:function(a,b){var c="cover";this.options.frameWidth=Math.round(a),this.options.frameHeight=Math.round(b),this.xpos=0,this.ypos=0,this.imageWidth=Math.round(this.options.frameWidth*this.numFrames_X),this.imageHeight=Math.round(this.options.frameHeight*this.numFrames_Y),this.numFrames_Y>1&&(c=100*this.numFrames_X+"% "+100*this.numFrames_Y+"%"),this.options.responsive?(this.jObject.css({"background-size":c,width:"100%",height:"100%"}),this.options.responsiveWidth&&this.jObject.css({width:this.options.responsiveWidth+"%"}),this.options.responsiveHeight&&this.jObject.css({height:this.options.responsiveHeight+"%"})):this.jObject.css("background-size",this.imageWidth+"px ")}},{key:"destroyMe",value:function(){this.startLoop(),this.jObject.removeClass("imgAnimate-identifier"),this.jObject.css("background-position",""),this.jObject.css("background","")}}]),a}(),$.fn.imgAnimate=function(){if(0!==arguments.length)if("object"===_typeof(arguments[0])){var a=new PearsonGL.Gadget.ImgAnimate(this,arguments[0]);$(this).data("imgAnimate-component",a)}else if("string"==typeof arguments[0]){var b=$(this).data("imgAnimate-component");if(b&&"function"==typeof b[arguments[0]]){if("function"!=typeof arguments[1])return b[arguments[0]].apply(b,Array.prototype.slice.call(arguments,1));b[arguments[0]]=arguments[1],$(this).data("imgAnimate-component",b)}}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};PearsonGL.Gadget=PearsonGL.Gadget||{},PearsonGL.Gadget.HighLighterComponent=function(a,b,c){this.options={saveHighLight:function(){},popup:"HighLighter Popup",color_1:"Green Color Highlight",color_2:"Orange Color Highlight",color_3:"Yellow Color Highlight",color_4:"Blue Color Highlight",color_5:"Pink Color Highlight",color_6:"Remove Color Highlight",underline:"Underline Selected Text",gadgetName:"Highlight"},b&&"n"!==PearsonGL.utils.getQuerystring("highlight","")&&"n"!==PearsonGL.utils.getQuerystring("highlight","",!0)&&(PearsonGL.Gadget.GadgetBase.call(this,b,c),this.jObject=$(a),this.initialize())},PearsonGL.Gadget.HighLighterComponent.prototype=Object.create(PearsonGL.Gadget.GadgetBase.prototype),PearsonGL.Gadget.HighLighterComponent.prototype.initialize=function(){this.jObject.addClass("hl-comp-identifier"),this.style="",this.isTouchDevice="ontouchstart"in document.documentElement,this._addEvents()},PearsonGL.Gadget.HighLighterComponent.prototype._addEvents=function(){var a=this,b=PearsonGL.utils.randomString(8)+PearsonGL.utils.randomString(8),c=this.options.highlightArea||this.jObject;$(".hl-comp-identifier").length<=0&&$(document).bind("mouseup.body touchend.body",function(){$(".highlighter-component").remove()}),a.markerPopup=$('<div tabindex="0" ="'+b+'" role="dialog" class="highlighter-component"><label id="'+b+'" class="hidden-label">'+a.options.popup+'</label><style type="text/css">.pop-up{-webkit-transform:none!important}</style><div class="contextMenu" data-color="underlinehighlight" title="'+a.options.underline+'"><label class="hidden-label">'+a.options.underline+'</label><div id="underlinebutton" class="colors"></div></div><div class="contextMenu" data-color="greenhighlight" title="'+a.options.color_1+'"><label class="hidden-label">'+a.options.color_1+'</label><div id="greenbutton" class="colors"></div></div><div class="contextMenu" data-color="orangehighlight" title="'+a.options.color_2+'"><label class="hidden-label">'+a.options.color_2+'</label><div id="orangebutton" class="colors"></div></div><div class="contextMenu" data-color="yellowhighlight" title="'+a.options.color_3+'"><label class="hidden-label">'+a.options.color_3+'</label><div id="yellowbutton" class="colors"></div></div><div class="contextMenu" data-color="bluehighlight" title="'+a.options.color_4+'"><label class="hidden-label">'+a.options.color_4+'</label><div id="bluebutton" class="colors"></div></div><div class="contextMenu" data-color="pinkhighlight" title="'+a.options.color_5+'"><label class="hidden-label">'+a.options.color_5+'</label><div id="pinkbutton" class="colors"></div></div><div class="contextMenu" data-color="removehighlight" title="'+a.options.color_6+'"><label class="hidden-label">'+a.options.color_6+'</label><div id="removebutton"></div></div></div>'),a.markerPopup.find(".contextMenu").attr({role:"button",tabindex:"0"}),a.markerPopup.find(".contextMenu").bind("mousedown touchstart",function(b){b.stopImmediatePropagation(),a.sendAnalytics("clicked_highlighter");var c=a._getRng(),d=a._getSel(),e=$(this).attr("data-color");a.style=e,-1!==e&&a._styleRange(e),"underlinehighlight"===e&&d.addRange(c),a._clearSelection(),a.hidePopUp()}).keydown(function(a){a.keyCode===PearsonGL.utils.keyCode.enter&&$(this).trigger("mousedown")}),!0!==c.data("highlighterEvent")&&(c.data("highlighterEvent",!0),c.on("mouseup touchend",function(b){if(!("textarea"===b.target.tagName.toLowerCase()||b.target.className.indexOf("fib-input")>=0)&&(a.hidePopUp(),a._checkSelection())){a._restoreSel();var c=a._getRng(),d=c.startContainer.parentNode,e=c.endContainer.parentNode;if(!($(d).parents().hasClass("MathJax")&&$(e).parents().hasClass("MathJax")||$(d).hasClass("MathJax")&&$(e).hasClass("MathJax"))){var f=b.clientX,g=b.clientY,h=256;if("touchend"==b.type){var i=event.changedTouches[0];f=parseFloat(i.clientX),g=parseFloat(i.clientY)+20}f+h>a.wDifference&&(f=a.wDifference-h-10,g+=10),a.sendAnalytics("highlighted_content"),a.markerPopup.css({left:f,top:g}),a.jObject.append(a.markerPopup.clone(!0,!0))}}})),a.hidePopUp(),$(window).bind("resize.highlight",function(b){a.jObject.is(":visible")&&(a.wDifference=$("body").width()-a.markerPopup.width())}),a.wDifference=$("body").width()-a.markerPopup.width()},PearsonGL.Gadget.HighLighterComponent.prototype.callSaveHighLight=function(){this.options.saveHighLight()},PearsonGL.Gadget.HighLighterComponent.prototype.hidePopUp=function(){$(".highlighter-component").remove()},PearsonGL.Gadget.HighLighterComponent.prototype._checkSelection=function(){return!!new String(this._getSel()).length},PearsonGL.Gadget.HighLighterComponent.prototype._getSel=function(){return this.savedSel=window.getSelection?window.getSelection():document.selection,this.savedSel},PearsonGL.Gadget.HighLighterComponent.prototype._getRng=function(){var a=this.savedSel;if(a&&0!==a.rangeCount)return a.rangeCount>0?a.getRangeAt(0):a.createRange()},PearsonGL.Gadget.HighLighterComponent.prototype._saveRng=function(){this.savedRange=this._getRng()},PearsonGL.Gadget.HighLighterComponent.prototype._clearSelection=function(){this.isTouchDevice||(window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty())},PearsonGL.Gadget.HighLighterComponent.prototype._restoreSel=function(){if(!this.isTouchDevice){var a=this._getRng();try{if(a)if(a.select)a.select();else{var b=this._getSel();b.removeAllRanges&&b.addRange&&(b.removeAllRanges(),b.addRange(a))}}catch(a){}}},PearsonGL.Gadget.HighLighterComponent.prototype._styleRange=function(a){var b,c,d,e=this,f=(e._getSel(),e._getRng()),g=$(".hl-comp-identifier");try{if(b=f.startContainer,3==b.nodeType){if(f.startOffset<b.length)b=b.splitText(f.startOffset);else if(f.startOffset===b.length){var h=document.createTextNode("");b.parentNode.insertBefore(h,b.nextSibling),b=b.nextSibling}}else 1==b.nodeType&&b.childNodes&&!/(script|style)/i.test(b.tagName)&&(b=b.childNodes[0]);if(c=f.endContainer,3==c.nodeType)f.endOffset<c.length&&(c=c.splitText(f.endOffset).previousSibling);else if(1==c.nodeType&&c.childNodes&&!/(script|style)/i.test(c.tagName))for(d=c.childNodes.length-1;d>=0;d--)if(3==c.childNodes[d].nodeType){c=c.childNodes[d];break}this.style=a;var i,j,k,l=0;for(f.setStart(b,0),f.setEnd(c,c.length),i=this.getNodesInRange(f),d=0;d<i.length;d++)if(($(i[d].parentNode).hasClass("hl-comp-identifier")||g.find($(i[d].parentNode)).length>0)&&!$(i[d].parentNode).hasClass("MathJax")&&!$(i[d].parentNode).parents().hasClass("MathJax")&&!$(i[d].parentNode).parents().hasClass("NO-HIGHLIGHT")&&!$(i[d].parentNode).hasClass("NO-HIGHLIGHT"))for(j=$(i[d].parentNode);j;){if(j.hasClass(a+" underline-identifier")){l++;break}j=j.parentNode}for(d=0;d<i.length;d++)if(($(i[d].parentNode).hasClass("hl-comp-identifier")||g.find($(i[d].parentNode)).length>0)&&!$(i[d].parentNode).hasClass("MathJax")&&!$(i[d].parentNode).parents().hasClass("MathJax")&&!$(i[d].parentNode).parents().hasClass("NO-HIGHLIGHT")&&!$(i[d].parentNode).hasClass("NO-HIGHLIGHT"))if(k=document.createElement("span"),"underlinehighlight"===a)if(l>0)for(j=$(i[d].parentNode);j;){if(j.hasClass(a+" underline-identifier")){var m=j.contents();j.replaceWith(m);for(var n=0;n<m.length;n++)if(i[d]!=m[n]){var o=document.createElement("span");if(o.setAttribute("class",a+" underline-identifier"),o.setAttribute("data-cid",a),1==m[n].nodeType){var p=document.createElement("span");p.setAttribute("class",m[n].className),p.setAttribute("data-cid",m[n].attributes["data-cid"].nodeValue),p.appendChild(document.createTextNode(m[n].childNodes[0].nodeValue)),o.appendChild(p),i[d].parentNode.replaceChild(o,m[n])}else o.appendChild(document.createTextNode(m[n].nodeValue)),i[d].parentNode.replaceChild(o,m[n])}}j=j.parentNode}else{var q=!1;for(j=i[d].parentNode;j;){var m=$(j).contents();if($(j).hasClass("highlight-identifier")&&$(j.parentNode).hasClass("underline-identifier")){for(var n=0;n<j.childNodes.length;n++)if(i[d]!=j.childNodes[n]){var o=document.createElement("span");o.setAttribute("class",a+" underline-identifier"),o.setAttribute("data-cid",a),o.appendChild(document.createTextNode(j.childNodes[n].nodeValue)),i[d].parentNode.replaceChild(o,j.childNodes[n])}else i[d]==j.childNodes[n]&&$(j.childNodes[n].parentNode).unwrap();q=!0}if(!$(j).hasClass("underline-identifier")&&!$(j).hasClass("highlight-identifier"))break;j=j.parentNode}if(!q){j=i[d].parentNode,m=$(j).contents();for(var r=0;r<m.length;r++)$(m[r].parentNode).hasClass("underline-identifier")&&$(m[r]).unwrap();k.setAttribute("class",a+" underline-identifier"),k.setAttribute("data-cid",a),k.appendChild(document.createTextNode(i[d].nodeValue)),i[d].parentNode.replaceChild(k,i[d])}}else k.setAttribute("class",a+" highlight-identifier"),$(i[d].parentNode).hasClass(a+" underline-identifier")&&$(i[d].parentNode).addClass(a+" underline-identifier"),k.setAttribute("data-cid",a),k.appendChild(document.createTextNode(i[d].nodeValue)),i[d].parentNode.replaceChild(k,i[d])}catch(a){PearsonGL.logger.log("Failed to edit the text range and apply the highlight "+a)}g.find(".highlight-identifier").each(function(){if($(this).find("*").hasClass("highlight-identifier")){var b=$(this).clone(),c="",e=[],f=b.clone(),g=$(this).find(".highlight-identifier").clone(),h="",i=b.clone(),j="%%%%%%",k=$("<div></div>");if(f.html(""),i.html(""),b.find(".highlight-identifier").before(j).after(j),c=b.html(),e=c.split(new RegExp(j,"g")),f.append(e[0]),i.append(e[e.length-1]),"removehighlight"!==a){for(d=1;d<e.length-1;d++)h+=e[d];f.find("*").is(":empty")&&(h='<span class="underlinehighlight underline-identifier" data-cid="underlinehighlight">'+h)}f.attr("class","").attr("class",f.attr("data-cid")+" highlight-identifier"),i.attr("class","").attr("class",i.attr("data-cid")+" highlight-identifier"),"removehighlight"!==a?k.append(f).append(h).append(i):k.append(f).append(g).append(i),$(this).find("*").hasClass("underline-identifier")&&"removehighlight"===a&&$(this).contents().unwrap(),$(this).html("").append(k.contents()).contents().unwrap()}}),g.find(".removehighlight").contents().unwrap(),e._removeEmptySpans(),e._clearSelection(),e.hidePopUp(),g.each(function(){$(this)[0].normalize(),$(this).highLighter("callSaveHighLight")})},PearsonGL.Gadget.HighLighterComponent.prototype._removeEmptySpans=function(){var a=$(".hl-comp-identifier");a.find("*").find(".highlight-identifier").each(function(){$(this).is(":empty")&&$(this).remove()}),a.find("*").find(".underline-identifier").each(function(){$(this).is(":empty")&&$(this).remove()})},PearsonGL.Gadget.HighLighterComponent.prototype.addClickToHighlight=function(a){},PearsonGL.Gadget.HighLighterComponent.prototype.getNodesInRange=function(a){var b,c=a.startContainer,d=a.endContainer,e=a.commonAncestorContainer,f=[];for(b=c.parentNode;b&&(3===b.nodeType&&f.push(b),b!==e);b=b.parentNode);for(f.reverse(),b=c;b&&(3===b.nodeType&&f.push(b),b!==d);b=this.getNextNode(b));return f},PearsonGL.Gadget.HighLighterComponent.prototype.getNextNode=function(a,b){if(a.firstChild)return a.firstChild;for(;a;){if(a.nextSibling)return a.nextSibling;a=a.parentNode}},$.fn.highLighter=function(){if(0!==arguments.length)if("object"===_typeof(arguments[0])){var a=new PearsonGL.Gadget.HighLighterComponent(this,arguments[0]);$(this).data("highlighter-component",a)}else if("string"==typeof arguments[0]){var a=$(this).data("highlighter-component");if(a&&"function"==typeof a[arguments[0]])return a[arguments[0]].apply(a,Array.prototype.slice.call(arguments,1))}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.Gesture=function(a,b){this.options={inline:"false",draggable:"true",foldable:"true",resizable:"true",touchOnly:!1,swipeDelta:30,onDrag:function(a){},onDragEnd:function(a){},onSwipe:function(a){},onTap:function(a){},onPinch:function(a){},onFinalPinch:function(a){},onScreen:function(a){},offScreen:function(a){}},this.jObject=$(a),this.initialize(a,b)},PearsonGL.Gadget.Gesture.prototype.initialize=function(a,b){void 0!==a&&($.extend(!0,this.options,b),this.targetObj=$(a),this.targetObjX=$(a).offset().left,this.targetObjY=$(a).offset().top,this.swipe={},this.previousMode="null",this.isTouchDevice="ontouchstart"in document.documentElement,this.eventTrace={isTouched:!1,isDragged:!1,isSwiped:!1,isPinched:!1},this.attach(),this.events())},PearsonGL.Gadget.Gesture.prototype.getJqObj=function(){return this.targetObj},PearsonGL.Gadget.Gesture.prototype.events=function(){var a=this,b=this.targetObj.get(0);return b.addEventListener("touchstart",function(b){a.touchHandler(b)},!0),b.addEventListener("touchmove",function(b){a.touchHandler(b)},!0),b.addEventListener("touchend",function(b){a.touchHandler(b)},!0),b.addEventListener("touchcancel",function(b){a.touchHandler(b)},!0),b.addEventListener("gesturestart",function(b){a.pinchHandler(b)},!0),b.addEventListener("gesturechange",function(b){a.pinchHandler(b)},!0),b.addEventListener("gestureend",function(b){a.pinchHandler(b)},!0),0==this.options.touchOnly&&(b.addEventListener("mousedown",function(b){a.mouseHandler(b)},!0),b.addEventListener("mousemove",function(b){a.mouseHandler(b)},!0),b.addEventListener("mouseup",function(b){a.mouseHandler(b)},!0)),this},PearsonGL.Gadget.Gesture.prototype.initWipeEvent=function(a){this.eventTrace.isTouched=!0,this.eventTrace.isDragged=!1,this.eventTrace.isSwipped=!1,this.eventTrace.isPinched=!1,this.swipe.mode="drag",this.swipe.firstTouchX=a.pageX,this.swipe.firstTouchY=a.pageY,this.swipe.lastTouchX=a.pageX,this.swipe.lastTouchY=a.pageY,this.swipe.preTouchX=a.pageX,this.swipe.preTouchY=a.pageY,this.swipe.currTouchX=a.pageX,this.swipe.currTouchY=a.pageY,this.swipe.firstTouchXInTarget=a.pageX-this.targetObjX,this.swipe.firstTouchYInTarget=a.pageY-this.targetObjY,this.swipe.currTouchXInTarget=a.pageX-this.targetObjX,this.swipe.currTouchYInTarget=a.pageY-this.targetObjY,this.swipe.target=a.target,this.swipe.currentTarget=this.swipe.target,this.swipe.direction="",this.jObject.trigger("onScreen",this.swipe)},PearsonGL.Gadget.Gesture.prototype.touchHandler=function(a){if(!(a.targetTouches.length>1)){var b=a.changedTouches[0];if("touchstart"==a.type)return this.initWipeEvent(b),void(this.swipe.input="finger");if("touchmove"==a.type){this.swipe.currTouchX=b.pageX,this.swipe.currTouchY=b.pageY,this.swipe.currTouchXInTarget=b.pageX-this.targetObjX,this.swipe.currTouchYInTarget=b.pageY-this.targetObjY;var c=Math.abs(this.swipe.currTouchX-this.swipe.preTouchX),d=Math.abs(this.swipe.currTouchY-this.swipe.preTouchY);return this.swipe.direction=c>=d?this.swipe.currTouchX-this.swipe.preTouchX>0?"right":"left":this.swipe.currTouchY-this.swipe.preTouchY>0?"down":"up",c>this.options.swipeDelta||d>this.options.swipeDelta?this.swipe.mode="swipe":this.swipe.mode="drag","swipe"!=this.swipe.mode||this.eventTrace.isPinched?"drag"!=this.swipe.mode||this.eventTrace.isPinched||(this.jObject.trigger("drag",this.swipe),this.eventTrace.isDragged=!0):this.eventTrace.isSwiped=!0,this.swipe.preTouchX=this.swipe.currTouchX,void(this.swipe.preTouchY=this.swipe.currTouchY)}return"touchend"==a.type?(this.swipe.lastTouchX=b.pageX,this.swipe.lastTouchY=b.pageY,this.swipe.currTouchXInTarget=b.pageX-this.targetObjX,this.swipe.currTouchYInTarget=b.pageY-this.targetObjY,this.eventTrace.isSwiped?this.jObject.trigger("swipe",this.swipe):this.eventTrace.isDragged&&this.jObject.trigger("dragEnd",this.swipe),this.eventTrace.isSwiped=!1,void(this.swipe.lastTouchX-this.swipe.firstTouchX==0&&this.swipe.lastTouchY-this.swipe.firstTouchY==0?(this.swipe.mode="tap",this.swipe.direction="none",this.jObject.trigger("tap",this.swipe)):this.jObject.trigger("offScreen",this.swipe))):void 0}},PearsonGL.Gadget.Gesture.prototype.mouseHandler=function(a){if(a.preventDefault(),"mousedown"==a.type)return this.initWipeEvent(a),void(this.swipe.input="mouse");if("mousemove"==a.type&&this.swipe&&"mouse"==this.swipe.input){this.swipe.currTouchX=a.pageX,this.swipe.currTouchY=a.pageY,this.swipe.currTouchXInTarget=a.pageX-this.targetObjX,this.swipe.currTouchYInTarget=a.pageY-this.targetObjY;var b=Math.abs(this.swipe.currTouchX-this.swipe.preTouchX),c=Math.abs(this.swipe.currTouchY-this.swipe.preTouchY);this.swipe.direction=b>=c?this.swipe.currTouchX-this.swipe.preTouchX>0?"right":"left":this.swipe.currTouchY-this.swipe.preTouchY>0?"down":"up",this.jObject.trigger("drag",this.swipe)}return"mouseup"==a.type?(this.swipe.lastTouchX=a.pageX,this.swipe.lastTouchY=a.pageY,this.swipe.currTouchXInTarget=a.pageX-this.targetObjX,this.swipe.currTouchYInTarget=a.pageY-this.targetObjY,this.swipe.input="finger",void(this.swipe.lastTouchX-this.swipe.firstTouchX==0&&this.swipe.lastTouchY-this.swipe.firstTouchY==0?(this.swipe.mode="tap",this.swipe.direction="none",this.jObject.trigger("tap",this.swipe)):this.jObject.trigger("offScreen",this.swipe))):void 0},PearsonGL.Gadget.Gesture.prototype.pinchHandler=function(a){a.preventDefault(),"gesturestart"==a.type&&(this.pinch=new Object,this.pinch.target=a.target,this.pinch.rotation=0,this.pinch.scale=0,this.pinch.finalrotation=0,this.pinch.finalscale=0,this.eventTrace.isPinched=!1),"gesturechange"==a.type&&(this.pinch.rotation=a.rotation,this.pinch.scale=a.scale,this.jObject.trigger("pinch",this.pinch),this.eventTrace.isPinched=!0),"gestureend"==a.type&&(this.pinch.finalrotation=a.rotation,this.pinch.finalscale=a.scale,a.scale>1?this.pinch.zoom="in":this.pinch.zoom="out",this.jObject.trigger("finalpinch",this.pinch))},PearsonGL.Gadget.Gesture.prototype.attach=function(){var a=this;return this.jObject.on("onScreen",function(b,c){a.onScreen($.extend(!0,b,a,c))}),this.jObject.on("drag",function(b,c){a.onDrag($.extend(!0,b,a,c))}),this.jObject.on("dragEnd",function(b,c){a.onDragEnd($.extend(!0,b,a,c))}),this.jObject.on("swipe",function(b,c){a.onSwipe($.extend(!0,b,a,c))}),this.jObject.on("tap",function(b,c){a.onTap($.extend(!0,b,a,c))}),this.jObject.on("pinch",function(b,c){a.onPinch($.extend(!0,b,a,c))}),this.jObject.on("finalpinch",function(b,c){a.onFinalPinch($.extend(!0,b,a,c))}),this.jObject.on("offScreen",function(b,c){a.offScreen($.extend(!0,b,a,c))}),this},PearsonGL.Gadget.Gesture.prototype.detach=function(){return this},PearsonGL.Gadget.Gesture.prototype.setTargetID=function(a){this.targetID=a},PearsonGL.Gadget.Gesture.prototype.getTargetID=function(){return this.targetID},PearsonGL.Gadget.Gesture.prototype.onDrag=function(a){this.options.onDrag(a)},PearsonGL.Gadget.Gesture.prototype.onDragEnd=function(a){this.options.onDragEnd(a)},PearsonGL.Gadget.Gesture.prototype.onSwipe=function(a){this.options.onSwipe(a)},PearsonGL.Gadget.Gesture.prototype.onTap=function(a){this.options.onTap(a)},PearsonGL.Gadget.Gesture.prototype.onPinch=function(a){this.options.onPinch(a)},PearsonGL.Gadget.Gesture.prototype.onFinalPinch=function(a){this.options.onFinalPinch(a)},PearsonGL.Gadget.Gesture.prototype.onScreen=function(a){this.options.onScreen(a)},PearsonGL.Gadget.Gesture.prototype.offScreen=function(a){this.options.offScreen(a)},$.fn.gesture=function(){if(0!==arguments.length)if("object"===_typeof(arguments[0])){var a=new PearsonGL.Gadget.Gesture(this,arguments[0]);$(this).data("gesture-component",a)}else if("string"==typeof arguments[0]){var a=$(this).data("gesture-component");if(a&&"function"==typeof a[arguments[0]]){if("function"!=typeof arguments[1])return a[arguments[0]].apply(a,Array.prototype.slice.call(arguments,1));a[arguments[0]]=arguments[1],$(this).data("gesture-component",a)}}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(a){var b={init:function(b){return this.each(function(){var b=a(this);b.mobile=function(){b.each(function(){a(this)[0].addEventListener("touchstart",function(a){b.touchHandler(a)},!0),a(this)[0].addEventListener("touchmove",function(a){b.touchHandler(a)},!0),a(this)[0].addEventListener("touchmove",function(a){a.preventDefault()},!0),a(this)[0].addEventListener("touchend",function(a){b.touchHandler(a)},!0),a(this)[0].addEventListener("touchcancel",function(a){b.touchHandler(a)},!0)})},b.touchHandler=function(a){var b=a.changedTouches,c=b[0],d="";switch(a.type){case"touchstart":d="mousedown";break;case"touchmove":d="mousemove";break;case"touchend":d="mouseup";break;default:return}var e=document.createEvent("MouseEvent");e.initMouseEvent(d,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),c.target.dispatchEvent(e)},b.mobile()})}};a.fn.mouseToTouch=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==(void 0===c?"undefined":_typeof(c))&&c?void a.error("Method "+c+" does not exist on jQuery.mouseToTouch"):b.init.apply(this,arguments)}}(jQuery),function(a){function b(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document||navigator.maxTouchPoints>0,a.support.touch){var c,d=a.ui.mouse.prototype,e=d._mouseInit,f=d._mouseDestroy;d._touchStart=function(a){var d=this;!c&&d._mouseCapture(a.originalEvent.changedTouches[0])&&(c=!0,d._touchMoved=!1,b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))},d._touchMove=function(a){c&&(this._touchMoved=!0,b(a,"mousemove"))},d._touchEnd=function(a){c&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),c=!1)},d._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),e.call(b)},d._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),f.call(b)}}}(jQuery);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.SliderButton=function(a,b){this.options={buttonClassName:"",buttonText:"",title:"",slider:!0,hasHTML5Button:!1,enable:!0,roleType:"button",tabIndexValue:"0",useTouchForClick:!1,stopPropagation:!1,preventDefault:!1,clickFunction:function(a,b){}},this.jObject=$(a),this.initialize(a,b)},PearsonGL.Gadget.SliderButton.prototype.initialize=function(a,b){void 0!==a&&($.extend(!0,this.options,b),this.isTouchDevice="ontouchstart"in document.documentElement,this.jObject.addClass(this.options.buttonClassName),this.jObject.addClass("is-button base-button"),this.options.slider&&!this.options.hasHTML5Button?(this.jObject.append('<div class="base-button-inside-wrap"><div class="'+this.options.buttonClassName+'-button-left base-button-left"></div><div class="'+this.options.buttonClassName+'-button-right base-button-right"></div><span class="button-text" data-icon="btn-label-icon" >'+this.options.buttonText+"</span></div>"),this.eventAttacher=this.jObject.find(".base-button-inside-wrap")):this.options.hasHTML5Button?(this.jObject.append('<span class="button-text" data-icon="btn-label-icon" >'+this.options.buttonText+"</span>"),this.eventAttacher=this.jObject.closest("button")):this.options.hasHTML5Button||(this.eventAttacher=this.jObject),this.eventAttacher.attr("tabindex",this.options.tabIndexValue),PearsonGL.utils.isNonEmptyString(this.options.title)&&this.eventAttacher.attr("title",this.options.title),this.options.hasHTML5Button||this.eventAttacher.attr("role",this.options.roleType),this.buttonClick(),this.buttonMouseEvents())},PearsonGL.Gadget.SliderButton.prototype.buttonMouseEvents=function(){var a=this,b=this.jObject;a.eventAttacher.bind("mouseover.button mouseout.button mousedown.button mouseup.button touchstart.button touchend.button",function(c){if(!0===a.options.enable){var d=a.options.buttonClassName;a.isTouchDevice?"touchstart"===c.type?(a.options.preventDefault&&c.preventDefault(),a.options.stopPropagation&&c.stopImmediatePropagation(),1===c.originalEvent.touches.length&&(b.addClass(d+"-button-down base-button-down"),b.find("."+d+"-button-left").addClass(d+"-button-left-down base-button-left-down"),b.find("."+d+"-button-right").addClass(d+"-button-right-down base-button-right-down"))):"touchend"===c.type&&(b.removeClass(d+"-button-down base-button-down"),b.find("."+d+"-button-right").removeClass(d+"-button-right-down base-button-right-down"),b.find("."+d+"-button-left").removeClass(d+"-button-left-down base-button-left-down")):"mouseover"===c.type?-1==b.attr("class").indexOf("disabled")&&(b.addClass(d+"-button-over base-button-over"),b.find("."+d+"-button-left").addClass(d+"-button-left-over base-button-left-over"),b.find("."+d+"-button-right").addClass(d+"-button-right-over base-button-right-over")):"mouseout"===c.type?(b.removeClass(d+"-button-over base-button-over"),b.removeClass(d+"-button-down base-button-down"),b.find("."+d+"-button-left").removeClass(d+"-button-left-over base-button-left-over"),b.find("."+d+"-button-left").removeClass(d+"-button-left-down base-button-left-down"),b.find("."+d+"-button-right").removeClass(d+"-button-right-over base-button-right-over"),b.find("."+d+"-button-right").removeClass(d+"-button-right-down base-button-right-down")):"mousedown"===c.type&&(a.options.preventDefault&&c.preventDefault(),a.options.stopPropagation&&c.stopImmediatePropagation(),-1==b.attr("class").indexOf("disabled")&&(b.addClass(d+"-button-down base-button-down"),b.find("."+d+"-button-left").addClass(d+"-button-left-down base-button-left-down"),b.find("."+d+"-button-right").addClass(d+"-button-right-down base-button-right-down")))}})},PearsonGL.Gadget.SliderButton.prototype.keyPressEventHandler=function(a,b){},PearsonGL.Gadget.SliderButton.prototype.keyUpEventHandler=function(a,b){},PearsonGL.Gadget.SliderButton.prototype.buttonClick=function(){var a=this,b=this.jObject;this.options.hasHTML5Button||(a.isTouchDevice&&a.options.useTouchForClick?a.eventAttacher.on("touchend.button",function(b){a.options.clickFunction(a,"click",b),$(window).trigger("buttonImageSliderClick",{data:a.options})}):a.eventAttacher.click(function(c){c.stopImmediatePropagation(),a.options.clickFunction(a,"click",c),$(window).trigger("buttonImageSliderClick",{data:a.options});var d=a.options.buttonClassName;b.removeClass(d+"-button-down base-button-down"),b.find("."+d+"-button-right").removeClass(d+"-button-right-down base-button-right-down"),b.find("."+d+"-button-left").removeClass(d+"-button-left-down base-button-left-down")}),a.eventAttacher.keydown(function(b){b.stopImmediatePropagation(),13!==b.keyCode&&32!==b.keyCode||(a.options.clickFunction(a,"key",b),$(window).trigger("buttonImageSliderClick",{data:a.options})),a.keyPressEventHandler(b,a)}),a.eventAttacher.keyup(function(c){if(9!==c.keyCode||$(this).attr("class").indexOf("disable")>-1)13===c.keyCode&&a.keyUpEventHandler(c,a);else{var d=$(window).height(),e=$(b).offset();window.scroll(0,e.top-d+$(b).height()+50),PearsonGL.utils.focusItemOn(this)}}).blur(function(){PearsonGL.utils.focusItemOff(this)}))},PearsonGL.Gadget.SliderButton.prototype.enable=function(){var a=this.options.buttonClassName;this.options.hasHTML5Button?(this.options.enable=!0,this.eventAttacher.attr("aria-disabled","false"),this.jObject.removeClass(a+"-button-disable base-button-disable"),this.jObject.removeAttr("disabled")):(this.options.enable=!0,this.eventAttacher.attr("aria-disabled","false"),this.jObject.removeClass(a+"-button-disable base-button-disable"),this.jObject.find("."+a+"-button-left").removeClass(a+"-button-left-disable base-button-left-disable"),this.jObject.find("."+a+"-button-right").removeClass(a+"-button-right-disable base-button-right-disable"))},PearsonGL.Gadget.SliderButton.prototype.disable=function(){var a=this.options.buttonClassName;this.options.hasHTML5Button?(this.options.enable=!1,this.eventAttacher.attr("aria-disabled","true"),this.jObject.removeClass(a+"-button-over base-button-over "+a+"-button-down base-button-down").addClass(a+"-button-disable base-button-disable"),this.jObject.attr("disabled",!0)):(this.options.enable=!1,this.eventAttacher.attr("aria-disabled","true"),this.jObject.removeClass(a+"-button-over base-button-over "+a+"-button-down base-button-down").addClass(a+"-button-disable base-button-disable"),this.jObject.find("."+a+"-button-right").removeClass(a+"-button-right-down base-button-right-down "+a+"-button-right-over base-button-right-over").addClass(a+"-button-right-disable base-button-right-disable"),this.jObject.find("."+a+"-button-left").removeClass(a+"-button-left-down base-button-left-down "+a+"-button-left-over base-button-left-over").addClass(a+"-button-left-disable base-button-left-disable"))},PearsonGL.Gadget.SliderButton.prototype.isEnabled=function(){return this.options.enable},PearsonGL.Gadget.SliderButton.prototype.destroy=function(){this.jObject.unbind(".button")},$.fn.sliderbutton=function(){if(0!==arguments.length)if("object"===_typeof(arguments[0])){var a=new PearsonGL.Gadget.SliderButton(this,arguments[0]);$(this).data("slider-button-component",a)}else if("string"==typeof arguments[0]){var a=$(this).data("slider-button-component");if(a&&"function"==typeof a[arguments[0]]){if("function"!=typeof arguments[1])return a[arguments[0]].apply(a,Array.prototype.slice.call(arguments,1));a[arguments[0]]=arguments[1],$(this).data("slider-button-component",a)}}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.ButtonComponent=function(){function a(b,c){var d=this;_classCallCheck(this,a),this.options={roleType:"",type:""},$.extend(this.options,c),this.jObject=$(b);var e=this.jObject.find("i").first();switch(this.jObject.addClass("base-button"),0===e.length&&(e=$("<i></i>").append(this.jObject.html()),this.jObject.html(e)),this.options.type){case"icon":this.jObject.addClass("base-button-icon"),e.attr("data-icon","true");break;case"textIcon":this.jObject.addClass("base-button-text-icon"),e.attr("data-icon","true");break;case"text":this.jObject.addClass("base-button-text")}switch(this.options.roleType){case"menuitemcheckbox":case"menuitemradio":this.jObject.attr({role:this.options.roleType,"aria-checked":!1});break;case"menutoggle":this.jObject.attr({"aria-haspopup":!0,"aria-expanded":!1})}this.jObject.on("keyup",function(a){var b=PearsonGL.utils.keyCode;switch(a.which){case b.tab:case b.up:case b.right:case b.down:case b.left:d.jObject.addClass("text-button-focus")}}),this.jObject.on("blur",function(a){d.jObject.removeClass("text-button-focus")})}return _createClass(a,[{key:"press",value:function(){switch(this.jObject.addClass("button-pressed"),this.options.roleType){case"menuitemcheckbox":case"menuitemradio":this.jObject.attr("aria-checked",!0);break;case"menutoggle":this.jObject.attr("aria-expanded",!0);break;default:this.jObject.attr("aria-pressed",!0)}}},{key:"unpress",value:function(){switch(this.jObject.removeClass("button-pressed"),this.options.roleType){case"menuitemcheckbox":case"menuitemradio":this.jObject.attr("aria-checked",!1);break;case"menutoggle":this.jObject.attr("aria-expanded",!1);break;default:this.jObject.attr("aria-pressed",!1)}}}]),a}(),$.fn.buttonComponent=function(a){if("object"===_typeof(arguments[0])||0==arguments.length){var b=new PearsonGL.Gadget.ButtonComponent(this,arguments[0]);return $(this).data("button-component",b),this}if("string"==typeof arguments[0]){var c=$(this).data("button-component"),d=arguments[0];if(c&&"function"==typeof c[d])return c[d].apply(c,Array.prototype.slice.call(arguments,1))}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.DialogComponent=function(){function a(b,c){_classCallCheck(this,a),this.options={dialogType:"feedback",closeToolTip:"Close",yesToolTip:"Yes",noToolTip:"No",resizable:!1,doAnimate:!0},this.initialize(b,c)}return _createClass(a,[{key:"initialize",value:function(a,b){$.extend(this.options,b),this.jObject=$(a),this.DIALOG_FEEDBACK="feedback",this.DIALOG_CONFIMATION="confirm",this.ANIMATED_FEEDBACK="animated",this.determineDialog()}},{key:"determineDialog",value:function(){switch(this.options.dialogType){case this.DIALOG_CONFIMATION:this.buildConfirmDialog();break;case this.ANIMATED_FEEDBACK:this.buildAnimatedFeedbackDialog();break;case this.DIALOG_FEEDBACK:default:this.buildDefaultDialog()}}},{key:"populateDialog",value:function(a,b){a.attr("audio",""),a.empty().richtextcomponent(b),PearsonGL.utils.initMathJax(this.jObject[0])}},{key:"removeTabsFromLabel",value:function(){this.jObject.find(".result-pop-up .hidden-label").removeAttr("audio").removeAttr("tabindex").removeAttr("role").removeAttr("data-audio-type"),this.jObject.find(".result-pop-up .hidden-label").find("[tabindex]").removeAttr("tabindex")}},{key:"addToScreen",value:function(a){var b=this,c=this.jObject;b.eventData={inGadget:!0,isModal:this.options.isModal};var d=c.parents(".page").find("[data-feedback]");d.length>0?(d.find(".result-text-container .result-text").audioComponent("pause"),d.empty().append(a),a.find(".result-close").remove(),a.show(),PearsonGL.utils.initMathJax(d[0]),b.eventData.inGadget=!1):(c.append(a),this.options.isModal&&c.append('<div class="modal-dialog-window"></div>')),!0===PearsonGL.globals.useSMTranslate&&$("p, img").not(".button-text, .button-text > p, .base-button, .base-button > p").click(function(a){!0===PearsonGL.globals.useSMTranslate&&(PearsonGL.globals.player.stopAudio(),a.stopPropagation(),$rw_successmakerTranslateSection($(this)[0]))})}},{key:"buildDefaultDialog",value:function(){var a=this,b=this.jObject,c=$(),d=a.options.resultsText?a.options.resultsText:"";PearsonGL.utils.hasParmContent()&&(d=PearsonGL.qtiEvaluator.replaceParameters(d)),c=$('<div tabindex="0" class="dialog-box-window result-pop-up popup-window hide"><div class="result-header"></div>\n        <div class="result-text-container"><div class="result-text">'+d+"</div></div>\n        "+this.getCloseButtonDom("result-close")+"</div>"),!0===PearsonGL.globals.useSMTranslate&&c.addClass("translate-cursor"),a.addToScreen(c),c.removeClass("dialog-correct dialog-incorrect correct incorrect"),!0===a.options.dialogIsCorrect?c.addClass("dialog-correct"):!1===a.options.dialogIsCorrect&&c.addClass("dialog-incorrect"),a.options.audioComponent&&a.options.audioComponent.src&&""!==a.options.audioComponent.src&&c.find(".result-text-container .result-text").audioComponent(a.options.audioComponent),(this.options.dialogWidth||this.options.dialogHeight)&&a.setDialogSize(c),b.find(".result-pop-up").draggable({scroll:!0,handle:".result-header",containment:".main",start:function(a,b){$(this).addClass("has-dragged")}}),this.options.resizable&&b.find(".result-pop-up").resizable({}),c.children(".result-close").sliderbutton({buttonClassName:"result-close",slider:!1,clickFunction:function(a,d){try{c.find(".result-text").audioComponent("pause")}catch(a){}c.fadeOut(),b.find(".modal-dialog-window").hide(),b.unbind("click.obj"),c.triggerHandler({type:"closed",pressType:d})}}),c.children(".result-close").sliderbutton("keyPressEventHandler",function(a,b){a.stopImmediatePropagation(),a.stopPropagation(),9!=a.keyCode||a.shiftKey||(a.preventDefault(),c.focus())}),c.focus(function(a){}).blur(function(a){}).bind("keydown",function(a){a.stopImmediatePropagation(),a.stopPropagation(),9==a.keyCode&&a.shiftKey&&(a.preventDefault(),c.children(".result-close").focus())}),c.children(".result-close").attr("aria-label",a.options.closeToolTip),c.attr("role","presentation"),$(window).trigger("showfeedback",a.eventData),PearsonGL.utils.initMathJax(c[0])}},{key:"getCloseButtonDom",value:function(a){return'<div class="'+a+' close-icon" data-icon="icon-dialog-close-button" data-closeBtnLabel="'+this.options.closeToolTip+'" alt="'+this.options.closeToolTip+'" title="'+this.options.closeToolTip+'"></div>\n        <div class="'+a+' close-text">'+this.options.closeToolTip+"</div>"}},{key:"setDialogSize",value:function(a){var b="px";this.options.dialogHeight&&1*this.options.dialogHeight>0&&(this.options.dialogUnits&&(b="pixels"===this.options.dialogUnits?"px":"%"),a.css({height:this.options.dialogHeight+b})),this.options.dialogWidth&&1*this.options.dialogWidth>0&&(this.options.dialogUnits&&(b="pixels"===this.options.dialogUnits?"px":"%"),a.css({width:this.options.dialogWidth+b}))}},{key:"buildAnimatedFeedbackDialog",value:function(){var a=this,b=this,c=this.jObject,d=this.options.imageComponent,e=this.options.textMessage,f=e&&PearsonGL.utils.isNonEmptyString(e.value)?e.value:"",g=this.options.doAnimate,h=void 0,i=!1,j=void 0,k=d&&d.title?d.title:"",l=d&&d.src?d.src:"",m="",n="";if(PearsonGL.utils.hasParmContent()&&(f=PearsonGL.qtiEvaluator.replaceParameters(f),k=PearsonGL.qtiEvaluator.replaceParameters(k),l=PearsonGL.qtiEvaluator.evaluateAsset(l),i=/<svg/i.test(l)),c.find(".result-text, .result-animation-container").empty(),c.find(".animated-dialog-box-window").remove(),"textTop"===this.options.dialogLayout?n='<div alt="'+k+'" class="'+(g?"result-animation-container":"result-image-container")+' result-graphic-container"></div>':m='<div alt="'+k+'" class="'+(g?"result-animation-container":"result-image-container")+' result-graphic-container"></div>',h=$('<div tabindex="0" class="animated-dialog-box-window result-pop-up popup-window hide">\n            <div class="result-header"></div><div class="result-text-container">'+m+'\n            <div class="result-text '+(f.length<=0?"hide":"show")+'">'+f+"</div>"+n+"</div>"+this.getCloseButtonDom("result-close")+"</div>"),b.addToScreen(h),h.removeClass("dialog-correct dialog-incorrect"),!0===b.options.dialogIsCorrect?h.addClass("dialog-correct"):!1===b.options.dialogIsCorrect&&h.addClass("dialog-incorrect"),e&&e.audioComponent&&e.audioComponent.src&&""!==e.audioComponent.src&&(PearsonGL.utils.isNonEmptyString(e.value)?h.find(".result-text-container .result-text").audioComponent(e.audioComponent):"hover"===e.audioComponent.type?h.find(".result-graphic-container").audioComponent(e.audioComponent):h.find(".result-text-container .result-text").audioComponent(e.audioComponent)),d)if(j=function(){var a=h.find(".result-graphic-container"),c=g?d.width:this.width,e=g?d.height:this.height,f=g?d.fps:void 0,j=g?d.loops:void 0;if(g){var m={image:l,fps:f,frameWidth:c,frameHeight:e,loops:j};h.addClass("base-animation"),a.imgAnimate(m),a.imgAnimate("startLoop")}else if(i)a.append(l);else{var n={src:l,title:k||""};a.parents(".result-pop-up").removeClass("animated-dialog-box-window").addClass("image-dialog-box-window"),a.imagecomponent(n)}b.setDialogSize(h),d.audioComponent&&PearsonGL.utils.isNonEmptyString(d.audioComponent.src)&&a.audioComponent(d.audioComponent),$(window).trigger("showfeedback",b.eventData)},this.image=document.createElement("img"),this.image.src=l,i)j();else{var o=function(b){return new Promise(function(c){var d=a.image;d.src=b,$(d).hide(),d.onload=function(){return c(PearsonGL.logger.log({path:b,status:"ok"}))},d.onerror=function(){return c(PearsonGL.logger.log({path:b,status:"error"}))}})};o(l).then(function(a){j()}).then(function(a){$(a).show()}).then(function(a){}).catch(function(a){return PearsonGL.logger.log(a,value)}),(void 0==l||null==l||l.length<=0)&&$(window).trigger("showfeedback",b.eventData)}else $(window).trigger("showfeedback",b.eventData);c.find(".result-pop-up").draggable({scroll:!0,handle:".result-header",containment:".main",start:function(a,b){$(this).addClass("has-dragged")}}),this.options.resizable&&c.find(".result-pop-up").resizable({}),h.children(".result-close").sliderbutton({buttonClassName:"result-close",slider:!1,clickFunction:function(a,b){h.fadeOut(function(){h.removeClass("dialog-correct dialog-incorrect incorrect correct")}),c.find(".modal-dialog-window").hide(),c.unbind("click.obj"),h.triggerHandler({type:"closed",pressType:b})}}),h.children(".result-close").sliderbutton("keyPressEventHandler",function(a,b){a.stopImmediatePropagation(),a.stopPropagation(),9!=a.keyCode||a.shiftKey||(a.preventDefault(),h.focus())}),h.focus(function(a){}).blur(function(a){}).bind("keydown",function(a){a.stopImmediatePropagation(),a.stopPropagation(),9==a.keyCode&&a.shiftKey&&(a.preventDefault(),h.children(".result-close").focus())}),h.children(".result-close").attr("aria-label",b.options.closeToolTip),h.attr("role","presentation"),PearsonGL.utils.initMathJax(h[0]),!0===PearsonGL.globals.useSMTranslate&&h.addClass("translate-cursor")}},{key:"buildConfirmDialog",value:function(){var a=this,b=this.jObject,c=PearsonGL.utils.randomString(8)+PearsonGL.utils.randomString(8),d=void 0,e=a.options.audioComponent&&a.options.audioComponent.src,f=this.options.resultsText?this.options.resultsText:"";b.find(".dialog-box-window").remove(),d='<div class="checker-text">',PearsonGL.utils.hasParmContent()&&(f=PearsonGL.qtiEvaluator.replaceParameters(f));var g='\x3c!--<div class="checker-model-blanket"></div>--\x3e<div aria-labelledby="'+c+'" tabindex="0" class="dialog-box-window checker checker-pop-up hide yesnodialog popup-window"><div class="checker-header"></div>\n        <label id="'+c+'" class="hidden-label"></label>'+d+'\n        <div class="checker-text-cell">'+f+'</div>\n        <div data-source="" class="yes" alt="'+a.options.yesToolTip+'"></div>\n        <div class="no" alt="'+a.options.noToolTip+'"></div></div>';if(b.append(g),!this.options.isModal){b.find(".checker-model-blanket").hide()}var h=b.find(".checker").find(".no"),i=b.find(".yesnodialog"),j=b.find(".yes");h.sliderbutton({buttonClassName:"no",buttonText:a.options.noToolTip,slider:!0,clickFunction:function(a){i.fadeOut(),e&&b.find(".checker-text-cell").audioComponent("pause"),b.find(".checker-model-blanket").remove()}}),h.find(".base-button-inside-wrap").attr("aria-label",a.options.noToolTip),h.sliderbutton("keyPressEventHandler",function(a,b){a.stopImmediatePropagation(),a.stopPropagation(),9!=a.keyCode||a.shiftKey||(a.preventDefault(),i.focus())}),h.find(".button-text").attr({"data-noButtonText":a.options.noToolTip,"aria-label":a.options.noToolTip}),a.options.keyPressEventHandler&&(j.sliderbutton({buttonClassName:"yes",buttonText:a.options.yesToolTip,slider:!0,clickFunction:function(){a.options.keyPressEventHandler(),e&&b.find(".checker-text-cell").audioComponent("pause"),b.find(".checker-model-blanket").remove()}}),j.find(".button-text").attr({"data-yesbuttontext":a.options.yesToolTip,"data-sourceclick":a.options.buttonClassName,"aria-label":a.options.yesToolTip})),j.find(".base-button-inside-wrap").attr("aria-label",a.options.yesToolTip),i.attr("role","presentation"),e&&(b.find(".checker-text-cell").audioComponent(a.options.audioComponent),b.find(".hidden-label").removeAttr("audio").removeAttr("tabindex").removeAttr("role").removeAttr("data-audio-type")),i.bind("keydown",function(a){a.stopImmediatePropagation(),a.stopPropagation(),9==a.keyCode&&a.shiftKey&&(a.preventDefault(),h.focus())}).draggable({handle:b.children(".checker").find(".checker-header"),scroll:!0,containment:".main",start:function(a,b){$(this).addClass("has-dragged")}}).focus(function(a){a.keyCode===PearsonGL.utils.keyCode.tab&&PearsonGL.utils.focusItemOn(this)}).blur(function(a){PearsonGL.utils.focusItemOff(this)}),PearsonGL.utils.initMathJax(b[0]),$(window).trigger("showfeedback",a.eventData)}}]),a}(),$.fn.dialogcomponent=function(){if(0!==arguments.length)if("object"===_typeof(arguments[0])){var a=new PearsonGL.Gadget.DialogComponent(this,arguments[0]);$(this).data("dialog-component",a)}else if("string"==typeof arguments[0]){var b=$(this).data("dialog-component");if(b&&"function"==typeof b[arguments[0]])return b[arguments[0]].apply(b,Array.prototype.slice.call(arguments,1))}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.Protector=function(a,b){this.options={},this.jObject=$(a),this.initialize(a,b)},PearsonGL.Gadget.Protector.prototype.initialize=function(a,b){if(void 0!==a){$.extend(!0,this.options,b);var c=this;this.jObject.each(function(){c._protectImage(this)})}},PearsonGL.Gadget.Protector.prototype._protectImage=function(a){document.all&&a.setAttribute("galleryimg","no"),a.oncontextmenu=function(){return!1},this._capture(a)},PearsonGL.Gadget.Protector.prototype._capture=function(a){var b=this;a.addEventListener?a.addEventListener("mousedown",b._block,!1):a.attachEvent&&a.attachEvent("ondragstart",b._block)},PearsonGL.Gadget.Protector.prototype._block=function(a){var b=a;return a&&void 0!==a||(b=window.event),b.stopPropagation?(b.stopPropagation(),b.preventDefault()):(b.cancelBubble=!0,b.returnValue=!1),!1},$.fn.Protector=function(){if("object"===_typeof(arguments[0])||0===arguments.length){var a=new PearsonGL.Gadget.Protector(this,arguments[0]);$(this).data("protector-component",a)}else if("string"==typeof arguments[0]){var a=$(this).data("protector-component");if(a&&"function"==typeof a[arguments[0]]){if("function"!=typeof arguments[1])return a[arguments[0]].apply(a,Array.prototype.slice.call(arguments,1));a[arguments[0]]=arguments[1],$(this).data("protector-component",a)}}},window.PearsonGL=window.PearsonGL||{},window.PearsonGL.globals=window.PearsonGL.globals||{},PearsonGL.logger=function(){function a(){g=!0,f.log=console.log.bind(window.console),f.error=console.error.bind(window.console),f.warn=console.warn.bind(window.console),f.debug=console.debug.bind(window.console),f.trace=console.trace.bind(window.console),f.table=console.table.bind(window.console),f.dir=console.dir.bind(window.console),f.group=console.group.bind(window.console),f.groupEnd=console.groupEnd.bind(window.console),f.groupCollapsed=console.groupCollapsed.bind(window.console),h&&c()}function b(){f.info=console.info.bind(window.console)}function c(){g=!0,f.warn=function(a){(i||PearsonGL.globals.comm&&PearsonGL.globals.comm.sendMessage)&&(i=!0,PearsonGL.globals.comm.sendMessage("setLogData",{level:"warn",message:a}),console.warn(a))},f.error=function(a){(i||PearsonGL.globals.comm&&PearsonGL.globals.comm.sendMessage)&&(i=!0,PearsonGL.globals.comm.sendMessage("setLogData",{level:"error",message:a}),console.error(a))}}function d(){g=!1,f.log=j,f.error=j,f.warn=j,f.debug=j,f.trace=j,f.info=j,f.table=j,f.dir=j,f.group=j,f.groupEnd=j,f.groupCollapsed=j}function e(){return g}var f={},g=!1,h=!1,i=PearsonGL.globals.comm&&PearsonGL.globals.comm.sendMessage,j=function(){},k=["log","error","warn","debug","trace","info","table","dir","group","groupEnd","groupCollapsed"],l=PearsonGL.utils.getQuerystring("debug","",!1),m=PearsonGL.utils.getQuerystring("logger","",!1),n=PearsonGL.utils.getQuerystring("debugInfo","",!1),o=PearsonGL.utils.getQuerystring("postLog","",!1),p=PearsonGL.utils.getQuerystring("debug","",!0),q=PearsonGL.utils.getQuerystring("logger","",!0),r=PearsonGL.utils.getQuerystring("debugInfo","",!0),s=PearsonGL.utils.getQuerystring("postLog","",!0);window.console=window.console||{},k.forEach(function(a){"function"!=typeof console[a]&&(console[a]=j)}),d(),"true"===l||"1"===l||"true"===m||"1"===m?a():"true"!==p&&"1"!==p&&"true"!==q&&"1"!==q||a();try{window.localStorage&&"true"===window.localStorage.getItem("debug")&&a()}catch(a){}"true"===n||"1"===n?(a(),b()):"true"!==r&&"1"!==r||(a(),b());try{window.localStorage&&"true"===window.localStorage.getItem("debugInfo")&&(a(),b())}catch(a){}return"true"!==o&&"true"!==s||(h=!0,c()),f.enable=a,f.enableInfo=b,f.enablePostLogging=c,f.disable=d,f.isEnabled=e,f}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},window.PearsonGL.globals=window.PearsonGL.globals||{},PearsonGL.Gadget.AudioComponent=function(a,b,c){a.audioComponent("destroy"),this.isDestroyed=!1,void 0===PearsonGL.globals.audioComponentCount&&(PearsonGL.globals.audioComponentCount=0),this.id=PearsonGL.globals.audioComponentCount++,this.labelOpts={playalt:"play",pausealt:"pause"},this.options={type:"hover",src:"",trigger:!1,isPopAudio:!1,stopDefault:!0,gadgetName:"AudioPlayer",resetAudioOnPause:!1},b&&($.extend(this.options,b),PearsonGL.Gadget.GadgetBase.call(this,b,c),this.jObject=$(a),this.initialize(a))},PearsonGL.Gadget.AudioComponent.prototype=Object.create(PearsonGL.Gadget.GadgetBase.prototype),PearsonGL.Gadget.AudioComponent.prototype.initialize=function(a){var b=this,c=this;if(void 0!==a){var d=function(a){b.labelOpts.playalt=a.playToolTip,b.labelOpts.pausealt=a.pauseToolTip};if(PearsonGL.utils.getGlobalizedLabel("player_globalization",function(a){void 0!==a&&d(a)},this.options.runtimejson.lang),$.extend(this.labelOpts,this.options.labelOpts),!this.options.src&&!this.options.isPopAudio)return void(this.hasSource=!1);this.type=this.options.type.toLowerCase().trim(),this.waitingToPlay=!1,this.isFirstAutoplay=!1,this.hasSource=!0,this.useAudioContext=!1,this.isSingleSource=!0,PearsonGL.globals.audioContext&&(this.useAudioContext=!0,this.audioContext=PearsonGL.globals.audioContext),this.pauseAt=0,this.startAt=0,this.playStartTime=0,this.totalDuration=0,this.currentAudioBufferSource=null,this.deferreds=[],this.html5=!1;var e=document.createElement("audio");e.canPlayType&&e.canPlayType("audio/mp3").replace(/no/,"")&&(this.html5=!0),this.isPlaying=!1,this.disabledAudio=!1,this.parentGadgetOptions=this.jObject.parents(".gadget").data("gadget_options"),this.audioSeq=[],this.audioSeqIndex=0,this.hasNotStarted=!0;var f=$("head base"),g=0===f.length?"":f.attr("href"),h=PearsonGL.globals&&PearsonGL.globals.player?PearsonGL.globals.player.settings.lang:"";if(this.audioPath=g+"audio/"+h+"/",this.readyToStart=$.Deferred(),!this.useAudioContext&&this.readyToStart&&c.readyToStart.resolveWith(this),"buttonautoplay"===this.type&&$(window).trigger("hasAutoplayAudio"),this.options.src){var i=function(a){var b;if(c.useAudioContext)b=$.Deferred(),c.deferreds.push(b),PearsonGL.globals.player.loadAudio(a,b),c.audioSeq.push({src:a});else{var d=new Audio;d.preload="auto",d.src=a,c.audioSeq.push({src:a,buffer:d}),$(d).on("loadedmetadata",function(a){c.totalDuration+=d.duration}),$(d).on("ended",function(){c.isPlaying&&(++c.audioSeqIndex<c.audioSeq.length?(c.audioSeq[c.audioSeqIndex].buffer.load(),c.audioSeq[c.audioSeqIndex].buffer.volume=PearsonGL.globals.player.getMasterVolume(),c.audioSeq[c.audioSeqIndex].buffer.play()):c.ended())})}};if(PearsonGL.parmMgr){var j=this.options.src;if(PearsonGL.parmMgr.isParm(this.options.src)&&(j=PearsonGL.parmMgr.getValue(this.options.src)),$.isArray(j)){c.isSingleSource=!1;var k,l=PearsonGL.Media.textToSpeech.getAudios(j);for(k=0;k<l.length;k++)-1===l[k].indexOf("/")&&(l[k]=this.audioPath+l[k]),i(l[k])}else i(PearsonGL.qtiEvaluator.evaluateAsset(this.options.src))}else{c.audioSeq.push({src:this.options.src});var e=new Audio;e.preload="auto",e.src=this.options.src,$(e).on("loadedmetadata",function(a){c.totalDuration+=e.duration})}this.useAudioContext?$.when.apply($,this.deferreds).done(function(){var a;for(a=0;a<c.audioSeq.length;a++){var b=PearsonGL.globals.player.getAudioBuffer(c.audioSeq[a].src);b&&(c.audioSeq[a].buffer=b,c.totalDuration+=b.duration)}c.readyToStart&&c.readyToStart.resolveWith(c),c.createAudioPlayer()}):(c.readyToStart&&c.readyToStart.resolveWith(c),c.createAudioPlayer())}$(window).on("startAudioAutoplay",function(){c.readyToStart.done(function(){"buttonautoplay"===c.type&&c.audio&&c.audioSeq.length>0&&(c.setUpAudioButton(c.jObject.find("#play")),c.isFirstAutoplay=!0)})})}},PearsonGL.Gadget.AudioComponent.prototype.createAudioPlayer=function(){var a=this,b=this.jObject;(navigator.userAgent.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Mozilla")>-1)&&window.location.href.toLowerCase().indexOf("msde")>-1&&window.location.href.toLowerCase().indexOf("blackboard")>-1&&(this.html5=!1),b.attr("audio",this.audioSeq[0].src).addClass("audioToggleIdentifier"),!1===this.html5?(this.audio=$("#inline_swf_audio_player"),0===this.audio.length&&(this.audio=$('<div id="inline_swf_audio_player" class="jp-jplayer" ></div>'),$("body").append(this.audio),this.audio.css({position:"absolute","z-index":"-10",left:"0",top:"0",width:"0",height:"0"}),this.audio.jPlayer({ready:function(){},solution:"flash, html",supplied:"mp3",preload:"auto",swfPath:"js"}).bind($.jPlayer.event.error,function(a){window.location.href.indexOf("file://")||"e_flash"!=a.jPlayer.error.type&&"e_url_not_set"!=a.jPlayer.error.type||alert("Enable Flash Trusted Locations for Content Object")}),this.audio.bind($.jPlayer.event.ended,function(){a.isPlaying&&a.ended()}))):(this.audio=$("#inline_html_audio_player"),0===this.audio.length&&(this.audio=$('<audio id="inline_html_audio_player"></audio>'),PearsonGL.globals.audioComp=this.audio,$("body").append(this.audio),this.audio.css({position:"absolute","z-index":"-10",left:"0",top:"0",width:"0",height:"0"}),this.useAudioContext&&this.audio.attr("preload","none")),this.useAudioContext||(this.audio.on("ended",function(){a.isPlaying?a.ended():a.waitingToPlay&&(a.waitingToPlay=!1,a.setUpAudioButton(b.find("#play")))}),this.audio.on("pause",function(){a.waitingToPlay&&(a.waitingToPlay=!1,a.setUpAudioButton(b.find("#play")))})),"auto"===this.type&&a.play()),this.jObject.attr("data-audio-type",this.type),"hover"===this.type?this.togglesetup():"button"===this.type||"buttonautoplay"===this.type?(this.buttonsetup(),"buttonautoplay"===this.type&&!PearsonGL.globals.disableButtonAutoplay&&(PearsonGL.globals.browserData&&!PearsonGL.globals.browserData.specialFlags.isiOS&&!PearsonGL.globals.browserData.specialFlags.isAndroid||PearsonGL.globals.browserData&&(PearsonGL.globals.browserData.specialFlags.isiOS||PearsonGL.globals.browserData.specialFlags.isAndroid)&&PearsonGL.globals.player.preloadAudio.hasInteracted)&&($(".audioToggleIdentifier").each(function(){$(this).audioComponent("isplaying")&&($(this).audioComponent("pause"),a.waitingToPlay=!0)}),(!a.singleAudioSource||!a.waitingToPlay&&a.singleAudioSource)&&a.setUpAudioButton(b.find("#play")))):"progress"===this.type&&this.progressSetup()},PearsonGL.Gadget.AudioComponent.prototype.ended=function(){this.audioSeqIndex>=this.audioSeq.length-1?("button"===this.type||"buttonautoplay"===this.type||"progress"==this.type?(this.jObject.find("#pause").hide(),this.jObject.find("#play").show()):"hover"===this.type&&this.jObject.attr("aria-label",this.labelOpts.playalt),this.isPlaying=!1,this.fireEvent("paused"),this.html5&&(this.audio[0].src=""),this.audioSeqIndex=0,this.startAt=0,this.pauseAt=0,this.hasNotStarted=!0,this.onAudioComplete(),this.isPlaying=!1,this.jObject.attr("audio",this.audioSeq[this.audioSeqIndex].src),this.sendPlayedDuration()):(this.audio[0].src=this.audioSeq[++this.audioSeqIndex].src,this.jObject.attr("audio",this.audioSeq[this.audioSeqIndex].src),this.play(!1))},PearsonGL.Gadget.AudioComponent.prototype.destroy=function(){this.isDestroyed=!0},PearsonGL.Gadget.AudioComponent.prototype.progressSetup=function(){var a=this,b=this.jObject;if(this.lastPct=0,this.audioPct=0,b.attr("audiostate","ready"),b.prepend("<div class='controls'><div class='slice'> <div class='pie'></div></div><div tabindex='0' aria-label='"+this.labelOpts.playalt+"' title='"+this.labelOpts.playalt+"' class='ctr audio-play' id='play'></div><div tabindex='0' aria-label='"+this.labelOpts.pausealt+"' title='"+this.labelOpts.pausealt+"' class='ctr audio-pause' id='pause'></div></div>"),b.find(".audio-pause").hide(),b.find(".audio-play").sliderbutton({buttonClassName:"audio-play",slider:!1,clickFunction:function(b){!1===a.disabledAudio&&(a.loopButtonAudio(),a.setUpAudioButton(b.jObject))}}),b.find(".audio-pause").sliderbutton({buttonClassName:"audio-pause",slider:!1,clickFunction:function(b){!1===a.disabledAudio&&(a.loopButtonAudio(),a.setUpAudioButton(b.jObject))}}),!1===a.html5)$("#inline_swf_audio_player").bind($.jPlayer.event.timeupdate,function(c){if("playing"==b.attr("audiostate")){if(a.audioPct=parseInt(c.jPlayer.status.currentPercentAbsolute),0==a.lastPct&&0==a.audioPct?a.lastPct=0:a.lastPct>=0&&a.audioPct>0?a.lastPct=a.audioPct-1:a.lastPct>0&&0==a.audioPct&&(a.audioPct=100),100==a.audioPct)return a.progress(a.audioPct),void a.onAudioComplete();a.progress(a.audioPct)}});else{var c=document.getElementById("inline_html_audio_player");c.addEventListener("timeupdate",function(){if("playing"==b.attr("audiostate")){if(a.audioPct=c.currentTime/c.duration*100,a.lastPct=a.audioPct-1,100==a.audioPct)return a.progress(a.audioPct),void a.onAudioComplete();a.progress(a.audioPct)}})}},PearsonGL.Gadget.AudioComponent.prototype.progress=function(a){if(0!=a){if(a<2)this.jObject.find(".slice");else if(a>50)this.jObject.find(".slice").addClass("gt50");else if(100==a)return;var b=3.6*a;this.jObject.find(".pie").css({"-moz-transform":"rotate("+b+"deg)","-webkit-transform":"rotate("+b+"deg)","-o-transform":"rotate("+b+"deg)",transform:"rotate("+b+"deg)"})}},PearsonGL.Gadget.AudioComponent.prototype.onAudioComplete=function(){this.jObject.find(".slice").removeClass("gt50").find(".pie").css({"-moz-transform":"rotate(0deg)","-webkit-transform":"rotate(0deg)","-o-transform":"rotate(0deg)",transform:"rotate(0deg)"}).removeAttr("style"),this.lastPct=0,this.audioPct=0,this.jObject.attr("audiostate","ready"),$(window).trigger("audioComplete",this),this.isFirstAutoplay&&($(window).trigger("firstAudioAutoplayComplete",this),this.isFirstAutoplay=!1)},PearsonGL.Gadget.AudioComponent.prototype.togglesetup=function(){var a=this,b=this.jObject;b.attr("audio",a.options.src).addClass("audioCursor"),b.attr({tabindex:"0",role:"button","aria-label":this.labelOpts.playalt}),b.click(function(c){a.options.stopDefault&&c.stopPropagation(),!1===a.disabledAudio&&($(".audioToggleIdentifier").each(function(){b[0]!==$(this)[0]&&$(this).audioComponent("isplaying")&&$(this).audioComponent("pause")}),a.setUpAudioToggle())}),b.keydown(function(b){13===b.keyCode&&!1===a.disabledAudio?(b.stopImmediatePropagation(),a.setUpAudioToggle()):b.stopImmediatePropagation()}),b.keyup(function(a){if(9===a.keyCode){var c=$(window).height(),d=$(b).offset();window.scroll(0,d.top-c+$(b).height()+50),PearsonGL.utils.focusItemOn(this)}}).blur(function(){PearsonGL.utils.focusItemOff(this)})},PearsonGL.Gadget.AudioComponent.prototype.setUpAudioButton=function(a){var b=this,c=this.jObject;!0===this.html5?this.audio.attr("src")&&(c.attr("audio").indexOf(this.audio.attr("src"))>-1||this.audio.attr("src").indexOf(c.attr("audio"))>-1)?"play"==$(a).attr("id")?(this.play(),this.jObject.find("#pause").focus()):"pause"==$(a).attr("id")&&(this.pause(),this.jObject.find("#play").focus()):(this.audio[0].src=c.attr("audio"),b.onAudioComplete(),"play"==$(a).attr("id")?(this.play(),this.jObject.find("#pause").focus()):"pause"==$(a).attr("id")&&(this.pause(),this.jObject.find("#play").focus())):this.audio.attr("audio")==c.attr("audio")?"play"==$(a).attr("id")?(this.play(),this.jObject.find("#pause").focus()):"pause"==$(a).attr("id")&&(this.pause(),this.jObject.find("#play").focus()):(this.audio.attr("audio",c.attr("audio")),this.audio.jPlayer("clearMedia"),this.audio.jPlayer("setMedia",{mp3:c.attr("audio")}),b.onAudioComplete(),"play"==$(a).attr("id")?(this.play(),this.jObject.find("#pause").focus()):"pause"==$(a).attr("id")&&(this.pause(),this.jObject.find("#play").focus()))},PearsonGL.Gadget.AudioComponent.prototype.setUpAudioToggle=function(){var a=this.jObject;this.isDestroyed||(!0===this.html5?(this.audio.attr("src"),a.attr("audio"),!0===this.isPlaying?this.pause():this.play()):this.audio.attr("audio")==a.attr("audio")?!0===this.isPlaying?this.pause():this.play():(this.audio.jPlayer("clearMedia"),this.audio.jPlayer("setMedia",{mp3:a.attr("audio")}),!0===this.isPlaying?this.pause():this.play()))},PearsonGL.Gadget.AudioComponent.prototype.buttonsetup=function(){var a=this,b=this.jObject;this.jObject.prepend('\n\t\t<div class="controls">\n\t\t\t<div tabindex="0" aria-label="'+this.labelOpts.playalt+'" title="'+this.labelOpts.playalt+'" class="ctr" id="play" data-icon="audio-play"></div>\n\t\t\t<div tabindex="0" aria-label="'+this.labelOpts.pausealt+'" title="'+this.labelOpts.pausealt+'" class="ctr" id="pause" data-icon="audio-pause"></div>\n\t\t\t<div class="hidden-label aria-live" aria-live="polite"></div>\n\t\t</div>\n\t'),this.jObject.find("#pause").hide(),this.jObject.find("#play").sliderbutton({buttonClassName:"audio-play",slider:!1,clickFunction:function(){!1===a.disabledAudio&&(a.loopButtonAudio(),a.setUpAudioButton(b.find("#play")),0===a.audioSeqIndex&&a.hasNotStarted&&(PearsonGL.globals&&PearsonGL.globals.comm&&PearsonGL.globals.comm.startAudioByClicked(),a.hasNotStarted=!1))}}),this.jObject.find("#pause").sliderbutton({buttonClassName:"audio-pause",slider:!1,clickFunction:function(){!1===a.disabledAudio&&(a.loopButtonAudio(),a.setUpAudioButton(b.find("#pause")))}})},PearsonGL.Gadget.AudioComponent.prototype.loopButtonAudio=function(){var a=this.jObject;$(".audioToggleIdentifier").each(function(){a[0]!==$(this)[0]&&($(this).audioComponent("isplaying")&&$(this).audioComponent("pause"),$(this).audioComponent("onAudioComplete"))})},PearsonGL.Gadget.AudioComponent.prototype.enableAudio=function(){this.disabledAudio=!1},PearsonGL.Gadget.AudioComponent.prototype.disableAudio=function(){this.disabledAudio=!0},PearsonGL.Gadget.AudioComponent.prototype.isplaying=function(){return this.isPlaying},PearsonGL.Gadget.AudioComponent.prototype.play=function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=this.jObject,c=this;if(!this.destory&&this.hasSource&&this.audio){if(PearsonGL.globals.useSMTranslate&&($rw_stopSpeech(),$(".thss-dialog-toolbarPopup").hide()),this.isPlaying=!0,a&&(this.playStartTime=Date.now()),"button"===this.type||"progress"===this.type||"buttonautoplay"===this.type?(b.find("#play").hide(),b.find("#pause").show(),this.readLiveText(this.labelOpts.playalt)):"hover"===this.type&&b.attr("aria-label",this.labelOpts.pausealt),b.attr("audiostate","playing"),!0===this.html5){if($("#inline_html_audio_player").length>0)if(!0===this.options.trigger&&(this.audio[0].src=b.attr("audio")),this.id===this.audio.data("id")&&this.audio.attr("src")==this.audioSeq[this.audioSeqIndex].src||(this.audio[0].src=this.audioSeq[this.audioSeqIndex].src,b.attr("audio",this.audioSeq[this.audioSeqIndex].src),this.audio.data("id",this.id)),this.useAudioContext){if(this.useAudioContext&&this.audioContext)if(0!==this.audioSeqIndex&&this.audioSeqIndex>=this.audioSeq.length)this.audioSeqIndex=0,this.pauseAt=0,this.isPlaying=!1;else{if(!this.audioSeq[this.audioSeqIndex].buffer)return void PearsonGL.logger.log("Failed to create AudioBuffer: "+this.audioSeq[this.audioSeqIndex].src);this.currentAudioBufferSource=this.audioContext.createBufferSource(),this.currentAudioBufferSource.buffer=this.audioSeq[this.audioSeqIndex].buffer,this.currentAudioBufferSource.connect(PearsonGL.globals.masterVolumeGainNode);var d=this.currentAudioBufferSource.buffer.duration-this.pauseAt;d<0&&(this.pauseAt=0,this.ended()),this.currentAudioBufferSource.onended=function(){c.isPlaying&&(c.pauseAt=0,c.ended())},this.startAt=this.audioContext.currentTime,this.currentAudioBufferSource.start?this.currentAudioBufferSource.start(0,this.pauseAt):this.currentAudioBufferSource.noteOn(0,this.pauseAt)}}else PearsonGL.globals.isSpeedGame||this.isSingleSource&&!PearsonGL.parmMgr?($("#inline_html_audio_player")[0].volume=PearsonGL.globals.player.getMasterVolume(),$("#inline_html_audio_player")[0].play()):(this.audioSeq[this.audioSeqIndex].buffer.volume=PearsonGL.globals.player.getMasterVolume(),this.audioSeq[this.audioSeqIndex].buffer.play())}else!0===this.options.trigger?this.audio.jPlayer("setMedia",{mp3:b.attr("audio")}):(this.audio.jPlayer("clearMedia"),this.audio.jPlayer("setMedia",{mp3:this.audioSeq[this.audioSeqIndex]})),$("#inline_swf_audio_player").jPlayer("play");this.sendAnalytics("audio_play_pressed"),this.fireEvent("played")}},PearsonGL.Gadget.AudioComponent.prototype.fireEvent=function(a,b){$(window).trigger(a,{sourceId:this.gadgetUniqueId,source:this})},PearsonGL.Gadget.AudioComponent.prototype.setVolume=function(a){this.html5&&!this.useAudioContext&&(PearsonGL.globals.isSpeedGame||this.isSingleSource&&!PearsonGL.parmMgr?$("#inline_html_audio_player")[0].volume=a:this.audioSeq[this.audioSeqIndex].buffer.volume=a)},PearsonGL.Gadget.AudioComponent.prototype.pause=function(){var a=this.jObject,b=this.options.resetAudioOnPause||PearsonGL.globals.player.runtimeJson.resetAudioOnPause;this.isPlaying&&!this.isDestroyed&&(this.isPlaying=!1,!0===this.html5?this.useAudioContext&&this.currentAudioBufferSource?(b?(this.audioSeqIndex=0,this.pauseAt=0):this.pauseAt=this.audioContext.currentTime-this.startAt,this.currentAudioBufferSource.stop(this.pauseAt)):this.isSingleSource&&!PearsonGL.parmMgr?(this.audio[0].pause(),b&&(this.audio[0].currentTime=0)):(this.audioSeq[this.audioSeqIndex].buffer.pause(),b&&(isNaN(this.audioSeq[this.audioSeqIndex].buffer.duration)||(this.audioSeq[this.audioSeqIndex].buffer.currentTime=0),this.audioSeqIndex=0,this.pauseAt=0)):this.audio.jPlayer("pause"),"button"===this.type||"buttonautoplay"===this.type||"progress"==this.type?(a.find("#pause").hide(),a.find("#play").show(),this.readLiveText(this.labelOpts.pausealt)):"hover"===this.type&&a.attr("aria-label",this.labelOpts.playalt),a.attr("audiostate","paused"),this.sendAnalytics("audio_play_paused"),this.sendPlayedDuration(),this.fireEvent("paused"))},PearsonGL.Gadget.AudioComponent.prototype.stop=function(){this.jObject.find(".audioToggleIdentifier").each(function(){$(this).audioComponent("isplaying")&&$(this).audioComponent("pause"),$(this).audioComponent("onAudioComplete")})},PearsonGL.Gadget.AudioComponent.prototype.sendPlayedDuration=function(){var a=(Date.now()-this.playStartTime)/1e3;this.sendAnalytics("audio_played_duration_of_"+this.totalDuration.toFixed(1)+"_seconds "+a.toFixed(1))},PearsonGL.Gadget.AudioComponent.prototype.readLiveText=function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;this.jObject.find(".aria-live").text(a),clearTimeout(this.clearLiveTextTimeout),this.clearLiveTextTimeout=setTimeout(function(){b.jObject.find(".aria-live").text("")},c)},$.fn.audioComponent=function(){if(0!==arguments.length){var a;if("object"===_typeof(arguments[0]))a=arguments.length>1?new PearsonGL.Gadget.AudioComponent(this,arguments[0],arguments[1]):new PearsonGL.Gadget.AudioComponent(this,arguments[0]),$(this).data("audio-component",a);else if("string"==typeof arguments[0]){var a=$(this).data("audio-component");if(a&&"function"==typeof a[arguments[0]])return a[arguments[0]].apply(a,Array.prototype.slice.call(arguments,1))}}},function(a){a.fn.richtextcomponent=function(b){var c=this,d={saveText:function(){},highlightingEnabled:!1};b=a.extend(d,b);var e=(b.noTabIndex,b.value?b.value:"");return PearsonGL.utils.hasParmContent()&&(e=PearsonGL.qtiEvaluator.replaceParameters(e)),this.append('<div class="gadget-textblock"><span class="text-audio-component">'+e+"</span></div>"),this.find(".gadget-textblock br").wrap('<div class="br-wrap"></div>'),PearsonGL.utils.hasParmContent()&&PearsonGL.utils.initMathJax(this.find(".gadget-textblock")[0]),this.find("a").click(function(d){d.stopPropagation();var e=c.data().gadget_options,f=e?e.runtimejson.authoring.Domains:b.domains;b.sendAnalytics("clicked_hyperlink"),a.extend(b,{runtimejson:{authoring:{Domains:f}}});var g=a(this),h=g.attr("data-domain"),i=g.attr("data-path"),j=g.attr("target"),k=g.attr("data-popup"),l=PearsonGL.utils.urlResolver(b.runtimejson,h,i);g.attr("href",l),(k||j&&"_new"===j.toLowerCase())&&(d.preventDefault(),PearsonGL.utils.openBrowserPopupWindow(l,"","location=0,menubar=0,scrollbars=1",!0))}).addClass("text-ahref-link"),b.highlightingEnabled&&this.highLighter({saveHighLight:function(){b.saveText()},highlightArea:b.highlightArea}),this}}(jQuery);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.Text=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return c&&a?(e.labelOpts={},e.options=$.extend(!0,{gadgetName:"Text[Rich,Styled]",objectiveDescription:"Text is presented to the user.",value:"",audioComponent:{type:"",src:""}},e.options||{}),e.jObject=$(a),e.jObject.data("gadget_options",e.options),e.initGadget(e.options.gadgetName),e.awardPoints(),PearsonGL.utils.getGlobalizedLabel("text_globalization",function(a){$.extend(e.labelOpts,a),delete c.scorm,$.extend(!0,e.options,c),e.buildDom()},e.options.runtimejson.lang),e):_possibleConstructorReturn(e)}return _inherits(b,a),_createClass(b,[{key:"buildDom",value:function(){var a=this.options.audioComponent;PearsonGL.utils.isNonEmptyString(this.options.value)&&this.jObject.richtextcomponent(this.createRichTextObj(this.options.value,!0)),a&&PearsonGL.utils.isNonEmptyString(a.src)&&(a.labelOpts=this.labelOpts,this.jObject.find(".gadget-textblock .text-audio-component").audioComponent(a))}},{key:"awardPoints",value:function(){var a=1;this.options.scorm&&PearsonGL.utils.isNonEmptyArray(this.options.scorm.interactions)&&PearsonGL.utils.isNonEmptyArray(this.options.scorm.interactions[0].objectives)&&this.options.scorm.interactions[0].objectives[0].score&&(a=this.options.scorm.interactions[0].objectives[0].score.max),this.getLearnerData(),this.setLearnerData({results:[{learnerResponse:"played",correctResponse:"played",raw:a,progressMeasure:1,completionStatus:"completed",successStatus:"passed"}]})}}]),b}(PearsonGL.Gadget.GadgetBase),PearsonGL.Gadget.StyledText=function(a){function b(a,c,d){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d))}return _inherits(b,a),b}(PearsonGL.Gadget.Text),PearsonGL.Gadget.RichText=function(a){function b(a,c,d){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d))}return _inherits(b,a),_createClass(b,[{key:"buildDom",value:function(){var a=this;(PearsonGL.utils.isNonEmptyArray(this.options.paragraph)?this.options.paragraph:[]).forEach(function(b,c){var d=b.audioComponent;a.jObject.richtextcomponent(a.createRichTextObj(b.value,!0));var e=a.jObject.find(".gadget-textblock:last");d&&PearsonGL.utils.isNonEmptyString(d.src)&&(d.labelOpts=a.labelOpts,e.audioComponent(d)),c>0&&e.addClass("p-top-margin")})}}]),b}(PearsonGL.Gadget.Text);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.ComponentImage=function(){function a(b,c){_classCallCheck(this,a),this.options={src:"",dataId:"",scalable:!1,inlineSVG:!1,title:"",longDesc:"",audioComponent:{},mainCaption:[{position:{top:!1},text:{value:""},audioComponent:{}}],figures:[],noTabIndex:!0,protect:!1},this.state={baseImageType:"",loadComplete:!1,inlineSVG:!1,useFigureMarkup:!1,baseFigImgPos:{top:0,left:0},polling:0,imgGTimeout:null,gOrigSize:{}},this.jObject=$(b),this.dataConversion(),this.initialize(b,c)}return _createClass(a,[{key:"dataConversion",value:function(){}},{key:"initialize",value:function(a,b){var c=this;$.extend(!0,this.options,b);var d=this,e=void 0,f="",g=this.options.src,h=this.options.title,i=this.jObject,j=this.options;if(this.state.inlineSVG=j.inlineSVG,PearsonGL.utils.isNonEmptyString(g)){j.noTabIndex&&void 0!==j.noTabIndex?(!1,f=""):(!0,f="tabindex='0'"),(PearsonGL.utils.isNonEmptyString(j.mainCaption[0].text.value)||PearsonGL.utils.isNonEmptyArray(j.figures))&&(this.state.useFigureMarkup=!0);var k=function(a){return!(/<table/i.test(a)||/<ul/i.test(a)||/<ol/i.test(a))},l=function(a){var b=a.querySelector("svg");if(!b)return console.log("SVG NOT FOUND",b);if($(b).attr({role:"img",class:"inline-svg","data-element":j.dataId}),j.inlineSVG&&(PearsonGL.utils.isNonEmptyString(j.title)||PearsonGL.utils.isNonEmptyString(j.longDesc))){var c=document.createElementNS("http://www.w3.org/2000/svg","title"),d=document.createElementNS("http://www.w3.org/2000/svg","desc"),e="svgTitle_"+PearsonGL.utils.randomString(3),f="svgDesc_"+PearsonGL.utils.randomString(3),g="";if(j.longDesc&&k(j.longDesc)){var h=PearsonGL.utils.stripHTML(j.longDesc);d.setAttribute("id",""+f),d.textContent=h,$(b).prepend(d),g+=""+f}j.svgTitle&&(c.setAttribute("id",""+e),c.textContent=j.svgTitle,$(b).prepend(c),g+=" "+e),$(b).attr({"aria-labelledby":""+g})}},m=function(a,b){PearsonGL.utils.browserDetect().specialFlags.isIE?$(b).load(a,function(a,c,d){document.createElementNS("http://www.w3.org/2000/svg",a),b.insertAdjacentHTML("beforeend",a),l(b)}):fetch(a).then(function(a){return a.text()}).then(function(a){b.insertAdjacentHTML("beforeend",a)}).then(function(){l(b)})};if(preloadMainImage=function(a){var b=c,d=c.jObject;if("img"===a||"svg"===a){var e=new Image,f="?"+(new Date).getTime(),g=d.find("img:first");e.src=""+c.options.src+f,$(e).on("load",function(a){a.stopImmediatePropagation(),g.attr("src",e.src),b.state.gOrigSize.width=this.width,b.state.gOrigSize.height=this.height,$(d).trigger("compImageLoaded")}).error(function(a){PearsonGL.logger.log("something went wrong: imgageG",a),d.fadeTo(300,1)})}},PearsonGL.utils.hasParmContent())if(g=PearsonGL.qtiEvaluator.evaluateAsset(g),PearsonGL.utils.isNonEmptyString(h)&&(h=PearsonGL.qtiEvaluator.replaceParameters(h)),/svg/i.test(g))if(/<svg/i.test(g)){e=$("<span class='image-class-wrapper' "+f+">"+g+"</span>");$(e.find("svg")[0])}else/.svg$/i.test(g)&&(e=$("<span class='image-class-wrapper' "+f+"></span>"),j.inlineSVG?m(g,e[0]):e=$("<span class='image-class-wrapper'><img class='image-class' "+f+" src='"+g+"'/></span>"));else e=$("<span class='image-class-wrapper'><img class='image-class' "+f+" src='"+g+"'/></span>");else e=$("<span class='image-class-wrapper'><img class='image-class' "+f+" src='"+g+"'/></span>");if($(e).find("img").attr({alt:h,"data-element":this.options.dataId}),$(e.find("svg")[0]).attr({alt:h,"data-element":this.options.dataId}),this.options.protect&&e.Protector(),this.state.useFigureMarkup){var n="baseFigId_"+PearsonGL.utils.randomString(2),o=$('<figure id="'+n+'" class="base-fig '+(j.scalable?"scalable":"")+'"></figure>');if(/.svg$/i.test(g)?this.state.baseImageType="svg":this.state.baseImageType="img",preloadMainImage(this.state.baseImageType),o.append(e),void 0!==j.audioComponent&&($(o).find(".image-class-wrapper").audioComponent(j.audioComponent),void 0!==j.title&&""!==j.title&&$(o).find(".audioCursor").attr("aria-label",j.title)),j.longDesc&&PearsonGL.utils.isNonEmptyString(j.longDesc)){var p={call:"addLongDescription",selector:$(a),longDesc:j.longDesc};$(a).trigger("componentRequest",p)}if($(a).append(o),PearsonGL.utils.isNonEmptyArray(j.figures)&&this.jObject.find(".base-fig").addClass("image-label"),PearsonGL.utils.isNonEmptyArray(j.figures)){var q=j.figures,r=i.find(".base-fig"),s=void 0,t=void 0,u=void 0;r.attr("role","group");var v=$('<div class="child-fig-wrapper-parent"></div>');r.append(v);var w=$('<div class="child-fig-wrapper" style="position: relative;height:100%;"></div>'),x=r.find(".image-class-wrapper").first();this.state.baseFigImgPos=x.position();parseFloat(this.state.baseFigImgPos.top);v.append(w);q.length;q.forEach(function(b,d){if(s=$('<figure class="child-fig"><div class="caption"></div></figure>'),t="fig_"+d+"_"+PearsonGL.utils.randomString(2),u=s.find(".caption"),u.hide(),s.attr({id:""+t,"data-id":""+t,"data-origcoords":b.y+","+b.x,"data-origwidth":""+b.width}),PearsonGL.utils.isNonEmptyArray(b.images)&&b.images.forEach(function(b,c){var d={src:b.src,title:PearsonGL.utils.isNonEmptyString(b.title)?b.title:"",dataId:t+"_"+c,inlineSVG:b.inlineSVG,longDesc:PearsonGL.utils.isNonEmptyString(b.longDesc)?b.longDesc:"",audioComponent:$.isEmptyObject(b.audioComponent)?{}:b.audioComponent,noTabIndex:!0};s.imagecomponent(d);var e=s.find(".image-class-wrapper");if($.isEmptyObject(b.audioComponent)||(e.audioComponent(b.audioComponent),void 0!==b.title&&""!==b.title&&e.find(".audioCursor").attr("aria-label",b.title)),b.longDesc){var f={call:"addLongDescription",selector:e,longDesc:b.longDesc};$(a).trigger("componentRequest",f)}}),b.figCaption&&!$.isEmptyObject(b.figCaption.text)){var e=b.figCaption.text;u.richtextcomponent(e),$.isEmptyObject(b.figCaption.audioComponent)||u.find(".text-audio-component").audioComponent(b.figCaption.audioComponent),s.append(u),u.show()}else u.remove();var f=function(a,b){var d=c.jObject,e=0;switch(b){case"left":case"width":e=parseFloat(a/d.width()*100).toFixed(3);break;case"top":case"height":e=parseFloat(a/d.height()*100).toFixed(3)}return e};s.css({position:"absolute",top:j.scalable?f(b.y,"top")+"%":b.y+"px",left:j.scalable?f(b.x,"left")+"%":b.x+"px",width:j.scalable?f(b.width,"width")+"%":b.width+"px"}),w.append(s)}),i.fadeTo(0,0)}if(j.mainCaption&&j.mainCaption[0]){var y=j.mainCaption[0],z="baseFigCapId_"+PearsonGL.utils.randomString(2),A=$('<figcaption id="'+z+'" class="caption"></figure>');o.attr("aria-labelledby",""+z),y.position.top?o.prepend(A):o.append(A),y.text&&A.richtextcomponent(y.text),void 0!==y.audioComponent&&A.find(".text-audio-component").audioComponent(y.audioComponent)}$(document).on("compImageLoaded",function(b,c){if(o.closest(".page").is(":visible")){if(j.scalable){var e=function(){return new Promise(function(a,b){clearTimeout(d.state.imgGTimeout),d.state.imgGTimeout=setTimeout(function(){B()},400)})},f=function(){i.find(".child-fig-wrapper").fadeTo(200,1)};if("svg"===d.state.baseImageType&&d.state.inlineSVG){var g=$(a).find(".base-fig .image-class-wrapper svg:first");g&&g.length>0&&(d.state.gOrigSize.width=parseInt($(g).attr("width")),d.state.gOrigSize.height=parseInt($(g).attr("height")),(isNaN(d.state.gOrigSize.width)||isNaN(d.state.gOrigSize.height))&&g&&$(g)[0]&&$(g)[0].viewBox&&(d.state.gOrigSize.width=parseInt($(g)[0].viewBox.baseVal.width),d.state.gOrigSize.height=parseInt($(g)[0].viewBox.baseVal.height)),g.attr("width","100%"),g.attr("height","100%"))}d.state.loadComplete=!0,e().then(f())}else i.addClass("no-scale"),i.css("overflow","visible"),clearTimeout(d.state.imgGTimeout),d.state.imgGTimeout=setTimeout(function(){i.fadeTo(300,1)},400);var h=function(a,b){return a/b*100},k=d.jObject.find(".child-fig-wrapper-parent");d.options.scalable?k.css("padding-bottom",h(d.state.gOrigSize.height,d.state.gOrigSize.width)+"%"):k.css({height:d.state.gOrigSize.height,width:d.state.gOrigSize.width}),C()}});var B=function a(){function b(a){var b=0,c=0,d=void 0;a.find('span[style*="font-size"]').each(function(){(d=$(this)[0].style["font-size"])&&"px"===d.replace(/\d+/g,"")&&(b=parseInt(d),c=.1*b*.652,$(this).css("font-size",c+"em"))})}var d=c,e=$(window).height(),f=i.width(),g=d.state.gOrigSize.height*parseFloat(i.width()/d.state.gOrigSize.width),h=i.find(".child-fig");if(0!==e){if(g>0){var j=i.width()/c.state.gOrigSize.width;i.find(".base-fig .image-class").first(),i.find(".child-fig-wrapper-parent");if(h.length>0){h.each(function(a,b){var d=($(b).width(),$(b).attr("data-origcoords")),e=$(b).attr("data-origwidth");$(b).attr("id");d=d.split(",");var h=d[0],i=d[1],k=c.state.gOrigSize.width,l=c.state.gOrigSize.height,m=g*(parseInt(h)/parseFloat(l)),n=f*(parseInt(i)/parseFloat(k)),o=parseInt(e)*j/(parseFloat(k)*j)*100;$(b).css({top:m+"px",left:n+"px",width:o+"%","font-size":(100*j).toFixed(2)+"%"})});b(i.find(".child-fig .caption"))}}else(g<=0||!g)&&(d.state.polling++,d.state.polling<=100?(clearTimeout(d.state.imgGTimeout),d.state.imgGTimeout=setTimeout(function(){a()},200)):console.log("ImageG - Something went wrong loading the image."));g>0&&d.jObject.fadeTo(300,1)}},C=function(){var a=c;j.scalable&&($(window).on("resize.image",function(b){a.state.loadComplete&&(clearTimeout(a.state.imgGTimeout),B())}),$(window).on("presentation-show-event",function(b){a.jObject.is(":visible")&&a.state.loadComplete&&(clearTimeout(a.state.imgGTimeout),B())}),$(document).on("stepperExpanded",function(b,c){a.jObject.find(".base-fig").hasClass("scalable")&&a.state.loadComplete&&(clearTimeout(a.state.imgGTimeout),B())}))}}else $(a).append(e);$(a).find(".image-class-wrapper").keyup(function(b){if(9===b.keyCode){var c=$(window).height(),d=this,e=$(a).offset();window.scroll(0,e.top-c+$(a).height()+50),$(this).parent().hasClass("stand-alone-image")&&(d=$(this).parent()),PearsonGL.utils.focusItemOn(d)}}).blur(function(){PearsonGL.utils.focusItemOff(this)})}}},{key:"gadgetPageShowEvent",value:function(){this.state.loadComplete&&(clearTimeout(this.state.imgGTimeout),handleWindowResize())}}]),a}(),$.fn.imagecomponent=function(){if("object"===_typeof(arguments[0])||0===arguments.length){var a=new PearsonGL.Gadget.ComponentImage(this,arguments[0]);$(this).data("imagecomponent-component",a)}else if("string"==typeof arguments[0]){var b=$(this).data("imagecomponent-component");if(b&&"function"==typeof b[arguments[0]]){if("function"!=typeof arguments[1])return b[arguments[0]].apply(b,Array.prototype.slice.call(arguments,1));b[arguments[0]]=arguments[1],$(this).data("imagecomponent-component",b)}}};var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.Image=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return c&&a?(e.labelOpts={},e.options=$.extend(!0,{gadgetName:"Image",objectiveDescription:"Image is presented to user.",audioComponent:{type:"toggle",src:""},noTabIndex:!0},e.options||{}),e.state={useFigureMarkup:!1},e.jObject=$(a),e.jObject.data("gadget_options",e.options),e.jObject.addClass("identifier-image"),e.initGadget(e.options.gadgetName),delete c.scorm,$.extend(!0,e.options,c),e.dataConversion(),e.buildDom(),e.getLearnerData({type:"other"}),e.awardPoints(),e):_possibleConstructorReturn(e)}return _inherits(b,a),_createClass(b,[{key:"dataConversion",value:function(){}},{key:"buildDom",value:function(){var a=this.jObject,b=this.options,c={src:b.src,dataId:"base-image",mainCaption:b.mainCaption,scalable:b.scalable,inlineSVG:b.inlineSVG,title:b.title,longDesc:b.longDesc,audioComponent:b.audioComponent,noTabIndex:b.noTabIndex};(b.mainCaption||PearsonGL.utils.isNonEmptyArray(b.figures))&&(this.state.useFigureMarkup=!0),this.state.useFigureMarkup?(c.figures=b.figures,a.imagecomponent(c)):(a.imagecomponent(c),void 0!==b.audioComponent&&(a.find(".image-class-wrapper").audioComponent(b.audioComponent),void 0!==b.title&&""!==b.title&&a.find(".audioCursor").attr("aria-label",b.title)),this.addAccessibility(a),b.longDesc&&PearsonGL.utils.isNonEmptyString(b.longDesc)&&this.addLongDescription(a,b.longDesc)),PearsonGL.utils.initMathJax(a[0])}},{key:"awardPoints",value:function(){var a=1;this.options.scorm&&PearsonGL.utils.isNonEmptyArray(this.options.scorm.interactions)&&PearsonGL.utils.isNonEmptyArray(this.options.scorm.interactions[0].objectives)&&this.options.scorm.interactions[0].objectives[0].score&&(a=this.options.scorm.interactions[0].objectives[0].score.max),this.setLearnerData({results:[{learnerResponse:"played",correctResponse:"played",raw:a,progressMeasure:1,completionStatus:"completed",successStatus:"passed"}]})}},{key:"destroy",value:function(){this.jObject&&(this.jObject.children().remove(),this.jObject.removeClass("identifier-image"))}}]),b}(PearsonGL.Gadget.GadgetBase),function(a){function b(b){var d=this;a(b).keyup(function(b){if(9===b.keyCode&&!c.call(d,a(this))){var e=a(window).height(),f=a(this).offset();window.scroll(0,f.top-e+a(this).height()+50)}})}function c(b){var c=a(window).scrollTop(),d=c+a(window).height(),e=b.offset().top;return e+b.height()<=d&&e>=c}function d(a,b){for(var c=/<([^>\s]*)[^>]*>/g,d=[],e=void 0,f=0,g="";(e=c.exec(a))&&b;){var h=a.substring(f,e.index).substr(0,b);g+=h,b-=h.length,f=c.lastIndex,b&&(g+=e[0],0===e[1].indexOf("/")?d.pop():e[1].lastIndexOf("/")!==e[1].length-1&&d.push(e[1]))}for(g+=a.substr(f,b);d.length;)g+="</"+d.pop()+">";return g}function e(c,e){a(c).keyup(function(b){if(9!==b.keyCode&&37!==b.keyCode&&38!==b.keyCode&&39!==b.keyCode&&40!==b.keyCode){var c=a(this).attr("data-max-length"),f=e.canHighlight?a(this).text():a(this).val();if(f.length>=c){var g=d(a(this).html(),c);e.canHighlight?a(this).html(g):a(this).val(f.substr(0,c))}}}),b.call(this,c)}a.fn.textanswercomponent=function(b){var c={position:"absolute",maxLength:250,top:0,left:0,height:20,value:"",placeholder:""};b=a.extend(c,b);var d=void 0!==b.value?b.value:"",f=PearsonGL.qtiEvaluator.replaceParameters(void 0!==b.placeholder?b.placeholder:""),g=((b.width+"").indexOf("%")>-1?b.width:b.width,b.labelId?b.labelId:"");if(b.canHighlight)b.maxLength=b.maxLength<4e3?b.maxLength:15e3,this.append('<div contenteditable="true" class="custom_textarea" data-max-length="'+b.maxLength+'" data-name="'+b.name+'"></div>'),this.find(".custom_textarea").attr({placeholder:b.placeholder}).css({width:b.width,height:b.height+"px",position:b.position,top:b.top+"px",left:b.left+"px"});else{var h=a("<textarea></textarea>");this.append(h),h.attr({id:g,role:"textbox",placeholder:f,"data-max-length":b.maxLength,"data-name":b.name,class:"sa_text"}).css({position:b.position,width:b.width,height:b.height,top:b.top+"px",left:b.left+"px",resize:"none"}),h.val(d)}return e.call(this,a(".sa_text:last, .custom_textarea:last"),b),this}}(jQuery);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};PearsonGL.Gadget.IframeComponent=function a(b,c){_classCallCheck(this,a),this.options={width:"100%",height:"100%",src:""},$.extend(!0,this.options,c),b.append('<iframe src="'+this.options.src+'" width="'+this.options.width+'" height="'+this.options.height+'"></iframe>')},$.fn.iframecomponent=function(){if(0===arguments.length){var a=new PearsonGL.Gadget.IframeComponent(this);$(this).data("iframe-component",a)}else if("object"===_typeof(arguments[0])){var b=new PearsonGL.Gadget.IframeComponent(this,arguments[0]);$(this).data("iframe-component",b)}else if("string"==typeof arguments[0]){var c=$(this).data("iframe-component");if(c&&"function"==typeof c[arguments[0]])return c[arguments[0]].apply(c,Array.prototype.slice.call(arguments,1))}};var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.ShortAnswer=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return c&&a?(e.labelOpts={checkAnswerText:"Check Answer",closeToolTip:"Close",boldToolTip:"Bold",italicToolTip:"Italic",underlineToolTip:"Underline",unorderedListToolTip:"Unordered List",orderedListToolTip:"Ordered List",black:"Black",purple:"Purple",blue:"Blue",green:"Green",red:"Red",yellow:"Yellow",pink:"Pink",showTextColorMenu:"Show text color menu",hideTextColorMenu:"Hide text color menu",showBackColorMenu:"Show background color menu",hideBackColorMenu:"Hide background color menu"},e.options=$.extend(!0,{gadgetName:"Short Answer",objectiveDescription:"Short essay question is presented to user.",maxLengthText:"Exceeds character limit.",shouldValidateMax:!1,timeOutTime:1e4,savedContent:"",savedIsAnswerLocked:!1,isShowAnswerDialogVisible:!1,isAnswerLocked:!1,textarea:{value:"",height:"",width:"100%",name:"tnam",position:"relative",maxLength:4e3,top:"0",left:"0"},richtext:{paragraph:[{html:"",audioComponent:{src:"",type:""}}]}},e.options||{}),e.colorConfig={foreground:{color0:{color:"#404040",title:e.labelOpts.black},color1:{color:"#760dd3",title:e.labelOpts.purple},color2:{color:"#3074c3",title:e.labelOpts.blue},color3:{color:"#448300",title:e.labelOpts.green},color4:{color:"#db140d",title:e.labelOpts.red}},background:{color0:{color:"#fbea3b",title:e.labelOpts.yellow},color1:{color:"#f797bf",title:e.labelOpts.pink},color2:{color:"#55df49",title:e.labelOpts.green},color3:{color:"#8cc1ff",title:e.labelOpts.blue}}},e.dataConversion(),e.jObject=$(a),e.jObject.data("gadget_options",e.options),e.jObject.addClass("shortanswer-identifier"),e.options.isModePlainText="plaintext"===e.options.textarea.mode&&!e.options.enableTextFormatting,e.options.isModeHighlight="plaintext"===e.options.textarea.mode&&e.options.enableTextFormatting,e.options.isModeMathQuill="mathquill"===e.options.textarea.mode,e.initGadget(e.options.gadgetName),PearsonGL.utils.getGlobalizedLabel("shortAnswer_globalization",function(a){$.extend(e.labelOpts,a),delete c.scorm,$.extend(!0,e.options,c),e.buildDom(),e.getLearnerData({type:"long-fill-in"})},e.options.runtimejson.lang),e):_possibleConstructorReturn(e)}return _inherits(b,a),_createClass(b,[{key:"dataConversion",value:function(){this.options.textarea=this.options.textarea||{},"mathquill"!==this.options.textarea.mode&&"highlight"!==this.options.textarea.mode&&(this.options.textarea.mode="plaintext"),(this.options.textarea.canHighlight||"highlight"===this.options.textarea.mode)&&(this.options.enableTextFormatting=!0,this.options.textarea.mode="plaintext"),delete this.options.textarea.canHighlight}},{key:"_setEvents",value:function(a){var b=this,c=parseInt(a.attr("data-max-length"),10);$("body").bind("click.body",function(){$(".max-length-found").remove(),$($(".max-len-wrapper").children("div")[0]).unwrap()}),a.off("focus"),a.on("focus",function(c){b.sendAnalytics("clicked_text_field"),PearsonGL.utils.setActiveInputField(a),$(window).trigger("inputFocus",{varType:"string"}),setTimeout(function(){a.addClass("shortanswer-focus")},0)}),a.on("blur",function(c){b.saveLearnerData(),setTimeout(function(){a.removeClass("shortanswer-focus")},0)}),a.keyup(function(a){b.options.shouldValidateMax||c!==b.getAnswerLength()||9===a.keyCode||16===a.keyCode||39===a.keyCode||37===a.keyCode||b.showMaxLengthPopup(),b.updateShowSolutionButtonState()})}},{key:"buildDom",value:function(){var a=this,b=this,c=void 0,d=this.options.richtext.paragraph,e=PearsonGL.utils.randomString(),f=this.options.isModePlainText?$('<label class="sa-container"></label>'):$('<div class="sa-container"></div>');f.appendTo(this.jObject);var g=$('<label for="'+e+'"></label>');this.options.isModeMathQuill?g.appendTo(f):g=f;for(var h=0;h<d.length;h++){var i=this.createRichTextObj(d[h].value,!0);g.richtextcomponent(i),void 0!==d[h].audioComponent&&(d[h].audioComponent.labelOpts=this.labelOpts,this.jObject.find(".gadget-textblock:last").audioComponent(d[h].audioComponent))}if(f.append('<div class="textarea-top"/>'),this.options.isModePlainText)f.textanswercomponent(this.options.textarea),c=this.jObject.find(".sa_text"),this._setEvents(c),c.on("input",function(b){a.isDirty=!0});else if(this.options.isModeHighlight)this.buildFormattingDom(f);else if(this.options.isModeMathQuill){var j=$("<div></div>").appendTo(f);j.css({height:this.options.textarea.height+"px",width:this.options.textarea.width}),this.mathQuillComponent=new PearsonGL.Gadget.ComponentMathquill(j,{maxLength:this.options.textarea.maxLength,placeholder:this.options.textarea.placeholder,allowEnterKey:!0,onlySaveSupportedLatex:!0,textAreaId:e,onChange:function(a){b.updateShowSolutionButtonState(),b.isDirty=!0},onFocus:function(a){b.sendAnalytics("clicked_text_field"),j.addClass("shortanswer-focus"),PearsonGL.utils.setActiveInputField(j),$(window).trigger("inputFocus",{varType:"string"})},onBlur:function(a){j.removeClass("shortanswer-focus"),b.saveLearnerData()},hasMaxLengthExceeded:function(a){b.options.shouldValidateMax||b.showMaxLengthPopup()}})}if(f.append('<div class="textarea-bottom"/>'),this.options.showSolutionButton&&this.options.showSolutionButton.length>0){var k=this.options.showSolutionButton[0],l=$('<div class="show-solution-button"></div>').appendTo(this.jObject);l.sliderbutton({buttonText:PearsonGL.utils.isNonEmptyString(k.buttonText)?k.buttonText:this.labelOpts.checkAnswerText,clickFunction:this.showSolutionClickHandler.bind(this)}),l.sliderbutton("disable")}$(window).on("keypadPress",this.handleKeyPadEvent.bind(this))}},{key:"buildFormattingDom",value:function(a){var b=this,c=this.colorConfig.foreground,d=this.colorConfig.background,e=$('\n\t\t\t<div class="controls-area">\n\t\t\t\t<button class="bold-button" title="'+this.labelOpts.boldToolTip+'" aria-label="'+this.labelOpts.boldToolTip+'"></button>\n\t\t\t\t<button class="italic-button" title="'+this.labelOpts.italicToolTip+'" aria-label="'+this.labelOpts.italicToolTip+'"></button>\n\t\t\t\t<button class="underline-button" title="'+this.labelOpts.underlineToolTip+'" aria-label="'+this.labelOpts.underlineToolTip+'"></button>\n\t\t\t\t<button class="fore-color-menu-button" title="'+this.labelOpts.showTextColorMenu+'" aria-label="'+this.labelOpts.showTextColorMenu+'"></button>\n\t\t\t\t<button class="back-color-menu-button" title="'+this.labelOpts.showBackColorMenu+'" aria-label="'+this.labelOpts.showBackColorMenu+'"></button>\n\t\t\t\t<button class="unordered-list-button" title="'+this.labelOpts.unorderedListToolTip+'" aria-label="'+this.labelOpts.unorderedListToolTip+'"></button>\n\t\t\t\t<button class="ordered-list-button" title="'+this.labelOpts.orderedListToolTip+'" aria-label="'+this.labelOpts.orderedListToolTip+'"></button>\n\t\t\t\t<div class="fore-color-menu">\n\t\t\t\t\t<button tabindex="-1" class="text-color-button text-color-button-0" role="menuitemradio" aria-checked="false" data-color="0" title="'+c.color0.title+'" aria-label="'+c.color0.title+'"></button>\n\t\t\t\t\t<button tabindex="-1" class="text-color-button text-color-button-1" role="menuitemradio" aria-checked="false" data-color="1" title="'+c.color1.title+'" aria-label="'+c.color1.title+'"></button>\n\t\t\t\t\t<button tabindex="-1" class="text-color-button text-color-button-2" role="menuitemradio" aria-checked="false" data-color="2" title="'+c.color2.title+'" aria-label="'+c.color2.title+'"></button>\n\t\t\t\t\t<button tabindex="-1" class="text-color-button text-color-button-3" role="menuitemradio" aria-checked="false" data-color="3" title="'+c.color3.title+'" aria-label="'+c.color3.title+'"></button>\n\t\t\t\t\t<button tabindex="-1" class="text-color-button text-color-button-4" role="menuitemradio" aria-checked="false" data-color="4" title="'+c.color4.title+'" aria-label="'+c.color4.title+'"></button>\n\t\t\t\t</div>\n\t\t\t\t<div class="back-color-menu">\n\t\t\t\t\t<button tabindex="-1" class="text-color-button background-color-button-0" role="menuitemradio" aria-checked="false" data-color="0" title="'+d.color0.title+'" aria-label=-"'+d.color0.title+'"></button>\n\t\t\t\t\t<button tabindex="-1" class="text-color-button background-color-button-1" role="menuitemradio" aria-checked="false" data-color="1" title="'+d.color1.title+'" aria-label=-"'+d.color1.title+'"></button>\n\t\t\t\t\t<button tabindex="-1" class="text-color-button background-color-button-2" role="menuitemradio" aria-checked="false" data-color="2" title="'+d.color2.title+'" aria-label=-"'+d.color2.title+'"></button>\n\t\t\t\t\t<button tabindex="-1" class="text-color-button background-color-button-3" role="menuitemradio" aria-checked="false" data-color="3" title="'+d.color3.title+'" aria-label=-"'+d.color3.title+'"></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t').appendTo(a),f=e.find(".bold-button").buttonComponent({type:"icon"}),g=e.find(".italic-button").buttonComponent({type:"icon"}),h=e.find(".underline-button").buttonComponent({type:"icon"}),i=e.find(".fore-color-menu-button").buttonComponent({type:"icon",roleType:"menutoggle"}),j=e.find(".back-color-menu-button").buttonComponent({type:"icon",roleType:"menutoggle"}),k=e.find(".ordered-list-button").buttonComponent({type:"icon"}),l=e.find(".unordered-list-button").buttonComponent({type:"icon"}),m=e.find(".text-color-button");m.each(function(a,b){$(b).buttonComponent({type:"icon",roleType:"menuitemradio"})});var n=$('<div class="answer-area custom_textarea" contenteditable="true" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></div>').appendTo(a);n.css({height:this.options.textarea.height+"px"}),this._setEvents(n),PearsonGL.utils.isNonEmptyString(this.options.textarea.placeholder)&&(n.attr({placeholder:this.options.textarea.placeholder}),n.text(this.options.textarea.placeholder),n.addClass("placeholder")),n.focus(function(){n.hasClass("placeholder")&&(n.text(""),n.removeClass("placeholder"))}),n.blur(function(){""===n.html()&&(n.addClass("placeholder"),n.text(n.attr("placeholder")))}),n.on("mouseup",this.handleMouseUp.bind(this)),n.on("keyup mouseup click touchend",function(){setTimeout(b.updateFormatButtonsState.bind(b),0)}),f.on("click",this.toggleFormatting.bind(this,f,"bold")),g.on("click",this.toggleFormatting.bind(this,g,"italic")),h.on("click",this.toggleFormatting.bind(this,h,"underline")),k.on("click",this.toggleFormatting.bind(this,k,"insertOrderedList")),l.on("click",this.toggleFormatting.bind(this,l,"insertUnorderedList")),e.find(".bold-button, .italic-button, .underline-button, .ordered-list-button, .unordered-list-button").on("mousedown touchstart",function(a){a.preventDefault()}),i.on("click",this.toggleTextColorMenu.bind(this,i,!0)),j.on("click",this.toggleTextColorMenu.bind(this,j,!1)),e.find(".fore-color-menu .text-color-button").on("click",this.toggleColor.bind(this,"foreColor")),e.find(".back-color-menu .text-color-button").on("click",this.toggleColor.bind(this,"backColor")),m.on("keydown",function(a){var c=$(a.currentTarget).closest(".fore-color-menu").length>0,d=b.jObject.find(c?".fore-color-menu-button":".back-color-menu-button");switch(a.which){case PearsonGL.utils.keyCode.down:case PearsonGL.utils.keyCode.right:$(a.currentTarget).next(".text-color-button").focus();break;case PearsonGL.utils.keyCode.up:case PearsonGL.utils.keyCode.left:$(a.currentTarget).prev(".text-color-button").focus();break;case PearsonGL.utils.keyCode.tab:case PearsonGL.utils.keyCode.escape:a.preventDefault(),b.hideMenus(),d.focus()}})}},{key:"handleMouseUp",value:function(){var a="true"===this.jObject.find(".bold-button").attr("aria-pressed"),b="true"===this.jObject.find(".italic-button").attr("aria-pressed"),c="true"===this.jObject.find(".underline-button").attr("aria-pressed"),d=document.queryCommandState("bold"),e=document.queryCommandState("italic"),f=document.queryCommandState("underline");(window.getSelection()+"").length>0&&(a&&!d&&document.execCommand("bold",!1,null),b&&!e&&document.execCommand("italic",!1,null),c&&!f&&document.execCommand("underline",!1,null))}},{key:"toggleFormatting",value:function(a,b,c){var d=this.jObject.find(".answer-area"),e=document.activeElement===d[0],f=document.activeElement===a[0],g=a.hasClass("text-button-focus");if("true"!==a.attr("aria-disabled"))if(c.preventDefault(),this.hideMenus(),e||f)d.focus(),document.execCommand(b,!1,null),this.updateFormatButtonsState(),f&&(a.focus(),g&&a.addClass("text-button-focus"));else{var h="true"===a.attr("aria-pressed");a.buttonComponent(h?"unpress":"press")}}},{key:"updateFormatButtonsState",value:function(){var a=this.jObject.find(".answer-area"),b=this.jObject.find(".fore-color-menu-button"),c=this.jObject.find(".back-color-menu-button"),d=document.queryCommandState("bold"),e=document.queryCommandState("italic"),f=document.queryCommandState("underline"),g=document.queryCommandState("insertOrderedList"),h=document.queryCommandState("insertUnorderedList"),i=window.getSelection(),j=new Set,k=new Set;if(this.jObject.find(".bold-button").buttonComponent(d?"press":"unpress"),this.jObject.find(".italic-button").buttonComponent(e?"press":"unpress"),this.jObject.find(".underline-button").buttonComponent(f?"press":"unpress"),this.jObject.find(".ordered-list-button").buttonComponent(g?"press":"unpress"),this.jObject.find(".unordered-list-button").buttonComponent(h?"press":"unpress"),1===i.rangeCount){var l=i.getRangeAt(0),m=this.findNodes(l.commonAncestorContainer,l.startContainer,l.endContainer),n=new Set;m.forEach(function(a){1===a.nodeType?n.add(a):3===a.nodeType&&n.add(a.parentNode)}),n.forEach(function(b){var c=window.getComputedStyle(b),d=c.getPropertyValue("color"),e=c.getPropertyValue("background-color");d=d.indexOf("rgb")>-1?d=PearsonGL.utils.rgbColorToHex(d):d,e=e.indexOf("rgb")>-1?e=PearsonGL.utils.rgbColorToHex(e):e,j.add(d.toLowerCase()),b!==a[0]&&"#000000"!==e&&k.add(e.toLowerCase())}),b.toggleClass("multi-color",j.size>1),c.toggleClass("multi-color",k.size>1);for(var o=0;o<5;o++){var p=this.colorConfig.foreground["color"+o].color.toLowerCase(),q=j.has(p),r=q&&1===j.size;b.toggleClass("color"+o,r),this.jObject.find(".fore-color-menu .text-color-button-"+o).buttonComponent(r?"press":"unpress")}for(var s=0;s<4;s++){var t=this.colorConfig.background["color"+s].color.toLowerCase(),u=k.has(t),v=u&&1===k.size;c.toggleClass("color"+s,v),this.jObject.find(".back-color-menu .background-color-button-"+s).buttonComponent(v?"press":"unpress")}}}},{key:"findNodes",value:function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if((a===b||d.length>0)&&d.push(a),a===c)return d;for(var e=0;e<a.childNodes.length;e++){var f=a.childNodes[e],g=this.findNodes(f,b,c,d);if(g)return g}}},{key:"toggleTextColorMenu",value:function(a,b,c){var d=this.jObject.find(".controls-area"),e=this.jObject.find(b?".fore-color-menu":".back-color-menu"),f=e.find(".text-color-button").first(),g=b?"fore-color-menu-visible":"back-color-menu-visible",h=d.hasClass(g),i="true"===a.attr("aria-disabled"),j=b?this.labelOpts.hideTextColorMenu:this.labelOpts.hideBackColorMenu;i||(c="boolean"==typeof c?c:!h,this.hideMenus(),c&&(d.addClass(g),a.buttonComponent("press"),a.attr({title:j,"aria-label":j}),a.hasClass("text-button-focus")&&f.addClass("text-button-focus"),f.focus()))}},{key:"toggleColor",value:function(a,b){var c=this.jObject.find(".answer-area"),d=$(b.currentTarget),e="foreColor"===a?this.jObject.find(".fore-color-menu-button"):this.jObject.find(".back-color-menu-button"),f="foreColor"===a?this.jObject.find(".fore-color-menu"):this.jObject.find(".back-color-menu"),g="color"+d.attr("data-color"),h="foreColor"===a?this.colorConfig.foreground[g]:this.colorConfig.background[g],i="true"===d.attr("aria-checked"),j=h.color;f.find(".base-button").each(function(a,b){$(b).buttonComponent("unpress")}),e.removeClass("color0 color1 color2 color3 color4 color5"),e.addClass(g),i||d.buttonComponent("press"),i&&"backColor"===a&&(j="rgba(0, 0, 0, 0)"),c.focus(),document.execCommand(a,!1,j),this.hideMenus()}},{key:"hideMenus",value:function(){var a=this.jObject.find(".fore-color-menu-button"),b=this.jObject.find(".back-color-menu-button");this.jObject.find(".controls-area").removeClass("fore-color-menu-visible back-color-menu-visible"),a.buttonComponent("unpress"),b.buttonComponent("unpress"),a.attr({title:this.labelOpts.showTextColorMenu,"aria-label":this.labelOpts.showTextColorMenu}),b.attr({title:this.labelOpts.showBackColorMenu,"aria-label":this.labelOpts.showBackColorMenu})}},{key:"handleKeyPadEvent",value:function(a){var b=this.getAnswerElement(),c=PearsonGL.utils.getActiveInputField();if(a.keyVal&&c&&c[0]===b[0]&&!this.options.isAnswerLocked){var d=this.getAnswerValue(),e="delete"===a.keyVal,f=e?"":a.keyVal,g=parseInt(b.attr("data-max-length"),10);if(this.options.isModePlainText){var h=b[0].selectionStart,i=b[0].selectionEnd,j=i-h;e&&0===j&&(h=Math.max(0,h-1));var k=d.substring(0,h),l=d.substring(i,d.length),m=h+f.length;!this.options.shouldValidateMax&&d.length-j+f.length>g?this.showMaxLengthPopup():b[0].value=k+f+l,setTimeout(function(){b[0].focus(),b[0].setSelectionRange(m,m)},0)}else if(this.options.isModeHighlight){var n=window.getSelection(),o=n.rangeCount?n.getRangeAt(0):null;if(!o||b[0]!==o.startContainer&&!$.contains(b[0],o.startContainer))return;if($(".highlighter-component").remove(),e)document.execCommand("delete");else if(!this.options.shouldValidateMax&&!b.hasClass("placeholder")&&d.length-o.toString().length+f.length>g)this.showMaxLengthPopup();else if(b.hasClass("placeholder")&&(b.text(""),b.removeClass("placeholder")),document.queryCommandSupported("insertText"))document.execCommand("insertText",!1,f);else{var p=document.createTextNode(f);o.deleteContents(),o.insertNode(p),o.setEndAfter(p),o.collapse(!1)}}else this.options.isModeMathQuill&&this.mathQuillComponent.onKeypressed(a.keyVal);this.updateShowSolutionButtonState();var b=this.getAnswerElement();b.removeClass("shortanswer-focus"),b.blur();var q=this;try{setTimeout(function(){q.jObject.closest(".page").find("."+a.dataId+" .base-button-inside-wrap").focus()},200)}catch(b){PearsonGL.logger.log("Catch the event.dataId error in a keypad button,"+a.dataId+" "+b)}}}},{key:"showSolutionClickHandler",value:function(a,b,c){if(a.options.enable){var d=this,e=this.options.showSolutionButton[0],f=this.jObject.find(".show-solution-button"),g=e.solutionImage||{},h=e.solutionTextAudio||{},i=PearsonGL.utils.isNonEmptyString(g.src),j=e.solutionText;i&&e.solutionImageAudio&&PearsonGL.utils.isNonEmptyString(e.solutionImageAudio.src)&&(g.audioComponent=e.solutionImageAudio),this.jObject.find(".result-pop-up").remove(),this.jObject.dialogcomponent({dialogType:i?"animated":"feedback",doAnimate:!1,closeToolTip:this.labelOpts.closeToolTip,resultsText:j,audioComponent:h,textMessage:{value:j,audioComponent:h},imageComponent:g,dialogHeight:e.dialogHeight,dialogWidth:e.dialogWidth,dialogUnits:"pixels",dialogLayout:e.dialogLayout});var k=this.jObject.find(".result-pop-up");this.options.isShowAnswerDialogVisible=!0,k.draggable("option","scroll",!1),k.show(),k.focus(),setTimeout(function(){f.sliderbutton("disable")},0),k.on("closed",function(){d.options.isShowAnswerDialogVisible=!1,d.updateShowSolutionButtonState(),k.remove()}),e.lockAnswer&&(this.options.isAnswerLocked=!0,this.disableAnswer(),this.saveLearnerData())}}},{key:"getAnswerElement",value:function(){return this.options.isModePlainText?this.jObject.find(".sa_text"):this.options.isModeHighlight?this.jObject.find(".custom_textarea"):this.options.isModeMathQuill?this.jObject.find(".component_mathquill"):void 0}},{key:"getAnswerValue",value:function(a,b){var c=this.getAnswerElement(),d="";return this.options.isModePlainText?d=c.val():this.options.isModeHighlight?d=c.hasClass("placeholder")?"":b?c.html():c.text():this.options.isModeMathQuill&&(d=this.mathQuillComponent.getLatex()),a&&!this.options.isModeMathQuill&&(d=$.trim(d)),d}},{key:"getAnswerLength",value:function(){return this.getAnswerValue(!1,!1).length}},{key:"disableAnswer",value:function(){this.options.isModePlainText?this.jObject.find(".sa_text").attr("disabled",!0).addClass("persist-disabled"):this.options.isModeHighlight?(this.jObject.find(".custom_textarea").removeAttr("contenteditable").addClass("persist-disabled"),this.jObject.find(".controls-area .base-button").attr("aria-disabled",!0)):this.options.isModeMathQuill&&this.mathQuillComponent.disable()}},{key:"updateShowSolutionButtonState",value:function(){if(this.options.showSolutionButton){var a=this.getAnswerLength()>0&&!this.options.isShowAnswerDialogVisible;this.jObject.find(".show-solution-button").sliderbutton(a?"enable":"disable")}}},{key:"showMaxLengthPopup",value:function(){var a=this.getAnswerElement(),b=this.jObject.find(".max-len-wrapper");this.sendAnalytics("trigger_max_character_count"),0===b.length&&(a.wrap("<span class='max-len-wrapper' style='position: relative'></span>"),b=this.jObject.find(".max-len-wrapper")),$(".max-length-found").remove(),b.append('<div tabindex="0" class="max-length-found NO-HIGHLIGHT"><span>'+this.options.maxLengthText+'</span><span class="max-length-pointer"></span></div>');var c=$(".max-length-found").find("span:first").width(),d=a.outerWidth(),e=a.outerHeight(),f=10,g=e+f,h=(d-c)/2;$(".max-length-found").css({position:"absolute",top:g+"px",left:h+"px"}).focus(),window.clearTimeout(this.popuptimeout),window.setTimeout(function(){var b=$(window).height(),c=50,d=a.offset();b-c+window.scrollY<d.top&&window.scroll(0,d.top-b+a.height()+c)},100),this.popuptimeout=window.setTimeout(function(){$(".max-length-found").remove(),$($(".max-len-wrapper").children("div")[0]).unwrap()},this.options.timeOutTime)}},{key:"sendCumulativeAnalytics",value:function(){this.sendAnalytics("content_field_character_count",this.getAnswerLength())}},{key:"parseLearnerData",value:function(){var a=this.options.scorm,b=this.getAnswerElement();a.suspendData&&a.suspendData.data&&(this.options.isAnswerLocked=!!a.suspendData.data.isAnswerLocked,this.options.savedIsAnswerLocked=this.options.isAnswerLocked,this.options.isModeHighlight&&PearsonGL.utils.isNonEmptyString(a.suspendData.data.formattedText)&&(this.options.savedContent=a.suspendData.data.formattedText,b.html(a.suspendData.data.formattedText),b.removeClass("placeholder")),this.options.isAnswerLocked&&this.disableAnswer()),PearsonGL.utils.isNonEmptyArray(a.interactions)&&a.interactions[0].learner_response&&a.interactions[0].learner_response.text&&(this.options.isModePlainText?(b.val(a.interactions[0].learner_response.text),this.options.savedContent=a.interactions[0].learner_response.text):this.options.isModeMathQuill&&(this.mathQuillComponent.setLatex(a.interactions[0].learner_response.text),this.options.savedContent=a.interactions[0].learner_response.text)),this.updateShowSolutionButtonState()}},{key:"gadgetUnload",value:function(){this.saveLearnerData()}},{key:"saveIfNeeded",value:function(){this.saveLearnerData(),this.isDirty=!1}},{key:"saveLearnerData",value:function(){var a=this;if(this.isCommEnabled()){var b=[],c=this.getAnswerValue(!0,!1),d=this.options.isModeHighlight?this.getAnswerValue(!0,!0):c;this.options.savedContent===d&&this.options.savedIsAnswerLocked===this.options.isAnswerLocked||(this.options.savedContent=d,this.options.savedIsAnswerLocked=this.options.isAnswerLocked,this.options.scorm.suspendData&&(this.options.scorm.suspendData.data={isAnswerLocked:this.options.isAnswerLocked,formattedText:this.options.isModeHighlight?d:void 0}),this.options.scorm.interactions.forEach(function(d){b.push(a.getResult(d.objectives[0],c))}),this.setLearnerData({gadgetId:this.gadgetUniqueId,data:this.options.scorm,results:b}))}}},{key:"getResult",value:function(a,b){var c={};return c.raw=""===b?0:a.score.max,c.min=a.score.min,c.max=a.score.max,c.scaled=c.max===c.min?1:(c.raw-c.min)/(c.max-c.min),c.learnerResponse={text:b},c.correctResponses=[],c.successStatus=c.scaled>PearsonGL.globals.comm.getPassingScore()?"passed":"unknown",c.completionStatus=this.getObjectiveCompletionStatus(a,b),c.progressMeasure=1,c}},{key:"getObjectiveCompletionStatus",value:function(a,b){return b.length>0?"completed":"incomplete"}}]),b}(PearsonGL.Gadget.GadgetBase);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.GraphicOrganizer=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));if(!c||!a)return _possibleConstructorReturn(e);if(e.labelOpts={},e.options=$.extend(!0,{gadgetName:"Graphic Organizer",objectiveDescription:"Organizer is presented to user to fill in. This may include one or more text fill in areas.",content_array:[],focusedField:"",maxLengthText:"Exceeds character limit.",shouldValidateMax:!1,timeOutTime:1e4,numberOfInputs:0,textblocks:[{paragraph:[{value:"",audioComponent:{type:"",src:""}}]}],boundX:0,boundY:0},e.options||{}),c.maxLengthText&&(c.maxLengthText=PearsonGL.qtiEvaluator.replaceParameters(c.maxLengthText)),c.image&&(c.image.src&&(c.image.src=PearsonGL.qtiEvaluator.replaceParameters(c.image.src)),c.image.title&&(c.image.title=PearsonGL.qtiEvaluator.replaceParameters(c.image.title)),c.image.longDesc&&(c.image.longDesc=PearsonGL.qtiEvaluator.replaceParameters(c.image.longDesc))),c.groups)for(var f=0;f<c.groups.length;f++)for(var g=0;g<c.groups[f].shortanswer.length;g++)c.groups[f].shortanswer[g].placeholder&&(c.groups[f].shortanswer[g].placeholder=PearsonGL.qtiEvaluator.replaceParameters(c.groups[f].shortanswer[g].placeholder)),c.groups[f].shortanswer[g].left=parseInt(PearsonGL.qtiEvaluator.replaceParameters(c.groups[f].shortanswer[g].left.toString())),c.groups[f].shortanswer[g].top=parseInt(PearsonGL.qtiEvaluator.replaceParameters(c.groups[f].shortanswer[g].top.toString())),c.groups[f].shortanswer[g].width=parseInt(PearsonGL.qtiEvaluator.replaceParameters(c.groups[f].shortanswer[g].width.toString())),c.groups[f].shortanswer[g].height=parseInt(PearsonGL.qtiEvaluator.replaceParameters(c.groups[f].shortanswer[g].height.toString())),c.groups[f].shortanswer[g].maxLength=parseInt(PearsonGL.qtiEvaluator.replaceParameters(c.groups[f].shortanswer[g].maxLength.toString()));if(c.textLabels)for(var h=0;h<c.textLabels.length;h++)c.textLabels[h].labelX=parseInt(PearsonGL.qtiEvaluator.replaceParameters(c.textLabels[h].labelX.toString())),c.textLabels[h].labelY=parseInt(PearsonGL.qtiEvaluator.replaceParameters(c.textLabels[h].labelY.toString())),c.textLabels[h].width&&(c.textLabels[h].width=parseInt(PearsonGL.qtiEvaluator.replaceParameters(c.textLabels[h].width.toString())));if(c.imageLabels)for(var i=0;i<c.imageLabels.length;i++)c.imageLabels[i].labelX=parseInt(PearsonGL.qtiEvaluator.replaceParameters(c.imageLabels[i].labelX.toString())),c.imageLabels[i].labelY=parseInt(PearsonGL.qtiEvaluator.replaceParameters(c.imageLabels[i].labelY.toString()));return e.jObject=$(a),e.jObject.data("gadget_options",e.options),e.jObject.addClass("graphicorganizer-identifier"),e.initGadget(e.options.gadgetName),PearsonGL.utils.getGlobalizedLabel("go_globalization",function(a){$.extend(e.labelOpts,a),delete c.scorm,$.extend(!0,e.options,c),e.buildDom(),e.getLearnerData({type:"fill-in"})},e.options.runtimejson.lang),e}return _inherits(b,a),_createClass(b,[{key:"buildDom",value:function(){var a=this;this.options.disableKeyboardOnMobile=this.options.runtimejson.disableKeyboardOnMobile,this.jObject.append('<div class="img"></div>');var b=this,c=0,d=[],e=[],f=0,g=0,h=this.options.groups,i=void 0,j=void 0,k=this.options.groups.length,l=void 0,m=0,n=this.jObject,o=void 0;if(void 0!==this.options.imageLabels&&(d=this.options.imageLabels,g=d.length),void 0!==this.options.textLabels&&(e=this.options.textLabels,f=e.length),void 0==h[0].shortanswer[0].readorder){for(j=0;j<f;j++)o=e[j].width?"width:"+e[j].width+"px;":"",n.append('<div data-id="richtext_'+this.gadgetUniqueId+"-"+m+'" class="richtext group-label" style="position:absolute;top:'+e[j].labelY+"px;left:"+e[j].labelX+"px;"+o+'" >'),n.find("[data-id=richtext_"+this.gadgetUniqueId+"-"+m+"]").richtextcomponent(this.createRichTextObj(e[j].labelText.value)),void 0!==e[j].labelText.audioComponent&&""!==e[j].labelText.audioComponent.src&&(l=n.find("[data-id=richtext_"+this.gadgetUniqueId+"-"+m+"]"),e[j].labelText.audioComponent.labelOpts=this.labelOpts,l.find(".gadget-textblock").audioComponent(e[j].labelText.audioComponent)),m++;for(j=0;j<g;j++)n.append('<div data-id="richtext_'+this.gadgetUniqueId+"-"+m+'" class="richtext" style="position:absolute;top:'+d[j].labelY+"px;left:"+d[j].labelX+'px;">'),n.find("[data-id=richtext_"+this.gadgetUniqueId+"-"+m+"]").imagecomponent(d[j].labelImage),void 0!==d[j].labelImage.audioComponent&&""!==d[j].labelImage.audioComponent.src&&(l=n.find("[data-id=richtext_"+this.gadgetUniqueId+"-"+m+"]"),d[j].labelImage.audioComponent.labelOpts=this.labelOpts,l.find("span").audioComponent(d[j].labelImage.audioComponent),l.find("p").css("float","left")),m++;for(n.append('<div class="sa"></div>'),this.mqcomp=[],j=0;j<k;j++){var p=h[j].shortanswer,q=h[j].groupName;if(q||(q="Group "+j),this.options.numberOfInputs+=p.length,void 0!==p){n.find(".sa").append('<span data-id="group_'+this.gadgetUniqueId+"-"+j+'"></span>');var r=n.find("[data-id=group_"+this.gadgetUniqueId+"-"+j+"]");for(i=0;i<p.length;i+=1){var s=p[i];s.mathquill?function(){var d=$("<span></span>").attr({"data-index":c,"data-max-length":s.maxLength?s.maxLength:"250"});d.addClass("sa_text"),d.css({width:s.width?s.width:"",height:s.height?s.height+"px":"",position:"absolute",top:s.top?s.top+"px":"0px",left:s.left?s.left+"px":"0px"}),r.append(d);var e=a;s.onFocus=function(a){var b=a.jObject;e.activeInputField=b.attr("data-index"),PearsonGL.utils.setActiveInputField(b),$(window).trigger({type:"inputFocus"})},s.onBlur=function(a){b.isCommEnabled()&&a.getLatex().length>0&&e.hasLoaded&&e.saveLearnerData()},s.hasMaxLengthExceeded=function(a){e.options.shouldValidateMax||e.showMaxCharMessage(a.jObject)},s.onChange=function(a){},s.allowEnterKey=!0,a.mqcomp[c]=new PearsonGL.Gadget.ComponentMathquill(d,s)}():(r.textanswercomponent(s),r.find("textarea:last").attr({"data-index":c}),r.find("textarea:last").attr("aria-placeholder",s.placeholder),r.find("textarea:last").attr("aria-label",q),r.find("textarea:last").attr("data-group","group_"+this.gadgetUniqueId+"-"+j),b.onBlur(r.find("textarea:last")),b.onFocus(r.find("textarea:last")),b.onKeyUp(r.find("textarea:last"))),c+=1}}void 0!==h[j].scorm&&this.options.scorm.interactions.push(h[j].scorm.interactions[0]),n.find(".image-class-wrapper").focus()}this.hasLoaded=!0,$(window).on("keypadPress",function(a){a.keyVal&&b._addKeypadValue(a)}),this.options.image.noTabIndex=!1,n.find(".img").imagecomponent(this.options.image),n.find(".image-class").attr("style","z-index:0;position:relative;"),this.addLongDescription(n.find(".img"),this.options.image.longDesc),this.addAccessibility(n),n.keyup(function(a){if(9===a.keyCode){var c=$(window).height(),d=$(b.options.focusedField).offset();window.scroll(0,d.top-c+$(b.options.focusedField).height()+50)}}),this.options.disableKeyboardOnMobile&&this.isTouchDevice}else{this.mqcomp=[];for(var t=e.concat(d),u=[],v=0;v<h.length;v++){var w=h[v].groupName;w||(w="Group "+v),void 0!==h[v].scorm&&this.options.scorm.interactions.push(h[v].scorm.interactions[0]);for(var x=0;x<h[v].shortanswer.length;x++)h[v].shortanswer[x].groupId=v,h[v].shortanswer[x].index=c,u.push(h[v].shortanswer[x]),c++}this.options.numberOfInputs=u.length;var y=t.concat(u);y.sort(function(a,b){return a.readorder-b.readorder});for(var z=0;z<y.length;z++)if(void 0!==y[z].labelX){var A=y[z];void 0!==A.labelImage?void 0!==A.readorder&&z<y.length-1&&A.readorder==y[z+1].readorder?(n.append('<label for="'+this.gadgetUniqueId+"-go_input-"+y[z+1].index+'" class="richtext" style="position:absolute;top:'+A.labelY+"px;left:"+A.labelX+'px;"></label>'),n.find("label:last").imagecomponent(A.labelImage)):(n.append('<div data-id="richtext_'+this.gadgetUniqueId+"-"+m+'" class="richtext" style="position:absolute;top:'+A.labelY+"px;left:"+A.labelX+'px;">'),n.find("[data-id=richtext_"+this.gadgetUniqueId+"-"+m+"]").imagecomponent(A.labelImage),void 0!==A.labelImage.audioComponent&&""!==A.labelImage.audioComponent.src&&(l=n.find("[data-id=richtext_"+this.gadgetUniqueId+"-"+m+"]"),A.labelImage.audioComponent.labelOpts=this.labelOpts,l.find("span").audioComponent(A.labelImage.audioComponent),l.find("p").css("float","left"))):(o=A.width?"width:"+A.width+"px;":"",void 0!==A.readorder&&z<y.length-1&&A.readorder==y[z+1].readorder?n.append('<label for="'+this.gadgetUniqueId+"-go_input-"+y[z+1].index+'" class="richtext group-label" style="position:absolute;top:'+A.labelY+"px;left:"+A.labelX+"px;"+o+'" >'+A.labelText.value+"</label>"):(n.append('<div data-id="richtext_'+this.gadgetUniqueId+"-"+m+'" class="richtext group-label" style="position:absolute;top:'+A.labelY+"px;left:"+A.labelX+"px;"+o+'" >'),n.find("[data-id=richtext_"+this.gadgetUniqueId+"-"+m+"]").richtextcomponent(this.createRichTextObj(A.labelText.value)),void 0!==A.labelText.audioComponent&&""!==A.labelText.audioComponent.src&&(l=n.find("[data-id=richtext_"+this.gadgetUniqueId+"-"+m+"]"),A.labelText.audioComponent.labelOpts=this.labelOpts,l.find(".gadget-textblock").audioComponent(A.labelText.audioComponent)))),m++}else{var B=y[z];B.mathquill?function(){var c=$("<span></span>").attr({"data-index":B.index,"data-max-length":B.maxLength?B.maxLength:"250"});c.addClass("sa_text"),c.css({width:B.width?B.width:"",height:B.height?B.height+"px":"",position:"absolute",top:B.top?B.top+"px":"0px",left:B.left?B.left+"px":"0px"}),c.attr({id:a.gadgetUniqueId+"-go_input-"+B.index}),c.attr({"data-readorder":B.readorder}),n.append(c);var d=a;B.onFocus=function(a){var b=a.jObject;d.activeInputField=b.attr("data-index"),PearsonGL.utils.setActiveInputField(b),$(window).trigger({type:"inputFocus"})},B.onBlur=function(a){b.isCommEnabled()&&a.getLatex().length>0&&d.hasLoaded&&d.saveLearnerData()},B.hasMaxLengthExceeded=function(a){d.options.shouldValidateMax||d.showMaxCharMessage(a.jObject)},B.onChange=function(a){},B.allowEnterKey=!0,a.mqcomp[B.index]=new PearsonGL.Gadget.ComponentMathquill(c,B)}():(n.textanswercomponent(B),n.find("textarea:last").attr({id:this.gadgetUniqueId+"-go_input-"+B.index}),n.find("textarea:last").attr({"data-index":B.index}),n.find("textarea:last").attr({"data-readorder":B.readorder}),n.find("textarea:last").attr({"data-group":"group_"+this.gadgetUniqueId+"-"+B.groupId}),n.find("textarea:last").attr({"aria-placeholder":B.placeholder}),b.onBlur(n.find("textarea:last")),b.onFocus(n.find("textarea:last")),b.onKeyUp(n.find("textarea:last")))}n.find(".image-class-wrapper").focus(),this.hasLoaded=!0,$(window).on("keypadPress",function(a){a.keyVal&&b._addKeypadValue(a)}),this.options.image.noTabIndex=!0,n.find(".img").imagecomponent(this.options.image),n.find(".image-class").attr("style","z-index:0;position:relative;").attr("tabindex","0"),this.addLongDescription(n.find(".img"),this.options.image.longDesc),this.addAccessibility(n),n.keyup(function(a){if(9===a.keyCode){var c=$(window).height(),d=$(b.options.focusedField).offset();window.scroll(0,d.top-c+$(b.options.focusedField).height()+50)}}),this.options.disableKeyboardOnMobile&&this.isTouchDevice}$(".image-class").blur(function(){$(this).parent().removeClass("text-button-focus")}),this.constructBounds()}},{key:"constructBounds",value:function(){function a(){f!==e?window.setTimeout(a,10):c.jObject.css({width:c.options.boundX,height:c.options.boundY})}for(var b=this,c=this,d=this.jObject.find(".sa_text, .richtext"),e=1,f=0,g=function(a){var g=$(d[a]),h=g.position(),i=g.outerWidth(),j=g.outerHeight();0!==g.find("img").length?(e++,$(g.find("img")[0]).on("load",function(){var a=$(g.find("img")[0]),b=a.outerWidth(),d=a.outerHeight();h.left+b>c.options.boundX&&(c.options.boundX=h.left+b),h.top+d>c.options.boundY&&(c.options.boundY=h.top+d),f++})):(h.left+i>b.options.boundX&&(b.options.boundX=h.left+i),h.top+j>b.options.boundY&&(b.options.boundY=h.top+j))},h=0;h<d.length;h++)g(h);var i=$(this.jObject.find("div.img")[0]);$(i.find("img")).on("load",function(){var b=$(i.find("img")),d=b.outerWidth(),e=b.outerHeight();c.options.boundX<d&&(c.options.boundX=d),c.options.boundY<e&&(c.options.boundY=e),f++,a()})}},{key:"onBlur",value:function(a){var b=this;$(a).unbind("blur").blur(function(c){if($(this).removeClass("shortanswer-focus"),b.isCommEnabled())try{var d=b.options.content_array,e=$(a).attr("data-index"),f=$(a).val().trim();d[e]===f||$(a).hasClass("placeholder")||(b.hasLoaded&&b.saveLearnerData(),d[e]=f)}catch(a){PearsonGL.logger.error(a)}})}},{key:"onKeyUp",value:function(a){var b=this,c=parseInt($(a).attr("data-max-length"),10);$("body").bind("click.body",function(){$(".max-length-found").unwrap().remove()}),$(a).keyup(function(a){b.options.shouldValidateMax||c!==$(this).val().length||9===a.keyCode||16===a.keyCode||39===a.keyCode||37===a.keyCode||b.showMaxCharMessage($(this)),b.isDirty=!0})}},{key:"onFocus",value:function(a){var b=this;$(a).unbind("focus").focus(function(c){b.options.focusedField=a,$(this).addClass("shortanswer-focus"),b.activeInputField=$(this).attr("data-index"),PearsonGL.utils.setActiveInputField($(this)),$(window).trigger({type:"inputFocus"})})}},{key:"parseLearnerData",value:function(){var a=this.options.scorm.interactions,b=void 0,c=void 0,d=a.length;for(b=0;b<d;b++){for(a[b].groupId="group_"+this.gadgetUniqueId+"-"+b,c=0;c<a[b].objectives.length;c++)a[b].objectives[c].groupId="group_"+this.gadgetUniqueId+"-"+b;this.setLearner_response(a[b].learner_response)}}},{key:"setLearner_response",value:function(a){var b=this;if(a.words){var c=a.words,d=this.jObject.find(".sa_text"),e=void 0,f=void 0;$.each(d,function(a,d){if(e=$(this).attr("data-index"),void 0==(f=c[e]))return!0;if($(this).hasClass("component_mathquill")){var g=$(this).attr("data-index");b.mqcomp[g].setLatex(f)}else $(this).val(f),""!==f.trim()&&$(this).removeClass("placeholder")})}}},{key:"learner_response",value:function(){var a=$(this.jObject).find(".sa_text"),b=void 0,c=[],d=void 0,e=void 0,f=a.length;for(b=0;b<f;b+=1){if(d=a[b],$(d).hasClass("component_mathquill")){var g=$(d).attr("data-index");e="",this.mqcomp[g].getLatex().length>0&&(e=this.mqcomp[g].getLatex())}else e=$(d).val(),$(d).hasClass("placeholder")&&(e="");c.push(e)}return{words:c}}},{key:"saveLearnerData",value:function(){if(this.isCommEnabled()){var a=void 0,b=[];for(this.options.scorm.suspendData.data=this.scormData,a=0;a<this.options.scorm.interactions.length;a++)result=this.getResult(this.options.scorm.interactions[a].objectives[0]),result.learnerResponse=this.learner_response(),result.correctResponses=[],b.push(result);this.setLearnerData({gadgetId:this.gadgetUniqueId,data:this.options.scorm,results:b}),this.isDirty=!1}}},{key:"saveIfNeeded",value:function(){this.saveLearnerData()}},{key:"gadgetUnload",value:function(){if(this.isCommEnabled()){var a=this.options.focusedField,b=this.options.content_array,c=$(a).attr("data-index"),d=$(a).val()?$(a).val().trim():"";b[c]!==d&&(this.saveLearnerData(),b[c]=d)}}},{key:"sendCumulativeAnalytics",value:function(){var a=0,b=0;this.jObject.find("textarea").each(function(c,d){a++,$(d)[0].value.length>0&&b++}),this.sendAnalytics("clicked_content_field_"+b+"of"+a)}},{key:"_addKeypadValue",value:function(a){var b=this.jObject.find('[data-index="'+this.activeInputField+'"]'),c=a.keyVal;if(b.hasClass("component_mathquill")&&b[0]===PearsonGL.utils.getActiveInputField()[0]&&"disabled"!=b.attr("disabled"))this.mqcomp[this.activeInputField].onKeypressed(c);else if(b[0]===PearsonGL.utils.getActiveInputField()[0]&&"disabled"!=b.attr("disabled")){this.caret=b[0].selectionStart,void 0===this.caret&&(this.caret=0);var d=b.val(),e=PearsonGL.utils.actionOnActiveInputField(c,d,this.caret);this.caret=e.caret,b.val(e.value),b.val().length>0?b.removeClass("placeholder"):b.addClass("placeholder"),window.setTimeout(function(){b[0].setSelectionRange(this.caret,this.caret)},0)}}},{key:"showMaxCharMessage",value:function(a){parseInt($(a).attr("data-max-length"),10);this.sendAnalytics("trigger_max_char_count"),$(".max-length-found").unwrap().remove(),$(a).wrap('<span class="max-len-wrapper"></span>').parent().append('<div tabindex="0" class="max-length-found"><span>'+this.options.maxLengthText+'</span><span class="max-length-pointer"></span></div>');var b=$(a).closest(".graphicorganizer-identifier"),c=$($(a).siblings(".max-length-found")[0]);c.focus(),PearsonGL.utils.smartTooltip(a,b,c),window.clearTimeout(this.popuptimeout),this.popuptimeout=window.setTimeout(function(){$(a).parent(".max-len-wrapper").length>0&&($(".max-length-found").unwrap().remove(),$(a).focus())},this.options.timeOutTime)}},{key:"getResult",value:function(a){var b={};try{var c=$(this.jObject).find(".sa_text[data-id="+a.groupId+"]"),d=0,e=void 0,f=void 0;for(f=0;f<c.length;f+=1)if(e=c[f],$(e).hasClass("component_mathquill")){var g=$(e).attr("data-index");this.mqcomp[g].getLatex().length>0&&(d+=1)}else""===$(e).val().trim()||$(e).hasClass("placeholder")||(d+=1);a.score.max!==a.score.raw&&(b.raw=parseFloat(a.score.max)*(d/c.length)),b.min=parseFloat(a.score.min),b.max=parseFloat(a.score.max),b.max-b.min!=0?b.scaled=(b.raw-b.min)/(b.max-b.min):b.scaled=1,b.successStatus="failed",a.score=b,"passed"!==a.success_status&&(a.success_status="unknown",b.successStatus="unknown"),parseFloat(a.score.scaled)>=PearsonGL.globals.comm.getPassingScore()&&(a.success_status="passed",b.successStatus="passed"),a.completion_status=this.completion_status(a),b.completionStatus=a.completion_status,a.progress_measure=1,b.progressMeasure=1}catch(a){}return!0===this.giveAllPoints&&(a.score.raw=a.score.max,a.success_status="passed",b.raw=a.score.max,b.successStatus="passed"),b.result=b.scaled,b}},{key:"completion_status",value:function(a){var b=$(this.jObject).find(".sa_text[data-id="+a.groupId+"]"),c=void 0,d=b.length;for(c=0;c<b.length;c+=1)if(currTextBox=b[c],$(currTextBox).hasClass("component_mathquill")){var e=$(currTextBox).attr("data-index");0==this.mqcomp[e].getLatex().length&&d--}else(""===$(currTextBox).val().trim()||$(currTextBox).hasClass("placeholder"))&&d--;return d>=b.length*a.completionThreshold?"completed":"incomplete"}}]),b}(PearsonGL.Gadget.GadgetBase);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},window.Gadget=window.Gadget||{},PearsonGL.Gadget.Reveal=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return e.labelOpts={},e.RevealOpenCnt=0,$.extend(e.options,{gadgetName:"Reveal",objectiveDescription:"User clicks a button to reveal content.",startingState:"default",button:{id:0,buttonClassName:"reveal",buttonHideText:"",buttonText:""}}),c&&a?(c.image&&(c.image.src&&(c.image.src=PearsonGL.qtiEvaluator.evaluateAsset(c.image.src)),c.image.longDesc&&(c.image.longDesc=PearsonGL.qtiEvaluator.replaceParameters(c.image.longDesc))),c.ariaLivePolitenessSetting="off",c.richtext&&c.richtext.ariaLiveAutoRead&&(c.ariaLivePolitenessSetting="polite"),e.jObject=$(a),e.revealObj=$(a),e.initialize(c),e):_possibleConstructorReturn(e)}return _inherits(b,a),_createClass(b,[{key:"initialize",value:function(a){var b=this;this.initGadget(this.options.gadgetName),this.jObject.data("gadget_options",this.options),PearsonGL.utils.getGlobalizedLabel("reveal_globalization",function(c){$.extend(b.labelOpts,c),delete a.scorm,$.extend(!0,b.options,a),b._globalizationComplete()},this.options.runtimejson.lang)}},{key:"_globalizationComplete",value:function(){var a=Math.floor(1e3*Math.random()),b=this,c=void 0,d=void 0;this.buttonDefer=new $.Deferred,this.buildEffectDivDefer=new $.Deferred,$.when(b.buildEffectDivDefer,b.buttonDefer).then(function(){b.startingStateDefiner()}),this.options.button.id="r_"+a,this.revealObj.addClass("reveal-identifier"),this.revealObj.prepend('<div class="aria-live-region hidden-label" aria-live="assertive" aria-atomic="true"></div>'),this.revealObj.append('<div class="toggler toggler_'+a+'"><div class="slit"><span class="leftBG"></span><span class="centerBG"></span><span class="rightBG"></span></div></div>');var e=this.options.button,f=this.revealObj.find(".toggler_"+a).attr("id","toggler_"+e.id);this.buildEffectDiv(f,this.options),this.revealObj.append('<div type="button" class="reveal-button-wrapper"></div>'),d=$(this.revealObj).find(".reveal-button-wrapper"),e.clickFunction=function(a){b.toggleMe(a.jObject)},d.sliderbutton(e),c=d.find(".button-text"),d.keyup(function(a){a.keyCode===PearsonGL.utils.keyCode.tab&&(PearsonGL.utils.focusItemOn(c),b._windowScroller(a.target))}).keydown(function(a){a.keyCode!==PearsonGL.utils.keyCode.enter&&a.keyCode!==PearsonGL.utils.keyCode.space||b.toggleMe(buttonObj.jObject)}),this.addAccessibility(this.revealObj),this.getLearnerData(),b.buttonDefer.resolve()}},{key:"_windowScroller",value:function(a){window.setTimeout(function(){if($(a).length>0){var b=$(window).height(),c=50,d=$(a).offset();b-c+window.scrollY<d.top&&window.scroll(0,d.top-b+$(a).height()+c)}},100)}},{key:"startingStateDefiner",value:function(){"animateOnLaunch"==this.options.startingState&&this.toggleMe(this.jObject.find(".reveal-button-wrapper"))}},{key:"buildEffectDiv",value:function(a,b){var c=this,d=b.richtext.paragraph,e=0;if(a.append('<div class="effect reveal-closed" aria-hidden="true" style="z-index:1;position:relative;"></div>'),void 0!==d){var f=$(a).find(".effect");for(e=0;e<d.length;e++)f.richtextcomponent(this.createRichTextObj(d[e].value)),f.find(".gadget-textblock").hide(),void 0!==d[e].audioComponent&&""!==d[e].audioComponent.src&&(d[e].audioComponent.labelOpts=this.labelOpts,$(a).find(".effect .gadget-textblock:last").audioComponent(d[e].audioComponent));this.imgHeight=0,this.imgWidth=0,f.imagecomponent(b.image),f.find("img").attr("style","max-width:100%;"),f.find(".image-class-wrapper").hide(),void 0!==b.image.audioComponent&&""!==b.image.audioComponent.src&&(b.image.audioComponent.labelOpts=this.labelOpts,$(a).find(".image-class-wrapper").audioComponent(b.image.audioComponent)),"top"===this.options.image.imagePosition&&f.find(".image-class-wrapper").insertBefore(f.find(".gadget-textblock")),this.addLongDescription($(this.revealObj).find(".image-class-wrapper"),this.options.image.longDesc)}if(this.jObject.find(".effect").wrapInner('<div class="effect-wrapper"></div>'),b.image&&b.image.src){var g=new Image;g.onload=function(){c.imgHeight=g.height,c.imgWidth=g.width,c.buildEffectDivDefer.resolve()},g.src=b.image.src}else this.buildEffectDivDefer.resolve()}},{key:"getInternetExplorerVersion",value:function(){var a=-1;if("Microsoft Internet Explorer"==navigator.appName){var b=navigator.userAgent;null!==new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(b)&&(a=parseFloat(RegExp.$1))}return a}},{key:"checkVersion",value:function(){var a=this.getInternetExplorerVersion();if(a>-1)return!(a>=8)}},{key:"toggleMe",value:function(a){var b=this,c=this.options.button,d=this.revealObj.find("#toggler_"+c.id).find(".effect"),e=0,f=this.checkVersion(),g=this.revealObj;if(this.hasSetScormData||(this.saveLearnerData(),this.hasSetScormData=!0),d.find(".gadget-textblock").length>0&&!Number(this.options.fixedHeight)>0){var h,i,j=d.find(".gadget-textblock");for(i=0;i<j.length;i++)h=f?50:20,e+=$(j[i]).outerHeight()+h;var k=d.find(".effect-wrapper");this.imgWidth>this.jObject.width()?e+=this.imgHeight/this.imgWidth*this.jObject.width()+10+parseInt(k.css("margin-top"))+parseInt(k.css("margin-bottom")):e+=d.find(".image-class-wrapper").outerHeight()+10+parseInt(k.css("margin-top"))+parseInt(k.css("margin-bottom"))}else e=Number(this.options.fixedHeight);var l,m,n,o=g.find("#toggler_"+c.id),p=$(o).parent().find(".button-text"),q=$(o).parent().find(".reveal-button-left");d.attr({id:"toggler_effect_"+c.id,"aria-hidden":!0}),p.attr({"aria-controls":"toggler_effect_"+c.id}),this.panelOpen?(g.find(".audioToggleIdentifier").audioComponent("pause"),g.find("#toggler_"+c.id).find(".effect:first").animate({height:"0px"},{progress:function(){var a=g.height();b.isCommEnabled({windowPostMessage:!0})&&PearsonGL.globals.comm.firePostMessageEvent({type:"open",dimensions:{height:a+10},url:m,name:"reveal"})},complete:function(){d.find(".gadget-textblock").hide(),d.find(".image-class-wrapper").hide(),d.addClass("reveal-closed").removeClass("reveal-open").attr({"aria-hidden":!0,tabindex:"",role:"tabpanel"}),p.addClass("reveal-btn-closed").removeClass("reveal-btn-open"),p.html(c.buttonText),p.attr({"aria-expanded":!1,label:PearsonGL.utils.stripHTML(c.buttonText)});var a=g.height();b.isCommEnabled({windowPostMessage:!0})&&PearsonGL.globals.comm.firePostMessageEvent({type:"close",dimensions:{height:a},url:m,name:"reveal"}),b.updateAriaLiveRegion("Dialog closed"),PearsonGL.utils.initMathJax(p[0])}}),q.removeClass("reveal-left-btn-open").addClass("reveal-left-btn-closed"),this.panelOpen=!1,this.sendAnalytics("clicked_hide_toggle_button")):(m=document.location.href,n=$(window).height(),d.addClass("reveal-open").removeClass("reveal-closed"),p.addClass("reveal-btn-open").removeClass("reveal-btn-closed"),q.addClass("reveal-left-btn-open").removeClass("reveal-left-btn-closed"),g.find("#toggler_"+c.id).find(".effect:first").animate({height:e+"px"},{progress:function(){l=g.height(),b.isCommEnabled({windowPostMessage:!0})&&PearsonGL.globals.comm.firePostMessageEvent({type:"open",dimensions:{height:l+.5*n},url:m,name:"reveal"})},complete:function(){p.html(c.buttonHideText),p.attr({"aria-expanded":!0,label:PearsonGL.utils.stripHTML(c.buttonHideText)}),d.attr({"aria-hidden":!1}),d.find(".image-class-wrapper").show().css({display:"flex"}),"top"===b.options.image.imagePosition&&d.find(".gadget-textblock").slideDown(500),b._windowScroller(a),l=g.height(),b.isCommEnabled({windowPostMessage:!0})&&PearsonGL.globals.comm.firePostMessageEvent({type:"open",dimensions:{height:l+.5*n},url:m,name:"reveal"}),PearsonGL.utils.focusItemOff(p),d.focus(),b.updateAriaLiveRegion("Dialog opened"),PearsonGL.utils.initMathJax([d[0],p[0]])}}),"top"!==this.options.image.imagePosition&&d.find(".gadget-textblock").slideDown(500),this.panelOpen=!0,this.sendAnalytics("clicked_reveal_toggle_button"),this.RevealOpenCnt+=1,this.sendAnalytics("clicked_total-"+this.RevealOpenCnt))}},{key:"clearAriaLiveRegion",value:function(){this.jObject.find(".aria-live-region").text("")}},{key:"updateAriaLiveRegion",value:function(a){var b=this.jObject.find(".aria-live-region");this.clearAriaLiveRegion(),b.text(""+a)}},{key:"gadgetUnload",value:function(){}},{key:"saveLearnerData",value:function(){var a=[];this.isCommEnabled()&&(this.options.scorm.interactions.forEach(function(b){var c=b.objectives[0],d={};d.raw=c.score.max,d.min=c.score.min,d.max=c.score.max,d.scaled=1,d.learnerResponse="Opened Reveal",d.correctResponse="Opened Reveal",d.correctResponses=[],d.result="neutral",d.successStatus="passed",d.completionStatus="completed",d.progressMeasure=1,a.push(d)}),this.setLearnerData({gadgetId:this.gadgetUniqueId,data:this.options.scorm,results:a}))}}]),b}(PearsonGL.Gadget.GadgetBase);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},PearsonGL.Gadget=PearsonGL.Gadget||{},PearsonGL.globals=PearsonGL.globals||{},PearsonGL.Gadget.VideoComponent=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return c?(e.labelOpts={playToolTip:"Play",pauseToolTip:"Pause",muteToolTip:"Mute",unMuteToolTip:"Unmute",fullScreenToolTip:"Enter Fullscreen",exitFullScreenToolTip:"Exit Fullscreen",ccEnableCaptionsTip:"Enable Captions",ccDisableCaptionsTip:"Disable Captions",showStopPointToolTip:"Show Stop Points",hideStopPointToolTip:"Hide Stop Points",stopPointDescriptionText:"Video stop point. Click play to resume.",seekPositionLabel:"Seek position",changeVolume:"Change the volume.",speedLabel:"Speed",showSettingsLabel:"Show Settings",hideSettingsLabel:"Hide Settings",videoSpeedLabel:"Video Speed",closedCaptionLabel:"Closed Caption",videoSpeedOptionLabel:"Video Speed Options",closedCaptionOptionLabel:"Closed Caption Options",closedCaptionsSpanish:"Spanish",closedCaptionsEnglish:"English",audioDescriptionLabel:"Audio Description",audioDescriptionOnOption:"On",audioDescriptionOffOption:"Off"},e.options={gadgetName:"VideoPlayer",play:!0,time:!0,fullscreen:!0,mute:!0,progressbar:!0,volumebar:!0,volumebarDirection:"vertical",caption:!0,controls:!0,autoPlay:!1,toggleControls:!1,disableClickToPlayPause:!1,src:"",poster:"",srt:"",vtt:"",clip:"",showCC:!1,videoPosterImg:"",local:[],external:[],showStopPointToggle:!1},e.controlHasFocus=!1,PearsonGL.Gadget.GadgetBase.call(e,c,d),e.jObject=$(a),e.eventType={played:"played",paused:"paused",muted:"muted",sliderChangeStarted:"locChangeStarted",ended:"ended"},e.dataConversion(),e.initialize(),e):_possibleConstructorReturn(e)}return _inherits(b,a),_createClass(b,[{key:"dataConversion",value:function(){if(PearsonGL.utils.isNonEmptyString(this.options.srt)||PearsonGL.utils.isNonEmptyString(this.options.vtt)){if(this.options.vttFiles&&this.options.vttFiles.length>=1)return;this.options.vttFiles=[],this.options.vttFiles.push({srt:PearsonGL.utils.isNonEmptyString(this.options.srt)?this.options.srt:"",lang:"en",vtt:PearsonGL.utils.isNonEmptyString(this.options.vtt)?this.options.vtt:""})}delete this.options.srt,delete this.options.vtt}},{key:"initialize",value:function(){if(void 0!==this.jObject){var a=this;this.currentTimeWatched=0,this.stopPointsAdded=!1,this.deferred=$.Deferred(),this.options.disableClickToPlayPause=this.options.ipadAccessibleVideo,PearsonGL.utils.getGlobalizedLabel("videoplayer_globalization",a.globalizationComplete.bind(this),this.options.runtimejson.lang)}}},{key:"isReady",value:function(){this.playing||!this.options.autoPlay||this.isTouchDevice||this.play(),this.resize()}},{key:"hidePlayButtonOnScreen",value:function(){this.jObject.find("#play-button").attr({tabindex:-1,"aria-disabled":!0}).hide()}},{key:"globalizationComplete",value:function(a){var b=this;if(this.firstPlay=!0,this.disablePlay=!1,this.gettime=0,this.previous=0,this.previous_2=-1,this.VolumeLevel=100*PearsonGL.globals.player.getMasterVolume(),this.maxSlider=100,this.durationOfVideo=0,this.playEnabled=!0,this.scormData={duration:0,timeWatched:0},this.playing=!1,this.isPaused=!1,this.canProgress=!1,this.timewatched=0,this.isDownloadedSrt=!1,this.isDownloadedVtt=!1,this.stopAtStopPoints=!0,this.isStop=!1,this.callback={},this.currentTimeWatched=0,this.premutedVolume=100,this.showExpandedProgressBar=!1,this.audioDescDuration=0,this.audioPlaybackCounts=0,this.deferred=$.Deferred(),this.options.videoVersion)switch(this.options.videoVersion){case"noControl":this.options.controls=!1;break;case"noControlAutoPlay":this.options.controls=!1,this.options.autoPlay=!0;break;case"allControlsNoSubs":this.options.caption=!1;break;case"allControlsAutoPlay":this.options.autoPlay=!0;break;case"allControlsAutoHide":this.options.toggleControls=!0;break;case"noVolumeBarAndFullScreen":this.options.volumebar=!1,this.options.fullscreen=!1;break;case"noVolumeBarAndFullScreenAndCC":this.options.volumebar=!1,this.options.fullscreen=!1,this.options.caption=!1}this.state={activeFocus:!1,usePIP:!1,wcag:{vttLangFileCount:0,vttDefaultLang:"en",vttCurrentLang:"en",hasAudioDescriptions:!1,adVTTCues:[],hasVTTFile:!1,hasSRTFile:!1,audioDescriptionsOn:!1,useSpeechSynthesisForAD:this.options.useSpeechSynthesisForAD,speechSynthBrowserSupport:"speechSynthesis"in window,doSpeechSynthDemo:this.options.doSpeechSynthDemo},stickControls:!1},$.extend(this.labelOpts,a),this.hasWebm=!1,this.webMsrc="",this.options.local.length>0?(this.options.src=PearsonGL.qtiEvaluator.evaluateAsset(this.options.local[0].src),$(this.options.local).each(function(){"webm"===b.getFileExtension(this.src).toLowerCase()&&(b.hasWebm=!0,b.webMsrc=PearsonGL.qtiEvaluator.evaluateAsset(this.src))})):this.options.external.length>0&&(this.options.src=PearsonGL.utils.urlResolver(this.options.runtimejson,this.options.external[0].domain,PearsonGL.qtiEvaluator.evaluateAsset(this.options.external[0].path))),this.init(),$(window).on("play",function(a,c){c&&c.sourceId!==b.gadgetUniqueId&&(b.isTouchDevice&&!b.firstPlay&&c.gadgetUniqueId===b.gadgetUniqueId||!b.isTouchDevice&&c.gadgetUniqueId===b.gadgetUniqueId)&&(c.eventData||$.isNumeric(c.eventData)?(b.setCurrentTime(c.eventData),b.play(!1,c.eventData)):b.play())}),$(window).on("pause",function(a,c){c.sourceId!==b.gadgetUniqueId&&c.gadgetUniqueId===b.gadgetUniqueId&&b.pause()})}},{key:"destroy",value:function(){this.jObject.children().remove(),this.jObject.removeClass("video-component-identifier"),this.jObject.removeAttr("tabindex")}},{key:"getFileExtension",value:function(a){var b=a.split(".");return 1===b.length||""===b[0]&&2===b.length?"":b.pop()}},{key:"init",value:function(){var a=this,b=this.jObject,c=document.createElement("video"),d=document.createElement("img"),e=void 0;if(this.jObject.addClass("video-component-identifier"),this.jObject.attr({tabindex:"-1"}),this.jObject.prepend('<div class="aria-live-region hidden-label" aria-live="assertive" aria-atomic="true"></div>'),(document.documentMode||/Edge/.test(navigator.userAgent))&&this.jObject.attr({tabindex:"0"}),this.options.fullscreen&&this.options.caption?this.options.showStopPointToggle||b.addClass("total-right-btn-two"):this.options.showStopPointToggle&&(this.options.caption||this.options.fullscreen)?b.addClass("two-buttons total-right-btn-two"):this.options.caption||this.options.showStopPointToggle||this.options.fullscreen?b.addClass("one-button total-right-btn-one"):b.addClass("total-right-btn-zero"),this.options.volumebar||b.addClass("total-left-btn-one"),a.hasWebm&&c.canPlayType&&c.canPlayType("video/webm").replace(/no/,"")&&!window.location.href.indexOf("file://")&&(this.options.src=a.webMsrc),void 0!==this.options.clip&&this.options.clip.length>0){this.options.clip.sort(function(a,b){return a.time-b.time}),a.clipLength=this.options.clip.length;var f="2"==this.options.version?0:.1;for(e=0;e<=a.clipLength-1;e++)PearsonGL.utils.hasParmContent()&&(this.options.clip[e].time=PearsonGL.qtiEvaluator.evaluateFloat(this.options.clip[e].time).value),this.options.clip[e].time=this.options.clip[e].time-f,this.options.clip[e].beenAt=!1}$(d).load(function(){a.posterWidth=parseFloat(this.width),a.posterHeight=parseFloat(this.height);var c="";a.options.disableClickToPlayPause||(c='<div id="play-button" data-icon="ic-video-start" role="button" alt="'+a.labelOpts.playToolTip+'" title="'+a.labelOpts.playToolTip+'" class="play-button"></div>'),b.append('<img class="video-poster-pos" role="presentation" src="'+this.src+'" /><div class=\'player-height\'></div><div class="player"><div class="overlay"></div><div id="video-play" playid="video"><img id="video-poster" src="'+this.src+'" />'+c+'<div id="video-loading"></div></div>'),a.options.hidePlayButtonOnScreen&&a.hidePlayButtonOnScreen();var d=PearsonGL.qtiEvaluator.replaceParameters(a.options.videoPosterImg);b.find("#video-poster").attr({alt:d}),$(window).bind("scroll.videoplayer",function(b){a.isFullScreen&&a.enterFullScreen()}),$(window).bind("resize.videoplayer",function(b){a.resize()}),a.HTML();try{a.posterReady()}catch(a){}}),d.src=PearsonGL.qtiEvaluator.evaluateAsset(this.options.poster)}},{key:"fireEvent",value:function(a,b){$(window).trigger(a,{sourceId:this.gadgetUniqueId,data:b,source:this})}},{key:"getVideoVolume",value:function(){return this.jObject.find("video")[0].volume}},{key:"getVideoPlaybackRate",value:function(){return this.jObject.find("video")[0].playbackRate}},{key:"speak",value:function(a){var b=window.speechSynthesis,c=this;PearsonGL.globals.videoUtterances=[];var d=new SpeechSynthesisUtterance;d.text=a,PearsonGL.globals.videoUtterances.push(d),d.pitch=1,d.volume=this.getVideoVolume(),d.rate=this.getVideoPlaybackRate(),d.voice=speechSynthesis.getVoices().filter(function(a){return"Alex"===a.name})[0],d.lang="en-US",this.state.wcag.audioDescriptionsOn&&b.speak(d),d.onend=function(a){PearsonGL.logger.log("Utterance has finished being spoken after "+a.elapsedTime+" milliseconds."),c.play()}}},{key:"createSpeechSynthesis",value:function(){var a=window.speechSynthesis;if(PearsonGL.logger.log("CREATE SPEECH SYNTHESIS"),this.state.wcag.speechSynthBrowserSupport){var b=function(){a.getVoices()};b(),a.onvoiceschanged=function(a){b()}}else PearsonGL.logger.log("BROWSER DOES NOT SUPPORT SPEECH SYNTHESIS")}},{key:"handleAudioDescriptionPlayback",value:function(a){var b=this,c=document.querySelector("#adPlayer"),d=!!c,e=this.state.wcag.adVTTCues,f=void 0;if(d){var g=function(){var a=c.currentTime/c.duration*100;b.state.wcag.isPlayingAudioDescription=!0,(100===a||c.currentTime>=c.endTime)&&(PearsonGL.logger.log("STOP AUDIO PLAY:::Currenttime",c.currentTime,"endTime",c.endTime),b.state.wcag.isPlayingAudioDescription=!1,c.pause(),b.playing=!0,b.play())};c.addEventListener("canplaythrough",function(){},!1),c.addEventListener("timeupdate",g,!1)}if("onenter"===a.state&&(PearsonGL.logger.log("VIDEO ONENTER STATE",a.lang,"STATE LANG",this.state.wcag.vttCurrentLang),a.id<=e.length&&a.lang===this.state.wcag.vttCurrentLang&&this.state.wcag.audioDescriptionsOn&&(b.pause(),this.state.wcag.useSpeechSynthesisForAD&&this.state.wcag.speechSynthBrowserSupport?this.speak(a.text):d&&(PearsonGL.logger.log("VIDEO ONENTER::: VID CUE ID",a.id,"audio.currentTime",e[a.id-1].startTime,"endTime",e[a.id-1].endTime,"Duration",e[a.id-1].text),c.currentTime=e[a.id-1].startTime,c.endTime=e[a.id-1].endTime,c.play()))),"onexit"===a.state||!this.state.wcag.audioDescriptionsOn)if(PearsonGL.logger.log("VIDEO ONEXIT STATE",a.lang),a.adButtonClick){this.state.wcag.audioDescriptionsOn=!1,this.state.wcag.useSpeechSynthesisForAD&&this.state.wcag.speechSynthBrowserSupport?f&&f.cancel():d&&(b.state.wcag.isPlayingAudioDescription=!1,c.pause());var h=this.jObject.find("video");h[0].currentTime>0&&b.play()}else f&&f.cancel()}},{key:"HTML",value:function(){var a=this,b=this,c=b.jObject;this.options.useGlobalVideoPlayer&&c.addClass("global-video"),this.state.wcag.useSpeechSynthesisForAD&&this.createSpeechSynthesis(),this.video=$('<video class="video" preload="auto" muted></video>'),this.video.attr("src",b.options.src);var d="";if(this.options.vttFiles&&!$.isEmptyObject(this.options.vttFiles[0])){var e=this.options.vttFiles;this.state.wcag.vttLangFileCount=this.options.vttFiles.length,e.forEach(function(c,e){if(PearsonGL.utils.isNonEmptyString(c.vtt)){var f=$('<track kind="descriptions" srclang="'+c.lang+'" src="'+c.vtt+'" data-srt="'+c.srt+'" default></track>');b.state.wcag.hasSRTFile=!!PearsonGL.utils.isNonEmptyString(c.srt),b.state.wcag.hasVTTFile=!0,"en"===c.lang?f.attr("label",""+a.labelOpts.closedCaptionsEnglish):"es"===c.lang&&(f.attr("label",""+a.labelOpts.closedCaptionsSpanish),f.attr("kind","metadata")),a.video.append(f),PearsonGL.utils.isNonEmptyString(c.mp3)&&(b.state.wcag.hasAudioDescriptions=!0,f.attr("data-ad-mp3-src",c.mp3),d='<audio id="adPlayer"><source src="'+c.mp3+'" type="audio/mpeg" /></audio>')}})}var f=void 0;if(b.state.wcag.hasAudioDescriptions&&(c.find(".player").append(d),f=document.querySelector("audio"),f.addEventListener("loadedmetadata",function(){f.addTextTrack("metadata","audioDescriptionTrack","en").mode="hidden"})),c.find(".player").append(this.video),c.find(".overlay").click(function(){!b.firstPlay&&b.options.playOnlyOnce||b.handleVideoClickEvent()}),b.setUpControls(),this.options.useGlobalVideoPlayer){var g=this.jObject.find(".controls");this.stopAnimateInOut(g)}if(this.isTouchDevice&&this.deferred.resolveWith(this),this.isTouchDevice||!this.options.disableClickToPlayPause){var h=this.isPlaying?this.labelOpts.playToolTip:this.labelOpts.pauseToolTip;c.find("video").attr({"aria-label":h+" Video",tabindex:"0"})}else c.find("video").attr({tabindex:"-1"});c.find(".controls").after('<div class="descriptive-text" aria-live="assertive" aria-atomic="true" />');var i=b.jObject.find(".descriptive-text"),j=c.find("track").toArray(),k=0,l={},m=0;j.length;j.forEach(function(a,c){a.addEventListener("load",function(){var c=a.track;b.isDownloadedVtt=!0,c.mode="hidden",PearsonGL.logger.log("TEXT TRACK LANG",c.language);for(var d=c.cues.length,e=function(a){var e=c.cues[a];if(e.lang=c.language,b.state.wcag.hasAudioDescriptions||b.state.wcag.useSpeechSynthesisForAD){m=e.endTime-e.startTime,l.startTime=k,l.endTime=l.startTime+m,k+=m;var f=new VTTCue(l.startTime,l.endTime,""+m);f.id=""+(a+1),f.lang=e.lang,b.state.wcag.adVTTCues.push(f),a===d-1&&PearsonGL.logger.log("CREATE CUE DATA FOR AUDIO TRACK",b.state.wcag.adVTTCues)}e.onenter=function(){b.state.wcag.hasAudioDescriptions&&b.state.wcag.audioDescriptionsOn||b.state.wcag.useSpeechSynthesisForAD&&b.state.wcag.speechSynthBrowserSupport?(e.state="onenter",b.handleAudioDescriptionPlayback(e)):(PearsonGL.logger.log("ONENTER CUE LANG ",e.lang,"STATE LANG",b.state.wcag.vttCurrentLang),b.state.wcag.audioDescriptionsOn&&e.lang===b.state.wcag.vttCurrentLang&&i.append(this.getCueAsHTML()))},e.onexit=function(){(b.state.wcag.hasAudioDescriptions&&b.state.wcag.audioDescriptionsOn||b.state.wcag.useSpeechSynthesisForAD&&b.state.wcag.speechSynthBrowserSupport)&&(e.state="onexit",b.handleAudioDescriptionPlayback(e)),i.empty()}},f=0;f<d;++f)e(f)}),j[c].onerror=function(a){PearsonGL.logger.log("DID NOT LOAD",j[c]),b.isDownloadedVtt=!1}})}},{key:"addPIPButton",value:function(a){var b=this.jObject,c=this,d='<div id="pip-on" class="ctr pip-on" data-icon="ic-pip-on" alt="PIP ON" title="PIP ON">PIP</div>',e='<div style="display:none;" id="pip-ff" class="ctr pip-off" data-icon="ic-pip-off" alt="PIP OFF" title="PIP OFF">PIP O<div>';this.options.IVideoPlayer?(a.find(".controls__progress").append(d),a.find(".controls__progress").append(e)):(a.append(d),a.append(e)),b.find("#pip-on").sliderbutton({buttonClassName:"pip-on",slider:!1,clickFunction:function(a){c.doPIP("on"),c.sendAnalytics("video_PIP_pressed"),b.find("#pip-on").focus()}}),b.find("#pip-off").sliderbutton({buttonClassName:"pip-off",slider:!1,clickFunction:function(a){c.doPIP("off"),c.sendAnalytics("video_PIP_pressed"),b.find("#pip-on").focus()}})}},{key:"addPlayPauseButton",value:function(a){var b=this.jObject,c=this,d='<div class="ctr play" id="play" data-icon="ic-arrow-play" alt="'+this.labelOpts.playToolTip+'" title="'+this.labelOpts.playToolTip+'"/>',e='<div style="display:none;" class="ctr pause" id="pause" data-icon="ic-arrow-play" alt="'+this.labelOpts.pauseToolTip+'" title="'+this.labelOpts.pauseToolTip+'"/>',f=b.find(".controls");this.options.useGlobalVideoPlayer?(a.find(".controls__options--left").prepend(d),a.find(".controls__options--left").prepend(e)):(a.append(d),a.append(e)),b.find("#play").sliderbutton({buttonClassName:"play",slider:!1,clickFunction:function(a){c.play(),c.sendAnalytics("video_play_pressed"),c.isTouchDevice&&c.options.toggleControls&&c.controlsAnimateOut(f)}}),b.find("#pause").sliderbutton({buttonClassName:"pause",slider:!1,clickFunction:function(a){c.pause(),c.options.autoPlay&&!c.isTouchDevice?c.sendAnalytics("autoplay_video_paused"):c.sendAnalytics("video_play_paused")}})}},{key:"addVolumeControls",value:function(a){var b=this.jObject,c=this,d='<div class="ctr mute" id="mute" data-icon="ic-volume-off" alt="'+this.labelOpts.muteToolTip+'" title="'+this.labelOpts.muteToolTip+'"/>',e='<div class="ctr unmute" id="unmute" data-icon="ic-volume-on" alt="'+this.labelOpts.unMuteToolTip+'" title="'+this.labelOpts.unMuteToolTip+'"/>',f='<div id="volume-bar-container"><div id="volume-bar"></div></div>';if(this.options.useGlobalVideoPlayer){this.options.volumebarDirection="horizontal";var g=a.find(".controls__options--left");g.append(d),g.append(e),g.append(f)}else a.append(d),a.append(e),a.append(f);var h=b.find("#mute"),i=b.find("#unmute");i.hide(),h.sliderbutton({buttonClassName:"mute",slider:!1,clickFunction:function(a){c.hideStopPointToolTips(),c.mute(),b.find("#unmute").focus()}}),h.attr({"aria-controls":"#volume-bar-container","aria-label":""+this.labelOpts.muteToolTip}),i.attr({"aria-controls":"#volume-bar-container","aria-label":""+this.labelOpts.unMuteToolTip}),i.sliderbutton({buttonClassName:"unmute",slider:!1,clickFunction:function(a){c.hideStopPointToolTips(),c.unmute(),b.find("#mute").focus()}})}},{key:"addProgressBar",value:function(a){var b='<div class="progress-wrapper controls__progress--slider"><div id="progress"></div></div>',c='<div id="progress-time"></div>';if(this.options.useGlobalVideoPlayer){var d=a.find(".controls__progress");d.append(c),d.append(b)}else a.append(b),a.append(c);this.setProgressBarWidth()}},{key:"addTimeDisplay",value:function(a){if(this.currentTimeCtrl=$('<div id="current-time">00:00</div>'),a.find("#progress-time").append(this.currentTimeCtrl),this.options.useGlobalVideoPlayer){a.find(".controls__progress").append('<div id="duration">00:00</div>')}else a.find("#progress-time").append('<div id="duration">/  00:00</div>')}},{key:"addStopPointToggleButton",value:function(a){var b=this.jObject,c=this,d='<div style="display:none;" class="ctr show-stop-point" data-icon="show-stop" id="show-stop-point" alt="'+this.labelOpts.showStopPointToolTip+'" title="'+this.labelOpts.showStopPointToolTip+'"/>',e='<div class="ctr hide-dp" id="hide-stop-point" data-icon="hide-stop" alt="'+c.labelOpts.hideStopPointToolTip+'" title="'+c.labelOpts.hideStopPointToolTip+'"/>';if(this.options.useGlobalVideoPlayer){var f=a.find(".controls__options--right");f.append(d),f.append(e)}else a.append(d),a.append(e);b.find("#show-stop-point").sliderbutton({buttonClassName:"show-stop-point",slider:!1,clickFunction:function(){c.setStopPointVisibility(!0),b.find("#hide-stop-point").focus()}}),b.find("#hide-stop-point").sliderbutton({buttonClassName:"hide-stop-point",slider:!1,clickFunction:function(a){c.setStopPointVisibility(!1),b.find("#show-stop-point").focus()}}),this.setStopPointVisibility(!0)}},{key:"addAudioDescriptionButton",value:function(a){var b=(this.jObject,this),c=$('<button type="button" class="ctr audio-description toggle" id="ad-toggle" data-icon="true" aria-label="'+this.labelOpts.audioDescriptionLabel+'" title="'+this.labelOpts.audioDescriptionLabel+'"></button>');c.buttonComponent(),a.find(".controls__options--right").append(c),this.state.wcag.hasVTTFile?c.prop("disabled",!1):c.prop("disabled",!0),c.prop("disabled")&&c.attr({"aria-label":"Audio Descriptions are disabled",title:"Audio Descriptions are disabled"});var d=!1;c.click(function(a){var e={};e.adButtonClick=!0,d?(c.buttonComponent("unpress"),c.attr({title:"Audio Descriptions are Off","aria-label":"Audio Descriptions are Off"}),b.state.wcag.audioDescriptionsOn=!1,b.firstPlay||!b.state.hasAudioDescriptions&&!b.state.wcag.useSpeechSynthesisForAD||(e.state="onexit",b.handleAudioDescriptionPlayback(e))):(c.buttonComponent("press"),c.attr({title:"Audio Descriptions are On","aria-label":"Audio Descriptions are On"}),b.state.wcag.audioDescriptionsOn=!0,b.firstPlay||!b.state.hasAudioDescriptions&&!b.state.wcag.useSpeechSynthesisForAD||(e.state="onenter",b.handleAudioDescriptionPlayback(e))),d=!d,b.sendAnalytics("Video: Audio Descriptions State is: "+a.currentTarget.dataset.audioDesc)})}},{key:"addCloseCaptionButton",value:function(a){var b=this,c=this.jObject,d=this,e='<div style="display:none;" class="ctr show-cc" id="show-cc" data-icon="ic-close-caption-on" alt="'+this.labelOpts.ccEnableCaptionsTip+'" title="'+this.labelOpts.ccEnableCaptionsTip+'"/>',f='<div class="ctr hide-cc" id="hide-cc" data-icon="ic-close-caption-off" alt="'+this.labelOpts.ccDisableCaptionsTip+'" title="'+this.labelOpts.ccDisableCaptionsTip+'"/>',g=$('<button type="button" class="ctr show-cc toggle" id="show-cc" data-icon="ic-close-caption-on" alt="'+this.labelOpts.ccEnableCaptionsTip+'" title="'+this.labelOpts.ccEnableCaptionsTip+'" disabled="true"/>');if(g.buttonComponent(),this.options.useGlobalVideoPlayer){a.find(".controls__options--right").append(g),this.state.wcag.hasSRTFile?g.attr("disabled",!1):g.attr("disabled",!0);var h=this.options.showCC?g.buttonComponent("press"):g.buttonComponent("unpress");g.click(function(a){h?(g.buttonComponent("press"),g.attr({alt:""+b.labelOpts.ccEnableCaptionsTip,title:""+b.labelOpts.ccEnableCaptionsTip}),d.hideStopPointToolTips(),d.showCC(),d.sendAnalytics("video_closed_captioning_on")):(g.buttonComponent("unpress"),g.attr({alt:""+b.labelOpts.ccDisableCaptionsTip,title:""+b.labelOpts.ccDisableCaptionsTip}),d.hideStopPointToolTips(),d.hideCC(),d.sendAnalytics("video_closed_captioning_off")),h=!h})}else a.append(e),a.append(f),c.find("#show-cc").sliderbutton({buttonClassName:"show-cc",slider:!1,clickFunction:function(a){d.hideStopPointToolTips(),d.sendAnalytics("video_closed_captioning_on"),d.showCC(),c.find("#hide-cc").focus()}}),c.find("#hide-cc").sliderbutton({buttonClassName:"hide-cc",slider:!1,clickFunction:function(a){d.hideStopPointToolTips(),d.sendAnalytics("video_closed_captioning_off"),d.hideCC(),c.find("#show-cc").focus()}})}},{key:"hideAllSettingsOptionsMenus",value:function(){var a=this,b=this.jObject.find(".settings__menus nav").toArray(),c=this.jObject.find(".settings__dom"),d=c.find(".show-settings"),e=c.find(".hide-settings");b.forEach(function(b,c){b.classList.contains("hide")||(b.classList.add("hide"),$(b).attr("aria-expanded",!1),a.updateAriaLiveRegion("Settings Menu Collapsed"))}),d.removeClass("hide").focus($(this)),e.addClass("hide")}},{key:"addSettingsOptions",value:function(a){var b=this.jObject,c=this;a||(a=b.find(".controls"));var d=a.find(".controls__options--right"),e=$('<div class="settings__dom"></div>'),f=$('<div class="settings__menus"></div>'),g=$('<button id="show-settings" class="ctr show-settings" data-icon="true" aria-controls="settingsOptions" aria-haspopup="true" aria-expanded="false" aria-label="Choose Video Settings for Closed Caption language, and Video Playback Speed." title="'+this.labelOpts.showSettingsLabel+'"></button>'),h=$('<button id="hide-settings" class="hide ctr hide-settings" data-icon="true" aria-controls="settingsOptions" aria-haspopup="true" aria-expanded="true" data-icon="true" aria-label="'+this.labelOpts.hideSettingsLabel+'" title="'+this.labelOpts.hideSettingsLabel+'"></button>'),i=$('<nav id="settingsOptions" class="hide settings-options" aria-label="Settings Options"><button class="settings-menu-item" aria-haspopup="true" aria-expanded="false" aria-label="Change Video Playback Speed" title="Change Video Playback Speed" data-options-menu="videoPlaybackOptions">'+this.labelOpts.videoSpeedLabel+"</button></nav>"),j=$('<nav id="videoPlaybackOptions" class="hide speed-nav"><button class="options__menu-title" aria-label="Go back to Settings Options" data-submenu="videoplayback" title="Choose the Video Playback Speed"><span data-icon="true">'+this.labelOpts.videoSpeedLabel+'</span></button><button arial-label="'+this.labelOpts.videoSpeedLabel+'" data-playback="0.5">0.5x</button><button arial-label="'+this.labelOpts.videoSpeedLabel+'" data-playback="1.0">1x</button><button arial-label="'+this.labelOpts.videoSpeedLabel+'" data-playback="1.25">1.25x</button><button arial-label="'+this.labelOpts.videoSpeedLabel+'" data-playback="1.5">1.5x</button><button arial-label="'+this.labelOpts.videoSpeedLabel+'" data-playback="2.0">2x</button></nav>'),k=$('<nav id="ccLangOptions" class="hide cc-lang-nav"><button class="options__menu-title" aria-label="Go back to Settings Options or" data-submenu="langoptions" title="Choose the CC Language" data-icon="true"><span data-icon="true">CC Language</span></button><button arial-label="Change Captions" data-cc-lang="en" class="selected">'+this.labelOpts.closedCaptionsEnglish+'</button><button data-cc-lang="es" arial-label="Change Captions" class="hide">'+this.labelOpts.closedCaptionsSpanish+"</button></nav>"),l=this.jObject[0].querySelector(".video");if(d.append(e),e.append(g),e.append(h),f.append(i),f.append(j),this.state.wcag.hasSRTFile){var m=$('<button class="settings-menu-item" aria-haspopup="true" aria-label="Go back to Settings Options or" title="Choose language for Closed Captions and Audio Descriptions" aria-expanded="false" data-options-menu="ccLangOptions">CC Language</button>');i.append(m),f.append(k)}if(this.state.wcag.doSpeechSynthDemo){var n={};n.test="hello";$().speechsythesiscomponent(n)}if(this.state.wcag.vttLangFileCount>1){k.find('button[data-cc-lang="es"]').removeClass("hide")}e.prepend(f);var o=f.find("nav").toArray(),p=f.find("button").toArray();o.forEach(function(a,b){$(a).attr("role","menu")}),p.forEach(function(a,b){"1.0"===a.dataset.playback&&$(a).addClass("selected"),"en"===a.dataset.ccLang&&$(a).addClass("selected")}),removeSelectedClass=function(a){p.forEach(function(b,c){$(a).attr("aria-labelledby")===$(b).attr("aria-labelledby")&&b.classList.remove("selected")})};var q=function(a){s("settingsOptions"),g.addClass("hide"),h.removeClass("hide"),c.updateAriaLiveRegion("Settings Menu Opened"),c.sendAnalytics("Video: Show Settings Menu click")},r=function(a){o.forEach(function(a,b){$(a).addClass("hide"),$(a).attr("aria-expanded",!1),$(a).blur()}),g.removeClass("hide"),h.addClass("hide"),c.updateAriaLiveRegion("Settings Menu Collapsed"),c.sendAnalytics("Video: Hide Settings Menu click")},s=function(a){o.forEach(function(b,d){var e=$(b).find("button").toArray();e.forEach(function(a,b){$(a).buttonComponent($(a))}),$(b).addClass("hide"),$(b).attr({"aria-expanded":!1}),$(b).is("#"+a)&&($(b).removeClass("hide"),$(b).attr({"aria-expanded":!0,tabindex:0}).focus(),e.forEach(function(b,c){$(b).attr({role:"menuitem","aria-labelledby":""+a,tabindex:0}),$(b).on("keydown",function(a){switch(a.which){case PearsonGL.utils.keyCode.down:c===e.length-1?$(e[0]).focus():$(a.currentTarget).next().focus();break;case PearsonGL.utils.keyCode.up:0===c?$(e[e.length-1]).focus():$(a.currentTarget).prev().focus()}})}),c.sendAnalytics("Show Video Settings Options Menu",a))})},t=function(a){PearsonGL.logger.log("doPlaybackSpeed",a.currentTarget),a.stopImmediatePropagation();var d=b.find("#adPlayer");removeSelectedClass(a.currentTarget),a.currentTarget.classList.add("selected"),c.updateAriaLiveRegion("You have selected to change the Video playback speed to "+a.target.dataset.playback),l.playbackRate=a.currentTarget.dataset.playback,d.length>0&&(d[0].playbackRate=a.currentTarget.dataset.playback),c.sendAnalytics("Video playbackRateChanged: "+a.currentTarget.dataset.playback)},u=function(a){a.stopImmediatePropagation();var b=$(l).find("track");removeSelectedClass(a.currentTarget),a.currentTarget.classList.add("selected"),c.updateAriaLiveRegion("You have selected "+("es"===a.currentTarget.dataset.ccLang?"Spanish":"English")+" for Closed Captions. This changes Descriptions if available."),b.each(function(b,d){var e=$(d).attr("srclang");e===a.currentTarget.dataset.ccLang&&(c.state.wcag.vttCurrentLang=e,c.getCaption($(d).attr("data-srt")),c.sendAnalytics("Video: Change Closed Captions Lang: "+c.state.wcag.vttCurrentLang))})},v=function(a){PearsonGL.logger.log("HANLDE OPTIONS CLICK",a.currentTarget.dataset),a.currentTarget.dataset.optionsMenu&&s(a.currentTarget.dataset.optionsMenu),a.currentTarget.dataset.submenu&&q(a),a.currentTarget.dataset.playback&&t(a),a.currentTarget.dataset.ccLang&&u(a),a.currentTarget.dataset.audioDesc&&doAudioDescription(a)};p.forEach(function(a){return a.addEventListener("click",v)}),document.addEventListener("click",function(a){a.preventDefault(),e.is(a.target)||0!==e.has(a.target).length||c.hideAllSettingsOptionsMenus()}),g.buttonComponent(g),h.buttonComponent(h),g.on("click",q),h.on("click",r)}},{key:"addFullscreenToggleButton",value:function(a){var b=this.jObject,c=this,d='<div class="ctr enter-full" tabindex="0" id="enter-full" data-icon="ic-fullscreen"  alt="'+c.labelOpts.fullScreenToolTip+'" title="'+c.labelOpts.fullScreenToolTip+'"/>',e='<div style="display:none;" class="ctr exit-full" tabindex="0" id="exit-full" data-icon="ic-exit-fullscreen" alt="'+c.labelOpts.exitFullScreenToolTip+'" title="'+c.labelOpts.exitFullScreenToolTip+'"/>';if(this.options.useGlobalVideoPlayer){var f=a.find(".controls__options--right");f.append(d),f.append(e)}else a.append(d),a.append(e);b.find("#enter-full").sliderbutton({buttonClassName:"enter-full",slider:!1,clickFunction:function(a){c.hideStopPointToolTips(),c.sendAnalytics("video_clicked_full_screen_opened"),c.enterFullScreen(),b.find("#exit-full").focus()}}),b.find("#exit-full").sliderbutton({buttonClassName:"exit-full",slider:!1,clickFunction:function(a){c.hideStopPointToolTips(),c.sendAnalytics("video_clicked_full_screen_closed"),c.exitFullScreen(),b.find("#enter-full").focus()}})}},{key:"addCloseCaptionDom",value:function(){var a=this.jObject;if(this.options.srtinline){if(this.options.srtinline.time&&this.options.srtinline.subtitles){a.find(".player").append('<div id="cc" tabindex="0"></div>'),this.isDownloadedSrt=!0,this.subtitles=this.options.srtinline.subtitles,this.time=this.options.srtinline.time,this.l=0;for(k in this.subtitles)this.l++}}else(this.options.srtinline||this.options.vttFiles&&this.options.vttFiles[0].srt&&this.options.vttFiles[0].srt.length>0)&&(a.find(".player").append('<div id="cc"></div>'),this.getCaption());if(this.options.useGlobalVideoPlayer){var b=a.find("#cc"),c=a.find("#controls");c.prepend('<div class="cc-wrapper"></div>'),c.find(".cc-wrapper").prepend(b)}}},{key:"setUpControls",value:function(){var a=this,b=this.jObject,c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=b.find(".controls");if(b.find("[playid]").click(function(b){a.options.disableClickToPlayPause?a.isTouchDevice&&a.options.toggleControls&&a.controlsAnimateIn(h):(a.play(),a.isTouchDevice&&a.options.toggleControls&&a.controlsAnimateOut(h))}),b.find("[playid]").find(".play-button").sliderbutton({buttonClassName:"play-button",slider:!1,clickFunction:function(){a.options.disableClickToPlayPause||a.play(),a.isTouchDevice&&a.options.toggleControls&&a.controlsAnimateOut(h)}}),this.options.controls){if(this.options.useGlobalVideoPlayer){b.find(".player").append('<div class="controls media__controls" tabindex="-1" id="controls">\n\t\t\t\t\t<div class="controls__progress"></div>\n\t\t\t\t\t<div class="controls__options"><div class="controls__options--left"></div><div class="controls__options--right"></div></div>\n\t\t\t\t\t</div>')}else{b.append('<div class="controls" style="display:none" tabindex="-1" id="controls"></div>')}var i=b.find("#controls");if(this.state.usePIP&&this.addPIPButton(i),this.options.play&&this.addPlayPauseButton(i),this.options.volumebar&&(a.isTouchDevice||(this.addVolumeControls(i),b.find("#volume-bar").click(function(){a.sendAnalytics("video_dragged_volume")}))),this.options.progressbar&&this.addProgressBar(i),this.options.time&&this.addTimeDisplay(i),this.options.showStopPointToggle&&this.addStopPointToggleButton(i),this.options.useGlobalVideoPlayer&&this.addAudioDescriptionButton(i),this.options.useGlobalVideoPlayer?this.addCloseCaptionButton(i):this.options.caption&&this.options.vttFiles&&this.options.vttFiles[0]&&this.options.vttFiles[0].srt.length>0&&this.addCloseCaptionButton(i),this.options.useGlobalVideoPlayer&&this.options.controls&&this.addSettingsOptions(i),a.options.fullscreen&&this.addFullscreenToggleButton(i),a.options.controls&&void 0!==a.options.videoVersion&&"allControlsAutoHide"!==a.options.videoVersion&&b.find("#play-button").attr({"aria-hidden":!0,tabindex:"-1"}),a.options.toggleControls){var j=this.options.useGlobalVideoPlayer?0:1600;if(this.firstPlay&&(this.resize(),this.state.stickControls=!0),this.options.useGlobalVideoPlayer){var k=b.find(".player");this.isTouchDevice?(k.on("touchstart",function(b){a.controlsAnimateIn(i),a.state.stickControls=!0}),k.on("touchend",function(b){a.controlsAnimateOut(i),a.state.stickControls=!1})):k.hover(function(b){"mouseenter"===b.type?(a.controlsAnimateIn(i),a.state.stickControls=!0):"mouseleave"===b.type&&(a.firstPlay||(a.state.stickControls=!1,a.controlsAnimateOut(i)))})}else b.find(".player").find("*").on("mouseover touchstart",function(b){a.removeControlsFocus(),clearTimeout(c),(i.is(":visible")||1===i.css("opacity"))&&a.controlsAnimateIn(i),a.isTouchDevice||(c=setTimeout(function(){a.controlsAnimateOut(i)},j))});this.options.useGlobalVideoPlayer||(a.removeControlsFocus(),i.hover(function(){clearTimeout(c),i.is(":visible")||i.css("opacity"),a.controlsAnimateIn(i)},function(){a.isTouchDevice||(c=setTimeout(function(){a.controlsAnimateOut(i)},j))}),a.isTouchDevice||a.controlsAnimateOut(i))}a.canProgress=!1,i.find("#progress").slider({range:"min",min:0,max:100,create:function(a,b){$(this).find(".ui-slider-handle").removeAttr("href")},start:function(b,c){b.stopImmediatePropagation(),b.stopPropagation(),$(b.toElement).hasClass("clip-clicker")&&b.preventDefault();try{a.fireEvent(a.eventType.sliderChangeStarted,a.video[0].currentTime),a.sendAnalytics("video_dragged_progress_bar")}catch(a){}},slide:function(c,d){if(d.value>=a.maxSlider)return!1;a.canProgress=!0,e=d.value/100,a.scormData.duration=f=b.find(".player").find("video")[0].duration,g=f*e,a.setCurrentTime(g),b.find(".player").find("video")[0].currentTime=g,a.onSeek(g)},stop:function(b,c){a.canProgress=!1}});var l=PearsonGL.utils.randomString(2),m='<span id="seekSliderDesc_'+l+'" class="hidden-label">'+this.labelOpts.seekPositionLabel+"</span>",n=b.find("#progress");n.append(m),n.find(".ui-slider-handle").attr({role:"slider","aria-label":""+a.labelOpts.seekPositionLabel,"aria-valuemin":"0","aria-valuemax":"100",step:"1","aria-describedby":"seekSliderDesc_"+l,alt:""+a.currentTimeCtrl.html(),title:""+a.currentTimeCtrl.html(),"aria-valuenow":""+a.currentTimeCtrl.html(),"aria-valuetext":""+a.currentTimeCtrl.html()}),a.isTouchDevice||i.find("#volume-bar").slider({orientation:a.options.volumebarDirection,range:"min",min:0,max:100,create:function(a,b){$(this).find(".ui-slider-handle").removeAttr("href")},slide:function(b,c){a.setVolume(c.value)}}),this.isMute=!1,a.setVolume(a.VolumeLevel),b.find("#progress").slider("disable"),b.find("#progress").find(".ui-slider-handle").focus(function(a){PearsonGL.utils.focusItemOn(this)}),b.find("#progress").find(".ui-slider-handle").blur(function(){PearsonGL.utils.focusItemOff(this)});var o=b.find("#volume-bar-container"),p=b.find("#progress"),q=p.find(".ui-slider-handle"),r=b.find("#mute"),s=b.find("#unmute"),t=b.find("#play"),u=b.find("#pause"),v=o.find(".ui-slider-handle"),w=PearsonGL.utils.randomString(2),x='<span id="sliderDescription_'+w+'" class="hidden-label">'+this.labelOpts.changeVolume+"</span>";o.prepend(x),o.attr({role:"region"}),v.attr({role:"slider","aria-valuemin":"0","aria-valuemax":"100",step:"5","aria-valuenow":this.premutedVolume,"aria-valuetext":this.premutedVolume+" volume","aria-describedby":"sliderDescription_"+w});var y=function(){o&&o.hasClass("accessible-show")&&(d=setTimeout(function(){a.options.useGlobalVideoPlayer||(o.removeClass("accessible-show").addClass("accessible-hidden"),o.attr("aria-expanded",!1))},600))},z=function(){o&&o.hasClass("accessible-hidden")&&(a.options.useGlobalVideoPlayer&&o.show(),o.removeClass("accessible-hidden").addClass("accessible-show"),o.attr("aria-expanded",!0))};$(r,s).focus(function(a){z()}),$(t).focus(function(a){y()}),$(u).focus(function(a){y()}),q.focus(function(a){y()}),o.hover(function(){clearTimeout(d)},function(){y()}),b.find(".controls").find("#mute, #unmute").hover(function(){clearTimeout(d),z()},function(){d=setTimeout(function(){y()},600)}),o.addClass("accessible-hidden")}var A=$("body").find(".sco");b.keydown(function(b){switch(b.keyCode){case 9:if(a.options.toggleControls){var c=A.find(".controls");c.is(b.target)||c.has(b.target).length>0?a.controlsAnimateIn(c):(a.controlHasFocus=!1,a.state.stickControls=!1,a.controlsAnimateOut(c))}break;case 32:a.isPlaying()?(a.pause(),a.options.autoPlay&&!a.isTouchDevice?a.sendAnalytics("autoplay_video_paused"):a.sendAnalytics("video_play_paused")):(a.play(),a.sendAnalytics("video_play_pressed"));break;case 39:case 37:break;case 27:a.hideAllSettingsOptionsMenus()}}),this.addCloseCaptionDom(),a.htmlEvents(),b.find("img").Protector(),a.addAccessibility(b),this.options.caption&&!this.options.useGlobalVideoPlayer&&(a.options.showCC||a.hideCC()),a.options.longDesc&&PearsonGL.utils.isNonEmptyString(a.options.longDesc)&&a.addLongDescription(b.find("#video-poster"),PearsonGL.qtiEvaluator.replaceParameters(a.options.longDesc))}},{key:"htmlEvents",value:function(){var a=this,b=a.jObject,c=!0;this.video.on("play",function(c){c.stopImmediatePropagation(),b.find("[playid]").css({"z-index":"-1",visibility:"hidden"}),a.hasEnded=!1,a.onPlay(),a.playing=!0,a.firstPlay&&(a.onFirstPlay(),a.firstPlay=!1,b.find(".controls").find("#progress").slider("enable"),b.find("#progress").find(".ui-slider-handle").attr("tabindex","0"),b.find(".controls").find("#play").hide(),b.find(".controls").find("#pause").show(),a.setProgressBarWidth())}),this.video.on("playing",function(b){a.startCount(),c&&(c=!1,a.setTotalTime(a.video[0].duration),a.scormData.duration=a.video[0].duration)}),this.video.on("pause",function(b){b.stopImmediatePropagation(),!1===a.hasEnded&&(a.endCount(),a.hasEnded=!1,a.onPause(),a.playing=!1)}),this.video.on("ended",function(){a.hasEnded=!0,a.setCurrentTime(a.video[0].duration),a.onEnd(),a.options.playOnlyOnce||b.find("[playid]").css({"z-index":"1009",visibility:"visible"}),a.video&&a.video[0]&&a.sendAnalytics("video_played_"+a.currentTimeWatched+"_of_"+a.video[0].duration+"_seconds",a.currentTimeWatched),a.video[0].pause(),b.find(".controls").find("#pause").hide(),b.find(".controls").find("#play").show()}),this.video.on("timeupdate",function(){b.find(".player").find(".video").attr({width:b.find(".player").width(),height:b.find(".player").height()}).css({width:b.find(".player").width(),height:b.find(".player").height()}),!1===a.canProgress&&a.setCurrentTime(a.video[0].currentTime),PearsonGL.globals.player&&PearsonGL.globals.player.settings.activityTime&&PearsonGL.globals.player.mediaIsActive()}),this.video.on("loadedmetadata",function(){a.onloadedmetadata(this.duration)}),a.isTouchDevice&&this.video.on("webkitendfullscreen",function(){a.exitFullScreen()}),b.find("video").click(function(){a.handleVideoClickEvent()}),a.options.autoPlay&&!a.isTouchDevice&&b.find(".video").is(":visible")&&(a.sendAnalytics("play_autoplay"),a.startCount(),a.play())}},{key:"removeControlsFocus",value:function(){$(this.jObject.find(".controls")).find("*").blur(),this.controlHasFocus=!1}},{key:"doPIP",value:function(a){var b=$(this.jObject).find("video")[0];b.webkitSupportsPresentationMode&&"function"==typeof b.webkitSetPresentationMode&&b.webkitSetPresentationMode("picture-in-picture"===b.webkitPresentationMode?"inline":"picture-in-picture")}},{key:"stopAnimateInOut",value:function(a){a||(a=this.jObject.find(".controls")),this.options.useGlobalVideoPlayer&&(a.removeClass("slide-out"),a.addClass("slide-in"),this.state.stickControls=!0)}},{key:"controlsAnimateOut",value:function(a){a||(a=this.jObject.find(".controls"));var b=a.css("opacity");if(this.options.useGlobalVideoPlayer){if(this.controlHasFocus)return;if(this.state.stickControls)return void this.stopAnimateInOut(a);var c=this.isTouchDevice?1e3:0;this.isTouchDevice?setTimeout(function(){a.addClass("slide-out").removeClass("slide-in")},c):a.addClass("slide-out").removeClass("slide-in"),this.showExpandedProgressBar=!0,this.doFancyProgressBar(),this.hideAllSettingsOptionsMenus()}else"1"!==b||this.controlHasFocus||a.fadeTo(400,0),this.isPlaying()&&"1"===b&&setTimeout(function(){a.fadeTo(400,0)},800)}},{key:"controlsAnimateIn",value:function(a){a||(a=this.jObject.find(".controls"));var b=a.css("opacity");if(a.removeClass("hide"),this.options.useGlobalVideoPlayer){if(this.state.stickControls)return void this.stopAnimateInOut(a);a.addClass("slide-in").removeClass("slide-out"),"0"===b&&a.fadeTo(100,1),this.showExpandedProgressBar=!1,this.doFancyProgressBar()}else"0"===b&&a.fadeTo(400,1)}},{key:"onloadedmetadata",value:function(a){var b=this.jObject;this.firstPlay&&a>0&&a!==1/0&&(this.setTotalTime(a),this.scormData.duration=a,b.find(".controls").find("#progress").slider("enable"),b.find(".controls").css("display",""),b.find("#progress").find(".ui-slider-handle").attr("tabindex","0"),this.setProgressBarWidth()),this.deferred.resolveWith(this)}},{key:"play",value:function(a,b){var c=this,d=this.jObject.find(".controls");this.state.stickControls=!1,this.deferred.done(function(){if(this.hideStopPointToolTips(),0==this.disablePlay){this.attemptToPlay=!0,this.sendAnalytics("video_play_pressed"),d.find("#play").attr("aria-hidden",!0).hide(),d.find("#pause").attr("aria-hidden",!1).show();var e=this.jObject.find("#progress").find(".ui-slider-handle").css("left");if(this.firstPlay&&"0px"===e){this.hidePlayButtonOnScreen();var f=this.jObject.find("#video-loading");try{this.spinner=new Spinner({color:"#000"}).spin(),$(f).append(this.spinner.el),this.hasSpinner=!0}catch(a){}}a?this.video[0].currentTime=0:$.isNumeric(b)&&(this.video[0].currentTime=b),this.fireEvent(this.eventType.played,this.video[0].currentTime),this.video[0].play(),setTimeout(function(){var a=c.video[0].paused;c.unmute(!0),!a&&c.video[0].paused&&c.pause()},50),this.options.autoPlay&&setTimeout(function(){"hidden"===$("video").css("visibility")&&c.pause()},100)}PearsonGL.logger.log("PLAY CALLED: Is Audio playing?",this.state.wcag.isPlayingAudioDescription),this.state.wcag.isPlayingAudioDescription||(d.find("#play").attr("aria-hidden",!0).hide(),d.find("#pause").attr("aria-hidden",!1).show())})}},{key:"playDisable",value:function(a){this.disablePlay=a}},{key:"pause",value:function(a){var b=this.jObject.find(".controls");this.jObject.find(".video");this.isPlaying()&&(this.fireEvent(this.eventType.paused,a),this.sendAnalytics("Video: Pressed Pause Button"),b.find("#pause").attr("aria-hidden",!0).hide(),b.find("#play").attr("aria-hidden",!1).show(),this.video&&this.video[0].pause(a))}},{key:"mute",value:function(){var a=this.jObject.find(".controls");this.onMute(),a.find("#mute").attr("aria-hidden",!0).hide(),a.find("#unmute").attr("aria-hidden",!1).show();var b=this.jObject.find(".player").find("video");this.premutedVolume=parseInt(100*b[0].volume),b.prop("volume",0),this.setVolume(parseInt(0)),this.isMute=!0,this.updateAriaLiveRegion("The video is muted")}},{key:"unmute",value:function(a){var b=this.jObject.find(".controls"),c=this.jObject.find(".player").find("video");this.onUnmute(),c.prop("muted",!1),this.isMute=!1,this.updateAriaLiveRegion("The video is unmuted"),b.find("#unmute").attr("aria-hidden",!0).hide(),b.find("#mute").attr("aria-hidden",!1).show(),a?this.premutedVolume=parseInt(100*c[0].volume):this.premutedVolume<=0&&(this.premutedVolume=parseInt(20)),this.setVolume(this.premutedVolume)}},{key:"setCurrentTime",value:function(a){var b=this,c=b.jObject,d=void 0,e=void 0,f=void 0,g=0,h=void 0;this.deferred.done(function(){if((this.options.srtinline||this.options.vttFiles&&this.options.vttFiles[0]&&this.options.vttFiles[0].srt.length>0)&&b.isDownloadedSrt&&this.showCaption(),a>0&&b.hasSpinner&&(b.spinner.stop(),c.find("#video-loading").remove(),b.hasSpinner=!1),!b.hasEnded&&void 0!==b.options.clip&&b.options.clip.length>0&&!b.canProgress){d=a;var i="2"==this.options.version?.1:0;for(g=0;g<=b.clipLength-1;g++)if(!b.options.clip[g].beenAt&&d>=b.options.clip[g].time-i){b.previous=a,b.options.clip[g].beenAt=!0,h=c.find(".player").find("video")[0].duration,b.onClip(b,b.options.clip,g,d,c.find("#progress"),h);break}}this.gettime=a,e=a,f=Math.floor(e/60),e%=60,f=f<10?"0"+Math.floor(f):Math.floor(f),e=Math.floor(e)<10?"0"+Math.floor(e):Math.floor(e),this.currentTimeCtrl&&this.currentTimeCtrl.text(f+":"+e),this.setProgress(this.getTime(),this.video[0].duration)})}},{key:"setTotalTime",value:function(a){var b=void 0,c=void 0;this.durationOfVideo=a,void 0!==this.options.clip&&this.options.clip.length>0&&!this.stopPointsAdded&&this.setUpClips(a),b=a,c=Math.floor(b/60),b%=60,c=c<10?"0"+Math.floor(c):Math.floor(c),b=Math.floor(b)<10?"0"+Math.floor(b):Math.floor(b);var d="";this.options.useGlobalVideoPlayer||(d="/ "),this.jObject.find(".controls").find("#duration").text(d+" "+c+":"+b)}},{key:"setProgress",value:function(a,b){if(this.jObject.find("#progress").length>0){var c=a/b*100;this.jObject.find(".controls").find("#progress").slider("option","value",c),this.jObject.find("#progress").find(".ui-slider-handle").attr({alt:""+this.currentTimeCtrl.html(),title:""+this.currentTimeCtrl.html(),"aria-valuenow":""+this.currentTimeCtrl.html(),"aria-valuetext":""+this.currentTimeCtrl.html()})}}},{key:"setVolume",value:function(a){this.VolumeLevel=a,a/=100;var b=this,c="low-volume",d="med-volume",e=this.jObject.find(".controls").find("#mute"),f=this.jObject.find(".controls").find("#unmute");!1===this.isMute&&(this.video[0].volume=a),this.volume=a,a*=100,a<=0?(e.hide(),f.show(),b.updateAriaLiveRegion("The video is muted")):(a<=20?e.removeClass(d).addClass(c):a>=21&&a<=60?e.removeClass(c).addClass(d):e.removeClass(c+" "+d),f.hide(),e.show()),this.setVolumeBar(parseInt(a))}},{key:"setVolumeBar",value:function(a){this.jObject.find("#volume-bar").slider("option","value",a),this.jObject.find("#volume-bar").find(".ui-slider-handle").attr({alt:a+"%",title:a+"%"}),this.jObject.find("#volume-bar-container").attr({"aria-valuenow":a}),a>0&&this.isMute&&(this.premutedVolume=a,this.unmute())}},{key:"enterFullScreen",value:function(){var a=this,b=a.jObject,c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=b.find(".controls");$("body").addClass("fullscreen-browser");var i=$("body").find(".header"),j=$("body").find(".footer"),k=$("body").find(".page:not(.hidden-page)"),l=k.find(".gadget:not(.video-player-identifier )").toArray();i.addClass("video-fs-hide-all-others"),j.addClass("video-fs-hide-all-others"),l.forEach(function(a,b){$(a).addClass("video-fs-hide-all-others")}),this.onFullscreen(),this.isFullScreen=!0,h.find("#enter-full").attr("aria-hidden",!0).hide(),h.find("#exit-full").attr("aria-hidden",!1).show(),this.jObject.addClass("fs-mode"),c=$(window).width(),d=$(window).height(),b.find(".player").find(".video").attr({width:c,height:d}).css({width:c,height:d}),b.find(".player").find(".video").children().attr({width:c,height:d}).css({width:c,height:d}),b.find(".player").css({height:d,width:c}),this.setProgressBarWidth(),e=c/a.posterWidth,f=d/a.posterHeight,g=e,e*a.posterHeight>d&&(g=f),b.find("#video-poster").css({width:a.posterWidth*g,height:a.posterHeight*g,left:(a.posterWidth*g-c)/2*-1,top:(a.posterHeight*g-d)/2*-1}),setTimeout(function(){a.updateAriaLiveRegion(""+a.labelOpts.fullScreenToolTip)},50)}},{key:"exitFullScreen",value:function(){var a=this.jObject,b=a.find(".controls"),c=this;$("body").removeClass("fullscreen-browser"),this.onFullscreenExit(),this.isFullScreen=!1;var d=$("body").find(".header"),e=$("body").find(".footer"),f=$("body").find(".page:not(.hidden-page)"),g=f.find(".gadget:not(.video-player-identifier )").toArray();d.removeClass("video-fs-hide-all-others"),e.removeClass("video-fs-hide-all-others"),g.forEach(function(a,b){$(a).removeClass("video-fs-hide-all-others")}),b.find("#exit-full").attr("aria-hidden",!0).hide(),b.find("#enter-full").attr("aria-hidden",!1).show(),this.jObject.removeClass("fs-mode"),this.jObject.find(".player").attr("style","");var h=a.find(".video-poster-pos").width(),i=a.find(".video-poster-pos").height();a.find(".player").find(".video").attr({width:h,height:i}).css({width:h,height:i}),a.find(".player").find(".video").children().attr({width:h,height:i}).css({width:h,height:i}),this.jObject.find("#video-poster").removeAttr("style"),this.setProgressBarWidth(),setTimeout(function(){c.updateAriaLiveRegion(""+c.labelOpts.exitFullScreenToolTip)},50)}},{key:"showCC",value:function(){var a=this.jObject.find(".controls");this.jObject.find("#cc").show(),this.updateAriaLiveRegion(this.labelOpts.ccEnableCaptionsTip),this.options.useGlobalVideoPlayer||(a.find("#show-cc").attr("aria-hidden",!0).hide(),a.find("#hide-cc").attr("aria-hidden",!1).show())}},{key:"hideCC",value:function(){var a=this.jObject.find(".controls");this.jObject.find("#cc").hide(),this.updateAriaLiveRegion(this.labelOpts.ccDisableCaptionsTip),this.options.useGlobalVideoPlayer||(a.find("#hide-cc").attr("aria-hidden",!0).hide(),a.find("#show-cc").attr("aria-hidden",!1).show())}},{key:"setStopPointVisibility",value:function(a){var b=this.jObject.find(".controls");this.stopAtStopPoints=a,a?(this.jObject.find(".controls__progress--slider .clip").show(),b.find("#show-stop-point").attr("aria-disabled",!0).hide(),b.find("#hide-stop-point").attr("aria-disabled",!1).show()):(this.jObject.find(".controls__progress--slider .clip").hide(),b.find("#hide-stop-point").attr("aria-disabled",!0).hide(),b.find("#show-stop-point").attr("aria-disabled",!1).show())}},{key:"clearAriaLiveRegion",value:function(){this.jObject.find(".aria-live-region").text("")}},{key:"updateAriaLiveRegion",value:function(a){var b=this.jObject.find(".aria-live-region");this.clearAriaLiveRegion(),b.text(""+a)}},{key:"getTime",value:function(){return this.gettime}},{key:"seek",value:function(a){this.onSeek(a),this.setCurrentTime(a),this.jObject.find(".player").find("video")[0].currentTime=a}},{key:"setUpClips",value:function(a){var b=void 0,c=void 0,d=this,e=this.jObject,f=void 0,g=void 0;for(this.options.version||(a=Math.floor(a)),g=0;g<=d.clipLength-1;g++){var h=PearsonGL.utils.randomString(3);b="2"===this.options.version?(this.options.clip[g].time/a*100).toFixed(2):Math.floor(this.options.clip[g].time/a*100),e.find("#progress").append('<div data-id="'+g+'" id="clip'+g+"_"+h+'" class="clip" style="display:none;left:'+b+'%"></div>'),this.options.clip[g].stop||e.find('.clip[data-id="'+g+'"]').addClass("no-stop"),this.options.clip[g].text=PearsonGL.qtiEvaluator.replaceParameters(this.options.clip[g].text),void 0!==this.options.clip[g].text&&this.options.clip[g].text.length>0&&(f=$('<div class="clip-clicker" aria-describedby="stopPointDescription_'+h+'">\n\t\t\t\t\t<label id="stopPointDescription_'+h+'" class="hidden-label">'+this.options.clip[g].text+" "+this.labelOpts.stopPointDescriptionText+'</label>\n\t\t\t\t\t<div class="clicker-hit-area"></div>\n\t\t\t\t\t<div class="clip-text"><div class="c-text">'+this.options.clip[g].text+'</div>\n\t\t\t\t\t<div class="clip-bk"></div>\n\t\t\t\t\t<div class="clip-point"></div></div></div>'),e.find('.clip[data-id="'+g+'"]').append(f),f.sliderbutton({buttonClassName:"clip-clicker",slider:!1,clickFunction:function(a,b){if(g=a.jObject.parent(".clip").attr("data-id"),d.hideStopPointToolTips(),void 0!==d.options.clip[g].text&&d.options.clip[g].text.length>0&&(c=d.jObject.find('.clip[data-id="'+g+'"] .clip-text'),c.css("left","-"+c.width()/2+"px")),parseFloat(d.previous)===parseFloat(d.options.clip[a.jObject.parent(".clip").attr("data-id")].time))if(d.jObject.find('.clip[data-id="'+a.jObject.parent(".clip").attr("data-id")+'"]').find(".clip-text").is(":visible"))d.jObject.find(".clip").find(".clip-text").dequeue().hide();else{d.jObject.find(".clip").find(".clip-text").dequeue().hide();var e=d.jObject.find('.clip[data-id="'+a.jObject.parent(".clip").attr("data-id")+'"]').find(".clip-text");e.show();var f=$(e[0]).text().trim();d.updateAriaLiveRegion(f+" "+d.labelOpts.stopPointDescriptionText)}else{d.jObject.find(".clip").find(".clip-text").dequeue().hide();var h=d.jObject.find('.clip[data-id="'+a.jObject.parent(".clip").attr("data-id")+'"]').find(".clip-text");h.show();var i=$(h[0]).text().trim();d.updateAriaLiveRegion(i+" "+d.labelOpts.stopPointDescriptionText+" "),d.seek(d.options.clip[a.jObject.parent(".clip").attr("data-id")].time),d.previous=d.options.clip[a.jObject.parent(".clip").attr("data-id")].time}if(d.options.clip[a.jObject.parent(".clip").attr("data-id")].stop){var j="2"===d.options.version?0:.1,k=d.options.clip[g].time+j;d.pause(k),d.video[0].currentTime=k}}}))}this.jObject.find(".controls").find("#progress").find(".clip").fadeIn(500),this.setStopPointVisibility(d.stopAtStopPoints),this.stopPointsAdded=!0}},{key:"startCount",value:function(){var a=new Date;this.startcount=Math.floor(a.getTime()/1e3)}},{key:"endCount",value:function(){var a=new Date,b=Math.floor(a.getTime()/1e3),c=b-this.startcount;this.scormData.timeWatched=this.scormData.timeWatched+c,this.currentTimeWatched+=c}},{key:"getData",value:function(){return this.scormData}},{key:"isPlaying",value:function(){return this.playing}},{key:"onFirstPlay",value:function(){}},{key:"onPlay",value:function(){}},{key:"onPause",value:function(){return this.isPaused}},{key:"onEnd",value:function(){this.fireEvent(this.eventType.ended),this.gettime=0,this.options.playOnlyOnce||this.jObject.find("#cc").html(""),this.onSeek(0)}},{key:"onMute",value:function(){}},{key:"onUnmute",value:function(){}},{key:"onFullscreen",value:function(){this.isTouchDevice||($(".header, .footer").addClass("hide"),$(".hideOnFullScreen").hide());var a=document.location.href;window.PearsonGL&&PearsonGL.globals&&PearsonGL.globals.comm&&PearsonGL.globals.comm.firePostMessageEvent({type:"open",dimensions:{},url:a,name:"video"})}},{key:"onFullscreenExit",value:function(){$(".header, .footer").removeClass("hide"),$(".hideOnFullScreen").show();var a=document.location.href;window.PearsonGL&&PearsonGL.globals&&PearsonGL.globals.comm&&PearsonGL.globals.comm.firePostMessageEvent({type:"close",dimensions:{},url:a,name:"video"})}},{key:"onTimeUpdate",value:function(a){}},{key:"hideStopPointToolTips",value:function(){this.jObject.find(".clip-clicker").length>0&&this.jObject.find(".clip-text").hide()}},{key:"onSeek",value:function(a){var b=this,c=void 0;if(void 0!==b.options.clip&&b.options.clip.length>0)for(c=0;c<=b.clipLength-1;c++)a<b.options.clip[c].time?b.options.clip[c].beenAt=!1:b.options.clip[c].beenAt=!0}},{key:"onClip",value:function(a,b,c,d,e,f){var g=void 0;this.hideStopPointToolTips(),a.stopAtStopPoints&&(a.options.clip[c].stop&&(a.canProgress||(a.pause(a.options.clip[c].time+(this.options.version?0:.1)),this.video[0].currentTime=a.options.clip[c].time+(this.options.version?0:.1)),a.isTouchDevice&&a.options.toggleControls&&a.options.controls&&this.controlsAnimateIn(a.jObject.find(".controls"))),void 0!==a.options.clip[c].text&&a.options.clip[c].text.length>0&&(a.jObject.find(".clip").find(".clip-text").dequeue().hide(),g=a.jObject.find('.clip[data-id="'+c+'"]').find(".clip-text"),a.updateAriaLiveRegion($(g[0]).text()+" "+a.labelOpts.stopPointDescriptionText),g.show().css("left","-"+g.width()/2+"px").delay(3e3).queue(function(){$(this).hide(),$(this).dequeue()})))}},{key:"getCaption",value:function(a){a||(a=this.options.vttFiles[0].srt);var b=this,c=a;c&&(c=PearsonGL.qtiEvaluator.evaluateAsset(c),$.ajax({type:"GET",dataType:"text",url:c,success:function(a){b.isDownloadedSrt=!0,b.playCC(a)},error:function(a){PearsonGL.logger.log("FAILED TO LOAD SRT"),b.isDownloadedSrt=!1}}))}},{key:"toSeconds",value:function(a){var b=0,c=void 0,d=void 0;if(a)for(c=a.split(":"),d=0;d<c.length;d++)b=60*b+parseFloat(c[d].replace(",","."));return b}},{key:"playCC",value:function(a){var b=this,c=void 0,d=""+a,e=void 0,f=void 0,g=void 0;for(d=d.replace(/\r\r\n/g,"\r\n"),d=d.replace(/\r\n[ \t]+\r\n|\r[ \t]+\r|\n[ \t]+\n/g,"<BR><BR>"),d=d.replace(/\r\n|\r|\n/g,"<BR>"),b.subtitles={},b.time={},e=d.split("<BR><BR>"),c=0;c<=e.length-1;c++)if(st=e[c].split("<BR>"),st.length>=2){if(n=st[0],g=st[1].split(" --\x3e ")[0],o=st[1].split(" --\x3e ")[1],t="",st.length>2)for(t=st[2],f=3;f<st.length;f++)t+="\n"+st[f];b.time[n]=b.toSeconds(g),b.subtitles[n]={n:n,o:b.toSeconds(o),t:t}}b.l=0;for(k in b.subtitles)b.l++}},{key:"showCaption",value:function(){var a=void 0,b=void 0,c=!1;if(this.l&&this.subtitles)if(b=this.getTime(),this.subtitles.hasOwnProperty(this.l)&&b-this.subtitles[this.l].o>=0)this.jObject.find("#cc").html("");else{for(a=1;a<=this.l+1;a++)if(this.subtitles.hasOwnProperty(a)&&b>=this.time[a]&&b<=this.subtitles[a].o){this.jObject.find("#cc").html(this.subtitles[a].t),c=!0;break}c||this.jObject.find("#cc").html("")}}},{key:"stop",value:function(){var a=this;setTimeout(function(){"hidden"===$("video").css("visibility")&&(a.isStop=!0)},50),this.isStop=!0,a.video&&a.video[0]&&this.sendAnalytics("video_played_"+this.currentTimeWatched+"_of_"+a.video[0].duration+"_seconds",this.currentTimeWatched),this.currentTimeWatched=0,this.isPlaying()&&this.pause()}},{key:"htmlFullScreenAPI",value:function(a,b){for(var c=["webkit","moz","ms","o",""],d=0,e=void 0,f=void 0,g=this;d<c.length&&!a[e];){if(e=b,""==c[d]&&(e=e.substr(0,1).toLowerCase()+e.substr(1)),e=c[d]+e,"undefined"!=(f=_typeof(a[e])))return c=[c[d]],"RequestFullScreen"==b?($(document).bind("fullscreenchange",function(){document.fullscreen||g.exitFullScreen()}),$(document).bind("mozfullscreenchange",function(){document.mozFullScreen||g.exitFullScreen()}),$(document).bind("webkitfullscreenchange",function(){document.webkitIsFullScreen||g.exitFullScreen()})):($(document).unbind("fullscreenchange"),$(document).unbind("mozfullscreenchange"),$(document).unbind("webkitfullscreenchange")),"function"==f?a[e]():a[e];d++}}},{key:"gadgetPageShowEvent",value:function(){this.isStop=!1,this.resize(),this.firstPlay&&!this.attemptToPlay||this.playing||!this.options.playOnlyOnce||!this.options.autoPlay||(this.onSeek(0),this.play(!0))}},{key:"resize",value:function(){var a=this.jObject;if(!this.isStop&&a.is(":visible")&&!this.isStop){var b=a.find(".player").width(),c=a.find(".player").height();null!==b&&null!==c&&(this.setProgressBarWidth(),this.isFullScreen?this.enterFullScreen():a.find(".player").find(".video").attr({width:b,height:c}).css({width:b,height:c}))}}},{key:"handleVideoClickEvent",value:function(){var a=this,b=this.jObject,c=b.find(".controls");if(this.options.disableClickToPlayPause&&this.isTouchDevice&&this.options.toggleControls)return void this.controlsAnimateIn(c);this.isPlaying()?(this.options.disableClickToPlayPause||this.pause(),this.isTouchDevice&&this.options.toggleControls&&this.controlsAnimateIn(c)):(this.options.disableClickToPlayPause||this.play(),this.isTouchDevice&&this.options.toggleControls&&setTimeout(function(){a.controlsAnimateOut(c)},2e3))}},{key:"doFancyProgressBar",value:function(){var a=this.jObject.find(".controls__progress"),b=a.find(".controls__progress--slider"),c=a.find("#progress-time"),d=a.find("#duration"),e=a.find(".clip-clicker").toArray();this.showExpandedProgressBar?(e.forEach(function(a,b){$(a).addClass("hide")}),b.css("margin-bottom","10px"),c.addClass("hide"),d.css("display","none")):(e.forEach(function(a,b){$(a).removeClass("hide")}),b.css("margin-bottom","0"),c.removeClass("hide"),d.css("display","inline"))}},{key:"setProgressBarWidth",value:function(){var a=this.jObject,b=a.find(".video"),c=a.find(".clicker-hit-area"),d=a.find(".controls").width()-parseFloat(a.find(".controls__progress--slider").css("margin-right"))-parseFloat(a.find(".controls__progress--slider").css("margin-left"));a.find("#progress").css("width",d+"px"),b.width()<=560?c.each(function(a,b){$(b).addClass("hide")}):c.each(function(a,b){$(b).removeClass("hide")})}}]),b}(PearsonGL.Gadget.GadgetBase),$.fn.videoComponent=function(){if(0!==arguments.length)if("object"===_typeof(arguments[0])){var a=void 0;a=arguments.length>1?new PearsonGL.Gadget.VideoComponent(this,arguments[0],arguments[1]):new PearsonGL.Gadget.VideoComponent(this,arguments[0]),$(this).data("video-component",a)}else if("string"==typeof arguments[0]){var b=$(this).data("video-component");if(b&&"function"==typeof b[arguments[0]])return b[arguments[0]].apply(b,Array.prototype.slice.call(arguments,1))}},window.PearsonGL=window.PearsonGL||{},PearsonGL.Gadget=PearsonGL.Gadget||{},PearsonGL.productConfig=PearsonGL.productConfig||{},PearsonGL.productConfig.videoPlayer=PearsonGL.productConfig.videoPlayer||{},PearsonGL.Gadget.VideoPlayer=function(a,b,c){var d=function(){if(""!==PearsonGL.utils.getQuerystring("gvideo")){if("true"===PearsonGL.utils.getQuerystring("gvideo"))return!0;if("false"===PearsonGL.utils.getQuerystring("gvideo"))return!1}return!!PearsonGL.productConfig.videoPlayer.useGlobalVideoPlayer},e=function(){if(void 0!==PearsonGL.utils.getQuerystring("togglecontrols")&&""!==PearsonGL.utils.getQuerystring("togglecontrols")){if("true"===PearsonGL.utils.getQuerystring("togglecontrols"))return!0;if("false"===PearsonGL.utils.getQuerystring("togglecontrols"))return!1}return!!PearsonGL.productConfig.videoPlayer.toggleControls||(!!b.toggleControls||void 0)},f=function(){if(void 0!==PearsonGL.utils.getQuerystring("showallsettings")&&""!==PearsonGL.utils.getQuerystring("showallsettings")){if("true"===PearsonGL.utils.getQuerystring("showallsettings"))return!0;if("false"===PearsonGL.utils.getQuerystring("showallsettings"))return!1}},g=function(){if(void 0!==PearsonGL.utils.getQuerystring("speechsynthesis")&&""!==PearsonGL.utils.getQuerystring("showallsettings")){if("true"===PearsonGL.utils.getQuerystring("speechsynthesis"))return!0;if("false"===PearsonGL.utils.getQuerystring("speechsynthesis"))return!1}},h=function(){if(void 0!==PearsonGL.utils.getQuerystring("dospeechsynthdemo")&&""!==PearsonGL.utils.getQuerystring("dospeechsynthdemo")){if("true"===PearsonGL.utils.getQuerystring("dospeechsynthdemo"))return!0;if("false"===PearsonGL.utils.getQuerystring("dospeechsynthdemo"))return!1}},i={gadgetName:"VideoPlayer",objectiveDescription:"A video player presents a single video.",useGlobalVideoPlayer:d(),toggleControls:e(),showAllSettingMenus:f(),useSpeechSynthesisForAD:g(),doSpeechSynthDemo:h()};b.toggleControls=i.toggleControls,$.extend(!0,i,b),PearsonGL.Gadget.VideoComponent.call(this,a,i,c)},PearsonGL.Gadget.VideoPlayer.prototype=Object.create(PearsonGL.Gadget.VideoComponent.prototype),PearsonGL.Gadget.VideoPlayer.prototype.initialize=function(a,b){if(void 0!==this.jObject){var c=this;PearsonGL.utils.getGlobalizedLabel("videoplayer_globalization",c.globalize.bind(this),this.options.runtimejson.lang)}this.getLearnerData({results:[{correctResponses:[{pattern:"Watched Video"}],learnerResponse:"Not Watched Video"}]})},PearsonGL.Gadget.VideoPlayer.prototype.globalize=function(a){this.globalizationComplete(a),this.jObject.addClass("video-player-identifier video-player").removeClass("video-component-identifier")},PearsonGL.Gadget.VideoPlayer.prototype.destroy=function(){this.jObject&&(this.jObject.children().remove(),this.jObject.removeClass("video-player-identifier"),this.jObject.removeAttr("tabindex"))},PearsonGL.Gadget.VideoPlayer.prototype.onFirstPlay=function(){this.isCommEnabled()&&this.setLearnerData({results:[{learnerResponse:"Watched Video",raw:this.options.scorm.interactions[0].objectives[0].score.max,progressMeasure:1,completionStatus:"completed",successStatus:"passed"}]})};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.DragAndDrop=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));if(!c)return _possibleConstructorReturn(e);if(PearsonGL.utils.hasParmContent()&&PearsonGL.parmMgr&&e.parseParmValues(c),e.labelOpts={checkAnswerText:"Check Answers",showCorrectAnswerText:"Show Correct Answers",showMyAnswerText:"Show My Answers",resetText:"Start Over",resetConfirmationText:"<p>Would you like to start over?</p>",closeToolTip:"Close",yesToolTip:"Yes",noToolTip:"No",selectedText:"SELECTED",correctText:"Correct",incorrectText:"Incorrect",turnoffaudio:"Screen reader users, press enter to disable audio on draggable tiles.",turnonaudio:"Screen reader users, press enter to enable audio on draggable tiles."},e.options=$.extend(!0,{gadgetName:"DragAndDrop",objectiveDescription1:"Drag and Drop with instant feedback. Targets disappear when correctly placed. The user can start over.",objectiveDescription2:"Drag and Drop with instant feedback. Tiles disappear when correctly placed. The user can start over.",objectiveDescription3:"Drag and Drop with free form. User can drop Tiles on any Target.",objectiveDescription4:"Drag and Drop with submitted answers. The user is allowed a set number of attempts.",objectiveDescription5:"Drag and Drop with instant feedback. The user is allowed a set number of attempts.",numberOfTries:1e11,randomize:!1,cloning:!0,draggableText:[],draggableImage:[],textLabels:[],imageLabels:[],draggables:[],droppables:[],labels:[],checkAnswer:{buttonText:"Check Answers"},showCorrectAnswer:{buttonText:"Show Correct Answers",otherButtonText:"Show My Answers"},reset:{buttonText:"Start Over",resetConfirmText:"<p>Would you like to start over?</p>"},selectedText:"SELECTED",correctText:"Correct",incorrectText:"Incorrect",closeToolTip:"Close",yesToolTip:"Yes",noToolTip:"No",turnoffaudio:"Screen reader users, press enter to disable audio on draggable tiles.",turnonaudio:"Screen reader users, press enter to enable audio on draggable tiles.",haveFeedBack:!1,feedBackPopUp:!1,showScore:!1,firstInCorrect:"",firstCorrect:"",finalInCorrect:"",finalCorrect:"",scoreText:"",popupAudio:{audioClass:".popupsound",isPopAudio:!0,trigger:!0},fadeOutFeedback:!1,scorm:{id:""},popupcontainment:".main"},e.options||{}),c.hasOwnProperty("cloning"))if(!0===c.cloning){if(c.hasOwnProperty("draggableImage"))for(optionsProperty in c.draggableImage)c.draggableImage[optionsProperty].cloning=!0;else if(c.hasOwnProperty("draggableText"))for(optionsProperty in c.draggableText)c.draggableText[optionsProperty].cloning=!0}else{if(c.hasOwnProperty("draggableImage"))for(optionsProperty in c.draggableImage)c.draggableImage[optionsProperty].cloning=!1;else if(c.hasOwnProperty("draggableText"))for(optionsProperty in c.draggableText)c.draggableText[optionsProperty].cloning=!1;c.cloning=!0}return e.jObject=$(a),e.initialize(c),e}return _inherits(b,a),_createClass(b,[{key:"initialize",value:function(a){var b=this;this.firstAttemptCorrect=!0,this.initGadget(this.options.gadgetName),PearsonGL.utils.getGlobalizedLabel("draganddrop_globalization",function(c){b.transferLabels(c),delete a.scorm,$.extend(!0,b.options,a),b.globalizationComplete()},this.options.runtimejson.lang)}},{key:"parseParmValues",value:function(a){var b=void 0,c=void 0,d=void 0;if(a.dragAndDropBackground&&(a.dragAndDropBackground=PearsonGL.qtiEvaluator.evaluateAsset(a.dragAndDropBackground)),a.backgroundTitle&&(a.backgroundTitle=PearsonGL.qtiEvaluator.replaceParameters(a.backgroundTitle)),a.longDesc&&(a.longDesc=PearsonGL.qtiEvaluator.replaceParameters(a.longDesc)),a.tileWidth=PearsonGL.qtiEvaluator.evaluateFloat(a.tileWidth).value,a.tileHeight=PearsonGL.qtiEvaluator.evaluateFloat(a.tileHeight).value,a.droppables)for(b=0;b<a.droppables.length;b++)c=a.droppables[b],c.droppableX=PearsonGL.qtiEvaluator.evaluateFloat(c.droppableX).value,c.droppableY=PearsonGL.qtiEvaluator.evaluateFloat(c.droppableY).value,c.title&&(c.title=PearsonGL.qtiEvaluator.replaceParameters(c.title));if(a.draggableText)for(b=0;b<a.draggableText.length;b++)c=a.draggableText[b],c.draggableX=PearsonGL.qtiEvaluator.evaluateFloat(c.draggableX).value,c.draggableY=PearsonGL.qtiEvaluator.evaluateFloat(c.draggableY).value,c.dragText&&(c.dragText.value=PearsonGL.qtiEvaluator.replaceParameters(c.dragText.value),c.dragText.audioComponent&&c.dragText.audioComponent.src&&(c.dragText.audioComponent.src=PearsonGL.qtiEvaluator.evaluateAsset(c.dragText.audioComponent.src),this.hasAudio=!0));if(a.draggableImage)for(b=0;b<a.draggableImage.length;b++)c=a.draggableImage[b],c.draggableX=PearsonGL.qtiEvaluator.evaluateFloat(c.draggableX).value,c.draggableY=PearsonGL.qtiEvaluator.evaluateFloat(c.draggableY).value,c.dragImage&&(c.dragImage.title&&(c.dragImage.title=PearsonGL.qtiEvaluator.replaceParameters(c.dragImage.title)),c.dragImage.src&&(c.dragImage.src=PearsonGL.qtiEvaluator.evaluateAsset(c.dragImage.src)),c.dragImage.audioComponent&&c.dragImage.audioComponent.src&&(c.dragImage.audioComponent.src=PearsonGL.qtiEvaluator.evaluateAsset(c.dragImage.audioComponent.src),this.hasAudio=!0));if(a.firstInCorrect&&(a.firstInCorrect=PearsonGL.qtiEvaluator.replaceParameters(a.firstInCorrect)),a.firstInCorrectAudio&&a.firstInCorrectAudio.src&&(a.firstInCorrectAudio.src=PearsonGL.qtiEvaluator.evaluateAsset(a.firstInCorrectAudio.src)),a.firstCorrect&&(a.firstCorrect=PearsonGL.qtiEvaluator.replaceParameters(a.firstCorrect)),a.firstCorrectAudio&&a.firstCorrectAudio.src&&(a.firstCorrectAudio.src=PearsonGL.qtiEvaluator.evaluateAsset(a.firstCorrectAudio.src)),a.finalInCorrect&&(a.finalInCorrect=PearsonGL.qtiEvaluator.replaceParameters(a.finalInCorrect)),a.finalInCorrectAudio&&a.finalInCorrectAudio.src&&(a.finalInCorrectAudio.src=PearsonGL.qtiEvaluator.evaluateAsset(a.finalInCorrectAudio.src)),a.finalCorrect&&(a.finalCorrect=PearsonGL.qtiEvaluator.replaceParameters(a.finalCorrect)),a.finalCorrectAudio&&a.finalCorrectAudio.src&&(a.finalCorrectAudio.src=PearsonGL.qtiEvaluator.evaluateAsset(a.finalCorrectAudio.src)),a.scoreText&&(a.finalInCorrect=PearsonGL.qtiEvaluator.replaceParameters(a.scoreText)),a.scoreTextAudio&&a.scoreTextAudio.src&&(a.scoreTextAudio.src=PearsonGL.qtiEvaluator.evaluateAsset(a.scoreTextAudio.src)),a.textLabels)for(b=0;b<a.textLabels.length;b++)d=a.textLabels[b],d.labelX=PearsonGL.qtiEvaluator.evaluateFloat(d.labelX).value,d.labelY=PearsonGL.qtiEvaluator.evaluateFloat(d.labelY).value,d.width&&(d.width=PearsonGL.qtiEvaluator.evaluateFloat(d.width).value),d.labelText&&(d.labelText.value&&(d.labelText.value=PearsonGL.qtiEvaluator.replaceParameters(d.labelText.value)),d.labelText.audioComponent&&d.labelText.audioComponent.src&&(d.labelText.audioComponent.src=PearsonGL.qtiEvaluator.evaluateAsset(d.labelText.audioComponent.src),this.hasAudio=!0));if(a.imageLabels)for(b=0;b<a.imageLabels.length;b++)d=a.imageLabels[b],d.labelX=PearsonGL.qtiEvaluator.evaluateFloat(d.labelX).value,d.labelY=PearsonGL.qtiEvaluator.evaluateFloat(d.labelY).value,d.labelImage&&(d.labelImage.title&&(d.labelImage.title=PearsonGL.qtiEvaluator.replaceParameters(d.labelImage.title)),d.labelImage.src&&(d.labelImage.src=PearsonGL.qtiEvaluator.evaluateAsset(d.labelImage.src)),d.labelImage.audioComponent&&d.labelImage.audioComponent.src&&(d.labelImage.audioComponent.src=PearsonGL.qtiEvaluator.evaluateAsset(d.labelImage.audioComponent.src),this.hasAudio=!0))}},{key:"transferLabels",value:function(a){var b=this.options,c=$.extend(!0,this.labelOpts,a);b.reset.buttonText=c.resetText,b.reset.resetConfirmText=c.resetConfirmationText,b.checkAnswer.buttonText=c.checkAnswerText,b.showCorrectAnswer.buttonText=c.showCorrectAnswerText,b.showCorrectAnswer.otherButtonText=c.showMyAnswerText,b.selectedText=c.selectedText,b.correctText=c.correctText,b.incorrectText=c.incorrectText,b.closeToolTip=c.closeToolTip,b.yesToolTip=c.yesToolTip,b.noToolTip=c.noToolTip,b.turnoffaudio=c.turnoffaudio,b.turnonaudio=c.turnonaudio}},{key:"globalizationComplete",value:function(){switch(this.jObject.data("gadget_options",this.options),this.jObject.addClass("dnd-identifier"),$("body").addClass("non-responsive"),this.options.dragAndDropVersion){case"onlyDragLeftAfter":this.options.objectiveDescription=this.options.objectiveDescription1;break;case"hideEverything":this.options.objectiveDescription=this.options.objectiveDescription2;break;case"freeDrag":this.options.objectiveDescription=this.options.objectiveDescription3;break;case"animatedDrag":this.options.objectiveDescription=this.options.objectiveDescription4;break;case"instant":this.options.objectiveDescription=this.options.objectiveDescription5;break;default:this.options.objectiveDescription=""}this.clone=[],this.haveDraggable=!1,this.zdex=20,this.tileTracker=[],this.scormData&&this.scormData.tilePattern?this.scormData={tilePattern:this.scormData.tilePattern,numberOfTries:this.options.numberOfTries}:this.scormData={tilePattern:{},numberOfTries:this.options.numberOfTries},this.numOfCorrect=0,this.reverCheck=!1,this.isOverDrop=!1,this.numOfTries=this.options.numberOfTries,this.popuptimeout=null,this.hasBeenInteractedWith=!1,this.isLoaded=!1,this.options.draggables=this.options.draggables.concat(this.options.draggableText,this.options.draggableImage),this.options.labels=this.options.labels.concat(this.options.textLabels,this.options.imageLabels),(""!==this.options.firstInCorrect&&""!==this.options.firstCorrect&&""!==this.options.finalInCorrect&&""!==this.options.finalCorrect||""!==this.options.scoreText)&&(this.options.haveFeedBack=!0),""!==this.options.finalInCorrect&&""!==this.options.finalCorrect&&1==this.options.numberOfTries&&(this.options.haveFeedBack=!0),""!==this.options.scoreText&&(this.options.showScore=!0),this.init(),this.getLearnerData({type:"matching"})}},{key:"fireEvent",value:function(a,b){var c=void 0,d={sourceId:this.gadgetUniqueId};c=a?b?"finalCorrect":"firstCorrect":b?"finalIncorrect":"incorrect","finalCorrect"!=c&&"finalIncorrect"!=c&&"firstCorrect"!=c||(this.jObject.addClass("completed"),"firstCorrect"==c&&this.jObject.addClass("first-correct"),"finalCorrect"==c&&this.jObject.addClass("final-correct")),$(window).trigger(c,d)}},{key:"destroy",value:function(){this.jObject&&(this.jObject.children().remove(),this.jObject.removeClass("dnd-identifier"),this.jObject.removeClass("has-bk"))}},{key:"init",value:function(a){var b=this,c=b.jObject,d=$("<div></div>"),e=$("<div></div>"),f=void 0,g=[],h=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=[],q=[],r=[],s=[],t=[],u=0,v=void 0,w=void 0;if(a&&(b.options.randomize=!1),b.addTurnOffAudioLink(),b.dragStatusLive=$('<div aria-live="assertive" class="drag-status-live hidden-label"></div>'),c.append(b.dragStatusLive),void 0!==b.options.dragAndDropBackground&&b.options.dragAndDropBackground.length>0)o=document.createElement("img"),o.src=b.options.dragAndDropBackground,$(o).attr("alt",b.options.backgroundTitle?b.options.backgroundTitle:"").addClass("bk-img"),c.append(o),$(o).load(function(){$(this).siblings(".drop:visible").css({height:this.height+"px",width:this.width+"px"}),$(this).siblings(".dnd-identifier:visible").css({width:this.width+"px"})}),c.addClass("has-bk"),$(o).Protector(),this.addLongDescription($(o),b.options.longDesc);else{var x=0,y=0,z=0,A=parseInt(b.options.tileHeight),B=parseInt(b.options.tileWidth);$(b.options.draggables).each(function(a){var c=parseInt(b.options.draggables[a].draggableY);0===x&&(x=c+A),x<c+A&&(x=c+A)}),$(b.options.draggableTextImage).each(function(a){var c=parseInt(b.options.draggableTextImage[a].draggableY);0===x&&(x=c+A),x<c+A&&(x=c+A)}),$(b.options.droppables).each(function(a){var c=parseInt(b.options.droppables[a].droppableY);0===y&&(y=c+A),y<c+A&&(y=c+A)}),$(b.options.labels).each(function(a){var c=parseInt(b.options.labels[a].labelY);0===z&&(z=c),z<c&&(z=c)}),v=Math.max(x,y,z),x=0,y=0,z=0,$(b.options.draggables).each(function(a){var c=parseInt(b.options.draggables[a].draggableX);0===x&&(x=c+B),x<c+B&&(x=c+B)}),$(b.options.draggableTextImage).each(function(a){var c=parseInt(b.options.draggableTextImage[a].draggableX);0===x&&(x=c+B),x<c+B&&(x=c+B)}),$(b.options.droppables).each(function(a){var c=parseInt(b.options.droppables[a].droppableX);0===y&&(y=c+B),y<c+B&&(y=c+B)}),$(b.options.labels).each(function(a){var c=parseInt(b.options.labels[a].labelX),d=parseInt(b.options.labels[a].width)||0;0===z&&(z=c+d),z<c&&(z=c+d)}),w=Math.max(x,y,z)}if(b.options.labels&&b.options.labels.length>0&&void 0!==b.options.labels[0].readOrder&&(t=b.options.labels,t.sort(function(a,b){return a.readOrder-b.readOrder})),$(b.options.labels).each(function(a){void 0!==this.labelText&&""!==this.labelText.value&&void 0!==this.labelText.value&&(f=$('<div class="labels"></div>'),this.width&&f.css("width",this.width+"px"),f.css({left:this.labelX+"px",top:this.labelY+"px"}),f.attr("data-readorder",b.options.labels[a].readOrder),this.labelText.noTabIndex=!0,f.richtextcomponent(this.labelText),void 0!==this.labelText.audioComponent&&void 0!==this.labelText.audioComponent.src&&""!==this.labelText.audioComponent.src&&f.find(".gadget-textblock").audioComponent(this.labelText.audioComponent),b.options.droppables&&b.options.droppables.length>0&&void 0!==b.options.droppables[0].readOrder?p.push(f):f.appendTo(c)),void 0!==this.labelImage&&""!==this.labelImage.src&&void 0!==this.labelImage.src&&(f=$('<div class="labels"></div>'),f.css({left:this.labelX+"px",top:this.labelY+"px"}),f.attr("data-readorder",b.options.labels[a].readOrder),this.labelImage.noTabIndex=!0,f.imagecomponent(this.labelImage),void 0!==this.labelImage.audioComponent&&""!==this.labelImage.audioComponent.src&&f.find(".image-class-wrapper").audioComponent(this.labelImage.audioComponent),b.options.droppables&&b.options.droppables.length>0&&void 0!==b.options.droppables[0].readOrder?p.push(f):f.appendTo(c))}),c.append('<div class="drag"></div><div class="drop"></div>'),b.options.hasOwnProperty("draggableTextImage")&&(b.options.draggableTextImage&&b.options.draggableTextImage.length>0&&void 0!==b.options.draggableTextImage[0].readOrder&&(r=b.options.draggableTextImage,r.sort(function(a,b){return a.readOrder-b.readOrder})),u=b.options.draggableTextImage.length,$(b.options.draggableTextImage).each(function(a){h=d.clone(),h.attr("id","d"+a).attr("unique-id","d"+a).attr("data-clone-state",b.options.draggableTextImage[a].cloning).attr("data-num-of-tries",b.options.numberOfTries).attr("data-inArray",a).attr("data-dragid",this.dragId).attr("data-readorder",b.options.draggableTextImage[a].readOrder).css({width:b.options.tileWidth+"px",height:b.options.tileHeight+"px",zIndex:b.zdex}).addClass("drag-item"),h.addClass("text-image-tile"),h.append('<div class="drag-bk"><div class="shade"></div></div><div class="marker" data-icon="ic-marker"></div>'),g.push(h),p.push(h),i=0}).each(function(a){if(!0===b.options.randomize){if(h=g[a=Math.floor(Math.random()*g.length)],b.options.labels.length>0&&i<b.options.labels.length&&void 0!==b.options.labels[i].readOrder)for(localReadOrder=parseInt($(h[0]).attr("data-readorder")),j=0;j<b.options.labels.length;j++){if(b.options.labels[j].readOrder===b.options.draggableTextImage[i].readOrder){var d=b.options.draggableTextImage.map(function(a){return a.readOrder}).indexOf(localReadOrder),e=b.options.labels.map(function(a){return a.readOrder}).indexOf(localReadOrder);h.attr({"data-top":b.options.draggableTextImage[d].draggableY,"data-left":b.options.draggableTextImage[d].draggableX}).css({top:b.options.draggableTextImage[d].draggableY+"px",left:b.options.draggableTextImage[d].draggableX+"px"});var f=b.options.labels[e].labelY,o=b.options.labels[e].labelX;b.options.labels[e].readOrder=b.options.labels[j].readOrder,b.options.labels[e].labelY=b.options.labels[j].labelY,b.options.labels[e].labelX=b.options.labels[j].labelX,b.options.labels[j].readOrder=localReadOrder,b.options.labels[j].labelY=f,b.options.labels[j].labelX=o,f=b.options.draggableTextImage[d].draggableY,o=b.options.draggableTextImage[d].draggableX,b.options.draggableTextImage[d].readOrder=b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].readOrder,b.options.draggableTextImage[d].draggableY=b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].draggableY,b.options.draggableTextImage[d].draggableX=b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].draggableX,b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].readOrder=localReadOrder,b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].draggableY=f,b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].draggableX=o;break}if(j===b.options.labels.length-1){if(b.options.draggableTextImage.length>0&&void 0!==b.options.draggableTextImage[0].readOrder){localReadOrder=parseInt($(h[0]).attr("data-readorder"));var p=b.options.draggableTextImage.map(function(a){return a.readOrder}).indexOf(localReadOrder),q=b.options.draggableTextImage[p].draggableY,r=b.options.draggableTextImage[p].draggableX;b.options.draggableTextImage[p].readOrder=b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].readOrder,b.options.draggableTextImage[p].draggableY=b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].draggableY,b.options.draggableTextImage[p].draggableX=b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].draggableX,b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].readOrder=localReadOrder,b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].draggableY=q,b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].draggableX=r}h.attr({"data-top":this.draggableY,"data-left":this.draggableX}).css({top:this.draggableY+"px",left:this.draggableX+"px"})}}else b.options.draggableTextImage.length>0&&void 0!==b.options.draggableTextImage[0].readOrder&&(localReadOrder=parseInt($(h[0]).attr("data-readorder")),b.options.draggableTextImage[Math.abs(g.length-b.options.draggableTextImage.length)].readOrder=localReadOrder),h.attr({"data-top":this.draggableY,"data-left":this.draggableX}).css({top:this.draggableY+"px",left:this.draggableX+"px"});g.splice(a,1)}else h=g[a],h.attr({"data-top":this.draggableY,"data-left":this.draggableX}).css({top:this.draggableY+"px",left:this.draggableX+"px"});i++,b.options.droppables&&b.options.droppables.length>0&&void 0===b.options.droppables[0].readOrder&&c.children(".drag").append(h),h.children().hasClass("drag-text")&&(k=2*parseFloat(h.find(".drag-text").css("left")),l=2*parseFloat(h.find(".drag-text").css("top")),m=b.options.tileWidth-k,n=b.options.tileHeight-l,h.find(".drag-text").css({height:n+"px",width:m+"px"}))})),g=[],(b.options.hasOwnProperty("draggableText")||b.options.hasOwnProperty("draggableImage"))&&(b.options.draggables&&b.options.draggables.length>0&&void 0!==b.options.draggables[0].readOrder&&(r=b.options.draggables,r.sort(function(a,b){return a.readOrder-b.readOrder})),$(b.options.draggables).each(function(a){h=d.clone(),h.attr("id","d"+(a+u)).attr("unique-id","d"+(a+u)).attr("data-clone-state",b.options.draggables[a].cloning).attr("data-num-of-tries",b.options.numberOfTries).attr("data-inArray",a).attr("data-dragid",this.dragId).attr("data-readorder",b.options.draggables[a].readOrder).css({width:b.options.tileWidth+"px",height:b.options.tileHeight+"px",zIndex:b.zdex}).addClass("drag-item"),h.append('<div class="drag-bk"><div class="shade"></div></div><div class="marker" data-icon="ic-marker"></div>'),g.push(h),p.push(h),i=0}).each(function(a){if(!0===b.options.randomize){if(h=g[a=Math.floor(Math.random()*g.length)],b.options.labels.length>0&&i<b.options.labels.length&&void 0!==b.options.labels[i].readOrder)for(localReadOrder=parseInt($(h[0]).attr("data-readorder")),j=0;j<b.options.labels.length;j++){if(b.options.labels[j].readOrder===b.options.draggables[i].readOrder){var d=b.options.draggables.map(function(a){return a.readOrder}).indexOf(localReadOrder),e=b.options.labels.map(function(a){return a.readOrder}).indexOf(localReadOrder);h.attr({"data-top":b.options.draggables[d].draggableY,"data-left":b.options.draggables[d].draggableX}).css({top:b.options.draggables[d].draggableY+"px",left:b.options.draggables[d].draggableX+"px"});var f=b.options.labels[e].labelY,o=b.options.labels[e].labelX;b.options.labels[e].readOrder=b.options.labels[j].readOrder,b.options.labels[e].labelY=b.options.labels[j].labelY,b.options.labels[e].labelX=b.options.labels[j].labelX,b.options.labels[j].readOrder=localReadOrder,b.options.labels[j].labelY=f,b.options.labels[j].labelX=o,f=b.options.draggables[d].draggableY,o=b.options.draggables[d].draggableX,b.options.draggables[d].readOrder=b.options.draggables[Math.abs(g.length-b.options.draggables.length)].readOrder,b.options.draggables[d].draggableY=b.options.draggables[Math.abs(g.length-b.options.draggables.length)].draggableY,b.options.draggables[d].draggableX=b.options.draggables[Math.abs(g.length-b.options.draggables.length)].draggableX,b.options.draggables[Math.abs(g.length-b.options.draggables.length)].readOrder=localReadOrder,b.options.draggables[Math.abs(g.length-b.options.draggables.length)].draggableY=f,b.options.draggables[Math.abs(g.length-b.options.draggables.length)].draggableX=o;break}if(j===b.options.labels.length-1){if(b.options.draggables.length>0&&void 0!==b.options.draggables[0].readOrder){localReadOrder=parseInt($(h[0]).attr("data-readorder"));var p=b.options.draggables.map(function(a){return a.readOrder}).indexOf(localReadOrder),q=b.options.draggables[p].draggableY,r=b.options.draggables[p].draggableX;b.options.draggables[p].readOrder=b.options.draggables[Math.abs(g.length-b.options.draggables.length)].readOrder,b.options.draggables[p].draggableY=b.options.draggables[Math.abs(g.length-b.options.draggables.length)].draggableY,b.options.draggables[p].draggableX=b.options.draggables[Math.abs(g.length-b.options.draggables.length)].draggableX,b.options.draggables[Math.abs(g.length-b.options.draggables.length)].readOrder=localReadOrder,b.options.draggables[Math.abs(g.length-b.options.draggables.length)].draggableY=q,b.options.draggables[Math.abs(g.length-b.options.draggables.length)].draggableX=r}h.attr({"data-top":this.draggableY,"data-left":this.draggableX}).css({top:this.draggableY+"px",left:this.draggableX+"px"})}}else b.options.draggables.length>0&&void 0!==b.options.draggables[0].readOrder&&(localReadOrder=parseInt($(h[0]).attr("data-readorder")),b.options.draggables[Math.abs(g.length-b.options.draggables.length)].readOrder=localReadOrder),h.attr({"data-top":this.draggableY,"data-left":this.draggableX}).css({top:this.draggableY+"px",left:this.draggableX+"px"});g.splice(a,1)}else h=g[a],h.attr({"data-top":this.draggableY,"data-left":this.draggableX}).css({top:this.draggableY+"px",left:this.draggableX+"px"});i++,b.options.droppables&&b.options.droppables.length>0&&void 0===b.options.droppables[0].readOrder&&c.children(".drag").append(h),h.children().hasClass("drag-text")&&(k=2*parseFloat(h.find(".drag-text").css("left")),l=2*parseFloat(h.find(".drag-text").css("top")),m=b.options.tileWidth-k,n=b.options.tileHeight-l,h.find(".drag-text").css({height:n+"px",width:m+"px"}))})),b.options.draggableTextImage&&b.options.draggableTextImage.length>0&&void 0!==b.options.draggableTextImage[0].readOrder)for(i=0;i<b.options.draggableTextImage.length;i++)$(p[i+b.options.labels.length][0]).attr("data-readorder",b.options.draggableTextImage[i].readOrder),$(p[i+b.options.labels.length][0]).css({top:b.options.draggableTextImage[i].draggableY+"px",left:b.options.draggableTextImage[i].draggableX+"px"}).attr({"data-top":b.options.draggableTextImage[i].draggableY,"data-left":b.options.draggableTextImage[i].draggableX});if(b.options.draggables&&b.options.draggables.length>0&&void 0!==b.options.draggables[0].readOrder)for(i=0;i<b.options.draggables.length;i++)$(p[i+b.options.labels.length+u][0]).attr("data-readorder",b.options.draggables[i].readOrder),$(p[i+b.options.labels.length+u][0]).css({top:b.options.draggables[i].draggableY+"px",left:b.options.draggables[i].draggableX+"px"}).attr({"data-top":b.options.draggables[i].draggableY,"data-left":b.options.draggables[i].draggableX});if(u>0?(r=b.options.draggableTextImage,r=r.concat(b.options.draggables)):r=b.options.draggables,b.options.labels&&b.options.labels.length>0&&void 0!==b.options.labels[0].readOrder&&b.options.labels.length>=b.options.draggables.length)for(i=0;i<b.options.draggables.length;i++)for(j=0;j<b.options.labels.length;j++)if(b.options.labels[j].readOrder===b.options.draggables[i].readOrder){$(p[j][0]).attr("data-readorder",b.options.labels[j].readOrder),$(p[j][0]).css({top:b.options.labels[j].labelY+"px",left:b.options.labels[j].labelX+"px"}).attr({"data-top":b.options.labels[j].labelY,"data-left":b.options.labels[j].labelX}),$(p[i+b.options.labels.length][0]).attr("data-readorder",b.options.draggables[i].readOrder),$(p[i+b.options.labels.length][0]).css({top:b.options.draggables[i].draggableY+"px",left:b.options.draggables[i].draggableX+"px"}).attr({"data-top":b.options.draggables[i].draggableY,"data-left":b.options.draggables[i].draggableX});break}if(b.options.droppables&&b.options.droppables.length>0&&void 0!==b.options.droppables[0].readOrder&&(s=b.options.droppables,s.sort(function(a,b){return a.readOrder-b.readOrder})),$(b.options.droppables).each(function(a){h=e.clone(),h.attr("id","t"+a).attr("data-dropid",this.dropId).attr("data-has-tile","false").addClass("drop-item"),h.append('<div class="drop-bk"><div class="shade"></div></div>'),void 0!==this.title&&h.append($('<label class="hidden-label"></label>').html(this.title)),h.attr("data-top",this.droppableY).attr("data-left",this.droppableX).css({width:b.options.tileWidth+"px",height:b.options.tileHeight+"px",top:this.droppableY+"px",left:this.droppableX+"px"}),h.attr("data-readorder",b.options.droppables[a].readOrder),b.options.droppables&&b.options.droppables.length>0&&void 0!==b.options.droppables[0].readOrder?p.push(h):c.children(".drop").append(h)}),c.children(".drop").css({height:v+"px",width:w+"px"}),c.css({width:w+"px"}),s=b.options.droppables,b.options.droppables&&b.options.droppables.length>0&&void 0!==b.options.droppables[0].readOrder)for(t=b.options.labels.concat(r),q=t.concat(s),q.sort(function(a,b){return a.readOrder-b.readOrder}),i=0;i<p.length;i++)for(j=0;j<q.length;j++)q[i].readOrder===parseInt($(p[j][0]).attr("data-readorder"))&&(r[0].readOrder<s[0].readOrder?q[i].readOrder<s[0].readOrder?c.children(".drag").append(p[j]):c.children(".drop").append(p[j]):q[i].readOrder<r[0].readOrder?c.children(".drop").append(p[j]):c.children(".drag").append(p[j]));$(window).bind("scroll.dnd",function(a){c.is(":visible")&&c.children(".drag").children().each(function(){if($(this).attr("data-top-offset",$(this).offset().top),$(this).attr("data-left-offset",$(this).offset().left),$(this).hasClass("drag-item")){var a=b.clone[parseFloat($(this).attr("data-clone"))];a.attr("data-top-offset",$(this).offset().top),a.attr("data-left-offset",$(this).offset().left)}})}),b.setup()}},{key:"addTurnOffAudioLink",value:function(){var a=this;if(this.isDisabledAudio=!1,this.hasAudio){var b=$('<div class="hidden-label disable-audio">'+this.options.turnoffaudio+"</div>");b.attr({role:"button",tabindex:"0"}).click(function(b){b.preventDefault(),b.stopPropagation(),a.enableDisableAudios()}).keydown(function(b){b.stopImmediatePropagation(),13===b.keyCode&&(b.preventDefault(),b.stopPropagation(),a.enableDisableAudios())}),this.jObject.append(b)}}},{key:"enableDisableAudios",value:function(){var a=this,b=this.jObject;a.isDisabledAudio?(a.isDisabledAudio=!1,b.find(".drag-item").each(function(){$(this).find("[tabindex]").attr("tabindex","0"),$(this).find("*").hasClass("audioToggleIdentifier")&&$(this).find(".audioToggleIdentifier").audioComponent("enableAudio")}),b.find(".disable-audio").html(this.options.turnoffaudio),b.find(".drag-status-live").html("Audio buttons enabled.")):(a.isDisabledAudio=!0,b.find(".drag-item").each(function(){$(this).find("[tabindex]").attr("tabindex","-1"),$(this).find("*").hasClass("audioToggleIdentifier")&&$(this).find(".audioToggleIdentifier").audioComponent("disableAudio")}),b.find(".disable-audio").html(this.options.turnonaudio),b.find(".drag-status-live").html("Audio buttons disabled.")),a.focusOnSelf(b.find(".disable-audio"),!0)}},{key:"focusOnSelf",value:function(a,b){this.jObject;a.delay(100).queue(function(c){b&&($("[tabindex='0'][role='button']").not(a).focus(),$(this).focus()),c()})}},{key:"setup",value:function(){var a=this,b=a.jObject,c=void 0,d=void 0,e=void 0,f=void 0;if(!0===a.options.haveFeedBack?!0===a.options.feedBackPopUp?(a.options.dialogType="feedback",b.dialogcomponent(a.options),b.append('<div class="dnd-footer"></div>'),a.options.popupAudio.runtimejson=a.options.runtimejson,$(a.options.popupAudio.audioClass).audioComponent(a.options.popupAudio,a.gadgetUniqueId),a.resultPopUp=b.find(".result-pop-up")):(b.append('<div class="result"></div>'),b.append('<div class="dnd-footer"></div>'),b.find(".result").attr("tabindex","0")):"animatedDrag"!==a.options.dragAndDropVersion&&"freeDrag"!==a.options.dragAndDropVersion&&"hideEverything"!==a.options.dragAndDropVersion&&"onlyDragLeftAfter"!==a.options.dragAndDropVersion||b.append('<div class="dnd-footer"></div>'),"freeDrag"!==a.options.dragAndDropVersion&&"hideEverything"!==a.options.dragAndDropVersion&&"onlyDragLeftAfter"!==a.options.dragAndDropVersion||(b.find(".dnd-footer").append('<div class="start-over"></div>'),b.find(".start-over").sliderbutton({buttonClassName:"start-over",slider:!0,buttonText:a.options.reset.buttonText,clickFunction:function(c){if(!1===c.jObject.hasClass("base-button-disable")){if(a.options.reset&&a.options.reset.disableResetMessage)return a.reset(),a.setDragStatusLive("start over button clicked, tiles move to starting position. Start over button"),void(c.options.enable=!1);var d={isModal:!0,resultsText:a.options.reset.resetConfirmText,dialogType:"confirm",closeToolTip:a.options.closeTooTip,noToolTip:a.options.noToolTip,yesToolTip:a.options.yesToolTip,keyPressEventHandler:function(){!0===a.haveDraggable&&(a.reset(),a.setDragStatusLive("start over button clicked, tiles move to starting position. Start over button")),b.find(".checker-pop-up").fadeOut(function(){$(this).remove()})},audioComponent:a.options.resetConfirmTextAudio?a.options.resetConfirmTextAudio:void 0},e=$('<div id="confirm-dlg"></div>');b.append(e),e.dialogcomponent(d),b.find(".checker-pop-up").fadeIn().focus()}}}),b.find(".start-over").sliderbutton("disable")),"animatedDrag"===a.options.dragAndDropVersion){var g=function(a){a&&h--,i&&j&&h<=0&&j.sliderbutton("enable")};b.find(".dnd-footer").append('<div class="check-answer"></div>'),a.options.checkAnswer.clickFunction=function(){a.sendAnalytics("clicked_check_answer_button"),!0===a.haveDraggable&&a.numOfTries>0&&a.check()},a.options.checkAnswer.buttonClassName="check-answer",b.find(".check-answer").sliderbutton(a.options.checkAnswer),b.find(".check-answer").sliderbutton("disable"),b.find(".dnd-footer").append('<div class="show-a show-correct-answer"></div>'),c=!0;var h=0,i=!1,j=void 0,k=void 0;a.options.showCorrectAnswer.clickFunction=function(l){if(a.sendAnalytics("showCorrectAnswerText"),!1!==l.options.enable){if(b.find(".result-pop-up").fadeOut(),b.find(".result").hide(),j=b.find(".show-a"),k=j.find(".button-text"),j.sliderbutton("disable"),i=!1,!1===c)c=!0,k.html(l.options.buttonText).attr("title",PearsonGL.utils.stripHTML(l.options.buttonText)),a.setDragStatusLive("show my answer button clicked, dropzones have your tiles"),b.children(".drop").children(":not(.labels)").each(function(){$(this).attr("data-dropid")===$(this).find(".ui-draggable").attr("data-dragid")&&($(this).find(".drag-item").show(),$(this).find(".correct-drag").hide()),f=$(this).find(".ui-draggable").attr("data-dragid"),"false"===d&&(h=b.find(".drag-item.was-drop").length,b.find(".drag-item.left-over").show())}),b.find(".drag-item.was-drop").each(function(){var c=b.find('.drop-item[id="'+$(this).data("wasDropAt")+'"]');$(this).animate({top:c.attr("data-top"),left:c.attr("data-left")},500,function(){a.addDraggableToDroppable($(this),c),$(this).addClass("drag-item-incorrect").draggable("disable").unbind("mouseenter mouseleave"),$(this).find(".marker").show(),g(!0)})});else if(!0===c){c=!1,k.html(l.options.otherButtonText).attr("title",PearsonGL.utils.stripHTML(l.options.otherButtonText)),a.setDragStatusLive("show correct answer button clicked, dropzones have correct tiles");var m=void 0,n=void 0,o=!1;b.children(".drop").children(":not(.labels)").each(function(){n=$(this).find(".drag-item").attr("data-dragid"),d=$(this).find(".drag-item").attr("data-clone-state"),e=$(this).find(".drag-item"),$(this).attr("data-dropid")!==n&&($(this).find(".correct-drag").show(),"false"===d?(m=$.grep(a.options.droppables,function(a){return a.dropId===n}),0===m.length?(e.data("wasDropAt",$(this).attr("id")),h++,a.resetDistractor(e,g),o=!0):$(this).find(".drag-item").hide()):$(this).find(".drag-item").hide())}),o&&function(){var c=b.find(".drag .drag-item").addClass("left-over"),d=void 0,e=void 0,f=void 0;for(d=0;d<c.length;d++)e=$(c[d]),f=$.grep(a.options.droppables,function(a){return a.dropId===e.attr("data-dragid")}),f.length>0&&e.hide()}()}PearsonGL.utils.initMathJax(k[0]),i=!0,g(!1)}},a.options.showCorrectAnswer.buttonClassName="show-correct-answer",b.find(".show-a").sliderbutton(a.options.showCorrectAnswer),b.find(".show-a").hide()}a.dragSetup(),a.addAccessibility(b),a.isLoaded=!0}},{key:"resetDistractor",value:function(a,b){var c=this,d=this.jObject,e=$(a),f=void 0,g=void 0,h=parseFloat(e.attr("data-top-offset"))-e.offset().top,i=parseFloat(e.attr("data-left-offset"))-e.offset().left;e.animate({top:h,left:i},500,function(){f=$(this).attr("data-dragid"),g=$(this).attr("data-clone-state"),"false"===g&&(newTile=c.clone[parseFloat($(this).attr("data-clone"))],d.find(".drag").append(newTile),c.makeDrag(newTile),$(newTile).addClass("was-drop").data("wasDropAt",$(this).data("wasDropAt")).draggable("disable")),$(this).remove(),b(!0)})}},{key:"check",value:function(){var a=this,b=a.jObject,c=!0,d=0,e=void 0,f=void 0,g=void 0,h=void 0;if(a.numOfTries--,b.children(".drop").children(":not(.labels)").each(function(i){a.scormData.tilePattern["'"+$(this).attr("id")+"'"]={},$(this).find(".drag-item").attr("data-dragid")===$(this).attr("data-dropid")?(a.scormData.tilePattern["'"+$(this).attr("id")+"'"].draggable=$(this).find(".drag-item").attr("id"),a.scormData.tilePattern["'"+$(this).attr("id")+"'"].disable=!0,a.scormData.tilePattern["'"+$(this).attr("id")+"'"].remove=!1,$(this).children(".drag-item").removeClass("drag-item-disable").addClass("drag-item-correct"),a.corOrIncorDrag($(this).children(".drag-item"),!0),$(this).find(".marker").show(),a.numOfTries>0&&($(this).droppable("disable"),$(this).find(".drag-item").draggable("disable"),$(this).find(".drag-item").unbind("mouseenter mouseleave"),$(this).children(".drag-item").delay(3e3).queue(function(a){$(this).removeClass("drag-item-correct").addClass("drag-item-disable"),$(this).find(".marker").hide(),a()}),b.find(".result-pop-up").removeClass("dialog-correct").addClass("dialog-incorrect"))):(c=!1,d++,a.scormData.tilePattern["'"+$(this).attr("id")+"'"].draggable=$(this).find(".drag-item").attr("id"),a.scormData.tilePattern["'"+$(this).attr("id")+"'"].disable=!1,a.scormData.tilePattern["'"+$(this).attr("id")+"'"].remove=!0,$(this).children(".drag-item").addClass("drag-item-incorrect"),a.corOrIncorDrag($(this).children(".drag-item"),!1),$(this).find(".marker").show(),a.numOfTries>0&&($(this).find(".drag-item").draggable("disable"),$(this).find(".drag-item").unbind("mouseenter mouseleave"),$(this).find(".drag-item").delay(2e3).queue(function(c){dragId=$(this).attr("data-dragid"),h=$(this).attr("data-clone-state"),e=parseFloat($(this).attr("data-top-offset"))-$(this).offset().top,f=parseFloat($(this).attr("data-left-offset"))-$(this).offset().left,$(this).animate({top:e,left:f},500,function(){$(this).remove()}),"false"===h&&(g=a.clone[parseFloat($(this).attr("data-clone"))],b.find(".drag").append(g),a.makeDrag(g)),c()})),b.find(".result-pop-up").removeClass("dialog-incorrect").addClass("dialog-correct")),a.numOfTries<=0&&($(this).droppable("disable"),$(this).find(".drag-item").draggable("disable"),$(this).find(".drag-item").unbind("mouseenter mouseleave")),$(this).removeClass("drop-item-over")}),a.scormData.numberOfTries=a.numOfTries,a.numOfCorrect=parseFloat(this.jObject.children(".drop").children(":not(.labels)").length)-d,a.onCheckAnswer(),!0===c)b.children(".drop").children(":not(.labels)").each(function(){$(this).children(".drag-item").dequeue().removeClass("drag-item-disable").addClass("drag-item-correct"),a.corOrIncorDrag($(this).children(".drag-item"),!0),$(this).find(".marker").show()}),a.numOfTries>0?a.fireEvent(!0,!1):a.fireEvent(!0,!0),a.writeMessage(this.jObject.children(".drop").children(":not(.labels)").length-d,c),b.find(".result-pop-up").removeClass("dialog-incorrect").addClass("dialog-correct");else if(a.numOfTries<=0){a.writeMessage(this.jObject.children(".drop").children(":not(.labels)").length-d,c),b.find(".show-a").show(),b.find(".check-answer").hide(),a.fireEvent(!1,!0);var i=[];b.children(".drop").children(":not(.labels)").each(function(b){if($(this).find(".drag-item").hasClass("drag-item-correct"))for(var c=0;c<=a.tileArray.length-1;c++)a.tileArray[c].id==$(this).find(".drag-item").attr("id")&&a.tileArray[c].counter++}).each(function(){if($(this).find(".drag-item").hasClass("drag-item-correct"))$(this).find(".correct-drag").remove();else{i=[];for(var b=0;b<=a.tileArray.length-1;b++)a.tileArray[b].dragid==$(this).attr("data-dropid")&&i.push(a.tileArray[b]);i.sort(function(a,b){return a.counter>b.counter?1:b.counter>a.counter?-1:0}),$(this).find(".correct-drag").each(function(a){$(this).attr("id")!==i[0].id&&$(this).remove()});for(var c=0;c<=a.tileArray.length-1;c++)a.tileArray[c].id==i[0].id&&a.tileArray[c].counter++}}),b.find(".result-pop-up").removeClass("dialog-correct").addClass("dialog-incorrect")}else a.writeMessage(this.jObject.children(".drop").children(":not(.labels)").length-d,c),b.find(".result-pop-up").removeClass("dialog-correct").addClass("dialog-incorrect");b.find(".check-answer").sliderbutton("disable"),a.haveDraggable=!1}},{key:"writeMessage",value:function(a,b,c){var d=this,e=d.jObject,f=void 0;if(d.numOfCorrect=a,b||(this.firstAttemptCorrect=!1),a==e.children(".drop").children(":not(.labels)").length&&this.firstAttemptCorrect)this.sendAnalytics("correct_first_time");else{var g="correct_XXofYY";g=g.replace(/\XX/g,d.numOfCorrect),g=g.replace(/\YY/g,e.children(".drop").children(":not(.labels)").length),this.sendAnalytics(g)}!0===this.options.haveFeedBack&&(!1===this.options.feedBackPopUp?!0===this.options.showScore?(f=d.options.scoreText,f=f.replace(/\XX/g,d.numOfCorrect),f=f.replace(/\YY/g,e.children(".drop").children(":not(.labels)").length),this.jObject.find(".result").html(f),void 0!==d.options.scoreTextAudio&&void 0!==d.options.scoreTextAudio.src&&""!==d.options.scoreTextAudio.src&&this.jObject.find(".result").audioComponent(d.options.scoreTextAudio,d.gadgetUniqueId)):this.numOfTries<=0?b?(this.jObject.find(".result").html(this.options.finalCorrect),void 0!==d.options.finalCorrectAudio&&void 0!==d.options.finalCorrectAudio.src&&""!==d.options.finalCorrectAudio.src&&this.jObject.find(".result").audioComponent(d.options.finalCorrectAudio,d.gadgetUniqueId),e.find(".result-pop-up").removeClass("dialog-incorrect").addClass("dialog-correct")):(this.jObject.find(".result").html(this.options.finalInCorrect),void 0!==d.options.finalInCorrectAudio&&void 0!==d.options.finalInCorrectAudio.src&&""!==d.options.finalInCorrectAudio.src&&this.jObject.find(".result").audioComponent(d.options.finalInCorrectAudio,d.gadgetUniqueId),e.find(".result-pop-up").removeClass("dialog-correct").addClass("dialog-incorrect")):this.numOfTries>=1&&(b?(this.jObject.find(".result").html(this.options.firstCorrect),void 0!==d.options.firstCorrectAudio&&void 0!==d.options.firstCorrectAudio.src&&""!==d.options.firstCorrectAudio.src&&this.jObject.find(".result").audioComponent(d.options.firstCorrectAudio,d.gadgetUniqueId),e.find(".result-pop-up").removeClass("dialog-incorrect").addClass("dialog-correct")):(this.jObject.find(".result").html(this.options.firstInCorrect),void 0!==d.options.firstInCorrectAudio&&void 0!==d.options.firstInCorrectAudio.src&&""!==d.options.firstInCorrectAudio.src&&this.jObject.find(".result").audioComponent(d.options.firstInCorrectAudio,d.gadgetUniqueId),e.find(".result-pop-up").removeClass("dialog-correct").addClass("dialog-incorrect"))):(!0===this.options.showScore?(f=d.options.scoreText,f=f.replace(/\XX/g,d.numOfCorrect),f=f.replace(/\YY/g,e.children(".drop").children(":not(.labels)").length),e.dialogcomponent("populateDialog",e.find(".result-text"),{value:f}),!0===b?d.resultPopUp.addClass("dialog-correct").removeClass("dialog-incorrect").show():!1===b&&d.resultPopUp.removeClass("dialog-correct").addClass("dialog-incorrect").show(),e.find(".result-pop-up").show(),e.find(".result-pop-up").focus(),$(d.options.popupAudio.audioClass).hasClass("audioToggleIdentifier")&&$(d.options.popupAudio.audioClass).audioComponent("play"),void 0!==d.options.scoreTextAudio&&void 0!==d.options.scoreTextAudio.src&&""!==d.options.scoreTextAudio.src&&this.jObject.find(".result-text").audioComponent(d.options.scoreTextAudio,d.gadgetUniqueId),e.dialogcomponent("removeTabsFromLabel")):(this.numOfTries<=0?b?(e.dialogcomponent("populateDialog",e.find(".result-text"),{value:this.options.finalCorrect}),void 0!==d.options.finalCorrectAudio&&void 0!==d.options.finalCorrectAudio.src&&""!==d.options.finalCorrectAudio.src&&this.jObject.find(".result-text").audioComponent(d.options.finalCorrectAudio,d.gadgetUniqueId),e.dialogcomponent("removeTabsFromLabel"),e.find(".result-pop-up").removeClass("dialog-incorrect").addClass("dialog-correct")):(e.dialogcomponent("populateDialog",e.find(".result-text"),{value:this.options.finalInCorrect}),void 0!==d.options.finalInCorrectAudio&&void 0!==d.options.finalInCorrectAudio.src&&""!==d.options.finalInCorrectAudio.src&&this.jObject.find(".result-text").audioComponent(d.options.finalInCorrectAudio,d.gadgetUniqueId),e.dialogcomponent("removeTabsFromLabel"),e.find(".result-pop-up").removeClass("dialog-correct").addClass("dialog-incorrect")):this.numOfTries>=1&&(b?(e.dialogcomponent("populateDialog",e.find(".result-text"),{value:this.options.firstCorrect}),void 0!==d.options.firstCorrectAudio&&void 0!==d.options.firstCorrectAudio.src&&""!==d.options.firstCorrectAudio.src&&this.jObject.find(".result-text").audioComponent(d.options.firstCorrectAudio,d.gadgetUniqueId),e.dialogcomponent("removeTabsFromLabel"),e.find(".result-pop-up").removeClass("dialog-incorrect").addClass("dialog-correct")):(e.dialogcomponent("populateDialog",e.find(".result-text"),{value:this.options.firstInCorrect}),void 0!==d.options.firstInCorrectAudio&&void 0!==d.options.firstInCorrectAudio.src&&""!==d.options.firstInCorrectAudio.src&&this.jObject.find(".result-text").audioComponent(d.options.firstInCorrectAudio,d.gadgetUniqueId),e.dialogcomponent("removeTabsFromLabel"),e.find(".result-pop-up").removeClass("dialog-correct").addClass("dialog-incorrect"))),e.find(".result-pop-up").show(),e.find(".result-pop-up").focus(),$(d.options.popupAudio.audioClass).hasClass("audioToggleIdentifier")&&$(d.options.popupAudio.audioClass).audioComponent("play")),e.find(".result-close").on("keypress",function(a){e.find(".result-pop-up").is(":visible")&&("instant"===d.options.dragAndDropVersion?c.focus():e.find(".dnd-footer").find(".base-button-inside-wrap:visible").focus())}),setTimeout(function(){e.bind("click.obj",function(a){e.find(".result-pop-up").is(":visible")&&!$(a.target).is(".result-pop-up *, .result-pop-up")&&(e.find(".result-pop-up").fadeOut(),e.unbind("click.obj"))})},100))),PearsonGL.utils.initMathJax(e.find(".result-pop-up")[0])}},{key:"dragSetup",value:function(){var a=this,b=a.jObject,c=0,d=void 0,e=void 0,f=void 0;a.tileArray=[],b.children(".drag").children(":not(.labels)").each(function(g){$(this).attr("data-clone",c),c++,$(this).attr("data-top-offset",$(this).offset().top),$(this).attr("data-left-offset",$(this).offset().left),d=$(this),b.children(".drop").find('[data-dropid="'+$(this).attr("data-dragid")+'"]').length>0&&b.children(".drop").find('[data-dropid="'+$(this).attr("data-dragid")+'"]').each(function(){if("false"===$(this).attr("data-has-tile"))return $(this).attr("data-has-tile","true"),e=$(this).offset().top,f=$(this).offset().left,d.attr({"data-target":$(this).attr("id"),"data-correcttop":e,"data-correctleft":f}),!1}),a.makeDrag($(this),!1),a.tileArray[g]={id:$(this).attr("id"),dragid:$(this).attr("data-dragid"),counter:0}}),a.dropSetup(),b.parents().hasClass("flexible-layout")&&setTimeout(function(){b.children(".drag").children(":not(.labels)").each(function(){$(this).attr("data-top-offset",$(this).offset().top),$(this).attr("data-left-offset",$(this).offset().left)})},1e3)}},{key:"makeDrag",value:function(a){var b=this,c=b.jObject,d=void 0,e=$(a),f=void 0,g=void 0,h=void 0;e.hasClass("drag-item")&&(b.clone[parseFloat(a.attr("data-clone"))]=a.clone()),e.mouseToTouch(),e.hover(function(){$(this).addClass("drag-item-over")},function(){$(this).removeClass("drag-item-over")}),e.hasClass("text-image-tile")?"textTop"===b.options.draggableTextImage[e.attr("data-inArray")].textImage?(e.addClass("text-tile"),e.append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),b.options.draggableTextImage[e.attr("data-inArray")].dragText.noTabIndex=!0,e.find(".drag-text-cell").richtextcomponent(b.options.draggableTextImage[e.attr("data-inArray")].dragText),void 0!==b.options.draggableTextImage[e.attr("data-inArray")].dragText.audioComponent&&void 0!==b.options.draggableTextImage[e.attr("data-inArray")].dragText.audioComponent.src&&""!==b.options.draggableTextImage[e.attr("data-inArray")].dragText.audioComponent.src&&(b.options.draggableTextImage[e.attr("data-inArray")].dragText.audioComponent.stopDefault=!1,e.find(".gadget-textblock").audioComponent(b.options.draggableTextImage[e.attr("data-inArray")].dragText.audioComponent,b.gadgetUniqueId)),e.attr({"data-default-title":b.options.draggableTextImage[e.attr("data-inArray")].dragText.value.replace(/<(?:.|\n)*?>/gm,"")}),e.find(".text-audio-component").append('<label class="drag-state hidden-label"></label>'),b.options.draggableTextImage[e.attr("data-inArray")].dragImage.protect=!1,e.addClass("image-tile"),e.append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),b.options.draggableTextImage[e.attr("data-inArray")].dragImage.noTabIndex=!0,e.find(".image-cell").imagecomponent(b.options.draggableTextImage[e.attr("data-inArray")].dragImage),void 0!==b.options.draggableTextImage[e.attr("data-inArray")].dragImage.audioComponent&&""!==b.options.draggableTextImage[e.attr("data-inArray")].dragImage.audioComponent.src&&(b.options.draggableTextImage[e.attr("data-inArray")].dragImage.audioComponent.stopDefault=!1,e.find(".image-class-wrapper").audioComponent(b.options.draggableTextImage[e.attr("data-inArray")].dragImage.audioComponent,b.gadgetUniqueId)),e.attr({"data-default-title":b.options.draggableTextImage[e.attr("data-inArray")].dragImage.title?b.options.draggableTextImage[e.attr("data-inArray")].dragImage.title:""})):(b.options.draggableTextImage[e.attr("data-inArray")].dragImage.protect=!1,e.addClass("image-tile"),e.append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),b.options.draggableTextImage[e.attr("data-inArray")].dragImage.noTabIndex=!0,e.find(".image-cell").imagecomponent(b.options.draggableTextImage[e.attr("data-inArray")].dragImage),void 0!==b.options.draggableTextImage[e.attr("data-inArray")].dragImage.audioComponent&&""!==b.options.draggableTextImage[e.attr("data-inArray")].dragImage.audioComponent.src&&(b.options.draggableTextImage[e.attr("data-inArray")].dragImage.audioComponent.stopDefault=!1,e.find(".image-class-wrapper").audioComponent(b.options.draggableTextImage[e.attr("data-inArray")].dragImage.audioComponent,b.gadgetUniqueId)),e.attr({"data-default-title":b.options.draggableTextImage[e.attr("data-inArray")].dragImage.title?b.options.draggableTextImage[e.attr("data-inArray")].dragImage.title:""}),e.addClass("text-tile"),e.append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),b.options.draggableTextImage[e.attr("data-inArray")].dragText.noTabIndex=!0,e.find(".drag-text-cell").richtextcomponent(b.options.draggableTextImage[e.attr("data-inArray")].dragText),void 0!==b.options.draggableTextImage[e.attr("data-inArray")].dragText.audioComponent&&void 0!==b.options.draggableTextImage[e.attr("data-inArray")].dragText.audioComponent.src&&""!==b.options.draggableTextImage[e.attr("data-inArray")].dragText.audioComponent.src&&(b.options.draggableTextImage[e.attr("data-inArray")].dragText.audioComponent.stopDefault=!1,e.find(".gadget-textblock").audioComponent(b.options.draggableTextImage[e.attr("data-inArray")].dragText.audioComponent,b.gadgetUniqueId)),e.attr({"data-default-title":b.options.draggableTextImage[e.attr("data-inArray")].dragText.value.replace(/<(?:.|\n)*?>/gm,"")}),e.find(".text-audio-component").append('<label class="drag-state hidden-label"></label>')):(void 0!==b.options.draggables[e.attr("data-inArray")].dragText&&""!==b.options.draggables[e.attr("data-inArray")].dragText.value&&void 0!==b.options.draggables[e.attr("data-inArray")].dragText.value&&(e.addClass("text-tile"),e.append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),b.options.draggables[e.attr("data-inArray")].dragText.noTabIndex=!0,e.find(".drag-text-cell").richtextcomponent(b.options.draggables[e.attr("data-inArray")].dragText),void 0!==b.options.draggables[e.attr("data-inArray")].dragText.audioComponent&&void 0!==b.options.draggables[e.attr("data-inArray")].dragText.audioComponent.src&&""!==b.options.draggables[e.attr("data-inArray")].dragText.audioComponent.src&&(b.options.draggables[e.attr("data-inArray")].dragText.audioComponent.stopDefault=!1,e.find(".gadget-textblock").audioComponent(b.options.draggables[e.attr("data-inArray")].dragText.audioComponent,b.gadgetUniqueId)),e.attr({"data-default-title":b.options.draggables[e.attr("data-inArray")].dragText.value.replace(/<(?:.|\n)*?>/gm,"")}),e.find(".text-audio-component").append('<label class="drag-state hidden-label"></label>')),void 0!==b.options.draggables[e.attr("data-inArray")].dragImage&&""!==b.options.draggables[e.attr("data-inArray")].dragImage.src&&void 0!==b.options.draggables[e.attr("data-inArray")].dragImage.src&&(b.options.draggables[e.attr("data-inArray")].dragImage.protect=!1,e.addClass("image-tile"),e.append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),b.options.draggables[e.attr("data-inArray")].dragImage.noTabIndex=!0,e.find(".image-cell").imagecomponent(b.options.draggables[e.attr("data-inArray")].dragImage),void 0!==b.options.draggables[e.attr("data-inArray")].dragImage.audioComponent&&""!==b.options.draggables[e.attr("data-inArray")].dragImage.audioComponent.src&&(b.options.draggables[e.attr("data-inArray")].dragImage.audioComponent.stopDefault=!1,e.find(".image-class-wrapper").audioComponent(b.options.draggables[e.attr("data-inArray")].dragImage.audioComponent,b.gadgetUniqueId)),e.attr({"data-default-title":b.options.draggables[e.attr("data-inArray")].dragImage.title?b.options.draggables[e.attr("data-inArray")].dragImage.title:""}))),b.options.hideBackground&&(e.addClass("no-bk"),e.css("border","transparent"),e.children(".drag-bk").hide()),e.draggable({containment:c,scroll:!0,start:function(a,e){b.zdex++,$(this).addClass("drag-item-down"),$(this).find("*").hasClass("audioToggleIdentifier")&&$(this).find(".audioToggleIdentifier").audioComponent("disableAudio"),b.options.cloning&&(g=$(this).attr("data-dragid"),"true"===(h=$(this).attr("data-clone-state"))&&$(this).parent().hasClass("drag")&&(d=b.clone[parseFloat($(this).attr("data-clone"))],c.children(".drag").append(d),b.makeDrag(d))),$(this).css("z-index",b.zdex),c.find(".result-pop-up").is(":visible")&&(c.find(".result-pop-up").fadeOut(),c.unbind("click.obj"),c.find(".result-pop-up").removeClass("dialog-correct").removeClass("dialog-incorrect")),$(this).parents().hasClass("drop-item")&&(c.find(".drop").css("z-index",b.zdex),$(this).parents(".drop-item").css("z-index",b.zdex))},drag:function(){$(this).removeClass("drag-item-down").addClass("drag-item-dragging")},revert:function(a){return c.find(".drop").css("z-index",""),c.find(".drop-item").css("z-index",""),!1===a?(b.reverCheck=!0,!0):(b.reverCheck=!1,!1)},stop:function(a){$(this).removeClass("drag-item-down drag-item-dragging drag-item-over"),f=$(this),setTimeout(function(){f.find("*").hasClass("audioToggleIdentifier")&&f.find(".audioToggleIdentifier").audioComponent("enableAudio")},300),!0===b.reverCheck&&(g=$(this).attr("data-dragid"),"true"===(h=$(this).attr("data-clone-state"))&&$(this).parent().hasClass("drag"))}});var i=null,j=null,k=!1;e.on("touchstart",function(a){j=i=a.originalEvent.touches[0].pageY}),e.on("touchmove",function(a){j=a.originalEvent.touches[0].pageY,0==k&&Math.abs(j-i)>30&&(k=!0),1==k&&window.scrollBy(0,5)}),e.on("touchend",function(a){k=!1}),e.attr({tabindex:"0",role:"button","aria-grabbed":"false"}),e.keydown(function(a){if(($(this).is(":focus")||$(this).is(":active"))&&!$(this).hasClass("ui-draggable-disabled"))switch(b.isDropping=!1,b.zdex++,$(this).css("z-index",b.zdex),$(this).parents().hasClass("drop-item")&&(c.find(".drop").css("z-index",b.zdex),$(this).parents(".drop-item").css("z-index",b.zdex)),b.collideDetect($(this),c.find(".drop").children()).length>0?$(b.collideDetect($(this),c.find(".drop").children())[0])[0]!==$(this).parent()[0]&&(b.isOverDrop=!0,c.find(".drop").children().removeClass("drop-item-over"),$(b.collideDetect($(this),c.find(".drop").children())[0]).addClass("drop-item-over")):(b.isOverDrop=!1,c.find(".drop").children().removeClass("drop-item-over")),a.keyCode){case 13:b.lastSelected=$(this),b.siblingLastSelected=$(this).prev(),0===b.siblingLastSelected.length&&(b.siblingLastSelected=c.find(".drag")),b.selectDrag($(this),!1),b.setDragStatusLive("selected"),!0===b.isOverDrop&&($(b.collideDetect($(this),c.find(".drop").children())[0]).hasClass("ui-droppable-disabled")||(b.isDropping=!0,b.isOverDrop=!1,b.onDropEvent($(b.collideDetect($(this),c.find(".drop").children())[0]),$(this))));break;case 39:$(this).css("left",parseFloat($(this).css("left"))+10),b.keyEventCloneChecker($(this));break;case 37:$(this).css("left",parseFloat($(this).css("left"))-10),b.keyEventCloneChecker($(this));break;case 38:a.preventDefault(),$(this).css("top",parseFloat($(this).css("top"))-10),b.keyEventCloneChecker($(this)),$(this).position()&&$(this).position().top<$(window).scrollTop()&&$(window).scrollTop($(this).position().top);break;case 40:a.preventDefault(),$(this).css("top",parseFloat($(this).css("top"))+10),b.keyEventCloneChecker($(this)),$(this).position()&&$(this).position().top+$(this).height()>$(window).scrollTop()+(window.innerHeight||document.documentElement.clientHeight)&&$(window).scrollTop($(this).position().top-(window.innerHeight||document.documentElement.clientHeight)+2*$(this).height())}}),e.click(function(a){a.stopImmediatePropagation(),a.preventDefault(),$(this).hasClass("ui-draggable-disabled")}),e.focus(function(a){$(this).hasClass("ui-draggable-disabled")||PearsonGL.utils.focusItemOn(this)}),e.blur(function(a){c.find(".drop").css("z-index",""),c.find(".drop-item").css("z-index",""),$(this).hasClass("ui-draggable-disabled")||($(this).removeClass("drag-item-dragging"),PearsonGL.utils.focusItemOff(this),c.find(".drop").children().removeClass("drop-item-over"),$(this).parent().hasClass("drop-item")?$(this).animate({top:"0px",left:"0px"},400,function(){$(this).css({top:"",left:""})}):$(this).parent().hasClass("drag")&&!1===b.isDropping&&$(this).animate({top:$(this).attr("data-top")+"px",left:$(this).attr("data-left")+"px"},400,function(){g=$(this).attr("data-dragid"),"true"===(h=$(this).attr("data-clone-state"))&&c.find(".drag").find('[unique-id="'+$(this).attr("unique-id")+'"]').length>=2&&$(this).parent().hasClass("drag")&&$(this).remove()}))}),b.isLoaded&&PearsonGL.utils.initMathJax(e[0])}},{key:"keyEventCloneChecker",value:function(a){var b=void 0;"true"===a.attr("data-clone-state")&&this.jObject.find(".drag").find('[unique-id="'+a.attr("unique-id")+'"]').length<2&&a.parent().hasClass("drag")&&(b=this.clone[parseFloat(a.attr("data-clone"))],this.jObject.children(".drag").append(b),this.makeDrag(b))}},{key:"revert",value:function(a,b){var c=this.jObject;a.animate({top:a.attr("data-top")+"px",left:a.attr("data-left")+"px"},600,function(){$(this).find(".marker").hide(),$(this).removeClass("drag-item-incorrect"),c.find('[unique-id="'+a.attr("unique-id")+'"]').attr("data-num-of-tries",parseFloat(a.attr("data-num-of-tries"))),!0===b&&$(this).remove()})}},{key:"addDraggableToDroppable",value:function(a,b){$(b).append(a),a.css({top:"",left:""})}},{key:"dropSetup",value:function(){var a=this,b=a.jObject,c=void 0,d=void 0,e=void 0;for(a.options.hideTargetBackground&&b.find(".drop-item").addClass("no-bk"),b.children(".drop").children(":not(.labels)").each(function(){$(this).droppable({accept:".drag-item",drop:function(b,c){a.onDropEvent($(this),c.draggable)},over:function(a,b){$(this).addClass("drop-item-over"),b.draggable.addClass("drag-item-overdrop")},out:function(a,b){$(this).removeClass("drop-item-over"),b.draggable.removeClass("drag-item-overdrop")}}),a.tileTracker.push({target:$(this).attr("id"),dropid:$(this).attr("data-dropid"),correct:[]})}),e=0;e<a.clone.length;e++)d=a.clone[e],b.find(".drop").find('[data-dropid="'+$(d).attr("data-dragid")+'"]').each(function(){c=$(d).clone(),a.makeDrag(c),$(c).css({display:"none",position:"",top:"",left:""}),$(c).removeClass("drag-item").addClass("correct-drag"),$(c).draggable("disable"),$(c).unbind("mouseenter mouseleave"),$(c).find(".marker").show(),$(c).find("*").hasClass("drag-state")&&$(c).find(".drag-state").html(a.options.correctText),$(c).attr("title",($(c).attr("title")?$(c).attr("title"):"")+" "+a.options.correctText).attr("alt",($(c).attr("alt")?$(c).attr("alt"):"")+" "+a.options.correctText),$(this).append(c)});b.children(".drop").children(":not(.labels)").each(function(b){a.tileTracker[b].target===$(this).attr("id")&&$(this).find(".correct-drag").each(function(){a.tileTracker[b].correct.push({tile:$(this).attr("id")})})}),b.find(".drop-item").click(function(b){$(this).hasClass("ui-droppable-disabled")||(b.preventDefault(),null!==a.lastSelected&&void 0!==a.lastSelected&&a.keyEventCloneChecker(a.lastSelected))}),b.find(".drop-item").attr({tabindex:"0",role:"button","aria-dropeffect":"move"}),a.options.cloning&&b.find(".drop-item").attr({"aria-dropeffect":"move copy"}),b.find(".drop-item").focus(function(a){PearsonGL.utils.focusItemOn(this)}),b.find(".drop-item").blur(function(a){PearsonGL.utils.focusItemOff(this)}),b.find(".drop-item").keydown(function(b){!$(this).is(":focus")&&!$(this).is(":active")||$(this).hasClass("ui-droppable-disabled")||13===b.keyCode&&(b.preventDefault(),null!==a.lastSelected&&void 0!==a.lastSelected&&(a.keyEventCloneChecker(a.lastSelected),a.onDropEvent($(this),a.lastSelected),"hideEverything"!==a.options.dragAndDropVersion&&a.setDragStatusLive("dropped"),a.options.haveFeedBack||a.focusOnSelf($(this),!0)))})}},{key:"onDropEvent",value:function(a,b){function c(c){var k=b.attr("data-dragid"),l=e.find('div[data-dropid="'+k+'"]:not(.ui-droppable-disabled)');l.length>0?(h=$(l[0]),f=parseFloat(h.offset().top)-a.offset().top,g=parseFloat(h.offset().left)-a.offset().left,b.animate({top:f,left:g},500,function(){h.droppable("disable").addClass("auto-correct"),b.draggable("disable"),d.addDraggableToDroppable(b,h),d.corOrIncorDrag(b,!0),c&&c();var a=$(l).attr("id");d.scormData.tilePattern["'"+a+"'"]={draggable:b.attr("id"),disable:!1,autoCorrect:!0,numberOfTries:d.numOfTries},d.saveLearnerData()})):(f=parseFloat(b.attr("data-top-offset"))-a.offset().top,g=parseFloat(b.attr("data-left-offset"))-a.offset().left,b.animate({top:f,left:g},500,function(){j=b.attr("data-clone-state"),"false"===j&&(i=d.clone[parseFloat(b.attr("data-clone"))],i.attr("data-num-of-tries",parseFloat(b.attr("data-num-of-tries"))),e.find(".drag").append(i),d.makeDrag(i),i.draggable("disable")),e.find('[unique-id="'+b.attr("unique-id")+'"]').attr("data-num-of-tries",parseFloat(b.attr("data-num-of-tries"))),$(this).remove()}))}var d=this,e=d.jObject,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0;switch(b.removeClass("drag-item-dragging"),b.find("*").removeClass("text-button-focus"),e.find(".drop").css("z-index",""),e.find(".drop-item").css("z-index",""),d.options.dragAndDropVersion){case"onlyDragLeftAfter":if(b.attr("data-num-of-tries",parseFloat(b.attr("data-num-of-tries"))-1),d.numOfTries=b.attr("data-num-of-tries"),a.attr("data-dropid")===b.attr("data-dragid"))d.addDraggableToDroppable(b,a),d.haveDraggable=!0,e.find(".start-over").sliderbutton("enable"),a.droppable("disable"),b.draggable("disable"),b.children(".drag-bk").hide(),a.children(".drop-bk").hide(),b.css("border","transparent"),a.css("border","transparent"),b.css("background","none"),a.css("background","none"),d.corOrIncorDrag(b,!0),"0"===d.numOfTries?d.fireEvent(!0,!0):d.fireEvent(!0,!1),d.writeMessage(e.find(".drop-item:not(.auto-correct) .drag-item:not(.correct-drag)").length,!0,a),d.scormData.tilePattern["'"+a.attr("id")+"'"]={},d.scormData.tilePattern["'"+a.attr("id")+"'"].draggable=b.attr("id"),d.scormData.tilePattern["'"+a.attr("id")+"'"].numberOfTries=d.numOfTries,d.saveLearnerData(),d.hasBeenInteractedWith=!0;else if(b.find(".marker").show(),b.addClass("drag-item-incorrect"),d.writeMessage(e.find(".drop-item:not(.auto-correct) .drag-item:not(.correct-drag)").length,!1,a),j=b.attr("data-clone-state"),"0"===d.numOfTries){var k=function(){d.haveDraggable=!0,e.find(".start-over").sliderbutton("enable"),b.children(".drag-bk").hide(),h.children(".drop-bk").hide(),b.css({border:"transparent",background:"none"}),h.css({border:"transparent",background:"none"})};d.addDraggableToDroppable(b,a),d.fireEvent(!1,!0),c(k)}else d.revert(b,j);break;case"hideEverything":a.attr("data-dropid")===b.attr("data-dragid")?(d.addDraggableToDroppable(b,a),d.haveDraggable=!0,e.find(".start-over").sliderbutton("enable"),a.droppable("disable"),b.draggable("disable"),a.hide(),d.corOrIncorDrag(b,!0),d.scormData.tilePattern["'"+a.attr("id")+"'"]={},d.scormData.tilePattern["'"+a.attr("id")+"'"].draggable=b.attr("id"),d.scormData.tilePattern["'"+a.attr("id")+"'"].numberOfTries=d.numOfTries,d.saveLearnerData(),d.hasBeenInteractedWith=!0,d.setDragStatusLive("correct, dropped")):(b.find(".marker").show(),b.addClass("drag-item-incorrect"),j=b.attr("data-clone-state"),d.revert(b,j),d.setDragStatusLive("incorrect"));break;case"freeDrag":a.children().hasClass("drag-item")&&(f=parseFloat(a.children(".drag-item").attr("data-top-offset"))-a.children(".drag-item").offset().top,g=parseFloat(a.children(".drag-item").attr("data-left-offset"))-a.children(".drag-item").offset().left,a.children(".drag-item").animate({top:f,left:g},500,function(){j=b.attr("data-clone-state"),"false"===j&&(i=d.clone[parseFloat($(this).attr("data-clone"))],e.find(".drag").append(i),d.makeDrag(i)),$(this).remove()})),d.addDraggableToDroppable(b,a),d.haveDraggable=!0,e.find(".start-over").sliderbutton("enable"),b.draggable("disable"),d.scormData.tilePattern["'"+a.attr("id")+"'"]={},d.scormData.tilePattern["'"+a.attr("id")+"'"].draggable=b.attr("id"),d.scormData.tilePattern["'"+a.attr("id")+"'"].numberOfTries=d.numOfTries,d.saveLearnerData(),d.hasBeenInteractedWith=!0;break;case"animatedDrag":a.children().hasClass("drag-item")&&a.children(".drag-item")[0]!==b[0]&&(f=parseFloat(a.children(".drag-item").attr("data-top-offset"))-a.children(".drag-item").offset().top,g=parseFloat(a.children(".drag-item").attr("data-left-offset"))-a.children(".drag-item").offset().left,a.children(".drag-item").stop(!0,!0).animate({top:f,left:g},500,function(){j=b.attr("data-clone-state"),"false"===j&&(i=d.clone[parseFloat($(this).attr("data-clone"))],e.find(".drag").append(i),d.makeDrag(i)),$(this).remove()})),d.addDraggableToDroppable(b,a),e.children(".drop").children(":not(.labels)").each(function(){if(!$(this).children().hasClass("drag-item"))return d.haveDraggable=!1,e.find(".check-answer").sliderbutton("disable"),!1;d.haveDraggable=!0}),!0===d.haveDraggable&&e.find(".check-answer").sliderbutton("enable"),d.scormData.tilePattern["'"+a.attr("id")+"'"]={},d.scormData.tilePattern["'"+a.attr("id")+"'"].draggable=b.attr("id"),d.scormData.tilePattern["'"+a.attr("id")+"'"].disable=!1,d.scormData.tilePattern["'"+a.attr("id")+"'"].remove=!1,d.scormData.numberOfTries=d.numOfTries;break;case"instant":b.attr("data-num-of-tries",parseFloat(b.attr("data-num-of-tries"))-1),d.numOfTries=b.attr("data-num-of-tries"),a.attr("data-dropid")===b.attr("data-dragid")?(d.addDraggableToDroppable(b,a),a.droppable("disable"),b.draggable("disable"),b.addClass("drag-item-correct"),d.corOrIncorDrag(b,!0),b.find(".marker").show(),d.setDragStatusLive("Correct"),"0"===d.numOfTries?d.fireEvent(!0,!0):d.fireEvent(!0,!1),d.writeMessage(e.find(".drop-item:not(.auto-correct) .drag-item.drag-item-correct").length,!0,a),d.scormData.tilePattern["'"+a.attr("id")+"'"]={},d.scormData.tilePattern["'"+a.attr("id")+"'"].draggable=b.attr("id"),d.scormData.tilePattern["'"+a.attr("id")+"'"].numberOfTries=d.numOfTries,d.saveLearnerData(),d.hasBeenInteractedWith=!0):(d.addDraggableToDroppable(b,a),b.find(".marker").show(),d.writeMessage(e.find(".drop-item:not(.auto-correct) .drag-item.drag-item-correct").length,!1,a),"0"===d.numOfTries?(c(),d.setDragStatusLive("incorrect, tile moved to correct dropzone"),d.fireEvent(!1,!0)):(b.addClass("drag-item-incorrect").delay(50).queue(function(c){f=parseFloat(b.attr("data-top-offset"))-a.offset().top,g=parseFloat(b.attr("data-left-offset"))-a.offset().left,b.animate({top:f,left:g},500,function(){j=b.attr("data-clone-state"),"false"===j&&(i=d.clone[parseFloat(b.attr("data-clone"))],i.attr("data-num-of-tries",parseFloat(b.attr("data-num-of-tries"))),e.find(".drag").append(i),d.makeDrag(i)),e.find('[unique-id="'+b.attr("unique-id")+'"]').attr("data-num-of-tries",parseFloat(b.attr("data-num-of-tries"))),$(this).remove()}),c()}),d.setDragStatusLive("incorrect")))}$(b).mouseToTouch(),a.removeClass("drop-item-over"),b.removeClass("drag-item-overdrop"),d.lastSelected=null,d.selectDrag(null,!0)}},{key:"selectDrag",value:function(a,b){var c=this,d=this.jObject;d.find(".drag-item").each(function(){$(this).removeClass("drag-item-selected"),$(this).removeClass("drag-item-dragging"),$(this).hasClass("ui-draggable-disabled")?$(this).removeAttr("tabindex"):($(this).attr("aria-grabbed","false"),$(this).find("*").hasClass("drag-state")&&$(this).find(".drag-state").html(""),$(this).hasClass("image-tile")&&$(this).find(".hidden-label").html($(this).attr("data-default-title")?$(this).attr("data-default-title"):""))}),b||(a.addClass("drag-item-selected"),a.attr("aria-grabbed","true"),c.focusOnSelf(a,!1)),c.sendAnalytics("clicked_draggable")}},{key:"corOrIncorDrag",value:function(a,b){var c=this;a.each(function(){$(this).attr("aria-grabbed","false"),$(this).find("*").hasClass("drag-state")&&$(this).find(".drag-state").html(""),$(this).hasClass("image-tile")&&$(this).find(".hidden-label").html($(this).attr("data-default-title")?$(this).attr("data-default-title"):""),b?($(this).find("*").hasClass("drag-state")&&$(this).find(".drag-state").html(c.options.correctText),$(this).hasClass("image-tile")&&$(this).find(".hidden-label").html(($(this).attr("data-default-title")?$(this).attr("data-default-title"):"")+" "+c.options.correctText),c.setDragStatusLive(c.options.correctText)):($(this).find("*").hasClass("drag-state")&&$(this).find(".drag-state").html(c.options.incorrectText),$(this).hasClass("image-tile")&&$(this).find(".hidden-label").html(($(this).attr("data-default-title")?$(this).attr("data-default-title"):"")+" "+c.options.incorrectText),c.setDragStatusLive(c.options.incorrectText))})}},{key:"collideDetect",value:function(a,b){var c=a,d=b,e=$([]),f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0;return!(!c||!d)&&(c.each(function(){f=$(this),g=f.offset(),h=g.left,i=g.top,j=h+f.outerWidth(),k=i+f.outerHeight(),l=parseFloat(f.height())/2+i,m=parseFloat(f.width())/2+h,d.not(f).each(function(){return n=$(this),o=n.offset(),p=o.left,q=o.top,r=p+n.outerWidth(),s=q+n.outerHeight(),h>=r||j<=p||i>=s||k<=q||(m<=r&&m>=p&&l<=s&&l>=q?(e=$([]),e.push(this),!1):void 0)})}),e)}},{key:"reset",value:function(){var a=this,b=a.jObject;this.jObject&&this.jObject.children().remove(),a.init(!0),a.scormData={tilePattern:{},numberOfTries:a.options.numberOfTries},this.sendAnalytics("clicked_reset_button"),b.find(".drag-item").attr("data-num-of-tries",a.options.numberOfTries),a.haveDraggable=!1}},{key:"onCheckAnswer",value:function(){this.saveLearnerData(),this.hasBeenInteractedWith=!0}},{key:"onAllDropFilled",value:function(){}},{key:"setDragStatusLive",value:function(a){this.dragStatusLive.html(a)}},{key:"setGadget",value:function(){var a=this,b=a.jObject,c=void 0,d=!0,e=!0,f=void 0,g=this.scormData,h=void 0,i=void 0;if(g)switch(a.hasBeenInteractedWith=!0,a.options.dragAndDropVersion){case"onlyDragLeftAfter":a.numOfCorrect=0,b.find(".drop").children().each(function(){void 0!==(h=g.tilePattern["'"+$(this).attr("id")+"'"])&&($(this).droppable("disable"),$(this).children(".drop-bk").hide(),$(this).css("background","none"),$(this).css("border","transparent"),c=g.tilePattern["'"+$(this).attr("id")+"'"].draggable,i=b.find(".drag").find("#"+c),i.draggable("disable").unbind("mouseenter mouseleave").css({background:"none",border:"transparent",position:"absolute",top:"",left:""}),i.children(".drag-bk").hide(),a.options.cloning&&(f=a.clone[parseFloat(b.find(".drag").find("#"+c).attr("data-clone"))],$(this).append(b.find(".drag").find("#"+c)),"true"===$(f).attr("data-clone-state")&&(b.find(".drag").append(f),a.makeDrag(f))),a.haveDraggable=!0,b.find(".start-over").sliderbutton("enable"),$(this).append(i),h.autoCorrect?($(this).addClass("auto-correct"),i.draggable("disable").addClass("drag-item-incorrect"),i.find(".marker").show(),a.corOrIncorDrag(i,!1)):(a.numOfCorrect++,a.corOrIncorDrag(i,!0)))});break;case"hideEverything":b.find(".drop").children().each(function(){void 0!==g.tilePattern["'"+$(this).attr("id")+"'"]&&($(this).droppable("disable"),$(this).hide(),c=g.tilePattern["'"+$(this).attr("id")+"'"].draggable,b.find(".drag").find("#"+c).draggable("disable"),b.find(".drag").find("#"+c).hide(),b.find(".drag").find("#"+c).unbind("mouseenter mouseleave"),b.find(".drag").find("#"+c).css({position:"absolute",top:"",left:""}),a.options.cloning&&(f=a.clone[parseFloat(b.find(".drag").find("#"+c).attr("data-clone"))],$(this).append(b.find(".drag").find("#"+c)),"true"===$(f).attr("data-clone-state")&&(b.find(".drag").append(f),a.makeDrag(f))),a.haveDraggable=!0,b.find(".start-over").sliderbutton("enable"))});break;case"freeDrag":b.find(".drop").children().each(function(){void 0!==g.tilePattern["'"+$(this).attr("id")+"'"]&&(c=g.tilePattern["'"+$(this).attr("id")+"'"].draggable,b.find(".drag").find("#"+c).draggable("disable"),b.find(".drag").find("#"+c).unbind("mouseenter mouseleave"),b.find(".drag").find("#"+c).css({position:"absolute",top:"",left:""}),a.options.cloning&&(f=a.clone[parseFloat(b.find(".drag").find("#"+c).attr("data-clone"))],$(this).append(b.find(".drag").find("#"+c)),"true"===$(f).attr("data-clone-state")&&(b.find(".drag").append(f),a.makeDrag(f))),a.haveDraggable=!0,b.find(".start-over").sliderbutton("enable"))});break;case"animatedDrag":parseFloat(g.numberOfTries)>=1?(b.find(".drop").children().each(function(){void 0!==g.tilePattern["'"+$(this).attr("id")+"'"]?(c=g.tilePattern["'"+$(this).attr("id")+"'"].draggable,!0===g.tilePattern["'"+$(this).attr("id")+"'"].disable?(b.find(".drag").find("#"+c).unbind("mouseenter mouseleave"),b.find(".drag").find("#"+c).css({position:"absolute",top:"",left:""}),b.find(".drag").find("#"+c).addClass("drag-item-disable"),b.find(".drag").find("#"+c).draggable("disable"),b.find(".drop").find("#"+$(this).attr("id")).droppable("disable"),a.options.cloning&&(f=a.clone[parseFloat(b.find(".drag").find("#"+c).attr("data-clone"))],b.find(".drop").find("#"+$(this).attr("id")).append(b.find(".drag").find("#"+c)),"true"===$(f).attr("data-clone-state")&&(b.find(".drag").append(f),a.makeDrag(f)))):(d=!1,!1===g.tilePattern["'"+$(this).attr("id")+"'"].remove?(b.find(".drag").find("#"+c).css({position:"absolute",top:"",left:""}),a.options.cloning&&(f=a.clone[parseFloat(b.find(".drag").find("#"+c).attr("data-clone"))],b.find(".drop").find("#"+$(this).attr("id")).append(b.find(".drag").find("#"+c)),"true"===$(f).attr("data-clone-state")&&(b.find(".drag").append(f),a.makeDrag(f)))):e=!1)):e=!1}),!0===d?b.find(".check-answer").sliderbutton("disable"):!0===e&&(a.haveDraggable=!0,b.find(".check-answer").sliderbutton("enable"))):parseFloat(g.numberOfTries)<=0&&(b.find(".drop").children().each(function(){void 0!==g.tilePattern["'"+$(this).attr("id")+"'"]&&(c=g.tilePattern["'"+$(this).attr("id")+"'"].draggable,b.find(".drag").find("#"+c).unbind("mouseenter mouseleave"),b.find(".drag").find("#"+c).css({position:"absolute",top:"",left:""}),b.find(".drag").find("#"+c).removeClass("drag-item-disable"),b.find(".drag").find("#"+c).attr("data-dragid")===$(this).attr("data-dropid")?(b.find(".drag").find("#"+c).addClass("drag-item-correct"),a.corOrIncorDrag(b.find(".drag").find("#"+c),!0)):(b.find(".drag").find("#"+c).addClass("drag-item-incorrect"),a.corOrIncorDrag(b.find(".drag").find("#"+c),!1)),b.find(".drag").find("#"+c).find(".marker").show(),b.find(".drag").find("#"+c).draggable("disable"),b.find(".drop").find("#"+$(this).attr("id")).droppable("disable"),a.options.cloning&&(f=a.clone[parseFloat(b.find(".drag").find("#"+c).attr("data-clone"))],b.find(".drop").find("#"+$(this).attr("id")).append(b.find(".drag").find("#"+c)),"true"===$(f).attr("data-clone-state")&&(b.find(".drag").append(f),a.makeDrag(f))))}),b.find(".show-a").show(),b.find(".check-answer").hide(),a.numOfTries=parseFloat(g.numberOfTries),a.check()),a.numOfTries=parseFloat(g.numberOfTries);break;case"instant":a.numOfCorrect=0,b.find(".drop").children().each(function(){(h=g.tilePattern["'"+$(this).attr("id")+"'"])&&($(this).droppable("disable"),c=h.draggable,i=b.find(".drag").find("#"+c),a.options.cloning&&(f=a.clone[parseFloat(b.find(".drag").find("#"+c).attr("data-clone"))],"true"===$(f).attr("data-clone-state")&&(b.find(".drag").append(f),a.makeDrag(f))),$(this).append(i),h.autoCorrect?($(this).addClass("auto-correct"),i.draggable("disable"),a.corOrIncorDrag(i,!1)):(i.draggable("disable").addClass("drag-item-correct"),a.corOrIncorDrag(i,!0),a.numOfCorrect++),i.find(".marker").show(),i.unbind("mouseenter mouseleave").css({position:"absolute",top:0,left:0}))})}}},{key:"parseLearnerData",value:function(){var a=void 0,b=this.options.scorm.suspendData.data;if("object"===(void 0===b?"undefined":_typeof(b)))for(a in b.tilePattern)if(!b.tilePattern[a].hasOwnProperty("draggable")){b=0;break}"object"===(void 0===b?"undefined":_typeof(b))&&(this.scormData=b,this.setGadget())}},{key:"stop",value:function(){this.saveLearnerData()}},{key:"saveLearnerData",value:function(){var a=this;this.isCommEnabled()&&function(){var b=void 0,c=void 0,d=void 0,e=void 0,f=[];for(a.options.scorm.suspendData.data=a.scormData,b=0;b<a.options.scorm.interactions.length;b++)c=[],d=[{pattern:[]}],a.jObject.find(".drop").children().each(function(){e=$(this).attr("data-dropid"),d[0].pattern.push([e,e]),$(this).find("*").hasClass("drag-item")&&c.push([$(this).find(".drag-item").attr("data-dragid"),e])}),result=a.getResult(a.options.scorm.interactions[b].objectives[0]),result.learnerResponse=c,result.correctResponses=d,f.push(result);a.setLearnerData({gadgetId:a.gadgetUniqueId,data:a.options.scorm,results:f})}()}},{key:"getResult",value:function(a){var b=0,c=this.jObject.find(".drop").children().length,d={};return this.jObject.find(".drop").children().each(function(){$(this).children().hasClass("drag-item")&&b++}),a.score.max!==a.score.raw?"animatedDrag"===this.options.dragAndDropVersion||"instant"===this.options.dragAndDropVersion||"onlyDragLeftAfter"===this.options.dragAndDropVersion?d.raw=a.score.max*(this.numOfCorrect/c):d.raw=a.score.max*(b/c):d.raw=a.score.raw,a.score.max-a.score.min!=0?d.scaled=(d.raw-a.score.min)/(a.score.max-a.score.min):d.scaled=1,d.progressMeasure=b/this.jObject.find(".drop").children().length,"animatedDrag"===this.options.dragAndDropVersion&&this.numOfTries>0&&(d.progressMeasure=this.numOfCorrect/c),"completed"!==a.completion_status&&(d.completionStatus="incomplete",parseFloat(d.progressMeasure)>=parseFloat(a.completionThreshold)&&(d.completionStatus="completed")),d.successStatus="failed",parseFloat(d.scaled)>=PearsonGL.globals.comm.getPassingScore()&&(d.successStatus="passed"),!0===this.giveAllPoints&&(d.raw=a.score.max,d.successStatus="passed",this.giveAllPoints=!1),d.result=d.scaled,d}}]),b}(PearsonGL.Gadget.GadgetBase);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.FillBlank=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));if(!c||!a)return _possibleConstructorReturn(e);e.labelOpts={maxLengthText:"Exceeds charactor limit.",checkAnswerText:"Check Answer",tryAgainButton:"Try Again",closeToolTip:"Close",showCorrectAnswer:"Show Correct Answers",showMyAnswer:"Show My Answers",firstIncorrectText:"Try again.",firstCorrectText:"Good job!",finalIncorrectText:"Not quite.",finalCorrectText:"That is correct!",scoreDisplayMessage:"You got XX of YY correct.",correctResponseText:"Your answer is correct!",incorrectResponseText:"Sorry, that is not correct.",correctAnswerShown:"Correct Answer Shown",correctAnswer:"Correct Answer",userSelectedCorrectAnswer:"Student Selected Correct",userSelectedIncorrectAnswer:"Student Selected Incorrect",disabledAnswer:"Disabled",afterScreenChangeMessage:"Answer feedback has been added to the screen.",afterScreenChangeMessageClear:"Incorrect feedback has been removed from the screen.",fibLabelContent:"Fill in the blank text field",isCorrectText:"is correct.",isIncorrectText:"is incorrect.",answerItemAlert:"The correct answers for this questions have been highlited and are {AA}, {BB}, {CC}, {DD}, {EE}, {FF}, {GG}, {HH}, {II}, {JJ}, {KK}"},e.options=$.extend(!0,{gadgetName:"Fill in the blank",objectiveDescription:PearsonGL.utils.formatString("Learner is presented with blank inputs to fill in or dropdown options to choose and is allowed {0} attempts.",e.options.numberOfTries,""),placeholder:/<input type="text" \/>/g,maxLengthText:"",shouldValidateMax:!1,timeOutTime:1e4,numberOfTries:2,button:{buttonText:"",showCorrectAnswer:{buttonText:"",buttonText2:""}},allCorrectFeedback:{final_correct_text:{audioComponent:{},imageComponent:{}}},multiFeedback:{first_incorrect_text:{value:"",audioComponent:{},imageComponent:{}},final_incorrect_text:{value:"",audioComponent:{},imageComponent:{}},final_correct_text:{value:"",audioComponent:{},imageComponent:{}},attempts_response_text:{value:"",audioComponent:{}}},correct_response_text:{value:"",audioComponent:{},imageComponent:{}},incorrect_response_text:{value:"",audioComponent:{},imageComponent:{}},attempts_response_text:{value:"",audioComponent:{}},correctResponse:[{pattern:{words:[]}}],results_text:{value:""},popupAudio:{audioClass:".popupsound",isPopAudio:!0,trigger:!0},fadeOutFeedback:!1,highlightingEnabled:!1,scoreFinalized:!1,tryAgainButtonMode:!1},e.options||{}),e.dataConversion(),e.inputAttributes=[],e.mathquillInput=[],e.picklists=[],e.picklistElems=[],e.mathJaxElems=[],e.mathJaxInUse=!1,e.allowSavingInputs=!0,e.isFirstAttempt=!0,e.readonlyCounter=0,e.quit=!1,e.scormData={numberOfTries:e.options.numberOfTries},e.MaxTries=e.options.numberOfTries,e.allCorrect=!1;var f=e.options.runtimejson;e.options.submitScoreOnFirstAttempt=f.submitScoreOnFirstAttempt,e.options.showCorrectAnswerOnFinalAttempt=f.showCorrectAnswerOnFinalAttempt,e.options.disableKeyboardOnMobile=f.disableKeyboardOnMobile,e.state={numberOfTries:e.options.numberOfTries,isSingleAttempt:1===e.options.numberOfTries,isMultipleAttempts:e.options.numberOfTries>1,isTryAgainButtonMode:!!e.options.button.tryAgainButton,isSurveyMode:null,useAllCorrectFeedback:!1,useScoreDisplayMessage:!!PearsonGL.utils.isNonEmptyString(e.options.attempts_response_text.value),submitScoreOnFirstAttempt:f.submitScoreOnFirstAttempt,showCorrectAnswerOnFinalAttempt:f.showCorrectAnswerOnFinalAttempt,disableKeyboardOnMobile:f.disableKeyboardOnMobile,user:{isFirstAttempt:!0,isFinalAttempt:!1,allAnswersCorrect:!1}},e.jObject=$(a),e.jObject.data("gadget_options",e.options),e.jObject.addClass("fill-blank-identifier");var g=0;return""!==PearsonGL.utils.getQuerystring("timeouttime","",!0)&&(g=PearsonGL.utils.getQuerystring("timeouttime","",!0),e.options.timeOutTime=g),e.initGadget(e.options.gadgetName),e.addAccessibility(e.jObject),PearsonGL.utils.getGlobalizedLabel("fillblank_globalization",function(a){$.extend(e.labelOpts,a),delete c.scorm,e.initializeComponents(c),e.transferLabels(),e.mergeAllMessages(),e.buildDom(e),e.getLearnerData({type:"fill-in"})},e.options.runtimejson.lang),e}return _inherits(b,a),_createClass(b,[{key:"dataConversion",value:function(){if(this.options.inputAttributes){if(!this.options.inputFields){this.options.inputFields=[];for(var a=this.options.inputAttributes.length,b=0;b<a;b++)this.options.inputFields.push({inputAttributes:[this.options.inputAttributes[b]]})}delete this.options.inputAttributes}}},{key:"initializeComponents",value:function(a){for(var b=this,c=0;c<this.options.paragraph.length;c++)this.options.paragraph[c].value=PearsonGL.qtiEvaluator.replaceParameters(this.options.paragraph[c].value);return this.options.maxLengthText&&(this.options.maxLengthText=PearsonGL.qtiEvaluator.replaceParameters(this.options.maxLengthText)),this.options.inputFields.forEach(function(a,c){var d=void 0,e=void 0,f=void 0;if(a.hasOwnProperty("inputAttributes")&&(d=a.inputAttributes[0],d.maxLength=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(d.maxLength)),d.correct_response=PearsonGL.qtiEvaluator.replaceParameters(d.correct_response),d.correct_response&&d.correct_response.length>0&&(b.state.isSurveyMode=!1),b.inputAttributes.push(d)),a.hasOwnProperty("mathquill")){if(e=a.mathquill[0],e.maxLength=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(e.maxLength)),e.correct_responses)for(var g=0;g<e.correct_responses.length;g++)e.correct_responses[g].correct_response=PearsonGL.qtiEvaluator.replaceParameters(e.correct_responses[g].correct_response),e.correct_responses[g].correct_response.length>0&&(b.state.isSurveyMode=!1);b.mathquillInput.push(e)}a.hasOwnProperty("picklists")&&(f=a.picklists[0],f.width=PearsonGL.qtiEvaluator.replaceParameters(f.width),f.height=PearsonGL.qtiEvaluator.replaceParameters(f.height),f.values.forEach(function(a,c){if(a.option=PearsonGL.qtiEvaluator.replaceParameters(a.option),PearsonGL.utils.isNonEmptyString(a.isCorrectExpression)){var d=PearsonGL.qtiEvaluator.evaluateBoolean(a.isCorrectExpression);a.isCorrect=d.value,a.isCorrect&&(b.state.isSurveyMode=!1)}else a.isCorrect&&(b.state.isSurveyMode=!1)}),b.picklists.push(f))}),this.state.isSurveyMode&&(this.state.isSingleAttempt=!0,this.state.user.allAnswersCorrect=!0,this.state.user.isFinalAttempt=!0),$.extend(!0,{},this.options)}},{key:"transferLabels",value:function(){var a=this.options,b=this.labelOpts,c=PearsonGL.utils;b.checkAnswerText=c.isNonEmptyString(a.button.buttonText)?a.button.buttonText:b.checkAnswerText,b.tryAgainButton=c.isNonEmptyString(a.button.tryAgainButton)?a.button.tryAgainButton:b.tryAgainButton,b.showCorrectAnswer=c.isNonEmptyString(a.button.showCorrectAnswer.buttonText)?a.button.showCorrectAnswer.buttonText:b.showCorrectAnswer,b.showMyAnswer=c.isNonEmptyString(a.button.showCorrectAnswer.buttonText2)?a.button.showCorrectAnswer.buttonText2:b.showMyAnswer,!c.isNonEmptyString(a.button.buttonText)&&(a.button.buttonText=b.checkAnswerText),!c.isNonEmptyString(a.button.tryAgainButton)&&(a.button.tryAgainButton=b.tryAgainButton),!c.isNonEmptyString(a.button.showCorrectAnswer.buttonText)&&(a.button.showCorrectAnswer.buttonText=b.showCorrectAnswer),!c.isNonEmptyString(a.button.showCorrectAnswer.buttonText2)&&(a.button.showCorrectAnswer.buttonText2=b.showMyAnswer),b.closeToolTip=c.isNonEmptyString(a.closeToolTip)?a.closeToolTip:b.closeToolTip,b.yesToolTip=c.isNonEmptyString(a.yesToolTip)?a.yesToolTip:b.yesToolTip,b.noToolTip=c.isNonEmptyString(a.noToolTip)?a.noToolTip:b.noToolTip,b.maxLengthText=c.isNonEmptyString(a.maxLengthText)?a.maxLengthText:b.maxLengthText,b.isCorrectText=c.isNonEmptyString(a.isCorrectText)?a.isCorrectText:b.isCorrectText,b.isIncorrectText=c.isNonEmptyString(a.isIncorrectText)?a.isIncorrectText:b.isIncorrectText,b.fibLabelContent=c.isNonEmptyString(a.fibLabelContent)?a.fibLabelContent:b.fibLabelContent,this.state.isSurveyMode&&(b.finalCorrectText=c.isNonEmptyString(a.allCorrectFeedback.final_correct_text.value)?a.allCorrectFeedback.final_correct_text.value:b.finalCorrectText),this.state.isSingleAttempt?this.state.useScoreDisplayMessage?b.scoreDisplayMessage=c.isNonEmptyString(a.attempts_response_text.value)?a.attempts_response_text.value:b.scoreDisplayMessage:(b.finalCorrectText=c.isNonEmptyString(a.correct_response_text.value)?a.correct_response_text.value:b.finalCorrectText,b.finalIncorrectText=c.isNonEmptyString(a.incorrect_response_text.value)?a.incorrect_response_text.value:b.finalIncorrectText):this.state.isMultipleAttempts?(b.firstIncorrectText=c.isNonEmptyString(a.multiFeedback.first_incorrect_text.value)?a.multiFeedback.first_incorrect_text.value:b.firstIncorrectText,this.state.useScoreDisplayMessage?b.scoreDisplayMessage=c.isNonEmptyString(a.multiFeedback.attempts_response_text.value)?a.multiFeedback.attempts_response_text.value:b.scoreDisplayMessage:(b.finalIncorrectText=c.isNonEmptyString(a.multiFeedback.final_incorrect_text.value)?a.multiFeedback.final_incorrect_text.value:b.finalIncorrectText,b.finalCorrectText=c.isNonEmptyString(a.multiFeedback.final_correct_text.value)?a.multiFeedback.final_correct_text.value:b.finalCorrectText)):(b.correctResponseText=c.isNonEmptyString(a.correct_response_text.value)?a.correct_response_text.value:b.correctResponseText,b.incorrectResponseText=c.isNonEmptyString(a.incorrect_response_text.value)?a.incorrect_response_text.value:b.incorrectResponseText)}},{key:"mergeAllMessages",value:function(){var a=this.options;this.state.isSingleAttempt?(this.options.final_correct=a.correct_response_text,this.options.final_incorrect=a.incorrect_response_text,this.options.attempts=a.attempts_response_text):this.state.isMultipleAttempts?(this.options.first_incorrect=a.multiFeedback.first_incorrect_text,this.options.final_incorrect=a.multiFeedback.final_incorrect_text,this.options.final_correct=a.multiFeedback.final_correct_text,this.options.attempts=a.multiFeedback.attempts_response_text):(this.isLegacy=!0,this.options.final_correct=a.correct_response_text,this.options.final_incorrect=a.incorrect_response_text,this.options.first_incorrect=a.correct_response_text,this.options.attempts=a.attempts_response_text),this.state.isSurveyMode&&(this.options.final_correct=a.allCorrectFeedback.final_correct_text)}},{key:"cleanUpUnicode",value:function(a){var b=/\\u([\d\w]{4})/gi;return a=a.replace(b,function(a,b){return String.fromCharCode(parseInt(b,16))})}},{key:"setPicklistHeight",value:function(){this.jObject.find(".picklist-wrapper").each(function(){var a=0,b=($(this).find(".picklist-options"),$(this).find(".picklist-options a")),c=$(this).attr("data-picklist-height");c&&void 0!==c?(b.each(function(){b.css("height",c+"px")}),$(this).find(".picklist-title").css("height",c+"px")):(b.css("height",""),b.each(function(){$(this).outerHeight(!0)>a&&(a=$(this).outerHeight(!0))}),b.each(function(){b.css("height",a+"px")}),$(this).find(".picklist-title").css("height",a+"px"))})}},{key:"checkForButtonState",value:function(){for(var a=this.jObject,b=a.find("input").length,c=!1,d=void 0,e=0;e<b;e++)if(d=a.find("input").get(e),""===$(d).val().trim()||$(d).hasClass("placeholder")){c=!0;break}for(var f=a.find(".picklist-wrapper"),g=0;g<f.length;g++)if(-1===$(f[g]).data("selectedIndex")){c=!0;break}for(var h=a.find(".component_mathquill"),i=0;i<h.length;i++){if(0==this.options.inputFields[$(h[i]).attr("data-index")].mathquill[0].mathquillComponent.getLatex().length){c=!0;break}}!c&&!this.allCorrect||this.options.numberOfTries<=0?a.find(".check-answer-button").sliderbutton("enable"):a.find(".check-answer-button").sliderbutton("disable"),a.find(".button-text").attr("label")===this.options.button.showCorrectAnswer.buttonText&&a.find(".check-answer-button").sliderbutton("enable")}},{key:"isFullyVisibleWidth",value:function(a,b){var c=a.offset(),d=c.left,e=a.width(),f=window.innerWidth,g=window.pageXOffset;return b?d>=g?"right":d+e<=f+g?"left":"neither":d>=g&&d+e<=f+g}},{key:"createMathQuill",value:function(a,b){var c=this,d=this.jObject;b.onFocus=function(a){var b=a.jObject;c.activeInputField=b.attr("data-index"),PearsonGL.utils.setActiveInputField(b),$(window).trigger({type:"inputFocus"}),d.hasClass("incorrect_input")&&(d.mathField.latex(""),d.removeClass("incorrect_input"),d.closest(".input-wrapper").removeClass("incorrect-wrap"))},b.onBlur=function(a){c.hasLoaded&&!c.options.showFeedback?(c.scormData.numberOfTries=0,c.saveLearnerData(!0)):c.hasLoaded&&c.saveLearnerData(!0)},b.hasMaxLengthExceeded=function(){c.options.shouldValidateMax||c.showMaxCharMessage(a)},b.onChange=function(a){c.checkForButtonState()},b.mathquillComponent=new PearsonGL.Gadget.ComponentMathquill(a,b),a.keyup(function(a){a.keyCode===PearsonGL.utils.keyCode.enter&&(d.closest(".page").find(".gadget-keypad").find(".ui-keypad-close").focus(),a.preventDefault())})}},{key:"removePicklistAriaAfterCheckAnswer",value:function(){}},{key:"createPicklist",value:function(a,b,c){var d=this,e=this.jObject,f="",g=[],h=b.picklistLabel||"",i="",j=void 0,k=$("<div id="+a+' class="picklist-wrapper" style="width:'+b.width+'px"></div>'),l=-1,m=-1;c=$(c).parent(),c.addClass("remove-me");var n=b.values.slice();for(j=0;j<n.length;j++)n[j].defaultIndex=j;for(parseInt(b.height)&&parseInt(b.height)>0&&(k.css("height",b.height+"px"),k.attr("data-picklist-height",b.height)),b.randomizeOptions&&PearsonGL.utils.shuffleArray(n),j=0;j<n.length;j++)n[j].defaultLabel&&(h=n[j].option,m="a"+j),n[j].isCorrect&&(l="a"+j),(n[j].option.indexOf("dcatmath")>=0||n[j].option.indexOf("</math>")>-1)&&(this.mathJaxInUse=!0,k.addClass("has-mathml")),g.push('<a id="a'+j+'" class="'+i+'" data-default="'+n[j].defaultIndex+'" tabindex="0" role="menuitem">'+n[j].option+"</a>");f=g.join("");var o=$('<div id="dropdown'+(a+1)+'" aria-live="assertive" class="picklist-title placeholder ic-fc-add" data-icon="ic-fc-add" style="width:'+b.width+'px">'+h+"</div>"),p=$('<div class="picklist-options" aria-label="submenu" role="menu" aria-labelledby="dropdown'+a+'" style="width:'+b.width+'px">'+f+"</div>");k.append(o).append(p),k.data("correctIndex",l),k.data("selectedIndex",m),k.data("defaultIndex",m),k.data("pickLabel",h),o.attr("aria-haspopup","true"),o.attr("aria-expanded","false"),this.picklistElems.push(k),$(c).after(k),handleMouseUpEvent=function(a){if(13===a.keyCode||"mouseup"===a.type){a.preventDefault(),o.removeClass("placeholder"),o.html($(a.currentTarget).html()),o.attr("aria-expanded","false");var b=$(a.currentTarget);b.closest(".picklist-wrapper").data("selectedIndex",b.attr("id")),p.css("visibility","hidden"),d.checkForButtonState(),d.saveLearnerData(!0),window.setTimeout(function(){e.audioPlaying?e.find(".audioToggleIdentifier").audioComponent("play"):e.find(".audioToggleIdentifier").audioComponent("pause")},20)}},p.find("a").on("mouseup keyup",handleMouseUpEvent),o.focus(function(a){var b=$(e).find(".picklist-wrapper").toArray();b.length>0&&b.forEach(function(b,c){var d=$(b).find("[id*='dropdown']").attr("id"),e=$(b).find(".picklist-options");d!==$(a.currentTarget).attr("id")&&$(e).css("visibility","visible")&&$(e).css("visibility","hidden")})}),p.css("visibility","visible"),o.sliderbutton({buttonClassName:"picklist-button",roleType:"listbox",slider:!1,clickFunction:function(a,b,c){if(a.options.enable){var d=$(c.target).closest(".picklist-wrapper");if(d.hasClass("correct_input")||d.hasClass("disabled"))return;d.removeClass("incorrect_input"),"visible"===p.css("visibility")?(o.attr("aria-expanded","false"),p.css("visibility","hidden")):(e.find(".picklist-options").css("visibility","hidden"),o.attr("aria-expanded","true"),p.css("visibility","visible")),e.find(".audioToggleIdentifier").audioComponent("isplaying")?e.audioPlaying=!0:e.audioPlaying=!1,e.find(".audioToggleIdentifier").audioComponent("pause")}}}),k.hasClass("has-mathml")&&(this.mathJaxElems.push(k),PearsonGL.utils.initMathJax(k[0]),o.sliderbutton("disable")),p.css("visibility","hidden")}},{key:"makeDisabledInputs",value:function(){this.jObject.find("input").prop("disabled",!0)}},{key:"clearDisabledInputs",value:function(){this.jObject.find("input").prop("disabled",!1)}},{key:"tryAgainReset",value:function(){var a=this,b=this.jObject;0!==this.options.numberOfTries&&(this.clearDisabledInputs(),this.clearScreenReadingFeedbackState(),b.find(".incorrect_input").val(""),b.find(".picklist-wrapper.incorrect_input").each(function(){var a=$(this).find(".picklist-title");$(this).removeClass("incorrect_input disabled"),$(this).closest(".picklist-wrapper").removeClass("incorrect-wrap"),$(this).data("selectedIndex",$(this).data("defaultIndex")),a.html($(this).data("pickLabel")),a.addClass("placeholder"),a.attr({"aria-haspopup":!0,"aria-expanded":!1,"aria-disabled":!1,role:"listbox"})}),b.find(".component_mathquill.incorrect_input").each(function(){var b=a.options.inputFields[$(this).attr("data-index")].mathquill[0].mathquillComponent;b.enable(),b.setLatex(" "),void 0!==b.options.placeholder&&b.placeholderReset(b.options.placeholder)}),b.find(".incorrect_input").each(function(){$(this).removeClass("incorrect_input disabled"),$(this).val(""),$(this).closest(".input-wrapper").removeClass("incorrect-wrap"),$(this).data("selectedIndex",$(this).data("defaultIndex"))}),b.find(".check-answer-button").sliderbutton("disable"))}},{key:"showCorrectShowMyAnswer",value:function(a){var b=this,c=this.jObject,d=void 0,e=void 0,f=void 0,g=void 0;if(a){for(g=0;g<this.options.inputFields.length;g++)e=this.options.inputFields[g],e.inputAttributes?(d=c.find('input[data-index="'+g+'"]'),d.length>0&&(d.removeClass("correct-answer").val(b.myanswers[g]),d.closest(".input-wrapper").hasClass("incorrect-wrap")&&d.closest(".input-wrapper").removeClass("correct-wrap"))):e.mathquill&&(f=e.mathquill[0],d=c.find('.component_mathquill[data-index="'+g+'"]'),d.length>0&&(d.removeClass("correct-answer"),f.mathquillComponent.setLatex(this.myanswers[g]),d.closest(".input-wrapper").hasClass("incorrect-wrap")&&d.closest(".input-wrapper").removeClass("correct-wrap")));for(g=0;g<this.picklistElems.length;g++)this.picklistElems[g].find(".picklist-title").html($(b.picklistElems[g]).find('a[id="'+b.picklistElems[g].data("selectedIndex")+'"]').html()),this.picklistElems[g].removeClass("correct-answer")}else{for(this.myanswers=[],g=0;g<this.options.inputFields.length;g++)if(e=this.options.inputFields[g],e.inputAttributes){if(f=e.inputAttributes[0],void 0===f.correct_response||""===f.correct_response)continue;responses=f.correct_response.split("|"),d=c.find('input[data-index="'+g+'"]'),this.myanswers[g]=d.val(),!d.hasClass("incorrect_input")&&d.hasClass("correct_input")||(d.addClass("incorrect_input").addClass("correct-answer").val(responses[0]),d.attr({disabled:"disabled",readonly:"readonly",tabindex:"-1"}).unbind(),!d.closest(".input-wrapper").hasClass("incorrect-wrap")&&d.parent(".input-wrapper").hasClass("correct-wrap")||d.closest(".input-wrapper").addClass("incorrect-wrap").addClass("correct-wrap"))}else if(e.mathquill){if(f=e.mathquill[0],void 0===f.correct_responses||0===f.correct_responses.length)continue;responses=f.correct_responses[0].correct_response,d=c.find('.component_mathquill[data-index="'+g+'"]'),this.myanswers[g]=f.mathquillComponent.getLatex(),!d.hasClass("incorrect_input")&&d.hasClass("correct_input")||(d.addClass("incorrect_input").addClass("correct-answer"),f.mathquillComponent.setLatex(responses),f.mathquillComponent.disable(),!d.closest(".input-wrapper").hasClass("incorrect-wrap")&&d.parent(".input-wrapper").hasClass("correct-wrap")||d.closest(".input-wrapper").addClass("incorrect-wrap").addClass("correct-wrap"))}for(g=0;g<this.picklistElems.length;g++)this.picklistElems[g].find(".picklist-title").html($(b.picklistElems[g]).find('a[id="'+b.picklistElems[g].data("correctIndex")+'"]').html()),this.picklistElems[g].addClass("disabled").attr({disabled:"disabled",readonly:"readonly",tabindex:"-1"}).unbind(),this.picklistElems[g].find(".picklist-title").sliderbutton("disable"),!this.picklistElems[g].hasClass("incorrect_input")&&this.picklistElems[g].hasClass("correct_input")||this.picklistElems[g].addClass("correct-answer").addClass("incorrect_input")}this.handleScreenReadingFeedbackState(!0,a)}},{key:"setCorrectResponse",value:function(){var a=$(this.jObject).find("input"),b=[],c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0;for(c=0;c<a.length;c++){for(g=!0,d=this.inputAttributes[c].correct_response?this.inputAttributes[c].correct_response.split("|"):[],e=$(a[c]).val(),$(a[c]).attr("placeholder")===e&&(e=""),h=0;h<d.length;h++)if(f=d[h],this.inputAttributes[c].case_sensitive||(e=e.toLowerCase(),f=f.toLowerCase()),f.trim()===e.trim()){b.push(e),g=!1;break}g&&b.push(d[0])}this.options.correctResponse[0].pattern={words:b}}},{key:"showPopUpTimeOut",value:function(){var a=this.jObject.find(".result-pop-up"),b=this;window.clearTimeout(this.popuptimeout),a.show(),this.jObject.find(".dialog-box-window").focus(),this.options.fadeOutFeedback&&(this.popuptimeout=window.setTimeout(function(){b.options.numberOfTries>0&&b.tryAgainReset(),a.fadeOut()},3e3))}},{key:"checkAnswers",value:function(a){var b=!0,c=!1,d=void 0,e=void 0,f=void 0,g=!1,h=this.jObject,i=void 0,j=void 0,k=void 0,l=void 0,m='<span class="hidden-label">'+this.labelOpts.isCorrectText+"</span>",n='<span class="hidden-label">'+this.labelOpts.isIncorrectText+"</span>",o="";for(this.correctMessageCount=0,this.numberCorrect=0,$(".max-length-found").unwrap().remove(),d=0;d<this.options.inputFields.length;d++)if(j=this.options.inputFields[d],j.picklists){selectedPicklist=h.find('.picklist-wrapper[id="'+d+'"]'),-1!=selectedPicklist.data("correctIndex")?-1!=selectedPicklist.data("correctIndex")&&selectedPicklist.data("correctIndex")===selectedPicklist.data("selectedIndex")?(selectedPicklist.removeClass("incorrect_input").addClass("correct_input disabled").attr({disabled:"disabled",readonly:"readonly",tabindex:"-1"}).unbind(),selectedPicklist.find(".picklist-title").sliderbutton("disable"),this.correctMessageCount++,this.numberCorrect++):(b=!1,selectedPicklist.removeClass("correct_input").addClass("incorrect_input disabled").attr({disabled:"disabled",readonly:"readonly",tabindex:"-1"}).unbind()):(selectedPicklist.removeClass("incorrect_input").addClass("correct_input disabled").attr({disabled:"disabled",readonly:"readonly",tabindex:"-1"}).unbind(),selectedPicklist.find(".picklist-title").sliderbutton("disable"),this.correctMessageCount++,this.numberCorrect++),0==this.options.numberOfTries&&selectedPicklist.find(".picklist-title").sliderbutton("disable");var p=selectedPicklist.find(".picklist-button").html();o=selectedPicklist.hasClass("correct_input")?p+" "+m:p+" "+n,selectedPicklist.find(".picklist-title").html(""+o),selectedPicklist.find(".picklist-button").attr({"aria-haspopup":!1,"aria-expanded":!1,"aria-disabled":!0,role:"presentation"})}else if(j.mathquill){var q=h.find(".component_mathquill[data-index='"+d+"']"),r=j.mathquill[0].mathquillComponent;f=j.mathquill[0].correct_responses;var s=j.mathquill[0].case_sensitive,t=j.mathquill[0].format_sensitive,u=r.getLatex();for(e=0;e<f.length;e++)if(g=!1,k=f[e].correct_response.trim(),r.compare(u,k,s,t)&&""!==u&&void 0===a){g=!0,this.numberCorrect++,q.removeClass("incorrect_input").addClass("correct_input"),q.closest(".input-wrapper").removeClass("incorrect-wrap").addClass("correct-wrap"),r.disable();break}g||this.state.isSurveyMode?this.correctMessageCount++:(b=!1,q.addClass("incorrect_input"),q.closest(".input-wrapper").addClass("incorrect-wrap")),""===u.trim()&&(c=!0)}else{if(j=j.inputAttributes[0],void 0===j.correct_response||"undefined"===j.correct_response||null===j.correct_response||""===j.correct_response)continue;for(f=j.correct_response.split("|"),i=j.case_sensitive,l=h.find('input[data-index="'+d+'"]'),e=0;e<f.length;e++)if(g=!1,currentValue=l.val().trim(),k=f[e].trim(),i||(currentValue=currentValue.toLowerCase(),k=k.toLowerCase()),currentValue===k&&""!==currentValue&&void 0===a){g=!0,this.numberCorrect++,l.removeClass("incorrect_input").addClass("correct_input").attr({disabled:"disabled",readonly:"readonly",tabindex:"-1"}).unbind(),l.closest(".input-wrapper").removeClass("incorrect-wrap").addClass("correct-wrap");break}g||this.state.isSurveyMode?this.correctMessageCount++:(b=!1,l.addClass("incorrect_input"),l.closest(".input-wrapper").addClass("incorrect-wrap")),""===l.val().trim()&&(c=!0)}return(c||this.options.numberOfTries==this.MaxTries)&&(this.quit?h.find("input").removeClass("placeholder"):(h.find("input").attr("class","fib-input"),h.find(".component_mathquill").removeClass("incorrect_input").removeClass("correct_input"))),h.find(".check-answer-button").sliderbutton("disable"),this.options.numberOfTries<=0&&!b&&(this.options.showCorrectAnswerOnFinalAttempt||(h.find(".button-text").empty().html(this.options.button.showCorrectAnswer.buttonText).addClass("show-correct-answers").attr("label",this.options.button.showCorrectAnswer.buttonText),h.find(".check-answer-button").sliderbutton("enable"))),a?b&&h.find(".check-answer-button").sliderbutton("enable"):(b||this.options.numberOfTries<=0)&&(h.find("input").attr({readonly:"readonly",tabindex:"-1"}).unbind(),this.allCorrect=!0),!0===b&&1===this.options.numberOfTries&&this.sendAnalytics("correct_first_time"),this.sendAnalytics("correct_"+this.numberCorrect+"of"+this.options.inputFields.length),this.sendAnalytics("clicked_check_answer_button"),b}},{key:"handleFeedbackState",value:function(a){var b=this,c=this.jObject,d=(PearsonGL.utils.isNonEmptyString(this.options.attempts_response_text.value),!1),e=!1,f=!1,g={},h="";c.find(".picklist-options").css("visibility","hidden"),this.options.numberOfTries--,this.options.numberOfTries<=0&&(e=!0,this.state.user.isFinalAttempt=!0),c.find(".dialog-box-window").fadeOut();var i=c.find(".button-text");if(c.find(".show-correct-answers").length>0)return b.sendAnalytics("clicked_show_answer_button"),c.find(".show-correct-answers").addClass("show-incorrect-answers").removeClass("show-correct-answers"),i.empty().html(this.options.button.showCorrectAnswer.buttonText2).attr("label",this.options.button.showCorrectAnswer.buttonText2),PearsonGL.utils.initMathJax(i[0]),void b.showCorrectShowMyAnswer(!1);if(c.find(".show-incorrect-answers").length>0)return c.find(".show-incorrect-answers").addClass("show-correct-answers").removeClass("show-incorrect-answers"),i.empty().html(this.options.button.showCorrectAnswer.buttonText).attr("label",this.options.button.showCorrectAnswer.buttonText),PearsonGL.utils.initMathJax(i[0]),void b.showCorrectShowMyAnswer(!0);this.state.isTryAgainButtonMode&&this.options.numberOfTries>0&&(c.find(".check-answer-button").hide(),c.find(".tryagain-button").show(),this.makeDisabledInputs()),d=!a.complete&&this.checkAnswers(),d&&this.state.isTryAgainButtonMode&&(c.find(".check-answer-button").show(),c.find(".tryagain-button").hide()),this.state.isSurveyMode&&(d=!0,c.find("input").removeClass("incorrect_input").addClass("correct_input"),c.find(".input-wrapper").removeClass("incorrect-wrap").addClass("correct-wrap"));var j=this.options;this.state.useScoreDisplayMessage?this.state.useScoreDisplayMessage&&(h=this.labelOpts.scoreDisplayMessage,h=h.replace(/\XX/g,this.correctMessageCount),h=h.replace(/\YY/g,this.totalCorrect),g.value=h,g.audioComponent=j.attempts.audioComponent,c.find(".result-pop-up").removeClass("dialog-correct").removeClass("dialog-incorrect")):this.state.isSurveyMode?(g.value=this.labelOpts.finalCorrectText,g.final_correct=j.final_correct,g.audioComponent=j.final_correct.audioComponent,j.final_correct.imageComponent.hasOwnProperty("src")&&j.final_correct.imageComponent.src.length>0&&(g.imageComponent=j.final_correct.imageComponent)):this.state.user.isFirstAttempt&&d?(g.value=this.labelOpts.finalCorrectText,g.final_correct=j.final_correct,g.audioComponent=j.final_correct.audioComponent,j.final_correct.imageComponent.hasOwnProperty("src")&&j.final_correct.imageComponent.src.length>0&&(g.imageComponent=j.final_correct.imageComponent),this.state.user.isFirstAttempt=!1):e||d?!e&&this.isFirstAttempt||!d?!e&&this.isFirstAttempt||d||(g.value=this.labelOpts.finalIncorrectText,g.final_incorrect=this.options.final_incorrect,g.audioComponent=this.options.final_incorrect.audioComponent,j.final_incorrect.imageComponent.hasOwnProperty("src")&&j.final_incorrect.imageComponent.src.length>0&&(g.imageComponent=j.final_incorrect.imageComponent)):(g.value=this.labelOpts.finalCorrectText,g.final_correct=this.options.final_correct,g.audioComponent=this.options.final_correct.audioComponent,j.final_correct.imageComponent.hasOwnProperty("src")&&j.final_correct.imageComponent.src.length>0&&(g.imageComponent=j.final_correct.imageComponent)):(g.value=this.labelOpts.firstIncorrectText,g.first_incorrect=j.first_incorrect,g.audioComponent=j.first_incorrect.audioComponent,j.first_incorrect.imageComponent.hasOwnProperty("src")&&j.first_incorrect.imageComponent.src.length>0&&(g.imageComponent=j.first_incorrect.imageComponent)),f=this.isFirstAttempt,this.isFirstAttempt=!1,$(this.options.popupAudio.audioClass).audioComponent("play"),this.options.numberOfTries>0?d?(this.options.scorm.interactions.length>0&&this.options.scorm.interactions[0].objectives.length>0&&(this.options.numberOfTries=0,this.scormData.numberOfTries=0,this.setCorrectResponse()),this.options.results_text=g,c.find(".check-answer-button").sliderbutton("disable")):(this.options.results_text=g,this.scormData.numberOfTries=this.options.numberOfTries):(this.scormData.numberOfTries=this.options.numberOfTries,this.options.results_text=g,d&&(c.find(".check-answer-button").sliderbutton("disable"),b.options.scorm.interactions.length>0&&this.options.scorm.interactions[0].objectives.length),this.setCorrectResponse()),this.saveLearnerData(!1);var k=(this.options.results_text,void 0);for(var l in g)switch(l){case"first_correct":case"first_incorrect":case"final_correct":case"final_incorrect":g=$.extend({},g[l],g)}g.noTabIndex=!0,g.closeToolTip=this.labelOpts.closeToolTip,g.imageComponent=g.imageComponent||{},g.audioComponent=g.audioComponent||{},PearsonGL.utils.isNonEmptyString(g.value),k=PearsonGL.utils.isNonEmptyString(g.imageComponent.src),PearsonGL.utils.isNonEmptyString(g.audioComponent.src),g.dialogType=k?"animated":"feedback",g.dialogIsCorrect=d,g.resultsText=g.value,g.textMessage={value:g.value,audioComponent:g.audioComponent},k&&(g.doAnimate=!!g.imageComponent.fps,g.imageComponent.loops=1,g.dialogUnits="pixels"),this.handleScreenReadingFeedbackState(!1),c.find(".result-pop-up").remove(),c.dialogcomponent(g);var m=c.find(".result-pop-up"),n=m.find(".result-text");n.removeAttr("tabindex"),PearsonGL.utils.initMathJax(n[0]),this.showPopUpTimeOut(),this.state.isTryAgainButtonMode||c.find(".result-pop-up").off("closed").on("closed",function(){b.options.numberOfTries>0&&b.tryAgainReset()}),f&&d?this.fireEvent(!0,!0):d&&this.fireEvent(!0,!1),!d&&e?(this.fireEvent(!1,!1),this.options.showCorrectAnswerOnFinalAttempt&&this.showCorrectShowMyAnswer(!1)):d||e||this.fireEvent(!1,!0),this.options.submitScoreOnFirstAttempt&&!this.options.scoreFinalized&&(this.options.scoreFinalized=!0,this.scormData.scoreFinalized=!0)}},{key:"showMaxCharMessage",value:function(a){var b=this;$(".max-length-found").unwrap().remove(),a.wrap("<span class='max-len-wrapper' style='position:relative'></span>").parent().append('<div tabindex="0" class="max-length-found v2 NO-HIGHLIGHT"><span>'+b.labelOpts.maxLengthText+'</span><span class="max-length-pointer v2"></span></div>');var c=30,d=parseFloat(this.jObject.offset().top+c),e=parseFloat(this.jObject.offset().left),f=parseFloat(e+this.jObject.width()),g=a.outerWidth(),h=a.outerHeight(),i=a.position().top,j=a.offset().left,k=a.offset().top,l=a.offset().left,m=parseFloat(l+g),n=$(".max-length-found").outerHeight(),o=$(".max-length-found").outerWidth(),p=$(".max-length-found"),q=$(".max-length-pointer"),r=q.is(":visible")?10:3,s=i-parseInt(n+r,10),t=(g-o)/2,u={},v=h+4,w="auto";if(k<d&&(s=v),l===e&&(t=0),(m+24>=f||m+16>=f)&&(t="auto",w=0),t+="px",s+="px",u={position:"absolute",top:s,left:t,right:w},p.css(u).focus(),!this.isFullyVisibleWidth(p)){var x=p.offset().left,y=this.isFullyVisibleWidth(p,!0);"left"==y?(p.css("left",(g-o)/2-x+"px"),q.css("left",g/2-q.width()/2+j+"px")):"right"==y&&(p.css("left",(g-o)/2-(o+x-window.innerWidth)+"px"),q.css("left",g/2-q.width()/2-p.position().left+"px"))}window.clearTimeout(this.popuptimeout),this.popuptimeout=window.setTimeout(function(){$(".max-length-found").unwrap().remove()},b.options.timeOutTime),this.sendAnalytics("trigger_max_char_count")}},{key:"setInputsToReadonly",value:function(){var a=this,b=this.jObject.closest(".page").find(".gadget-keypad");return b.hasClass("identifier-keypad")?(this.jObject.find("input").prop("readonly",!0),this.readonlyCounter=50,!0):0==b.length||b.hasClass("gadget-fail")?(this.readonlyCounter=50,!0):void(this.readonlyCounter<50&&(this.readonlyCounter++,setTimeout(function(){a.setInputsToReadonly()},100)))}},{key:"disableAudio",value:function(){var a=this.jObject;a.find("*").hasClass("audioToggleIdentifier")&&a.find(".audioToggleIdentifier").audioComponent("disableAudio")}},{key:"enableAudio",value:function(){var a=this.jObject;a.find("*").hasClass("audioToggleIdentifier")&&a.find(".audioToggleIdentifier").audioComponent("enableAudio")}},{key:"addKeypadValue",value:function(a){var b=this,c=this.jObject.find('[data-index="'+this.activeInputField+'"]'),d=a.keyVal,e=!1;c.hasClass("component_mathquill")&&(e=!0);var f=PearsonGL.utils.getActiveInputField()?PearsonGL.utils.getActiveInputField()[0]:void 0;if("disabled"!=c.attr("disabled")&&f)if(c.hasClass("component_mathquill")&&c[0]===f)this.options.inputFields[this.activeInputField].mathquill[0].mathquillComponent.onKeypressed(d);else if(c[0]===f){this.caret=c[0].selectionStart,void 0===this.caret&&(this.caret=0);var g=c.val(),h=PearsonGL.utils.actionOnActiveInputField(d,g,this.caret);this.caret=h.caret,c.val(h.value),c.val().length>0?c.removeClass("placeholder"):c.addClass("placeholder"),window.setTimeout(function(){c[0].setSelectionRange(b.caret,b.caret)},0),this.checkForButtonState()}e?c.removeClass("mq-focused"):c.removeClass("text-focus"),c.blur();try{var i=b.jObject.closest(".page").find(".identifier-keypad"),j=i.hasClass("semantic-button")?"."+a.dataId+".base-button":"."+a.dataId+" .base-button-inside-wrap";setTimeout(function(){i.find(j).focus()},100)}catch(b){PearsonGL.logger.log("Catch the data.dataId error in a keypad button,"+a.dataId+" "+b)}}},{key:"addEventHandlers",value:function(){var a=this.jObject,b=this,c=void 0;this.options.button.clickFunction=function(a){a.options.enable&&b.handleFeedbackState(a)},this.isTouchDevice&&(this.options.button.useTouchForClick=!0),a.find(".check-answer-button").sliderbutton(this.options.button),this.state.isTryAgainButtonMode&&(a.find(".tryagain-button").sliderbutton({buttonText:this.options.button.tryAgainButton,useTouchForClick:!0,clickFunction:function(c){c.options.enable&&b.options.numberOfTries>0&&(b.sendAnalytics("clicked_try_again_button"),a.find(".check-answer-button").show(),a.find(".tryagain-button").hide(),a.find(".result-pop-up").remove(),b.tryAgainReset())}}),a.find(".tryagain-button").hide()),a.find(".check-answer-button").sliderbutton("disable"),$("body").bind("click.body",function(){$(".max-length-found").unwrap().remove()}),a.find("input").unbind("focus").focus(function(){b.disableAudio(),c=$(this),b.activeInputField=c.attr("data-index"),PearsonGL.utils.setActiveInputField(c),$(window).trigger({type:"inputFocus"}),$(".max-length-found").unwrap().remove(),a.find(".dialog-box-window").fadeOut(),c.addClass("text-focus"),c.val()===c.attr("placeholder")?(c.val(""),c.removeClass("placeholder")):c.val()!==c.attr("placeholder")&&c.removeClass("placeholder"),$(this).hasClass("incorrect_input")&&!$(this).attr("readonly")&&(c.val(""),c.removeClass("incorrect_input"),c.closest(".input-wrapper").removeClass("incorrect-wrap"),b.tryAgainReset())}).blur(function(){b.enableAudio();var a=$(this);a.removeClass("text-focus"),""!==a.val()&&a.val()!==a.attr("placeholder")||(a.addClass("placeholder"),navigator.userAgent.indexOf("MSIE")>-1&&a.val(a.attr("placeholder"))),b.hasLoaded&&!b.options.showFeedback?(b.scormData.numberOfTries=0,b.saveLearnerData(!0)):b.hasLoaded&&b.saveLearnerData(!0),b.checkForButtonState()}).keyup(function(a){b.options.showFeedback&&!$(this).attr("readonly")&&b.checkForButtonState(),b.options.shouldValidateMax||$(this).attr("maxlength")!=$(this).val().length||9===a.keyCode||16===a.keyCode||39===a.keyCode||37===a.keyCode||b.showMaxCharMessage($(this)),b.isDirty=!0}).blur(),b.hasLoaded=!0,$(window).on("keypadPress",function(a){a.keyVal&&b.addKeypadValue(a)}),this.options.disableKeyboardOnMobile&&this.isTouchDevice&&this.setInputsToReadonly()}},{key:"buildDom",value:function(){var a=this.options,b=this.jObject,c=this,d=void 0,e=void 0,f=void 0,g=void 0,h="",i=void 0;if(b.prepend('<span class="hidden-label screen-change-msg" aria-live="assertive" role="alert"></span>'),""!==a.paragraph[0].value&&void 0!==a.paragraph[0].value){for(g=a.paragraph,f=0;f<g.length;f++)i=this.cleanUpUnicode(g[f].value),h=unescape(i).replace(this.options.placeholder,'<input tabindex="0" type="text" class="fib-input"/>'),b.append("<div class='gadget-textblock' tabindex='0'><span class='text-audio-component'>"+h+"</span></div>"),void 0!==g[f].audioComponent&&""!==g[f].audioComponent.src&&b.find(".gadget-textblock:last").audioComponent(g[f].audioComponent);a.runtimejson&&a.runtimejson.highlightingEnabled&&b.children(".gadget-textblock").highLighter({saveHighLight:function(){c.saveHighLightTextInGadget()}})}for(e=b.find(".fib-input"),f=0;f<e.length;f++){var j="blankSpace"+(f+1);$(e[f]).wrap('<span class="input-wrapper"></span>'),$(e[f]).before('<label id="blankSpaceLabelledBy'+(f+1)+'" for="'+j+'" class="hidden-label">'+this.labelOpts.fibLabelContent+" "+(f+1)+"</label>");var k=this.options.inputFields[f];if(k.inputAttributes){d=k.inputAttributes[0];var l=parseInt(d.maxLength);if(window.chrome&&d.maxLength>0){var m=$("<div style='visibility:hidden;position:absolute;top:0;left:0;'>I</div>"),n=$("<div style='visibility:hidden;position:absolute;top:0;left:0;'>W</div>"),o=$("<div style='visibility:hidden;position:absolute;top:0;left:0;'>"+new Array(l+1).join("W")+"</div>");b.append(m).append(n).append(o),l=Math.round(o.width()/((m.width()+n.width())/2)),m.remove(),n.remove(),o.remove()}$(e[f]).attr("data-index",f).attr({maxLength:d.maxLength,placeholder:d.placeholder,size:l,name:"blankSpace"+(f+1),id:"blankSpace"+(f+1),"aria-labelledby":"blankSpaceLabelledBy"+(f+1),autocomplete:"off"})}else if(k.mathquill){var p=$(e[f]).closest(".input-wrapper"),q=$("<span></span>").attr("data-index",f);p.append(q),$(e[f]).remove(),this.createMathQuill(q,k.mathquill[0])}else this.createPicklist(f,k.picklists[0],e[f])}if(this.mathJaxInUse){var r=this;$(window).bind("mathjaxComplete",function(a,b){if(r.mathJaxElems.length>0)for(f=0;f<r.mathJaxElems.length;f++)b===r.mathJaxElems[f][0]&&r.mathJaxElems[f].find(".picklist-button").sliderbutton("enable");r.setPicklistHeight()})}else this.setPicklistHeight();b.find(".remove-me").remove(),this.totalCorrect=e.length,b.find(".fib-input").addClass("placeholder").click(function(a){a.stopPropagation()}),this.options.showFeedback&&b.append('<div class="check-answer-button" aria-live="assertive"></div>'),this.state.isTryAgainButtonMode&&b.append('<div class="tryagain-button" aria-live="assertive"></div>'),this.addEventHandlers(),this.options.popupAudio.runtimejson=this.options.runtimejson,$(this.options.popupAudio.audioClass).audioComponent(this.options.popupAudio)}},{key:"completeActivity",value:function(){this.quit||(this.quit=!0,this.options.numberOfTries=0,this.options.button.clickFunction({options:{enable:!0},complete:!0}),this.jObject.find(".check-answer-button").hide(),this.jObject.find(".tryagain-button").hide(),this.showCorrectShowMyAnswer(!1))}},{key:"setGadget",value:function(){var a=this.scormData,b=this.jObject;if(this.setLearnerResponse(),a){var c=this.options.numberOfTries;this.options.numberOfTries=a.numberOfTries,this.attemptCount=a.numberOfTries,this.options.submitScoreOnFirstAttempt&&this.scormData.scoreFinalized&&(this.options.scoreFinalized=this.scormData.scoreFinalized),!1===a.allowSavingInputs&&(this.allowSavingInputs=!1);var d=void 0,e=void 0,f=!0;if(a.studentAnswer){for(i=0;i<a.studentAnswer.length;i++){var g=a.studentAnswer[i];if(g.picklist){if(e=b.find('.picklist-wrapper[id="'+g.index+'"]'),-1!==g.option){var h=e.find('.picklist-options a[data-default="'+g.option+'"]');e.find(".picklist-title").html(h.html()).removeClass("placeholder"),e.data("selectedIndex",h.attr("id"))}g.attempted?g.correct?(e.removeClass("incorrect_input").addClass("correct_input disabled").attr({disabled:"disabled",readonly:"readonly",tabindex:"-1"}).unbind(),e.find(".picklist-title").sliderbutton("disable")):-1!==g.option?(e.removeClass("correct_input").addClass("incorrect_input disabled"),f=!1,0===a.numberOfTries&&(e.attr({disabled:"disabled",readonly:"readonly",tabindex:"-1"}).unbind(),e.find(".picklist-title").sliderbutton("disable"))):f=!1:f=!1}else if(g.mathquill){d=b.find('.component_mathquill[data-index="'+g.index+'"]');var j=this.options.inputFields[d.attr("data-index")].mathquill[0].mathquillComponent;g.value&&d.removeClass("placeholder"),g.attempted?(j.setLatex(g.value),g.correct?(d.removeClass("incorrect_input").addClass("correct_input"),j.disable(),d.closest(".input-wrapper").removeClass("incorrect-wrap").addClass("correct-wrap")):g.value.length>0?(d.removeClass("correct_input").addClass("incorrect_input"),d.closest(".input-wrapper").removeClass("correct-wrap").addClass("incorrect-wrap"),f=!1,0==a.numberOfTries&&j.disable()):f=!1):f=!1}else d=b.find('input[data-index="'+g.index+'"]'),d.val(g.value),g.value&&d.removeClass("placeholder"),g.attempted?g.correct?(d.removeClass("incorrect_input").addClass("correct_input").attr({disabled:"disabled",readonly:"readonly",tabindex:"-1"}).unbind(),d.closest(".input-wrapper").removeClass("incorrect-wrap").addClass("correct-wrap")):g.value.length>0?(d.removeClass("correct_input").addClass("incorrect_input"),d.closest(".input-wrapper").removeClass("correct-wrap").addClass("incorrect-wrap"),f=!1,0==a.numberOfTries&&d.attr({disabled:"disabled",readonly:"readonly",tabindex:"-1"}).unbind()):f=!1:f=!1}a.numberOfTries<=0&&!f&&(this.options.showCorrectAnswerOnFinalAttempt||(b.find(".button-text").empty().html(this.options.button.showCorrectAnswer.buttonText).addClass("show-correct-answers").attr("label",this.options.button.showCorrectAnswer.buttonText),b.find(".check-answer-button").sliderbutton("enable"))),this.allCorrect=f,this.checkForButtonState(),a.numberOfTries<=0&&f&&b.find(".check-answer-button").sliderbutton("disable")}else c==a.numberOfTries?this.checkAnswers(!0):this.checkAnswers(),this.checkForButtonState()}else this.scormData={numberOfTries:this.options.numberOfTries}}},{key:"gadgetUnload",value:function(){this.isCommEnabled()&&(this.setCorrectResponse(),this.saveLearnerData(!0))}},{key:"parseLearnerData",value:function(){var a=this.options.scorm.suspendData.data;"object"===(void 0===a?"undefined":_typeof(a))&&(this.scormData=a,this.setGadget())}},{key:"saveIfNeeded",value:function(){this.saveLearnerData(!0)}},{key:"saveLearnerData",value:function(a){if(this.isCommEnabled()){var b={},c=[],d=void 0;if(this.learner_response(),this.options.scorm.suspendData.data=this.scormData,PearsonGL.logger.log("saveLearnerData: suspendDataOnly",a,"scormData",this.options.scorm.suspendData.data),!this.options.scoreFinalized&&!a||this.state.isSurveyMode){for(d=0;d<this.options.scorm.interactions.length;d++)b=this.getResult(this.options.scorm.interactions[d].objectives[0]),b.learnerResponse=this.learner_response(),b.correctResponses=this.options.correctResponse,c.push(b);PearsonGL.logger.log("saveLearnerData: !suspendDataOnly + results",c)}this.setLearnerData({gadgetId:this.gadgetUniqueId,data:this.options.scorm,results:c}),this.isDirty=!1}}},{key:"setLearnerResponse",value:function(){if(this.options.scorm.interactions&&this.options.scorm.interactions.length>0&&this.options.scorm.interactions[0].learner_response&&this.options.scorm.interactions[0].learner_response.words){var a=this.options.scorm.interactions[0].learner_response.words,b=$(this.jObject).find("input"),c=void 0,d=void 0;$.each(b,function(b,e){if(c=$(this).attr("data-index"),void 0===(d=a[c]))return!0;$(this).val(d),""!==d.trim()&&$(this).removeClass("placeholder")})}}},{key:"getResult",value:function(a){var b={},c=$(this.jObject).find("input, .picklist-wrapper, .component_mathquill"),d=c.length,e=0;try{e=$(this.jObject).find(".correct_input").length,b.raw=parseFloat(a.score.max)*(e/d),b.min=isNaN(a.score.min)?0:parseFloat(a.score.min),b.max=a.score.max,b.max-b.min!=0?b.scaled=(b.raw-b.min)/(b.max-b.min):b.scaled=1,b.completionStatus="incomplete",b.successStatus="failed",this.options.showFeedback?(this.numberCorrect&&(b.scaled=this.numberCorrect/this.options.inputFields.length),parseFloat(b.scaled)>=parseFloat(PearsonGL.globals.comm.getPassingScore())&&this.options.numberOfTries<=0&&(b.successStatus="passed"),("passed"===b.successStatus||this.options.numberOfTries<=0)&&(b.completionStatus="completed")):(b.completionStatus="completed",b.successStatus="passed",b.scaled=1,b.raw=a.score.max),b.progressMeasure=1,this.state.isSurveyMode&&(b.scaled=1,b.raw=a.score.max,b.completionStatus="completed",b.successStatus="passed"),this.options.submitScoreOnFirstAttempt&&!this.options.scoreFinalized&&(b.completionStatus="completed")}catch(a){}return!0===this.giveAllPoints&&(b.successStatus="passed",this.giveAllPoints=!1),b.result=b.scaled,b}},{key:"exit",value:function(){this.saveLearnerData(!0)}},{key:"learner_response",value:function(){var a=$(this.jObject).find("input"),b=a.length,c=$(this.jObject).find(".component_mathquill"),d=c.length,e=$(this.jObject).find(".picklist-wrapper"),f=e.length,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0;if(this.allowSavingInputs){for(this.scormData.studentAnswer=[],this.words=[],i=0;i<b;i+=1)g=!1,h=!1,j=a[i],k=$(j).val(),$(j).hasClass("placeholder")&&(k=""),this.words[$(j).attr("data-index")]=k,($(j).hasClass("incorrect_input")||$(j).hasClass("correct_input"))&&(h=!0),$(j).hasClass("correct_input")&&(g=!0),this.scormData.studentAnswer.push({value:k,index:$(j).attr("data-index"),attempted:h,correct:g});for(var l=0;l<f;l++){g=!1,h=!1,($(e[l]).hasClass("incorrect_input")||$(e[l]).hasClass("correct_input"))&&(h=!0),$(e[l]).hasClass("correct_input")&&(g=!0),this.scormData.studentAnswer.push({picklist:!0,option:$(e[l]).find(".picklist-options a[id='"+$(e[l]).data("selectedIndex")+"']").attr("data-default"),index:$(e[l]).attr("id"),attempted:h,correct:g});$(e[l]).find(".picklist-options a[id='"+$(e[l]).data("selectedIndex")+"']")}for(var m=0;m<d;m++)j=c[m],k=this.options.inputFields[$(c[m]).attr("data-index")].mathquill[0].mathquillComponent.getLatex(),g=!1,h=!1,($(j).hasClass("incorrect_input")||$(j).hasClass("correct_input"))&&(h=!0),$(j).hasClass("correct_input")&&(g=!0),this.scormData.studentAnswer.push({mathquill:!0,index:$(c[m]).attr("data-index"),value:k,attempted:h,correct:g})}return{words:this.words}}},{key:"clearScreenReadingFeedbackState",value:function(){var a=this.jObject.find(".screen-change-msg");a.length&&this.options.numberOfTries>0&&a.text(this.labelOpts.afterScreenChangeMessageClear)}},{key:"handleScreenReadingFeedbackState",value:function(a,b){var c=this,d=this.jObject.find(".screen-change-msg"),e=this.jObject.find(".gadget-textblock [class*='-wrapper']"),f="",g="";a&&(g=b?this.labelOpts.showMyAnswer:this.labelOpts.showCorrectAnswer),$.each(e,function(d,e){var g=!!$(e).hasClass("picklist-wrapper"),h=$(e).find(".component_mathquill").length>0,i="",j="",k=c.labelOpts.isCorrectText,l=c.labelOpts.isIncorrectText,m=void 0,n="";m=g?!(!a||b)||!!$(e).hasClass("correct_input"):!!$(e).hasClass("correct-wrap"),n=m?k:l,i=g?$(e).find(".picklist-title").attr("id"):$(e).find("label").text(),j=g?$(e).find("[id*='dropdown'] p").text():$(e).find("input").val(),h&&(j="mathquill"),f+=i+" "+j+" "+n+" "}),d.text(this.labelOpts.afterScreenChangeMessage+" "+g+" "+f)}},{key:"fireEvent",value:function(a,b){var c=void 0;c=b?a?"firstCorrect":"incorrect":a?"finalCorrect":"finalIncorrect";var d={sourceId:this.gadgetUniqueId};"finalCorrect"!==c&&"finalIncorrect"!==c&&"firstCorrect"!==c||(this.jObject.addClass("completed"),this.allowSavingInputs=!1,this.scormData.allowSavingInputs=!1,"firstCorrect"==c&&this.jObject.addClass("first-correct"),"finalCorrect"==c&&this.jObject.addClass("final-correct")),$("body").hasClass("ipad")?setTimeout(function(){$(window).trigger(c,d)},50):$(window).trigger(c,d),PearsonGL.logger.log("eventName "+c)}},{key:"sendCumulativeAnalytics",value:function(){var a=this.options.inputFields.length,b=0;this.jObject.find(".fib-input").each(function(a,c){$(c)[0].value.length>0&&b++}),this.sendAnalytics("clicked_content_field_count_"+b+" of "+a)}}]),b}(PearsonGL.Gadget.GadgetBase),$(document).on("click",function(a){var b=$("body").find(".page:not(.hidden-page)"),c=b.find(".fill-blank-identifier"),d=c.find(".picklist-wrapper").toArray();c.length>0&&d.length>0&&d.forEach(function(a,b){var c=$(a).find(".picklist-options");$(c).css("visibility","visible")&&$(c).css("visibility","hidden")})});var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.Button=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return c&&a?(e.labelOpts={closeAltText:"Close",dialogLabeledByContent:"Dialog opened",dialogWindowClosed:"Dialog Window closed",buttonAnnounceNewWindow:"opens a new window",buttonAnnouncePopup:"opens a popup"},e.doFocusTrap,e.focusTrap,e.focusDialog,e.constants={TT_N:"N",TT_S:"S",TT_E:"E",TT_W:"W",TT_NW:"NW",TT_NE:"NE",TT_SW:"SW",TT_SE:"SE",POP_N:"PN",POP_S:"PS",POP_E:"PE",POP_W:"PW",POP_NW:"PNW",POP_NE:"PNE",POP_SW:"PSW",POP_SE:"PSE",POP_HOSTED:"0",POP_CENTER:"1",ACTIVE_CLASS:"is-active",NOT_ACTIVE_CLASS:"is-not-active",ACTIVE_BTNS:"activeBtns",IS_TOGGLED_CLASS:"is-toggled",IS_NOT_TOGGLED_CLASS:"is-not-toggled",HAS_FOCUS:"has-focus",DIALOG_ELEMENT:$(),DIALOG_MODAL_ELEM:$(),DIALOG_CLOSE:"dialogClose",DIALOG_OPEN:"dialogOpen",RETURN_FOCUS_NODE:"returnFocusNode"},e.imgButtons={down:$(),over:$(),up:$(),active:$(),tDown:$(),tOver:$(),tUp:$(),tActive:$()},e.options=$.extend(!0,{gadgetName:"Button",objectiveDescription:"User clicks a button to perform an action.",iframePos:{iframeWidth:"100%",iframeHeight:"100%",left:0,marginLeft:0},buttonStates:{ACTIVE:0,DOWN:1,OVER:2,UP:3,ALL:4},autoClick:!1},e.options||{}),e.jObject=$(a),e.jObject.data("gadget_options",e.options),e.jObject.addClass("button-identifier"),e.hasGadgetPopup=!1,e.isToggleButton=!1,e.isRealToggleButton=!1,e.isModal=!1,e.isToggled=!1,e.isLightBoxPopup=!1,e.isNewWindow=!1,e.isTooltip=!1,e.isPopup=!1,e.isHosted=!1,e.hostMaxHeight=0,e.hostMaxWidth=0,e.hostGadgetId="",e.isPageJump=!1,e.isGlossary=!1,e.isCustomClick=!1,e.hasSetScormData=!1,e.isBtnClickAudio=!1,e.isBtnClickAudioOnly=!1,e.winWidth=0,e.winHeight=0,e.titleText="",e.unit="",e.eventType={clicked:"clicked"},e.initGadget(e.options.gadgetName),PearsonGL.utils.getGlobalizedLabel("button_globalization",function(a){$.extend(e.labelOpts,a),delete c.scorm,$.extend(!0,e.options,c),e.getLearnerData({type:"other"}),e.globalizationComplete(),e.addAccessibility(e.jObject),e.addLongDescription(e.jObject,e.options.longDescription),e.buildDom()},e.options.runtimejson.lang),e):_possibleConstructorReturn(e)}return _inherits(b,a),_createClass(b,[{key:"globalizationComplete",value:function(){var a=this.jObject;if(this.options.windowProps&&this.options.windowProps.unit&&("percent"===this.options.windowProps.unit?this.unit="%":this.unit="px"),a.hasClass("custom-btn-click")&&(this.isCustomClick=!0),void 0!==this.options.modal&&(this.winWidth=this.options.modal.width,this.winHeight=this.options.modal.height,this.options.modal.isModal?this.isModal=!0:this.isNewWindow=!0),this.options.windowProps&&this.options.windowProps.windowType&&!this.isCustomClick)switch(this.winWidth=this.options.windowProps.width,this.winHeight=this.options.windowProps.height,PearsonGL.utils.isNonEmptyArray(this.options.pageJump)&&(this.options.windowProps.windowType="pageJump"),this.options.windowProps.windowType){case"new":this.isNewWindow=!0;break;case"lightbox":this.isModal=!0,void 0!==this.options.content&&(this.isLightBoxPopup=!0);break;case"tooltip":this.isTooltip=!0;break;case"popup":this.isPopup=!0;break;case"hosted":this.isHosted=!0;break;case"pageJump":this.isPageJump=!0}if(this.options.pageJump&&(this.isPageJump=!0),this.winHeight&&this.winWidth&&(this.options.iframePos.iframeHeight=this.winHeight+this.unit,this.options.iframePos.iframeWidth=this.winWidth+this.unit,this.options.iframePos.left="50%",this.options.iframePos.marginLeft=this.winWidth/2*-1),this.options.toggleButton||this.isHosted?this.isToggleButton=!0:this.isToggleButton=!1,this.options.toggleButton&&(this.isRealToggleButton=!0),void 0!==this.options.gadgetId&&this.options.gadgetId.length>0){var b=[];this.hostGadgetId=this.options.gadgetId,b=this.hostGadgetId.split("_"),b.length>2&&(this.hostGadgetId=b.slice(2,b.length).toString())}if(this.options.title&&this.options.title.length>0&&a.attr("title",this.options.title),this.options.autoClick){this.openWindowLink(),this.changeButtonStates(this.options.buttonStates.DOWN),this.isToggled=!this.isToggled;var c=void 0;if(this.isToggleButton){var d=this.jObject.find(".text-button");this.isToggled&&this.options.toggleButton?(c=this.options.toggleButton[0].button.buttonText[0].buttonTitle,d.addClass(this.constants.IS_TOGGLED_CLASS)):(c=this.options.button.buttonText[0].buttonTitle,d.removeClass(this.constants.IS_TOGGLED_CLASS)),d.find(".button-text").text(c),d.attr({title:c})}}}},{key:"stop",value:function(){this.stopAudioVideo()}},{key:"addAccessibility",value:function(){this.jObject.prepend('<div class="aria-live-region hidden-label" aria-live="assertive" aria-atomic="true"></div>')}},{key:"buildDom",value:function(){var a=this,b=this.jObject,c="",d="",e=void 0,f="",g="",h="",i="",j="",k="",l={src:"",trigger:!0,type:"hover"};void 0!==this.options.button&&(void 0!==this.options.button.buttonImage&&0!==this.options.button.buttonImage.length||void 0!==this.options.button.buttonText&&0!==this.options.button.buttonText.length)||(this.options.button={},this.options.button.buttonText=[{buttonTitle:""}]),c=this.options.button,this.isToggleButton&&this.options.toggleButton&&(j=this.options.toggleButton[0]);var m=this.options;for(keys in m){if("local"===keys){this.dataHref=m[keys][0].src;break}if(!("domain"!==keys&&"external"!==keys&&keys.indexOf("glossary")<0)&&(g="",keys.indexOf("glossary")>-1&&(this.isGlossary=!0),!$.isEmptyObject(m[keys]))){f=m[keys][0];for(key in f)"domain"==key?h=f[key]:"string"==typeof f[key]&&f[key].indexOf("=")>-1?g+=f[key]:keys.indexOf("glossary")>-1?g+=key+"="+f[key]+"&":g+=f[key];if(""!=h){this.dataHref=PearsonGL.utils.urlResolver(this.options.runtimejson,h,keys.indexOf("glossary")>-1?"?"+g:g),keys.indexOf("glossary")>-1&&this.dataHref&&(this.dataHref=this.dataHref.substring(0,this.dataHref.length-1));break}}}if(m.pageJump&&!this.dataHref?i='id="page-button-id-'+m.pageJump[0].pageNumber+'"':m.pageJump=void 0,this.options.audioComponent&&!$.isEmptyObject(this.options.audioComponent)&&(this.options.audioComponent.src.length>0||this.options.toggleButton)){if(this.isBtnClickAudio=!0,this.options.toggleButton&&this.options.toggleButton[0].audioComponent&&this.options.toggleButton[0].audioComponent.src&&(l.src=this.options.toggleButton[0].audioComponent.src,-1!==l.src.indexOf(".mp3"))){b.append("<div class='toggle-button-audio hidden'></div>");var n=b.find(".toggle-button-audio");n.audioComponent(l),n.removeAttr("role").removeAttr("tabindex")}if(this.options.audioComponent.src.length>0&&(l.src=this.options.audioComponent.src,-1!==l.src.indexOf(".mp3"))){var o=b.append("<div class='button-audio hidden'></div>");o=b.find(".button-audio"),o.audioComponent(l),o.removeAttr("role").removeAttr("tabindex")}this.isGlossary||this.isNewWindow||this.isModal||this.isHosted||!this.isCustomClick&&this.isPageJump||(this.isBtnClickAudioOnly=!0)}if(c.buttonText&&0!==c.buttonText.length||!c.buttonImage||$.isEmptyObject(c.buttonImage[0])){if(this.isImageButton=!1,a.options.title&&a.options.title.length>0)d=a.options.title;else{var p=b.attr("title");d=p&&p.length>0?p:""}var q="buttonLabel_"+PearsonGL.utils.randomString(2),r=$('<div class="basic-button-class text-button sprite base-button"><div class="base-button-inside-wrap"><label id="'+q+'" class="hidden-label">'+c.buttonText[0].buttonTitle+'</label><span class="sprite button-text" tabindex="0" role="button" aria-disabled="false"><p>'+c.buttonText[0].buttonTitle+"</p></span></div></div>");b.append(r);var s=" ";this.isNewWindow&&(s+=this.labelOpts.buttonAnnounceNewWindow,a.setButtonLabelText(s)),(this.isLightBoxPopup||this.isTooltip||this.isPopup)&&(s+=this.labelOpts.buttonAnnouncePopup,a.setButtonLabelText(s))}else{c.buttonText&&delete c.buttonText,a.isImageButton=!0;var t="",u="",v="",w="",x="",y="",z="",A="",B="",C="",D="",E="",F="",G="",H="",I="";if(a.isToggleButton&&j&&j.button&&j.button.buttonImage&&j.button.buttonImage.length>0){var J=j.button.buttonImage[0];k=J.title?J.title:"",J.baseSrc&&(x=J.baseSrc),y=c.buttonImage[0].overSrc?J.overSrc:x,z=c.buttonImage[0].downSrc?J.downSrc:x,A=c.buttonImage[0].activeSrc?J.downSrc:x,B='<img class="base-button-default-toggle hidden" src="'+x+'" alt="'+k+'"/>',C='<img class="base-button-over-toggle hidden" src="'+y+'" alt="'+k+'"/>',D='<img class="base-button-down-toggle hidden" src="'+z+'" alt="'+k+'"/>',E='<img class="base-button-active-toggle hidden" src="'+A+'" alt="'+k+'"/>'}d=c.buttonImage[0].title?c.buttonImage[0].title:"",c.buttonImage[0].baseSrc&&(t=c.buttonImage[0].baseSrc),u=c.buttonImage[0].overSrc?c.buttonImage[0].overSrc:t,v=c.buttonImage[0].downSrc?c.buttonImage[0].downSrc:t,w=c.buttonImage[0].activeSrc?c.buttonImage[0].downSrc:v,F='<img class="base-button-default" src="'+t+'" alt="'+d+'"/>',G='<img class="base-button-over hidden" src="'+u+'" alt="'+d+'"/>',H='<img class="base-button-down hidden" src="'+v+'" alt="'+d+'"/>',I='<img class="base-button-active hidden" src="'+w+'" alt="'+d+'"/>',this.isToggleButton&&x.length>0?b.append('<div role="button" oncontextmenu="return false;" class="basic-button-class image-button-wrapper" tabindex="0" '+i+">"+F+G+H+I+B+C+D+E+"</div>"):b.append('<div role="button" oncontextmenu="return false;" class="basic-button-class image-button-wrapper" tabindex="0" '+i+">"+F+G+H+I+"</div>"),e=b.find(".image-button-wrapper"),e.attr({title:d}),this.isCustomClick&&(e.prepend('<div class="btn-click-block"></div>'),e.find(".btn-click-block").css("height",e.height()+4))}if(this.isImageButton?(this.imgButtons.down=b.find("img.base-button-down"),this.imgButtons.over=b.find("img.base-button-over"),this.imgButtons.up=b.find("img.base-button-default"),this.imgButtons.active=b.find("img.base-button-active"),j&&j.length>0&&(this.imgButtons.tDown=b.find("img.base-button-toggle-down"),this.imgButtons.tOver=b.find("img.base-button-toggle-over"),this.imgButtons.tUp=b.find("img.base-button-toggle-up"),this.imgButtons.tActive=b.find("img.base-button-toggle-active")),e.bind("touchstart touchend",function(b){b.preventDefault(),b.stopPropagation(),"touchstart"==b.type?a.changeButtonStates(a.options.buttonStates.DOWN):"touchend"==b.type&&(a.openWindowLink(),a.changeButtonStates(a.options.buttonStates.UP),a.fireEvent(a.eventType.clicked))}),e.mousedown(function(){a.changeButtonStates(a.options.buttonStates.DOWN)}).hover(function(){a.changeButtonStates(a.options.buttonStates.OVER)},function(){a.changeButtonStates(a.options.buttonStates.UP)}).mouseup(function(){a.openWindowLink(),a.fireEvent(a.eventType.clicked),a.sendAnalytics("button_pressed")}).keyup(function(b){b.keyCode===PearsonGL.utils.keyCode.tab?PearsonGL.utils.focusItemOn($(this).find("img:visible")):b.keyCode!==PearsonGL.utils.keyCode.enter&&b.keyCode!==PearsonGL.utils.keyCode.space||(a.changeButtonStates(a.options.buttonStates.DOWN),a.openWindowLink(),a.fireEvent(a.eventType.clicked))}).blur(function(){PearsonGL.utils.focusItemOff($(this).find("img:visible"))})):b.find(".text-button:last .base-button-inside-wrap").mousedown(function(){$(this).addClass("base-button-down")}).hover(function(){$(this).addClass("base-button-over")},function(){$(this).removeClass("base-button-over base-button-down")}).click(function(){if(a.sendAnalytics("button_pressed"),a.isToggled=!a.isToggled,a.isToggleButton){var c=b.find(".text-button");a.isToggled&&a.options.toggleButton?(d=a.options.toggleButton[0].button.buttonText[0].buttonTitle,c.addClass(a.constants.IS_TOGGLED_CLASS)):(d=a.options.button.buttonText[0].buttonTitle,c.removeClass(a.constants.IS_TOGGLED_CLASS)),c.find(".button-text").text(d),c.attr({title:d})}a.openWindowLink(),$(this).removeClass("base-button-down"),a.fireEvent(a.eventType.clicked)}).keyup(function(b){b.keyCode===PearsonGL.utils.keyCode.tab&&PearsonGL.utils.focusItemOn($(this).find(".button-text")),b.keyCode!==PearsonGL.utils.keyCode.enter&&b.keyCode!==PearsonGL.utils.keyCode.space||(a.openWindowLink(),a.fireEvent(a.eventType.clicked))}).blur(function(){PearsonGL.utils.focusItemOff($(this))}),this.isPageJump){b.addClass("button-pageJump-identifier");var K="page "+this.options.pageJump[0].pageNumber;a.setButtonLabelText(K),$(product).on("productCallBackFunction",function(c){var d=c.params[0]+1;0===$(".button-firstTime-identifier").length&&(b.parents(".page, .header").find(".image-button-wrapper").removeClass(function(a,b){return(b.match(/(^|\s)current-button-selected-\S+/g)||[]).join(" ")}),b.parents(".page, .header").find(".image-button-wrapper").removeClass("image-button-selected"),b.parents(".page, .header").find(".text-button").removeClass(function(a,b){return(b.match(/(^|\s)current-button-selected-\S+/g)||[]).join(" ")}),b.parents(".page, .header").find(".text-button").removeClass("text-button-selected"),a.changeButtonStates(a.options.buttonStates.ALL)),b.addClass("button-firstTime-identifier"),$(".button-firstTime-identifier").length===$(".button-pageJump-identifier").length&&$(".button-firstTime-identifier").removeClass("button-firstTime-identifier"),"page-button-id-"+d===b.find(".image-button-wrapper").attr("id")&&(b.find(".image-button-wrapper").addClass("image-button-selected"),a.changeButtonStates(a.options.buttonStates.DOWN),b.find(".image-button-wrapper").addClass("current-button-selected-"+d)),"page-button-id-"+d===b.find(".text-button").attr("id")&&($(".button-identifier").find(".text-button#page-button-id-"+d).addClass("text-button-selected"),a.changeButtonStates(a.options.buttonStates.DOWN),$(".button-identifier").find(".text-button#page-button-id-"+d).addClass("current-button-selected-"+d))})}}},{key:"setButtonLabelText",value:function(a){var b=(this.options.title?this.options.title:"")+" "+a,c=this.jObject.find(".button-text");c.length>0&&c.attr("aria-label",b)}},{key:"changeButtonStates",value:function(a){var b=this,c=!1;($(b.imgButtons.up).parent().hasClass("image-button-selected")||$(b.imgButtons.up).parent().hasClass(b.constants.ACTIVE_CLASS))&&(c=!0);var d=this.jObject;switch(a){case this.options.buttonStates.DOWN:this.isToggled=!this.isToggled,this.isToggleButton&&this.isToggled?d.find(".image-button-wrapper").addClass(this.constants.IS_TOGGLED_CLASS):d.find(".image-button-wrapper").removeClass(this.constants.IS_TOGGLED_CLASS),this.isToggled&&this.options.toggleButton?(this.imgButtons.tDown.show(),this.imgButtons.tOver.hide(),this.imgButtons.tUp.hide(),this.imgButtons.tActive.hide()):(this.imgButtons.down.show(),this.imgButtons.up.hide(),this.imgButtons.over.hide(),this.imgButtons.active.hide());break;case this.options.buttonStates.OVER:c||(this.imgButtons.down.hide(),this.imgButtons.up.hide(),this.imgButtons.over.show(),this.imgButtons.active.hide());break;case this.options.buttonStates.UP:c||(this.imgButtons.down.hide(),this.imgButtons.up.show(),this.imgButtons.over.hide(),this.imgButtons.active.hide());break;case this.options.buttonStates.ACTIVE:this.imgButtons.down.hide(),this.imgButtons.up.hide(),this.imgButtons.over.hide(),this.imgButtons.active.show();break;default:$("img.base-button-down").hide(),$("img.base-button-over").hide(),$("img.base-button-active").hide(),$("img.base-button-default").show()}}},{key:"buildIframeInDOM",value:function(){var a=this;$(".iframemodal").remove(),$("body").append('\n\t\t\t<div class="iframemodal hide" tabindex="0">\n\t\t\t\t<div class="iframemodal-close" data-closeBtnLabel="'+this.labelOpts.closeAltText+'" title="'+this.labelOpts.closeAltText+'"></div>\n\t\t\t\t<div class="iframemodal-background"></div><span class="body-iframe-wrapper"></span>\n\t\t\t</div>\n\t\t'),$(".body-iframe-wrapper").iframecomponent(),$(".iframemodal iframe").css({"margin-left":this.options.iframePos.marginLeft,left:this.options.iframePos.left,width:this.options.iframePos.iframeWidth,height:this.options.iframePos.iframeHeight}),$(".iframemodal-close").sliderbutton({buttonClassName:"iframemodal-close",tabIndexValue:0,slider:!1,clickFunction:function(b){$(".iframemodal").fadeOut(500),a.sendAnalytics("clicked_closed_window")}})}},{key:"addWindowContent",value:function(a,b){var c=$("body").find(a);if(!(c.children().length>0)){var d=this,e={},f={},g="",h={},i={},j={},k="",l="",m="",n=!1;if(c.hide(),$.each(b,function(a,o){switch(n=b.mainImgTop,a){case"title":case"mainBody":case"leftBody":case"rightBody":g=a.slice(0,a.length-4),m=a,k=m+"Text",i=b[m+"Audio"],c.append('<div class="'+m+'"><div class="'+k+'"></div></div>'),e=c.find("."+k),e.richtextcomponent(d.createRichTextObj(o)),i.src&&i.src.length>0&&e.find(".gadget-textblock").audioComponent(i),"left"!==g&&"right"!==g&&"main"!==g||(l=g+"Image",imgTitle=b[l+"Title"],h={src:b[l],title:imgTitle||""},j=b[l+"Audio"],h.src&&h.src.length>0&&("main"===g&&n?c.find("."+k).before('<div class="'+l+'"></div>'):c.find("."+k).after('<div class="'+l+'"></div>'),f=c.find("."+l),f.imagecomponent(h),d.addLongDescription(f,b.longDesc),j&&j.src&&f.find(".image-class-wrapper").audioComponent(j)));break;case"mainImage":case"leftImage":case"rightImage":if(l=a,c.find("."+l).length>0)return;imgTitle=b[l+"Title"],h={src:b[l],title:imgTitle||""},j=b[l+"Audio"],h.src.length>0&&(c.append('<div class="'+l+'"></div>'),f=c.find("."+l),f.imagecomponent(h),j&&j.src&&f.find(".image-class-wrapper").audioComponent(j),d.addLongDescription(f,b.longDesc))}}),c.show(),b.video){var o=b.video;if(void 0!==o&&!$.isEmptyObject(o)&&(o.external&&o.external.length>0||o.local&&o.local.length>0)){var p='<div class="vid-col"><div class="video-player"></div></div>';b.videoTop?c.prepend(p):c.append(p),void 0===b.video.autoPlay&&(b.video.controls=!1),b.video.fullscreen=!1,b.video.runtimejson=this.options.runtimejson;var q=c.find(".video-player");q.videoComponent(b.video,this.gadgetUniqueId),d.addLongDescription(q,b.video.videoLongDesc)}}}}},{key:"stopAudioVideo",value:function(){var a=this.jObject.parents(".page"),b=$("body").find("#dialog-layer");a.find(".btn-gadget-pop-up .audioToggleIdentifier, .btn-gadget-pop-up-toggle .audioToggleIdentifier").each(function(){$(this).audioComponent("pause")}),a.find(".btn-gadget-pop-up .video-component-identifier, btn-gadget-pop-up-toggle .video-component-identifier").each(function(){$(this).videoComponent("pause")}),b.find(".btn-gadget-pop-up .audioToggleIdentifier, .btn-gadget-pop-up-toggle .audioToggleIdentifier").each(function(){$(this).audioComponent("pause")}),b.find(".btn-gadget-pop-up .video-component-identifier, btn-gadget-pop-up-toggle .video-component-identifier").each(function(){$(this).videoComponent("pause")}),this.jObject.find(".audioToggleIdentifier").each(function(){$(this).audioComponent("pause")}),this.jObject.find(".video-component-identifier").each(function(){$(this).videoComponent("pause")})}},{key:"closeAnyPopUps",value:function(a){var b=this,c=$(".sco").find(".btn-gadget-pop-up");this.stopAudioVideo(),this.jObject[0].addEventListener("keyup",function(a){a.preventDefault(),a.stopImmediatePropagation()}),c.length>0&&this.updateAriaLiveRegion(this.labelOpts.dialogWindowClosed),a?a.remove():($(".btn-gadget-pop-up").remove(),$(document).unbind("click.buttonObj touchstart.buttonObj")),this.isTooltipOpen=!1,this.isToggled=!1,setTimeout(function(){b.jObject[0].removeEventListener("keyup",function(a){a.preventDefault(),a.stopImmediatePropagation()})},200)}},{key:"togglePopup",value:function(a){var b=a.find(".video-component-identifier"),c=a.find(".audioToggleIdentifier"),d=this.jObject;a.is(":visible")?(b.length>0&&b.videoComponent("pause"),c.length>0&&c.audioComponent("pause"),d.removeClass(this.constants.HAS_FOCUS),d.find(".image-button-wrapper").addClass(this.constants.NOT_ACTIVE_CLASS).removeClass(this.constants.ACTIVE_CLASS),d.find(".text-button").addClass(this.constants.NOT_ACTIVE_CLASS).removeClass(this.constants.ACTIVE_CLASS)):(b.length>0&&b.videoComponent("gadgetPageShowEvent"),d.addClass(this.constants.HAS_FOCUS),d.find(".image-button-wrapper").addClass(this.constants.ACTIVE_CLASS).removeClass(this.constants.NOT_ACTIVE_CLASS),d.find(".text-button").addClass(this.constants.ACTIVE_CLASS).removeClass(this.constants.NOT_ACTIVE_CLASS)),a.fadeToggle("fast")}},{key:"handleButtonClickAudio",value:function(){this.stopAudioVideo();var a=this.jObject,b=a.find(".button-audio"),c=a.find(".toggle-button-audio"),d=!1,e=!1;d=c.length>0,e=b.length>0,this.isToggled?e&&d?(b.attr("audiostate","paused")&&b.audioComponent("play"),c.attr("audiostate","playing")&&c.audioComponent("pause")):d&&!e?c.attr("audiostate","playing")&&c.audioComponent("puase"):b.attr("audiostate","puased")&&b.audioComponent("play"):e&&d?(b.attr("audiostate","playing")&&b.audioComponent("pause"),c.attr("audiostate","paused")&&c.audioComponent("play")):d&&!e?c.attr("audiostate","paused")&&c.audioComponent("play"):b.attr("audiostate","playing")&&b.audioComponent("pause"),this.isCustomClick&&(a.find(".image-button-wrapper").unbind("click"),a.unbind("click"))}},{key:"gadgetPageShowEvent",value:function(){var a=this.jObject.parents(".page").find(".btn-gadget-pop-up[data-btnpopid^='"+this.jObject.attr("data-id")+"_']").find(".video-component-identifier").filter(":visible");a.length>0&&a.videoComponent("gadgetPageShowEvent")}},{key:"getCloseButtonDom",value:function(){return dom="<div class='close close-icon' tabindex='0' data-closeBtnLabel='"+this.labelOpts.closeAltText+"' data-icon='ic-ps-close' title='"+this.labelOpts.closeAltText+"'></div>\n\t\t<div class='close close-text' tabindex='0' data-closeBtnLabel='"+this.labelOpts.closeAltText+"'>"+this.labelOpts.closeAltText+"</div>",dom}},{key:"openWindowLink",value:function(){var a=this.jObject,b=this,c="",d={},e=$("body").find(".page:not(.hidden-page)").attr("id"),f={},g=void 0,h=void 0,i="",j=a.attr("data-click-function"),k=PearsonGL.utils.randomString(8)+PearsonGL.utils.randomString(8);f=$("body").find("#"+e),g=a.attr("data-id")+"_"+e,h=this.hostGadgetId+"_"+e,this.hasSetScormData||(this.saveLearnerData(),this.hasSetScormData=!0);var l=a.parents().find(".button-identifier[data-host-btn-id]");if(l&&l.length>0&&$.each(l,function(a,c){$(c).attr("data-host-btn-id")===h&&(b.isImageButton?($(c).find(".image-button-wrapper").removeClass(b.constants.ACTIVE_CLASS),$(c).find("img.base-button-down").hide(),$(c).find("img.base-button-over").hide(),$(c).find("img.base-button-active").hide(),$(c).find("img.base-button-default").show()):$(c).find(".text-button").removeClass(b.constants.ACTIVE_CLASS))}),this.stopAudioVideo(),this.isBtnClickAudio&&this.handleButtonClickAudio(),this.isGlossary&&this.sendAnalytics("clicked_header_glossary_button"),(this.isBtnClickAudioOnly||this.isCustomClick)&&(!this.isPageJump||!this.isGlossary))return void(this.isCustomClick&&(a.find(".image-button-wrapper").unbind("click"),a.unbind("click")));if(PearsonGL.utils.isNonEmptyString(j)||this.options.content||this.options.external||this.options.local||this.isPageJump||this.isGlossary){if(this.isTooltip&&(c=this.options.ttposition),this.isPopup&&this.options.popupposition&&(c="P"+this.options.popupposition),f.is(":visible"))if(this.hostGadgetId&&void 0!==this.hostGadgetId){if(d=f.find("[data-id='"+this.hostGadgetId+"']"),currGadgetPopup=d.find("[class^='btn-gadget-pop-up']"),a.attr("data-id")+"_"+e===currGadgetPopup.attr("data-btnpopid"))return this.togglePopup(currGadgetPopup),void this.setActiveButtonState();this.closeAnyPopUps(currGadgetPopup)}else this.closeAnyPopUps();if(this.isPageJump||this.isGlossary||!(this.isTooltip||this.isPopup||this.isLightBoxPopup||this.isHosted)){if(this.options.pageJump){var m="true"===a.attr("data-lsoverride");try{global_player.goToPage(this.options.pageJump[0].pageNumber,m)}catch(a){}return $(".text-button").removeClass("text-button-selected"),$(".image-button-wrapper").removeClass("image-button-selected"),this.options.pageJump[0].isSelected&&(a.find(".image-button-wrapper").addClass("image-button-selected"),a.find(".text-button").addClass("text-button-selected")),this.changeButtonStates(this.options.buttonStates.ALL),void this.changeButtonStates(this.options.buttonStates.DOWN)}if(PearsonGL.utils.isNonEmptyString(j))PearsonGL.utils.executeFunctionName(j);else if(this.isModal)this.buildIframeInDOM(),$(".iframemodal").find("iframe").attr("src",this.dataHref),$(".iframemodal").fadeIn(500,function(){$(this).focus()});else{var n="location=0,menubar=0";void 0!==this.winWidth&&void 0!==this.winHeight&&(n+=",width="+this.winWidth+",height="+this.winHeight),PearsonGL.utils.openBrowserPopupWindow(this.dataHref,"",n,!0),this.changeButtonStates(this.options.buttonStates.UP)}}else{if(this.isLightBoxPopup){$(".buttonlightBox").remove();var o=$(),p=$(),q=$(),r=$(),s=$(),t="dialogDesc"+k,u="<div class='buttonlightBox' aria-labelledby='"+t+"'><label id='"+t+"' class='dialog-label hide'>"+this.labelOpts.dialogLabeledByContent+"</label><div class='lightBoxModal hide'></div><div class='lightBoxTextContent hide'></div></div>";$("body").append(u),o=$("body").find(".buttonlightBox"),s=o.find(".dialog-label"),r=o.find(".lightBoxTextContent"),p=o.find(".lightBoxModal"),q=o.find(".lightBoxTextContent");var v={dialog:o,returnFocusTo:PearsonGL.utils.getActiveElement(),state:this.constants.DIALOG_OPEN};this.handleFocusTrap(v),q.css({width:this.winWidth+this.unit,height:this.winHeight+this.unit,"overflow-y":"auto"}),r.attr({id:"dialogDesc"+k}),s.attr({id:"dialogLabel"+k}),o.attr({role:"dialog",tabindex:0}),this.addWindowContent(".lightBoxTextContent",b.options.content[0]),o.hide(),o.append(this.getCloseButtonDom());var w=o.find(".close");return w.sliderbutton({buttonClassName:"close",slider:!1,tabIndexValue:0,clickFunction:function(a){v.state=b.constants.DIALOG_CLOSE,o.fadeOut(200,function(){$(".sco").find("#dialog-layer").remove()}),setTimeout(function(){b.handleFocusTrap(v)},200)}}),p.fadeIn(),void window.setTimeout(function(){o.fadeIn(400),w.focus(),PearsonGL.utils.initMathJax(o[0])},100)}$(".buttonlightBox").remove();var x=void 0;this.isHosted&&f.is(":visible")?(d=f.find(".gadget[data-id='"+this.hostGadgetId+"']"),i="btn-gadget-pop-up-toggle",this.hostMaxHeight=d.height(),this.hostMaxWidth=d.width()):i="btn-gadget-pop-up";var y='<div class="'+i+'" data-btnpopid="'+g+'"  data-popgadgetid="'+this.hostGadgetId+'"><div class="popup-header" tabindex="0"></div><div class="buttonPopUpText"><div class="popInnerWrapper"></div></div></div>';if(this.isTooltip)a.append(y),a.find(".popup-header").attr({"aria-hidden":!0,tabindex:"-1"});else{if(this.isHosted){if(d.is(":visible")){a.attr("data-host-btn-id",h),this.isToggled=!0;var z=$(".header, .footer").add($(".page").filter(":visible")).find(".button-identifier ."+b.constants.IS_TOGGLED_CLASS);z.length>0&&$.each(z,function(a,c){$(c).hasClass(b.constants.ACTIVE_CLASS)||$(c).removeClass(b.constants.IS_TOGGLED_CLASS).addClass(b.constants.IS_NOT_TOGGLED_CLASS)}),a.find(".image-button-wrapper").addClass(this.constants.ACTIVE_CLASS),this.isToggleButton&&a.find(".image-button-wrapper").removeClass(b.constants.IS_NOT_TOGGLED_CLASS).addClass(b.constants.IS_TOGGLED_CLASS),a.find(".text-button").addClass(this.constants.ACTIVE_CLASS),this.isToggleButton&&a.find(".text-button").removeClass(b.constants.IS_NOT_TOGGLED_CLASS).addClass(b.constants.IS_TOGGLED_CLASS),d.prepend(y),x=f.find("[data-btnpopid='"+g+"']")}}else f.is(":visible")&&0===f.find("."+i).length&&f.append(y);this.setActiveButtonState()}x=$("body").find("[data-btnpopid='"+g+"']"),popInnerWrapper=x.find(".popInnerWrapper"),buttonDialogModal=x.closest(".buttonDialogModal"),popInnerWrapper.attr({id:"dialogDesc"+k}),x.attr({role:"dialog",tabindex:0}),x.hide(),this.addWindowContent(popInnerWrapper,this.options.content[0]),this.isHosted&&!this.hasGadgetPopup&&(this.hasGadgetPopup=!0),this.isTooltip||this.isHosted||x.append(this.getCloseButtonDom());var A=x.find(".close"),B={dialog:x,returnFocusTo:PearsonGL.utils.getActiveElement(),state:this.constants.DIALOG_OPEN};A.sliderbutton({buttonClassName:"close",slider:!1,tabIndexValue:0,clickFunction:function(a){b.sendAnalytics("clicked_closed_window"),B.state=b.constants.DIALOG_CLOSE,b.closeAnyPopUps($(".sco").find("#dialog-layer")),b.contentAdded=!1,setTimeout(function(){b.handleFocusTrap(B)},200)}}),window.setTimeout(function(){b.positionIt(x,c),A.hide(),b.isPopup||b.options.popupClosesBy&&"button"===b.options.popupClosesBy?(A.show(),A.focus()):A.hide(),b.isTooltipOpen&&b.isTooltip?(b.closeAnyPopUps(x),this.contentAdded=!1):(b.isLightBoxPopup&&b.isModal&&lightBoxModal.fadeIn(200),x.fadeIn({duration:500,done:function(){PearsonGL.utils.initMathJax(x[0]),x.focus();var a=x.find(".video-player");a.length>0&&a.videoComponent("isReady"),b.isTooltip&&(b.isTooltipOpen=!0,$(document).bind("click.buttonObj touchstart.buttonObj",function(a){0===x.has(a.target).length&&(b.closeAnyPopUps(x),this.contentAdded=!1)}).keyup(function(a){a.keyCode!==PearsonGL.utils.keyCode.enter&&a.keyCode!==PearsonGL.utils.keyCode.escape||(a.keyCode===PearsonGL.utils.keyCode.enter?0===x.has(a.target).length&&(b.closeAnyPopUps(x),this.contentAdded=!1):(b.closeAnyPopUps(x),this.contentAdded=!1))}))}}))},100),this.isTooltip||this.isHosted||b.handleFocusTrap(B)}}}},{key:"addDialogLayer",value:function(a){$(".sco").prepend('<div id="dialog-layer" class="button-gadget-dialog-layer">\n\t\t<div "aria-modal"=true class="dialog-backdrop modal"></div></div>');var b=$(".sco").find("#dialog-layer");dialogBackdrop=$(".sco").find(".dialog-backdrop"),dialogBackdrop.append(a),b.fadeIn(200,function(){dialogBackdrop.addClass("active"),b.attr("aria-hidden",!1),dialogBackdrop.attr("aria-hidden",!1)})}},{key:"clearAriaLiveRegion",value:function(){this.jObject.find(".aria-live-region").text("")}},{key:"updateAriaLiveRegion",value:function(a){var b=this.jObject.find(".aria-live-region");this.clearAriaLiveRegion(),b.text(""+a)}},{key:"handleFocusTrap",value:function(a){var b=this;if(a.state===this.constants.DIALOG_OPEN){this.addDialogLayer(a.dialog),this.focusDialog=$(".sco").find("#dialog-layer");var c=this.focusDialog[0],d={nodeFocusedBeforeActivation:a.returnFocusTo};this.doFocusTrap=new PearsonGL.utils.doFocusTrap(c,d),this.focusTrap=this.doFocusTrap.focusTrap(c,{onActivate:function(){c.className="trap is-active"},onDeactivate:function(){c.className="trap",b.closeAnyPopUps(c)},initialFocus:this.focusDialog,escapeDeactivates:!0,nodeFocusedBeforeActivation:d.nodeFocusedBeforeActivation}),this.focusTrap.activate()}a.state===this.constants.DIALOG_CLOSE&&this.focusTrap.deactivate()}},{key:"setActiveButtonState",value:function(){var a=$(".header, .page:not(.hidden-page), .footer").find(".image-button-wrapper."+this.constants.ACTIVE_CLASS);a.length>0&&$.each(a,function(a,b){var c={down:$(b).find("img.base-button-down"),over:$(b).find("img.base-button-over"),up:$(b).find("img.base-button-default"),active:$(b).find("img.base-button-active")};c.down.hide(),c.up.hide(),c.over.hide(),c.active.show()})}},{key:"positionIt",value:function(a,b){if(a){var c=this,d=this.jObject,e=a.find(".buttonPopUpText"),f=a.find(".popInnerWrapper"),g=void 0,h=void 0,i=void 0,j=!1,k=!1,l="",m=$(window).width(),n=$(window).height(),o=0,p=0,q=0;l=$("body").find(".navbar").children().length>0?"body":"document";var r=c.options.button.buttonText?".base-button-inside-wrap":".base-button-default",s=d.find(r);q=s.position().left,s.position().top;var t=200,u=100,v=100,w=100,x=19,y=0,z=void 0,A=!1,B=10,C=0,D=void 0,E=void 0,F=void 0;switch(B+=a.find(".popup-header").height(),!c.isHosted&&c.isTooltip?(!s.hasOwnProperty("context")||"N"!==c.options.ttposition&&"S"!==c.options.ttposition?(o=s.width(),p=s.height()):(p=s.context.clientHeight,o=s.context.clientWidth),a.removeClass("window").addClass("tooltip"),a.find(".popup-header").hide()):(a.removeClass("tooltip").addClass("window"),c.options.responsive&&(j=this.options.responsive),j&&a.addClass("responsive-fixed-coord"),c.options.draggable&&(k=this.options.draggable),a.find(".popup-header").show().on("mousedown",function(){$(this).toggleClass("dragging","stopped")}).on("mouseup",function(){$(this).toggleClass("stopped","dragging")})),c.winWidth>0?(t=v=c.winWidth,v+="px"):t=Math.floor(m/2),c.winHeight>0?(u=c.winHeight,C=c.winHeight-parseInt(B,0)):(u=e.height(),C=e.height()-parseInt(B,0)),c.isHosted&&(b=c.constants.POP_HOSTED,v=this.hostMaxWidth,w=this.hostMaxHeight),y=25*o/100,b){case c.constants.TT_S:e.addClass("posArrowN"),i=p+6,g=(o-parseInt(t,10))/2;break;case c.constants.TT_N:e.addClass("posArrowS"),i=-1*u+16,g=(o-parseInt(t,10))/2;break;case c.constants.TT_E:e.addClass("posArrowE"),i=(u-p)/2*-1,g=q+o+x;break;case c.constants.TT_W:e.addClass("posArrowW"),i=(u-p)/2*-1,g=parseInt(-1*o)-y-x;break;case c.constants.TT_NW:e.addClass("posArrowSE"),i=-1*u-24,g=-1*(q+y);break;case c.constants.TT_NE:e.addClass("posArrowSW"),i=-1*u-24,g=q+o-y;break;case c.constants.TT_SW:e.addClass("posArrowNE"),i=p+x,g=-1*(q+y);break;case c.constants.TT_SE:e.addClass("posArrowNW"),i=p+x,g=q+o-y;break;case c.constants.POP_HOSTED:j=!1,a.addClass("frameless"),i=0,g=0,u="100%",t="100%",C="100%","auto",a.find(".popup-header").hide();break;case c.constants.POP_CENTER:A=!0,z=$(window),D="center",E="center";break;case c.constants.POP_N:i=80,g=(m-t)/2,h=null;break;case c.constants.POP_NE:i=50,g=null,h=0;break;case c.constants.POP_NW:i=50,g=0,h=null;break;case c.constants.POP_S:i=n-u-50,g=(m-t)/2,h=null;break;case c.constants.POP_SE:i=n-u-50,g=null,h=0;break;case c.constants.POP_SW:i=n-u-50,g=0,h=null;break;case c.constants.POP_E:i=(n-u)/2,g=null,h=0;break;case c.constants.POP_W:i=(n-u)/2,g=0,h=null;break;default:i=(n-u)/2,g=(m-t)/2,h=null}if(this.isPopup&&this.options.popupX&&this.options.popupY&&(i=this.options.popupY+"px",g=this.options.popupX+"px"),this.isPopup&&this.options.windowProps.unit&&"percent"==this.options.windowProps.unit&&!this.isHosted){var G=0,H=0;switch(c.winWidth>0?(v=c.winWidth+"%",G=c.winWidth):(G=v,v+="%"),t="100%",c.winHeight>0?(u=$(window).height()*(c.winHeight/100),H=c.winHeight):(u=.5*$(window).height(),H=50),C=u,b){case c.constants.POP_CENTER:i=(100-H)/2+"%",g=(100-G)/2+"%",h=null;break;case c.constants.POP_N:i="5%",g=(100-G)/2+"%",h=null;break;case c.constants.POP_NE:i="5%",g=null,h=0;break;case c.constants.POP_NW:i="5%",g=0,h=null;break;case c.constants.POP_S:i=100-H+"%",g=(100-G)/2+"%",h=null;break;case c.constants.POP_SE:i=100-H+"%",g=null,h=0;break;case c.constants.POP_SW:i=100-H+"%",g=0,h=null;break;case c.constants.POP_E:i=(100-H)/2+"%",g=null,h=0;break;case c.constants.POP_W:i=(100-H)/2+"%",g=0,h=null;break;default:i=(100-H)/2+"%",g=(100-G)/2+"%",h=null}$(window).bind("resize.hotspot",function(a){u=c.winHeight>0?$(window).height()*(c.winHeight/100):.5*$(window).height(),C=u,f.css({height:C})})}var I={"max-width":v,width:t,height:u,top:i,left:g,right:h},J={"max-width":v,"max-height":w,width:t,height:u};this.isHosted?f.css({"max-height":w,height:C}):f.css({height:C}),k&&a.draggable({containment:l,handle:a.find(".popup-header"),scroll:!0,stop:function(){c.sendAnalytics("clicked_moved_window")}}),A?(a.css(J),a.position({my:D,at:E,offset:F,of:z})):this.isHosted?a.css(J):a.css(I)}}},{key:"saveLearnerData",value:function(){var a=[];this.isCommEnabled()&&(this.options.scorm.interactions.forEach(function(b){var c=b.objectives[0],d={};d.raw=c.score.max,d.min=c.score.min,d.max=c.score.max,d.scaled=1,d.learnerResponse="Button Gadget Click",d.correctResponse="Button Gadget Click",d.correctResponses=[],d.result="neutral",d.successStatus="passed",d.completionStatus="completed",d.progressMeasure=1,a.push(d)}),this.setLearnerData({gadgetId:this.gadgetUniqueId,data:this.options.scorm,results:a}))}},{key:"fireEvent",value:function(a){$(window).trigger(a,{sourceId:this.gadgetUniqueId,buttonId:this.buttonId})}}]),b}(PearsonGL.Gadget.GadgetBase);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.FreeForm=function(b){function d(a,b,c){_classCallCheck(this,d);var e=_possibleConstructorReturn(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,c));if(!b)return _possibleConstructorReturn(e);if(PearsonGL.utils.hasParmContent()&&PearsonGL.parmMgr&&e.parseParmValues(b),e.labelOpts={closeToolTip:"Close",yesToolTip:"Yes",noToolTip:"No",selectedText:"SELECTED",turnoffaudio:"Screen reader users, press enter to disable audio on draggable tiles.",turnonaudio:"Screen reader users, press enter to enable audio on draggable tiles.",cellLabel:"cell",ofLabel:"of"},e.options=$.extend(!0,{gadgetName:"FreeForm",objectiveDescription:"User interacts with a FreeForm Drag and Drop.",randomize:!1,cloning:!0,draggableText:[],draggableImage:[],textLabels:[],imageLabels:[],draggables:[],droppablesGrid:[],droppablesFree:[],droppables:[],labels:[],tileTally:[],zoneTally:[],dragZoneTally:[],totalTally:[],feedBack:[],numOfDrops:0,autoPlayFeedback:!1,fadeOutFeedback:!1,selectedText:"SELECTED",closeToolTip:"Close",yesToolTip:"Yes",noToolTip:"No",turnoffaudio:"Screen reader users, press enter to disable audio on draggable tiles.",turnonaudio:"Screen reader users, press enter to enable audio on draggable tiles.",cellLabel:"cell",ofLabel:"of",popupcontainment:".main"},e.options||{}),b.hasOwnProperty("cloning"))if(!0===b.cloning){if(b.hasOwnProperty("draggableImage"))for(optionsProperty in b.draggableImage)b.draggableImage[optionsProperty].cloning=!0;else if(b.hasOwnProperty("draggableText"))for(optionsProperty in b.draggableText)b.draggableText[optionsProperty].cloning=!0}else{if(b.hasOwnProperty("draggableImage"))for(optionsProperty in b.draggableImage)b.draggableImage[optionsProperty].cloning=!1;else if(b.hasOwnProperty("draggableText"))for(optionsProperty in b.draggableText)b.draggableText[optionsProperty].cloning=!1;b.cloning=!0}return e.zIndexBase=100,e.jObject=$(a),e.initialize(a,b),e}return _inherits(d,b),_createClass(d,[{key:"initialize",value:function(a,b){if(this.initGadget(this.options.gadgetName),void 0!==a){var c=this;PearsonGL.utils.getGlobalizedLabel("freeform_globalization",function(a){c.transferLabels(a),delete b.scorm,$.extend(!0,c.options,b),c.globalizationComplete()},this.options.runtimejson.lang)}}},{key:"parseParmValues",value:function(a){function b(a){for(c=0;c<a.length;c++)h=a[c],h.defaultVal&&(h.defaultVal=PearsonGL.qtiEvaluator.evaluateFloat(h.defaultVal).value),h.tallyX&&(h.tallyX=PearsonGL.qtiEvaluator.evaluateFloat(h.tallyX).value),h.tallyY&&(h.tallyY=PearsonGL.qtiEvaluator.evaluateFloat(h.tallyY).value),h.denominator&&(h.denominator=PearsonGL.qtiEvaluator.evaluateFloat(h.denominator).value),h.width&&(h.width=PearsonGL.qtiEvaluator.evaluateFloat(h.width).value),h.decimals&&(h.decimals=PearsonGL.qtiEvaluator.evaluateFloat(h.decimals).value),h.textString&&(h.textString=PearsonGL.qtiEvaluator.replaceParameters(h.textString))}var c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0;if(a.dragAndDropBackground&&(a.dragAndDropBackground=PearsonGL.qtiEvaluator.evaluateAsset(a.dragAndDropBackground)),a.backgroundTitle&&(a.backgroundTitle=PearsonGL.qtiEvaluator.replaceParameters(a.backgroundTitle)),a.longDesc&&(a.longDesc=PearsonGL.qtiEvaluator.replaceParameters(a.longDesc)),a.tileWidth=PearsonGL.qtiEvaluator.evaluateFloat(a.tileWidth).value,a.tileHeight=PearsonGL.qtiEvaluator.evaluateFloat(a.tileHeight).value,a.droppablesGrid)for(c=0;c<a.droppablesGrid.length;c++)e=a.droppablesGrid[c],e.droppableX=PearsonGL.qtiEvaluator.evaluateFloat(e.droppableX).value,e.droppableY=PearsonGL.qtiEvaluator.evaluateFloat(e.droppableY).value,e.title&&(e.title=PearsonGL.qtiEvaluator.replaceParameters(e.title)),e.acceptNum=PearsonGL.qtiEvaluator.evaluateFloat(e.acceptNum).value,e.rows=PearsonGL.qtiEvaluator.evaluateFloat(e.rows).value,e.zIndex&&(e.zIndex=PearsonGL.qtiEvaluator.evaluateFloat(e.zIndex).value);if(a.droppablesFree)for(c=0;c<a.droppablesFree.length;c++)e=a.droppablesFree[c],e.droppableX=PearsonGL.qtiEvaluator.evaluateFloat(e.droppableX).value,e.droppableY=PearsonGL.qtiEvaluator.evaluateFloat(e.droppableY).value,e.title&&(e.title=PearsonGL.qtiEvaluator.replaceParameters(e.title)),e.droppableWidth=PearsonGL.qtiEvaluator.evaluateFloat(e.droppableWidth).value,e.droppableHeight=PearsonGL.qtiEvaluator.evaluateFloat(e.droppableHeight).value,e.zIndex&&(e.zIndex=PearsonGL.qtiEvaluator.evaluateFloat(e.zIndex).value);if(a.draggableText)for(c=0;c<a.draggableText.length;c++)e=a.draggableText[c],e.draggableX=PearsonGL.qtiEvaluator.evaluateFloat(e.draggableX).value,e.draggableY=PearsonGL.qtiEvaluator.evaluateFloat(e.draggableY).value,e.tileValue&&(e.tileValue=PearsonGL.qtiEvaluator.evaluateFloat(e.tileValue).value),e.width&&(e.width=PearsonGL.qtiEvaluator.evaluateFloat(e.width).value),e.height&&(e.height=PearsonGL.qtiEvaluator.evaluateFloat(e.height).value),e.zIndex&&(e.zIndex=PearsonGL.qtiEvaluator.evaluateFloat(e.zIndex).value),e.dragText&&(e.dragText.value=PearsonGL.qtiEvaluator.replaceParameters(e.dragText.value),e.dragText.audioComponent&&e.dragText.audioComponent.src&&(e.dragText.audioComponent.src=PearsonGL.qtiEvaluator.evaluateAsset(e.dragText.audioComponent.src)));if(a.draggableImage)for(c=0;c<a.draggableImage.length;c++)if(e=a.draggableImage[c],e.draggableX=PearsonGL.qtiEvaluator.evaluateFloat(e.draggableX).value,e.draggableY=PearsonGL.qtiEvaluator.evaluateFloat(e.draggableY).value,e.zIndex&&(e.zIndex=PearsonGL.qtiEvaluator.evaluateFloat(e.zIndex).value),e.tileValue&&(e.tileValue=PearsonGL.qtiEvaluator.evaluateFloat(e.tileValue).value),e.width&&(e.width=PearsonGL.qtiEvaluator.evaluateFloat(e.width).value),e.height&&(e.height=PearsonGL.qtiEvaluator.evaluateFloat(e.height).value),e.dragImage&&(e.dragImage.title&&(e.dragImage.title=PearsonGL.qtiEvaluator.replaceParameters(e.dragImage.title)),e.dragImage.src&&(e.dragImage.src=PearsonGL.qtiEvaluator.evaluateAsset(e.dragImage.src)),e.dragImage.audioComponent&&e.dragImage.audioComponent.src&&(e.dragImage.audioComponent.src=PearsonGL.qtiEvaluator.evaluateAsset(e.dragImage.audioComponent.src,{},this.gadgetUniqueId))),e.rotationX&&(e.rotationX=PearsonGL.qtiEvaluator.evaluateFloat(e.rotationX).value),e.rotationY&&(e.rotationY=PearsonGL.qtiEvaluator.evaluateFloat(e.rotationY).value),e.angle&&(e.angle=PearsonGL.qtiEvaluator.evaluateFloat(e.angle).value),e.hotspots)for(d=0;d<e.hotspots.length;d++)hotspot=e.hotspots[d],hotspot.area=PearsonGL.qtiEvaluator.replaceParameters(hotspot.area),hotspot.title=PearsonGL.qtiEvaluator.replaceParameters(hotspot.title);if(a.tileTally&&b(a.tileTally),a.zoneTally&&b(a.zoneTally),a.dragZoneTally&&b(a.dragZoneTally),a.totalTally)for(c=0;c<a.totalTally.length;c++)h=a.totalTally[c],h.defaultVal&&(h.defaultVal=PearsonGL.qtiEvaluator.evaluateFloat(h.defaultVal).value),h.totalX&&(h.totalX=PearsonGL.qtiEvaluator.evaluateFloat(h.totalX).value),h.totalY&&(h.totalY=PearsonGL.qtiEvaluator.evaluateFloat(h.totalY).value),h.denominator&&(h.denominator=PearsonGL.qtiEvaluator.evaluateFloat(h.denominator).value),h.width&&(h.width=PearsonGL.qtiEvaluator.evaluateFloat(h.width).value),h.decimals&&(h.decimals=PearsonGL.qtiEvaluator.evaluateFloat(h.decimals).value),h.textString&&(h.textString=PearsonGL.qtiEvaluator.replaceParameters(h.textString));if(a.feedBack)for(c=0;c<a.feedBack.length;c++)g=a.feedBack[c],g.feedBackContent&&(g.feedBackContent.feedX&&(g.feedBackContent.feedX=PearsonGL.qtiEvaluator.evaluateFloat(g.feedBackContent.feedX).value),g.feedBackContent.feedY&&(g.feedBackContent.feedY=PearsonGL.qtiEvaluator.evaluateFloat(g.feedBackContent.feedY).value),g.feedBackContent.totalY&&(g.feedBackContent.totalY=PearsonGL.qtiEvaluator.evaluateFloat(g.feedBackContent.totalY).value),g.feedBackContent.mainBody&&(g.feedBackContent.mainBody=PearsonGL.qtiEvaluator.replaceParameters(g.feedBackContent.mainBody)),g.feedBackContent.mainBodyAudio&&g.feedBackContent.mainBodyAudio.src&&(g.feedBackContent.mainBodyAudio.src=PearsonGL.qtiEvaluator.evaluateAsset(g.feedBackContent.mainBodyAudio.src)),g.feedBackContent.mainImage&&(g.feedBackContent.mainImage=PearsonGL.qtiEvaluator.evaluateAsset(g.feedBackContent.mainImage)),g.feedBackContent.mainImageTitle&&(g.feedBackContent.mainImageTitle=PearsonGL.qtiEvaluator.evaluateAsset(g.feedBackContent.mainImageTitle)),g.feedBackContent.mainImageAudio&&g.feedBackContent.mainImageAudio.src&&(g.feedBackContent.mainImageAudio.src=PearsonGL.qtiEvaluator.evaluateAsset(g.feedBackContent.mainImageAudio.src)));if(a.textLabels)for(c=0;c<a.textLabels.length;c++)f=a.textLabels[c],f.labelX=PearsonGL.qtiEvaluator.evaluateFloat(f.labelX).value,f.labelY=PearsonGL.qtiEvaluator.evaluateFloat(f.labelY).value,f.width&&(f.width=PearsonGL.qtiEvaluator.evaluateFloat(f.width).value),f.zIndex&&(f.zIndex=PearsonGL.qtiEvaluator.evaluateFloat(f.zIndex).value),f.labelText&&(f.labelText.value&&(f.labelText.value=PearsonGL.qtiEvaluator.replaceParameters(f.labelText.value)),f.labelText.audioComponent&&f.labelText.audioComponent.src&&(f.labelText.audioComponent.src=PearsonGL.qtiEvaluator.evaluateAsset(f.labelText.audioComponent.src)));if(a.imageLabels)for(c=0;c<a.imageLabels.length;c++)f=a.imageLabels[c],f.labelX=PearsonGL.qtiEvaluator.evaluateFloat(f.labelX).value,f.labelY=PearsonGL.qtiEvaluator.evaluateFloat(f.labelY).value,f.zIndex&&(f.zIndex=PearsonGL.qtiEvaluator.evaluateFloat(f.zIndex).value),f.labelImage&&(f.labelImage.title&&(f.labelImage.title=PearsonGL.qtiEvaluator.replaceParameters(f.labelImage.title)),f.labelImage.src&&(f.labelImage.src=PearsonGL.qtiEvaluator.evaluateAsset(f.labelImage.src)),f.labelImage.audioComponent&&f.labelImage.audioComponent.src&&(f.labelImage.audioComponent.src=PearsonGL.qtiEvaluator.evaluateAsset(f.labelImage.audioComponent.src)))}},{key:"disappearTile",value:function(a,b){var c=this;"true"===$(a).attr("data-clone-state")&&(b?$(a).fadeOut("medium",function(){$(a).remove(),c.updateTallys()}):$(a).animate({top:$(a).attr("data-top"),left:$(a).attr("data-left")},500,function(){$(a).remove(),c.updateTallys()}))}},{key:"transferLabels",value:function(a){var b=this.options,c=$.extend(!0,this.labelOpts,a);b.selectedText=c.selectedText,b.closeToolTip=c.closeToolTip,b.yesToolTip=c.yesToolTip,b.noToolTip=c.noToolTip,b.turnoffaudio=c.turnoffaudio,b.turnonaudio=c.turnonaudio,b.cellLabel=c.cellLabel,b.ofLabel=c.ofLabel}},{key:"globalizationComplete",value:function(){this.jObject.data("gadget_options",this.options),this.jObject.addClass("ffdnd-identifier"),$("body").addClass("non-responsive"),this.jObject.append("<div class='freeform-spacer'></div>"),this.scormData&&this.scormData.tiles&&this.scormData.tiles.length>0?this.scormData={tiles:this.scormData.tiles}:this.scormData={tiles:[]},this.clone=[],this.zdex=20,this.hasZIndexOrder=!1,this.isOverDrop=!1,this.gridDnd=!0,this.hasTotal=!1,this.feedBackObj={},this.popuptimeout=null,this.dropCounter=0,this.hasShowSolution=!1,this.hasBeenInteractedWith=!1,this.tileData={},this.isRotating=!1,this.isLoaded=!1,this.options.draggables=this.options.draggables.concat(this.options.draggableText,this.options.draggableImage),this.options.labels=this.options.labels.concat(this.options.textLabels,this.options.imageLabels),this.isOnDropZone=void 0,this.options.droppablesGrid.length>this.options.droppablesFree.length?this.options.droppables=this.options.droppablesGrid:(this.gridDnd=!1,this.options.droppables=this.options.droppablesFree),this.initZIndex(),this.setUpDnD(),this.getLearnerData({results:[{correctResponses:[{pattern:"Freeform Drag and Drop Complete"}],learnerResponse:"Freeform Drag and Drop Incomplete"}]})}},{key:"destroy",value:function(){this.jObject&&(this.jObject.children().remove(),this.jObject.removeClass("ffdnd-identifier"),this.jObject.removeClass("has-bk"))}},{key:"setUpDraggableTally",value:function(a,b){var c=this,d=c.jObject,e={},f=null,g=void 0,h=void 0;$(a).each(function(a){g=d.find('.drag-item[data-dragid="'+this.dragId+'"]'),g.length>0&&(f=$('<span class="tally"><span class="tally-wrap"><span data-text="" class="mains">'+(void 0!==this.defaultVal?this.defaultVal:0)+"</span></span></span>"),f.attr("data-default-val",void 0!==this.defaultVal?this.defaultVal:0),void 0!==this.decimals&&f.attr("data-decimals",this.decimals),f.find(".mains").attr("data-count",void 0!==this.defaultVal?this.defaultVal:0),void 0!==this.denominator&&this.denominator>0&&f.find(".tally-wrap").append('<span class="denom">'+this.denominator+"</span>"),"right"==this.align?f.find(".tally-wrap").addClass("rightFloat"):"center"==this.align&&f.addClass("centerFloat"),void 0!==this.textString&&""!==this.textString?(f.find(".mains").attr("data-text",this.textString),f.find("*").hasClass("denom")&&(h=f.find(".denom").html(),f.find(".denom").html(h+" "+this.textString)),h=f.find(".mains").html(),h=PearsonGL.utils.formatNumber(h,this.decimals),f.find(".mains").html(h+" "+this.textString),f.find(".mains").attr("aria-hidden","true"),f.attr("aria-label","tally "+h+" "+this.textString)):(h=f.find(".mains").html(),h=PearsonGL.utils.formatNumber(h,this.decimals),f.find(".mains").html(h),f.find(".mains").attr("aria-hidden","true"),f.attr("aria-label","tally "+h)),void 0!==this.width&&f.css("width",this.width+"px"),e={"data-report-total":this.report},e[b]=this.dragId,this.dropId&&(e["data-dropid"]=this.dropId),f.attr(e),d.find(".freeform-spacer").append(f),void 0===this.tallyY?f.css({top:parseFloat(g.css("top"))+g.height()+5+"px"}):f.css({top:this.tallyY+"px"}),void 0===this.tallyX?f.css({left:parseFloat(g.css("left"))+g.width()/2-f.width()/2+"px"}):f.css({left:this.tallyX+"px"}))})}},{key:"setUpDnD",value:function(a){var b=this,c=b.jObject,d=$("<div></div>"),e=$("<div></div>"),f=void 0,g=0,h=[],i=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=1,p=null,q=0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,w=!0;if(allElement=[],allReadOrder=[],allDraggables=[],allDroppables=[],allLabels=[],draggableTextImageLength=0,ffSpacerHeight=0,ffSpacerWidth=0,a&&(b.options.randomize=!0),b.addTurnOffAudioLink(),b.dragHandle=$('<div class="drag-handle"></div>'),c.find(".freeform-spacer").append(b.dragHandle),b.setupDraggableHandler(b.dragHandle),b.dragHandle.hide(),void 0!==b.options.dragAndDropBackground&&b.options.dragAndDropBackground.length>0)k=document.createElement("img"),k.src=b.options.dragAndDropBackground,$(k).attr("alt",b.options.backgroundTitle?b.options.backgroundTitle:"").addClass("bk-img"),c.find(".freeform-spacer").append(k),$(k).load(function(){$(this).parent(".freeform-spacer:visible").css({height:this.height+"px",width:this.width+"px"}),$(this).parent().parent(".ffdnd-identifier:visible").css({width:this.width+"px"})}),$(k).Protector(),c.addClass("has-bk"),this.addLongDescription($(k),b.options.longDesc);else{var x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=parseInt(b.options.tileHeight),F=parseInt(b.options.tileWidth);$(b.options.draggables).each(function(a){var c=parseInt(b.options.draggables[a].draggableY),d=parseInt(b.options.draggables[a].height)||E;0===x&&(x=c+d),x<c+d&&(x=c+d)}),$(b.options.draggableTextImage).each(function(a){var c=parseInt(b.options.draggableTextImage[a].draggableY),d=parseInt(b.options.draggableTextImage[a].height)||E;0===x&&(x=c+d),x<c+d&&(x=c+d)}),$(b.options.droppables).each(function(a){var c=parseInt(b.options.droppables[a].droppableY),d=parseInt(b.options.droppables[a].droppableHeight)||E*parseInt(b.options.droppables[a].rows)||0;0===y&&(y=c+d),y<c+d&&(y=c+d)}),$(b.options.labels).each(function(a){var c=parseInt(b.options.labels[a].labelY);0===z&&(z=c),z<c&&(z=c)}),$(b.options.tileTally).each(function(a){var c=parseInt(b.options.tileTally[a].tallyY)||0;0===A&&(A=c),A<c&&(A=c)}),$(b.options.zoneTally).each(function(a){var c=parseInt(b.options.zoneTally[a].tallyY)||0;0===B&&(B=c),B<c&&(B=c)}),$(b.options.dragZoneTally).each(function(a){var c=parseInt(b.options.dragZoneTally[a].tallyY)||0;0===C&&(C=c),C<c&&(C=c)}),$(b.options.totalTally).each(function(a){var c=parseInt(b.options.totalTally.totalY)||0;0===D&&(D=c),D<c&&(D=c)}),ffSpacerHeight=Math.max(x,y,z,A,B,C,D),x=0,y=0,z=0,A=0,B=0,C=0,D=0,$(b.options.draggables).each(function(a){var c=parseInt(b.options.draggables[a].draggableX),d=parseInt(b.options.draggables[a].width)||F;0===x&&(x=c+d),x<c+d&&(x=c+d)}),$(b.options.draggableTextImage).each(function(a){var c=parseInt(b.options.draggableTextImage[a].draggableX),d=parseInt(b.options.draggableTextImage[a].width)||F;0===x&&(x=c+d),x<c+d&&(x=c+d)}),$(b.options.droppables).each(function(a){var c=parseInt(b.options.droppables[a].droppableX),d=parseInt(b.options.droppables[a].droppableWidth)||F*parseInt(b.options.droppables[a].rows)||0;0===y&&(y=c+d),y<c+d&&(y=c+d)}),$(b.options.labels).each(function(a){var c=parseInt(b.options.labels[a].labelX),d=parseInt(b.options.labels[a].width)||0;0===z&&(z=c+d),z<c&&(z=c+d)}),$(b.options.tileTally).each(function(a){var c=parseInt(b.options.tileTally[a].tallyX)||0,d=parseInt(b.options.tileTally[a].width)||0;0===A&&(A=c+d),A<c&&(A=c+d)}),$(b.options.zoneTally).each(function(a){var c=parseInt(b.options.zoneTally[a].tallyX)||0,d=parseInt(b.options.zoneTally[a].width)||0;0===B&&(B=c+d),B<c&&(B=c+d)}),$(b.options.dragZoneTally).each(function(a){var c=parseInt(b.options.dragZoneTally[a].tallyX)||0,d=parseInt(b.options.dragZoneTally[a].width)||0;0===C&&(C=c+d),C<c&&(C=c+d)}),$(b.options.totalTally).each(function(a){var c=parseInt(b.options.totalTally.totalX)||0,d=parseInt(b.options.totalTally.width)||0;0===D&&(D=c+d),D<c&&(D=c+d)}),ffSpacerWidth=Math.max(x,y,z,A,B,C,D),c.find(".freeform-spacer").css({height:ffSpacerHeight+"px",width:ffSpacerWidth+"px"}),c.css({width:ffSpacerWidth+"px"})}if(c.attr("data-custom-view"))try{var G=c.attr("data-custom-view"),H=G.split("."),I=void 0;"function"==typeof window[H[0]][H[1]]&&(I=window[H[0]][H[1]](c),b.options.draggables=I.draggables,b.options.droppables=I.droppables,b.options.tileWidth=I.tileWidth,b.options.tileHeight=I.tileHeight,this.gridDnd=I.isGridDnd,b.customClone=I.cloneTile,b.customClickEventHandler=I.clickEventHandler,b.customStartOverEventHandler=I.startOverEventHandler)}catch(a){}else b.options.labels&&b.options.labels.length>0&&void 0!==b.options.labels[0].readOrder&&(allLabels=b.options.labels,allLabels.sort(function(a,b){return a.readOrder-b.readOrder})),$(b.options.labels).each(function(a){w=!0,void 0!==this.labelText&&""!==this.labelText.value&&void 0!==this.labelText.value&&(f=$('<div class="labels" id="label'+a+'"></div>'),this.width&&f.css("width",this.width+"px"),f.attr("data-readorder",b.options.labels[a].readOrder),f.css({position:"absolute",left:this.labelX+"px",top:this.labelY+"px"}),this.labelText.noTabIndex=!0,f.richtextcomponent(this.labelText),void 0!==this.labelText.audioComponent&&void 0!==this.labelText.audioComponent.src&&""!==this.labelText.audioComponent.src&&f.find(".gadget-textblock").audioComponent(this.labelText.audioComponent,this.gadgetUniqueId),b.options.draggableTextImage&&b.options.draggableTextImage.length>0&&void 0!==b.options.draggableTextImage[0].readOrder?(allElement.push(f),w=!1):b.options.draggables&&b.options.draggables.length>0&&void 0!==b.options.draggables[0].readOrder&&w&&(allElement.push(f),w=!1),w&&f.appendTo(c)),void 0!==this.labelImage&&""!==this.labelImage.src&&void 0!==this.labelImage.src&&(f=$('<div class="labels" id="label'+a+'"></div>'),f.attr("data-readorder",b.options.labels[a].readOrder),f.css({position:"absolute",left:this.labelX+"px",top:this.labelY+"px"}),this.labelImage.noTabIndex=!0,f.imagecomponent(this.labelImage),void 0!==this.labelImage.audioComponent&&""!==this.labelImage.audioComponent.src&&f.find(".image-class-wrapper").audioComponent(this.labelImage.audioComponent,this.gadgetUniqueId),b.options.draggableTextImage&&b.options.draggableTextImage.length>0&&void 0!==b.options.draggableTextImage[0].readOrder?(allElement.push(f),w=!1):b.options.draggables&&b.options.draggables.length>0&&void 0!==b.options.draggables[0].readOrder&&w&&(allElement.push(f),w=!1),w&&f.appendTo(c)),b.hasZIndexOrder&&f.css("z-index",$.isNumeric(this.zIndex)?this.zIndex+b.zIndexBase:b.zIndexBase)}),b.options.hasOwnProperty("draggableTextImage")&&(b.options.draggableTextImage&&b.options.draggableTextImage.length>0&&void 0!==b.options.draggableTextImage[0].readOrder&&(allDraggables=b.options.draggableTextImage,allDraggables.sort(function(a,b){return a.readOrder-b.readOrder})),draggableTextImageLength=b.options.draggableTextImage.length,$(b.options.draggableTextImage).each(function(a){v=b.hasZIndexOrder?$.isNumeric(this.zIndex)?this.zIndex+b.zIndexBase:b.zIndexBase:b.zdex,i=d.clone(),!0===b.options.draggableTextImage[a].cloning?i.attr({id:"d"+a,"data-clone-state":"true","unique-id":"d"+a,"data-inArray":a,"data-dragid":this.dragId,"data-value":void 0!==this.tileValue?this.tileValue:"1","data-multi":void 0!==this.tileMultiplier?this.tileMultiplier:"1","data-tally":"false","data-readorder":b.options.draggableTextImage[a].readOrder}).css({width:b.options.tileWidth+"px",height:b.options.tileHeight+"px",zIndex:v}).addClass("drag-item").append('<div class="drag-bk"><div class="shade"></div></div>'):i.attr({id:"d"+a,"data-clone-state":"false","unique-id":"d"+a,"data-inArray":a,"data-dragid":this.dragId,"data-value":void 0!==this.tileValue?this.tileValue:"1","data-multi":void 0!==this.tileMultiplier?this.tileMultiplier:"1","data-tally":"false","data-readorder":b.options.draggableTextImage[a].readOrder}).css({width:b.options.tileWidth+"px",height:b.options.tileHeight+"px",zIndex:v}).addClass("drag-item").append('<div class="drag-bk"><div class="shade"></div></div>'),i.addClass("text-image-tile"),void 0!==this.width&&i.css("width",this.width+"px"),void 0!==this.height&&i.css("height",this.height+"px"),h.push(i),allElement.push(i),g=0}).each(function(a){var d=void 0;!0===b.options.randomize?(i=h[a=Math.floor(Math.random()*h.length)],b.options.labels.length>0&&g<b.options.labels.length&&void 0!==b.options.labels[g].readOrder&&b.options.labels[g].readOrder===b.options.draggableTextImage[g].readOrder?(d=parseInt($(i[0]).attr("data-readorder")),b.options.labels[Math.abs(h.length-b.options.draggableTextImage.length)].readOrder=d,b.options.draggableTextImage[Math.abs(h.length-b.options.draggableTextImage.length)].readOrder=d,i.attr({"data-top":b.options.draggableTextImage[d-1].draggableY,"data-left":b.options.draggableTextImage[d-1].draggableX}).css({top:b.options.draggableTextImage[d-1].draggableY+"px",left:b.options.draggableTextImage[d-1].draggableX+"px"})):(b.options.draggableTextImage.length>0&&void 0!==b.options.draggableTextImage[0].readOrder&&(d=parseInt($(i[0]).attr("data-readorder")),b.options.draggableTextImage[Math.abs(h.length-b.options.draggableTextImage.length)].readOrder=d),i.attr({"data-top":this.draggableY,"data-left":this.draggableX}).css({top:this.draggableY+"px",left:this.draggableX+"px"})),h.splice(a,1)):(i=h[a],i.attr({"data-top":this.draggableY,"data-left":this.draggableX}).css({top:this.draggableY+"px",left:this.draggableX+"px"})),g++,b.options.draggableTextImage&&b.options.draggableTextImage.length>0&&void 0===b.options.draggableTextImage[0].readOrder&&c.find(".freeform-spacer").append(i)})),h=[],(b.options.hasOwnProperty("draggableText")||b.options.hasOwnProperty("draggableImage"))&&(b.options.draggables&&b.options.draggables.length>0&&void 0!==b.options.draggables[0].readOrder&&(allDraggables=b.options.draggables,allDraggables.sort(function(a,b){return a.readOrder-b.readOrder})),$(b.options.draggables).each(function(a){v=b.hasZIndexOrder?$.isNumeric(this.zIndex)?this.zIndex+b.zIndexBase:b.zIndexBase:b.zdex,i=d.clone(),!0===b.options.draggables[a].cloning?i.attr({id:"d"+(a+draggableTextImageLength),"data-clone-state":"true","unique-id":"d"+(a+draggableTextImageLength),"data-inArray":a,"data-dragid":this.dragId,"data-value":void 0!==this.tileValue?this.tileValue:"1","data-multi":void 0!==this.tileMultiplier?this.tileMultiplier:"1","data-tally":"false","data-readorder":b.options.draggables[a].readOrder}).css({width:b.options.tileWidth+"px",height:b.options.tileHeight+"px",zIndex:v}).addClass("drag-item").append('<div class="drag-bk"><div class="shade"></div></div>'):i.attr({id:"d"+(a+draggableTextImageLength),"data-clone-state":"false","unique-id":"d"+(a+draggableTextImageLength),"data-inArray":a,"data-dragid":this.dragId,"data-value":void 0!==this.tileValue?this.tileValue:"1","data-multi":void 0!==this.tileMultiplier?this.tileMultiplier:"1","data-tally":"false","data-readorder":b.options.draggables[a].readOrder}).css({width:b.options.tileWidth+"px",height:b.options.tileHeight+"px",zIndex:v}).addClass("drag-item").append('<div class="drag-bk"><div class="shade"></div></div>'),void 0!==this.width&&i.css("width",this.width+"px"),void 0!==this.height&&i.css("height",this.height+"px"),h.push(i),allElement.push(i),g=0}).each(function(a){var d=void 0;!0===b.options.randomize?(i=h[a=Math.floor(Math.random()*h.length)],b.options.labels.length>0&&g<b.options.labels.length&&void 0!==b.options.labels[g].readOrder&&b.options.labels[g].readOrder===b.options.draggables[g].readOrder?(d=parseInt($(i[0]).attr("data-readorder")),b.options.labels[Math.abs(h.length-b.options.draggables.length)].readOrder=d,b.options.draggables[Math.abs(h.length-b.options.draggables.length)].readOrder=d,i.attr({"data-top":b.options.draggables[d-1].draggableY,"data-left":b.options.draggables[d-1].draggableX}).css({top:b.options.draggables[d-1].draggableY+"px",left:b.options.draggables[d-1].draggableX+"px"})):(b.options.draggables.length>0&&void 0!==b.options.draggables[0].readOrder&&(d=parseInt($(i[0]).attr("data-readorder")),b.options.draggables[Math.abs(h.length-b.options.draggables.length)].readOrder=d),i.attr({"data-top":this.draggableY,"data-left":this.draggableX}).css({top:this.draggableY+"px",left:this.draggableX+"px"})),h.splice(a,1)):(i=h[a],i.attr({"data-top":this.draggableY,"data-left":this.draggableX}).css({top:this.draggableY+"px",left:this.draggableX+"px"})),g++,b.options.draggables&&b.options.draggables.length>0&&void 0===b.options.draggables[0].readOrder&&c.find(".freeform-spacer").append(i)}));if(b.options.draggableTextImage&&b.options.draggableTextImage.length>0&&void 0!==b.options.draggableTextImage[0].readOrder)for(g=0;g<b.options.draggableTextImage.length;g++)$(allElement[g+b.options.labels.length][0]).attr("data-readorder",b.options.draggableTextImage[g].readOrder);if(b.options.draggables&&b.options.draggables.length>0&&void 0!==b.options.draggables[0].readOrder)for(g=0;g<b.options.draggables.length;g++)$(allElement[g+b.options.labels.length+draggableTextImageLength][0]).attr("data-readorder",b.options.draggables[g].readOrder);if(draggableTextImageLength>0?(allDraggables=b.options.draggableTextImage,allDraggables=allDraggables.concat(b.options.draggables)):allDraggables=b.options.draggables,c.find(".freeform-spacer").append('<span class="drag-before hidden-label"></span>'),c.find(".freeform-spacer").append('<span class="drag-section hidden-label"></span>'),b.options.labels&&b.options.labels.length>0&&void 0!==b.options.labels[0].readOrder&&b.options.labels.length>=b.options.draggables.length)for(g=0;g<b.options.draggables.length;g++)b.options.labels[g].readOrder===b.options.draggables[g].readOrder&&($(allElement[g][0]).attr("data-readorder",b.options.labels[g].readOrder),$(allElement[g][0]).css({top:b.options.labels[b.options.labels[g].readOrder-1].labelY+"px",left:b.options.labels[b.options.labels[g].readOrder-1].labelX+"px"}).attr({"data-top":b.options.labels[b.options.labels[g].readOrder-1].labelY,"data-left":b.options.labels[b.options.labels[g].readOrder-1].labelX}),$(allElement[g+b.options.labels.length][0]).attr("data-readorder",b.options.labels[g].readOrder),$(allElement[g+b.options.labels.length][0]).css({top:b.options.draggables[b.options.labels[g].readOrder-1].draggableY+"px",left:b.options.draggables[b.options.labels[g].readOrder-1].draggableX+"px"}).attr({"data-top":b.options.draggables[b.options.labels[g].readOrder-1].draggableY,"data-left":b.options.draggables[b.options.labels[g].readOrder-1].draggableX}));if(b.options.droppables&&b.options.droppables.length>0&&void 0!==b.options.droppables[0].readOrder&&(allDroppables=b.options.droppables,allDroppables.sort(function(a,b){return a.readOrder-b.readOrder})),$(b.options.droppables).each(function(a){if(i=e.clone(),i.attr("id","t"+a).attr("data-dropid",this.dropId).addClass("drop-item").append('<div class="drop-bk"><div class="shade"></div></div>'),q++,i.addClass("dndtheme"+q),q>=6&&(q=0),b.gridDnd){for(l=b.options.tileWidth*parseFloat(this.acceptNum),m=b.options.tileHeight*parseFloat(this.rows),n=parseFloat(this.acceptNum)*parseFloat(this.rows),i.css({width:l+"px",height:m+"px",top:this.droppableY+"px",left:this.droppableX+"px"}),o=1;o<=n;o++){var d="";void 0!==this.title&&(d=this.title),d=d+" "+b.options.cellLabel+" "+o+" "+b.options.ofLabel+" "+n,i.append('<div class="droplets" id="droplet'+o+'"><label class="hidden-label">'+d+"</label></div>")}i.find(".droplets").css({width:b.options.tileWidth+"px",height:b.options.tileHeight+"px"})}else i.css({width:this.droppableWidth+"px",height:this.droppableHeight+"px",top:this.droppableY+"px",left:this.droppableX+"px"}),i.append('<div class="droplets" id="droplet1"></div>'),void 0!==this.title&&i.find(".droplets").append('<label class="hidden-label">'+this.title+"</label>"),i.find(".droplets").css({width:this.droppableWidth+"px",height:this.droppableHeight+"px"});i.attr("data-readorder",b.options.droppables[a].readOrder),b.options.droppables&&b.options.droppables.length>0&&void 0!==b.options.droppables[0].readOrder?allElement.push(i):c.find(".freeform-spacer").append(i)}),allDroppables=b.options.droppables,$(b.options.feedBack).each(function(a){b.feedBackObj["dragid"+this.dragId+"dropid"+this.dropId]=this.feedBackContent}),b.setUpDraggableTally(b.options.tileTally,"data-dragid"),b.setUpDraggableTally(b.options.dragZoneTally,"data-zone-dragid"),w=!0,draggableTextImageLength>0&&void 0!==b.options.draggableTextImage[0].readOrder){for(allLabels=b.options.labels.concat(allDraggables),allReadOrder=allLabels.concat(allDroppables),allReadOrder.sort(function(a,b){return a.readOrder-b.readOrder}),g=0;g<allElement.length;g++)for(j=0;j<allReadOrder.length;j++)allReadOrder[g].readOrder===parseInt($(allElement[j][0]).attr("data-readorder"))&&c.find(".freeform-spacer").append(allElement[j]);w=!1}else if(b.options.draggables&&b.options.draggables.length>0&&void 0!==b.options.draggables[0].readOrder&&w)for(allLabels=b.options.labels.concat(allDraggables),allReadOrder=allLabels.concat(allDroppables),allReadOrder.sort(function(a,b){return a.readOrder-b.readOrder}),g=0;g<allElement.length;g++)for(j=0;j<allReadOrder.length;j++)allReadOrder[g].readOrder===parseInt($(allElement[j][0]).attr("data-readorder"))&&c.find(".freeform-spacer").append(allElement[j]);if(b.freeformStackTiles(),$(b.options.zoneTally).each(function(a){s=c.find('.drop-item[data-dropid="'+this.dropId+'"]'),s.length>0&&(p=$('<span class="tally"><span class="tally-wrap"><span data-text="" class="mains">'+(void 0!==this.defaultVal?this.defaultVal:0)+"</span></span></span>"),p.attr("data-default-val",void 0!==this.defaultVal?this.defaultVal:0),p.find(".mains").attr("data-count",void 0!==this.defaultVal?this.defaultVal:0),void 0!==this.denominator&&this.denominator>0&&p.find(".tally-wrap").append('<span class="denom">'+this.denominator+"</span>"),"right"==this.align?p.find(".tally-wrap").addClass("rightFloat"):"center"==this.align&&p.addClass("centerFloat"),void 0!==this.decimals&&p.attr("data-decimals",this.decimals),void 0!==this.textString&&""!==this.textString?(p.find(".mains").attr("data-text",this.textString),p.find("*").hasClass("denom")&&(t=p.find(".denom").html(),p.find(".denom").html(t+" "+this.textString)),t=p.find(".mains").html(),t=PearsonGL.utils.formatNumber(t,this.decimals),p.find(".mains").html(t+" "+this.textString),p.find(".mains").attr("aria-hidden","true"),p.attr("aria-label","tally "+t+" "+this.textString)):(t=p.find(".mains").html(),t=PearsonGL.utils.formatNumber(t,this.decimals),p.find(".mains").html(t),p.find(".mains").attr("aria-hidden","true"),p.attr("aria-label","tally "+t)),void 0!==this.width&&p.css("width",this.width+"px"),p.attr({"data-dropid":this.dropId,"data-report-total":this.report}),c.find(".freeform-spacer").append(p),void 0===this.tallyY?p.css({top:parseFloat(s.css("top"))+s.height()+5+"px"}):p.css({top:this.tallyY+"px"}),void 0===this.tallyX?p.css({left:parseFloat(s.css("left"))+s.width()/2-p.width()/2+"px"}):p.css({left:this.tallyX+"px"}),void 0!==s.attr("class")&&(r=s.attr("class"),r=r.replace("drop-item ",""),p.addClass(r)))}),b.options.totalTally instanceof Array&&$(b.options.totalTally).each(function(a){b.hasTotal=!0,p=$('<span class="tally-total"><span class="tally-wrap"><span class="mains" data-text="">'+(void 0!==this.defaultVal?this.defaultVal:0)+"</span></span></span>"),p.attr("data-default-val",void 0!==this.defaultVal?this.defaultVal:0),c.find(".freeform-spacer").append(p),void 0!==this.denominator&&this.denominator>0&&c.find(".tally-total").find(".tally-wrap").append('<span class="denom">'+this.denominator+"</span>"),void 0!==this.decimals&&p.attr("data-decimals",this.decimals),"right"==this.align?c.find(".tally-total").find(".tally-wrap").addClass("rightFloat"):"center"==this.align&&c.find(".tally-total").addClass("centerTotal"),void 0!==this.textString&&""!==this.textString?(c.find(".tally-total").find(".mains").attr("data-text",this.textString),c.find(".tally-total").find("*").hasClass("denom")&&(t=c.find(".tally-total").find(".denom").html(),c.find(".tally-total").find(".denom").html(t+" "+this.textString)),t=c.find(".tally-total").find(".mains").html(),t=PearsonGL.utils.formatNumber(t,this.decimals),c.find(".tally-total").find(".mains").html(t+" "+this.textString),c.find(".tally-total").find(".mains").attr("aria-hidden","true"),c.find(".tally-total").attr("aria-label","tally "+t+" "+this.textString)):(t=c.find(".tally-total").find(".mains").html(),t=PearsonGL.utils.formatNumber(t,this.decimals),c.find(".tally-total").find(".mains").html(t),c.find(".tally-total").find(".mains").attr("aria-hidden","true"),c.find(".tally-total").attr("aria-label","tally "+t)),void 0!==this.width&&c.find(".tally-total").css("width",this.width+"px"),b.totalDefault=parseFloat(c.find(".tally-total").find(".mains").html()),c.find(".tally-total").css({top:this.totalY+"px",left:this.totalX+"px"}),counter=0,c.find(".tally").each(function(){"true"===$(this).attr("data-report-total")&&(counter+=parseFloat($(this).find(".mains").html()))}),c.find(".tally-total").find("*").hasClass("denom"),c.find(".tally-total").find(".mains").html(b.totalDefault+counter+" "+c.find(".tally-total").find(".mains").attr("data-text"))}),b.options.havePopUp){var J=PearsonGL.utils.randomString(8)+PearsonGL.utils.randomString(8);b.popup=$('<div tabindex="0" aria-labelledby="'+J+'" role="alertdialog" class="pop-up feedback-pop-up popup-window"><div class="popup-header"></div><div class="close close-icon close-button" data-icon="close" alt="'+b.options.closeToolTip+'" title="'+b.options.closeToolTip+'"></div><label id="'+J+'" class="hidden-label"></label><div class="container"></div><div class="close close-text"></div></div>'),c.append(b.popup),b.popupMain=b.popup.find(".container"),b.popup.attr({origWidth:b.originalWidth,origHeight:b.originalHeight}),b.popup.draggable({containment:b.options.popupcontainment,handle:b.popup.find(".popup-header"),scroll:!0,drag:function(a,b){$(this).addClass("has-dragged")}}).bind("keydown",function(a){a.stopImmediatePropagation(),a.stopPropagation(),9==a.keyCode&&a.shiftKey&&(a.preventDefault(),b.popup.find(".close").focus())}),b.popup.mouseToTouch();var K=b.popup.find(".close");K.each(function(a){var c=!0,d="";$(K[a]).hasClass("close-icon")&&(c=!1),$(K[a]).hasClass("close-icon")||(d=b.options.closeToolTip),$(K[a]).sliderbutton({buttonClassName:"close",slider:c,buttonText:d,clickFunction:function(a){b.stateObj.state="CLOSE",b.handleFocusTrap(b.stateObj),b.popup.find("*").hasClass("audioToggleIdentifier")&&b.popup.find(".audioToggleIdentifier").audioComponent("stop"),b.popup.hide(),b.popup.fadeOut(),b.hideAreaIndicators(),$(b.focusElem).parent().focus()}})}),K.sliderbutton("keyPressEventHandler",function(a,c){a.stopImmediatePropagation(),a.stopPropagation(),9!=a.keyCode||a.shiftKey||(a.preventDefault(),b.popup.focus())}),void 0!==this.options.popupAudio&&""!==this.options.popupAudio&&(this.jObject.append("<div class='ffdnd-audio hidden'></div>"),this.jObject.find(".ffdnd-audio").audioComponent({src:this.options.popupAudio,trigger:!0,type:"hover"},this.gadgetUniqueId))}else b.result=$('<div class="result"></div>'),c.append(b.result),b.result.hide();b.options.resetObj&&(u=$('<div class="ffdnd-footer"></div>'),c.append(u),u.append('<div class="start-over"></div>'),this.randomizeOnReset=b.options.resetObj[0].randomize,c.find(".start-over").sliderbutton({buttonClassName:"start-over",slider:!0,buttonText:b.options.resetObj[0].buttonText||"Start Over",clickFunction:function(a){if(!1===a.jObject.hasClass("base-button-disable")){var d=void 0;if(b.hideAreaIndicators(),c.find(".solution-pop-up").fadeOut(),c.find(".feedback-pop-up").fadeOut(),c.find(".result").hide(),b.result&&b.result.find(".audioToggleIdentifier").audioComponent("pause"),b.options.resetObj[0].resetConfirmText=b.options.resetObj[0].resetConfirmText||"Are you sure you want to start over?",b.options.resetObj[0].resetConfirmText){var e={isModal:!0,resultsText:b.options.resetObj[0].resetConfirmText,dialogType:"confirm",closeToolTip:b.options.closeToolTip,noToolTip:b.options.noToolTip,yesToolTip:b.options.yesToolTip,keyPressEventHandler:function(){b.resetDnd(),c.find(".drag-item").each(function(a){$(this).has("map").length&&($(this).data("rotation-angle",0),b.setRotationAngle(this,0))}),b.sendAnalytics("clicked_start_over_button"),b.customStartOverEventHandler&&b.customStartOverEventHandler(c),setTimeout(function(){b.setDragStatusLive("start over button clicked, tiles move back to starting postion")},100),c.find(".checker-pop-up,.modal-dialog-window").fadeOut(function(){$(this).remove()})},audioComponent:b.options.resetObj[0].resetConfirmTextAudio?b.options.resetObj[0].resetConfirmTextAudio:void 0};c.dialogcomponent(e),d=c.find(".checker-pop-up"),d.css("z-index",d.css("z-index")+b.zdex+3).fadeIn().focus()}else b.resetDnd(),c.find(".drag-item").each(function(a){$(this).has("map").length&&($(this).data("rotation-angle",0),b.setRotationAngle(this,0))}),b.customStartOverEventHandler&&b.customStartOverEventHandler(c),b.setDragStatusLive("start over button clicked, tiles move back to starting postion")}}})),b.options.showSolutionObj instanceof Array&&$(b.options.showSolutionObj).each(function(a){b.hasShowSolution=!0;var d=PearsonGL.utils.randomString(8)+PearsonGL.utils.randomString(8),e='<div tabindex="0" aria-labelledby="'+d+'" role="alertdialog" class="solution-pop-up pop-up popup-window"><div class="popup-header"></div>\n\t\t\t\t<label id="'+d+'" class="hidden-label"></label><div class="container"></div>\n\t\t\t\t<div class="close close-icon" data-icon="icon-dialog-close-button" alt="'+b.options.closeToolTip+'" title="'+b.options.closeToolTip+'"></div>\n\t\t\t\t<div class="close close-text"></div></div>';b.solution=$(e),c.append(b.solution),b.solutionMain=b.solution.find(".container"),"textTop"===this.dialogLayout||void 0===this.dialogLayout?(void 0!==this.solutionText&&void 0!==this.solutionText.value&&this.solutionText.value.length>0&&(b.solutionMain.append('<div class="main-text-col"></div>'),b.solutionMain.find(".main-text-col").richtextcomponent($.extend(this.options,{value:this.solutionText.value})),void 0!==this.solutionText.audioComponent&&void 0!==this.solutionText.audioComponent.src&&""!==this.solutionText.audioComponent.src&&b.solutionMain.find(".main-text-col").find(".gadget-textblock").audioComponent(this.solutionText.audioComponent,this.gadgetUniqueId)),void 0!==this.solutionImage&&void 0!==this.solutionImage.src&&this.solutionImage.src.length>0&&(b.solutionMain.append('<div class="main-img-col"></div>'),b.solutionMain.find(".main-img-col").imagecomponent({src:this.solutionImage.src,title:void 0!==this.solutionImage.title?this.solutionImage.title:"",noTabIndex:!0,protect:!1}),void 0!==this.solutionImage.audioComponent&&void 0!==this.solutionImage.audioComponent.src&&""!==this.solutionImage.audioComponent.src&&b.solutionMain.find(".main-img-col").find(".image-class-wrapper").audioComponent(this.solutionImage.audioComponent,this.gadgetUniqueId),void 0!==this.dialogWidth&&c.find(".solution-pop-up").css({width:this.dialogWidth+"px"}),void 0!==this.dialogHeight&&c.find(".solution-pop-up").css({height:this.dialogHeight+"px"}))):(void 0!==this.solutionImage&&void 0!==this.solutionImage.src&&this.solutionImage.src.length>0&&(b.solutionMain.append('<div class="main-img-col"></div>'),b.solutionMain.find(".main-img-col").imagecomponent({src:this.solutionImage.src,title:void 0!==this.solutionImage.title?this.solutionImage.title:"",noTabIndex:!0,protect:!1}),void 0!==this.solutionImage.audioComponent&&void 0!==this.solutionImage.audioComponent.src&&""!==this.solutionImage.audioComponent.src&&b.solutionMain.find(".main-img-col").find(".image-class-wrapper").audioComponent(this.solutionImage.audioComponent,this.gadgetUniqueId),void 0!==this.dialogWidth&&c.find(".solution-pop-up").css({width:this.dialogWidth+"px"}),void 0!==this.dialogHeight&&c.find(".solution-pop-up").css({height:this.dialogHeight+"px"})),void 0!==this.solutionText&&void 0!==this.solutionText.value&&this.solutionText.value.length>0&&(b.solutionMain.append('<div class="main-text-col"></div>'),b.solutionMain.find(".main-text-col").richtextcomponent($.extend(this.options,{value:this.solutionText.value})),void 0!==this.solutionText.audioComponent&&void 0!==this.solutionText.audioComponent.src&&""!==this.solutionText.audioComponent.src&&b.solutionMain.find(".main-text-col").find(".gadget-textblock").audioComponent(this.solutionText.audioComponent,this.gadgetUniqueId))),void 0===u&&(u=$('<div class="ffdnd-footer"></div>'),c.append(u)),void 0!==this.numberOfAttempts?(b.numberOfAttemps=this.numberOfAttempts,u.append('<div class="show-correct-answer base-button-disable"></div>')):(b.numberOfAttemps=0,u.append('<div class="show-correct-answer"></div>')),b.solution.draggable({containment:b.options.popupcontainment,handle:b.solution.find(".popup-header"),scroll:!0,drag:function(a,b){$(this).addClass("has-dragged")}}).bind("keydown",function(a){a.stopImmediatePropagation(),a.stopPropagation(),9==a.keyCode&&a.shiftKey&&(a.preventDefault(),b.solution.find(".close").focus())}),b.solution.mouseToTouch();var f=b.solution.find(".close");f.each(function(a){var d=!0,e="";$(f[a]).hasClass("close-icon")&&(d=!1),$(f[a]).hasClass("close-icon")||(e=b.options.closeToolTip),$(f[a]).sliderbutton({buttonClassName:"close",slider:d,buttonText:e,clickFunction:function(a){b.stateObj.state="CLOSE",b.handleFocusTrap(b.stateObj),b.solution.find("*").hasClass("audioToggleIdentifier")&&b.solution.find(".audioToggleIdentifier").audioComponent("stop"),b.solution.hide(),b.hideAreaIndicators(),c.find(".show-correct-answer").find(".base-button-inside-wrap:visible").focus()}})}),f.sliderbutton("keyPressEventHandler",function(a,c){a.stopImmediatePropagation(),a.stopPropagation(),9!=a.keyCode||a.shiftKey||(a.preventDefault(),b.solution.focus())}),this.clickFunction=function(a){c.find(".show-correct-answer").hasClass("base-button-disable")||(b.setDragStatusLive("show solution button clicked"),b.sendAnalytics("clicked_show_solution_button"),"undefined"!==a.options.numberOfAttemps&&-1!==a.jObject[0].className.indexOf("base-button-disable")&&(a.options.enable=!1),a.options.enable&&(b.hideAreaIndicators(),c.find(".checker").fadeOut(),c.find(".feedback-pop-up").fadeOut(),c.find(".result").hide(),b.solution.css("z-index",b.solution.css("z-index")+b.zdex+3).fadeIn().focus()),b.stateObj={returnFocusTo:PearsonGL.utils.getActiveElement(),state:"OPEN"},b.handleFocusTrap(b.stateObj))},this.buttonClassName="show-correct-answer",this.buttonText=b.options.showSolutionObj[0].buttonText||"Show Solution",c.find(".show-correct-answer").sliderbutton(this)}),$(window).bind("scroll.ffdnd",function(a){var d=void 0,e=c.offset().top,f=c.offset().left;c.is(":visible")&&c.children(".drag-item").each(function(){$(this).attr("data-top-offset",$(this).offset().top-e),$(this).attr("data-left-offset",$(this).offset().left-f),d=b.clone[parseFloat($(this).attr("data-clone"))],$(d).attr("data-top-offset",$(this).offset().top-e),$(d).attr("data-left-offset",$(this).offset().left-f)})}),b.setupRotationEventHandler(),b.dragSetup(),b.addAccessibility(c),b.dragStatusLive=$('<div aria-live="assertive" class="drag-status-live hidden-label"></div>'),c.find(".freeform-spacer").append(b.dragStatusLive),b.isLoaded=!0}},{key:"setDragStatusLive",value:function(a){this.dragStatusLive.html(a)}},{key:"freeformStackTiles",value:function(){setTimeout(function(){$(".ffdnd-identifier").each(function(a,b){b=$(b);var c=0,d=b.find(".freeform-spacer .drag-item:not(.has-moved)");$(d).each(function(a){$(this).attr("tabindex","0"),$(this).find(".audio-play").attr("tabindex","0"),$(this).find(".audio-pause").attr("tabindex","0")}),d.toArray().every(function(a){c++;var b=$(a).css("top").split("px").slice(0,1)[0],e=$(a).css("left").split("px").slice(0,1)[0],f=$(a).next().css("top").split("px").slice(0,1)[0],g=$(a).next().css("left").split("px").slice(0,1)[0];return f===b&&g===e&&($(a).attr("tabindex","-1"),$(a).find(".audio-play").attr("tabindex","-1"),$(a).find(".audio-pause").attr("tabindex","-1")),c<d.length})})})}},{key:"addTurnOffAudioLink",value:function(){var a=this;this.isDisabledAudio=!1;var b=$('<div class="hidden-label disable-audio">'+this.options.turnoffaudio+"</div>");b.attr({role:"button",tabindex:"0"}).click(function(b){b.preventDefault(),b.stopPropagation(),a.enableDisableAudios()}).keydown(function(b){b.stopImmediatePropagation(),13===b.keyCode&&(b.preventDefault(),b.stopPropagation(),a.enableDisableAudios())}),this.jObject.find(".freeform-spacer").append(b)}},{key:"enableDisableAudios",value:function(){var a=this,b=this.jObject;a.isDisabledAudio?(a.isDisabledAudio=!1,b.find(".drag-item").each(function(){$(this).find("[tabindex]").attr("tabindex","0"),$(this).find("*").hasClass("audioToggleIdentifier")&&$(this).find(".audioToggleIdentifier").audioComponent("enableAudio")}),b.find(".disable-audio").html(this.options.turnoffaudio),a.setDragStatusLive("audio enabled on tiles")):(a.isDisabledAudio=!0,b.find(".drag-item").each(function(){$(this).find("[tabindex]").attr("tabindex","-1"),$(this).find("*").hasClass("audioToggleIdentifier")&&$(this).find(".audioToggleIdentifier").audioComponent("disableAudio")}),b.find(".disable-audio").html(this.options.turnonaudio),a.setDragStatusLive("audio disabled on tiles")),a.focusOnSelf(b.find(".disable-audio"))}},{key:"focusOnSelf",value:function(a){a.blur(),a.delay(100).queue(function(a){$(this).focus(),a()})}},{key:"updateTallys",value:function(a){var b=this,c=void 0,d=b.jObject,e=void 0,f=void 0,g=void 0;d.find(".tally").each(function(f,h){e=0,c=-1,void 0!==$(this).attr("data-zone-dragid")?(c=$(this).data("decimals"),g=$(h).find(".mains").attr("data-text"),d.find('.drop-item[data-dropid="'+$(this).attr("data-dropid")+'"]').each(function(){$(this).find(".droplets").each(function(){$(this).children().each(function(){$(h).attr("data-zone-dragid")===$(this).attr("data-dragid")&&(e=b.AddFloatingPoints(e,parseFloat($(this).attr("data-value"))*parseFloat($(this).attr("data-multi"))),setTimeout(function(){g?b.setDragStatusLive("tally "+e+" "+g):b.setDragStatusLive("tally "+e)},500))})})})):void 0!==$(this).attr("data-dragid")?(c=$(this).data("decimals"),g=$(h).find(".mains").attr("data-text"),d.find('.drag-item[data-dragid="'+$(this).attr("data-dragid")+'"]').each(function(){"true"===$(this).attr("data-tally")&&(e=b.AddFloatingPoints(e,parseFloat($(this).attr("data-value"))*parseFloat($(this).attr("data-multi"))),setTimeout(function(){g?b.setDragStatusLive("tally "+e+" "+g):b.setDragStatusLive("tally "+e)},500))})):void 0!==$(this).attr("data-dropid")&&(c=$(this).data("decimals"),g=$(h).find(".mains").attr("data-text"),d.find('.drop-item[data-dropid="'+$(this).attr("data-dropid")+'"]').each(function(){$(this).find(".droplets").each(function(){$(this).children().length>0&&$(this).children().each(function(){$(this).hasClass("hidden-label")||(e=b.AddFloatingPoints(e,parseFloat($(this).attr("data-value"))*parseFloat($(this).attr("data-multi"))))})})})),e=b.AddFloatingPoints(e,parseFloat($(this).attr("data-default-val"))),void 0!==c&&(e=PearsonGL.utils.formatNumber(e,c)),$(this).find("*").hasClass("denom"),$(this).find(".mains").html(e+" "+$(this).find(".mains").attr("data-text")),a===$(h).attr("data-dropid")&&(g?b.setDragStatusLive("tally "+e+" "+g):b.setDragStatusLive("tally "+e))}),b.selectDrag(null,!0);var h=0;d.find(".show-correct-answer").sliderbutton("disable"),d.find(".droplets").each(function(){h+=$(this).find(".drag-item").length}),h>=b.numberOfAttemps&&d.find(".show-correct-answer").sliderbutton("enable"),b.hasTotal&&b.updateTotal(),b.scormData={tiles:[]},d.find(".drag-item").each(function(){f=d.find(".drag-item").attr("data-dragid"),cloneState=$(this).attr("data-clone-state"),cloneState,objs={uniqueId:$(this).attr("unique-id"),x:parseFloat($(this).css("left")),y:parseFloat($(this).css("top")),dropped:$(this).hasClass("has-moved")},$(this).parents().hasClass("droplets")&&(objs.dropNodeId=$(this).parents(".drop-item").attr("id"),objs.dropletIndex=$(this).parents(".droplets").attr("id")),b.scormData.tiles.push(objs)}),b.saveLearnerData(),b.lastSelected=null}},{key:"updateTotal",value:function(){var a=this,b=-1,c=void 0,d=a.jObject,e=0;d.find(".tally").each(function(){"true"===$(this).attr("data-report-total")&&(e=a.AddFloatingPoints(e,parseFloat($(this).find(".mains").html())))}),b=d.find(".tally-total").data("decimals"),c=a.AddFloatingPoints(a.totalDefault,e),void 0!==b&&(c=PearsonGL.utils.formatNumber(c,b)),d.find(".tally-total").find("*").hasClass("denom"),d.find(".tally-total").find(".mains").html(c+" "+d.find(".tally-total").find(".mains").attr("data-text")),a.saveLearnerData()}},{key:"AddFloatingPoints",value:function(){for(var a=0,b=void 0,c=0,d=0,e=0;e<arguments.length;e++)(b=(arguments[e].toString().match(/\.\d+/)||[""])[0].length)>a&&(a=b);for(0!=a&&(d=a-1),a=Math.pow(10,a-1),i=0;i<arguments.length;i++)c+=+arguments[i]*a;return(c/a).toFixed(d)}},{key:"showFeedback",value:function(a,b){var c=this,d=c.jObject;if(void 0!==this.feedBackObj["dragid"+a.attr("data-dragid")+"dropid"+b.attr("data-dropid")]){var e=!1,f=this.feedBackObj["dragid"+a.attr("data-dragid")+"dropid"+b.attr("data-dropid")];c.options.havePopUp?(d.find(".solution-pop-up").fadeOut(),d.find(".checker").fadeOut(),d.find(".result").hide(),c.popupMain.empty(),c.popup.removeAttr("style"),c.popup.css({top:f.feedY+"px",left:f.feedX+"px",width:f.dialogWidth+"px",height:f.dialogHeight+"px"}),"textTop"===f.dialogLayout||void 0===f.dialogLayout?(void 0!==f.mainBody&&f.mainBody.length>0&&(e=!0,c.popupMain.append('<div class="main-text-col"></div>'),c.popupMain.find(".main-text-col").richtextcomponent({value:f.mainBody}),void 0!==f.mainBodyAudio&&void 0!==f.mainBodyAudio.src&&""!==f.mainBodyAudio.src&&(c.options.autoPlayFeedback&&(f.mainBodyAudio.trigger=!0),c.popupMain.find(".main-text-col").find(".gadget-textblock").audioComponent(f.mainBodyAudio,this.gadgetUniqueId))),void 0!==f.mainImage&&f.mainImage.length>0&&(e=!0,c.popupMain.append('<div class="main-img-col"></div>'),c.popupMain.find(".main-img-col").imagecomponent({src:f.mainImage,title:void 0!==f.mainImageTitle?f.mainImageTitle:"",noTabIndex:!0,protect:!1}),void 0!==f.mainImageAudio&&void 0!==f.mainImageAudio.src&&""!==f.mainImageAudio.src&&(c.options.autoPlayFeedback&&(f.mainImageAudio.trigger=!0),c.popupMain.find(".main-img-col").find(".image-class-wrapper").audioComponent(f.mainImageAudio,this.gadgetUniqueId)))):(void 0!==f.mainImage&&f.mainImage.length>0&&(e=!0,c.popupMain.append('<div class="main-img-col"></div>'),c.popupMain.find(".main-img-col").imagecomponent({src:f.mainImage,title:void 0!==f.mainImageTitle?f.mainImageTitle:"",noTabIndex:!0,protect:!1}),void 0!==f.mainImageAudio&&void 0!==f.mainImageAudio.src&&""!==f.mainImageAudio.src&&(c.options.autoPlayFeedback&&(f.mainImageAudio.trigger=!0),c.popupMain.find(".main-img-col").find(".image-class-wrapper").audioComponent(f.mainImageAudio,this.gadgetUniqueId))),void 0!==f.mainBody&&f.mainBody.length>0&&(e=!0,c.popupMain.append('<div class="main-text-col"></div>'),c.popupMain.find(".main-text-col").richtextcomponent({value:f.mainBody}),void 0!==f.mainBodyAudio&&void 0!==f.mainBodyAudio.src&&""!==f.mainBodyAudio.src&&(c.options.autoPlayFeedback&&(f.mainBodyAudio.trigger=!0),c.popupMain.find(".main-text-col").find(".gadget-textblock").audioComponent(f.mainBodyAudio,this.gadgetUniqueId)))),e&&(c.popup.show(),c.popup.focus(),c.stateObj={returnFocusTo:PearsonGL.utils.getActiveElement(),state:"OPEN"},c.handleFocusTrap(c.stateObj),clearTimeout(c.popuptimeout),c.options.fadeOutFeedback&&(c.popuptimeout=setTimeout(function(){c.popup.fadeOut()},3e3)),void 0!==c.options.popupAudio&&""!==c.options.popupAudio&&d.find(".ffdnd-audio").audioComponent("play"),c.options.autoPlayFeedback&&c.popup.find("*").hasClass("audioToggleIdentifier")&&c.popup.find(".audioToggleIdentifier").audioComponent("play")),PearsonGL.utils.initMathJax(c.popup[0])):(c.result.empty(),c.options.autoPlayFeedback&&c.result.append("<div class='autoplay-audio hidden'></div>"),void 0!==f.mainBody&&f.mainBody.length>0&&(e=!0,c.result.append('<div class="main-text-col"></div>'),c.result.find(".main-text-col").richtextcomponent($.extend(this.options,{value:f.mainBody})),void 0!==f.mainBodyAudio&&void 0!==f.mainBodyAudio.src&&""!==f.mainBodyAudio.src&&(c.options.autoPlayFeedback?(f.mainBodyAudio.trigger=!0,f.mainBodyAudio.type="hover",c.result.find(".autoplay-audio").audioComponent(f.mainBodyAudio,this.gadgetUniqueId)):c.result.find(".main-text-col").find(".gadget-textblock").audioComponent(f.mainBodyAudio,this.gadgetUniqueId))),void 0!==f.mainImage&&f.mainImage.length>0&&(e=!0,c.result.append('<div class="main-img-col"></div>'),c.result.find(".main-img-col").imagecomponent({src:f.mainImage}),void 0!==f.mainImageAudio&&void 0!==f.mainImageAudio.src&&""!==f.mainImageAudio.src&&(c.options.autoPlayFeedback?(f.mainImageAudio.trigger=!0,f.mainImageAudio.type="hover",c.result.find(".autoplay-audio").audioComponent(f.mainImageAudio,this.gadgetUniqueId)):c.result.find(".main-img-col").find(".image-class-wrapper").audioComponent(f.mainImageAudio,this.gadgetUniqueId))),c.options.autoPlayFeedback&&c.result.find("*").hasClass("audioToggleIdentifier")&&c.result.find(".audioToggleIdentifier").audioComponent("play"),c.result.show(),PearsonGL.utils.initMathJax(c.result[0]))}else c.options.havePopUp?c.popup.fadeOut():c.result.empty()}},{key:"handleFocusTrap",value:function(a){var b=this;"OPEN"===a.state&&(b.checked||(b.doFocusTrap=new PearsonGL.utils.doFocusTrap(a.returnFocusTo),b.focusTrap=b.doFocusTrap.focusTrap(a.returnFocusTo,{escapeDeactivates:!0}),b.checked=!0,b.focusTrap.activate())),"CLOSE"===a.state&&(b.checked=!1,b.focusTrap.deactivate())}},{key:"randomizeTiles",value:function(){var b=this,d=this.jObject,e=void 0,f=[],g=[],h=0,i=void 0,j=void 0;for(d.find(".drag-item").each(function(){f.push({top:$(this).attr("data-top"),left:$(this).attr("data-left")})});f.length>0;)e=f[a=Math.floor(Math.random()*f.length)],f.splice(a,1),g.push(e);d.find(".drag-item").each(function(){i=$(this).attr("data-clone"),j=$(this).attr("data-clone-state"),c=b.clone[parseFloat(i)],e=g[h++];var a=parseFloat($(this).offset().top)-parseFloat($(this).attr("data-top")),d=parseFloat($(this).offset().left)-parseFloat($(this).attr("data-top"));$(c).animate({top:e.top,left:e.left},500,function(){b.tileData[i]&&(b.tileData[i]["rotation-origin-x"]=e.left+d+b.tileData[i]["rotation-origin-offset-x"],b.tileData[i]["rotation-origin-y"]=e.top+a+b.tileData[i]["rotation-origin-offset-y"])}).attr({"data-top":e.top,"data-left":e.left,"data-clone-state":!1,"data-top-offset":1*e.top+a,"data-left-offset":1*e.left+d}),"true"===j&&$(c).attr({"data-clone-state":!0}),b.tileData[i]&&($(c).data("rotation-origin-x",1*e.left+d+1*b.tileData[i]["rotation-origin-offset-x"]),$(c).data("rotation-origin-y",1*e.top+a+1*b.tileData[i]["rotation-origin-offset-y"]),$(c).data("rotation-angle",b.tileData[i]["rotation-angle"]),b.setRotationAngle(c,b.tileData[i]["rotation-angle"])),$(this).after(c),b.makeDrag(c),$(this).remove()})}},{key:"resetDnd",value:function(a){var b=this,c=this.jObject;!a&&b.randomizeOnReset,c.offset().top,c.offset().left;c.find(".pop-up").hide(),this.jObject&&(this.jObject.children().remove(),this.jObject.append("<div class='freeform-spacer'></div>")),b.initZIndex(),b.setUpDnD(b.randomizeOnReset),b.scormData={tiles:[]},b.checker&&b.checker.fadeOut()}},{key:"dragSetup",value:function(){var a=this,b=a.jObject,c=void 0,d=0,e=0,f=void 0,g=void 0,h=void 0,i=b.offset().top,j=b.offset().left;b.find(".drag-item").each(function(){f=$(this).offset(),$(this).attr("data-clone",d),$(this).attr("data-top-offset",f.top-i),$(this).attr("data-left-offset",f.left-j),d++,a.options.draggables&&a.options.draggables.length>0&&a.options.draggables[$(this).attr("data-inArray")].hotspots&&(g=parseFloat(a.options.draggables[$(this).attr("data-inArray")].rotationX,10),h=parseFloat(a.options.draggables[$(this).attr("data-inArray")].rotationY,10),$(this).css("transform-origin",g+"px "+h+"px"),c=!0,(g<0||g>$(this).width()||h<0||h>$(this).height())&&(c=!1),e=parseFloat(a.options.draggables[$(this).attr("data-inArray")].angle,10),e=isNaN(e)?0:e,a.setRotationAngle(this,e),$(this).data("rotation-origin-x",f.left+g),$(this).data("rotation-origin-y",f.top+h),$(this).data("rotation-origin-offset-x",g),$(this).data("rotation-origin-offset-y",h),$(this).data("rotation-angle",e),a.tileData[$(this).attr("data-clone")]={"rotation-origin-x":f.left+g,"rotation-origin-y":f.top+h,"rotation-origin-is-inside-tile":c,"rotation-origin-offset-x":g,"rotation-origin-offset-y":h,"rotation-angle":e}),a.makeDrag($(this))}),a.dropSetup()}},{key:"cloneDragTile",value:function(a){var b=this,c=a.attr("data-clone-state"),d=a.attr("data-clone"),e=a.attr("data-dragid"),f=$('<div class="drag-item"><div class="drag-bk"><div class="shade"></div></div></div>'),g=b.tileData[d];return void 0!==e&&("true"===c?f.attr({id:a.attr("id"),"data-clone-state":"true","data-clone":a.attr("data-clone"),"unique-id":a.attr("unique-id"),"data-inArray":a.attr("data-inArray"),"data-dragid":a.attr("data-dragid"),"data-top":a.attr("data-top"),"data-left":a.attr("data-left"),"data-top-offset":a.attr("data-top-offset"),"data-left-offset":a.attr("data-left-offset"),"data-value":a.attr("data-value"),"data-multi":a.attr("data-multi"),"data-tally":"false"}).css({width:a.width()+"px",height:a.height()+"px",top:a.attr("data-top")+"px",left:a.attr("data-left")+"px"}):f.attr({id:a.attr("id"),"data-clone-state":"false","data-clone":a.attr("data-clone"),"unique-id":a.attr("unique-id"),"data-inArray":a.attr("data-inArray"),"data-dragid":a.attr("data-dragid"),"data-top":a.attr("data-top"),"data-left":a.attr("data-left"),"data-top-offset":a.attr("data-top-offset"),"data-left-offset":a.attr("data-left-offset"),"data-value":a.attr("data-value"),"data-multi":a.attr("data-multi"),"data-tally":"false"}).css({width:a.width()+"px",height:a.height()+"px",top:a.attr("data-top")+"px",left:a.attr("data-left")+"px"})),this.hasZIndexOrder?f.css("z-index",a.css("z-index")):f.css("z-index",this.zdex),g&&(b.setRotationAngle(f,g["rotation-angle"]),f.css("transform-origin",g["rotation-origin-offset-x"]+"px "+g["rotation-origin-offset-y"]+"px"),f.data("rotation-origin-x",g["rotation-origin-x"]),f.data("rotation-origin-y",g["rotation-origin-y"]),f.data("rotation-origin-offset-x",g["rotation-origin-offset-x"]),f.data("rotation-origin-offset-y",g["rotation-origin-offset-y"]),f.data("rotation-angle",g["rotation-angle"])),b.customClone&&b.customClone(f,a),f}},{key:"activateDragHandle",value:function(a,b){this.dragHandle.css({left:a.pageX-this.jObject.offset().left-this.dragHandle.width()/2+"px",top:a.pageY-this.jObject.offset().top-this.dragHandle.height()/2+"px","z-index":this.zdex+4}),this.dragHandle.show(),this.dragHandle.trigger(a),this.dragTile=b}},{key:"makeDrag",value:function(b){var c=this,d=c.jObject,e=!0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0;if($(b).hasClass("drag-item")&&(c.clone[parseFloat(b.attr("data-clone"))]=c.cloneDragTile($(b))),$(b).hasClass("text-image-tile"))"textTop"===c.options.draggableTextImage[$(b).attr("data-inArray")].textImage?($(b).addClass("text-tile"),$(b).append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.noTabIndex=!0,$(b).find(".drag-text-cell").richtextcomponent(c.options.draggableTextImage[$(b).attr("data-inArray")].dragText),void 0!==c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.audioComponent&&void 0!==c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.audioComponent.src&&""!==c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.audioComponent.src&&(c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.audioComponent.stopDefault=!1,$(b).find(".gadget-textblock").audioComponent(c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.audioComponent,this.gadgetUniqueId)),$(b).attr({"data-default-title":c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.value.replace(/<(?:.|\n)*?>/gm,"")}),c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.protect=!1,$(b).addClass("image-tile"),$(b).append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.noTabIndex=!0,k=c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.src.includes(".svg"),$(b).find(".image-cell").imagecomponent(c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage),k&&$(b).find(".image-cell").find(".image-class-wrapper").addClass("svg-image"),void 0!==c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.audioComponent&&""!==c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.audioComponent.src&&(c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.audioComponent.stopDefault=!1,$(b).find(".image-class-wrapper").audioComponent(c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.audioComponent,this.gadgetUniqueId)),$(b).attr({"data-default-title":c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.title?c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.title:""})):(c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.protect=!1,$(b).addClass("image-tile"),$(b).append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.noTabIndex=!0,k=c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.src.includes(".svg"),$(b).find(".image-cell").imagecomponent(c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage),k&&$(b).find(".image-cell").find(".image-class-wrapper").addClass("svg-image"),void 0!==c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.audioComponent&&""!==c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.audioComponent.src&&(c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.audioComponent.stopDefault=!1,$(b).find(".image-class-wrapper").audioComponent(c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.audioComponent,this.gadgetUniqueId)),$(b).attr({"data-default-title":c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.title?c.options.draggableTextImage[$(b).attr("data-inArray")].dragImage.title:""}),$(b).addClass("text-tile"),$(b).append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.noTabIndex=!0,$(b).find(".drag-text-cell").richtextcomponent(c.options.draggableTextImage[$(b).attr("data-inArray")].dragText),void 0!==c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.audioComponent&&void 0!==c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.audioComponent.src&&""!==c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.audioComponent.src&&(c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.audioComponent.stopDefault=!1,$(b).find(".gadget-textblock").audioComponent(c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.audioComponent,this.gadgetUniqueId)),$(b).attr({"data-default-title":c.options.draggableTextImage[$(b).attr("data-inArray")].dragText.value.replace(/<(?:.|\n)*?>/gm,"")}));else if(void 0!==c.options.draggables[$(b).attr("data-inArray")].dragText&&""!==c.options.draggables[$(b).attr("data-inArray")].dragText.value&&void 0!==c.options.draggables[$(b).attr("data-inArray")].dragText.value&&($(b).addClass("text-tile"),$(b).append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),c.options.draggables[$(b).attr("data-inArray")].dragText.noTabIndex=!0,$(b).find(".drag-text-cell").richtextcomponent(c.options.draggables[$(b).attr("data-inArray")].dragText),void 0!==c.options.draggables[$(b).attr("data-inArray")].dragText.audioComponent&&void 0!==c.options.draggables[$(b).attr("data-inArray")].dragText.audioComponent.src&&""!==c.options.draggables[$(b).attr("data-inArray")].dragText.audioComponent.src&&(c.options.draggables[$(b).attr("data-inArray")].dragText.audioComponent.stopDefault=!1,$(b).find(".gadget-textblock").audioComponent(c.options.draggables[$(b).attr("data-inArray")].dragText.audioComponent,this.gadgetUniqueId)),$(b).attr({"data-default-title":c.options.draggables[$(b).attr("data-inArray")].dragText.value.replace(/<(?:.|\n)*?>/gm,"")}),$(b).find(".text-audio-component").append('<label class="drag-state hidden-label"></label>')),void 0!==c.options.draggables[$(b).attr("data-inArray")].dragImage&&""!==c.options.draggables[$(b).attr("data-inArray")].dragImage.src&&void 0!==c.options.draggables[$(b).attr("data-inArray")].dragImage.src){if(c.options.draggables[$(b).attr("data-inArray")].dragImage.protect=!1,$(b).addClass("image-tile"),$(b).append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),c.options.draggables[$(b).attr("data-inArray")].dragImage.noTabIndex=!0,k=c.options.draggables[$(b).attr("data-inArray")].dragImage.src.includes(".svg"),$(b).find(".image-cell").imagecomponent(c.options.draggables[$(b).attr("data-inArray")].dragImage),k&&$(b).find(".image-cell").find(".image-class-wrapper").addClass("svg-image"),c.options.draggables[$(b).attr("data-inArray")].hotspots){var l=$(b).find(".image-class");l.on("dragstart",function(){return!1}),e=!1;var m="map"+PearsonGL.utils.randomString(10)+PearsonGL.utils.randomString(10),n=document.createElement("map");$(l).attr("usemap","#"+m);var o=$(b).find(".image-class-wrapper");$(n).attr("name",m).attr("id",m),$(o).append(n),h=0,i=$(o).parent(".image-cell"),j=$(c.options.draggables[$(b).attr("data-inArray")].hotspots).length,$(c.options.draggables[$(b).attr("data-inArray")].hotspots).each(function(b){h++,f=null,f=this.area.split(","),a=$('<area tabindex="-1" aria-hidden="true" class="area" data-type="'+this.areaType+'" coords="'+this.area+'" orig-coords="'+this.area+'" href="javascript:void(0)">'),this.title&&"undefined"!=this.title&&a.attr({title:this.title,alt:this.title}),g=3==f.length?"circle":4==f.length?"rect":"poly",a.attr("shape",g),"rotation"===this.areaType?c.addRotationMousedownEventHandler(a):($(a).mouseToTouch(),$(a).hover(function(){$(this).parents(".drag-item").addClass("move drag-item-over")},function(){$(this).parents(".drag-item").removeClass("move drag-item-over")}),$(a).on("mousedown",function(a){a.preventDefault(),c.activateDragHandle(a,$(this).closest(".drag-item"))})),$(o).find("map").append(a),this.isVisible&&c.setupAreaIndicators(this,i,h===j)})}void 0!==c.options.draggables[$(b).attr("data-inArray")].dragImage.audioComponent&&""!==c.options.draggables[$(b).attr("data-inArray")].dragImage.audioComponent.src&&(c.options.draggables[$(b).attr("data-inArray")].dragImage.audioComponent.stopDefault=!1,$(b).find(".image-class-wrapper").audioComponent(c.options.draggables[$(b).attr("data-inArray")].dragImage.audioComponent,this.gadgetUniqueId)),$(b).attr({"data-default-title":c.options.draggables[$(b).attr("data-inArray")].dragImage.title?c.options.draggables[$(b).attr("data-inArray")].dragImage.title:""})}(e||$(b).hasClass("text-tile"))&&$(b).hover(function(){$(this).addClass("drag-item-over")},function(){$(this).removeClass("drag-item-over")}),c.options.hideTileBackground&&$(b).addClass("no-bk"),e&&(c.setupDraggableHandler(b),$(b).mouseToTouch(),$(b).addClass("move"),c.addDragKeyEventListeners(b)),$(b).attr({tabindex:"0",role:"button","aria-grabbed":"false"}).click(function(a){!0===c.hadRotated&&(c.hadRotated=!1),c.customClickEventHandler&&c.customClickEventHandler(this)}).focus(function(a){c.hasZIndexOrder||(c.zdex++,$(this).css("z-index",c.zdex)),c.isRotating=!1,c.hideAreaIndicators(),!0===$(this).data("click")||c.isTouchDevice||($(this).hasClass("ui-draggable-disabled")||PearsonGL.utils.focusItemOn(this),$(this).find(".touch-device-rotate-area, .touch-device-drag-area").each(function(){$(this).removeClass("hidden")}))}).blur(function(a){$(this).hasClass("ui-draggable-disabled")||($(this).removeClass("drag-item-dragging"),PearsonGL.utils.focusItemOff(this),d.find(".drop-item").removeClass("drop-item-over"),offsetTop=$(this).offset().top,offsetLeft=$(this).offset().left,mydragitem=$(this))}).mouseover(function(){$(this).data("click",!0)}).mouseout(function(){$(this).data("click",!1)}).mouseup(function(a){c.sendAnalytics("clicked_content"),c.isRotating&&(a.preventDefault(),a.stopImmediatePropagation(),c.isRotating=void 0)}),c.isLoaded&&PearsonGL.utils.initMathJax(b[0])}},{key:"cloneTile",value:function(a){var b=this,c=(this.jObject,!1);if(b.options.cloning)if($(a).parent().hasClass("freeform-spacer")&&!$(a).hasClass("has-moved")){if($(a).addClass("has-moved"),"true"===$(a).attr("data-clone-state")){var d=$(a).attr("data-clone");clone=b.clone[d],$(clone).attr("data-clone-state",!0),$(a).hasClass("text-image-tile")&&$(clone).addClass("text-image-tile"),$(a).hasClass("text-button-focus")&&(c=!0),$(a).before(clone),c&&$(a).focus(),b.makeDrag(clone),b.tileData[d]&&($(clone).data("rotation-origin-x",$(a).data("rotation-origin-x")),$(clone).data("rotation-origin-y",$(a).data("rotation-origin-y")),$(clone).data("rotation-angle",$(a).data("rotation-angle")),$(clone).data("rotation-origin-offset-x",$(a).data("rotation-origin-offset-x")),$(clone).data("rotation-origin-offset-y",$(a).data("rotation-origin-offset-y")),clone.css({"transform-origin":b.tileData[d]["rotation-origin-offset-x"]+"px "+b.tileData[d]["rotation-origin-offset-y"]+"px"})),$(a).attr("data-clone-state","true")}}else $(a).parent().hasClass("droplets")}},{key:"updateDropPosition",value:function(a,b,c){var d=this,e=this.jObject,f=void 0,g=void 0,h=void 0,i=void 0,j=d.tileData[$(a).attr("data-clone")];$(a).parent().hasClass("droplets")&&(j&&d.setRotationAngle(a,0),$(a).css({top:$(a).offset().top-e.offset().top+"px",left:$(a).offset().left-e.offset().left+"px"}),j&&d.setRotationAngle(a,$(a).data("rotation-angle")),e.find(".drag-before").after($(a))),j&&(f=$(a).offset().top,g=$(a).offset().left,h=g-c,i=f-b,$(a).data("rotation-origin-x",parseFloat($(a).data("rotation-origin-x"),10)+h),$(a).data("rotation-origin-y",parseFloat($(a).data("rotation-origin-y"),10)+i))}},{key:"setupDraggableHandler",value:function(a){var b=this,c=b.jObject,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0;$(a).draggable({containment:c,scroll:!0,start:function(a,g){if(b.hideAreaIndicators(),j=b.dragTile||this,c.find(".drag-item").removeClass("text-button-focus"),f=b.tileData[$(j).attr("data-clone")]){var k=parseInt($(j).css("left"),10);k=isNaN(k)?0:k;var l=parseInt($(j).css("top"),10);l=isNaN(l)?0:l,recoupLeft=k-$(j).position().left,recoupTop=l-$(j).position().top,d=$(j).offset().top,e=$(j).offset().left}$(j).addClass("drag-item-down"),$(j).find("*").hasClass("audioToggleIdentifier")&&$(j).find(".audioToggleIdentifier").audioComponent("disableAudio"),$(j).attr("data-tally","true"),b.options.cloning&&b.cloneTile(j),$(j).css("z-index",++b.zdex),c.find(".result-pop-up").is(":visible")&&(c.find(".result-pop-up").fadeOut(),c.unbind("click.obj")),!b.hasZIndexOrder&&$(j).parents().hasClass("droplets")&&($(j).parents(".droplets").css("z-index",b.zdex+1),$(j).parents(".drop-item").css("z-index",b.zdex+2)),b.dragTile&&(h=parseFloat($(b.dragTile).css("top"),10),i=parseFloat($(b.dragTile).css("left"),10),b.lastPos={x:$(this).offset().left,y:$(this).offset().top})},drag:function(a,c){if(f&&($(j).css("left",$(j).position().left+recoupLeft),$(j).css("top",$(j).position().top+recoupTop)),b.dragTile){var d=$(this).offset().left-b.lastPos.x,e=$(this).offset().top-b.lastPos.y;$(b.dragTile).css("top",h+e+"px"),$(b.dragTile).css("left",i+d+"px")}$(j).removeClass("drag-item-down").addClass("drag-item-dragging")},revert:!1,stop:function(a,f){var h=$(j).parent().hasClass("droplets");b.updateDropPosition(j,d,e),$(j).removeClass("drag-item-down drag-item-dragging drag-item-over"),g=$(j),setTimeout(function(){g.find("*").hasClass("audioToggleIdentifier")&&g.find(".audioToggleIdentifier").audioComponent("enableAudio")},300),b.isOnDropZone?(b.onDropEvent(b.isOnDropZone,g,!0),b.isOnDropZone=void 0):b.options.disappear&&b.disappearTile(j,h),b.hasBeenInteractedWith=!0,c.find(".drop-item").css("z-index",""),c.find(".droplets").css("z-index",""),b.updateTallys(),b.dragTile=void 0,b.dragHandle.hide()}});var k=null,l=null,m=!1;$(a).on("touchstart",function(a){l=k=a.originalEvent.touches[0].pageY}),$(a).on("touchmove",function(a){l=a.originalEvent.touches[0].pageY,0==m&&Math.abs(l-k)>30&&(m=!0),1==m&&window.scrollBy(0,5)})}},{key:"setupAreaIndicators",value:function(a,b,c){var d=void 0,e=this,f=void 0;"rotation"===a.areaType?(f=a.title?'<div tabindex="0" class="area-icon touch-device-rotate-area" title="'+a.title+'" alt="'+a.title+'"/>':'<div tabindex="0" class="area-icon touch-device-rotate-area"/>',$(b).append(f),d=$(b).find(".touch-device-rotate-area").last(),this.addRotationMousedownEventHandler(d),this.addRotationkeyEventListeners(d)):(f=a.title?'<div tabindex="0" class="area-icon touch-device-drag-area" title="'+a.title+'" alt="'+a.title+'"/>':'<div tabindex="0" class="area-icon touch-device-drag-area"/>',$(b).append(f),d=$(b).find(".touch-device-drag-area").last(),$(d).mouseToTouch(),d.on("mousedown",function(a){a.preventDefault(),e.activateDragHandle(a,$(this).closest(".drag-item"))}),this.addDragKeyEventListeners(d)),pos=this.getAreaIndicatorCoordinates(a.area,d),d.css({top:pos.top+"px",left:pos.left+"px"}).blur(function(){$(this).removeClass("text-button-focus")}).focus(function(){$(this).addClass("text-button-focus")}),c&&!e.isTouchDevice&&d.keydown(function(a){a.keyCode!==PearsonGL.utils.keyCode.tab||a.shiftKey||e.hideAreaIndicators()}),e.isTouchDevice||d.addClass("hidden")}},{key:"addRotationMousedownEventHandler",value:function(a){var b=this;$(a).mouseToTouch(),$(a).mousedown(function(a){a.preventDefault(),a.stopImmediatePropagation(),b.hideAreaIndicators(),b.jObject.find(".drag-item").removeClass("text-button-focus"),b.selectedItem=$(this).parents(".drag-item"),b.selectedItem.addClass("has-moved"),b.cloneTile(b.selectedItem),b.hasZIndexOrder||b.selectedItem.css("z-index",++b.zdex),b.isRotating=!0,$(b.selectedItem).data("start-x",a.pageX),$(b.selectedItem).data("start-y",a.pageY),b.originX=$(b.selectedItem).data("rotation-origin-x"),b.originY=$(b.selectedItem).data("rotation-origin-y")}),$(a).hover(function(){$(this).parents(".drag-item").addClass("rotate")},function(){$(this).parents(".drag-item").removeClass("rotate")})}},{key:"addDragKeyEventListeners",value:function(a){var b=this,c=(this.jObject,void 0);$(a).hasClass("touch-device-rotate-area")||$(a).hasClass("touch-device-drag-area")?(c=$(a).parents(".drag-item"),isArea=!0):(c=a,isArea=!1),$(a).keydown(function(a){if(($(this).is(":focus")||$(this).is(":active"))&&!$(c).hasClass("ui-draggable-disabled"))switch(b.setupOverDrop(c),a.keyCode!==PearsonGL.utils.keyCode.right&&a.keyCode!==PearsonGL.utils.keyCode.left&&a.keyCode!==PearsonGL.utils.keyCode.up&&a.keyCode!==PearsonGL.utils.keyCode.down||$(c).hasClass("has-moved")||$(c).addClass("has-moved"),a.keyCode){case PearsonGL.utils.keyCode.enter:b.tabbed=!0,b.setDragStatusLive("selected"),b.enterKeyEventHandler(c,isArea);break;case PearsonGL.utils.keyCode.right:$(c).css("left",parseFloat($(c).css("left"))+10),b.keyEventCloneChecker($(c));break;case PearsonGL.utils.keyCode.left:$(c).css("left",parseFloat($(c).css("left"))-10),b.keyEventCloneChecker($(c));break;case PearsonGL.utils.keyCode.up:a.preventDefault(),$(c).css("top",parseFloat($(c).css("top"))-10),b.keyEventCloneChecker($(c)),$(c).position()&&$(c).position().top<$(window).scrollTop()&&$(window).scrollTop($(c).position().top);break;case PearsonGL.utils.keyCode.down:a.preventDefault(),$(c).css("top",parseFloat($(c).css("top"))+10),b.keyEventCloneChecker($(c)),$(c).position()&&$(c).position().top+$(c).height()>$(window).scrollTop()+(window.innerHeight||document.documentElement.clientHeight)&&$(window).scrollTop($(c).position().top-(window.innerHeight||document.documentElement.clientHeight)+2*$(c).height())}})}},{key:"addRotationkeyEventListeners",value:function(a){var b=this,c=(this.jObject,void 0);a.keydown(function(a){if(a.keyCode===PearsonGL.utils.keyCode.up||a.keyCode===PearsonGL.utils.keyCode.down){a.preventDefault(),b.selectedItem.hasClass("has-moved")||b.selectedItem.addClass("has-moved"),c=a.keyCode===PearsonGL.utils.keyCode.up?15:-15,!1===b.isRotating&&(b.isRotating=!0,b.selectedItem=$(this).parents(".drag-item"),b.keyEventCloneChecker(b.selectedItem),this.focus()),b.setupOverDrop(b.selectedItem);var d=parseFloat($(b.selectedItem).data("rotation-angle"))+c;$(b.selectedItem).data("rotation-angle",d),b.setRotationAngle(b.selectedItem,d)}else a.keyCode===PearsonGL.utils.keyCode.enter&&(!1===b.isRotating&&(b.selectedItem=$(this).parents(".drag-item")),b.enterKeyEventHandler(b.selectedItem,!0),this.focus())})}},{key:"enterKeyEventHandler",value:function(a,b){var c=this,d=this.jObject,e=!1,f=void 0;if(c.selectDrag($(a),!1,b),$(a).parents().hasClass("droplets")){if(e=!0,!c.options.disappear)if(f=$(a).parents(".droplets"),c.lastSelected){var g=c.lastSelected;c.focusOnSelf($(this)),c.keyEventCloneChecker(g),c.onDropEvent(f,g,!0),c.freeformStackTiles()}else c.resetTile(a,f)}else c.lastSelected=$(a),!0!==c.isOverDrop||$(c.collideDetect(c.lastSelected,d.find(".droplets"))[0]).hasClass("ui-droppable-disabled")?c.options.disappear&&c.disappearTile(a,e):(c.isDropping=!0,c.isOverDrop=!1,c.onDropEvent($(c.collideDetect(c.lastSelected,d.find(".droplets"))[0]),c.lastSelected))}},{key:"hideAreaIndicators",value:function(){this.isTouchDevice||this.jObject.find(".touch-device-rotate-area, .touch-device-drag-area").each(function(){$(this).addClass("hidden")})}},{key:"resetTile",value:function(a,b){var d=this,e=this.jObject,f=e.offset().top,g=e.offset().left,h=void 0;d.setRotationAngle(a,0),h=b.children(".drag-item").offset(),parseFloat(b.children(".drag-item").attr("data-top-offset")),h.top,parseFloat(b.children(".drag-item").attr("data-left-offset")),h.left,d.setRotationAngle(a,$(a).data("rotation-angle")),$(a).attr("data-dragid"),cloneState=$(a).attr("data-clone-state"),"false"===cloneState&&(c=d.clone[parseFloat($(a).attr("data-clone"))],$(a).hasClass("text-image-tile")&&$(c).addClass("text-image-tile"),e.find(".drag-before").before(c),d.makeDrag(c)),$(a).remove(),d.setDragStatusLive("tile moved back to original position"),d.updateTallys(),d.lastSelected=null}},{key:"setupRotationEventHandler",value:function(){var a=this;$(document).bind("mouseup.freeform",function(b){a.isRotating&&(b.preventDefault(),b.stopImmediatePropagation(),a.isRotating=void 0,a.hadRotated=!1)}),$(document).bind("mousemove.freeform",function(b){if(a.isRotating){b.preventDefault(),b.stopPropagation();var c=$(a.selectedItem).data("start-y"),d=$(a.selectedItem).data("start-x"),e=180*Math.atan2(b.pageY-a.originY,b.pageX-a.originX)/Math.PI;e=e-180*Math.atan2(c-a.originY,d-a.originX)/Math.PI+parseFloat($(a.selectedItem).data("rotation-angle"),10),$(a.selectedItem).data("rotation-angle",e),a.setRotationAngle(a.selectedItem,e),$(a.selectedItem).data("start-x",b.pageX),$(a.selectedItem).data("start-y",b.pageY),a.hadRotated=!0}})}},{key:"setupOverDrop",value:function(a){var b=this,c=this.jObject;b.focusElem=a,b.isDropping=!1,b.collideDetect($(a),c.find(".droplets")).length>0?$(b.collideDetect($(a),c.find(".droplets"))[0])[0]!==$(a).parent()[0]&&(b.isOverDrop=!0,c.find(".drop-item").removeClass("drop-item-over"),$(b.collideDetect($(a),c.find(".droplets"))[0]).parent(".drop-item").addClass("drop-item-over")):(b.isOverDrop=!1,c.find(".drop-item").removeClass("drop-item-over")),$(a).parents().hasClass("droplets")&&!b.hasZIndexOrder&&($(a).parents(".droplets").css("z-index",b.zdex+1),$(a).parents(".drop-item").css("z-index",b.zdex+2))}},{key:"selectDrag",value:function(a,b,c){var d=this;this.jObject.find(".drag-item").each(function(){$(this).removeClass("drag-item-selected"),$(this).hasClass("ui-draggable-disabled")||($(this).attr("aria-grabbed","false"),$(this).find("*").hasClass("drag-state")&&$(this).find(".drag-state").html(""),$(this).hasClass("image-tile")&&$(this).find(".hidden-label").html($(this).attr("data-default-title")?$(this).attr("data-default-title"):""))}),b||(a.addClass("drag-item-selected"),a.find("*").hasClass("drag-state")&&a.find(".drag-state").html(d.options.selectedText),a.hasClass("image-tile")&&a.find(".hidden-label").html((a.attr("data-default-title")?a.attr("data-default-title"):"")+" "+d.options.selectedText),a.attr("aria-grabbed","true"),c||d.focusOnSelf(a))}},{key:"keyEventCloneChecker",value:function(a){this.cloneTile(a),this.hasBeenInteractedWith=!0,a.attr("data-tally","true")}},{key:"addDraggableToDroppable",value:function(a,b,c){var d=this,e=this.jObject,f=void 0,g=void 0,h=void 0,i=void 0;if(d.gridDnd){if(b.children().hasClass("drag-item")&&b.children(".drag-item")[0]!==a[0]){d.setRotationAngle(a,0);var j=e.offset().top,k=e.offset().left,l=b.children(".drag-item").offset();g=parseFloat(b.children(".drag-item").attr("data-top-offset"))-(l.top-j),f=parseFloat(b.children(".drag-item").attr("data-left-offset"))-(l.left-k),d.setRotationAngle(a,$(a).data("rotation-angle")),b.children(".drag-item").animate({top:g,left:f},500,function(){i=$(this).attr("data-dragid"),cloneState=$(this).attr("data-clone-state"),"false"===cloneState&&(h=d.clone[parseFloat($(this).attr("data-clone"))],e.find(".drag-before").before(h),d.makeDrag(h)),$(this).remove()})}b.append(a),a.css({top:"",left:""}).attr({"data-indrop-top":parseFloat(a.css("top")),"data-indrop-left":parseFloat(a.css("left"))})}else d.setRotationAngle(a,0),d.tabbed?(a.css({top:"",left:"",position:"relative"}),d.tabbed=!1):a.css({top:a.offset().top-b.offset().top,left:a.offset().left-b.offset().left}),$(a).data("rotation-angle")&&d.setRotationAngle(a,$(a).data("rotation-angle")),b.append(a);d.updateTallys(b.parent().attr("data-dropid"))}},{key:"dropSetup",value:function(){var a=this,b=a.jObject;a.options.hideTargetBackground&&b.find(".drop-item").addClass("no-bk"),b.find(".drop-item").children(".droplets").each(function(){$(this).droppable({accept:".drag-item,.drag-handle",over:function(b,c){$(this).parent(".drop-item").addClass("drop-item-over"),c.draggable.hasClass("drag-item")?c.draggable.addClass("drag-item-overdrop"):a.dragTile&&a.dragTile.addClass("drag-item-overdrop")},out:function(b,c){$(this).parent(".drop-item").removeClass("drop-item-over"),c.draggable.hasClass("drag-item")?c.draggable.removeClass("drag-item-overdrop"):a.dragTile&&a.dragTile.removeClass("drag-item-overdrop")},drop:function(b,c){a.isOnDropZone=$(this)}})}),b.find(".droplets").click(function(b){if(!$(this).hasClass("ui-droppable-disabled")&&a.isTouchDevice&&(b.preventDefault(),null!==a.lastSelected&&void 0!==a.lastSelected)){var c=a.lastSelected;a.keyEventCloneChecker(c),a.onDropEvent($(this),c,!0),a.gridDnd||c.css({top:b.clientY-$(this).offset().top,left:b.clientX-$(this).offset().left})}}),b.find(".droplets").attr({tabindex:"0",role:"button","aria-dropeffect":"move"}),a.options.cloning&&b.find(".droplets").attr({"aria-dropeffect":"move copy"}),b.find(".droplets").focus(function(b){PearsonGL.utils.focusItemOn(this),a.hideAreaIndicators()}),b.find(".droplets").blur(function(a){PearsonGL.utils.focusItemOff(this)}),b.find(".droplets").keyup(function(b){var c=this;if(($(this).is(":focus")||$(this).is(":active"))&&!$(this).hasClass("ui-droppable-disabled")&&13===b.keyCode&&(b.preventDefault(),null!==a.lastSelected&&void 0!==a.lastSelected)){var d=a.lastSelected;0===a.options.feedBack.length&&a.focusOnSelf($(this)),a.keyEventCloneChecker(d),setTimeout(function(){a.onDropEvent($(c),d,!0),a.freeformStackTiles()},100),a.setDragStatusLive("dropped")}})}},{key:"onDropEvent",value:function(a,b,c){var d=this,e=d.jObject;a.parent(".drop-item").removeClass("drop-item-over"),b.removeClass("drag-item-overdrop text-button-focus"),d.hasBeenInteractedWith=!0,e.find(".droplets").css("z-index",""),e.find(".drop-item").css("z-index",""),d.showFeedback(b,a.parent(".drop-item")),d.addDraggableToDroppable(b,a,c),d.freeformStackTiles()}},{key:"collideDetect",value:function(a,b){var c=a,d=b,e=$([]),f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0;return!(!c||!d)&&(c.each(function(){f=$(this),g=f.offset(),h=g.left,i=g.top,j=h+f.outerWidth(),k=i+f.outerHeight(),l=parseFloat(f.height())/2+i,m=parseFloat(f.width())/2+h,d.not(f).each(function(){return n=$(this),o=n.offset(),p=o.left,q=o.top,r=p+n.outerWidth(),s=q+n.outerHeight(),h>=r||j<=p||i>=s||k<=q||(m<=r&&m>=p&&l<=s&&l>=q?(e=$([]),e.push(this),!1):void 0)})}),e)}},{key:"setRotationAngle",value:function(a,b){$(a).css("-moz-transform","rotate("+b+"deg)"),$(a).css("-webkit-transform","rotate("+b+"deg)"),$(a).css("-o-transform","rotate("+b+"deg)"),$(a).css("-ms-transform","rotate("+b+"deg)"),$(a).css("transform","rotate("+b+"deg)")}},{key:"getAreaIndicatorCoordinates",value:function(a,b){var c=0,d=0,e=a.split(","),f=void 0,g=void 0,h=void 0,i=void 0,j=9999,k=-1,l=9999,m=-1;switch(3==e.length?"circle":4==e.length?"rect":"poly"){case"rect":d=(parseInt(e[0],10)+parseInt(e[2],10))/2,c=(parseInt(e[1],10)+parseInt(e[3],10))/2;break;case"circle":d=parseInt(e[0],10),c=parseInt(e[1],10);break;default:for(f=0;f<e.length;f++)g=parseInt(e[f],10),f%2==0?(g>k&&(k=g),g<j&&(j=g)):(g>m&&(m=g),g<l&&(l=g));c=(m+l)/2,d=(k+j)/2}return i=b.height()/2,h=b.width()/2,{top:c-i,left:d-h}}},{key:"initZIndex",value:function(){var a=void 0,b=this;b.zdex=-99999,this.hasZIndexOrder=!1,a=this.options.draggables.concat(this.options.labels).concat(this.options.droppables),$.each(a,function(a,c){$.isNumeric(c.zIndex)&&(c.zIndex>b.zdex&&(b.zdex=c.zIndex),b.hasZIndexOrder=!0)}),b.hasZIndexOrder?b.zdex+=b.zIndexBase:b.zdex=20}},{key:"setGadget",value:function(){var a=this,b=a.jObject,c=null;a.hasBeenInteractedWith=!0,$(a.scormData.tiles).each(function(){if(length=0,a.options.cloning){for(i=0;i<a.scormData.tiles.length;i++)a.scormData.tiles[i].uniqueId===this.uniqueId&&length++;this.dropped&&(length>1?(c=b.find("#"+this.uniqueId+"[data-clone-state='true']"),clone=a.clone[parseFloat(c.attr("data-clone"))],b.find(".drag-before").before(clone),a.makeDrag(clone),c.attr("data-clone-state","false"),c.attr("data-tally","true"),b.find("#"+this.dropNodeId).find("#"+this.dropletIndex).append(c),c.css({top:this.y,left:this.x})):(c=b.find("#"+this.uniqueId),c.attr("data-tally","true"),b.find("#"+this.dropNodeId).find("#"+this.dropletIndex).append(c),c.css({top:this.y,left:this.x})))}else this.dropped?(c=b.find("#"+this.uniqueId),c.attr("data-tally","true"),b.find("#"+this.dropNodeId).find("#"+this.dropletIndex).append(c),c.css({top:this.y,left:this.x})):(c=b.find("#"+this.uniqueId),c.attr("data-tally","true"),c.css({top:this.y,left:this.x}))}),a.scormData.tiles.length>0&&a.updateTallys()}},{key:"setGadgetData",value:function(){"object"!==("undefined"==typeof SB?"undefined":_typeof(SB))&&(this.options.scormOn=!1),!0===this.options.scormOn&&void 0!==this.options.scorm&&void 0!==this.options.scorm.suspendData&&(this.options.scorm.suspendData.data={},$.extend(this.options.scorm.suspendData.data,this.scormData))}},{key:"parseLearnerData",value:function(){var a=this.options.scorm.suspendData.data;"object"===(void 0===a?"undefined":_typeof(a))&&(this.scormData=a,this.setGadget())}},{key:"saveLearnerData",value:function(){this.isCommEnabled()&&(this.options.scorm.suspendData.data=this.scormData,this.setLearnerData({results:[{learnerResponse:"Freeform Drag and Drop Complete",raw:this.options.scorm.interactions[0].objectives[0].score.max,progressMeasure:1,completionStatus:"completed",successStatus:"passed"}]}))}}]),d}(PearsonGL.Gadget.GadgetBase);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.DrawPad=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));if(!c||!a)return _possibleConstructorReturn(e);e.constants={MATH_SYMBOL:"",EQ_SYMBOL:""},e.labelOpts={red:"Red",black:"Black",green:"Green",blue:"Blue",purple:"Purple",yellow:"Yellow",color:"Color",colorMenu:"Color menu.",text:"Place Text",type:"Edit Textbox",typePressed:"Edit textbox toggle button pressed",typeNotPressed:"Edit textbox toggle button not pressed",textsize:"Text Size",textSM:"Small Text",textMD:"Medium Text",textLG:"Large Text",drawline:"Draw line",drawFreeform:"Draw a free-form line",draw:"Draw",undo:"Undo",redo:"Redo",undoClicked:"Undo clicked",redoClicked:"Redo clicked",clear:"Clear",clearall:"Clear All",penslider:"Pen Slider",erase:"Erase",math:"Math",equation:"Equation",divide:"Divide",dot:"Multiplication Dot",notequal:"Not Equal",degrees:"Degrees",lessthan:"Less than or equal to",greaterthan:"Greater than or equal to",angle:"Angle",pi:"PI",implies:"Implies",approx:"Approximately equal to",squareroot:"Square root",save:"Save",deleteAll:"Delete All?",areYouSure:"Are you sure you want to delete this note?",cancelButton:"Cancel",deleteButton:"Delete",duplicateButton:"Duplicate",drawPad:"DrawPad",stamp:"Stamp",shape:"Shape",plus:"Plus",minus:"Minus",multiply:"Multiply",equal:"Equals",question:"Question mark",less:"Less than",greater:"Greater than",dollar:"Dollar",cent:"Cent",bold:"Bold",italic:"Italic",underline:"Underline",attach:"Add Image",backgroundAlt:"Background image",resizeHandle:"Resize handle",selectedColor:"Selected color",image:"Image",penTools:"Pen tools",eraserTool:"Eraser tool",penWidth:"Pen width",eraserWidth:"Eraser width",openKeypad:"Open keypad",objectMoveLeft:"Object is moving left",objectMoveRight:"Object is moving right",objectMoveUp:"Object is moving up",objectMoveDown:"Object is moving down",objectResizeLarger:"Object is larger",objectResizeSmaller:"Object is smaller",imageDeleted:"The image object has been deleted.",textBoxDeleted:"The text box has been deleted.",allDeleted:"The activity has been cleared.",workWillSave:"Your work will automatically be saved"};var f=PearsonGL.globals.player.runtimeJson||{},g=f.gadgetOptions&&f.gadgetOptions.DrawPad?f.gadgetOptions.DrawPad:{};return e.options=$.extend(!0,{gadgetName:"DrawPad",textKeeper:[],authoredTextKeeper:[],undoHistory:[],redoHistory:[],maxLen:15e3,maxNotes:20,availableNoteCount:20,notCenterTools:!1,noMathSymbolTools:!1,backgroundImage:{noResize:!1},ALLOWED_UNDOS:5,equationEditor:!g.mathquill&&!!window.EquationEditorAPI,mathquill:!!g.mathquill},e.options||{}),e.undoCount=0,e.redoCount=0,e.clearCount=0,e.LAYERS={LAYER_ORDER_BOTTOM:1e3,LAYER_ORDER_MIDDLE:1001,LAYER_ORDER_TOP:1004,TEXT_ORDER_TOP:1010,TEXT_ORDER_BOTTOM:1005},e.TOOLS={CURSOR:1,PEN:2,LINE:3,ERASE:4,STAMP:5},e.MAIN_BUTTONS={CURSOR:1,PEN_PRIMARY:2,PEN:3,LINE:4,STAMP:5,STAMP_ITEM:6,ERASE:7,UNDO:8,REDO:9,TEXT:10,SHAPE:11,SHAPE_ITEM:12,TRASH:13,COLOR:14,ATTACH:15},e.TEXT_BOX_BUTTONS={PICKED_MATH:1,PICKED_FONT_S:2,PICKED_FONT_M:3,PICKED_FONT_L:4,TEXT_COLOR:5,TEXT_MATH:6,TEXT_EQUATION:7,TEXT_SIZE:8,TEXT_TRASH:9,TEXT_BOLD:10,TEXT_ITALIC:11,TEXT_UNDERLINE:12,TEXT_KEYPAD:13},e.jObject=$(a),e.jObject.data("gadget_options",e.options),e.inlineMode=e.jObject.hasClass("inline-drawpad"),e.backgroundTypeDrawpad=e.options.backgroundImage&&PearsonGL.utils.isNonEmptyString(e.options.backgroundImage.src),e.jObject.addClass("drawpad-identifier"),e.jObject.toggleClass("dp-background-image",e.backgroundTypeDrawpad),e.jObject.toggleClass("dp-fullscreen",!e.backgroundTypeDrawpad&&!e.inlineMode),e.jObject.toggleClass("math-ee",e.options.equationEditor),e.jObject.toggleClass("math-mq",e.options.mathquill),e.jObject.toggleClass("math-symbols",!e.options.equationEditor&&!e.options.mathquill),e.jObject.toggleClass("drawpad-responsive",e.backgroundTypeDrawpad&&!e.options.backgroundImage.noResize),e.gadgetId=PearsonGL.utils.randomString(9),e.jObject.attr("id",e.gadgetId),e.isTouchDevice="ontouchstart"in document.documentElement,e.mathData={},e.mathquillMap={},e.okToDraw=!1,e.hasUserInteracted=!1,e.penOptions={colorId:"color1",width:4},e.lineOptions={colorId:"color1",width:4},e.eraseOptions={colorId:"color0",width:23},e.drawOptionsMap={},e.drawOptionsMap[e.TOOLS.PEN]=e.penOptions,e.drawOptionsMap[e.TOOLS.LINE]=e.lineOptions,e.drawOptionsMap[e.TOOLS.ERASE]=e.eraseOptions,e.currentTool=e.TOOLS.CURSOR,e.currentDrawTool=e.TOOLS.PEN,e.shapeMoveDirection=void 0,e.shapeMoveTime=0,e.shapeResizeType=void 0,e.shapeResizeTime=0,e.lastStampId,e.lastStampCategoryId,e.currentStampCategoryId,e.points=[],e.oldWindowWidth=$(window).width(),e.bgScale=1,e.bgCurrentWidth=0,e.bgCurrentHeight=0,e.rightAlignToolbar=e.inlineMode&&e.jObject.hasClass("drawpad-toolbar-right"),e.toolbarWidth=56,e.leftGutter=e.inlineMode&&!e.rightAlignToolbar?e.toolbarWidth:0,e.rightGutter=e.inlineMode&&e.rightAlignToolbar?e.toolbarWidth:0,e.textkeeperLen=0,e.lastUserTextBox=null,e.org_coords={x:0,y:0},e.browser={userAgent:function(){return window.navigator?window.navigator.userAgent.toLowerCase():""},isFirefox:function(){return/firefox|iceweasel/i.test(this.userAgent())},isIE:function(){return/msie|trident/i.test(this.userAgent())}},e.allowPassthrough="true"===PearsonGL.utils.getQuerystring("dp_passthrough","false")||PearsonGL.globals.player.runtimeJson&&PearsonGL.globals.player.runtimeJson.drawpadPassthrough,e.numberOfTimesSaved=0,e.initGadget(e.options.gadgetName),PearsonGL.utils.getGlobalizedLabel("drawpad_globalization",function(a){$.extend(e.labelOpts,a),delete c.scorm,$.extend(!0,e.options,c),e.globalizationComplete()},e.options.runtimejson.lang),e}return _inherits(b,a),_createClass(b,[{key:"globalizationComplete",value:function(){var a=this;this.colorConfig={penColors:{color0:{color:"transparent",title:""},color1:{color:"#000000",title:this.labelOpts.black},color2:{color:"#ff0000",title:this.labelOpts.red},color3:{color:"#008000",title:this.labelOpts.green},color4:{color:"#0000ff",title:this.labelOpts.blue},color5:{color:"#800080",title:this.labelOpts.purple},color6:{color:"#ffff00",title:this.labelOpts.yellow}},textColors:{color1:{color:"#000000",title:this.labelOpts.black},color2:{color:"#ff0000",title:this.labelOpts.red},color3:{color:"#008000",title:this.labelOpts.green},color4:{color:"#0000ff",title:this.labelOpts.blue},color5:{color:"#800080",title:this.labelOpts.purple},color6:{color:"#ffff00",title:this.labelOpts.yellow}}},this.buildColorConfig(),this.textColor=this.colorConfig.textColors.color1.color,this.mathSymbolsMap={},this.mathSymbolsMapReverse={},this.buildMathSymbolsMap(),this.isCommEnabled({windowPostMessage:!0})&&PearsonGL.globals.comm.subscribeToPostMessages(this.listenForMessages.bind(this));try{this.options.noDraw=pageLevelNoDraw}catch(a){}""!==PearsonGL.utils.getQuerystring("noDraw","",!0)?this.noDraw=PearsonGL.utils.getQuerystring("noDraw","0",!0):this.options.noDraw&&(this.noDraw=!0),this.stampConfig={imageWidth:0,imageHeight:0,reset:function(){this.imageWidth=0,this.imageHeight=0}};var b=PearsonGL.utils.getQuerystring("dpbg","");if(PearsonGL.utils.isNonEmptyString(b)&&(this.backgroundTypeDrawpad=!0,this.options.backgroundImage=this.options.backgroundImage||{},this.options.backgroundImage.origSrc=this.options.backgroundImage.src,this.options.backgroundImage.src=b),this.backgroundTypeDrawpad){this.options.backgroundImage.src=PearsonGL.qtiEvaluator.evaluateAsset(this.options.backgroundImage.src);var c=document.createElement("img");c.onload=function(){a.options.backgroundImage.width=c.width,a.options.backgroundImage.height=c.height,a.bgCurrentWidth=c.width,a.bgCurrentHeight=c.height,a.buildDom(),a.initCanSave()},c.onerror=function(){a.buildDom(),a.jObject.find(".image-class-wrapper").empty().html('<h1 class="image-fail">Image Failed to load.</h1>')},c.src=this.options.backgroundImage.src}else this.buildDom(),this.initCanSave();this.addAccessibility(this.jObject)}},{key:"buildDom",value:function(){function a(a){for(var b="stamp"===a?c.labelOpts.stamp:c.labelOpts.shape,d=$('<div class="drawpad-'+a+'-picker-primary-menu closed hide sub-menu grid-menu grid-primary-menu" role="menu" aria-label="'+b+'"></div>').appendTo(e),f=$('<div class="drawpad-'+a+'-picker-sub-menu closed hide sub-menu grid-menu grid-sub-menu" role="menu" aria-label="'+b+'"></div>').appendTo(e),g="stamp"===a?c.MAIN_BUTTONS.STAMP_ITEM:c.MAIN_BUTTONS.SHAPE_ITEM,h=1,i=void 0,j=void 0,k=0;k<10;k++){j=$('<div class="drawpad-picker-row"></div>').appendTo(d);for(var l=0;l<10;l++)i=$('<div tabindex="-1" role="menuitem" class="drawpad-default drawpad-'+a+'-item keep-selection"></div>').appendTo(j),i.attr("data-id",g),i.attr("data-"+a+"-id","s0_r"+k+"_c"+l),i.attr("data-"+a+"-category-id",h++)}for(var m=0;m<10;m++){j=$('<div class="drawpad-picker-row"></div>').appendTo(f);for(var n=0;n<10;n++)i=$('<div tabindex="-1" role="menuitem" class="drawpad-default drawpad-'+a+'-item keep-selection"></div>').appendTo(j),i.attr("data-id",g),i.attr("data-"+a+"-id","s1_r"+m+"_c"+n)}}var b=this,c=this,d=this.jObject,e=void 0,f=void 0,g=void 0,h=0,i=this.colorConfig.textColors.color1,j=this.labelOpts.colorMenu+" "+this.labelOpts.selectedColor+": "+i.title+".",k=[],l='<div class="drawpad-default text-color-picker hackclass keep-selection" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" style="background-color: '+i.color+'" data-color="'+c.textColor+'" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_COLOR+'" title="'+j+'" aria-label="'+j+'"></div>',m='<div class="drawpad-default hackclass keep-selection ic-dp-fontsize sprite" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" data-icon="ic-dp-fontsize" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_SIZE+'" title="'+c.labelOpts.textsize+'" aria-label="'+this.labelOpts.textsize+'"></div>',n='<div class="drawpad-default hackclass keep-selection text-math-tools ic-dp-math ic-dp-math-menu sprite" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" data-icon="ic-dp-math" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_MATH+'" title="'+this.labelOpts.math+'"></div>',o='<div class="drawpad-default hackclass keep-selection text-equation-tools ic-dp-math sprite" tabindex="0" role="button" data-icon="ic-dp-math" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_EQUATION+'" title="'+this.labelOpts.equation+'"></div>',p='<div class="drawpad-default hackclass keep-selection text-keypad ic-dp-math sprite" tabindex="0" role="button" data-icon="true" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_KEYPAD+'" title="'+this.labelOpts.openKeypad+'"></div>',q=this.getTextBoxstyling();if(this.keypadGadget=this.jObject.closest(".page").find(".gadget-keypad"),this.backgroundTypeDrawpad){if(Array.isArray(this.options.inputFieldCoords)){d.append('<div class="invisible-inputs"></div>'),this.options.noMathSymbolTools&&(n="",h=-38),this.options.mathquill?(n="",o="",l="",m="",q=""):p="",this.options.inputFieldCoords.forEach(function(a){var e=PearsonGL.utils.randomString(9);k.push(e),d.find(".invisible-inputs").append('\n\t\t\t\t\t\t<div class="editable-content-wrapper">\n\t\t\t\t\t\t\t<div data-authtext-id="" contenteditable="'+(b.options.mathquill?"false":"true")+'" class="rich-input-type" id="'+e+'" data-max="'+a.maxlength+'">&nbsp;</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="invisible-text-color-picker-menu hide" role="toolbar">\n\t\t\t\t\t\t\t<div class="drag-handle">\n\t\t\t\t\t\t\t\t<div class="drag-handle-img"></div>\n\t\t\t\t\t\t\t\t'+l+"\n\t\t\t\t\t\t\t\t"+m+"\n\t\t\t\t\t\t\t\t"+q+'\n\t\t\t\t\t\t\t\t<hr class="text_rule text_rule-5" />\n\t\t\t\t\t\t\t\t'+n+"\n\t\t\t\t\t\t\t\t"+o+"\n\t\t\t\t\t\t\t\t"+p+"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t"+c.buildTextboxMenu("text-colors-wrapper",b.labelOpts,b.TEXT_BOX_BUTTONS,b.colorConfig.textColors)+"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"),d.find("#"+e).css({top:a.y,left:a.x,width:a.width,height:a.height}).data("origCoords",a),d.find(".invisible-text-color-picker-menu:last").addClass(e).attr("id","text_primary_menu"+e),d.find(".drag-handle:last").attr("id","menu_"+e),d.find(".invisible-inputs div.rich-input-type:last").addClass("drawpad-clear-textarea")});var r=parseInt(d.find(".ic-dp-fontsize").css("top"),10);d.find(".ic-dp-fontsize").css("top",r+h),h<0&&d.find(".drag-handle").addClass("drag-handle-small"),d.find(".invisible-text-color-picker-menu").on("mouseover touchstart",function(){b.saveRange()}),d.find(".invisible-text-color-picker-menu").on("keyup",".ic-dp-fontsize",function(a){if(a.keyCode===PearsonGL.utils.keyCode.enter||a.keyCode===PearsonGL.utils.keyCode.space){var b=$(a.currentTarget),d=b.closest(".invisible-text-color-picker-menu").find(".font-sizes-wrapper"),e=$("#"+c.currentTextEditor).data("fontsize"),f=d.find(".text-size");"1"!==e&&"2"!==e&&"3"!==e&&(e="2"),e=parseInt(e,10)-1,f.removeClass("button-clicked-wrapper"),$(f[e]).addClass("button-clicked-wrapper"),f[e].focus(),d.find(".text-size")[e].focus()}}),d.find(".invisible-text-color-picker-menu").find(".text-color").each(function(a,c){$(c).mouseover(function(){b.saveRange()}).sliderbutton({buttonClassName:"text-color",slider:!1,clickFunction:function(a){var c=a.jObject,e=c.attr("aria-label");b.textColor=c.attr("data-color"),b.textColor.indexOf("rgb")>-1&&(b.textColor=PearsonGL.utils.rgbColorToHex(b.textColor)),c.parent().parent().parent().find(".text-color-picker").css({"background-color":b.textColor}).attr({"data-color":b.textColor,"aria-label":b.labelOpts.colorMenu+" "+b.labelOpts.selectedColor+": "+e+".",title:b.labelOpts.colorMenu+" "+b.labelOpts.selectedColor+": "+e+"."}),b.hideTextBoxSubmenus(),d.find(".drag-handle").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide menu-slider-open-left menu-slider-open-right editable-content-wrapper-math-slide-right"),b.restoreSelection(b.savedRange),document.execCommand("foreColor",!1,b.textColor),b._iosHackForInputs(),b._unlockTrash(),setTimeout(function(){b.jObject.find(".hidden-label").text(b.labelOpts.selectedColor+" "+e)},100)}})}),d.find(".invisible-text-color-picker-menu").on("keyup",".text-color-picker",function(a){if(a.keyCode===PearsonGL.utils.keyCode.enter||a.keyCode===PearsonGL.utils.keyCode.space){var b=$(a.currentTarget),c=b.closest(".invisible-text-color-picker-menu").find(".text-colors-wrapper"),d=b.attr("data-color"),e=c.find('[data-color="'+d+'"]');return 0===e.length&&(e=c.find(".text-color").first()),e[0].focus(),e.addClass("text-color-button-over"),!1}}),d.find(".invisible-text-color-picker-menu .text-color").off("keydown"),d.find(".invisible-text-color-picker-menu").on("keydown",".text-color, .text-size, .math-element",function(a){var b=$(a.currentTarget),d=a.keyCode===PearsonGL.utils.keyCode.down||a.keyCode===PearsonGL.utils.keyCode.right,e=a.keyCode===PearsonGL.utils.keyCode.up||a.keyCode===PearsonGL.utils.keyCode.left,f=b.closest(".invisible-text-color-picker-menu"),g="",h=void 0,i=void 0,j=void 0;if(b.hasClass("text-color"))h=b.closest(".text-colors-wrapper"),i=".text-color",j=".text-color-picker",g="text-color-button-over";else if(b.hasClass("text-size"))h=b.closest(".font-sizes-wrapper"),i=".text-size",j=".ic-dp-fontsize";else{if(!b.hasClass("math-element"))return;h=b.closest(".text-math-picker-menu-wrapper"),i=".math-element",j=".text-math-tools"}if(d||e){var k=h.find(i),l=$.inArray(document.activeElement,k);return l=l<0?0:l,l=d?(l+1)%k.length:l-1<0?k.length-1:l-1,k.removeClass(g),$(k[l]).addClass(g),k[l].focus(),!1}if(a.keyCode===PearsonGL.utils.keyCode.tab)c.hideTextBoxSubmenus(),f.find(j)[0].focus();else if(".text-color"===i&&(a.keyCode===PearsonGL.utils.keyCode.enter||a.keyCode===PearsonGL.utils.keyCode.space))return b.click(),!1}),d.find(".invisible-text-color-picker-menu").on("focusout",function(a){var c=$(a.currentTarget),d=c.find(".drag-handle").attr("id").replace("menu_",""),e=b.jObject.find("#"+d);setTimeout(function(){document.activeElement!==e[0]&&0===$(document.activeElement).closest(c).length&&b.announceTextBlur(e.text())},0)}),this.options.mathquill?d.find(".invisible-inputs .rich-input-type").each(function(a,c){c=$(c),c.closest(".editable-content-wrapper").addClass("empty"),b.mathquillMap[c.attr("id")]=new PearsonGL.Gadget.ComponentMathquill(c,{allowEnterKey:!0,onlySaveSupportedLatex:!0,onChange:function(a){b.setUserHasInteracted(),b._unlockTrash();var d=a.getLatex();c.closest(".editable-content-wrapper").toggleClass("empty",!PearsonGL.utils.isNonEmptyString(d))},onFocus:function(a){b.currentTextEditor=c.attr("id"),PearsonGL.utils.setActiveInputField(c);var d=$("."+b.currentTextEditor),e=c.position();b._hideTypeBox(),d.css({top:e.top-5,left:e.left-50}),d.show()},onBlur:function(a){b.buildAuthoredTextBoxData(c)}})}):d.find(".invisible-inputs .rich-input-type").click(function(a){b.currentTextEditor=a.currentTarget.id,b._closeMenus()}).keydown(function(a){if(16!==a.keyCode&&37!==a.keyCode&&39!==a.keyCode&&38!==a.keyCode&&40!==a.keyCode&&9!==a.keyCode){var c=$(a.currentTarget),d=c.data("fontsize")?2*c.data("fontsize"):4;document.execCommand("foreColor",!1,b.textColor),document.execCommand("fontSize",!1,d)}}).keyup(function(a){var c=$(a.currentTarget);b.setUserHasInteracted(),b._maxLengthLimitor(c,c.attr("data-max")),b._unlockTrash(),b.saveRange()}).focus(function(a){var c=$(a.currentTarget);b.currentTextEditor=c.attr("id");var d=$("."+b.currentTextEditor),e=c.position();b._hideTypeBox(),d.css({top:e.top-5,left:e.left-50}),d.show()}).blur(function(a){if(b.buildAuthoredTextBoxData(a.currentTarget),b.currentTextEditor){var c=$("."+b.currentTextEditor);setTimeout(function(){0===$(document.activeElement).closest(c).length&&b.announceTextBlur($(a.currentTarget).text())},0)}}).mouseup(function(a){var c=$(a.currentTarget);b.textColor=c.parent().next().find(".text-color-picker").attr("data-color"),b.saveRange(),b.textColor.indexOf("rgb")>-1&&(b.textColor=PearsonGL.utils.rgbColorToHex(b.textColor))}).bind("touchmove",function(a){$(a.currentTarget).blur()}),d.find(".invisible-text-color-picker-menu").draggable({handle:".drag-handle",distance:15,start:function(){PearsonGL.utils.suppressIframeEvents(!0)},stop:function(){PearsonGL.utils.suppressIframeEvents(!1)}}),d.find(".invisible-inputs .rich-input-type, .invisible-text-color-picker-menu").add(this.keypadGadget).focusout(this.handleTextBoxBlur.bind(this))}var s=$('<div class="background-image"></div>').appendTo(d);if(s.imagecomponent({title:PearsonGL.utils.isNonEmptyString(this.options.backgroundImage.altText)?this.options.backgroundImage.altText:this.labelOpts.backgroundAlt,src:this.options.backgroundImage.src,noTabIndex:!1,protect:!1}),!this.options.backgroundImage.noResize){if(this.inlineMode){var t=d.width()-this.leftGutter-this.rightGutter;this.bgScale=t/this.options.backgroundImage.width,this.bgCurrentWidth=t,this.bgCurrentHeight=this.options.backgroundImage.height*this.bgScale,this.resizeDetectIntervalCount=0,this.resizeDetectInterval=setInterval(function(){var a=d.width()-b.leftGutter-b.rightGutter;b.bgCurrentWidth!==a&&b.handleWindowResize(),10==b.resizeDetectIntervalCount++&&clearInterval(b.resizeDetectInterval)},1e3)}else{var u=$(window).height();this.bgScale=(0===u?this.options.backgroundImage.height:u)/this.options.backgroundImage.height,this.bgCurrentWidth=this.options.backgroundImage.width*this.bgScale,this.bgCurrentHeight=0===u?this.options.backgroundImage.height:u}s.find("img").attr({width:parseInt(this.bgCurrentWidth,10),height:parseInt(this.bgCurrentHeight,10)})}if(this.addLongDescription(s,this.options.backgroundImage.longDesc),void 0!==this.options.inputFieldCoords)for(var v=d.find(".invisible-inputs .rich-input-type"),w=0;w<v.length;w++){var x=$(v[w]),y=x.data("origCoords");x.css({left:this.bgScale*y.x+this.leftGutter,top:this.bgScale*y.y,height:this.bgScale*y.height,width:this.bgScale*y.width})}}this.inlineMode?this.backgroundTypeDrawpad?(f=this.bgCurrentWidth,g=this.bgCurrentHeight):(f=d.width()-this.leftGutter-this.rightGutter,g=Math.max(440,this.options.gadgetHeight||0)):this.backgroundTypeDrawpad?(f=this.options.backgroundImage.width*this.bgScale,g=this.options.backgroundImage.noResize?this.options.backgroundImage.height:$(window).height(),$(".main").height(g)):(f=$(".main").width(),g=$(window).height()),d.append('<div class="text-canvas" aria-hidden="true"></div><canvas id="drawPadCanvas" aria-hidden="true"></canvas>');try{this.canvas=d.find("canvas")[0],this.canvas.width=f,this.canvas.height=g,this.inlineMode&&this.jObject.height(g),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.id="scratchCanvas",this.scratchCanvas.width=this.canvas.width,this.scratchCanvas.height=this.canvas.height,this.ctx=this.canvas.getContext("2d"),this.scratchCtx=this.scratchCanvas.getContext("2d"),d.append(this.scratchCanvas),d.find("#scratchCanvas").attr("aria-hidden","true"),this.options.backgroundImage.noResize&&(this.clearScreenOnDraw=!0),this.backgroundTypeDrawpad&&!this.inlineMode&&d.find("#scratchCanvas, canvas, .background-image, .invisible-inputs").css({left:"50%",marginLeft:.5*-parseInt(this.bgCurrentWidth)})}catch(a){}var z=$('<img class="stamp-floating-cursor" />').insertBefore(d.find("#scratchCanvas"));z.css("z-index",c.LAYERS.LAYER_ORDER_TOP),z[0].onload=function(){z[0].style.removeProperty("width"),z[0].style.removeProperty("height"),z.show(),c.stampConfig.imageWidth=this.naturalWidth,c.stampConfig.imageHeight=this.naturalHeight,z.width(this.naturalWidth*c.bgScale),z.hide()},d.append('\n\t\t\t<div class="drawpad-toolbar-wrapper">\n\t\t\t<div class="drawpad-toobar-handle" aria-hidden="true"></div>\n\t\t\t\t<ul class="drawpad-toolbar"></ul>\n\t\t\t</div>'),e=d.find(".drawpad-toolbar"),e.append('<li title="'+this.labelOpts.type+'" aria-label="'+this.labelOpts.type+'" class="drawpad-default drawpad-tool-type drawpad-tool-type-1 sprite" data-id="'+this.MAIN_BUTTONS.CURSOR+'" tabindex="0" role="button"><div class="ic-dp-type ic-dp-pointer sprite" data-icon="ic-dp-type"></div></li>'),e.append('<hr class="text_rule text_rule-1" aria-hidden="true" />'),e.append('<li title="'+this.labelOpts.draw+'" aria-label="'+this.labelOpts.draw+'" class="drawpad-default drawpad-tool-draw drawpad-tool-draw-primary sprite" data-id="'+this.MAIN_BUTTONS.PEN_PRIMARY+'" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false"><div class="ic-dp-draw sprite" data-icon="ic-dp-draw"></div></li>'),e.append('<li title="'+this.labelOpts.stamp+'" aria-label="'+this.labelOpts.stamp+'" class="drawpad-default drawpad-tool-stamp sprite" data-id="'+this.MAIN_BUTTONS.STAMP+'" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false"><div class="ic-dp-stamp sprite" data-icon="ic-dp-stamp"></div></li>'),e.append('<li title="'+this.labelOpts.erase+'" aria-label="'+this.labelOpts.erase+'" class="drawpad-default drawpad-tool-erase sprite" data-id="'+this.MAIN_BUTTONS.ERASE+'" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false"><div class="ic-dp-erase sprite" data-icon="ic-dp-erase"></div></li>'),e.append('<li title="'+this.labelOpts.undo+'" aria-label="'+this.labelOpts.undo+'" class="drawpad-default drawpad-tool-undo sprite disabled" data-id="'+this.MAIN_BUTTONS.UNDO+'" tabindex="0" aria-disabled="true" role="button"><div class="ic-dp-undo ic-dp-undo-disabled nopressed sprite" data-icon="ic-dp-undo"></div></li>'),e.append('<li title="'+this.labelOpts.redo+'" aria-label="'+this.labelOpts.redo+'" class="drawpad-default drawpad-tool-redo sprite disabled" data-id="'+this.MAIN_BUTTONS.REDO+'" tabindex="0" aria-disabled="true" role="button"><div class="ic-dp-redo ic-dp-redo-disabled nopressed sprite" data-icon="ic-dp-redo"></div></li>'),e.append('<hr class="text_rule text_rule-2" aria-hidden="true" />');var A=this.colorConfig.penColors;e.append('\n\t\t\t<div class="drawpad-color-picker closed hide sub-menu" role="menu" aria-label="'+this.labelOpts.penTools+'">\n\t\t\t\t<span style="float: left;" title="'+this.labelOpts.drawFreeform+'" aria-label="'+this.labelOpts.drawFreeform+'" class="drawpad-default drawpad-tool-draw drawpad-tool-pen sprite" data-id="'+this.MAIN_BUTTONS.PEN+'" tabindex="-1" role="button" aria-pressed="false"><div class="ic-dp-curve sprite" data-icon="ic-dp-curve"></div></span>\n\t\t\t\t<span style="float: left;" title="'+this.labelOpts.drawline+'" aria-label="'+this.labelOpts.drawline+'" class="drawpad-default drawpad-tool-line sprite" data-id="'+this.MAIN_BUTTONS.LINE+'" tabindex="-1" role="button" aria-pressed="false"><div class="ic-dp-line sprite" data-icon="ic-dp-line"></div></span>\n\t\t\t\t<div class="drawpad-color" >\n\t\t\t\t\t<span class="drawpad-color-changer circle"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="drawpad-brush-slider" title="'+this.labelOpts.penslider+'"></div>\n\t\t\t\t<table class="color-table"><tr>\n\t\t\t\t\t<td title="'+A.color1.title+'" aria-label="'+A.color1.title+'" class="drawpad-default draw-tool-color" data-color-id="color1" data-id="'+this.MAIN_BUTTONS.COLOR+'" tabindex="-1" role="button" aria-pressed="false"><div class="color1 color-shape c-picker"></div></td>\n\t\t\t\t\t<td title="'+A.color2.title+'" aria-label="'+A.color2.title+'" class="drawpad-default draw-tool-color" data-color-id="color2" data-id="'+this.MAIN_BUTTONS.COLOR+'" tabindex="-1" role="button" aria-pressed="false"><div class="color2 color-shape c-picker"></div></td>\n\t\t\t\t\t<td title="'+A.color3.title+'" aria-label="'+A.color3.title+'" class="drawpad-default draw-tool-color" data-color-id="color3" data-id="'+this.MAIN_BUTTONS.COLOR+'" tabindex="-1" role="button" aria-pressed="false"><div class="color3 color-shape c-picker"></div></td>\n\t\t\t\t\t<td title="'+A.color4.title+'" aria-label="'+A.color4.title+'" class="drawpad-default draw-tool-color" data-color-id="color4" data-id="'+this.MAIN_BUTTONS.COLOR+'" tabindex="-1" role="button" aria-pressed="false"><div class="color4 color-shape c-picker"></div></td>\n\t\t\t\t\t<td title="'+A.color5.title+'" aria-label="'+A.color5.title+'" class="drawpad-default draw-tool-color" data-color-id="color5" data-id="'+this.MAIN_BUTTONS.COLOR+'" tabindex="-1" role="button" aria-pressed="false"><div class="color5 color-shape c-picker"></div></td>\n\t\t\t\t\t<td title="'+A.color6.title+'" aria-label="'+A.color6.title+'" class="drawpad-default draw-tool-color" data-color-id="color6" data-id="'+this.MAIN_BUTTONS.COLOR+'" tabindex="-1" role="button" aria-pressed="false"><div class="color6 color-shape c-picker"></div></td>\n\t\t\t\t</tr></table>\n\t\t\t</div>'),a("stamp"),a("shape"),e.append('<li title="'+this.labelOpts.text+'" aria-label="'+this.labelOpts.text+'" class="drawpad-default drawpad-tool-text sprite" data-id="'+this.MAIN_BUTTONS.TEXT+'" tabindex="0" role="button"><div class="ic-dp-text sprite" data-icon="ic-dp-text"></div></li>'),e.append('<li title="'+this.labelOpts.shape+'" aria-label="'+this.labelOpts.shape+'" class="drawpad-default drawpad-tool-shape sprite" data-id="'+this.MAIN_BUTTONS.SHAPE+'" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false"><div class="ic-dp-shape sprite" data-icon="ic-dp-shape"></div></li>');var B="attacher_"+Math.floor(1e7*Math.random());e.append('<li title="'+this.labelOpts.attach+'" class="drawpad-default allow-event-default drawpad-tool-attach sprite" data-id="'+this.MAIN_BUTTONS.ATTACH+'">\n\t\t\t\t<label for="'+B+'" class="image-attacher-label ic-dp-attach sprite" data-icon="ic-dp-attach" aria-label="'+this.labelOpts.attach+'"></label>\n\t\t\t\t<input type="file" name="file" id="'+B+'" accept="image/*" class="image-attacher-input" aria-hidden="true" />\n\t\t\t</li>'),e.append('<hr class="undo_rule" aria-hidden="true" />'),e.append('<li title="'+this.labelOpts.clearall+'" aria-label="'+this.labelOpts.clearall+'" class="drawpad-default drawpad-tool-trash sprite disabled" data-id="'+this.MAIN_BUTTONS.TRASH+'" tabindex="0" role="button" aria-disabled="true"><div class="nopressed ic-dp-trash sprite ic-dp-trash-disabled" data-icon="ic-dp-trash"></div></li>'),this._addEvents(),this.noDraw&&d.find("li[data-id="+this.MAIN_BUTTONS.PEN_PRIMARY+"], li[data-id="+this.MAIN_BUTTONS.ERASE+"], li[data-id="+this.MAIN_BUTTONS.STAMP+"], li[data-id="+this.MAIN_BUTTONS.UNDO+"], li[data-id="+this.MAIN_BUTTONS.REDO+"], .text_rule, #scratchCanvas, #drawPadCanvas").remove(),this.setCurrentTool(this.TOOLS.CURSOR),$(".drawpad-clear-textarea").on("keyup mouseup click",function(a){var c=$(a.currentTarget);!$.trim(c.text())&&b.browser.isFirefox()&&(c.empty(),c.html("&nbsp;"))}),k.forEach(function(a){var c=$("#"+a),d=$("#text_primary_menu"+a).find(".text-style");c.on("keyup click",function(){d.each(function(a,c){return b.updateStyleButtonState($(c))})})}),d.append('<label class="hidden-label status-title" role="status" aria-live="assertive"></label>')}},{key:"getTextBoxstyling",value:function(){return'\n\t\t\t<div class="drawpad-default hackclass keep-selection text-style ic-dp-bold sprite" tabindex="0" role="button" aria-pressed="false" aria-label="'+this.labelOpts.bold+'" data-icon="ic-dp-bold" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_BOLD+'" title="'+this.labelOpts.bold+'"></div>\n\t\t\t<div class="drawpad-default hackclass keep-selection text-style ic-dp-italic sprite" tabindex="0" role="button" aria-pressed="false" aria-label="'+this.labelOpts.italic+'" data-icon="ic-dp-italic" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_ITALIC+'" title="'+this.labelOpts.italic+'"></div>\n\t\t\t<div class="drawpad-default hackclass keep-selection text-style ic-dp-underline sprite" tabindex="0" role="button" aria-pressed="false" aria-label="'+this.labelOpts.underline+'" data-icon="ic-dp-underline" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_UNDERLINE+'" title="'+this.labelOpts.underline+'"></div>\n\t\t'}},{key:"updateStyleButtonState",value:function(a){var b=a.attr("data-icon").replace("ic-dp-",""),c=document.queryCommandState(b),d="true"===c||!0===c;a.toggleClass("button-clicked-wrapper",d),a.attr("aria-pressed",d)}},{key:"buildColorConfig",value:function(){var a=this,b=void 0,c=void 0,d=void 0,e=$('<div class="color-config-container"></div>').appendTo(this.jObject),f=$('<div class="pen-color-config-container"></div>').appendTo(e),g=$('<div class="text-color-config-container"></div>').appendTo(e),h=[{container:f,colorConfig:this.colorConfig.penColors},{container:g,colorConfig:this.colorConfig.textColors}],i=$('<span class="color-config-item"></span>').appendTo(f),j=i.css("background-color");h.forEach(function(e){for(var f=1;f<=6;f++)b=i.clone(),b.appendTo(e.container),b.addClass("color"+f),(c=b.css("background-color"))!==j&&(e.colorConfig["color"+f].color=c,(d=a.getCssJson(b,"list-style-image",!0))&&PearsonGL.utils.isNonEmptyString(d.colorTitle)&&(e.colorConfig["color"+f].title=d.colorTitle))})}},{key:"getCssJson",value:function(a,b,c){try{var d=$(a).css(b);if("string"==typeof d&&/^url/.test(d)){var e=d.replace(/.*,/,"");e=e.replace(/^[\)"']*/,"").replace(/[\)"']*$/,"");var f=decodeURIComponent(e);return c?JSON.parse(f):f}return null}catch(a){return console.log("Unable to parse JSON from CSS: "+a),null}}},{key:"handleWindowResize",value:function(){var a=this,b=this.jObject,c=$(window).width(),d=$(window).height(),e=this.oldWindowWidth/2,f=c/2;if(!this.isResizing&&0!==d&&0!==b.height()){if(this.options.backgroundImage.noResize)return this.inlineMode?this.rightAlignToolbar&&b.find(".drawpad-toolbar-wrapper").css({right:0,left:"auto",top:0}):b.find(".draggable-text, .draggable-shape").each(function(a,b){b=$(b);var c=b.position(),d=f-(e-c.left);b.css({left:d})}),void(this.oldWindowWidth=c);var g=new Image,h=this.canvas.toDataURL("image/png");if(g.src=h,b.find(".invisible-text-color-picker-menu").hide(),this.backgroundTypeDrawpad){var i=this.bgScale;if(this.inlineMode){var j=b.width()-this.leftGutter-this.rightGutter;this.bgScale=j/this.options.backgroundImage.width,this.bgCurrentWidth=j,this.bgCurrentHeight=this.options.backgroundImage.height*this.bgScale,this.options.backgroundImage.noResize||b.height(this.bgCurrentHeight)}else this.bgScale=d/this.options.backgroundImage.height,this.bgCurrentWidth=this.options.backgroundImage.width*this.bgScale,this.bgCurrentHeight=d;this.bgCurrentWidth=parseInt(this.bgCurrentWidth,10),this.bgCurrentHeight=parseInt(this.bgCurrentHeight,10);var k=this.bgScale/i;this.canvas.width=this.bgCurrentWidth,this.canvas.height=this.bgCurrentHeight,this.scratchCanvas.width=this.bgCurrentWidth,this.scratchCanvas.height=this.bgCurrentHeight,b.find(".background-image img").css({width:this.bgCurrentWidth,height:this.bgCurrentHeight}),this.inlineMode?this.rightAlignToolbar&&b.find(".drawpad-toolbar-wrapper").css({right:0,left:"auto",top:0}):($(".main").height(this.bgCurrentHeight),b.find("canvas, .background-image, .invisible-inputs").css({marginLeft:-1*this.bgCurrentWidth*.5}),b.find(".drawpad-toolbar-wrapper").css({top:this.options.notCenterTools?"30px":.5*(d-408)+"px"})),this.jObject.find(".stamp-floating-cursor").width(this.stampConfig.imageWidth*this.bgScale),this.jObject.find(".draggable-shape").each(function(a,b){b=$(b),b.width(b.width()*k),b.height(b.height()*k)}),b.find(".draggable-text, .draggable-shape").each(function(b,c){c=$(c);var d,g=c.position(),h=g.top*k;d=a.inlineMode?g.left*k:f-(e-g.left)*k,c.css({left:d,top:h})}),b.find(".invisible-inputs .rich-input-type").each(function(b,c){c=$(c);var d=c.data("origCoords");c.css({left:a.bgScale*d.x+a.leftGutter,top:a.bgScale*d.y,width:a.bgScale*d.width,height:a.bgScale*d.height})}),$(g).load(function(){a.clearCanvases(),a.ctx.drawImage(g,0,0,a.bgCurrentWidth,a.bgCurrentHeight)})}else{var l=this.inlineMode?b.width()-this.leftGutter-this.rightGutter:$(window).width(),m=this.inlineMode?b.height():$(window).height();this.canvas.width=l,this.scratchCanvas.width=l,this.inlineMode||(this.canvas.height=m,this.scratchCanvas.height=m),$(g).load(function(){a.clearCanvases(),a.ctx.drawImage(g,0,0)})}this.drawOptionsMap[this.currentTool]&&this._setContextAttributes(this.drawOptionsMap[this.currentTool]),this.oldWindowWidth=c}}},{key:"gadgetPageShowEvent",value:function(){this.initialGadgetView&&this.handleWindowResize(),this.initialGadgetView=!0}},{key:"_addEvents",value:function(){var a=this,b=this,c=this.jObject;c.find(c.find("canvas")).on("mousedown mousemove mouseup touchstart touchmove touchend mouseout",function(a){a.preventDefault();var c=a.originalEvent;switch(a.type){case"touchstart":b._mouseDownAction(c);break;case"mousedown":b._mouseDownAction(a);break;case"mousemove":b._mouseMoveAction(a);break;case"touchmove":b._mouseMoveAction(c);break;case"mouseup":b._mouseUpAction(a,!0),b.jObject.find(".drawpad-save").sliderbutton("enable");break;case"touchend":b._mouseUpAction(c,!0),b.jObject.find(".drawpad-save").sliderbutton("enable");break;case"mouseout":b._mouseUpAction(c,!0)}}),c.find(".drawpad-brush-slider").slider({value:4,max:35,min:1,step:1,stop:function(a,c){var d=b.drawOptionsMap[b.currentTool];d.width=c.value,b._setContextAttributes(d),b.sendAnalytics("selected_pen_size_"+c.value)},slide:function(a,c){var d=b.drawOptionsMap[b.currentTool];d.width=c.value;var e=.5*d.width*-1-2;b.jObject.find(".drawpad-color-changer").css({width:d.width,height:d.width,marginLeft:e+"px",marginTop:e+"px"}),b.currentTool===b.TOOLS.PEN||b.currentTool===b.TOOLS.LINE?$(c.handle).attr("aria-label",b.labelOpts.penWidth+" "+Math.round(c.value)):b.currentTool===b.TOOLS.ERASE&&$(c.handle).attr("aria-label",b.labelOpts.eraserWidth+" "+Math.round(c.value))}}),c.find(".drawpad-brush-slider .ui-slider-handle").attr({role:"slider",tabindex:"-1"}),c.find(".drawpad-toolbar-wrapper").draggable({handle:".drawpad-toobar-handle",containment:"#"+c.attr("id"),axis:!!this.inlineMode&&"y",start:function(a,c){b.sendAnalytics("clicked_drag_toolbar"),b._closeMenus(),PearsonGL.utils.suppressIframeEvents(!0)},stop:function(a,b){PearsonGL.utils.suppressIframeEvents(!1)}}),this.inlineMode?c.find(".drawpad-toolbar-wrapper").css({top:"0"}):c.find(".drawpad-toolbar-wrapper").css({top:b.options.notCenterTools?"30px":.5*($(window).height()-408)+"px"}),this._attachGenericButtonEvents(),c.closest("#main-id").on("blur",function(b){setTimeout(function(){var b=c.find(".drawpad-tool-type");if(document.activeElement===b[0]){var d="true"===b.attr("aria-pressed");a.jObject.find(".hidden-label").text(d?a.labelOpts.typePressed:a.labelOpts.typeNotPressed)}},0)}),c.find(".drawpad-tool-type").blur(function(){a.jObject.find(".hidden-label").text("")}),c.find(".ui-slider-handle").keyup(function(){PearsonGL.utils.focusItemOn(this)}).blur(function(){PearsonGL.utils.focusItemOff(this)}),c.find(".drawpad-default").keyup(function(a){if(9===a.keyCode&&$(this).attr("class").indexOf("disable")<0){var b=$(window).height(),d=$(c).offset();window.scroll(0,d.top-b+$(c).height()+50),PearsonGL.utils.focusItemOn(this)}}).focus(function(){PearsonGL.utils.focusItemOn(this)}).blur(function(){PearsonGL.utils.focusItemOff(this)});var d=c.find(".image-attacher-input");d.on("change",function(a){if(this.files&&this.files[0]){var c=new FileReader;c.onload=function(a){var c=new Image;c.onload=function(){var c=this.naturalWidth,e=this.naturalHeight,f=300;if(c>f||e>f){var g=c/e,h=c>e;c=h?f:f*g,e=h?f/g:f}b._buildShapeBox(a.target.result,!0,null,null,c,e,b.labelOpts.image,!0),d.val(""),b.setCurrentTool(b.TOOLS.CURSOR)},c.src=a.target.result},b.setUserHasInteracted(),c.readAsDataURL(this.files[0])}}),d.on("focus",function(b){a.jObject.find(".hidden-label").text(a.labelOpts.attach)}),c.find("canvas").mousedown(function(a){b._closeMenus()}),c.find(".text-canvas").on("mousedown touchstart",function(a){b._closeMenus()}),this.resizeCallbackTimeoutId=null,$(window).on("resize.drawpad",function(){clearTimeout(a.resizeCallbackTimeoutId),a.resizeCallbackTimeoutId=setTimeout(a.handleWindowResize.bind(a),200)}),$(window).on("orientationchange",function(){b._closeMenus()}),$(window).on("keypadPress",function(b){var c=PearsonGL.utils.getActiveInputField(),d=a.mathquillMap[a.currentTextEditor],e=!PearsonGL.utils.isTouch();c instanceof jQuery&&c.attr("id")===a.currentTextEditor&&d&&d.onKeypressed(b.keyVal,e)}),c.find(".drawpad-shape-picker-primary-menu, .drawpad-shape-picker-sub-menu").focusout(function(a){setTimeout(function(){var a=$(document.activeElement);0===a.closest(".drawpad-shape-picker-primary-menu").length&&0===a.closest(".drawpad-shape-picker-sub-menu").length&&b._closeMenus()},0)}),c.find(".grid-menu").on("keydown",".drawpad-default",function(a){var d,e,f,g,h,i,j=!1,k=a.keyCode===PearsonGL.utils.keyCode.up,l=a.keyCode===PearsonGL.utils.keyCode.right,m=$(this),n=m.closest(".drawpad-picker-row"),o=n.find(".drawpad-default").filter(":visible"),p=$.inArray(m[0],o);switch(a.keyCode){case PearsonGL.utils.keyCode.up:case PearsonGL.utils.keyCode.down:d=m.closest(".grid-menu").find(".drawpad-picker-row"),d=d.filter(function(a,b){return $(b).find(".drawpad-default").filter(":visible").length>0}),f=$.inArray(n[0],d),k?(g=f-1)<0&&(g=d.length-1):g=(f+1)%d.length,h=$(d[g]),i=h.find(".drawpad-default").filter(":visible"),e=Math.min(p,i.length-1),i[e].focus(),j=!0;break;case PearsonGL.utils.keyCode.right:case PearsonGL.utils.keyCode.left:l?e=(p+1)%o.length:(e=p-1)<0&&(e=o.length-1),o[e].focus(),j=!0;break;case PearsonGL.utils.keyCode.tab:m.hasClass("drawpad-shape-item")?c.find(".drawpad-tool-shape")[0].focus():m.hasClass("drawpad-stamp-item")&&c.find(".drawpad-tool-stamp")[0].focus(),b._closeMenus();break;case PearsonGL.utils.keyCode.escape:b._closeMenus(),b.setCurrentTool(b.TOOLS.CURSOR)}if(j)return!1}),c.find(".drawpad-color-picker").on("keydown",".draw-tool-color, .drawpad-tool-pen, .drawpad-tool-line, .ui-slider-handle",function(a){var d,e=c.find(".drawpad-color-picker"),f=e.find(".draw-tool-color"),g=e.find(".drawpad-brush-slider"),h=$.inArray(document.activeElement,f),i=!1,j=a.keyCode===PearsonGL.utils.keyCode.up,k=a.keyCode===PearsonGL.utils.keyCode.right;switch(a.keyCode){case PearsonGL.utils.keyCode.up:case PearsonGL.utils.keyCode.down:if(b.currentTool===b.TOOLS.PEN||b.currentTool===b.TOOLS.LINE){if(h>=0)e.find(b.currentDrawTool===b.TOOLS.PEN?".drawpad-tool-pen":".drawpad-tool-line")[0].focus();else{if(document.activeElement===e.find(".ui-slider-handle")[0]){var l=g.slider("value"),m=g.slider("option","step"),n=l+(j?-1*m:m);j?l!==g.slider("option","max")&&g.slider("value",n):l!==g.slider("option","min")&&g.slider("value",n)}b._selectPickerColor(b.drawOptionsMap[b.currentDrawTool].colorId)}i=!0}break;case PearsonGL.utils.keyCode.left:case PearsonGL.utils.keyCode.right:b.currentTool!==b.TOOLS.PEN&&b.currentTool!==b.TOOLS.LINE||(h>=0?(k?d=(h+1)%f.length:(d=h-1)<0&&(d=f.length-1),b._fireButtonEvent($(f[d])),f[d].focus(),i=!0):document.activeElement===e.find(".drawpad-tool-pen")[0]?(e.find(k?".drawpad-tool-line":".ui-slider-handle")[0].focus(),i=!0):document.activeElement===e.find(".drawpad-tool-line")[0]&&(e.find(k?".ui-slider-handle":".drawpad-tool-pen")[0].focus(),i=!0));break;case PearsonGL.utils.keyCode.tab:b.currentTool===b.TOOLS.PEN||b.currentTool===b.TOOLS.LINE?c.find(".drawpad-tool-draw-primary")[0].focus():b.currentTool===b.TOOLS.ERASE&&c.find(".drawpad-tool-erase")[0].focus(),b._closeMenus()}if(i)return!1}),$(document).on("keydown",function(a){a.keyCode===PearsonGL.utils.keyCode.escape&&b.clearActiveUI()})}},{key:"_attachGenericButtonEvents",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.jObject;this.currentTextEditor="",b.find(".drawpad-default").not(".drawpad-tool-attach").on("keydown",function(a){if(a.keyCode===PearsonGL.utils.keyCode.enter||a.keyCode===PearsonGL.utils.keyCode.space)return!1}),b.find(".drawpad-default").off("mouseup touchend keyup").on("blur focus keyup mousedown mouseout mouseover mouseup touchstart touchend",function(b){var c=b.originalEvent,d=$(b.currentTarget);d.hasClass("allow-event-default")||b.preventDefault();var e=!d.hasClass("disabled"),f=d.closest(".drawpad-toolbar-wrapper").length>0;switch(b.type){case"keyup":c.keyCode!==PearsonGL.utils.keyCode.enter&&c.keyCode!==PearsonGL.utils.keyCode.space||!e||(d.removeClass("drawpad-default-button-down"),f?a._handleMainToolbarButtonActivation.call(a,d,!0):a._fireButtonEvent(d));break;case"mousedown":case"touchstart":e&&d.addClass("drawpad-default-button-down");break;case"mouseout":d.removeClass("drawpad-default-button-over drawpad-default-button-down");break;case"mouseover":d.addClass("drawpad-default-button-over");break;case"mouseup":case"touchend":if(e){if(d.data("suppressed"))return;d.removeClass("drawpad-default-button-down"),f?a._handleMainToolbarButtonActivation.call(a,d):a._fireButtonEvent(d),d.data("suppressed",!0),setTimeout(function(){d.data("suppressed",!1)},5)}break;case"blur":PearsonGL.utils.focusItemOff(d);break;case"focus":PearsonGL.utils.focusItemOn(d)}})}},{key:"handleTextBoxBlur",value:function(a){var b=this;setTimeout(function(){var a=$(document.activeElement),c=a.closest(".rich-input-type").length>0,d=a.closest(".invisible-text-color-picker-menu").length>0,e=a.closest(".draggable-text").length>0,f=a.closest(b.keypadGadget).length>0;c||d||e||f||b._hideTypeBox()},0)}},{key:"_handleMainToolbarButtonActivation",value:function(a,b){var c=this,d=this,e=this.jObject,f=parseInt(a.attr("data-id"),10),g=e.find(".drawpad-toolbar-wrapper"),h=void 0,i=void 0,j=void 0,k=void 0;switch(f){case this.MAIN_BUTTONS.CURSOR:this._closeMenus(),this.setCurrentTool(this.TOOLS.CURSOR);break;case this.MAIN_BUTTONS.PEN_PRIMARY:h=e.find(".drawpad-color-picker"),this._closeMenus(),this.setBrushMenuMode(this.currentDrawTool),this.updateDrawingMenu(this.currentDrawTool),h.addClass("open-color-picker"),h.show(),h.find(this.currentDrawTool===this.TOOLS.PEN?".drawpad-tool-pen":".drawpad-tool-line")[0].focus(),this._setPopupLocation(h,null,a,!1),this.setCurrentTool(this.currentDrawTool),this._iosHackForInputs(),a.attr("aria-expanded","true");break;case this.MAIN_BUTTONS.PEN:this.sendAnalytics("clicked_curved_line_tool"),this.setCurrentTool(this.TOOLS.PEN),this.updateDrawingMenu(this.TOOLS.PEN);break;case this.MAIN_BUTTONS.LINE:this.sendAnalytics("clicked_straight_line_tool"),this.setCurrentTool(this.TOOLS.LINE),this.updateDrawingMenu(this.TOOLS.LINE);break;case this.MAIN_BUTTONS.ERASE:h=e.find(".drawpad-color-picker"),this._closeMenus(),this.setBrushMenuMode(this.TOOLS.ERASE),this.updateDrawingMenu(this.TOOLS.ERASE),h.addClass("open-color-picker"),h.show(),h.find(".ui-slider-handle")[0].focus(),this._setPopupLocation(h,null,a,!1),this.setCurrentTool(this.TOOLS.ERASE),this._iosHackForInputs(),a.attr("aria-expanded","true");break;case this.MAIN_BUTTONS.COLOR:var l=a.attr("data-color-id");this.drawOptionsMap[this.currentDrawTool].colorId=l,this.updateDrawingMenu(this.currentDrawTool),this._setContextAttributes(this.drawOptionsMap[this.currentTool]);break;case this.MAIN_BUTTONS.UNDO:this.sendAnalytics("clicked_undo_count_"+ ++this.undoCount),this._undoDrawing(),this.updateUndoRedoButtonState(),this._unlockTrash(),this.jObject.find(".hidden-label").text(this.labelOpts.undoClicked);break;case this.MAIN_BUTTONS.REDO:this.sendAnalytics("clicked_redo_count_"+ ++this.redoCount),this._redoDrawing(),this.updateUndoRedoButtonState(),this._unlockTrash(),this.jObject.find(".hidden-label").text(this.labelOpts.redoClicked);break;case this.MAIN_BUTTONS.TEXT:this.sendAnalytics("clicked_text_box"),this.setUserHasInteracted(),this._closeMenus(),this.setCurrentTool(this.TOOLS.CURSOR),this._createTextBox();break;case this.MAIN_BUTTONS.SHAPE:case this.MAIN_BUTTONS.STAMP:j=f===this.MAIN_BUTTONS.SHAPE,k=j?"shape":"stamp",this._closeMenus(),j?(g.find(".drawpad-default").not(".draw-tool-color").removeClass("button-clicked-wrapper"),g.find(".drawpad-tool-shape").addClass("clicked")):this.setCurrentTool(this.TOOLS.STAMP),h=e.find(".drawpad-"+k+"-picker-primary-menu"),h.data("titlesInitialized")||setTimeout(function(){h.data("titlesInitialized",!0),h.find(".drawpad-"+k+"-item").filter(":visible").each(function(a,b){b=$(b);var d=c.getCssJson(b,"list-style-image",!0);d&&b.attr({title:d.title,"aria-label":d.title,"aria-haspopup":!d.file})})},0),h.addClass("open-"+k+"-picker").show(),h.find(".drawpad-default").filter(":visible").first().focus(),this._setPopupLocation(h,null,a,!0),this._iosHackForInputs(),a.attr("aria-expanded","true");break;case this.MAIN_BUTTONS.SHAPE_ITEM:case this.MAIN_BUTTONS.STAMP_ITEM:j=f===this.MAIN_BUTTONS.SHAPE_ITEM,k=j?"shape":"stamp";var m=a.closest(".drawpad-"+k+"-picker-primary-menu").length>0,n=this.getCssJson(a,"list-style-image",!0);if(n)if(n.file)this._closeMenus(),j?(this.setUserHasInteracted(),this._buildShapeBox(n.file,n.preserveAspectRatio,null,null,null,null,n.title,!1),this.setCurrentTool(this.TOOLS.CURSOR)):this._loadStampImage(n.file);else if(m){var o=a.attr("data-"+k+"-category-id");i=e.find(".drawpad-"+k+"-picker-primary-menu"),h=e.find(".drawpad-"+k+"-picker-sub-menu"),h.addClass("open-"+k+"-picker").show(),i.find(".drawpad-"+k+"-item").removeClass("button-clicked-wrapper").attr("aria-expanded","false"),a.addClass("button-clicked-wrapper"),a.attr("aria-expanded","true"),h.find(".drawpad-"+k+"-item").each(function(a,b){b=$(b);var c=b.attr("data-"+k+"-id").replace(/^s\d+/,"s"+o);b.attr("data-"+k+"-id",c),b.removeAttr("title")}),h.find(".drawpad-default").filter(":visible").first().focus(),setTimeout(function(){i.data("titlesInitialized",!0),h.find(".drawpad-"+k+"-item").filter(":visible").each(function(a,b){b=$(b);var d=c.getCssJson(b,"list-style-image",!0);d&&b.attr({title:d.title,"aria-label":d.title})})},0),this._setPopupLocation(h,i,a,!0),this._iosHackForInputs()}else console.log("Error: unable to open "+k+" data");else console.log("Error: unable to parse "+k+" data");break;case this.MAIN_BUTTONS.TRASH:var p=PearsonGL.utils.isNonEmptyString(this.currentTextEditor)&&$("#"+this.currentTextEditor)[0]===document.activeElement;this.sendAnalytics("clicked_clear_count_"+ ++this.clearCount),this._closeMenus(),this._confirm(this.labelOpts.deleteAll,function(){$(".draggable-text").remove(),d.options.mathquill?$(".rich-input-type").each(function(a,b){var c=$(b).attr("id"),e=d.mathquillMap[c];e&&e.clear()}):$(".rich-input-type").text(""),d.mathData={},d._hideTypeBox(),d.clearCanvases(),d._reset(),e.find(".confirm-delete-dialog,.confirm-modal").remove(),d._lockTrash(),d.jObject.find(".drawpad-save").sliderbutton("enable"),d.lastUserTextBox=null,d.shouldSaveImage=!1,d.isDirty=!0,d.setCurrentTool(d.TOOLS.CURSOR),d.jObject.find(".hidden-label").text(d.labelOpts.allDeleted),d.jObject.find(".drawpad-tool-type").focus()},function(){p&&$("#"+d.currentTextEditor).focus()});break;case this.MAIN_BUTTONS.ATTACH:this.sendAnalytics("clicked_insert_image");break;default:console.log("unknown button type")}}},{key:"_fireButtonEvent",value:function(a){var b=this.jObject;b.find(".draw-tool-color").removeClass("button-clicked-wrapper"),a.hasClass("draw-tool-color")||a.hasClass("keep-selection")||b.find(".drawpad-default:not(.text-size)").removeClass("button-clicked-wrapper"),a.find("div").hasClass("nopressed")||a.hasClass("text-style")?a.hasClass("text-style")&&a.toggleClass("button-clicked-wrapper"):a.find("div").parent().addClass("button-clicked-wrapper"),this._fireButtonEvents(parseInt(a.attr("data-id")),a[0])}},{key:"_fireButtonEvents",value:function(a,b){var c,d=this,e=this.jObject,f=document.getElementById(this.currentTextEditor);switch(a){case this.TEXT_BOX_BUTTONS.PICKED_MATH:var g,h=$(b).find(".m-picker").attr("data-symbol"),i=$("#"+this.currentTextEditor),j=document.activeElement,k=i[0]===document.activeElement,l=PearsonGL.utils.randomString(9);if(!k){i.focus();var m=i.text().split("").length;d.setSelectionRange(i[0],m,m)}this.textColor.indexOf("rgb")>-1&&(this.textColor=PearsonGL.utils.rgbColorToHex(d.textColor)),document.execCommand("insertImage",0,"data:text/plain;,"+h),w=$(f).data("fontsize")?2*$(f).data("fontsize"):4,g=w?" size='"+parseInt(w,10)+"'":"",i.find("img").replaceWith('<font id="'+l+'" '+g+' color="'+(this.textColor.indexOf("#")>-1?this.textColor:"#"+this.textColor)+'">'+h+this.constants.MATH_SYMBOL+"</font>");var n=i.text(),o=0,p=n.split("");for(v=0;v<p.length;v++)if(n[v]===this.constants.MATH_SYMBOL){o=v;break}var q=i.html().replace(this.constants.MATH_SYMBOL,""),r="IEOld";if(i.html(q),void 0!==window.getSelection){var s=window.getSelection(),t=document.createRange();t.selectNodeContents(document.getElementById(l)),s.removeAllRanges(),s.addRange(t)}else void 0!==document.body.createTextRange&&(r=document.body.createTextRange(),r.moveToElementText(document.getElementById(l)));var u=["bold","italic","underline"];$.each(u,function(a,b){$(".drag-handle").not(".noBg").find(".ic-dp-"+b).hasClass("button-clicked-wrapper")?document.queryCommandState(b)||("IEOld"!=r?r.execCommand(b):document.execCommand(b)):document.queryCommandState(b)&&("IEOld"!=r?r.execCommand(b):document.execCommand(b))}),d.setSelectionRange(document.getElementById(this.currentTextEditor),o,o),PearsonGL.globals.browserData&&PearsonGL.globals.browserData.specialFlags.isiOS&&(e.find(".editable-content-wrapper").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide"),e.find(".text-math-picker-menu-wrapper").hide()),this._unlockTrash(),k||j.focus();break;case this.TEXT_BOX_BUTTONS.PICKED_FONT_S:case this.TEXT_BOX_BUTTONS.PICKED_FONT_M:case this.TEXT_BOX_BUTTONS.PICKED_FONT_L:var v,w=5;switch($(b).nextAll().removeClass("button-clicked-wrapper").attr("aria-pressed","false"),$(b).prevAll().removeClass("button-clicked-wrapper").attr("aria-pressed","false"),$(b).attr("aria-pressed","true"),a){case this.TEXT_BOX_BUTTONS.PICKED_FONT_S:w="1";break;case this.TEXT_BOX_BUTTONS.PICKED_FONT_M:w="2";break;case this.TEXT_BOX_BUTTONS.PICKED_FONT_L:w="3"}f=document.getElementById(this.currentTextEditor),$(f).data("fontsize",w),d.restoreSelection(this.savedRange),document.execCommand("fontSize",!1,2*w),document.activeElement!==f[0]&&f.focus(),d.saveRange(),d._iosHackForInputs(),d.hideTextBoxSubmenus(),this._unlockTrash();break;case this.TEXT_BOX_BUTTONS.TEXT_COLOR:this.sendAnalytics("clicked_text_box_color"),c=$(b).closest(".drag-handle").attr("id"),$(b).focus(),this.toggleTextColorMenu(c.replace(/menu_/,""));break;case this.TEXT_BOX_BUTTONS.TEXT_EQUATION:this.sendAnalytics("clicked_equation_editor"),this.equationEditorLaunch();break;case this.TEXT_BOX_BUTTONS.TEXT_MATH:c=$(b).closest(".drag-handle").attr("id"),$(b).focus(),this.toggleTextMathMenu(c.replace(/menu_/,""));break;case this.TEXT_BOX_BUTTONS.TEXT_KEYPAD:$(window).trigger("inputFocus",{varType:"string"});break;case this.TEXT_BOX_BUTTONS.TEXT_SIZE:this.sendAnalytics("clicked_text_box_text_size"),c=$(b).closest(".drag-handle").attr("id"),$(b).focus(),this.toggleTextSizeMenu(c.replace(/menu_/,""));break;case this.TEXT_BOX_BUTTONS.TEXT_TRASH:this.sendAnalytics("clicked_text_box_clear"),this.removeTextBox($(b).closest(".draggable-text"));break;case this.TEXT_BOX_BUTTONS.TEXT_BOLD:this.sendAnalytics("clicked_text_bold"),f=$("#"+this.currentTextEditor),document.execCommand("bold",!1,null),this.updateStyleButtonState($(b)),this.saveRange(),f.keyup(function(a){d.browser.isIE()&&f.find("font").removeAttr("face")});break;case this.TEXT_BOX_BUTTONS.TEXT_ITALIC:this.sendAnalytics("clicked_text_italic"),document.execCommand("italic",!1,null),this.saveRange(),this.updateStyleButtonState($(b));break;case this.TEXT_BOX_BUTTONS.TEXT_UNDERLINE:this.sendAnalytics("clicked_text_underline"),document.execCommand("underline",!1,null),this.saveRange(),this.updateStyleButtonState($(b))}}},{key:"_mouseDownAction",value:function(a){this.options.redoHistory=[],this.okToDraw=!0,this.shouldSaveImage=!0,PearsonGL.globals.player.addAutosaveLock(this);var b=this._getCoords(a);if(this._unlockTrash(),this._closeMenus(),this.currentTool===this.TOOLS.PEN)this.clearScreenOnDraw?(this.ctx.beginPath(),this.ctx.moveTo(b.x,b.y)):this.points.push(b),this.sendAnalytics("drew_pen_size_"+this.drawOptionsMap[this.currentTool].width);else if(this.currentTool===this.TOOLS.LINE)this.org_coords.x=b.x,this.org_coords.y=b.y;else if(this.currentTool===this.TOOLS.STAMP){var c=this.jObject.find(".stamp-floating-cursor"),d=this.jObject.find("canvas").offset(),e=this.jObject.offset();b=this._getCoords(a),c.css({left:b.x+d.left-e.left-this.stampConfig.imageWidth*this.bgScale/2,top:b.y-this.stampConfig.imageHeight*this.bgScale/2,display:"block"}),c.data("stampStartTime",Date.now()),c.data("doStampOffset",!1)}else this.ctx.drawImage(this.scratchCanvas,0,0),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.moveTo(b.x,b.y)}},{key:"_mouseMoveAction",value:function(a){if(this.currentTool===this.TOOLS.STAMP){var b=this.jObject.find(".stamp-floating-cursor"),c=this.jObject.find("canvas").offset(),d=this.jObject.offset(),e=this._getCoords(a),f=e.y-this.stampConfig.imageHeight*this.bgScale/2;if("touchmove"===a.type)if(b.data("doStampOffset"))f-=30;else{var g=b.data("stampStartTime");g&&g<Date.now()-100?(b.data("doStampOffset",!0),f-=30):g||(b.data("stampStartTime",Data.now()),b.data("doStampOffset",!1))}b.css({left:e.x+c.left-d.left-this.stampConfig.imageWidth*this.bgScale/2,top:f,display:"block"})}else if(this.okToDraw){var h=this._getCoords(a);this.scratchCtx.clearRect(0,0,this.scratchCanvas.width,this.scratchCanvas.height),this.currentTool===this.TOOLS.PEN?this.clearScreenOnDraw?(this.ctx.lineTo(h.x,h.y),this.ctx.stroke()):(this.points.push(h),this._drawPoints()):this.currentTool===this.TOOLS.LINE?(this.scratchCtx.beginPath(),this.scratchCtx.moveTo(this.org_coords.x,this.org_coords.y),this.scratchCtx.lineTo(h.x,h.y),this.scratchCtx.stroke(),this.scratchCtx.closePath()):(this.ctx.lineTo(h.x,h.y),this.ctx.stroke())}}},{key:"_mouseUpAction",value:function(a,b){if(this.okToDraw){if(this.okToDraw=!1,this.setUserHasInteracted(),PearsonGL.globals.player.removeAutosaveLock(this),this.currentTool===this.TOOLS.PEN)this.clearScreenOnDraw||(this.scratchCtx.closePath(),this._updateViewingCanvas());else if(this.currentTool===this.TOOLS.LINE){var c=this._getCoords(a);this.ctx.beginPath(),this.ctx.moveTo(this.org_coords.x,this.org_coords.y),this.ctx.lineTo(c.x,c.y),this.ctx.stroke(),this.ctx.closePath()}else if(this.currentTool===this.TOOLS.STAMP){var d=this.jObject.find(".stamp-floating-cursor");if("mouseup"===a.type||"touchend"===a.type){var e=this._getCoords(a),f=e.x-this.stampConfig.imageWidth*this.bgScale/2,g=e.y-this.stampConfig.imageHeight*this.bgScale/2-(d.data("doStampOffset")?30:0);d.data("doStampOffset",!1),d.data("stampStartTime",null),this.ctx.drawImage(d[0],f,g,this.stampConfig.imageWidth*this.bgScale,this.stampConfig.imageHeight*this.bgScale)}"mouseout"!==a.type&&"touchend"!==a.type||d.hide()}else this.ctx.closePath();this.points=[],b&&this.options.undoHistory.push(this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)),this.options.undoHistory.length>this.options.ALLOWED_UNDOS&&(this.lastUndo=this.options.undoHistory.shift()),this.clearScreenOnDraw&&this.currentTool!==this.TOOLS.LINE||this.scratchCtx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalCompositeOperation="source-over",this.updateUndoRedoButtonState()}else this.currentTool===this.TOOLS.STAMP&&"mouseout"===a.type&&this.jObject.find(".stamp-floating-cursor").hide()}},{key:"_drawPoints",value:function(){var a=void 0;if(!(this.points.length<3)){this.scratchCtx.beginPath(),this.scratchCtx.moveTo(this.points[0].x,this.points[0].y);var b=this.points.length-2;for(a=1;a<b;a++){var c=(this.points[a].x+this.points[a+1].x)/2,d=(this.points[a].y+this.points[a+1].y)/2;this.scratchCtx.quadraticCurveTo(this.points[a].x,this.points[a].y,c,d)}this.scratchCtx.quadraticCurveTo(this.points[a].x,this.points[a].y,this.points[a+1].x,this.points[a+1].y),this.scratchCtx.stroke()}}},{key:"_updateViewingCanvas",value:function(){this.ctx.drawImage(this.scratchCanvas,0,0)}},{key:"clearCanvases",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.scratchCtx.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"_redoDrawing",value:function(){if(this.options.redoHistory.length>0){var a=this.options.redoHistory.pop();this.options.undoHistory.push(a),this._doRedraw(a)}}},{key:"_undoDrawing",value:function(){var a=this.options.undoHistory.length;a>0&&(this.options.redoHistory.push(this.options.undoHistory.pop()),a=this.options.undoHistory.length,a>0?(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._doRedraw(this.options.undoHistory[a-1])):(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._doRedraw(this.lastUndo)))}},{key:"_doRedraw",value:function(a){var b=this;if(a){(a.width!==this.canvas.width||a.height!==this.canvas.height)&&this.backgroundTypeDrawpad&&!this.options.backgroundImage.noResize?this._scaleImageDataAsync(a,this.canvas.width,this.canvas.height).done(function(a){b.ctx.putImageData(a,0,0)}):this.ctx.putImageData(a,0,0)}}},{key:"_scaleImageDataAsync",value:function(a,b,c){var d=$.Deferred(),e=new Image,f=$("<canvas>").attr("width",a.width).attr("height",a.height)[0],g=f.getContext("2d");g.putImageData(a,0,0);var h=f.toDataURL("image/png");g.clearRect(0,0,f.width,f.height),f.width=b,f.height=c;var i=function(){g.drawImage(e,0,0,b,c),d.resolve(g.getImageData(0,0,f.width,f.height))};return navigator.userAgent.indexOf("MSIE")>-1?(e.src=h,i()):($(e).load(i),e.src=h),d.promise()}},{key:"setCurrentTool",value:function(a){var b=this.jObject.find(".drawpad-toolbar-wrapper");switch(a=void 0===a?a=this.currentTool:a,b.find(".drawpad-default").not(".draw-tool-color").removeClass("button-clicked-wrapper"),b.find(".drawpad-tool-shape").removeClass("clicked"),b.find(".drawpad-tool-type, .drawpad-tool-draw-primary, .drawpad-tool-erase, .drawpad-tool-stamp").attr("aria-pressed",!1),a){case this.TOOLS.CURSOR:b.find(".drawpad-tool-type").addClass("button-clicked-wrapper").attr("aria-pressed",!0);break;case this.TOOLS.PEN:b.find(".drawpad-tool-pen").addClass("button-clicked-wrapper"),b.find(".drawpad-tool-draw-primary").addClass("button-clicked-wrapper").attr("aria-pressed",!0),this._setContextAttributes(this.drawOptionsMap[this.TOOLS.PEN]);break;case this.TOOLS.LINE:b.find(".drawpad-tool-line").addClass("button-clicked-wrapper"),b.find(".drawpad-tool-draw-primary").addClass("button-clicked-wrapper").attr("aria-pressed",!0),this._setContextAttributes(this.drawOptionsMap[this.TOOLS.LINE]);break;case this.TOOLS.ERASE:b.find(".drawpad-tool-erase").addClass("button-clicked-wrapper").attr("aria-pressed",!0),this._setContextAttributes(this.drawOptionsMap[this.TOOLS.ERASE]);break;case this.TOOLS.STAMP:b.find(".drawpad-tool-stamp").addClass("button-clicked-wrapper").attr("aria-pressed",!0);break;default:return}this.currentTool=a,a!==this.TOOLS.PEN&&a!==this.TOOLS.LINE||(this.currentDrawTool=a),this.updateLayers(this.currentTool)}},{key:"updateLayers",value:function(a){var b=this.jObject,c=b.find(".editable-content-wrapper"),d=b.find("canvas"),e=b.find(".text-canvas"),f=b.find(".rich-input-type"),g=b.find(".draggable-text"),h=b.find(".draggable-shape");switch(a){case this.TOOLS.CURSOR:d.css({zIndex:this.LAYERS.LAYER_ORDER_BOTTOM}),e.css({zIndex:this.LAYERS.LAYER_ORDER_MIDDLE}),b.find(".invisible-inputs, .draggable-text, .draggable-shape").css({zIndex:this.LAYERS.LAYER_ORDER_TOP}),c.not(".rich-input-type-border").addClass("rich-input-type-border-off"),f.attr("tabindex","0"),h.attr("tabindex","0"),g.not(".active").draggable("enable"),b.find(".stamp-floating-cursor").hide(),this.setPassthrough(!0);break;case this.TOOLS.PEN:case this.TOOLS.LINE:case this.TOOLS.ERASE:case this.TOOLS.STAMP:d.css({zIndex:this.LAYERS.LAYER_ORDER_TOP}),b.find(".text-canvas, .invisible-inputs, .draggable-text, .draggable-shape").css({zIndex:this.LAYERS.LAYER_ORDER_BOTTOM}),d.toggleClass("pencil-cursor",a===this.TOOLS.PEN||a===this.TOOLS.LINE),d.toggleClass("pencil-erase",a===this.TOOLS.ERASE),d.toggleClass("stamp-cursor",a===this.TOOLS.STAMP),c.removeClass("rich-input-type-border-off"),f.attr("tabindex","-1"),h.attr("tabindex","-1"),g.draggable("disable"),a!==this.TOOLS.STAMP&&b.find(".stamp-floating-cursor").hide(),this.setPassthrough(!1),PearsonGL.globals.browserData&&PearsonGL.globals.browserData.specialFlags.isiOS&&(b[0].style.display="none",b[0].offsetHeight,b[0].style.display="")}}},{key:"_selectPickerColor",value:function(a){var b=this.jObject.find(".drawpad-color-picker"),c=b.find("[data-color-id='"+a+"']");c=c.length>0?c:b.find(".drawpad-tool-color").first(),this._fireButtonEvent(c),c[0].focus()}},{key:"_setContextAttributes",value:function(a){var b=this.colorConfig.penColors[a.colorId].color;this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=a.width,"transparent"!==b&&(this.ctx.strokeStyle=b),this.scratchCtx.lineCap=this.ctx.lineCap,this.scratchCtx.lineJoin=this.ctx.lineJoin,this.scratchCtx.strokeStyle=this.ctx.strokeStyle,this.scratchCtx.lineWidth=this.ctx.lineWidth,this.sendAnalytics("clicked_pen_color_"+a.colorId)}},{key:"_clearUndoHistory",value:function(){this.options.undoHistory.length=0,this.options.redoHistory.length=0,this.updateUndoRedoButtonState()}},{key:"updateUndoRedoButtonState",value:function(){var a=this.jObject.find(".ic-dp-undo"),b=this.jObject.find(".ic-dp-redo"),c=this.options.undoHistory.length>0,d=this.options.redoHistory.length>0;a.toggleClass("ic-dp-undo-disabled",!c),a.parent().toggleClass("disabled",!c).attr("aria-disabled",c?"false":"true"),b.toggleClass("ic-dp-redo-disabled",!d),b.parent().toggleClass("disabled",!d).attr("aria-disabled",d?"false":"true")}},{key:"_draggableWindowOpenDirection",value:function(a,b){var c=this.jObject,d=$("#"+this.currentTextEditor).parent().parent();if("drag"===b)if($(window).width()-(d.position().left+d.width())<100)switch(a){case"math":d.find(".text-math-picker-menu-wrapper").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide menu-slider-open-left menu-slider-open-right editable-content-wrapper-math-slide-right").addClass("editable-content-wrapper-math-slide-right");break;case"text":d.find(".font-sizes-wrapper").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide menu-slider-open-left menu-slider-open-right").addClass("menu-slider-open-right");break;case"color":d.find(".text-color-picker-menu").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide menu-slider-open-left menu-slider-open-right").addClass("menu-slider-open-right")}else{switch(a){case"math":d.find(".editable-content-wrapper").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide menu-slider-open-left menu-slider-open-right").addClass("editable-content-wrapper-math-slide");break;case"text":case"color":d.find(".editable-content-wrapper").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide menu-slider-open-left menu-slider-open-right").addClass("editable-content-wrapper-color-slide")}d.find(".text-math-picker-menu-wrapper,.font-sizes-wrapper,.text-color-picker-menu").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide menu-slider-open-left menu-slider-open-right editable-content-wrapper-math-slide-right").addClass("menu-slider-open-left")}else switch(a){case"color":case"text":c.find(".invisible-inputs .drag-handle").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide menu-slider-open-left menu-slider-open-right menu-slider-open-right-auth").addClass("menu-slider-open-right");break;case"math":d.find(".text-math-picker-menu-wrapper").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide menu-slider-open-left menu-slider-open-right menu-slider-open-right-auth editable-content-wrapper-math-slide-right").addClass("menu-slider-open-right-auth"),c.find(".invisible-inputs .drag-handle").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide menu-slider-open-left menu-slider-open-right menu-slider-open-right-auth editable-content-wrapper-math-slide-right").addClass("editable-content-wrapper-math-slide-right")}}},{key:"_setPopupLocation",value:function(a,b,c,d){var e=this.jObject.find(".drawpad-toolbar-wrapper"),f=e.width(),g=c.position().top,h=c.outerHeight(),i=8,j=a.width(),k=a.outerHeight(),l=b?b.width():0,m=this.inlineMode?this.rightAlignToolbar:$(window).width()-(e.position().left+f)<295,n=0,o=m?-1*(j+i+(b?l+i:0)):f+i+(b?l+i:0);n=b?d?b.position().top+g:b.position().top:d?g:g-k/2+h/2,a.css({left:o+"px",top:n+"px"});var p=a.offset().top+k,q=p-$(window).height();q>0&&(n-=q,a.css({top:n+"px"}))}},{key:"_unlockTrash",value:function(){this.isDirty=!0;var a=this.jObject.find(".ic-dp-trash");this._setDirtyFlagOnHost(),a.removeClass("ic-dp-trash-disabled"),a.parent().removeClass("disabled").attr("aria-disabled","false"),this.jObject.find(".drawpad-save").sliderbutton("enable")}},{key:"_lockTrash",value:function(){if(this.options.undoHistory.length<1&&this.options.redoHistory.length<1&&this.options.availableNoteCount===this.options.maxNotes){var a=this.jObject.find(".drawpad-toolbar .ic-dp-trash");a.addClass("ic-dp-trash-disabled"),a.parent().addClass("disabled").attr("aria-disabled","true")}}},{key:"_confirm",value:function(a,b,c,d){var e=this,f=this.jObject,g=PearsonGL.utils.randomString(9);f.append('\n\t\t\t<div class="confirm-modal"></div>\n\t\t\t<div class="confirm-delete-dialog popup-window" role="dialog" aria-describedby="'+g+'" aria-modal="true">\n\t\t\t\t<div class="confirm-message" id="'+g+'">'+a+'</div>\n\t\t\t\t<div class="confirm-button-wrapper">\n\t\t\t\t\t<div class="drawpad-cancel-default sprite" aria-label="'+this.labelOpts.cancelButton+'">'+this.labelOpts.cancelButton+'</div>\n\t\t\t\t\t<div class="drawpad-delete-default sprite" aria-label="'+this.labelOpts.deleteButton+'">'+this.labelOpts.deleteButton+"</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t");var h=f.find(".drawpad-cancel-default"),i=f.find(".drawpad-delete-default");this._iosHackForInputs(),f.addClass("modal-open"),h.sliderbutton({buttonClassName:"drawpad-cancel-default",slider:!1,clickFunction:function(){f.find(".confirm-delete-dialog,.confirm-modal").remove(),f.removeClass("modal-open"),"function"==typeof c&&c()}}),i.sliderbutton({buttonClassName:"drawpad-delete-default",slider:!1,clickFunction:function(a,c,e){"click"===c&&(f.removeClass("modal-open"),b(),d&&d.focus())}}),i.on("keyup",function(a){a.which!==PearsonGL.utils.keyCode.enter&&a.which!==PearsonGL.utils.keyCode.space||(f.removeClass("modal-open"),b(),d&&d.focus())}),h.sliderbutton("keyPressEventHandler",function(a){a.which===PearsonGL.utils.keyCode.tab?(a.preventDefault(),i.focus()):a.keyCode===PearsonGL.utils.keyCode.escape&&e.clearActiveUI()}),i.sliderbutton("keyPressEventHandler",function(a){a.which===PearsonGL.utils.keyCode.tab?(a.preventDefault(),h.focus()):a.keyCode===PearsonGL.utils.keyCode.escape&&e.clearActiveUI()}),h.focus()}},{key:"_reset",value:function(){this.options.availableNoteCount=this.options.maxNotes,this.options.textKeeper=[],this.options.authoredTextKeeper=[],this._clearUndoHistory(),this.jObject.find(".draggable-text").remove(),this.jObject.find(".draggable-shape").remove();try{this.lastUndo=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)}catch(a){}this._setDirtyFlagOnHost()}},{key:"removeArrayItemsAtIndex",value:function(a,b){var c=[];isNaN(b)&&(b=0);for(var d=0;d<a.length;d++)b!==a[d].index&&c.push(a[d]);this.options.textKeeper=[],this.options.textKeeper=c}},{key:"escapeCheck",value:function(a){a.keyCode===PearsonGL.utils.keyCode.escape&&this.clearActiveUI()}},{key:"clearActiveUI",value:function(){this._closeMenus(),this.setCurrentTool(this.TOOLS.CURSOR),this.jObject.find(".draggable-shape").removeClass("soft-focus"),this.jObject.find(".confirm-delete-dialog, .confirm-modal").remove()}},{key:"_closeMenus",value:function(){var a=this.jObject.find(".sub-menu");a.hide(),a.removeClass("open-color-picker"),this.jObject.find('[aria-expanded="true"]').attr("aria-expanded","false"),this.setCurrentTool()}},{key:"setBrushMenuMode",value:function(a){var b=this.jObject.find(".drawpad-color-picker");a===this.TOOLS.ERASE?(b.addClass("erase-mode").removeClass("pen-mode"),b.find(".color-table, .drawpad-tool-draw, .drawpad-tool-line").hide(),b.css({height:"50px"}),b.find(".drawpad-color").css({top:0}),b.find(".drawpad-brush-slider").css({top:"9px"}),b.attr("aria-label",this.labelOpts.eraserTool),b.find(".drawpad-brush-slider").attr("title",this.labelOpts.eraserWidth)):(a===this.TOOLS.PEN||this.TOOLS.LINE)&&(b.addClass("pen-mode").removeClass("erase-mode"),b.removeAttr("style"),b.find(".drawpad-color").removeAttr("style"),b.find(".drawpad-brush-slider").removeAttr("style"),b.find(".color-table, .drawpad-tool-draw, .drawpad-tool-line").show(),b.attr("aria-label",this.labelOpts.penTools),b.find(".drawpad-brush-slider").attr("title",this.labelOpts.penWidth))}},{key:"updateDrawingMenu",value:function(a){var b=this.jObject.find(".drawpad-color-picker"),c=this.drawOptionsMap[a];if(c){var d=.5*c.width*-1-2,e=c.colorId,f=this.colorConfig.penColors[e].color,g=a===this.TOOLS.PEN,h=a===this.TOOLS.LINE;b.find(".drawpad-color-changer").css({width:c.width,height:c.width,marginLeft:d+"px",marginTop:d+"px",background:f}),b.find(".drawpad-brush-slider").slider("value",c.width),b.find(".draw-tool-color").removeClass("button-clicked-wrapper").attr("aria-pressed",!1),b.find("[data-color-id='"+e+"']").addClass("button-clicked-wrapper").attr("aria-pressed",!0),b.find(".drawpad-tool-pen").toggleClass("button-clicked-wrapper",g).attr("aria-pressed",g),b.find(".drawpad-tool-line").toggleClass("button-clicked-wrapper",h).attr("aria-pressed",h),b.find(".drawpad-color-changer").toggleClass("erase-color",a===this.TOOLS.ERASE),a===this.TOOLS.PEN||a===this.TOOLS.LINE?b.find(".ui-slider-handle").attr("aria-label",this.labelOpts.penWidth+" "+Math.round(c.width)):a===this.TOOLS.ERASE&&b.find(".ui-slider-handle").attr("aria-label",this.labelOpts.eraserWidth+" "+Math.round(c.width))}}},{key:"_getCoords",value:function(a,b){var c=0,d=0;return a.touches?a.touches.length>0?(c=a.touches[0].pageX-$(this.canvas).offset().left,d=a.touches[0].pageY-$(this.canvas).offset().top):a.changedTouches&&a.changedTouches.length>0?(c=a.changedTouches[0].pageX-$(this.canvas).offset().left,d=a.changedTouches[0].pageY-$(this.canvas).offset().top):(c=a.pageX-$(this.canvas).offset().left,d=a.pageY-$(this.canvas).offset().top):a.layerX||0===a.layerX?(c=a.layerX,d=a.layerY):b?(c=a.pageX,d=a.pageY):(c=a.pageX-$(this.canvas).offset().left,d=a.pageY-$(this.canvas).offset().top),{x:c,y:d}}},{key:"addSaveButton",value:function(){var a=this,b=this.jObject,c=b.find(".drawpad-toolbar");0===c.find(".drawpad-save").length&&(c.append("<hr/>"),c.append('<li title="'+this.labelOpts.save+'" class="save-drawing-button"><div class="drawpad-save sprite">'+this.labelOpts.save+"</div></li>"),b.find(".drawpad-save").sliderbutton({buttonClassName:"drawpad-save",slider:!1,clickFunction:function(b){$(b.jObject).hasClass("drawpad-save-button-disable")||a.saveStateDpApi()}}),b.find(".drawpad-save").sliderbutton("disable"))}},{key:"_loadStampImage",value:function(a){var b=this.jObject.find(".stamp-floating-cursor");this.stampConfig.reset(),b.css({top:0,left:0,display:"none"}),b.attr("src",""),b.attr("src",a)}},{key:"setPassthrough",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.allowPassthrough&&this.jObject.toggleClass("passthrough",a)}},{key:"_iosHackForInputs",value:function(){var a=$("body").data("browserData");if((!a||!a.specialFlags.isiOS8OrGreater)&&PearsonGL.globals.browserData&&PearsonGL.globals.browserData.specialFlags.isiOS){var b=$("#"+this.currentTextEditor),c=b.parent(),d=b.clone(!0);b.remove(),c.prepend(d)}}},{key:"_buildShapeBox",value:function(a,b,c,d,e,f){var g=this,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.labelOpts.shape,i=arguments.length>7&&void 0!==arguments[7]&&arguments[7],j=this,k=this.jObject,l=$("body").data("browserData"),m=l&&l.specialFlags&&l.specialFlags.isIE,n=void 0;this._unlockTrash(),k.find(".draggable-shape").removeClass("soft-focus");var o=$('<div class="draggable-shape soft-focus '+(i?"user-image":"shape")+'" aria-grabbed="false" role="application" aria-label="'+h+'" tabindex="0"></div>'),p=$("<div></div>"),q=$('<div class="drag-handle"></div>'),r=$('<div class="drawpad-default hackclass keep-selection shape-duplicate sprite" data-icon="ic-dp-shape-duplicate" title="'+this.labelOpts.duplicateButton+'"></div>'),s=$('<div class="drawpad-default hackclass keep-selection ic-dp-trash sprite" data-icon="ic-dp-trash" title="'+this.labelOpts.clear+'"></div>');k.find(".draggable-text").length>0?o.insertBefore(k.find(".draggable-text").first()):k.append(o),q.append(r,s),o.append(q),o.css("top",k.find(".drawpad-toolbar-wrapper").position().top),o.on("mousedown touchstart focus",function(a){o.addClass("soft-focus"),"focus"!==a.type&&o.focus()}).focusout(function(a){setTimeout(function(){0===$(document.activeElement).closest(o).length&&(o.removeClass("soft-focus"),g.shapeMoveDirection=null,g.shapeMoveTime=0,g.shapeResizeType=null,g.shapeResizeTime=0)},0)}).keydown(function(a){var b=5,c=parseInt(o.css("top"),0),d=parseInt(o.css("left"),0),e=null;switch(a.which){case PearsonGL.utils.keyCode.left:a.preventDefault(),o.css("left",Math.max(d-b,0)),e="Left";break;case PearsonGL.utils.keyCode.right:a.preventDefault();var f=g.jObject.width()-o.width();o.css("left",Math.min(d+b,f)),e="Right";break;case PearsonGL.utils.keyCode.up:a.preventDefault(),o.css("top",Math.max(c-b,0)),e="Up";break;case PearsonGL.utils.keyCode.down:a.preventDefault();var h=g.jObject.height()-o.height();o.css("top",Math.min(c+b,h)),e="Down"}e&&((e!==g.shapeMoveDirection||Date.now()-g.shapeMoveTime>15e3)&&g.jObject.find(".hidden-label").text(g.labelOpts["objectMove"+e]),g.shapeMoveDirection=e,g.shapeMoveTime=Date.now())}),q.find(".drawpad-default").last().blur(function(a){setTimeout(function(){0===$(document.activeElement).closest(o).length&&o.removeClass("soft-focus")},0)}),r.sliderbutton({buttonClassName:"ic-dp-shape-duplicate",slider:!1,clickFunction:function(a){var b=a.jObject.closest(".draggable-shape"),c=a.jObject.closest(".draggable-shape").hasClass("user-image"),d=b.data("shapeData"),e=b.position(),f=40;g._buildShapeBox(d.imageUrl,d.preserveAspectRatio,e.left+f,e.top+f,b.width(),b.height(),b.attr("aria-label"),c)}}),r.sliderbutton("keyPressEventHandler",this.escapeCheck.bind(this)),s.sliderbutton({buttonClassName:"ic-dp-trash",slider:!1,clickFunction:function(a,b,c){if("click"===b){var d=a.jObject.closest(".draggable-shape").hasClass("user-image");a.jObject.closest(".draggable-shape").remove(),g._unlockTrash(),g.jObject.find(".hidden-label").text(g.labelOpts.imageDeleted),d?(g.jObject.find(".ic-dp-attach").focus(),g.jObject.find(".drawpad-tool-attach").addClass("text-button-focus")):g.jObject.find(".drawpad-tool-shape").focus()}}}),s.on("keyup",function(a){if(a.which===PearsonGL.utils.keyCode.enter||a.which===PearsonGL.utils.keyCode.space){var b=$(a.currentTarget).closest(".draggable-shape").hasClass("user-image");$(a.currentTarget).closest(".draggable-shape").remove(),g._unlockTrash(),g.jObject.find(".hidden-label").text(g.labelOpts.imageDeleted),b?(g.jObject.find(".ic-dp-attach").focus(),g.jObject.find(".drawpad-tool-attach").addClass("text-button-focus")):g.jObject.find(".drawpad-tool-shape").focus()}}),s.sliderbutton("keyPressEventHandler",this.escapeCheck.bind(this));var t=function(){var a=o.data("shapeData");if(n.addClass("shape-image"),p.addClass("shape-image-container"),p.appendTo(o),o.addClass(a.preserveAspectRatio?"fixed-ar":"distortable-ar"),n.css({width:"100%",height:"100%"}),o.width("number"==typeof e?e:a.origWidth),o.height("number"==typeof f?f:a.origHeight),o.css("left","number"==typeof c?c:k.width()/2-o.width()/2),o.css("top","number"==typeof d?d:k.find(".drawpad-toolbar-wrapper").position().top),o.focus(),p[0].style.display="none",p[0].offsetHeight,p[0].style.display="",m&&("number"==typeof e||"number"==typeof e)){var b=p.width()*p.height(),h=o.data("shapeData"),i=h.origWidth*h.origHeight,l=Math.sqrt(b/i);n.find('[vector-effect="non-scaling-stroke"][stroke-width]').each(function(a,b){b=$(b);var c=parseFloat(b.attr("data-orig-stroke-width"),10)/l;b.attr("stroke-width",c)})}o.draggable({containment:"#"+k.attr("id"),start:function(){g._unlockTrash(),o.addClass("rich-input-type-border-drag"),PearsonGL.utils.suppressIframeEvents(!0)},stop:function(a,b){o.removeClass("rich-input-type-border-drag"),PearsonGL.utils.suppressIframeEvents(!1)}}),o.resizable({minWidth:20,minHeight:20,handles:"se",aspectRatio:a.preserveAspectRatio,containment:"#"+k.attr("id"),create:function(b,c){o.find(".ui-resizable-handle").on("keydown",function(b){var c=5,d=o.width(),e=o.height(),f=d/e,h=null,i=0,j=0;switch(b.which){case PearsonGL.utils.keyCode.left:i=-1*c,j=a.preserveAspectRatio?i/f:0,h="Smaller";break;case PearsonGL.utils.keyCode.up:j=-1*c,i=a.preserveAspectRatio?j*f:0,h="Smaller";break;case PearsonGL.utils.keyCode.right:i=c,j=a.preserveAspectRatio?i/f:0,h="Larger";break;case PearsonGL.utils.keyCode.down:j=c,i=a.preserveAspectRatio?j*f:0,h="Larger"}if(h){b.stopPropagation(),b.preventDefault();var k=d+i,l=e+j;k>=20&&l>=20&&(o.width(k),o.height(l),(h!==g.shapeResizeType||Date.now()-g.shapeResizeTime>15e3)&&g.jObject.find(".hidden-label").text(g.labelOpts["objectResize"+h]),g.shapeResizeType=h,g.shapeResizeTime=Date.now())}})},start:function(a,b){g.isResizing=!0,g._unlockTrash(),PearsonGL.utils.suppressIframeEvents(!0)},resize:function(a,b){if(m){var c=p.width()*p.height(),d=o.data("shapeData"),e=d.origWidth*d.origHeight,f=Math.sqrt(c/e);n.find('[vector-effect="non-scaling-stroke"][stroke-width]').each(function(a,b){b=$(b);var c=parseFloat(b.attr("data-orig-stroke-width"),10)/f;b.attr("stroke-width",c)})}n[0].style.display="none",n[0].offsetHeight,n[0].style.display=""},stop:function(a,b){g.isResizeTimeout=window.setTimeout(function(){g.isResizing=!1,PearsonGL.utils.suppressIframeEvents(!1)},500)}}),o.find(".ui-resizable-se").attr({"data-icon":"resize-handle",tabindex:"0","aria-label":j.labelOpts.resizeHandle}),o.find(".ui-resizable-se")[0].style.display=""};/svg$/.test(a)?p.load(a,function(c,d,e){n=p.find("svg"),p.appendTo(k),n.find("[stroke-width]").each(function(a,b){$(b).attr("data-orig-stroke-width",$(b).attr("stroke-width"))}),o.data("shapeData",{imageUrl:a,preserveAspectRatio:!!b,origWidth:n.width(),origHeight:n.height()}),n.attr({width:"100%",height:"100%"}),t()}):(n=$("<img />"),n[0].onload=function(){n.appendTo(p),p.appendTo(k),o.data("shapeData",{imageUrl:a,preserveAspectRatio:b,origWidth:this.naturalWidth?this.naturalWidth:this.offsetWidth,origHeight:this.naturalHeight?this.naturalHeight:this.offsetHeight}),t()},n.attr("src",a))}},{key:"getShapeStatuses",value:function(){var a=[];return this.jObject.find(".draggable-shape").each(function(b,c){c=$(c);var d=c.data("shapeData"),e=c.position();a.push($.extend({width:c.width(),height:c.height(),top:e.top,left:e.left,description:c.attr("aria-label")},d))}),a}},{key:"_redrawShapes",value:function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){c._buildShapeBox(a.imageUrl,a.preserveAspectRatio,a.left,a.top,a.width*b,a.height*b,a.description,!1)})}},{key:"_createTextBox",value:function(){var a=300,b=200,c=10,d=this.jObject.width(),e=this.jObject.height(),f={};if(this.lastUserTextBox){var g=this.lastUserTextBox.position();f.x=g.left+c,f.y=g.top+c,f.x+a>d?(f.x=0,f.y=0):f.y+b>e&&(f.y=e-b)}else f.x=(d-a)/2-35,f.y=this.jObject.find(".drawpad-toolbar-wrapper").position().top;this._buildTextBox(f,"",-1)}},{key:"_buildTextBox",value:function(a,b,c,d){var e=this,f=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!(this.options.availableNoteCount<=0)){var g,h,i,j,k,l=this.jObject,m=0,n=this,o=c>-1?c:"",p=PearsonGL.utils.randomString(9),q=this.colorConfig.textColors.color1,r=this.labelOpts.colorMenu+" "+n.labelOpts.selectedColor+": "+q.title+".",s=b,t='<div class="drawpad-default text-color-picker hackclass keep-selection" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" data-color="'+q.color+'" style="background-color: '+q.color+'" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_COLOR+'" title="'+r+'" aria-label="'+r+'"></div>',u='<div class="drawpad-default hackclass keep-selection ic-dp-fontsize sprite" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" data-icon="ic-dp-fontsize" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_SIZE+'" title="'+this.labelOpts.textsize+'" aria-label="'+this.labelOpts.textsize+'"></div>',v='<div class="drawpad-default hackclass keep-selection text-math-tools ic-dp-math ic-dp-math-menu sprite" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" data-icon="ic-dp-math" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_MATH+'" title="'+this.labelOpts.math+'" aria-label="'+this.labelOpts.math+'"></div>',w='<div class="drawpad-default hackclass keep-selection text-equation-tools ic-dp-math sprite" tabindex="0" role="button" data-icon="ic-dp-math" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_EQUATION+'" title="'+this.labelOpts.equation+'" aria-label="'+this.labelOpts.equation+'"></div>',x='<div class="drawpad-default hackclass keep-selection text-keypad ic-dp-math sprite" tabindex="0" role="button" data-icon="true" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_KEYPAD+'" title="'+this.labelOpts.openKeypad+'" aria-label="'+this.labelOpts.openKeypad+'"></div>',y=this.getTextBoxstyling(this.labelOpts,this.TEXT_BOX_BUTTONS),z='<hr class="text_rule text_rule-3" aria-hidden="true" />';this._hideTypeBox(),this.options.noMathSymbolTools&&(v="",m=-38),this.options.mathquill?(textToolbarMath="",w="",t="",u="",y="",b="",z=""):x="",g=$('\n\t\t\t<div class="draggable-text">\n\t\t\t\t<div class="editable-content-wrapper">\n\t\t\t\t\t<div contenteditable="'+(this.options.mathquill?"false":"true")+'" class="rich-input-type" style="display: block;" id="'+p+'">'+b+'</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="drag-handle" id="menu_'+p+'">\n\t\t\t\t\t'+t+"\n\t\t\t\t\t"+u+"\n\t\t\t\t\t"+y+"\n\t\t\t\t\t"+z+"\n\t\t\t\t\t"+v+"\n\t\t\t\t\t"+w+"\n\t\t\t\t\t"+x+'\n\t\t\t\t\t<hr class="text_rule text_rule-4" aria-hidden="true" />\n\t\t\t\t\t<div class="drawpad-default hackclass keep-selection ic-dp-trash sprite" tabindex="0" role="button" data-icon="ic-dp-trash" data-id="'+this.TEXT_BOX_BUTTONS.TEXT_TRASH+'" title="'+this.labelOpts.clear+'" aria-label="'+this.labelOpts.clear+'"></div>\n\t\t\t\t</div>\n\t\t\t\t'+n.buildTextboxMenu("text-color-picker-menu",this.labelOpts,this.TEXT_BOX_BUTTONS,this.colorConfig.textColors)+"\n\t\t\t</div>\n\t\t").appendTo(l),h=g.find(".rich-input-type");var A=parseInt(l.find(".draggable-text:last .ic-dp-fontsize").css("top"),10),B=parseInt(l.find(".draggable-text:last .ic-dp-trash").css("top"),10);l.find(".draggable-text:last .ic-dp-fontsize").css("top",A+m),l.find(".draggable-text:last .ic-dp-trash").css("top",B+m),m<0&&l.find(".drag-handle").addClass("drag-handle-small"),l.find(".draggable-text:last .text-color").each(function(b,c){$(c).sliderbutton({buttonClassName:"text-color",slider:!1,clickFunction:function(b){var c=$(b.jObject).closest(".draggable-text"),d=b.jObject.attr("aria-label");n.textColor=$(b.jObject).attr("data-color"),n.textColor.indexOf("rgb")>-1&&(n.textColor=PearsonGL.utils.rgbColorToHex(n.textColor)),$(b.jObject).parent().parent().parent().find(".text-color-picker").css({"background-color":n.textColor}).attr({"data-color":n.textColor,"aria-label":n.labelOpts.colorMenu+" "+n.labelOpts.selectedColor+": "+d+".",title:n.labelOpts.colorMenu+" "+n.labelOpts.selectedColor+": "+d+"."}),n.restoreSelection(n.savedRange),document.execCommand("foreColor",!1,n.textColor),document.activeElement!==c.find(".rich-input-type")&&c.find(".rich-input-type").focus(),n.saveRange(),n.hideTextBoxSubmenus(),n._iosHackForInputs(),n._saveBoxArrayData(l.find("#"+n.currentTextEditor),a),n._unlockTrash(),setTimeout(function(){n.jObject.find(".hidden-label").text(n.labelOpts.selectedColor+" "+d)},100)}})}),g.on("keyup",".text-color-picker",function(a){if(a.keyCode===PearsonGL.utils.keyCode.enter||a.keyCode===PearsonGL.utils.keyCode.space){var b=$(this).closest(".draggable-text").find(".text-color-picker-menu"),c=$(this).attr("data-color"),d=b.find('[data-color="'+c+'"]');0===d.length&&(d=b.find(".text-color").first()),d[0].focus(),d.addClass("text-color-button-over")}}),g.on("keyup",".ic-dp-fontsize",function(a){if(a.keyCode===PearsonGL.utils.keyCode.enter||a.keyCode===PearsonGL.utils.keyCode.space){var b=$(this).closest(".draggable-text").find(".font-sizes-wrapper"),c=$("#"+n.currentTextEditor).data("fontsize"),d=b.find(".text-size");"1"!==c&&"2"!==c&&"3"!==c&&(c="2"),c=parseInt(c,10)-1,d.removeClass("button-clicked-wrapper"),$(d[c]).addClass("button-clicked-wrapper"),d[c].focus(),b.find(".text-size")[c].focus()}}),g.find(".text-color").off("keydown"),g.on("keydown",".text-color, .text-size, .math-element",function(a){var b,c,d,e=$(this),f=a.keyCode===PearsonGL.utils.keyCode.down||a.keyCode===PearsonGL.utils.keyCode.right,g=a.keyCode===PearsonGL.utils.keyCode.up||a.keyCode===PearsonGL.utils.keyCode.left,h=e.closest(".draggable-text"),i="";if(e.hasClass("text-color"))b=e.closest(".text-color-picker-menu"),c=".text-color",d=".text-color-picker",i="text-color-button-over";else if(e.hasClass("text-size"))b=e.closest(".font-sizes-wrapper"),c=".text-size",d=".ic-dp-fontsize";else{if(!e.hasClass("math-element"))return;b=e.closest(".text-math-picker-menu-wrapper"),c=".math-element",d=".text-math-tools"}if(f||g){var j=b.find(c),k=$.inArray(document.activeElement,j);return k=k<0?0:k,k=f?(k+1)%j.length:k-1<0?j.length-1:k-1,j.removeClass(i),$(j[k]).addClass(i),j[k].focus(),!1}if(a.keyCode===PearsonGL.utils.keyCode.tab)n.hideTextBoxSubmenus(),h.find(d)[0].focus();else if(".text-color"===c&&(a.keyCode===PearsonGL.utils.keyCode.enter||a.keyCode===PearsonGL.utils.keyCode.space))return e.click(),!1}),this._attachGenericButtonEvents(g),this.currentTextEditor=p,this.lastUserTextBox=g,i=g.find(".drag-handle"),i.on("mousedown mouseup touchstart touchend",function(a){a.preventDefault()}),j=g.offset().left-i.offset().left,k=parseInt(g.css("marginLeft").replace("px",""),0),g.css("marginLeft",Math.max(j,k)+"px"),g.on("mousedown touchstart",function(){$(this).find(".editable-content-wrapper").hasClass("rich-input-type-border")||$(this).addClass("clickStart")}),g.on("mouseup touchend",function(){$(this).hasClass("clickStart")&&($(this).find(n.options.mathquill?"textarea":".rich-input-type").focus(),$(this).removeClass("clickStart"),n._iosHackForInputs())}),g.draggable({containment:"#"+l.attr("id"),distance:15,start:function(){n.hideTextBoxSubmenus(),$(this).find(".editable-content-wrapper").addClass("rich-input-type-border-drag"),n.lastUserTextBox&&n.lastUserTextBox[0]===this&&(n.lastUserTextBox=null),$(this).removeClass("clickStart"),PearsonGL.utils.suppressIframeEvents(!0)},stop:function(a,b){var c=b.position,d={x:c.left,y:c.top};n._setDirtyFlagOnHost(),n._saveBoxArrayData($(this).find(".rich-input-type"),d),n.jObject.find(".drawpad-save").sliderbutton("enable"),$(this).find(".editable-content-wrapper").removeClass("rich-input-type-border-drag"),n.options.mathquill?$(this).find("textarea").blur():$(this).find(".rich-input-type").blur(),$(a.originalEvent.target).one("click",function(a){a.stopImmediatePropagation()}),PearsonGL.utils.suppressIframeEvents(!1)}}),g.find(".editable-content-wrapper").resizable({minWidth:30,minHeight:40,handles:"e",start:function(){PearsonGL.utils.suppressIframeEvents(!0),n._iosHackForInputs(),clearTimeout(n.isResizeTimeout),n.isResizing=!0},stop:function(){PearsonGL.utils.suppressIframeEvents(!1),n._setDirtyFlagOnHost(),n._saveBoxArrayData($(this).find(".rich-input-type"),a);var b=$(this).css("width"),c=$(this).css("height"),d=$(this).css("z-index"),e=$(this).css("position");$(this).removeAttr("style"),$(this).css({zIndex:d,position:e,width:b,height:c}),n.jObject.find(".drawpad-save").sliderbutton("enable"),n.isResizeTimeout=window.setTimeout(function(){n.isResizing=!1},500)}}),g.find(".drag-handle").mousedown(function(){$(this).parent().css({zIndex:n.LAYERS.TEXT_ORDER_TOP})}),g.css({zIndex:n.LAYERS.TEXT_ORDER_BOTTOM,left:a.x+"px",top:a.y+"px"}),d&&g.find(".editable-content-wrapper").css({width:d.w}),l.find(".ui-resizable-handle").focus(function(){n._showTypeBox($(this).parent())}),g.focusout(this.handleTextBoxBlur.bind(this)),g.focusout(function(a){setTimeout(function(){0===$(document.activeElement).closest(g).length&&(e.buildUserTextBoxData(h),e.announceTextBlur(g.find(".rich-input-type").text()))},0)}),h.attr({"data-text-id":o,id:p}),this.options.mathquill?(this.mathquillMap[p]=new PearsonGL.Gadget.ComponentMathquill(h,{allowEnterKey:!0,onlySaveSupportedLatex:!0,onChange:function(a){e._unlockTrash();var b=e.mathquillMap[p].getLatex();h.closest(".editable-content-wrapper").toggleClass("empty",0===b.length)},onFocus:function(a){e.currentTextEditor=h.attr("id"),PearsonGL.utils.setActiveInputField(h),e._hideTypeBox(),e._closeMenus(),setTimeout(function(){e._showTypeBox(g),g.draggable("disable")},100)}}),this.mathquillMap[p].setLatex(s),h.closest(".editable-content-wrapper").toggleClass("empty",!PearsonGL.utils.isNonEmptyString(s))):h.keydown(function(a){if(16!==a.keyCode&&37!==a.keyCode&&39!==a.keyCode&&38!==a.keyCode&&40!==a.keyCode&&9!==a.keyCode){if(8===a.which){var b=window.getSelection?window.getSelection():document.selection,c=b.rangeCount>0?b.getRangeAt(0):b.createRange();if((0==c.startOffset||1==c.startOffset)&&c.startContainer&&c.startContainer.previousSibling&&$(c.startContainer.previousSibling).hasClass("equation-span"))return!1}document.execCommand("foreColor",!1,n.textColor);var d=$(this).data("fontsize")?2*$(this).data("fontsize"):4;document.execCommand("fontSize",!1,d)}}).keyup(function(){n.saveRange(),n._maxLengthLimitor(this,n.options.maxLen),n._unlockTrash()}).mouseup(function(){n.saveRange()}).focus(function(){var a=$(this).closest(".draggable-text");if(n.currentTool!==n.TOOLS.CURSOR)return $(this).blur(),!1;n._hideTypeBox(),n._closeMenus(),n.currentTextEditor=this.id,n._showTypeBox($(this).parent().parent()),n.textColor=$(this).parent().parent().find(".text-color-picker").attr("data-color"),n.textColor.indexOf("rgb")>-1&&(n.textColor=PearsonGL.utils.rgbColorToHex(n.textColor)),a.draggable("disable")}),this._showTypeBox(l.find(".rich-input-type:last").parent().parent()),this.options.availableNoteCount-=1,this._unlockTrash(),f&&(this.options.mathquill?g.find(".mq-textarea textarea").focus():h.focus()),n._iosHackForInputs();var C=$("#"+this.currentTextEditor),D=$("#"+this.currentTextEditor).parent().siblings(".drag-handle").find(".text-style");return C.on("keyup click",function(){D.each(function(a,b){return e.updateStyleButtonState($(b))})}),!$.trim(C.html())&&this.browser.isFirefox()&&C.html("<br>"),C.focus(function(){!$.trim(C.html())&&n.browser.isFirefox()&&C.html("<br>")}),g}}},{key:"getTextBoxElements",value:function(a,b){var c={};return c.mainMenu=this.jObject.find("#menu_"+a),c.editableContentDiv=this.jObject.find("#"+a),c.editableContentWrapper=c.editableContentDiv.closest(".editable-content-wrapper"),c.draggableText=c.editableContentDiv.closest(".draggable-text"),c.isDraggable=c.draggableText.length>0,c.isDraggable?(c.subMenus=c.draggableText.find(".mini-menu"),c.subMenu=c.draggableText.find(b)):(c.subMenus=c.mainMenu.closest(".invisible-text-color-picker-menu").find(".mini-menu"),c.subMenu=c.mainMenu.closest(".invisible-text-color-picker-menu").find(b)),c}},{key:"_redrawText",value:function(){for(var a=this.options.textKeeper,b=0;b<a.length;b++){var c=a[b];c.index=b;var d=this._buildTextBox(c.coords[0],c.text,b,c.dimensions,!1);this.initTextBoxEquations(d),this.textkeeperLen++}}},{key:"_redrawAuthoredText",value:function(){var a=this,b=this.jObject.find(".invisible-inputs .rich-input-type");this.options.authoredTextKeeper.forEach(function(c,d){var e=$(b.get(d));if(a.options.mathquill){var f=e.attr("id"),g=a.mathquillMap[f];g&&(g.setLatex(c.text),e.closest(".editable-content-wrapper").toggleClass("empty",!PearsonGL.utils.isNonEmptyString(c.text)))}else e.html(c.text);e.attr("data-authtext-id",d),a.initTextBoxEquations(e)})}},{key:"_maxLengthLimitor",value:function(a,b){var c=$(a).text();if(c.length>=b){var d=c.substr(0,b);$(a).text(d),$(a).blur()}}},{key:"buildUserTextBoxData",value:function(a){var b=$(a).closest(".draggable-text"),c=$(a),d=c.parent().parent().position(),e={x:d.left,y:d.top};this.options.mathquill||0!==c.text().length||c.empty(),this._saveBoxArrayData(a,e),this.currentTool===this.TOOLS.CURSOR&&b.draggable("enable")}},{key:"buildAuthoredTextBoxData",value:function(a){a=$(a);var b=a.attr("data-authtext-id"),c=a.attr("id"),d=this.options.authoredTextKeeper.length,e="";if(this.options.mathquill){e=this.mathquillMap[c].getLatex()}else e=this.removeEquationContent(a);""===b?(this.options.authoredTextKeeper.push(new PearsonGL.Gadget.TextObj([],e,d)),a.attr("data-authtext-id",d)):this.options.authoredTextKeeper[b]=new PearsonGL.Gadget.TextObj([],e,b)}},{key:"_saveBoxArrayData",value:function(a,b){a=$(a);var c=a.attr("data-text-id"),d=a.attr("id"),e={},f="";if(e.h=a.parent().height(),e.w=a.parent().width(),this.options.mathquill){f=this.mathquillMap[d].getLatex()}else f=this.removeEquationContent(a);if(""===c)this.options.textKeeper.push(new PearsonGL.Gadget.TextObj([b],f,this.textkeeperLen,e)),a.attr("data-text-id",this.textkeeperLen),this.textkeeperLen++;else for(var g=0;g<this.options.textKeeper.length;g++)this.options.textKeeper[g].index===parseInt(c)&&(this.options.textKeeper[g]=new PearsonGL.Gadget.TextObj([b],f,c,e))}},{key:"initTextBoxEquations",value:function(a){var b=this,c=a.find(".equation-span"),d=c.length>0;c.each(function(a,c){c=$(c);var d=c.attr("id");if(PearsonGL.utils.isNonEmptyString(d)){var e=b.mathData[d];e&&e.present&&c.html(e.present)}c.click(function(a){b.equationClickHandler(a.currentTarget)})}),d&&PearsonGL.utils.initMathJax(a[0])}},{key:"removeTextBox",value:function(a){var b=this,c=a.find(".rich-input-type"),d=c.attr("data-text-id"),e=function(){b.lastUserTextBox&&b.lastUserTextBox[0]===a[0]&&(b.lastUserTextBox=null),b.removeArrayItemsAtIndex(b.options.textKeeper,parseInt(d,10)),a.find(".equation-span").each(function(a,c){var d=$(c).attr("id");delete b.mathData[d]}),a.remove(),b.jObject.find(".confirm-delete-dialog, .confirm-modal").remove(),b.options.availableNoteCount++,b._unlockTrash(),b.jObject.find(".hidden-label").text(b.labelOpts.textBoxDeleted)},f=function(){c.focus()};""!==c.text()?this._confirm(this.labelOpts.areYouSure,e,f,this.jObject.find(".drawpad-tool-text")):(e(),this.jObject.find(".drawpad-tool-text").focus())}},{key:"toggleTextColorMenu",value:function(a){var b=this.getTextBoxElements(a,".text-color-picker-menu, .text-colors-wrapper"),c=!b.subMenu.is(":visible");this.hideTextBoxSubmenus(),c&&(this._draggableWindowOpenDirection("color",b.isDraggable?"drag":"auth"),b.subMenu.fadeIn(200),b.subMenu.find(".text-color").removeClass("text-color-button-over"),b.subMenu.find(".text-color").first().focus(),b.mainMenu.find(".text-color-picker").addClass("clicked").attr("aria-expanded","true"))}},{key:"toggleTextMathMenu",value:function(a){var b=this.getTextBoxElements(a,".text-math-picker-menu-wrapper"),c=!b.subMenu.is(":visible");this.hideTextBoxSubmenus(),this.sendAnalytics("clicked_text_box_math_characters"),c&&(this._draggableWindowOpenDirection("math",b.isDraggable?"drag":"auth"),b.subMenu.fadeIn(200),b.subMenu.find(".math-element").removeClass("button-clicked-wrapper"),b.subMenu.find(".math-element").filter(":visible").first().focus(),b.mainMenu.find(".text-math-tools").addClass("clicked").attr("aria-expanded","true"))}},{key:"toggleTextSizeMenu",value:function(a){var b=this.getTextBoxElements(a,".font-sizes-wrapper"),c=!b.subMenu.is(":visible");this.hideTextBoxSubmenus(),c&&(this._draggableWindowOpenDirection("text",b.isDraggable?"drag":"auth"),b.subMenu.fadeIn(200),b.subMenu.find(".text-size").first().focus(),b.mainMenu.find(".ic-dp-fontsize").addClass("clicked").attr("aria-expanded","true"))}},{key:"_hideTypeBox",value:function(){var a=this.jObject,b=a.find(".draggable-text .editable-content-wrapper");a.find(".invisible-text-color-picker-menu").hide(),this.hideTextBoxSubmenus(),b.removeClass("rich-input-type-border"),this.currentTool===this.TOOLS.CURSOR&&b.addClass("rich-input-type-border-off"),a.find(".draggable-text").removeClass("active"),a.find(".draggable-text .drag-handle").addClass("noBg"),a.find(".draggable-text .ic-dp-trash, .draggable-text .ui-resizable-handle").hide(),a.find(".draggable-text .rich-input-type").css("overflow","hidden"),a.find(".draggable-text .ic-dp-math-menu").sliderbutton("disable"),a.find(".draggable-text .ic-dp-fontsize").sliderbutton("disable"),a.find(".draggable-text .text-color-picker").sliderbutton("disable")}},{key:"hideTextBoxSubmenus",value:function(a){var b=this.jObject.find(".draggable-text, .invisible-text-color-picker-menu");"string"==typeof a?b=$("#menu_"+a).closest(".draggable-text"):a instanceof jQuery&&(b=a),b.find(".drag-handle").removeClass("menu-slider-open-right"),b.find(".mini-menu").removeClass("menu-slider-open-right").hide(),b.find(".editable-content-wrapper").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide"),b.find(".text-color-picker, .text-math-tools, .ic-dp-fontsize").removeClass("clicked"),b.find('[aria-expanded="true"]').attr("aria-expanded","false")}},{key:"_showTypeBox",value:function(a){this.currentTool===this.TOOLS.CURSOR&&(a=$(a),a.find(".text-color-picker").length>0&&(this.textColor=a.find(".text-color-picker").attr("data-color")),this.jObject.find(".draggable-text").removeClass("active"),a.addClass("active"),a.find(".drag-handle").removeClass("noBg"),a.find(".ic-dp-trash, .ui-resizable-handle").show(),a.find(".editable-content-wrapper").addClass("rich-input-type-border").removeClass("rich-input-type-border-off"),a.find(".rich-input-type").css("overflow","auto"))}},{key:"removeEquationContent",value:function(a){var b=a.clone(!0);return b.find(".equation-span").empty(),b.html()}},{key:"buildTextboxMenu",value:function(a,b,c,d){return'\n\t\t<div class="'+a+' hide mini-menu" role="menu" aria-label="'+b.color+'">\n\t\t\t<ul class="text-colors">\n\t\t\t\t<li class="text-color hackclass keep-selection color1" data-color="'+d.color1.color+'" tabindex="0" role="button" aria-label="'+d.color1.title+'" title="'+d.color1.title+'"></li>\n\t\t\t\t<li class="text-color hackclass keep-selection color2" data-color="'+d.color2.color+'" tabindex="0" role="button" aria-label="'+d.color2.title+'" title="'+d.color2.title+'"></li>\n\t\t\t\t<li class="text-color hackclass keep-selection color3" data-color="'+d.color3.color+'" tabindex="0" role="button" aria-label="'+d.color3.title+'" title="'+d.color3.title+'"></li>\n\t\t\t\t<li class="text-color hackclass keep-selection color4" data-color="'+d.color4.color+'" tabindex="0" role="button" aria-label="'+d.color4.title+'" title="'+d.color4.title+'"></li>\n\t\t\t\t<li class="text-color hackclass keep-selection color5" data-color="'+d.color5.color+'" tabindex="0" role="button" aria-label="'+d.color5.title+'" title="'+d.color5.title+'"></li>\n\t\t\t\t<li class="text-color hackclass keep-selection color6" data-color="'+d.color6.color+'" tabindex="0" role="button" aria-label="'+d.color6.title+'" title="'+d.color6.title+'"></li>\n\t\t\t</ul>\n\t\t</div><div class="text-math-picker-menu-wrapper hide mini-menu" role="menu" aria-label="'+b.math+'">\n\t\t\t<table class="text-math-picker-menu"><tbody>\n\t\t\t\t<tr class="drawpad-grade-all">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.divide+'" title="'+b.divide+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-divide nopressed hackclass sprite m-picker" data-icon="ic-dp-divide" data-symbol="&divide;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.dot+'" title="'+b.dot+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-dot nopressed hackclass sprite m-picker" data-icon="ic-dp-dot" data-symbol="&sdot;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-all">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.notequal+'" title="'+b.notequal+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-noeq nopressed hackclass sprite m-picker" data-icon="ic-dp-noeq" data-symbol="&ne;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.degrees+'" title="'+b.degrees+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-degree nopressed hackclass sprite m-picker" data-icon="ic-dp-degree" data-symbol="&deg;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-all">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.lessthan+'" title="'+b.lessthan+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-lte nopressed hackclass sprite m-picker" data-icon="ic-dp-lte" data-symbol="&le;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.greaterthan+'" title="'+b.greaterthan+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-gte nopressed hackclass sprite m-picker" data-icon="ic-dp-gte" data-symbol="&ge;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-all">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.angle+'" title="'+b.angle+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-angl nopressed hackclass sprite m-picker" data-icon="ic-dp-angl" data-symbol="&ang;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.pi+'" title="'+b.pi+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-pi nopressed hackclass sprite m-picker" data-icon="ic-dp-pi" data-symbol="&#x03c0"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-all">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.implies+'" title="'+b.implies+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-arrow nopressed hackclass sprite m-picker" data-icon="ic-dp-arrow" data-symbol="&rarr;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.approx+'" title="'+b.approx+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-approx nopressed hackclass sprite m-picker" data-icon="ic-dp-approx" data-symbol="&asymp;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-all">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.squareroot+'" title="'+b.squareroot+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-sqr nopressed hackclass sprite m-picker" data-icon="ic-dp-sqr" data-symbol="&radic;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-k-2">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.plus+'" title="'+b.plus+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-plus nopressed hackclass sprite m-picker" data-icon="ic-dp-plus" data-symbol="&#x2b;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.minus+'" title="'+b.minus+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-minus nopressed hackclass sprite m-picker" data-icon="ic-dp-minus" data-symbol="&minus;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-k-2">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.multiply+'" title="'+b.multiply+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-multiply nopressed hackclass sprite m-picker" data-icon="ic-dp-multiply" data-symbol="&times;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.divide+'" title="'+b.divide+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-divide nopressed hackclass sprite m-picker" data-icon="ic-dp-divide" data-symbol="&divide;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-k-2">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.equal+'" title="'+b.equal+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-equal nopressed hackclass sprite m-picker" data-icon="ic-dp-equal" data-symbol="&#x3d;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.question+'" title="'+b.question+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-question nopressed hackclass sprite m-picker" data-icon="ic-dp-question" data-symbol="&#x3f;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-k-2">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.less+'" title="'+b.less+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-less nopressed hackclass sprite m-picker" data-icon="ic-dp-less" data-symbol="&lt;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.greater+'" title="'+b.greater+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-greater nopressed hackclass sprite m-picker" data-icon="ic-dp-greater" data-symbol="&gt;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-k-2">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.dollar+'" title="'+b.dollar+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-dollar nopressed hackclass sprite m-picker" data-icon="ic-dp-dollar" data-symbol="&#x24;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.cent+'" title="'+b.cent+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-cent nopressed hackclass sprite m-picker" data-icon="ic-dp-cent" data-symbol="&cent;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class="drawpad-grade-k-2">\n\t\t\t\t\t<td tabindex="0" role="button" aria-label="'+b.degrees+'" title="'+b.degrees+'" class="drawpad-default hackclass keep-selection sprite math-element" data-id="'+c.PICKED_MATH+'">\n\t\t\t\t\t\t<div class="ic-dp-degree nopressed hackclass sprite m-picker" data-icon="ic-dp-degree" data-symbol="&deg;"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td></td>\n\t\t\t\t</tr>\n\t\t\t</tbody></table>\n\t\t</div><div class="font-sizes-wrapper hide mini-menu" role="menu" aria-label="'+b.textsize+'">\n\t\t\t<ul class="font-sizes">\n\t\t\t\t<li class="drawpad-default hackclass keep-selection text-size" data-id="'+c.PICKED_FONT_S+'" title="'+b.textSM+'" tabindex="0" role="button" aria-pressed="false" aria-label="'+b.textSM+'">\n\t\t\t\t\t<div class="dp-font-sm ic-dp-text-sml sprite" data-icon="ic-dp-sm"></div>\n\t\t\t\t</li>\n\t\t\t\t<li class="drawpad-default hackclass keep-selection text-size button-clicked-wrapper" data-id="'+c.PICKED_FONT_M+'" title="'+b.textMD+'" tabindex="0" role="button" aria-pressed="true" aria-label="'+b.textMD+'">\n\t\t\t\t\t<div class="dp-font-m ic-dp-text-med sprite" data-icon="ic-dp-m"></div>\n\t\t\t\t</li>\n\t\t\t\t<li class="drawpad-default hackclass keep-selection text-size" data-id="'+c.PICKED_FONT_L+'" title="'+b.textLG+'" tabindex="0" role="button" aria-pressed="false" aria-label="'+b.textLG+'">\n\t\t\t\t\t<div class="dp-font-l ic-dp-text-lrg sprite" data-icon="ic-dp-l"></div>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'}},{key:"saveRange",value:function(){var a=window.getSelection();a&&0!==a.rangeCount?this.savedRange=a.getRangeAt(0):this.savedRange=document.createRange()}},{key:"getTextNodesIn",value:function(a,b){if(3===a.nodeType)b.push(a);else for(var c=0;c<a.childNodes.length;c++)this.getTextNodesIn(a.childNodes[c],b)}},{key:"setSelectionRange",value:function(a,b,c){if(document.createRange&&window.getSelection){var d=[],e=!1,f=0,g=document.createRange();g.selectNodeContents(a),this.getTextNodesIn(a,d);for(var h=0;h<d.length;h++){var i=d[h],j=f+i.length;if(!e&&b>=f&&(b<j||b==j&&h<d.length)&&(g.setStart(i,b-f),e=!0),e&&c<=j){g.setEnd(i,c-f);break}if(b+1>=f){g=document.createRange(),g.selectNodeContents(a),g.collapse(!1);var k=window.getSelection();k.removeAllRanges(),k.addRange(g)}f=j}var l=window.getSelection();l.removeAllRanges(),l.addRange(g)}else if(document.selection&&document.body.createTextRange){var m=document.body.createTextRange();m.moveToElementText(a),m.collapse(!0),m.moveEnd("character",c),m.moveStart("character",b),m.select()}}},{key:"restoreSelection",value:function(a){var b=window.getSelection();b.removeAllRanges(),b.addRange(a)}},{key:"encodeMathSymbols",value:function(a){if(this.options.mathquill)return a;for(var b in this.mathSymbolsMap){var c=new RegExp(b,"g");a=a.replace(c,this.mathSymbolsMap[b])}return a}},{key:"decodeMathSymbols",value:function(a){if(this.options.mathquill)return a;for(var b in this.mathSymbolsMapReverse){var c=new RegExp(b,"g");a=a.replace(c,this.mathSymbolsMapReverse[b])}return a}},{key:"equationEditorLaunch",value:function(){var a=$(document.getElementById(this.currentTextEditor)),b=$("#"+this.currentTextEditor);if(this.currentMathEditor="eq_"+PearsonGL.utils.randomString(9),this.launchEq(),this.textColor.indexOf("rgb")>-1&&(this.textColor=PearsonGL.utils.rgbColorToHex(this.textColor)),b[0]!==document.activeElement){b.focus();var c=b.text().split("").length;this.setSelectionRange(b[0],c,c)}document.execCommand("insertImage",0,"data:text/plain;,"+this.constants.EQ_SYMBOL);var d=a.data("fontsize")?2*a.data("fontsize"):4,e=d?" size='"+parseInt(d,10)+"'":"";b.find("img").replaceWith("<font "+e+' color="'+(this.textColor.indexOf("#")>-1?this.textColor:"#"+this.textColor)+"\">&#160;<span contenteditable='false' class='equation-span' id='"+this.currentMathEditor+"'></span>&#160;</font><span class='eq-symbol'>"+this.constants.EQ_SYMBOL+"</span>"),this._iosHackForInputs(),PearsonGL.globals.browserData&&PearsonGL.globals.browserData.specialFlags.isiOS&&(this.jObject.find(".editable-content-wrapper").removeClass("editable-content-wrapper-color-slide editable-content-wrapper-math-slide"),this.jObject.find(".text-math-picker-menu-wrapper").hide()),this._unlockTrash()}},{key:"launchEq",value:function(){var a=this,b=this;this.drawpadEE&&(this.drawpadEE.destroyEE(),this.drawpadEE=null),this.drawpadEE=new PearsonGL.Gadget.EquationEditorComponent({options:this.options,mathData:this.mathData[this.currentMathEditor],onDone:function(c){a.mathData[a.currentMathEditor]=c.getEEContent(),a.jObject.find(".equation-span").each(function(){if(b.mathData[$(this).attr("id")]&&$(b.mathData[$(this).attr("id")].present).find("p").length>0)$(this).html("").html(b.mathData[$(this).attr("id")].present);else{$(this)[0].nextSibling&&$(this)[0].nextSibling.nodeValue&&""===$(this)[0].nextSibling.nodeValue[0]&&($(this)[0].nextSibling.nodeValue=$(this)[0].nextSibling.nodeValue.substring(1)),$(this)[0].previousSibling&&$(this)[0].previousSibling.nodeValue&&""===$(this)[0].previousSibling.nodeValue[$(this)[0].previousSibling.nodeValue.length-1]&&($(this)[0].previousSibling.nodeValue=$(this)[0].previousSibling.nodeValue.substring(0,$(this)[0].previousSibling.nodeValue.length-1));var a=$(this).parent();$(this).remove(),a.is(":empty")&&a.remove()}});var d=$("#"+a.currentTextEditor),e=d.text(),f=0,g=e.split("");if(d[0]!==document.activeElement){d.focus();var h=d.text().split("").length;a.setSelectionRange(d[0],h,h)}for(var i=0;i<g.length;i++)if(e[i]===a.constants.EQ_SYMBOL){f=i;break}d.find(".eq-symbol").remove();var j=d.html().replace(b.constants.EQ_SYMBOL,"");d.html(j),a.setSelectionRange(document.getElementById(a.currentTextEditor),f,f),a.jObject.find("#"+a.currentTextEditor).find(".equation-span").unbind().click(function(b){a.equationClickHandler(b.currentTarget)}),PearsonGL.utils.initMathJax(a.jObject[0])}})}},{key:"equationClickHandler",value:function(a){a.nextSibling&&a.nextSibling.nodeValue&&""===a.nextSibling.nodeValue[0]&&(a.nextSibling.nodeValue=a.nextSibling.nodeValue.substring(1)),a=$(a),a.after("&#160;<span class='eq-symbol'>"+this.constants.EQ_SYMBOL+"</span>"),this.currentMathEditor=a.attr("id"),this.launchEq()}},{key:"buildMathSymbolsMap",value:function(){var a=this,b=this.buildTextboxMenu("",this.labelOpts,this.TEXT_BOX_BUTTONS,this.colorConfig.textColors);$(b).find(".m-picker").each(function(b,c){var d=$(c).attr("data-symbol"),e=encodeURI(d);d!==e&&"<"!==d&&">"!==d&&(a.mathSymbolsMap[d]=e,a.mathSymbolsMapReverse[e]=d)})}},{key:"announceTextBlur",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=a+" "+(this.canSave()?this.labelOpts.workWillSave:"");this.jObject.find(".hidden-label").text(b)}},{key:"setUserHasInteracted",value:function(){this.hasUserInteracted||(this.hasUserInteracted=!0,this.saveLearnerData())}},{key:"initCanSave",value:function(){"tinCan"===PearsonGL.globals.commType&&this.isCommEnabled()?(PearsonGL.logger.log("drawpad using tinCan save"),this.saveMode="tincan",this.getLearnerData()):this.isCommEnabled({windowPostMessage:!0})?(PearsonGL.logger.log("drawpad tin can not enabled, checking drawpad API - sending canSave message"),PearsonGL.globals.comm.firePostMessageEvent({type:"canSave"})):(PearsonGL.logger.log("drawpad comm not enabled"),this.saveMode="none")}},{key:"canSave",value:function(){return"tincan"===this.saveMode&&"normal"===PearsonGL.globals.comm.getMode()||"dpapi"===this.saveMode}},{key:"buildState",value:function(){var a=this,b={};return this.jObject.find(".draggable-text .rich-input-type").each(function(b,c){a.buildUserTextBoxData(c)}),this.jObject.find(".invisible-inputs .rich-input-type").each(function(b,c){a.buildAuthoredTextBoxData(c)}),b.id=this.options.scorm.id,b.textArray=this.encodeMathSymbols(JSON.stringify(this.options.textKeeper)),b.authoredTextArray=this.encodeMathSymbols(JSON.stringify(this.options.authoredTextKeeper)),b.mathData=encodeURIComponent(JSON.stringify(this.mathData)),b.shapeData=this.getShapeStatuses(),b.hasUserInteracted=this.hasUserInteracted,b.image=this.shouldSaveImage?this.canvas.toDataURL("image/png"):"",b.xCoords={w:this.canvas.width,h:this.canvas.height},b.orgDim={org_w:this.inlineMode?this.jObject.width():$(window).width(),org_h:this.inlineMode?this.jObject.height():$(window).height()},b}},{key:"restoreState",value:function(a){var b=this;if(!jQuery.isEmptyObject(a)){var c=new Image,d=PearsonGL.utils.isNonEmptyString(a.image);c.src=a.image,this.isLoading=!0,$(c).load(function(){b.backgroundTypeDrawpad?(b.ctx.drawImage(c,0,0,b.canvas.width,b.canvas.height),b.inlineMode?b.bgScale=(a.orgDim.org_w-b.leftGutter-b.rightGutter)/b.options.backgroundImage.width:b.bgScale=a.orgDim.org_h/b.options.backgroundImage.height,b.oldWindowWidth=a.orgDim.org_w):b.ctx.drawImage(c,0,0),b.lastUndo=b.ctx.getImageData(0,0,b.canvas.width,b.canvas.height),b._unlockTrash(),b.handleWindowResize(),b.isLoading=!1}),d||(this.isLoading=!1),this.hasUserInteracted=a.hasUserInteracted,this.shouldSaveImage=d,this.options.textKeeper=$.isArray(a.textArray)?a.textArray:JSON.parse(this.decodeMathSymbols(a.textArray)),this.options.authoredTextKeeper=$.isArray(a.authoredTextArray)?a.authoredTextArray:JSON.parse(this.decodeMathSymbols(a.authoredTextArray)),this.mathData=a.mathData?JSON.parse(decodeURIComponent(a.mathData)):{},this._redrawShapes(a.shapeData,1),this._redrawText(),this._redrawAuthoredText(),this._hideTypeBox(),this.jObject.find(".rich-input-type").blur(),PearsonGL.globals.player.options.pages.updatePageLock()}}},{key:"_setDirtyFlagOnHost",value:function(){"dpapi"===this.saveMode&&(this.isLoading||(PearsonGL.logger.log("drawpad sending saveRequired message, isDirty:true"),PearsonGL.globals.comm.firePostMessageEvent({type:"saveRequired",isDirty:!0})),this.hasSaved&&(PearsonGL.logger.log("drawpad sending saveRequired message, isDirty:false"),PearsonGL.globals.comm.firePostMessageEvent({type:"saveRequired",isDirty:!1})))}},{key:"saveStateDpApi",value:function(){var a=this.buildState();a.type="save",this.isCommEnabled({windowPostMessage:!0})&&(PearsonGL.logger.log("drawpad sending save message"),PearsonGL.logger.log(JSON.stringify(a)),PearsonGL.globals.comm.firePostMessageEvent(a)),this.numberOfTimesSaved++,this.sendAnalytics("clicked_save"),this.jObject.find(".drawpad-save").sliderbutton("disable"),this.hasSaved=!0,this._setDirtyFlagOnHost(),this.hasSaved=!1}},{key:"listenForMessages",value:function(a){PearsonGL.utils.browser.msie&&(a=$.parseJSON(a));var b=a.type;"willSave"===b?a.save&&(this.saveMode="dpapi",this.isCommEnabled({windowPostMessage:!0})&&(PearsonGL.logger.log("drawpad sending load message, ID: "+this.options.scorm.id),PearsonGL.globals.comm.firePostMessageEvent({type:"load",id:this.options.scorm.id})),this.addSaveButton()):"load"===b?this.restoreState(a):"rotated"===b?this.handleWindowResize():"scrolled"===b?this.jObject.find(".drawpad-toolbar-wrapper").css("top",a.scroll+"px"):"requestSave"===b&&this.saveStateDpApi()}},{key:"saveLearnerData",value:function(){if(this.isCommEnabled()){var a=this.hasUserInteracted;this.options.scorm.suspendData&&"tincan"===this.saveMode&&(this.options.scorm.suspendData.data=this.buildState());var b=this.options.scorm.interactions.map(function(b){var c=b.objectives[0];return{raw:a?c.score.max:0,min:c.score.min,max:c.score.max,scaled:a?1:0,learnerResponse:{},correctResponses:[],successStatus:a?"passed":"unknown",completionStatus:a?"completed":"incomplete",progressMeasure:1}});this.setLearnerData({gadgetId:this.gadgetUniqueId,data:this.options.scorm,results:b})}}},{key:"parseLearnerData",value:function(){this.restoreState(this.options.scorm.suspendData.data)}},{key:"stop",value:function(){clearInterval(this.resizeDetectInterval),this.saveLearnerData()}},{key:"gadgetUnload",value:function(){clearInterval(this.resizeDetectInterval),this.saveLearnerData()}},{key:"saveIfNeeded",value:function(){this.saveLearnerData(),this.isDirty=!1}}]),b}(PearsonGL.Gadget.GadgetBase),PearsonGL.Gadget.TextObj=function a(b,c,d,e){_classCallCheck(this,a),this.coords=b,this.text=c,this.index=parseInt(d,0),this.dimensions=e},window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.AudioPlayer=function(a,b,c){PearsonGL.Gadget.GadgetBase.call(this,b,c),b&&(this.labelOpts={playToolTip:"Play",pauseToolTip:"Pause",volControlToolTip:"Volume Control",ccShowToolTip:"Show Captions",ccHideToolTip:"Hide Captions",muteToolTip:"Mute",unmuteToolTip:"Unmute",scrubberHandleToolTip:"Seek slider. Current time:"},$.extend(this.options,{gadgetName:"AudioPlayer",objectiveDescription:"A audio player presents a single audio."}),this.jObject=$(a),this.initialize())},PearsonGL.Gadget.AudioPlayer.prototype=Object.create(PearsonGL.Gadget.GadgetBase.prototype),PearsonGL.Gadget.AudioPlayer.prototype.eventType={played:"played",paused:"paused"},PearsonGL.Gadget.AudioPlayer.prototype.initialize=function(){var a=this;this.hadPlayedOnce=!1,this.isCompleteInit=!1,this.hasStopPoints=!1,this.initGadget(this.options.gadgetName),this.playCtrl,this.pauseCtrl,this.progressBarCtrl,this.closedCaptionsCtrl,this.showCaptionCtrl,this.hideCaptionCtrl,this.volumeBarCtrl,this.currentTimeCtrl,this.volumeIndicatorCtrl,this.progressBarCtrl,this.audio,this.deferred=$.Deferred(),this.isPlaying=!1,this.playedDuration=0,this.startTime=0,this.stopTime=0,$.extend(this.options,{gadgetName:"AudioPlayer",objectiveDescription:"A audio player presents a single audio."}),this.isTouchDevice&&this.deferred.resolveWith(this),PearsonGL.utils.getGlobalizedLabel("audioplayer_globalization",a.globalizationComplete.bind(this),this.options.runtimejson.lang),this.getLearnerData({results:[{correctResponses:[{pattern:"Listened Audio"}],learnerResponse:"No Listen Audio"}]})},PearsonGL.Gadget.AudioPlayer.prototype.globalizationComplete=function(a){$.extend(this.labelOpts,a),this.setupGadget()},PearsonGL.Gadget.AudioPlayer.prototype.setupGadget=function(){var a=this.jObject,b="";a.addClass("audio-player-identifier audio-player"),this.options.maxWidth&&a.css("max-width",this.options.maxWidth+"px"),this.html5=!1;var c=document.createElement("audio");switch(c.canPlayType&&c.canPlayType("audio/mp3").replace(/no/,"")&&(this.html5=!0),this.options.type){case"scrubber":this.setupScrubberPlayer();break;case"button":this.setupButtonPlayer()}this.options.local&&this.options.local.length>0?b=PearsonGL.qtiEvaluator.evaluateAsset(this.options.local[0].src):this.options.external&&this.options.external.length>0&&(b=PearsonGL.utils.urlResolver(this.options.runtimejson.authoring?this.options.runtimejson.authoring.domains:void 0,this.options.external[0].domain,PearsonGL.qtiEvaluator.evaluateAsset(this.options.external[0].path))),this.html5?this.createHTML5Player(b):this.createFlashPlayer(b)},PearsonGL.Gadget.AudioPlayer.prototype.gadgetPageShowEvent=function(){this.playedDuration=0},PearsonGL.Gadget.AudioPlayer.prototype.createHTML5Player=function(a){var b=this;this.audio=$('<audio class="audio" preload="auto" src="'+a+'"></audio>'),this.jObject.append(this.audio),this.jObject.append('<div class="hidden-label aria-live" aria-live="polite"></div>'),this.audio.on("loadedmetadata",function(a){b.onloadedmetadata(this.duration)}),this.audio.on("timeupdate",function(){b.onTimeupdated(this.currentTime)}),this.audio.on("ended",function(){b.onEnded()}),this.audio.on("playing",function(a){b.isCompleteInit||b.onloadedmetadata(this.duration)})},PearsonGL.Gadget.AudioPlayer.prototype.createFlashPlayer=function(a){var b=this;this.audio=$('<div id="flash-audio"/>'),this.jObject.append(this.audio),this.audio.jPlayer({solution:"flash, html",supplied:"mp3",preload:"auto",swfPath:"js",ready:function(b){$(this).jPlayer("setMedia",{mp3:a})},loadedmetadata:function(){b.onloadedmetadata(event.jPlayer.status.duration)},timeupdate:function(a){b.onTimeupdated(a.jPlayer.status.currentTime)},play:function(a){b.isCompleteInit||b.onloadedmetadata(a.jPlayer.status.duration)},durationchange:function(a){this.duration!==a.jPlayer.status.duration&&b.onloadedmetadata(a.jPlayer.status.duration)},ended:function(){b.onEnded()}}).bind($.jPlayer.event.error,function(a){window.location.href.indexOf("file://")||"e_flash"!=a.jPlayer.error.type&&"e_url_not_set"!=a.jPlayer.error.type||alert("Enable Flash Trusted Locations for Content Object")})},PearsonGL.Gadget.AudioPlayer.prototype.onloadedmetadata=function(a){this.deferred.resolveWith(this),"scrubber"===this.options.type&&(this.setDuration(a),this.setupStopPoints(a)),this.isCompleteInit=!0},PearsonGL.Gadget.AudioPlayer.prototype.onEnded=function(a){this.playCtrl.show(),this.pauseCtrl.hide(),this.updateStopPointsHistory(0),this.isPlaying=!1,this.fireEvent(this.eventType.paused,this.currentTime)},PearsonGL.Gadget.AudioPlayer.prototype.onTimeupdated=function(a){var b,c=this;if("button"===this.options.type)return void(this.currentTime=a);for(this.setCurrentTime(a),c.isDownloadedSrt&&c.showCaption(),b=0;b<c.clipLength;b++)if(!c.options.clip[b].beenAt&&this.currentTime>=c.options.clip[b].time-.1){c.options.clip[b].beenAt=!0,c.reachToStopPoint(b,!0);break}this.setProgress(a)},PearsonGL.Gadget.AudioPlayer.prototype.focusElement=function(a){this.volumeIndicatorCtrl&&(this.volumeIndicatorCtrl.is(":visible")||this.volumeIndicatorCtrl.hasClass("text-button-focus"))&&this.jObject.find("#volume-bar-container").fadeOut().find("*").fadeOut(),PearsonGL.utils.focusItemOn(a)},PearsonGL.Gadget.AudioPlayer.prototype.formatTime=function(a){var b,c,d;return c=Math.floor(a/60),d=Math.floor(a%60),b=Math.floor(c/60),c%=60,b%=24,b<10&&(b="0"+b),c<10&&(c="0"+Math.floor(c)),d<10&&(d="0"+d),{hours:b,min:c,sec:d}},PearsonGL.Gadget.AudioPlayer.prototype.reachToStopPoint=function(a,b){var c,d,e,f=this,g=f.options.clip[a].time;f.pause(g),e=a+1,f.sendAnalytics("audio_reached_stopmarker_"+e+"of"+f.options.clip.length),c=this.jObject.find('.clip[data-id="'+a+'"]'),d=c.find(".clip-text"),d.is(":visible")?d.fadeOut():(f.jObject.find(".clip-text").fadeOut(),b?d.fadeIn().delay(3e3).fadeOut():d.fadeIn()),f.adjustProgressBar(g)},PearsonGL.Gadget.AudioPlayer.prototype.setProgress=function(a){var b=Math.floor(this.duration),c=Math.floor(a/b*100),d=this.formatTime(a),e=this.labelOpts.scrubberHandleToolTip+" "+d.min+":"+d.sec;this.progressBarCtrl.slider("option","value",c),this.progressIndicatorCtrl.attr({title:e,"aria-label":e})},PearsonGL.Gadget.AudioPlayer.prototype.setDuration=function(a){var b,c;this.duration=a,c=Math.floor(a/60),b=a%60,c=c<10?"0"+Math.floor(c):Math.floor(c),b=Math.floor(b)<10?"0"+Math.floor(b):Math.floor(b),this.jObject.find("#duration").text("/"+c+":"+b)},PearsonGL.Gadget.AudioPlayer.prototype.setupStopPoints=function(a){var b,c,d,e="clip-clicker",f=this,g=Math.floor(a);if(this.options.clip&&this.options.clip.length>0)for(this.options.clip.sort(function(a,b){return a.time-b.time}),f.clipLength=this.options.clip.length,"bottom"===this.options.popUpPos&&(e+=" bottom"),c=0;c<f.clipLength;c++)PearsonGL.utils.hasParmContent()&&(this.options.clip[c].time=PearsonGL.qtiEvaluator.evaluateFloat(this.options.clip[c].time).value),b=Math.floor(this.options.clip[c].time/g*100),d=$('<div data-id="'+c+'" id="clip'+c+'" class="clip" style="display:none;left:'+b+'%"></div>'),this.progressBarCtrl.append(d),void 0!==this.options.clip[c].text&&this.options.clip[c].text.length>0&&(this.options.clip[c].text=PearsonGL.qtiEvaluator.replaceParameters(this.options.clip[c].text),d.append('<div class="'+e+'"><label class="hidden-label">'+this.options.clip[c].text+'</label><div class="clip-text"><div class="c-text">'+this.options.clip[c].text+'</div><div class="clip-bk"></div><div class="clip-point"></div></div></div>'),d.find(".clip-clicker").sliderbutton({buttonClassName:"clip-clicker",slider:!1,clickFunction:function(a,b){f.reachToStopPoint(a.jObject.parent(".clip").attr("data-id"),!1)}}));this.progressBarCtrl.children(".clip").fadeIn(500,function(){var a=$(this).find(".clip-text");a.length>0&&a.css("left","-"+a.width()/2+"px")})},PearsonGL.Gadget.AudioPlayer.prototype.setVolume=function(a){this.deferred.done(function(){this.volumeLevel=a,this.volume=a/100,this.audio&&!this.isMuted&&(!0===this.html5?this.audio[0].volume=this.volume:this.audio.jPlayer("volume",this.volume)),this.setVolumeBar(this.volumeLevel)})},PearsonGL.Gadget.AudioPlayer.prototype.setVolumeBar=function(a){this.volumeBarCtrl.slider("option","value",a),this.volumeBarCtrl.find(".ui-slider-handle").attr({alt:a+"%",title:a+"%"})},PearsonGL.Gadget.AudioPlayer.prototype.setupPlayPauseControls=function(a){var b=this;this.playCtrl=$('<div class="play" id="play" data-icon="ic-arrow-play" aria-label="'+this.labelOpts.playToolTip+'" title="'+this.labelOpts.playToolTip+'"></div>'),this.pauseCtrl=$('<div class="pause" id="pause" data-icon="ic-arrow-play" aria-label="'+this.labelOpts.pauseToolTip+'" title="'+this.labelOpts.pauseToolTip+'"></div>').hide(),this.jObject.append(a.append(this.playCtrl).append(this.pauseCtrl)),this.playCtrl.sliderbutton({buttonClassName:"play",slider:!1,clickFunction:function(a,c,d){d.stopPropagation(),d.preventDefault(),b.play(),("key"===c||b.playCtrl.hasClass("text-button-focus"))&&(b.keyPressEventHandler(d,b.pauseCtrl),b.jObject.find(".aria-live").text(b.labelOpts.pauseToolTip))}}),this.pauseCtrl.sliderbutton({buttonClassName:"pause",slider:!1,clickFunction:function(a,c,d){d.stopPropagation(),d.preventDefault(),b.pause(),("key"===c||b.pauseCtrl.hasClass("text-button-focus"))&&(b.keyPressEventHandler(d,b.playCtrl),b.jObject.find(".aria-live").text(b.labelOpts.playToolTip))}})},PearsonGL.Gadget.AudioPlayer.prototype.keyPressEventHandler=function(a,b){a.stopImmediatePropagation(),this.focusElement(b),b.focus()},PearsonGL.Gadget.AudioPlayer.prototype.setupScrubberPlayer=function(){var a=this,b=$('<div class="controls scrubber"/>');this.setupPlayPauseControls(b),this.options.volumeBar&&!this.isTouchDevice&&this.setupVolumeControl(b),this.setupProgressBar(b),void 0!=a.options.srt&&a.options.srt.length>0&&(this.closedCaptionsCtrl=$('<div id="cc"></div>'),"bottom"===this.options.popUpPos?(this.closedCaptionsCtrl.addClass("bottom"),this.jObject.append(this.closedCaptionsCtrl)):this.closedCaptionsCtrl.insertBefore(b),a.getCaption()),!0===a.options.caption&&a.setupClosedCaptionToggleControl(b),b.on("keydown",function(b){switch(b.keyCode){case PearsonGL.utils.keyCode.space:b.stopPropagation(),b.preventDefault(),!0===a.isPlaying?a.pause():a.play();break;case PearsonGL.utils.keyCode.right:b.stopPropagation(),b.preventDefault(),a.currentTime<a.duration&&a.adjustProgressBar(a.currentTime+1);break;case PearsonGL.utils.keyCode.left:b.stopPropagation(),b.preventDefault(),a.currentTime>0&&a.adjustProgressBar(a.currentTime-1)}})},PearsonGL.Gadget.AudioPlayer.prototype.setupClosedCaptionToggleControl=function(a){var b=this;this.showCaptionCtrl=$('<div class="show-cc" id="show-cc" data-icon="ic-close-caption-on" title="'+this.labelOpts.ccShowToolTip+'" aria-label="'+this.labelOpts.ccShowToolTip+'"></div>').hide(),this.hideCaptionCtrl=$('<div class="hide-cc" id="hide-cc" data-icon="ic-close-caption-off" title="'+this.labelOpts.ccHideToolTip+'" aria-label="'+this.labelOpts.ccHideToolTip+'"></div>'),a.append(this.showCaptionCtrl),a.append(this.hideCaptionCtrl),this.showCaptionCtrl.sliderbutton({buttonClassName:"show-cc",slider:!1,clickFunction:function(a,c,d){d.stopPropagation(),d.preventDefault(),b.showClosedCaptionVisibility(!0),b.sendAnalytics("audio_closed_captioning_on"),("key"===c||b.showCaptionCtrl.hasClass("text-button-focus"))&&(b.keyPressEventHandler(d,b.hideCaptionCtrl),b.jObject.find(".aria-live").text(b.labelOpts.ccHideToolTip))}}),this.hideCaptionCtrl.sliderbutton({buttonClassName:"hide-cc",slider:!1,clickFunction:function(a,c,d){d.stopPropagation(),d.preventDefault(),b.showClosedCaptionVisibility(!1),b.sendAnalytics("audio_closed_captioning_off"),("key"===c||b.hideCaptionCtrl.hasClass("text-button-focus"))&&(b.keyPressEventHandler(d,b.showCaptionCtrl),b.jObject.find(".aria-live").text(b.labelOpts.ccShowToolTip))}}),this.showClosedCaptionVisibility(this.options.showCC)},PearsonGL.Gadget.AudioPlayer.prototype.setupVolumeControl=function(a){function b(){d=setTimeout(function(){g.find("*").fadeOut(),g.fadeOut()},600)}function c(){clearTimeout(d),g.is(":visible")?(g.find("*").show(),g.show()):(g.find("*").fadeIn(),g.fadeIn())}var d,e=this,f=this,g=$('<div id="volume-bar-container"></div>'),h=$('<div class="mute" id="mute" data-icon="ic-volume-off" tabindex="0" aria-label="'+this.labelOpts.muteToolTip+'" alt="'+this.labelOpts.muteToolTip+'" title="'+this.labelOpts.muteToolTip+'"/>'),i=$('<div style="display:none;" class="unmute" id="unmute" data-icon="ic-volume-on" tabindex="0" aria-label="'+this.labelOpts.unmuteToolTip+'" alt="'+this.labelOpts.unmuteToolTip+'" title="'+this.labelOpts.unmuteToolTip+'"/>');a.append(h),a.append(i),i.hide(),h.sliderbutton({buttonClassName:"mute",slider:!1,clickFunction:function(a,b,d){"key"===b||h.hasClass("text-button-focus")?(c(),e.volumeIndicatorCtrl.focus()):(e.mute(),h.hide(),i.show())}}),i.sliderbutton({buttonClassName:"unmute",slider:!1,clickFunction:function(a,b,d){"key"===b||i.hasClass("text-button-focus")?(c(),e.volumeIndicatorCtrl.focus()):(e.unmute(),h.show(),i.hide())}}),this.volumeBarCtrl=$('<div id="volume-bar"></div>'),a.append(g.append(this.volumeBarCtrl)),"bottom"===this.options.popUpPos&&g.addClass("bottom"),this.volumeBarCtrl.slider({orientation:"vertical",range:"min",min:0,max:100,create:function(a,b){f.volumeIndicatorCtrl=$(this).children(".ui-slider-handle"),f.volumeIndicatorCtrl.removeAttr("href").attr("tabindex","0"),f.volumeIndicatorCtrl.attr("role","slider"),f.volumeIndicatorCtrl.on("keydown",function(a){switch(a.keyCode){case PearsonGL.utils.keyCode.enter:case PearsonGL.utils.keyCode.escape:a.preventDefault();var b=h.is(":visible")?h:i;g.hide(),b.focus(),setTimeout(function(){PearsonGL.utils.focusItemOn(b)},30)}}),f.volumeIndicatorCtrl.on("keyup",function(a){switch(a.keyCode){case PearsonGL.utils.keyCode.tab:PearsonGL.utils.focusItemOn(this);break;case PearsonGL.utils.keyCode.up:a.stopPropagation(),a.preventDefault(),f.volumeLevel+1<=100&&f.setVolume(f.volumeLevel+1);break;case PearsonGL.utils.keyCode.down:a.stopPropagation(),a.preventDefault(),f.volumeLevel-1>=0&&f.setVolume(f.volumeLevel-1);break;case PearsonGL.utils.keyCode.left:case PearsonGL.utils.keyCode.right:a.stopImmediatePropagation()}}).blur(function(){f.focusElement()})},stop:function(a,b){f.sendAnalytics("audio_dragged_volume")},slide:function(a,b){f.setVolume(b.value)}}),g.hover(function(){c()},function(){b()}),h.hover(function(){c()},function(){b()}),i.hover(function(){c()},function(){b()}),g.hide(),this.setVolume(100*PearsonGL.globals.player.getMasterVolume())},PearsonGL.Gadget.AudioPlayer.prototype.mute=function(){this.isMuted=!0,!0===this.html5?this.audio[0].volume=0:this.audio.jPlayer("volume",0)},PearsonGL.Gadget.AudioPlayer.prototype.unmute=function(){this.isMuted=!1,!0===this.html5?this.audio[0].volume=this.volume:this.audio.jPlayer("volume",this.volume)},PearsonGL.Gadget.AudioPlayer.prototype.getFormattedTime=function(a){return $.isNumeric(a)?parseFloat(a.toFixed(2)):a},PearsonGL.Gadget.AudioPlayer.prototype.setupProgressBar=function(a){var b=this,c=this.jObject;a.append('<div class="progress-wrapper"><div id="progress"></div></div>'),a.append('<div id="progress-time"><div id="current-time">00:00</div><div id="duration">/00:00</div></div>'),this.progressBarCtrl=c.find("#progress"),this.currentTimeCtrl=c.find("#current-time"),this.progressBarCtrl.slider({range:"min",min:0,max:100,create:function(a,c){b.progressIndicatorCtrl=$(this).children(".ui-slider-handle"),b.progressIndicatorCtrl.removeAttr("href"),b.progressIndicatorCtrl.on("keyup",function(a){switch(a.keyCode){case PearsonGL.utils.keyCode.tab:b.focusElement(this)}})},start:function(a,c){a.stopPropagation(),b.isPlaying&&b.sendPlayedDuration(),$(a.toElement).hasClass("clip-clicker")&&a.preventDefault()},slide:function(a,c){if(c.value>=b.maxSlider)return!1;b.currentTime=b.duration*c.value/100,!0===b.html5?b.audio[0].currentTime=b.currentTime:b.audio.data("jPlayer").status.paused?b.audio.jPlayer("pause",b.currentTime):b.audio.jPlayer("play",b.currentTime),b.updateStopPointsHistory(b.currentTime)},stop:function(a,c){b.startTime=b.currentTime,b.sendAnalytics("audio_dragged_progress_bar")}});var d=b.formatTime(this.currentTime||0),e=this.labelOpts.scrubberHandleToolTip+" "+d.min+":"+d.sec;this.progressIndicatorCtrl.attr({title:e,"aria-label":e,tabindex:"0",role:"slider"})},PearsonGL.Gadget.AudioPlayer.prototype.getCaption=function(){var a=this,b=PearsonGL.qtiEvaluator.replaceParameters(a.options.srt);b&&$.ajax({type:"GET",dataType:"text",url:b,success:function(b){a.isDownloadedSrt=!0,a.parseSrt(b)},error:function(b){a.isDownloadedSrt=!1}})},PearsonGL.Gadget.AudioPlayer.prototype.parseSrt=function(a){var b,c,d,e,f,g,h=this,i=a;for(i=i.replace(/\r\r\n/g,"\r\n"),i=i.replace(/\r\n[ \t]+\r\n|\r[ \t]+\r|\n[ \t]+\n/g,"<BR><BR>"),i=i.replace(/\r\n|\r|\n/g,"<BR>"),c=i.split("<BR><BR>"),this.captions=[],b=0;b<c.length;b++)if(st=c[b].split("<BR>"),st.length>=2){if(number=st[0],e=st[1].split(" --\x3e ")[0],f=st[1].split(" --\x3e ")[1],g="",st.length>2)for(g=st[2],d=3;d<st.length;d++)g+="\n"+st[d];this.captions.push({startTime:h.convertTimeToSec(e),endTime:h.convertTimeToSec(f),caption:g})}},PearsonGL.Gadget.AudioPlayer.prototype.showCaption=function(){var a,b,c=!1,d=this.captions.length;if(this.showCaptions&&this.captions)if((b=this.currentTime)-this.captions[d-1].endTime>=0)this.closedCaptionsCtrl.html("");else{for(a=0;a<d;a++)if(b>=this.captions[a].startTime&&b<=this.captions[a].endTime){this.closedCaptionsCtrl.html(this.captions[a].caption),this.curCaptionFrame=a,c=!0;break}c||this.closedCaptionsCtrl.html("")}},PearsonGL.Gadget.AudioPlayer.prototype.updateStopPointsHistory=function(a){var b,c=this;if(void 0!==c.options.clip&&c.options.clip.length>0)for(b=0;b<c.clipLength;b++)c.options.clip[b].time<=a?c.options.clip[b].beenAt=!0:c.options.clip[b].beenAt=!1},PearsonGL.Gadget.AudioPlayer.prototype.setupButtonPlayer=function(){var a=$('<div class="controls button"/>');this.setupPlayPauseControls(a)},PearsonGL.Gadget.AudioPlayer.prototype.showClosedCaptionVisibility=function(a){this.showCaptions=a,a?(this.closedCaptionsCtrl&&this.closedCaptionsCtrl.show(),this.showCaptionCtrl.hide(),this.hideCaptionCtrl.show()):(this.closedCaptionsCtrl&&this.closedCaptionsCtrl.hide(),this.hideCaptionCtrl.hide(),this.showCaptionCtrl.show())},PearsonGL.Gadget.AudioPlayer.prototype.setCurrentTime=function(a){var b=this.formatTime(a);this.currentTime=a,this.currentTimeCtrl.text(b.min+":"+b.sec)},PearsonGL.Gadget.AudioPlayer.prototype.adjustProgressBar=function(a){this.setCurrentTime(a),this.updateStopPointsHistory(a),this.setProgress(a),!0===this.html5?this.audio[0].currentTime=a:this.audio.data("jPlayer").status.paused?this.audio.jPlayer("pause",a):this.audio.jPlayer("play",a)},PearsonGL.Gadget.AudioPlayer.prototype.convertTimeToSec=function(a){var b,c,d=0;if(a)for(b=a.split(":"),c=0;c<b.length;c++)d=60*d+parseFloat(b[c].replace(",","."));return d},PearsonGL.Gadget.AudioPlayer.prototype.play=function(){this.deferred.done(function(){this.startTime=this.currentTime,this.html5?this.audio[0].play():this.audio.jPlayer("play"),this.isPlaying=!0,this.fireEvent(this.eventType.played,this.currentTime),this.hadPlayOnce||(this.isCommEnabled()&&this.setLearnerData({results:[{learnerResponse:"Listened to Audio",raw:this.options.scorm.interactions[0].objectives[0].score.max,progressMeasure:1,completionStatus:"completed",successStatus:"passed"}]}),this.hadPlayOnce=!0),this.playCtrl.hide(),this.pauseCtrl.show(),this.sendAnalytics("audio_play_pressed")})},PearsonGL.Gadget.AudioPlayer.prototype.fireEvent=function(a,b){$(window).trigger(a,{sourceId:this.gadgetId,data:b,source:this})},PearsonGL.Gadget.AudioPlayer.prototype.pause=function(a){this.deferred.done(function(){this.isPlaying&&(this.html5?this.audio[0].pause(a):this.audio.jPlayer("pause",a),this.fireEvent(this.eventType.paused,this.currentTime),this.sendPlayedDuration(),this.isPlaying=!1,this.pauseCtrl.hide(),this.playCtrl.show(),this.sendAnalytics("audio_play_paused"))})},PearsonGL.Gadget.AudioPlayer.prototype.sendPlayedDuration=function(){void 0===this.startTime&&(this.startTime=0),this.playedDuration+=this.currentTime-this.startTime,this.playedDuration>0&&(this.sendAnalytics("audio_played_duration_of_"+this.duration+"_seconds",this.getFormattedTime(this.playedDuration)),this.playedDuration=0)},PearsonGL.Gadget.AudioPlayer.prototype.stop=function(){this.sendPlayedDuration(),this.isPlaying&&this.pause()};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.TileSort=function(a){function b(a,c,d){var e;_classCallCheck(this,b);var f=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return f.labelOpts={ofLabel:"of",closeToolTip:"Close",selectedText:"SELECTED",correctText:"Correct",incorrectText:"Incorrect",yesToolTip:"Yes",noToolTip:"No",customCheckAnswer:"Check Answer",customSolution:"Solution",customRestButton:"Start Over",customTryAgain:"Try Again",customMyAnswers:"Show My Answers",capacityError:"<b>Whoops!</b></br> This area is full. You can remove an item to make room.",previousButton:"Previous",nextButton:"Next"},f.options=$.extend(!0,{popupAudio:{audioClass:".popupsound",isPopAudio:!0,trigger:!0},gadgetName:"TileSort",objectiveDescription:"User matches tiles to categories and is allowed a set number of attempts.",fadeOutFeedback:!0},f.options||{}),c?(c.feedback&&(void 0!=c.feedback.markTiles||void 0!=c.feedback.showGraphicalTreatment&&0!=c.feedback.showGraphicalTreatment?void 0==c.feedback.markTiles&&1==c.feedback.showGraphicalTreatment&&(c.feedback.markTiles=!1):c.feedback.markTiles=!0,c.feedback.showGraphicalTreatment=!c.feedback.markTiles),c.correctAudio&&(c.correctAudio=PearsonGL.qtiEvaluator.replaceParameters(c.correctAudio)),c.inCorrectAudio&&(c.inCorrectAudio=PearsonGL.qtiEvaluator.replaceParameters(c.inCorrectAudio)),f.authOptions=$.extend(!0,{},c),f.theGadget=null,f.jObject=$(a),f.initialize(),f.addAccessibility(f.jObject),e=f.theGadget,_possibleConstructorReturn(f,e)):_possibleConstructorReturn(f)}return _inherits(b,a),_createClass(b,[{key:"initialize",value:function(){var a=this;this.initGadget(this.options.gadgetName),PearsonGL.utils.getGlobalizedLabel("tilesort_globalization",function(b){a.transferLabels(b),delete a.authOptions.scorm,$.extend(!0,a.options,a.authOptions),a.options.labelOpts=a.labelOpts,a.options.custom?a.theGadget=new PearsonGL.Gadget.CustomTileSort(a.jObject,a.options,a.gadgetUniqueId):a.theGadget=new PearsonGL.Gadget.OriginalTileSort(a.jObject,a.options,a.gadgetUniqueId)},this.options.runtimejson.lang)}},{key:"transferLabels",value:function(a){var b=this.options,c=c=$.extend(!0,this.labelOpts,a);b.selectedText=c.selectedText,b.correctText=c.correctText,b.incorrectText=c.incorrectText,b.closeToolTip=c.closeToolTip,b.yesToolTip=c.yesToolTip,b.noToolTip=c.noToolTip,b.ofLabel=c.ofLabel,b.nextButton=c.nextButton,b.previousButton=c.previousButton,b.buttons&&(b.buttons.resetButtonGroup&&(b.buttons.resetButtonGroup[0].resetButtonText=c.customRestButton),b.buttons.showAnswerButtonGroup&&(b.buttons.showAnswerButtonGroup[0].showAnswerButton=c.customSolution,b.buttons.showAnswerButtonGroup[0].showMyAnswersButton=c.customMyAnswers),b.buttons.checkAnswerButton=c.customCheckAnswer,b.buttons.tryAgainButton=c.customTryAgain)}},{key:"gadgetUnload",value:function(){this.isCommEnabled()&&this.hasBeenInteractedWith&&this.saveLearnerData(!0)}},{key:"fireEvent",value:function(a,b){var c=void 0,d={sourceId:this.gadgetUniqueId};c=a?b?"finalCorrect":"firstCorrect":b?"finalIncorrect":"incorrect","finalCorrect"!=c&&"finalIncorrect"!=c&&"firstCorrect"!=c||(this.jObject.addClass("completed"),"firstCorrect"==c&&this.jObject.addClass("first-correct"),"finalCorrect"==c&&this.jObject.addClass("final-correct")),$(window).trigger(c,d)}}]),b}(PearsonGL.Gadget.GadgetBase),PearsonGL.Gadget.CustomTileSort=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));if(e.options=$.extend(!0,{gadgetName:"TileSortCust",scoreFinalized:!1},e.options||{}),!c)return _possibleConstructorReturn(e);if(e.jObject=$(a),e.gadgetUniqueId=d,e.labelOpts=c.labelOpts,e.quit=!1,c.custom=c.custom[0],$.extend(!0,e.options,c),e.options.numberOfTiles&&(e.options.numberOfTiles=parseInt(PearsonGL.qtiEvaluator.replaceParameters(e.options.numberOfTiles))),e.options.custom){if(e.options.custom.single&&(e.options.custom.single.cellWidth&&(e.options.custom.single.cellWidth=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(e.options.custom.single.cellWidth))),e.options.custom.single.cellHeight&&(e.options.custom.single.cellHeight=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(e.options.custom.single.cellHeight))),e.options.custom.single.dropZones))for(var f=0;f<e.options.custom.single.dropZones.length;f++){var g=e.options.custom.single.dropZones[f];g.xcoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(g.xcoord)),g.ycoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(g.ycoord)),g.matchId&&(g.matchId=PearsonGL.qtiEvaluator.replaceParameters(g.matchId)),g.width&&(g.width=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(g.width))),g.height&&(g.height=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(g.height)))}if(e.options.custom.bucket&&(e.options.custom.bucket.cellWidth&&(e.options.custom.bucket.cellWidth=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(e.options.custom.bucket.cellWidth))),e.options.custom.bucket.cellHeight&&(e.options.custom.bucket.cellHeight=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(e.options.custom.bucket.cellHeight))),e.options.custom.bucket.verticalSpacing&&(e.options.custom.bucket.verticalSpacing=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(e.options.custom.bucket.verticalSpacing))),e.options.custom.bucket.horizonalSpacing&&(e.options.custom.bucket.horizonalSpacing=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(e.options.custom.bucket.horizonalSpacing))),e.options.custom.bucket.exceedsCapacityError&&(e.options.custom.bucket.exceedsCapacityError=PearsonGL.qtiEvaluator.replaceParameters(e.options.custom.bucket.exceedsCapacityError)),e.options.custom.bucket.dropZones))for(var h=0;h<e.options.custom.bucket.dropZones.length;h++){var i=e.options.custom.bucket.dropZones[h];i.xcoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(i.xcoord)),i.ycoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(i.ycoord)),i.cols=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(i.cols)),i.rows=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(i.rows)),i.matchId&&(i.matchId=PearsonGL.qtiEvaluator.replaceParameters(i.matchId)),i.width&&(i.width=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(i.width))),i.height&&(i.height=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(i.height))),i.vspace&&(i.vspace=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(i.vspace))),i.hspace&&(i.hspace=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(i.hspace))),i.max&&(i.max=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(i.max)))}if(e.options.hasOwnProperty("custom"))if(e.options.custom.tile.hasOwnProperty("cloneTiles")){if(!0===e.options.custom.tile.cloneTiles){if(e.options.custom.tile.hasOwnProperty("textTiles"))for(tileProperty in e.options.custom.tile.textTiles)e.options.custom.tile.textTiles[tileProperty].cloneTiles=!0;else if(e.options.custom.tile.hasOwnProperty("imageTiles"))for(tileProperty in e.options.custom.tile.imageTiles)e.options.custom.tile.imageTiles[tileProperty].cloneTiles=!0}else if(e.options.custom.tile.cloneTiles=!0,e.options.custom.tile.hasOwnProperty("textTiles"))for(tileProperty in e.options.custom.tile.textTiles)e.options.custom.tile.textTiles[tileProperty].cloneTiles=!1;else if(e.options.custom.tile.hasOwnProperty("imageTiles"))for(tileProperty in e.options.custom.tile.imageTiles)e.options.custom.tile.imageTiles[tileProperty].cloneTiles=!1}else e.options.custom.tile.cloneTiles=!0;if(e.options.custom.tile){if(e.options.custom.tile.width&&(e.options.custom.tile.width=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(e.options.custom.tile.width))),e.options.custom.tile.height&&(e.options.custom.tile.height=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(e.options.custom.tile.height))),e.options.custom.tile.textTiles)for(var j=0;j<e.options.custom.tile.textTiles.length;j++){var k=e.options.custom.tile.textTiles[j];k.xcoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(k.xcoord)),k.ycoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(k.ycoord)),k.matchIds&&(k.matchIds=PearsonGL.qtiEvaluator.replaceParameters(k.matchIds)),k.width&&(k.width=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(k.width))),k.height&&(k.height=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(k.height)))}if(e.options.custom.tile.imageTiles)for(var l=0;l<e.options.custom.tile.imageTiles.length;l++){var m=e.options.custom.tile.imageTiles[l];m.xcoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(m.xcoord)),m.ycoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(m.ycoord)),m.matchIds&&(m.matchIds=PearsonGL.qtiEvaluator.replaceParameters(m.matchIds)),m.tileWidth&&(m.tileWidth=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(m.tileWidth))),m.tileHeight&&(m.tileHeight=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(m.tileHeight)))}}if(e.options.custom.textLabels)for(var n=0;n<e.options.custom.textLabels.length;n++){var o=e.options.custom.textLabels[n];o.xcoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(o.xcoord)),o.ycoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(o.ycoord)),o.width&&(o.width=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(o.width)))}if(e.options.custom.imageLabels)for(var p=0;p<e.options.custom.imageLabels.length;p++){var q=e.options.custom.imageLabels[p];q.xcoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(q.xcoord)),q.ycoord=parseFloat(PearsonGL.qtiEvaluator.replaceParameters(q.ycoord))}}"value"==e.options.custom.tsmode&&(e.options.custom.valueMode=!0),e.jObject.addClass("custom-sorter-identifier"),e.jObject.attr("id",PearsonGL.utils.randomString(9)),e.fakeTileName="djnone",e.totalTriesCount=0,e.progressBarOptions={useGraphical:!1,useNumeric:!1,dropZoneCount:0},e.scormData={tilePattern:[],numberOfTries:0},e.options.submitScoreOnFirstAttempt=e.options.runtimejson.submitScoreOnFirstAttempt,e.options.showCorrectAnswerOnFinalAttempt=e.options.runtimejson.showCorrectAnswerOnFinalAttempt,e.options.showDropzoneFullMessage=e.options.runtimejson.showDropzoneFullMessage;var r=e.options.custom,s=r.backgroundImage,t=void 0,u=e,v=e.jObject,w=void 0,x=void 0;return t=document.createElement("img"),t.setAttribute("class","main-background"),$(t).attr({alt:PearsonGL.qtiEvaluator.replaceParameters(s.title)}),e.dragTiles={},t.onload=function(){u.allElement=[],u.allReadOrder=[],u.allDraggables=[],u.allDroppables=[],u.allLabels=[],v.append(this);var a=t.naturalWidth,b=t.naturalHeight;tileMax=0,dropMax=0,labelMax=0,tsHeight=0,tsWidth=0,u.options.custom.single.dropZones&&$(u.options.custom.single).each(function(a){var b=u.options.custom.single.cellHeight||u.options.custom.single.dropZones[a].height,c=parseInt(u.options.custom.single.dropZones[a].ycoord);0===dropMax&&(dropMax=c+b),dropMax<c+b&&(dropMax=c+b)}),u.options.custom.bucket.dropZones&&$(u.options.custom.bucket).each(function(a){var b=u.options.custom.bucket.cellHeight||u.options.custom.bucket.dropZones[a].height,c=parseInt(u.options.custom.bucket.dropZones[a].ycoord);0===dropMax&&(dropMax=c+b),dropMax<c+b&&(dropMax=c+b)}),$(u.options.custom.tile.textTiles).each(function(a){var b=u.options.custom.tile.height||u.options.custom.tile.textTiles[a].height,c=parseInt(u.options.custom.tile.textTiles[a].ycoord);0===tileMax&&(tileMax=c+b),tileMax<c+b&&(tileMax=c+b)}),$(u.options.custom.tile.imageTiles).each(function(a){var b=u.options.custom.tile.height||u.options.custom.tile.imageTiles[a].tileHeight,c=parseInt(u.options.custom.tile.imageTiles[a].ycoord);0===tileMax&&(tileMax=c+b),tileMax<c+b&&(tileMax=c+b)}),$(u.options.custom.tile.textImageTiles).each(function(a){var b=u.options.custom.tile.height||u.options.custom.tile.textImageTiles[a].tileHeight,c=parseInt(u.options.custom.tile.textImageTiles[a].ycoord);0===tileMax&&(tileMax=c+b),tileMax<c+b&&(tileMax=c+b)}),$(u.options.custom.textLabels).each(function(a){var b=parseInt(u.options.custom.textLabels[a].ycoord);0===labelMax&&(labelMax=b),labelMax<b&&(labelMax=b)}),$(u.options.custom.imageLabels).each(function(a){var b=parseInt(u.options.custom.imageLabels[a].ycoord);0===labelMax&&(labelMax=b),labelMax<b&&(labelMax=b)}),tsHeight=Math.max(b,tileMax,dropMax,labelMax),tileMax=0,dropMax=0,labelMax=0,u.options.custom.single.dropZones&&$(u.options.custom.single).each(function(a){var b=u.options.custom.single.cellWidth||u.options.custom.single.dropZones[a].width,c=parseInt(u.options.custom.single.dropZones[a].xcoord);0===dropMax&&(dropMax=c+b),dropMax<c+b&&(dropMax=c+b)}),u.options.custom.bucket.dropZones&&$(u.options.custom.bucket).each(function(a){var b=u.options.custom.bucket.cellWidth||u.options.custom.bucket.dropZones[a].width,c=parseInt(u.options.custom.bucket.dropZones[a].xcoord);0===dropMax&&(dropMax=c+b),dropMax<c+b&&(dropMax=c+b)}),$(u.options.custom.tile.textTiles).each(function(a){var b=u.options.custom.tile.width||u.options.custom.tile.textTiles[a].width,c=parseInt(u.options.custom.tile.textTiles[a].xcoord);0===tileMax&&(tileMax=c+b),tileMax<c+b&&(tileMax=c+b)}),$(u.options.custom.tile.imageTiles).each(function(a){var b=u.options.custom.tile.height||u.options.custom.tile.imageTiles[a].tileWidth,c=parseInt(u.options.custom.tile.imageTiles[a].xcoord);0===tileMax&&(tileMax=c+b),tileMax<c+b&&(tileMax=c+b)}),$(u.options.custom.tile.textImageTiles).each(function(a){var b=u.options.custom.tile.height||u.options.custom.tile.textImageTiles[a].tileWidth,c=parseInt(u.options.custom.tile.textImageTiles[a].xcoord);0===tileMax&&(tileMax=c+b),tileMax<c+b&&(tileMax=c+b)}),$(u.options.custom.textLabels).each(function(a){var b=parseInt(u.options.custom.textLabels.width)||0,c=parseInt(u.options.custom.textLabels[a].xcoord);0===labelMax&&(labelMax=c+b),labelMax<c+b&&(labelMax=c+b)}),$(u.options.custom.imageLabels).each(function(a){var b=parseInt(u.options.custom.imageLabels[a].xcoord);0===labelMax&&(labelMax=b),labelMax<b&&(labelMax=b)}),tsWidth=dropWidth=Math.max(a,tileMax,dropMax,labelMax),v.width(tsWidth).height(tsHeight),v.append("<div class='custom-holder' style='width:"+tsWidth+"px;height:"+tsHeight+"px;'></div>"),v.find(".main-background").css({maxWidth:a+"px"}),u.isInstant="instantFeedback"===u.options.feedbackType,u.buildLabels(),u.buildTiles(),u.buildDropZones(),u.dragStatusLive=$('<div aria-live="assertive" class="drag-status-live hidden-label"></div>'),v.find(".custom-holder").append(u.dragStatusLive),u.addButtons(),u.addDragEvents(),u.randomizeAnimations(),u.buildProgressBar(),u.scaled=$(window).height()/b,u.orgImgHeight=b*u.scaled,u.orgImgWidth=a*u.scaled,r.hideTileBackground&&v.find(".c-tile").addClass("no-bk"),r.hideDropZoneBackground&&v.find(".s-drop-zone, .b-drop-zone").addClass("no-bk"),u.getLearnerData({type:"matching"}),u.figureOutNumOfTiles()},t.src=PearsonGL.qtiEvaluator.evaluateAsset(s.src),"string"==typeof u.options.correctAudio&&""!==u.options.correctAudio&&(w=$("<div class='dnd-correct-audio' style='display:none'></div>"),w.appendTo(v),w.audioComponent({src:u.options.correctAudio,trigger:!0,type:"hover"},e.gadgetUniqueId)),"string"==typeof u.options.inCorrectAudio&&""!==u.options.inCorrectAudio&&(x=$("<div class='dnd-in-correct-audio' style='display:none'></div>"),x.appendTo(v),x.audioComponent({src:u.options.inCorrectAudio,trigger:!0,type:"hover"},e.gadgetUniqueId)),v.delegate(".modal-dialog-window","click",function(){u.removeDialogs()}),e.img_correctIndex=0,e.img_incorrectIndex=0,e.txt_correctIndex=0,e.txt_incorrectIndex=0,u.startClicked=0,setTimeout(function(){$(window).trigger(u.gadgetUniqueId+"stopwatchScoreCheck",u)}),$(window).on(u.gadgetUniqueId+"stopwatchStartPage",function(a,b){u.stopwatch=b,u.stopwatch.options.associatedGadgetId===u.gadgetUniqueId&&(v.prepend('<div class="stopwatch-modal"><div class="stopwatch-message"></div><div class="stopwatch-button"></div></div>'),v.find(".stopwatch-modal").attr("tabindex","0"),v.find(".stopwatch-modal").siblings().css({visibility:"hidden"}),u.stopwatch.options.scorm.hasOwnProperty("suspendData")?u.stopwatch.options.scorm.suspendData.data.startClicked?(v.find(".stopwatch-button").hide(),v.find(".stopwatch-modal").show(),v.find(".stopwatch-message").remove(),v.find(".stopwatch-modal").append('<div class="stopwatch-message"></div>'),u.stopwatch.options.hasOwnProperty("resumeButtonMessageText")&&u.stopwatch.options.resumeButtonMessageText[0].hasOwnProperty("resumeMessageList")?(v.find(".stopwatch-message").append("<p>"+u.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].resumeMessage+"</p>"),u.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.src&&v.find(".stopwatch-message").audioComponent({src:u.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.src,trigger:!0,type:u.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.type},this.gadgetUniqueId)):v.find(".stopwatch-message").append("<p>"+u.stopwatch.labelOpts.pauseMenuText+"</p>"),$(window).trigger(u.gadgetUniqueId+"pauseClock",u.stopwatch.options)):u.stopwatch.options.scorm.suspendData.data.reset?($(window).trigger(u.gadgetUniqueId+"setClock",u.stopwatch.options),v.find(".stopwatch-modal").siblings().css({visibility:"visible"}),v.find(".stopwatch-modal").hide()):(u.stopwatch.options.start?(v.find(".stopwatch-message").append("<p>"+u.stopwatch.options.start[0].startMessage+"</p>"),u.stopwatch.options.start[0].audioComponent.src&&v.find(".stopwatch-message").audioComponent({src:u.stopwatch.options.start[0].audioComponent.src,trigger:!0,type:u.stopwatch.options.start[0].audioComponent.type},this.gadgetUniqueId)):v.find(".stopwatch-message").append("<p>"+u.stopwatch.labelOpts.startMenuText+"</p>"),v.find(".stopwatch-button").sliderbutton({buttonClassName:"stopwatch-button",slider:!0,buttonText:u.stopwatch.labelOpts.startText,clickFunction:function(a){u.startClicked++,v.find(".stopwatch-modal").siblings().css({visibility:"visible"}),setTimeout(function(){v.find(".stopwatch-modal").hide()},100),$(window).trigger(u.gadgetUniqueId+"stopwatchStartClock","startClock")}})):(u.stopwatch.options.start?(v.find(".stopwatch-message").append("<p>"+u.stopwatch.options.start[0].startMessage+"</p>"),u.stopwatch.options.start[0].audioComponent.src&&v.find(".stopwatch-message").audioComponent({src:u.stopwatch.options.start[0].audioComponent.src,trigger:!0,type:u.stopwatch.options.start[0].audioComponent.type},this.gadgetUniqueId)):v.find(".stopwatch-message").append("<p>"+u.stopwatch.labelOpts.startMenuText+"</p>"),v.find(".stopwatch-button").sliderbutton({buttonClassName:"stopwatch-button",slider:!0,buttonText:u.stopwatch.labelOpts.startText,clickFunction:function(a){u.startClicked++,v.find(".stopwatch-modal").siblings().css({visibility:"visible"}),setTimeout(function(){v.find(".stopwatch-modal").hide()},100),$(window).trigger(u.gadgetUniqueId+"stopwatchStartClock","startClock")}})))}),$(window).on(u.gadgetUniqueId+"stopwatchPausePage",function(a,b){u.hasOwnProperty("stopwatch")&&(v.find(".stopwatch-button").hide(),$(window).trigger(u.gadgetUniqueId+"pauseClock","pause"),v.find(".stopwatch-modal").siblings().css({visibility:"hidden"}),v.find(".stopwatch-modal").show(),v.find(".stopwatch-message").remove(),v.find(".stopwatch-modal").append('<div class="stopwatch-message"></div>'),u.stopwatch.options.hasOwnProperty("resumeButtonMessageText")&&u.stopwatch.options.resumeButtonMessageText[0].hasOwnProperty("resumeMessageList")?(v.find(".stopwatch-message").append("<p>"+u.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].resumeMessage+"</p>"),u.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.src&&v.find(".stopwatch-message").audioComponent({src:u.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.src,trigger:!0,type:u.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.type},this.gadgetUniqueId)):v.find(".stopwatch-message").append("<p>"+u.stopwatch.labelOpts.pauseMenuText+"</p>"))}),$(window).on(u.gadgetUniqueId+"resumeClock",function(a,b){v.find(".stopwatch-modal").siblings().css({visibility:"visible"}),v.find(".stopwatch-modal").hide()}),$(window).on(u.gadgetUniqueId+"stopwatchResetStart",function(a,b){v.find(".stopwatch-message").remove(),v.find(".stopwatch-button").remove(),v.find(".stopwatch-modal").prepend('<div class="stopwatch-message"></div>'),v.find(".stopwatch-modal").append('<div class="stopwatch-button"></div>'),u.stopwatch.options.start?(v.find(".stopwatch-message").append("<p>"+u.stopwatch.options.start[0].startMessage+"</p>"),u.stopwatch.options.start[0].audioComponent.src&&v.find(".stopwatch-message").audioComponent({src:u.stopwatch.options.start[0].audioComponent.src,trigger:!0,type:u.stopwatch.options.start[0].audioComponent.type},this.gadgetUniqueId)):v.find(".stopwatch-message").append("<p>"+u.stopwatch.labelOpts.startMenuText+"</p>"),v.find(".stopwatch-button").sliderbutton({buttonClassName:"stopwatch-button",slider:!0,buttonText:u.stopwatch.labelOpts.startText,clickFunction:function(a){u.startClicked++,v.find(".stopwatch-modal").siblings().css({visibility:"visible"}),setTimeout(function(){v.find(".stopwatch-modal").hide()},100),$(window).trigger(u.gadgetUniqueId+"stopwatchStartClock","startClock")}}),v.find(".stopwatch-button").show(),v.find(".stopwatch-modal").show()}),$(window).on(u.gadgetUniqueId+"stopwatchSaveData",function(a,b){u.stopwatch=b,u.options.scorm.suspendData&&u.options.scorm.suspendData.data&&(u.options.scorm.suspendData.data.stopwatch=b.options.scorm.suspendData.data)}),e}return _inherits(b,a),_createClass(b,[{key:"figureOutNumOfTiles",value:function(){var a=this,b=this.jObject;if(a.options.numberOfTiles){if(a.scormData.tilesUsed)for(var c=0;c<a.scormData.tilesUsed.length;c++)b.find(".custom-holder").children('.c-tile[data-id="'+a.scormData.tilesUsed[c].id+'"]').remove();else{a.scormData.tilesUsed=[];for(var d=b.find(".custom-holder").children(".c-tile").length-a.options.numberOfTiles,e=0;e<d;e++){var f=$(b.find(".custom-holder").children(".c-tile")[Math.floor(Math.random()*b.find(".custom-holder").children(".c-tile").length)]);a.scormData.tilesUsed.push({id:f.attr("data-id")}),f.remove()}}a.setProgressBarValue(0)}}},{key:"resizeContentEvent",value:function(){var a=this;$(window).bind("resize.tileSort",function(b){clearTimeout(a.doit),a.doit=setTimeout(function(){a.resizeContent()},200)})}},{key:"resizeContent",value:function(){var a=this.jObject,b=this.options.custom,c=b.tile,d=void 0,e=void 0;for(this.scaled=$(window).height()/this.orgImgHeight,this.orgImgWidth=this.orgImgWidth*this.scaled,this.orgImgHeight=this.orgImgHeight*this.scaled,d=0;d<c.imageTiles.length;d++)e=c.imageTiles[d];for(d=0;d<c.imageTiles.length;d++)e=c.imageTiles[d],e.xcoord=e.xcoord*this.scaled,e.ycoord=e.ycoord*this.scaled,e.width=e.width*this.scaled,e.height=e.height*this.scaled,a.find(".c-image-tile[data-id=IT"+d+"]").css({top:e.ycoord,left:e.xcoord,width:e.width,height:e.height});a.find(".main-background").css({height:this.orgImgHeight+"px",width:this.orgImgWidth+"px"})}},{key:"removeDialogs",value:function(){this.jObject.find(".result-pop-up, .modal-dialog-window, .dialog-box-window").remove()}},{key:"animateTileToStartPos",value:function(a,b,c,d){var e=this,f=void 0,g=!0,h=this.jObject,i=this.getOrgTilePostion(b),j=h.offset().top,k=h.offset().left,l=$(b).attr("data-id");if(a&&this.dropZones[a].subZones){for(f in this.dropZones[a].subZones)if(this.dropZones[a].subZones[f].dragId===l){e.doingReset&&!this.dropZones[a].subZones[f].isCorrect||!e.doingReset&&this.dropZones[a].subZones[f].isCorrect?g=!0:e.doingReset&&this.dropZones[a].subZones[f].isCorrect&&(g=!1);break}}else a&&(e.doingReset&&!this.dropZones[a].isCorrect||!e.doingReset&&this.dropZones[a].isCorrect?g=!0:e.doingReset&&this.dropZones[a].isCorrect&&(g=!1));g?(this.dragTiles[l].isDistractor&&(this.dragTiles[l].isCorrect=!0),$(b).hasClass("dropped-item")&&($(b).parent().hasClass("b-cell")&&$(b).parent().addClass("open-cell"),h.find(".custom-holder").prepend($(b)),$(b).css({top:c.offset.top-j,left:c.offset.left-k,position:"absolute"})),i.zindex=c.zindex,i.position="absolute",$(b).find(".feedback-icon").fadeOut(500,function(){$(this).removeClass("correct_icon incorrect_icon")}),$(b).removeClass("drag-item-correct drag-item-incorrect"),this.animateTileToPosition(b,i,function(){e.options.custom.tile.cloneTiles&&$(b).hasClass("dropped-item"),$(b).removeClass("dropped-item ui-draggable-dragging dontClone ui-draggable-disabled show-tile"),$(b).addClass("hide-tile"),e.customTileSortStackedTiles(),$(b).css({opacity:1}),d||h.find(".c-tile:not(.original)").remove(),e.resetTilesInCustomHolder()})):this.resetTilesInCustomHolder()}},{key:"animateTileToPosition",value:function(a,b,c,d){var e=void 0;e=d?0:400,this.totalTriesCount>=this.options.numberOfTries&&this.options.showCorrectAnswerOnFinalAttempt&&(e=0),$(a).css({opacity:0}),$(a).animate({top:b.ycoord,left:b.xcoord,position:b.postion},e,c)}},{key:"revertToStartPos",value:function(a){var b=this;if(wasAlreadyInADropZone=!!$(a).parent().hasClass("DMZ"),this.wasDroppedOutsideOfDropzone&&wasAlreadyInADropZone)this.doRevert=!1;else if(this.wasDroppedOutsideOfDropzone)return void(this.doRevert=!0);wasAlreadyInADropZone||(this.dropZones[this.lastDroppedZone]&&this.dropZones[this.lastDroppedZone].isCorrect&&!this.dragTiles[$(this.ActiveElement).attr("data-id")].isDistractor?this.doRevert=!1:this.isInstant?this.doRevert=!0:wasAlreadyInADropZone||(this.orgDroppedZone=void 0)),b.isInstant?this.placeWrongTileInCorrectSpotForInstant(a,!0,!1):this.placeWrongTileInCorrectSpot(a,!1,!1)}},{key:"isZoneFilled",value:function(a,b,c){var d=c+1;return a.children().length>0&&!$(a).hasClass("b-drop-zone")&&b.locations[c]&&(a=this.jObject.find(".DMZ[data-id="+b.locations[c]+"]"),a=this.isZoneFilled(a,b,d)),a}},{key:"testAllZonesFilled",value:function(){var a=this.jObject,b=this,c=a.find(".DMZ"),d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=!1,n=void 0,o={};for(e=0;e<c.length;e++)if(d=$(c[e]),(k=d.attr("data-id"))&&d.children(".c-tile").length>1)for(g=0;g<d.children(".c-tile").length;g++)if(h=$(d.find(".c-tile")[g]),i=h.attr("data-id"),j=this.dragTiles[i],!j.isCorrect&&j.locations.length>1){for(f=0;f<j.locations.length;f++)if(l=j.locations[f],k!==l&&(n=a.find(".DMZ[data-id="+l+"]"),!($(n).children(".c-tile").length>0))){m=!0,o.xcoord=$(n).position().left,o.ycoord=$(n).position().top,a.append(h),h.css({top:d.position().top,left:d.position().left,position:"absolute"}),b.animateTileToPosition(h,o,function(){h.css({top:"auto",left:"auto"}),$(n).append(h)});break}if(m)break}}},{key:"placeWrongTileInCorrectSpot",value:function(a,b,c,d,e){var f=this.jObject,g=this,h=!1,i=a.attr("data-id"),j=this.dragTiles[i],k=1;if(d=d||j.locations[0],c&&f.find(".custom-holder").prepend($(a)),(this.isInstant||b)&&(j.maxTriesCount>=this.options.numberOfTries||this.totalTriesCount>=this.options.numberOfTries)){if(j.isDistractor||e){var l=g.getOrgTilePostion(a);l.zindex=101,l.position="absolute",this.animateTileToPosition(a,l,function(){$(this).data("ui-draggable")&&$(this).draggable("disable"),$(this).css({opacity:1}),$(this).removeClass("drag-item-incorrect"),$(this).find(".feedback-icon").removeClass("incorrect_icon"),g.setShowAnswerButtonStates("enable")},k)}else{var m=this.jObject.find(".DMZ[data-id="+d+"]");0===m.length&&(m=this.jObject.find(".b-drop-zone[data-id="+d+"]"),h=!0),this.isInstant&&(m=this.isZoneFilled(m,j,0)),offset=m.position(),this.doRevert=!1;var n={};(!j.isCorrect&&this.isInstant||!this.isInstant)&&(n={xcoord:offset.left,ycoord:offset.top},this.animateTileToPosition(a,n,function(){$(this).data("ui-draggable")&&$(this).draggable("disable"),h?$(m).find(".open-cell:first").append(this).removeClass("open-cell"):$(m).append(this),$(this).css({opacity:1,top:"auto",left:"auto"}).addClass("dropped-item"),g.isInstant||g.testAllZonesFilled(),g.setProgressBarValue(),g.setShowAnswerButtonStates("enable"),g.isInstant&&g.isCommEnabled()&&g.saveLearnerData(!0)},k)),j.isCorrect?a.find(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"):a.find(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),g.options.feedback.showGraphicalTreatment||!g.isInstant&&!b||a.find(".feedback-icon").show()}this.doRevert=!1}}},{key:"placeWrongTileInCorrectSpotForInstant",value:function(a,b,c,d,e){var f=this.jObject,g=this,h=0,i=!1,j=a.attr("data-id"),k=this.dragTiles[j],l=1;if(d=d||k.locations[h],c&&f.find(".custom-holder").prepend($(a)),(this.isInstant||b)&&(k.maxTriesCount>=this.options.numberOfTries||this.totalTriesCount>=this.options.numberOfTries)){if(a.removeClass("hide-tile").addClass("show-tile"),g.customTileSortStackedTiles(),k.isDistractor||e){var m=g.getOrgTilePostion(a);m.zindex=101,m.position="absolute",this.animateTileToPosition(a,m,function(){$(this).data("ui-draggable")&&$(this).draggable("disable"),$(this).css({opacity:1}),g.setShowAnswerButtonStates("enable")},l)}else{var n=this.jObject.find(".DMZ[data-id="+d+"]");if(0===n.length?(n=this.jObject.find(".b-drop-zone[data-id="+d+"]:not(.ui-droppable-disabled)"),0===n.length&&(h++,d=k.locations[h],n=this.jObject.find(".b-drop-zone[data-id="+d+"]:not(.ui-droppable-disabled)")),currentDropZone=$(n[0]),i=!0):(n=this.jObject.find(".s-drop-zone[data-id="+d+"]:not(.ui-droppable-disabled)"),0===n.length&&(h++,d=k.locations[h],n=this.jObject.find(".s-drop-zone[data-id="+d+"]:not(.ui-droppable-disabled)")),currentDropZone=$(n[0])),1===currentDropZone.length){offset=currentDropZone.position(),this.doRevert=!1;var o={};(!k.isCorrect&&this.isInstant||!this.isInstant)&&(o={xcoord:offset.left,ycoord:offset.top},this.animateTileToPosition(a,o,function(){$(this).data("ui-draggable")&&$(this).draggable("disable"),i?$(n).find(".open-cell:first").append(this).removeClass("open-cell"):$(n).append(this),$(this).css({opacity:1,top:"auto",left:"auto"}).addClass("dropped-item"),g.isInstant||g.testAllZonesFilled(),g.setProgressBarValue(),g.setShowAnswerButtonStates("enable"),g.isInstant&&g.isCommEnabled()&&g.saveLearnerData(!0)},l)),k.isCorrect?(a.find(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),g.options.feedback.showGraphicalTreatment||a.removeClass("drag-item-incorrect").addClass("drag-item-correct"),k.isCorrect=!1,k.maxTriesCount===this.options.numberOfTries&&(k.maxTriesCount=0)):(a.find(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),g.options.feedback.showGraphicalTreatment||a.removeClass("drag-item-correct").addClass("drag-item-incorrect"),k.maxTriesCount===this.options.numberOfTries&&(k.maxTriesCount=0)),g.options.feedback.showGraphicalTreatment||!g.isInstant&&!b||a.find(".feedback-icon").show()}else $(a).remove(),g.removeDialogs()}this.doRevert=!1}}},{key:"getOrgTilePostion",value:function(a){var b=this.options.custom,c=b.tile,d=$(a).attr("data-id"),e=d.substring(2,d.length);return d.indexOf("TI")>-1?c.textImageTiles[e]:d.indexOf("TT")>-1?c.textTiles[e]:c.imageTiles[e]}},{key:"wasCorrectSpot",value:function(a,b){var c=this.jObject,d=this,e=this.dragTiles[b].locations,f=void 0,g=!1,h=void 0,i=c.find(".c-tile[data-id="+b+"]"),j=this.dragTiles[b];if(h=i.parent().hasClass("b-cell")?$(i).last().parent().attr("data-id")+","+a:$(i).last().parent().attr("data-id"),"matchid"!==d.options.custom.tsmode&&d.options.custom.hasOwnProperty("tsmode")){var k=h.split(",");for(f=0;f<k.length;f++)if(k[f]===a){if(g=!0,j.isCorrect=!0,this.isInstant)for(x=0;x<i.length;x++)if($(i[x]).hasClass("dropped-item")&&!$(i[x]).find(".feedback-icon").hasClass("correct_icon")){$(i[x]).find(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),$(i[x]).removeClass("drag-item-correct drag-item-incorrect"),this.options.feedback.showGraphicalTreatment||($(i[x]).find(".feedback-icon").fadeIn(),$(i[x]).addClass("drag-item-correct"));break}break}}else for(f=0;f<e.length;f++)if(e[f]===a){if(g=!0,j.isCorrect=!0,this.isInstant)for(x=0;x<i.length;x++)if($(i[x]).hasClass("dropped-item")&&!$(i[x]).find(".feedback-icon").hasClass("correct_icon")){$(i[x]).find(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),$(i[x]).removeClass("drag-item-correct drag-item-incorrect"),this.options.feedback.showGraphicalTreatment||($(i[x]).find(".feedback-icon").fadeIn(),$(i[x]).addClass("drag-item-correct"));break}break}return g||(j.isCorrect=!1),j.droppedZone=h,g}},{key:"wasCorrectSpotForInstant",value:function(a,b){var c=this.jObject,d=this.dragTiles[b].locations,e=void 0,f=!1,g=void 0,h=c.find("ui-draggable-dragging"),i=this.dragTiles[b];for(g=h.parent().hasClass("b-cell")?$(h).first().parent().attr("data-id")+","+a:$(h).first().parent().attr("data-id"),e=0;e<d.length;e++)if(d[e]===a){if(f=!0,i.isCorrect=!0,this.isInstant)for(x=0;x<h.length;x++)if($(h[x]).hasClass("dropped-item")&&!$(h[x]).find(".feedback-icon").hasClass("correct_icon")){$(h[x]).find(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),$(h[x]).removeClass("drag-item-correct drag-item-incorrect"),this.options.feedback.showGraphicalTreatment||($(h[x]).find(".feedback-icon").fadeIn(),$(h[x]).addClass("drag-item-correct"));break}break}return f||(i.isCorrect=!1),i.droppedZone=g,f}},{key:"checkHelper",value:function(a,b,c,d,e){var f=this;a?(!0===this.dragTiles[c].isCorrect&&(this.dragTiles[c].isCorrect=!0,this.dropZones[d].subZones?(this.dropZones[d].subZones[e].isCorrect=!0,this.dropZones[d].subZones[e].checked=!0):(this.dropZones[d].isCorrect=!0,this.dropZones[d].checked=!0)),$(b).draggable("disable"),$(b).find(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),f.options.feedback.markDropZones&&$(b).find(".feedback-icon").css({opacity:0}),this.options.feedback.showGraphicalTreatment||($(b).find(".feedback-icon").show(),$(b).removeClass("drag-item-incorrect").addClass("drag-item-correct"))):($(b).find(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),f.options.feedback.markDropZones&&$(b).find(".feedback-icon").css({opacity:0}),this.options.feedback.showGraphicalTreatment||($(b).find(".feedback-icon").show(),$(b).removeClass("drag-item-correct").addClass("drag-item-incorrect")),this.dragTiles[c].isCorrect=!1,this.dropZones[d].subZones?(this.dropZones[d].subZones[e].isCorrect=!1,this.dropZones[d].subZones[e].checked=!1):(this.dropZones[d].isCorrect=!1,this.dropZones[d].checked=!1))}},{key:"completeActivity",value:function(){this.quit||(this.quit=!0,this.totalTriesCount=this.options.numberOfTries,this.scormData.checkedAnswer=!0,this.scormData.allCorrect=!1,this.scormData.numberOfTries=this.totalTriesCount,this.isCommEnabled()&&!this.isInstant&&this.saveLearnerData(!1),this.fireEvent(!1,!0),this.options.custom.valueMode?this.showCorrectAnswerValueMode():this.totalCountReachedShowCorrectAnswers(),this.showDialogComponent(!1),this.jObject.find(".c-checkanswer-button").length>0&&this.jObject.find(".c-checkanswer-button").sliderbutton("disable"))}},{key:"checkAnswer",value:function(a,b){var c=this,d=this.jObject,e=d.find(".c-checkanswer-button"),f=!0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=!0,q=void 0,r=void 0,s=void 0;if(this.hasBeenInteractedWith=!0,a){p=b;var t=$(this.ActiveElement).attr("data-id");s=this.dragTiles[t],s.maxTriesCount++,p&&d.find(".dropped-item").length===d.find(".drag-item").length&&$(window).trigger(c.gadgetUniqueId+"stopClock","stopClock")}else{if(this.totalTriesCount++,this.options.custom.valueMode)d.find(".s-drop-zone").each(function(){var a=parseFloat($(this).attr("data-dropzone-value")),b=$(this).find(".c-tile"),d=0,e=$(b).attr("data-id"),g=$(this).attr("data-id");void 0!=b.attr("data-tile-value")&&(d=parseFloat(b.attr("data-tile-value"))),$(this).attr("data-dropped-value",d),a==d?(f=!0,$(this).droppable("disable")):(f=!1,p=!1),e&&c.checkHelper(f,b,e,g)}),d.find(".b-drop-zone").each(function(){var a=parseFloat($(this).attr("data-dropzone-value")),b=$(this).find(".c-tile"),d=0,e=0,g=0,h=$(this).attr("data-id");$(b).each(function(){var a=$(this).attr("data-tile-value");3===a.length&&a.indexOf(".")>-1?e+=10*parseFloat(a):4===a.length&&a.indexOf(".")>-1?g+=100*parseFloat(a):d+=parseFloat(a)}),d=d+e/10+g/100,$(this).attr("data-dropped-value",d),a==d?(f=!0,$(this).droppable("disable")):(f=!1,p=!1),$(b).each(function(){c.checkHelper(f,$(this),$(this).attr("data-id"),h,$(this).parent().attr("data-id"))})});else{if(this.options.custom.tile.cloneTiles){for(i=d.find(".c-tile"),n=0;n<i.length;n++)if(j=i[n],$(j).hasClass("dropped-item")){for(k=$(j).parent(),$(k).hasClass("b-cell")&&(l=$(k).attr("data-id"),k=$(k).parent().parent()),h=k.attr("data-id"),m=$(j).attr("data-id"),q=this.dragTiles[m].locations,o=0;o<q.length;o++){if(r=q[o],h===r){f=!0;break}f=!1}this.checkHelper(f,j,m,h,l),f||(p=!1)}}else{var u={},v=void 0,w=void 0,x=void 0,y=void 0,z=void 0;for(g in this.dropZones)if(v=this.dropZones[g],v.subZones)for(w in v.subZones)z=v.subZones[w],u[z.dragId]=z.isCorrect,this.dropZones[g].subZones[w].checked=z.isCorrect;else u[v.dragId]=v.isCorrect,this.dropZones[g].checked=v.isCorrect;for(y in u)x=u[y],j=d.find(".c-tile[data-id='"+y+"']"),x?($(j).draggable("disable"),$(j).find(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),this.options.feedback.showGraphicalTreatment||($(j).find(".feedback-icon").show(),$(j).removeClass("drag-item-incorrect").addClass("drag-item-correct"))):(p=!1,$(j).find(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),this.options.feedback.showGraphicalTreatment||($(j).find(".feedback-icon").show(),$(j).removeClass("drag-item-correct").addClass("drag-item-incorrect")))}this.options.custom.dropNotFilled&&(p=!0,d.find(".s-drop-zone, .b-drop-zone").each(function(){var a=$(this).find(".c-tile");$(a).each(function(){c.dragTiles[$(this).attr("data-id")].isCorrect||(p=!1)}),c.options.custom.dropNotFilled&&!c.isDropzoneFilled($(this))&&c.correctTileAvailable($(this))&&(p=!1)}))}1==this.totalTriesCount&&p?($(window).trigger(c.gadgetUniqueId+"stopClock","stopClock"),c.setDragStatusLive("Check answer button clicked, All the tiles show correct feedback"),this.fireEvent(!0,!1)):p&&($(window).trigger(c.gadgetUniqueId+"stopClock","stopClock"),c.setDragStatusLive("Check answer button clicked, All the tiles show correct feedback"),this.fireEvent(!0,!0)),!p&&this.totalTriesCount>=this.options.numberOfTries?($(window).trigger(c.gadgetUniqueId+"stopClock","stopClock"),c.setDragStatusLive("Check answer button clicked, tiles show correct and incorrect feedback."),this.fireEvent(!1,!0)):p||(c.setDragStatusLive("Check answer button clicked, tiles show correct and incorrect feedback. Use try again button to sort the incorrect tiles"),this.fireEvent(!1,!1))}this.markDropZones(a,b,!0),this.scormData.checkedAnswer=!0,this.scormData.allCorrect=p,this.scormData.numberOfTries=this.totalTriesCount,this.isCommEnabled()&&!this.isInstant&&this.saveLearnerData(!1),this.totalTriesCount>=this.options.numberOfTries&&(d.find(".c-answer-button").show(),this.setShowAnswerButtonStates("enable"),c.options.showCorrectAnswerOnFinalAttempt&&(this.options.custom.valueMode?c.showCorrectAnswerValueMode():c.totalCountReachedShowCorrectAnswers())),this.showDialogComponent(p),(p||this.totalTriesCount===this.options.numberOfTries)&&(e.sliderbutton("disable"),e.find(".button-text").html(this.options.buttons.checkAnswerButton),e.removeClass("try-again")),p&&(this.setShowAnswerButtonStates("disable"),a&&s.maxTriesCount--,d.find(".c-answer-button, .c-myanswer-button").hide())}},{key:"showDialogComponent",value:function(a){var b=this.jObject,c=this.options;c.imageComponent=this.pickrandomAnimation(a),c.textMessage=this.pickRandomTextMessage(a),void 0!==c.textMessage&&(c.dialogLayout=c.textMessage.dialogLayout,c.dialogWidth=c.textMessage.dialogWidth,c.dialogHeight=c.textMessage.dialogHeight,c.dialogUnits="pixels",void 0===c.dialogLayout&&void 0!==c.feedback.imageAnimation_feedback&&c.feedback.messages_feedback.correct[0].value===c.textMessage.value&&(c.dialogLayout=c.feedback.imageAnimation_feedback.correct[0].dialogLayout,c.dialogWidth=c.feedback.imageAnimation_feedback.correct[0].dialogWidth,c.dialogHeight=c.feedback.imageAnimation_feedback.correct[0].dialogHeight,c.dialogUnits="pixels"),void 0===c.dialogLayout&&void 0!==c.feedback.imageAnimation_feedback&&c.feedback.messages_feedback.incorrect[0].value===c.textMessage.value&&(c.dialogLayout=c.feedback.imageAnimation_feedback.incorrect[0].dialogLayout,c.dialogWidth=c.feedback.imageAnimation_feedback.incorrect[0].dialogWidth,c.dialogHeight=c.feedback.imageAnimation_feedback.incorrect[0].dialogHeight,c.dialogUnits="pixels")),c.isModal=!0,(c.imageComponent||c.textMessage&&c.textMessage.value&&c.textMessage.value.length>0)&&(this.removeDialogs(),this.options.dialogType=c.imageComponent?"animated":"feedback",c.doAnimate=!(!this.options.imageComponent||!this.options.imageComponent.fps),c.resultsText=c.textMessage?c.textMessage.value:"",c.audioComponent=c.textMessage&&c.textMessage.audioComponent?c.textMessage.audioComponent:null,this.options.popupAudio.src=a?this.options.correctAudio:this.options.inCorrectAudio,this.options.popupAudio.isPopAudio=!1,$(this.options.popupAudio.audioClass).audioComponent(this.options.popupAudio,this.gadgetUniqueId),c.dialogIsCorrect=a,b.dialogcomponent(c),b.find(".result-pop-up").fadeIn().focus(),b.find(".result-pop-up").removeClass("text-button-focus"),$(this.options.popupAudio.audioClass).audioComponent("play"))}},{key:"markDropZones",value:function(a,b,c){var d=this,e=this.jObject,f=0,g=!(!d.options.feedback.markDropZones||!c);return a||(d.options.custom.valueMode?(e.find(".s-drop-zone").each(function(){if($(this).find(".c-tile").length>0){parseFloat($(this).attr("data-dropzone-value"))==parseFloat($(this).find(".c-tile").attr("data-tile-value"))?(f++,g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),$(this).addClass("dropzone-correct"))):g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),$(this).addClass("dropzone-incorrect"))}else 0===parseFloat($(this).attr("data-dropzone-value"))?(f++,g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),$(this).addClass("dropzone-correct"))):g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),$(this).addClass("dropzone-incorrect"))}),e.find(".b-drop-zone").each(function(){var a=parseFloat($(this).attr("data-dropzone-value")),b=$(this).find(".c-tile"),c=0,d=0,e=0;b.length>0?($(b).each(function(){var a=$(this).attr("data-tile-value");3===a.length&&a.indexOf(".")>-1?d+=10*parseFloat(a):4===a.length&&a.indexOf(".")>-1?e+=100*parseFloat(a):c+=parseFloat(a)}),c=c+d/10+e/100,a==c?(f++,g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),$(this).addClass("dropzone-correct"))):g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),$(this).addClass("dropzone-incorrect"))):0===a?(f++,g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),$(this).addClass("dropzone-correct"))):g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),$(this).addClass("dropzone-incorrect"))})):e.find(".s-drop-zone, .b-drop-zone").each(function(){var a=$(this).find(".c-tile"),b=!0;$(a).each(function(){d.dragTiles[$(this).attr("data-id")].isCorrect||(b=!1)}),b?d.options.custom.dropNotFilled&&!d.isDropzoneFilled($(this))&&d.correctTileAvailable($(this))?g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),$(this).addClass("dropzone-incorrect")):g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),$(this).addClass("dropzone-correct")):g&&($(this).children(".feedback-icon").fadeIn(),$(this).children(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),$(this).addClass("dropzone-incorrect"))})),f}},{key:"isDropzoneFilled",value:function(a){var b=!1;return $(a).each(function(){var a=$(this).find(".b-cell").length,c=$(this).find(".c-tile");a>0?$(c).length==a&&(b=!0):$(c).length>0&&(b=!0)}),b}},{key:"correctTileAvailable",value:function(a){var b=this.jObject,c=this,d=!1;return $(a).each(function(){var a=$(this).attr("data-id");b.find(".custom-holder").children(".c-tile").each(function(){var b=c.dragTiles[$(this).attr("data-id")].locations;for(x=0;x<b.length;x++)a===b[x]&&(d=!0)})}),d}},{key:"showMyAnswers",value:function(){var a=this.jObject,b=this,c=a.find(".c-tile"),d=void 0,e=void 0,f=void 0,g=a.offset().top,h=a.offset().left,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=1;if(a.find(".dropzone-correct").removeClass("dropzone-correct").addClass("dropzone-incorrect"),a.find(".correct-tile").removeClass("correct-tile"),this.options.custom.tile.cloneTiles){p=[],q=0;for(dragItem in b.dragTiles)if(cloneState=b.dragTiles[dragItem].cloneState,cloneState){for(k in b.dropZones)if(m=b.dropZones[k],m.subZones){for(o in m.subZones)if(e=m.subZones[o].dragId,a.find(".dropped-tile").remove(),e===dragItem){if(b.dropZones[k].isCorrect)continue;a.find(".b-drop-zone[data-id="+k+"]").find(".c-tile").remove(),a.find(".b-drop-zone[data-id="+k+"]").find(".DMZ").addClass("open-cell"),n=a.find(".c-tile[data-id="+e+"]").not(".clone,.dropped-item").clone(),$(n).addClass("clone"),$(n).removeClass("original"),a.find(".custom-holder").append(n),m.subZones[o].isCorrect?b.options.feedback.markTiles?$(n).find(".feedback-icon").addClass("correct_icon"):b.options.feedback.markDropZones&&a.find(".b-drop-zone[data-id="+k+"]").children(".feedback-icon").hasClass("incorrect_icon")&&a.find(".b-drop-zone[data-id="+k+"]").children(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"):b.options.feedback.markTiles?$(n).find(".feedback-icon").addClass("incorrect_icon"):b.options.feedback.markDropZones&&a.find(".b-drop-zone[data-id="+k+"]").children(".feedback-icon").hasClass("correct_icon")&&a.find(".b-drop-zone[data-id="+k+"]").children(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),this.options.feedback.showGraphicalTreatment||($(n).toggleClass("drag-item-correct",m.subZones[o].isCorrect),$(n).toggleClass("drag-item-incorrect",!m.subZones[o].isCorrect),$(n).find(".feedback-icon").fadeIn()),j=a.find(".DMZ[data-id="+o+"]").offset(),l={ycoord:j.top-g,xcoord:j.left-h,position:"absolute"},a.find(".b-drop-zone[data-id="+k+"]").find(".open-cell:first").append(n).removeClass("open-cell"),b.setShowAnswerButtonStates("enable"),$(n).css({top:"auto",left:"auto"}).addClass("dropped-item ui-draggable-dragging")}}else if(e=m.dragId,a.find(".dropped-tile").remove(),e===dragItem){if(b.dropZones[k].isCorrect)continue;a.find(".s-drop-zone[data-id="+k+"]").find(".c-tile").remove(),a.find(".s-drop-zone[data-id="+k+"]").find(".DMZ").addClass("open-cell"),n=a.find(".c-tile[data-id="+e+"].original").not(".clone,.dropped-item").clone(),$(n).addClass("clone"),$(n).removeClass("original"),a.find(".custom-holder").append(n),m.isCorrect?b.options.feedback.markTiles?($(n).find(".feedback-icon").addClass("correct_icon"),$(n).find(".feedback-icon").show()):b.options.feedback.markDropZones&&a.find(".s-drop-zone[data-id="+k+"]").children(".feedback-icon").hasClass("incorrect_icon")&&a.find(".s-drop-zone[data-id="+k+"]").children(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"):b.options.feedback.markTiles?($(n).find(".feedback-icon").addClass("incorrect_icon"),$(n).find(".feedback-icon").show()):b.options.feedback.markDropZones&&a.find(".s-drop-zone[data-id="+k+"]").children(".feedback-icon").hasClass("correct_icon")&&a.find(".s-drop-zone[data-id="+k+"]").children(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),this.options.feedback.showGraphicalTreatment||($(n).toggleClass("drag-item-correct",m.isCorrect),$(n).toggleClass("drag-item-incorrect",!m.isCorrect)),p.push(a.find(".DMZ[data-id="+k+"]")),j=a.find(".DMZ[data-id="+k+"]").offset(),l={ycoord:j.top-g,xcoord:j.left-h,position:"absolute"},b.animateTileToPosition($(n),l,function(){$(p[q]).append(this),q++,$(this).css({opacity:1,top:"auto",left:"auto"}).addClass("dropped-item ui-draggable-dragging"),b.setShowAnswerButtonStates("enable")},r)}}else for(a.find(".dropped-item:not(.original, .ui-draggable-dragging)").remove(),c=a.find(".c-tile"),i=0;i<c.length;i++)if(d=c[i],(e=$(d).attr("data-id"))===dragItem&&!this.dragTiles[e].isCorrect)if(k=this.dragTiles[e].droppedZone){if(k.indexOf(",")>-1?(zoneAndParent=k.split(","),k=zoneAndParent[0],parentZoneId=zoneAndParent[1],lookup=".b-drop-zone[data-id="+parentZoneId+"] .DMZ[data-id="+k+"]"):lookup=".DMZ[data-id="+k+"]",p.push(a.find(lookup)),j=a.find(lookup).offset(),f={top:$(d).offset().top-g,left:$(d).offset().left-h},$(d).css(f),f={ycoord:j.top-g,xcoord:j.left-h,position:"absolute"},$(d).parent().hasClass("b-cell")&&$(d).parent().addClass("open-cell"),b.options.feedback.markDropZones&&(a.find(".s-drop-zone[data-id="+k+"]").children(".feedback-icon").hasClass("incorrect_icon")?a.find(".s-drop-zone[data-id="+k+"]").children(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"):a.find(".s-drop-zone[data-id="+k+"]").children(".feedback-icon").hasClass("correct_icon")&&a.find(".s-drop-zone[data-id="+k+"]").children(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon")),!this.options.feedback.showGraphicalTreatment){var s=$(d).find(".feedback-icon");$(d).find(".feedback-icon").addClass("incorrect_icon"),$(d).toggleClass("drag-item-correct",s.hasClass("correct_icon")),$(d).toggleClass("drag-item-incorrect",s.hasClass("incorrect_icon"))}a.find(".custom-holder").prepend($(d)),this.animateTileToPosition($(d),f,function(){$(p[q]).append(this),q++,$(this).css({opacity:1,top:"auto",left:"auto"}).addClass("dropped-item"),b.options.feedback.markDropZones&&$(d).closest(".b-drop-zone").children(".feedback-icon").hasClass("correct_icon")&&$(d).closest(".b-drop-zone").children(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon"),b.setShowAnswerButtonStates("enable")},r)}else f={top:$(d).offset().top-g,left:$(d).offset().left-h},f.position="absolute",$(d).css(f),$(d).find(".feedback-icon").removeClass("incorrect_icon correct_icon"),$(d).removeClass("drag-item-correct drag-item-incorrect"),f=this.getOrgTilePostion($(d)),$(d).parent().hasClass("b-cell")&&$(d).parent().addClass("open-cell"),a.find(".custom-holder").prepend($(d)),this.animateTileToPosition($(d),f,function(){$(this).css({opacity:1}),b.setShowAnswerButtonStates("enable")},r)}else{p=[],q=0;this.options.feedback.showGraphicalTreatment||a.find(".c-tile").each(function(a,b){b=$(b);var c=b.find(".feedback-icon");b.toggleClass("drag-item-correct",c.hasClass("correct_icon")),b.toggleClass("drag-item-incorrect",c.hasClass("incorrect_icon")),c.fadeIn()})}}},{key:"showCorrectAnswerValueMode",value:function(){var a=this,b=this.jObject,c=b.find(".custom-holder"),d=void 0,e=void 0,f=void 0,g=b.offset();b.find(".s-drop-zone, .b-drop-zone").each(function(){parseFloat($(this).attr("data-dropzone-value"))!==parseFloat($(this).attr("data-dropped-value"))&&($(this).find(".b-cell").addClass("open-cell"),$(this).find(".c-tile").each(function(){d=$(this),e=d.offset(),d.parent(".b-cell").addClass("open-cell"),a.options.custom.tile.cloneTiles?(d.remove(),d.appendTo(c),d.css({top:e.top-g.top,left:e.left-g.left,position:"absolute"}),a.placeWrongTileInCorrectSpot(d,!0,!0,null,!0)):(d.appendTo(c),d.css({top:e.top-g.top,left:e.left-g.left,position:"absolute"}),a.placeWrongTileInCorrectSpot(d,!0,!0,null,!0))}))}),b.find(".used-tile").removeClass("used-tile"),b.find(".s-drop-zone, .b-drop-zone").each(function(){var b=parseFloat($(this).attr("data-dropzone-value")),d=$(this).attr("data-id"),e=parseFloat($(this).attr("data-dropped-value")),g=1,h=0,i=0,j=0,k=0;if($(this).find(".b-cell").length>0&&(g=$(this).find(".b-cell").length),b!==e&&0!==b){var l=0;do{c.children(".c-tile").sort(function(a,b){var c=parseFloat($(a).attr("data-tile-value")),d=parseFloat($(b).attr("data-tile-value"));return c>d?-1:c<d?1:0}).each(function(){if(!$(this).hasClass("used-tile")){var e=void 0,g=void 0;if(g=$(this).attr("data-tile-value"),3===g.length&&g.indexOf(".")>-1?(i=10*parseFloat(g),e=(10*k+i)/10):4===g.length&&g.indexOf(".")>-1?(j=100*parseFloat(g),e=(100*k+j)/100,e=parseFloat(e.toFixed(2))):e=k+parseFloat(g),e<=b&&(k=e,h++,"true"===$(this).attr("data-clone-state")?(f=$(this).clone(),f.addClass("correct-tile"),f.addClass("used-tile"),f.appendTo(c),a.placeWrongTileInCorrectSpot(f,!0,!0,d)):($(this).addClass("correct-tile"),$(this).addClass("used-tile"),a.placeWrongTileInCorrectSpot($(this),!0,!0,d)),k==b))return h++,!1}}),1e3==++l&&(h=g+1)}while(g>h&&k<b)}})}},{key:"totalCountReachedShowCorrectAnswers",value:function(){var a=this,b=this.jObject,c=b.find(".c-checkanswer-button"),d=b.find(".custom-holder"),e=b.find(".DMZ"),f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=0,n=[],o=[],p=b.offset();if(b.find(".dropzone-incorrect").removeClass("dropzone-incorrect").addClass("dropzone-correct"),this.options.custom.tile.cloneTiles){for(dragTileId in a.dragTiles)if(cloneState=a.dragTiles[dragTileId].cloneState,cloneState){for(dropZoneElement in a.dropZones)if(a.dropZones[dropZoneElement].hasOwnProperty("dragId"))b.find(".c-tile[data-id="+dragTileId+"]").parent().hasClass("DMZ")&&a.dropZones[dropZoneElement].dragId===dragTileId&&!1===a.dropZones[dropZoneElement].isCorrect&&b.find(".c-tile[data-id="+dragTileId+"]:not(.drag-item-correct)").hasClass("ui-draggable-dragging")&&(b.find(".c-tile[data-id="+dragTileId+"]:not(.drag-item-correct)").closest(".DMZ").addClass("open-cell"),b.find(".c-tile[data-id="+dragTileId+"]:not(.drag-item-correct)").closest(".DMZ").addClass("hadClone"),b.find(".c-tile[data-id="+dragTileId+"]:not(.drag-item-correct).ui-draggable-dragging").remove());else for(bucketDropZone in a.dropZones[dropZoneElement].subZones)a.dropZones[dropZoneElement].subZones[bucketDropZone].dragId===dragTileId&&!1===a.dropZones[dropZoneElement].subZones[bucketDropZone].isCorrect&&b.find(".c-tile[data-id="+dragTileId+"]:not(.drag-item-correct)").hasClass("ui-draggable-dragging")&&(b.find(".c-tile[data-id="+dragTileId+"]:not(.drag-item-correct)").closest(".DMZ").addClass("open-cell"),b.find(".c-tile[data-id="+dragTileId+"]:not(.drag-item-correct)").closest(".DMZ").addClass("hadClone"),b.find(".c-tile[data-id="+dragTileId+"]:not(.drag-item-correct).ui-draggable-dragging").remove());n.push(dragTileId),f=a.dragTiles[dragTileId],h=b.find(".c-tile[data-id="+dragTileId+"]:not(.ui-draggable-dragging)").first(),o.push({tileElement:h,tile:f})}else{if(f=a.dragTiles[dragTileId],h=b.find(".c-tile[data-id="+dragTileId+"]").first(),i=h.offset(),f.isCorrect)continue;h.parent(".b-cell").addClass("open-cell"),h.appendTo(d),h.css({top:i.top-p.top,left:i.left-p.left,position:"absolute"}),o.push({tileElement:h,tile:f}),n.push(dragTileId)}for(e.each(function(c,e){e=$(e);var q=e.hasClass("b-cell"),r=q?e.closest(".b-drop-zone").attr("data-id"):e.attr("data-id");if(e.closest(".b-drop-zone").find(".feedback-icon").hasClass("incorrect_icon")&&a.options.feedback.markDropZones&&e.closest(".b-drop-zone").find(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),e.closest(".s-drop-zone").children(".feedback-icon").hasClass("incorrect_icon")&&a.options.feedback.markDropZones&&e.closest(".s-drop-zone").children(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon"),e.children(".c-tile").children(".feedback-icon").hasClass("incorrect_icon")&&e.children(".c-tile").remove(),e.hasClass("hadClone")){var s=m;a:do{for(g=n[m],f=a.dragTiles[g],m=(m+1)%n.length,k=0;k<f.locations.length;k++)if(r===f.locations[k]){h=b.find(".c-tile[data-id="+g+"]").first(),i=h.offset(),j=h.clone(),j.appendTo(d),j.css({top:i.top-p.top,left:i.left-p.left,position:"absolute"}),void 0!==f.isCorrect&&!1!==f.isCorrect||j.removeClass("drag-item-incorrect original").addClass("correct-tile"),a.placeWrongTileInCorrectSpot(j,!0,!0,r);break a}}while(m!==s)}else{if(!(q&&e.hasClass("open-cell")||!q&&0===e.children(".c-tile").length))return;a:for(k=0;k<o.length;k++)for(f=o[k].tile,h=o[k].tileElement,"true"===$(h).attr("data-clone-state")?(newTileElement=a.cloneDragTile(h),newTileElement.addClass("dropped-tile"),newTileElement.removeClass("original")):newTileElement=h,l=0;l<f.locations.length;l++)if(r===f.locations[l]){newTileElement.removeClass("drag-item-incorrect").addClass("correct-tile"),a.placeWrongTileInCorrectSpot(newTileElement,!0,!0,r),"false"===$(newTileElement).attr("data-clone-state")&&o.splice(k,1);break a}}}),k=0;k<o.length;k++)a.placeWrongTileInCorrectSpot(o[k].tileElement,!0,!0,null,!0)}else{for(g in a.dragTiles)f=a.dragTiles[g],h=b.find(".c-tile[data-id="+g+"]").first(),i=h.offset(),f.isCorrect||(h.parent(".b-cell").addClass("open-cell"),h.appendTo(d),h.css({top:i.top-p.top,left:i.left-p.left,position:"absolute"}),o.push({tileElement:h,tile:f}));for(e.each(function(b,c){c=$(c);var d=c.hasClass("b-cell"),e=d?c.closest(".b-drop-zone").attr("data-id"):c.attr("data-id");if(d&&c.hasClass("open-cell")||!d&&0===c.children(".c-tile").length)a:for(k=0;k<o.length;k++)for(f=o[k].tile,h=o[k].tileElement,l=0;l<f.locations.length;l++)if(e===f.locations[l]){h.removeClass("drag-item-incorrect").addClass("correct-tile"),a.placeWrongTileInCorrectSpot(h,!0,!0,e),o.splice(k,1);break a}}),k=0;k<o.length;k++)a.placeWrongTileInCorrectSpot(o[k].tileElement,!0,!0,null,!0)}c.sliderbutton("disable"),c.find(".button-text").html(this.options.buttons.checkAnswerButton),c.removeClass("try-again")}},{key:"pickRandomTextMessage",value:function(a){var b=$.extend(!0,{},this.options.feedback),c=b.messages_feedback,d=void 0,e=void 0,f=void 0,g=this.totalTriesCount,h=!1,i=this.ActiveElement,j=!1,k=g>=this.options.numberOfTries;if(c&&(e=c.correct?c.correct:[],f=c.incorrect?c.incorrect:[],a?(d=e[this.txt_correctIndex],this.txt_correctIndex>=e.length-1?this.txt_correctIndex=0:this.txt_correctIndex++):(d=f[this.txt_incorrectIndex],this.txt_incorrectIndex>=f.length-1?this.txt_incorrectIndex=0:this.txt_incorrectIndex++)),this.isInstant?(tileId=$(i).attr("data-id"),tileId&&(g=this.dragTiles[tileId].maxTriesCount),j=g>=this.options.numberOfTries):b.attempts_response_text.value&&(h=!0),!h&&a&&1===g&&b.first_correct_text.value)d=b.first_correct_text,void 0==b.first_correct_text.value&&(d.value="");else if(h||a||!j&&!k||!b.final_incorrect_text.value){if(h&&(k||a)){var l=this.calculateScores(),m=this.jObject.find(".DMZ").length,n=b.attempts_response_text.value;n=n?n.replace(/\XX/g,l):"",n=n?n.replace(/\YY/g,m):"",b.attempts_response_text.value=n,d=b.attempts_response_text}}else d=b.final_incorrect_text,void 0==b.final_incorrect_text.value&&(d.value="");return!this.isInstant&&k&&this.jObject.find(".c-tile").each(function(){$(this).data("ui-draggable")&&$(this).draggable("disable")}),d}},{key:"calculateScores",value:function(){var a=void 0,b=0,c=this.jObject.find(".feedback-icon");for(a=0;a<c.length;a++)!$(c[a]).hasClass("correct_icon")||$(c[a]).parent().hasClass("b-drop-zone")||$(c[a]).parent().hasClass("s-drop-zone")||b++;return b}},{key:"pickrandomAnimation",value:function(a){var b=void 0,c=this.options.feedback,d=c.imageAnimation_feedback,e=void 0,f=void 0,g=!1,h=this.ActiveElement,i=this.totalTriesCount,j=i>=this.options.numberOfTries;return d&&(e=d.correct,f=d.incorrect,e&&a&&e[this.img_correctIndex]?(b=e[this.img_correctIndex].imageComponent,this.img_correctIndex>=e.length-1?this.img_correctIndex=0:this.img_correctIndex++):f&&!a&&f[this.img_incorrectIndex]&&(b=f[this.img_incorrectIndex].imageComponent,this.img_incorrectIndex>=f.length-1?this.img_incorrectIndex=0:this.img_incorrectIndex++)),this.isInstant?(tileId=$(h).attr("data-id"),tileId&&(i=this.dragTiles[tileId].maxTriesCount),j=i>=this.options.numberOfTries):c.attempts_response_text.value&&!this.isInstant&&(g=!0),!g&&a&&1===i&&c.first_correct_text.imageComponent&&c.first_correct_text.imageComponent.src?b=c.first_correct_text.imageComponent:!g&&!a&&j&&c.final_incorrect_text.imageComponent&&c.final_incorrect_text.imageComponent.src&&(b=c.final_incorrect_text.imageComponent),g&&(j||a)&&(b=""),b&&(b.loops=1),b}},{key:"resetTilesInCustomHolder",value:function(){var a=this.jObject,b=a.find(".custom-holder"),c=b.children(".c-tile"),d=this.options.buttons.resetButtonGroup&&this.options.buttons.resetButtonGroup.length>0&&this.options.buttons.resetButtonGroup[0].randomizeTiles,e=void 0,f=void 0;for(c.sort(function(a,b){return parseInt($(a).attr("data-id").replace(/\D/g,""),10)-parseInt($(b).attr("data-id").replace(/\D/g,""),10)}),f=c.length-1;f>=0;f--)e=$(c[f]),e.prependTo(b),d||e.css("z-index","");0==a.find(".s-drop-zone, .b-drop-zone").find(".c-tile").length&&a.find(".c-checkanswer-button").sliderbutton("disable")}},{key:"resetTiles",value:function(a){var b=void 0,c=this,d=this.jObject,e=this.options.custom,f=e.tile,g={},h=d.find(".c-tile"),i=void 0,j=void 0,k=!1,l="",m=this.options.buttons.resetButtonGroup&&this.options.buttons.resetButtonGroup.length>0&&this.options.buttons.resetButtonGroup[0].randomizeTiles;for(g.offset={},this.options.buttons.resetButtonGroup&&m&&this.randomizeTiles(f),d.find(".dropzone-incorrect").removeClass("dropzone-incorrect"),d.find(".dropzone-correct").removeClass("dropzone-correct"),b=0;b<h.length;b++)i=h[b],$(i).css({opacity:1}),$(i).find(".feedback-icon").removeClass("incorrect_icon"),$(i).removeClass("drag-item-incorrect"),parentContainer=$(i).parent(),m&&(l=Math.floor(100*Math.random()+1)),parentContainer.hasClass("b-cell")&&($(i).find(".feedback-icon").hasClass("correct_icon")||parentContainer.addClass("open-cell"),parentContainer=$(parentContainer).parent().parent()),$(parentContainer).find(".feedback-icon.incorrect_icon").hide().removeClass("incorrect_icon"),j=parentContainer.attr("data-id"),this.options.buttons.resetButtonGroup&&!m&&$(i).parent().hasClass("DMZ")?(k=!0,"true"!==$(i).attr("data-clone-state")||$(i).children(".feedback-icon").hasClass("correct_icon")||($(i).remove(),k=!1)):this.options.buttons.resetButtonGroup&&m?k=!0:!this.options.buttons.resetButtonGroup&&$(i).parent().hasClass("DMZ")&&(k=!0,"true"!==$(i).attr("data-clone-state")||$(i).children(".feedback-icon").hasClass("correct_icon")||($(i).remove(),k=!1)),k&&(g.offset.top=$(i).offset().top,g.offset.left=$(i).offset().left,g.zindex=l,this.animateTileToStartPos(j,i,g,a),$(i).css({opacity:1})),$(i).parent().hasClass("DMZ")||a||(delete this.dragTiles[$(i).attr("data-id")].droppedZone,delete this.dragTiles[$(i).attr("data-id")].isCorrect);c.options.feedback.markDropZones&&(d.find(".s-drop-zone .feedback-icon:not(.correct_icon)").hide(),d.find(".b-drop-zone .feedback-icon:not(.correct_icon)").hide()),a||d.find(".c-tile:not(.original)").remove(),this.resetTilesInCustomHolder(),this.setProgressBarValue(),delete this.scormData.checkedAnswer,c.options.custom.dropNotFilled||(d.find(".c-checkanswer-button").sliderbutton("disable"),c.setDragStatusLive(c.options.buttons.checkAnswerButton+"button"))}},{key:"randomizeTiles",value:function(a){var b=this,c=a.textTiles,d=a.imageTiles,e=a.textImageTiles,f=void 0,g=void 0,h=[],i=void 0,j=void 0,k=void 0;for(this.options.custom.imageLabels&&this.options.custom.textLabels?k=this.options.custom.textLabels.concat(this.options.custom.imageLabels):this.options.custom.textLabels?k=this.options.custom.textLabels:this.options.custom.imageLabels&&(k=this.options.custom.imageLabels),d&&d.length>0&&c&&c.length>0&&e&&e.length>0?(allTiles=c.concat(d),allTiles=allTiles.concat(e)):c&&c.length>0&&d&&d.length>0?allTiles=c.concat(d):c&&c.length>0&&e&&e.length>0?allTiles=c.concat(e):d&&d.length>0&&e&&e.length>0?allTiles=d.concat(e):c&&c.length>0?allTiles=c:d&&d.length>0?allTiles=d:e&&e.length>0&&(allTiles=e),f=0;f<allTiles.length;f++)tileObj=allTiles[f],j={x:tileObj.xcoord,y:tileObj.ycoord,readOrder:tileObj.readOrder},h.push(j);for(i=PearsonGL.utils.shuffleArray(h),f=0;f<allTiles.length;f++)if(tileObj=allTiles[f],coordObj=i[f],coordObj.readOrder){for(g=0;g<k.length;g++)if(allTiles[f].readOrder===k[g].readOrder){var l=k.map(function(a){return a.readOrder}).indexOf(coordObj.readOrder),m=k[l].xcoord,n=k[l].ycoord;k[l].readOrder=k[g].readOrder,k[l].xcoord=k[g].xcoord,k[l].ycoord=k[g].ycoord,k[g].readOrder=coordObj.readOrder,k[g].xcoord=m,k[g].ycoord=n;break}var o=allTiles.map(function(a){return a.readOrder}).indexOf(coordObj.readOrder);allTiles[o].readOrder=allTiles[f].readOrder,allTiles[o].xcoord=allTiles[f].xcoord,allTiles[o].ycoord=allTiles[f].ycoord,tileObj.xcoord=parseInt(coordObj.x),tileObj.ycoord=parseInt(coordObj.y),tileObj.readOrder=coordObj.readOrder,tileObj.zindex=Math.floor(100*Math.random()+1)}else tileObj.xcoord=parseInt(coordObj.x),tileObj.ycoord=parseInt(coordObj.y),tileObj.zindex=Math.floor(100*Math.random()+1);if(k&&k.length>0&&void 0!==k[0].readOrder&&k.length>=allTiles.length)for(f=0;f<allTiles.length;f++)for(g=0;g<k.length;g++)if(k[g].readOrder===allTiles[f].readOrder){$(b.allElement[g][0]).attr("data-readorder",k[g].readOrder),$(b.allElement[g][0]).css({top:k[g].ycoord+"px",left:k[g].xcoord+"px"});break}}},{key:"randomizeAnimations",value:function(){if(this.options.feedback.imageAnimation_feedback){var a=this.options.feedback.imageAnimation_feedback,b=a.correct,c=a.incorrect;b&&PearsonGL.utils.shuffleArray(b),c&&PearsonGL.utils.shuffleArray(c)}}},{key:"createADragEventForATile",value:function(a,b){var c=this.jObject,d=this;$(a).hover(function(){$(this).addClass("drag-item-over")},function(){$(this).removeClass("drag-item-over")}),a.find("img").on("dragstart",function(){return!1}),a.draggable({snapMode:"inner",containment:"#"+c.attr("id"),revert:function(){var a=this;return d.revertToStartPos(this),d.doRevert&&(d.lastDroppedZone=d.orgDroppedZone,setTimeout(function(){a.find(".feedback-icon.incorrect_icon").fadeOut(function(){$(this).removeClass("incorrect_icon")}),a.removeClass("drag-item-incorrect")},200)),d.dragTiles[this.attr("data-id")].lastDroppedZone=d.lastDroppedZone,d.doRevert},start:function(a,b){$(this).removeClass("ps-shake ps-glow"),d.wasDroppedOutsideOfDropzone=!0,d.ActiveElement=this,d.hasBeenInteractedWith=!0;var e=c.find(".c-checkanswer-button");$(e).find(".button-text").html(d.options.buttons.checkAnswerButton),$(e).removeClass("try-again"),$(this).parents(".s-drop-zone, .b-drop-zone").addClass("dropzone-tile-dragging"),$(this).removeClass("ui-draggable-dragging"),"true"!==$(this).attr("data-clone-state")||$(this).parent().hasClass("DMZ")||(clonedTile=d.cloneDragTile($(this)),$(this).after(clonedTile[0]),$(this).removeClass("original"),$(this).addClass("ui-draggable-dragging"),d.createADragEventForATile(clonedTile)),d.stopAudio()},drag:function(a,b){$(this).addClass("drag-item-dragging")},stop:function(a,b){var e=c.find(".b-cell"),f=void 0,g=void 0,h=1,i=$(this).parent(),j=c.find(".DMZ"),k=!0,l=!1,m=!1,n=void 0;for($(this).removeClass("drag-item-dragging"),i=i.hasClass("b-cell")?$(i).parent().parent():i,wasAlreadyInADropZone=!!$(this).parent().hasClass("DMZ"),d.wasDroppedOutsideOfDropzone&&wasAlreadyInADropZone?(b.zindex=1,"true"===$(this).attr("data-clone-state")?$(this).remove():d.animateTileToStartPos(i.attr("data-id"),this,b,h),m=!0,d.orgDroppedZone=void 0,d.dragTiles[$(this).attr("data-id")].lastDroppedZone=void 0,d.setProgressBarValue()):d.wasDroppedOutsideOfDropzone&&"true"===$(this).attr("data-clone-state")&&$(this).remove(),g=0;g<e.length;g++)f=e[g],0===$(f).children().length&&$(f).addClass("open-cell");for(x=0;x<j.length;x++)0!==$(j[x]).children(".c-tile").length||l||(k=!1,l=!0),0===$(j[x]).children(".c-tile").length&&m&&($(j[x]).hasClass("b-cell")?d.dropZones[$(j[x]).parent().parent().attr("data-id")].subZones[$(j[x]).attr("data-id")]&&(n=d.dropZones[$(j[x]).parent().parent().attr("data-id")].subZones[$(j[x]).attr("data-id")].dragId,d.dropZones[$(j[x]).parent().parent().attr("data-id")].subZones[$(j[x]).attr("data-id")].dragId="",d.dropZones[$(j[x]).parent().parent().attr("data-id")].subZones[$(j[x]).attr("data-id")].isCorrect=!1):(n=d.dropZones[$(j[x]).attr("data-id")].dragId,d.dropZones[$(j[x]).attr("data-id")].dragId="",d.dropZones[$(j[x]).attr("data-id")].isCorrect=!1),n&&""!==n&&(d.dragTiles[n].isCorrect=!1,d.dragTiles[n].droppedZone=""));k||d.options.custom.dropNotFilled||c.find(".c-checkanswer-button").sliderbutton("disable"),d.jObject.find(".dropzone-tile-dragging").removeClass("dropzone-tile-dragging"),d.scormData.tilePattern=d.dropZones,d.isCommEnabled()&&d.isInstant?d.saveLearnerData(!1):d.isCommEnabled()&&d.saveLearnerData(!0)}});var e=null,f=null,g=!1;$(a).on("touchstart",function(a){f=e=a.originalEvent.touches[0].pageY}),$(a).on("touchmove",function(a){f=a.originalEvent.touches[0].pageY,0==g&&Math.abs(f-e)>30&&(g=!0),1==g&&window.scrollBy(0,5)}),$(a).keyup(function(a){if($(this).is(":focus")||$(this).is(":active"))switch(a.keyCode){case 9:$(this).parent().hasClass("DMZ")&&($(this).hasClass("drag-item-correct")?d.setDragStatusLive("correct"):$(this).hasClass("drag-item-incorrect")&&d.setDragStatusLive("incorrect"));break;case 13:var b=void 0;c.find(".c-tile[aria-grabbed = true]").attr("aria-grabbed",!1),"true"!==$(this).attr("data-clone-state")||$(this).parent().hasClass("DMZ")||(b=d.cloneDragTile($(this)),$(this).after(b[0]),$(this).removeClass("original"),$(this).addClass("ui-draggable-dragging"),d.createADragEventForATile(b)),$(this).attr("aria-grabbed",!0),d.ActiveElement=this,d.setDragStatusLive("selected")}}),$(a).focus(function(a){PearsonGL.utils.focusItemOn(this)}),$(a).blur(function(a){PearsonGL.utils.focusItemOff(this)}),PearsonGL.utils.initMathJax()}},{key:"cloneDragTile",value:function(a){return a.clone()}},{key:"addDragEvents",value:function(){var a=this.jObject,b=this,c=this.options.custom,d=c.tile;this.createADragEventForATile(a.find(".c-tile"),d.cloneTiles),a.find(".s-drop-zone, .b-drop-zone").droppable({tolerance:"pointer",drop:function(c,e){if(e.helper.hasClass("c-tile")){$(this).removeClass("drop-item-over"),$(e.helper).removeClass("drag-item-dragging drag-item-over drag-item-overdrop");var f=!1,g=void 0,h=void 0,i=e.helper,j=e.helper,k=void 0,l=1,m=$(this).attr("data-id"),n=i.attr("data-id"),o=b.dragTiles[n].locations,p=$(this).hasClass("s-drop-zone"),q=void 0,r=void 0;if(b.wasDroppedOutsideOfDropzone=!1,p){if($(this).html()!==i.parent().html()){var s=$(this).find(".c-tile"),t=s.length>0&&s.hasClass("ui-draggable-disabled");if(t)return void(b.wasDroppedOutsideOfDropzone=!0)}}else if(i.closest(".b-drop-zone").attr("data-id")!==m&&0===$(this).find(".open-cell").length){if(void 0==b.options.showDropzoneFullMessage||b.options.showDropzoneFullMessage){b.removeDialogs();var u=b.options;u.isModel=!0,u.resultsText=b.options.custom.bucket.exceedsCapacityError?b.options.custom.bucket.exceedsCapacityError:b.labelOpts.capacityError,b.options.dialogType="feedback",a.dialogcomponent(u),a.find(".result-pop-up").fadeIn().focus()}return void(b.wasDroppedOutsideOfDropzone=!0)}if(b.orgDroppedZone=b.lastDroppedZone,b.lastDroppedZone=m,b.isInstant){for(g=0;g<o.length;g++)if(o[g]===m){f=!0,i.removeClass("hide-tile").addClass("show-tile"),b.customTileSortStackedTiles();break}}else f=!0,i.removeClass("hide-tile").addClass("show-tile"),b.customTileSortStackedTiles();if(f){if(b.doRevert=!1,d.cloneTiles&&!i.hasClass("dontClone")){var v=i.find(".image-class-wrapper").length>0,w=i.find(v?".image-class-wrapper":".gadget-textblock");q=w.attr("audio"),r=w.attr("data-audio-type"),w.find(".controls").remove(),i=i.clone().addClass("dontClone"),b.createADragEventForATile(i,!1),j.remove(),w.removeClass("audioToggleIdentifier audioCursor").removeAttr("audio data-audio-type"),w.audioComponent({src:q,type:r},this.gadgetUniqueId)}if(p){if($(this).html()!==i.parent().html()){var x=$(this).find("div.c-tile:first");$(this).children(".c-tile").length>0&&(d.cloneTiles?b.animateTileToStartPos(m,x,e,l):(e.zindex=1,b.animateTileToStartPos(m,x,e),k=$(x).attr("data-id"),b.dragTiles[k].isDistrator?b.dragTiles[k].isCorrect=!0:b.dragTiles[k].isCorrect=!1,delete b.dragTiles[k].droppedZone))}else b.doRevert=!0;i.css({top:"auto",left:"auto"}).addClass("dropped-item"),b.isInstant?$(this).children().hasClass("c-tile")||($(this).append(i).addClass("ui-droppable-disabled"),i.audioComponent({src:q,type:r},this.gadgetUniqueId)):($(this).append(i).addClass("ui-droppable-disabled"),i.audioComponent({src:q,type:r},this.gadgetUniqueId))}else i.closest(".b-drop-zone").attr("data-id")===m?b.doRevert=!0:b.isInstant?"false"===$(i[0]).attr("data-clone-state")&&(i.css({top:"auto",left:"auto"}).addClass("dropped-item"),$(this).find(".open-cell:first").append(i).removeClass("open-cell"),i.audioComponent({src:q,type:r},this.gadgetUniqueId)):(i.css({top:"auto",left:"auto"}).addClass("dropped-item"),$(this).find(".open-cell:first").append(i).removeClass("open-cell"),i.audioComponent({src:q,type:r},this.gadgetUniqueId));b.isInstant&&(b.onCorrect(),b.options.feedback.showGraphicalTreatment||(i.find(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon").show(),i.removeClass("drag-item-incorrect").addClass("drag-item-correct")))}else b.doRevert=!0,b.isInstant&&(b.options.feedback.showGraphicalTreatment||(i.find(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon").show(),i.removeClass("drag-item-correct").addClass("drag-item-incorrect")),b.onIncorrect());h=b.doRevert||b.isInstant?b.wasCorrectSpotForInstant(m,n):b.wasCorrectSpot(m,n);var y=a.find(".DMZ"),z=!0,A=!1;for(g=0;g<y.length;g++)0!==$(y[g]).children(".c-tile").length||A||(z=!1,A=!0),i.parent().hasClass("b-cell")&&!b.doRevert?(b.dropZones[m].subZones[i.parent().attr("data-id")].dragId=n,b.dropZones[m].subZones[i.parent().attr("data-id")].isCorrect=h):b.doRevert||(b.dropZones[m].dragId=n,b.dropZones[m].isCorrect=h),0===$(y[g]).children().length&&($(y[g]).hasClass("b-cell")?b.dropZones[$(y[g]).parent().parent().attr("data-id")].subZones[$(y[g]).attr("data-id")]&&(b.dropZones[$(y[g]).parent().parent().attr("data-id")].subZones[$(y[g]).attr("data-id")].dragId="",b.dropZones[$(y[g]).parent().parent().attr("data-id")].subZones[$(y[g]).attr("data-id")].isCorrect=!1):(b.dropZones[$(y[g]).attr("data-id")].dragId="",b.dropZones[$(y[g]).attr("data-id")].isCorrect=!1));if((z||b.options.custom.dropNotFilled)&&a.find(".c-checkanswer-button").sliderbutton("enable"),b.isInstant&&(void 0==h&&(h=!1),b.checkAnswer(!0,h),h&&(i.draggable("disable"),i.find(".feedback-icon").addClass("correct_icon"),"true"===$(i[0]).attr("data-clone-state")&&(i.css({top:"auto",left:"auto"}).addClass("dropped-item").removeClass("ui-draggable-dragging"),$(this).find(".open-cell:first").closest(".b-drop-zone").addClass("ui-droppable-disabled"),$(this).find(".open-cell:first").append(i).removeClass("open-cell"),i.find(".feedback-icon").addClass("correct_icon")))),b.setProgressBarValue(),b.isInstant)if(0===b.jObject.find(".DMZ").filter(":empty").length){var B=!0;a:for(dropZoneKey in b.dropZones){var C=b.dropZones[dropZoneKey];if(C.subZones)for(subZoneKey in C.subZones){var D=C.subZones[subZoneKey];if(!D.isCorrect){B=!1;break a}}else if(!C.isCorrect){B=!1;break a}}b.fireEvent(B,!0)}else b.fireEvent(h,!1)}},over:function(a,b){b.draggable.addClass("drag-item-overdrop"),$(this).addClass("drop-item-over")},out:function(a,b){b.draggable.removeClass("drag-item-overdrop"),$(this).removeClass("drop-item-over")}}),a.find(".s-drop-zone, .b-drop-zone").keyup(function(c){if(PearsonGL.utils.focusItemOn(this),$(this).is(":focus")||$(this).is(":active"))switch(c.keyCode){case 13:1===a.find(".c-tile[aria-grabbed = true]").length&&(b.onDropEvent(a.find(".c-tile[aria-grabbed = true]"),$(this)),b.revertToStartPos(a.find(".c-tile[aria-grabbed = true]")),a.find(".c-tile[aria-grabbed = true]").find(".feedback-icon.incorrect_icon").fadeOut(function(){$(this).removeClass("incorrect_icon")}),a.find(".c-tile[aria-grabbed = true]").removeClass("drag-item-incorrect"),a.find(".c-tile[aria-grabbed = true]").attr("aria-grabbed",!1),b.isInstant||b.setDragStatusLive("dropped"),b.stopAudio())}}),a.find(".s-drop-zone, .b-drop-zone").blur(function(a){PearsonGL.utils.focusItemOff(this)})}},{key:"onDropEvent",value:function(a,b){var c=this.jObject,d=this,e=this.options.custom,f=e.tile,g=!1,h=void 0,i=void 0,j=a,k=a,l=void 0,m=1,n=$(b).attr("data-id"),o=j.attr("data-id"),p=d.dragTiles[o].locations,q=$(b).hasClass("s-drop-zone"),r=void 0,s=void 0,t={};if(t.offset={},d.wasDroppedOutsideOfDropzone=!1,q){if($(b).html()!==j.parent().html()){var u=$(b).find(".c-tile"),v=u.length>0&&u.hasClass("ui-draggable-disabled");if(v)return void(d.wasDroppedOutsideOfDropzone=!0)}}else if(j.closest(".b-drop-zone").attr("data-id")!==n&&0===$(b).find(".open-cell").length){if(void 0==d.options.showDropzoneFullMessage||d.options.showDropzoneFullMessage){d.removeDialogs();var w=d.options;w.isModel=!0,w.resultsText=d.options.custom.bucket.exceedsCapacityError?d.options.custom.bucket.exceedsCapacityError:d.labelOpts.capacityError,d.options.dialogType="feedback",c.dialogcomponent(w),c.find(".result-pop-up").fadeIn().focus()}return void(d.wasDroppedOutsideOfDropzone=!0)}if(d.orgDroppedZone=d.lastDroppedZone,d.lastDroppedZone=n,d.isInstant){for(h=0;h<p.length;h++)if(p[h]===n){g=!0,d.setDragStatusLive("correct"),d.customTileSortStackedTiles();break}}else g=!0,d.customTileSortStackedTiles();if(g){if(d.doRevert=!1,f.cloneTiles&&!j.hasClass("dontClone")){var x=j.find(".image-class-wrapper").length>0,y=j.find(x?".image-class-wrapper":".gadget-textblock");r=y.attr("audio"),s=y.attr("data-audio-type"),y.find(".controls").remove(),j=j.clone().addClass("dontClone"),d.createADragEventForATile(j,!1),k.remove(),y.removeClass("audioToggleIdentifier audioCursor").removeAttr("audio data-audio-type"),y.audioComponent({src:r,type:s},d.gadgetUniqueId)}if(q){if($(b).html()!==j.parent().html()){var z=$(b).find("div.c-tile:first");$(b).children(".c-tile").length>0&&(t.zindex=1,t.offset.top=$(j).offset().top,t.offset.left=$(j).offset().left,f.cloneTiles?d.animateTileToStartPos(n,z,t,m):(d.animateTileToStartPos(n,z,t),l=$(z).attr("data-id"),d.dragTiles[l].isDistrator?d.dragTiles[l].isCorrect=!0:d.dragTiles[l].isCorrect=!1,delete d.dragTiles[l].droppedZone))}else d.doRevert=!0;j.css({top:"auto",left:"auto"}).addClass("dropped-item"),d.isInstant?$(b).children().hasClass("c-tile")||($(b).append(j).addClass("ui-droppable-disabled"),j.audioComponent({src:r,type:s},d.gadgetUniqueId)):($(b).append(j).addClass("ui-droppable-disabled"),j.audioComponent({src:r,type:s},d.gadgetUniqueId))}else j.closest(".b-drop-zone").attr("data-id")===n?d.doRevert=!0:d.isInstant?"false"===$(j[0]).attr("data-clone-state")&&(j.css({top:"auto",left:"auto"}).addClass("dropped-item"),$(b).find(".open-cell:first").append(j).removeClass("open-cell"),j.audioComponent({src:r,type:s},d.gadgetUniqueId)):(j.css({top:"auto",left:"auto"}).addClass("dropped-item"),$(b).find(".open-cell:first").append(j).removeClass("open-cell"),j.audioComponent({src:r,type:s},d.gadgetUniqueId));d.isInstant&&(d.onCorrect(),d.options.feedback.showGraphicalTreatment||(j.find(".feedback-icon").removeClass("incorrect_icon").addClass("correct_icon").show(),j.removeClass("drag-item-incorrect").addClass("drag-item-correct")))}else d.doRevert=!0,d.isInstant&&(d.options.feedback.showGraphicalTreatment||(j.find(".feedback-icon").removeClass("correct_icon").addClass("incorrect_icon").show(),j.removeClass("drag-item-correct").addClass("drag-item-incorrect")),d.setDragStatusLive("incorrect"),d.onIncorrect());i=d.doRevert||d.isInstant?d.wasCorrectSpotForInstant(n,o):d.wasCorrectSpot(n,o);var A=c.find(".DMZ"),B=!0,C=!1;for(h=0;h<A.length;h++)0!==$(A[h]).children(".c-tile").length||C||(B=!1,C=!0),j.parent().hasClass("b-cell")&&!d.doRevert?(d.dropZones[n].subZones[j.parent().attr("data-id")].dragId=o,d.dropZones[n].subZones[j.parent().attr("data-id")].isCorrect=i):d.doRevert||(d.dropZones[n].dragId=o,d.dropZones[n].isCorrect=i),0===$(A[h]).children().length&&($(A[h]).hasClass("b-cell")?d.dropZones[$(A[h]).parent().parent().attr("data-id")].subZones[$(A[h]).attr("data-id")]&&(d.dropZones[$(A[h]).parent().parent().attr("data-id")].subZones[$(A[h]).attr("data-id")].dragId="",d.dropZones[$(A[h]).parent().parent().attr("data-id")].subZones[$(A[h]).attr("data-id")].isCorrect=!1):(d.dropZones[$(A[h]).attr("data-id")].dragId="",d.dropZones[$(A[h]).attr("data-id")].isCorrect=!1));if((B||d.options.custom.dropNotFilled)&&c.find(".c-checkanswer-button").sliderbutton("enable"),d.isInstant&&(void 0==i&&(i=!1),d.checkAnswer(!0,i),i&&(j.draggable("disable"),j.find(".feedback-icon").addClass("correct_icon"),"true"===$(j[0]).attr("data-clone-state")&&(j.css({top:"auto",left:"auto"}).addClass("dropped-item").removeClass("ui-draggable-dragging"),$(b).find(".open-cell:first").closest(".b-drop-zone").addClass("ui-droppable-disabled"),$(b).find(".open-cell:first").append(j).removeClass("open-cell"),j.find(".feedback-icon").addClass("correct_icon")))),d.setProgressBarValue(),d.isInstant)if(0===d.jObject.find(".DMZ").filter(":empty").length){var D=!0;a:for(dropZoneKey in d.dropZones){var E=d.dropZones[dropZoneKey];if(E.subZones)for(subZoneKey in E.subZones){var F=E.subZones[subZoneKey];if(!F.isCorrect){D=!1;break a}}else if(!E.isCorrect){D=!1;break a}}d.fireEvent(D,!0)}else d.fireEvent(i,!1)}},{key:"setDragStatusLive",value:function(a){this.dragStatusLive.html(a)}},{key:"setShowAnswerButtonStates",value:function(a){var b=this.jObject;"enable"===a&&b.find(".c-myanswer-button").children().length>0?(window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){b.find(".c-myanswer-button").sliderbutton(a),b.find(".c-answer-button").sliderbutton(a)},0)):b.find(".c-myanswer-button").children().length>0&&(b.find(".c-myanswer-button").sliderbutton(a),b.find(".c-answer-button").sliderbutton(a))}},{key:"addButtons",value:function(){var a=this,b=this.options.buttons,c=this.jObject;c.append("<div class='c-button-group'><div class='c-button-wrapper c-checkanswer-button'></div><div class='c-button-wrapper c-reset-button'></div><div class='c-button-wrapper c-answer-button'></div><div class='c-button-wrapper c-myanswer-button'></div></div>"),a.isInstant?c.find(".c-checkanswer-button").remove():(c.find(".c-checkanswer-button").sliderbutton({buttonClassName:"c-button",slider:!0,buttonText:b.checkAnswerButton,clickFunction:function(d){a.sendAnalytics("clicked_check_answer_button"),c.find(".result-pop-up,.modal-dialog-window").fadeOut(function(){$(this).remove()});var e=d.jObject;e.find(".button-text").html(b.checkAnswerButton),e.hasClass("base-button-disable")||(e.hasClass("try-again")?(e.removeClass("try-again"),a.doingReset=!0,c.find(".incorrect_icon").parent(".c-tile.ui-draggable-disabled").draggable("enable"),c.find(".c-tile").each(function(){$(this).data("ui-draggable")&&!$(this).hasClass("drag-item-correct")&&$(this).draggable("enable")}),a.resetTiles(1),a.doingReset=!1,c.find(".ui-droppable-disabled").find(".c-tile").each(function(){$(this).data("ui-draggable")&&$(this).draggable("disable")}),a.options.numberOfTries||c.find(".c-tile:not(.original)").each(function(){$(this).find(".feedback-icon").hasClass("correct_icon")||$(this).remove()})):(e.find(".button-text").html(b.tryAgainButton),e.addClass("try-again"),a.checkAnswer(),a.options.submitScoreOnFirstAttempt&&!a.options.scoreFinalized&&(a.options.scoreFinalized=!0,a.scormData.scoreFinalized=!0),c.find(".c-tile").each(function(){$(this).data("ui-draggable")&&$(this).draggable("disable")})))}}),c.find(".c-checkanswer-button").sliderbutton("disable")),b.resetButtonGroup?c.find(".c-reset-button").sliderbutton({buttonClassName:"c-button",slider:!0,buttonText:b.resetButtonGroup[0].resetButtonText||"Start Over",clickFunction:function(d){if(!d.jObject.hasClass("base-button-disable")){if(b.resetButtonGroup[0].resetConfirmText=b.resetButtonGroup[0].resetConfirmText||"Are you sure you want to start over?",b.resetButtonGroup[0].resetConfirmText){a.removeDialogs();var e=a.options;e.keyPressEventHandler=function(){a.doReset(),$(window).trigger(a.gadgetUniqueId+"calculateBestTime","calculateBestTime"),setTimeout(function(){c.find(".stopwatch-modal").siblings().css({visibility:"hidden"}),c.find(".stopwatch-modal").focus()},100),a.setDragStatusLive("start over button clicked all the tiles move back to the starting position")},e.isModal=!0,e.resultsText=b.resetButtonGroup[0].resetConfirmText,a.options.dialogType="confirm",c.dialogcomponent(e),c.find(".checker-pop-up").fadeIn().focus()}else a.doReset(),$(window).trigger(a.gadgetUniqueId+"calculateBestTime","calculateBestTime"),setTimeout(function(){c.find(".stopwatch-modal").siblings().css({visibility:"hidden"}),c.find(".stopwatch-modal").focus()},100),a.setDragStatusLive("start over button clicked all the tiles move back to the starting position");a.stopAudio()}}}):c.find(".c-reset-button").hide(),!this.isInstant&&b.showAnswerButtonGroup&&(c.find(".c-answer-button").sliderbutton({buttonClassName:"c-button",slider:!0,buttonText:b.showAnswerButtonGroup[0].showAnswerButton,clickFunction:function(b){b.jObject.hasClass("base-button-disable")||(c.find(".c-answer-button").hide(),c.find(".c-myanswer-button").show(),a.setShowAnswerButtonStates("disable"),a.options.custom.valueMode?a.showCorrectAnswerValueMode():a.totalCountReachedShowCorrectAnswers(),a.setDragStatusLive("show answer button clicked, dropzones have correct tiles"),c.find(".result-pop-up,.modal-dialog-window").fadeOut(function(){$(this).remove()}))}}),c.find(".c-myanswer-button").sliderbutton({buttonClassName:"c-button",slider:!0,buttonText:b.showAnswerButtonGroup[0].showMyAnswersButton,clickFunction:function(b){b.jObject.hasClass("base-button-disable")||(c.find(".c-answer-button").show(),c.find(".c-myanswer-button").hide(),a.setShowAnswerButtonStates("disable"),a.showMyAnswers(),a.setDragStatusLive("show my answer button clicked, dropzones have your tiles"))}}),a.options.showCorrectAnswerOnFinalAttempt&&(c.find(".c-answer-button").remove(),c.find(".c-myanswer-button").remove()),c.find(".c-answer-button").sliderbutton("disable")),c.find(".c-answer-button").hide(),c.find(".c-myanswer-button").hide()}},{key:"stopAudio",value:function(){this.jObject.find(".audioToggleIdentifier").each(function(){$(this).audioComponent("pause")})}},{key:"doReset",value:function(){var a=this.jObject;this.quit=!1,this.doingReset=!0,this.resetCountsAndEnableAll(),this.resetTiles(),this.doingReset=!1,a.find(".ui-droppable-disabled").droppable("enable"),a.find(".result-pop-up,.modal-dialog-window,.dialog-box-window").fadeOut(function(){$(this).remove()})}},{key:"resetCountsAndEnableAll",value:function(){var a=void 0,b=void 0,c=this.jObject,d=void 0,e=void 0,f=void 0,g=void 0;for(c.find(".c-tile.ui-draggable-disabled").each(function(){$(this).data("ui-draggable")&&$(this).draggable("enable")}),c.find(".feedback-icon").removeClass("incorrect_icon correct_icon"),c.find(".c-tile").removeClass("drag-item-correct drag-item-incorrect"),this.totalTriesCount=0,this.scormData.numberOfTries=this.totalTriesCount,a=0;a<c.find(".c-tile").length;a++)b=this.dragTiles[$(c.find(".c-tile")[a]).attr("data-id")],b.isCorrect=!1,b.maxTriesCount=0;c.find(".b-cell").addClass("open-cell"),c.find(".c-checkanswer-button").find(".button-text").html(this.options.buttons.checkAnswerButton),c.find(".c-checkanswer-button").removeClass("try-again").sliderbutton("disable");for(e in this.dropZones)if(d=this.dropZones[e],d.subZones)for(f in d.subZones)d.subZones[f].isCorrect=!1,d.subZones[f].dragId="";else d.dragId="",d.isCorrect=!1;for(e in this.dragTiles)g=this.dragTiles[e],g.droppedZone="",g.lastDroppedZone="";c.find(".c-answer-button, .c-myanswer-button").hide()}},{key:"buildDropZones",value:function(){var a=this,b=this.jObject,c=this.options.custom,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,k=c.bucket,l=c.single,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=b.find(".custom-holder");if(this.dropZones={},l.dropZones&&l.dropZones.length>0)for(h=l.cellWidth?l.cellWidth:void 0,i=l.cellHeight?l.cellHeight:void 0,d=0;d<l.dropZones.length;d++)g=l.dropZones[d],m=g.matchId?g.matchId:"SDD_"+d,o=g.dropZoneValue||0==g.dropZoneValue?PearsonGL.qtiEvaluator.replaceParameters(g.dropZoneValue):PearsonGL.qtiEvaluator.replaceParameters(l.globalDropZoneValue),p=g.xcoord,q=g.ycoord,r=g.altText?PearsonGL.qtiEvaluator.replaceParameters(g.altText):"",s=g.width?g.width:h,t=g.height?g.height:i,z=g.readOrder,A=$('<div title="'+r+'" class="s-drop-zone DMZ" style="width:'+s+"px;height:"+t+"px;left:"+p+"px;top:"+q+'px;" data-id="'+m+'" data-dropzone-value="'+o+'" data-readorder="'+z+'"><div class="feedback-icon sprite" data-icon="ic-marker"></div></div>'),a.options.custom.single.dropZones&&a.options.custom.single.dropZones.length>0&&void 0!==a.options.custom.single.dropZones[0].readOrder?a.allElement.push(A):A.appendTo(D),A.attr({tabindex:"0",role:"button","aria-dropeffect":"move"}),r&&A.append($('<label class="hidden-label">'+r+"</label>")),this.dropZones[m]={},this.progressBarOptions.dropZoneCount++;if(k.dropZones&&k.dropZones.length>0)for(h=k.cellWidth?k.cellWidth:void 0,i=k.cellHeight?k.cellHeight:void 0,d=0;d<k.dropZones.length;d++)for(n=0,g=k.dropZones[d],m=g.matchId?g.matchId:"BDD_"+d,o=g.dropZoneValue||0==g.dropZoneValue?PearsonGL.qtiEvaluator.replaceParameters(g.dropZoneValue):PearsonGL.qtiEvaluator.replaceParameters(k.globalDropZoneValue),p=g.xcoord,q=g.ycoord,r=g.altText?PearsonGL.qtiEvaluator.replaceParameters(g.altText):"",s=g.width?g.width:h,t=g.height?g.height:i,w=g.cols,x=g.rows,y=g.max?g.max:w*x,u=void 0!==g.vspace?g.vspace:k.verticalSpacing,v=void 0!==g.hspace?g.hspace:k.horizonalSpacing,u=void 0!==u?u:0,v=void 0!==v?v:0,B=w*s+w*(2*v),C=x*t+x*(2*u),z=g.readOrder,A=$('<ul title="'+r+'" class="b-drop-zone" style="width:'+B+"px;height:"+C+"px;left:"+p+"px;top:"+q+'px;" data-id="'+m+'" data-dropzone-value="'+o+'" data-readorder="'+z+'"><div class="feedback-icon sprite" data-icon="ic-marker"></div></ul>'),a.options.custom.bucket.dropZones&&a.options.custom.bucket.dropZones.length>0&&void 0!==a.options.custom.bucket.dropZones[0].readOrder?a.allElement.push(A):A.appendTo(D),A.attr({tabindex:"0",role:"button","aria-dropeffect":"move"}),r&&A.append($('<label class="hidden-label">'+r+"</label>")),this.dropZones[m]={},this.dropZones[m].subZones={},e=0;e<x;e++)for(a.options.custom.bucket.dropZones&&a.options.custom.bucket.dropZones.length>0&&void 0!==a.options.custom.bucket.dropZones[0].readOrder?A.append('<li class="b-row"></li>'):b.find(".b-drop-zone:last").append('<li class="b-row"></li>'),f=0;f<w;f++)n<y?(a.options.custom.bucket.dropZones&&a.options.custom.bucket.dropZones.length>0&&void 0!==a.options.custom.bucket.dropZones[0].readOrder?A.find(".b-row:last").append('<div data-id="bd'+n+'" class="b-cell open-cell DMZ" style="margin:'+u+"px "+v+"px;width:"+s+"px;height:"+t+'px"></div>'):$(D).find(".b-row:last").append('<div data-id="bd'+n+'" class="b-cell open-cell DMZ" style="margin:'+u+"px "+v+"px;width:"+s+"px;height:"+t+'px"></div>'),this.dropZones[m].subZones["bd"+n]={},this.progressBarOptions.dropZoneCount++):a.options.custom.bucket.dropZones&&a.options.custom.bucket.dropZones.length>0&&void 0!==a.options.custom.bucket.dropZones[0].readOrder?A.find(".b-row:last").css("padding-left",.5*s+v):$(D).find(".b-row:last").css("padding-left",.5*s+v),n++;if(a.options.custom.single.dropZones&&a.options.custom.single.dropZones.length>0&&void 0!==a.options.custom.single.dropZones[0].readOrder)for(this.options.custom.imageLabels&&this.options.custom.textLabels?a.allLabels=a.options.custom.textLabels.concat(a.options.custom.imageLabels):this.options.custom.textLabels?a.allLabels=this.options.custom.textLabels:this.options.custom.imageLabels&&(a.allLabels=this.options.custom.imageLabels),a.allDraggables=a.options.custom.tile.imageTiles?a.options.custom.tile.textTiles.concat(a.options.custom.tile.imageTiles):a.options.custom.tile.textTiles,a.allDroppables=a.options.custom.tile.textImageTiles?a.allDraggables.concat(a.options.custom.tile.textImageTiles):a.allDraggables,a.allReadOrder=a.options.custom.single.dropZones.concat(a.allLabels).concat(a.allDroppables),a.allReadOrder.sort(function(a,b){return a.readOrder-b.readOrder}),d=0;d<a.allElement.length;d++)for(j=0;j<a.allReadOrder.length;j++)a.allReadOrder[d].readOrder===parseInt($(a.allElement[j][0]).attr("data-readorder"))&&b.find(".custom-holder").append(a.allElement[j]);else if(a.options.custom.bucket.dropZones&&a.options.custom.bucket.dropZones.length>0&&void 0!==a.options.custom.bucket.dropZones[0].readOrder)for(this.options.custom.imageLabels&&this.options.custom.textLabels?a.allLabels=a.options.custom.textLabels.concat(a.options.custom.imageLabels):this.options.custom.textLabels?a.allLabels=this.options.custom.textLabels:this.options.custom.imageLabels&&(a.allLabels=this.options.custom.imageLabels),a.allDraggables=a.options.custom.tile.imageTiles?a.options.custom.tile.textTiles.concat(a.options.custom.tile.imageTiles):a.options.custom.tile.textTiles,a.allDroppables=a.options.custom.tile.textImageTiles?a.allDraggables.concat(a.options.custom.tile.textImageTiles):a.allDraggables,a.allReadOrder=a.options.custom.bucket.dropZones.concat(a.allLabels).concat(a.allDroppables),a.allReadOrder.sort(function(a,b){return a.readOrder-b.readOrder}),d=0;d<a.allElement.length;d++)for(j=0;j<a.allReadOrder.length;j++)a.allReadOrder[d].readOrder===parseInt($(a.allElement[j][0]).attr("data-readorder"))&&b.find(".custom-holder").append(a.allElement[j]);a.customTileSortStackedTiles()}},{key:"buildTiles",value:function(){var a=this,b=this.jObject,c=this.options.custom,d=c.tile,e=b.find(".custom-holder"),f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0;if(this.isRandom=this.options.randomize,this.isRandom&&this.randomizeTiles(d),d.textTiles)for(t=d.width?d.width:void 0,u=d.height?d.height:void 0,f=0;f<d.textTiles.length;f++)h=d.textTiles[f],v=h.cloneTiles,g=h.matchIds,i=h.tileValue?PearsonGL.qtiEvaluator.replaceParameters(h.tileValue):PearsonGL.qtiEvaluator.replaceParameters(d.globalTileValue),j=h.xcoord,k=h.ycoord,h.zindex?"z-index: "+h.zindex+"; ":"",m=h.width?h.width:t,n=h.height?h.height:u,l=h.value,o=h.audioComponent,r=h.readOrder,q=$('<div data-id="TT'+f+'" data-tile-value="'+i+'" class="c-tile c-text-tile drag-item original hide-tile" data-clone-state="'+v+'" style="top:'+k+"px;left:"+j+"px;width:"+m+"px;height:"+n+'px" data-readorder='+r+"></div>"),a.options.custom.tile.textTiles&&a.options.custom.tile.textTiles.length>0&&void 0!==a.options.custom.tile.textTiles[0].readOrder?a.allElement.push(q):q.appendTo(e),q.richtextcomponent(this.createRichTextObj(l)),"shake"==a.options.tileEffects?q.addClass("ps-shake"):"glow"==a.options.tileEffects&&q.addClass("ps-glow"),o&&""!==o.src&&(a.options.runtimejson.gadgetOptions&&a.options.runtimejson.gadgetOptions.TileSort&&a.options.runtimejson.gadgetOptions.TileSort.customMode&&a.options.runtimejson.gadgetOptions.TileSort.customMode.resetAudioOnPause&&(o.resetAudioOnPause=!0),o.labelOpts=this.labelOpts,q.find(".gadget-textblock").audioComponent(o,this.gadgetUniqueId)),q.append('<div class="feedback-icon sprite" data-icon="ic-marker"></div>'),q.attr("tabindex","0").attr("role","button").attr("aria-grabbed",!1),this.dragTiles["TT"+f]={},g?this.dragTiles["TT"+f].isDistractor=!1:(g=this.fakeTileName,this.dragTiles["TT"+f].isDistractor=!0,c.valueMode&&(this.dragTiles["TT"+f].isDistractor=!1)),this.dragTiles["TT"+f].locations=g.split(","),this.dragTiles["TT"+f].maxTriesCount=0,this.dragTiles["TT"+f].cloneState=v;if(d.imageTiles)for(t=d.width?d.width:void 0,u=d.height?d.height:void 0,f=0;f<d.imageTiles.length;f++)h=d.imageTiles[f],v=h.cloneTiles,g=h.matchIds,i=h.tileValue?PearsonGL.qtiEvaluator.replaceParameters(h.tileValue):PearsonGL.qtiEvaluator.replaceParameters(d.globalTileValue),j=h.xcoord,k=h.ycoord,h.zindex?"z-index: "+h.zindex+"; ":"",m=h.tileWidth?h.tileWidth:t,n=h.tileHeight?h.tileHeight:u,p=h.imageComponent,p.protect=!1,o=h.audioComponent,r=h.readOrder,q=$('<div data-id="IT'+f+'" data-tile-value="'+i+'" class="c-tile c-image-tile drag-item original hide-tile" data-clone-state="'+v+'" style="top:'+k+"px;left:"+j+'px;" data-readorder='+r+"></div>"),a.options.custom.tile.imageTiles&&a.options.custom.tile.imageTiles.length>0&&void 0!==a.options.custom.tile.imageTiles[0].readOrder?a.allElement.push(q):q.appendTo(e),q.imagecomponent(p),"shake"==a.options.tileEffects?q.addClass("ps-shake"):"glow"==a.options.tileEffects&&q.addClass("ps-glow"),s=q.find("img"),s.css({width:m+"px",height:n+"px"}),s.attr("draggable","false"),s.on("dragstart",function(){return!1}),o&&""!==o.src&&(a.options.runtimejson.gadgetOptions&&a.options.runtimejson.gadgetOptions.TileSort&&a.options.runtimejson.gadgetOptions.TileSort.customMode&&a.options.runtimejson.gadgetOptions.TileSort.customMode.resetAudioOnPause&&(o.resetAudioOnPause=!0),o.labelOpts=this.labelOpts,q.find(".image-class-wrapper").audioComponent(o,this.gadgetUniqueId)),q.append('<div class="feedback-icon sprite" data-icon="ic-marker"></div>'),q.attr("tabindex","0").attr("role","button").attr("aria-grabbed",!1),this.dragTiles["IT"+f]={},g?this.dragTiles["IT"+f].isDistractor=!1:(g=this.fakeTileName,this.dragTiles["IT"+f].isDistractor=!0,c.valueMode&&(this.dragTiles["IT"+f].isDistractor=!1)),this.dragTiles["IT"+f].locations=g.split(","),this.dragTiles["IT"+f].maxTriesCount=0,this.dragTiles["IT"+f].cloneState=v;if(d.textImageTiles)for(t=d.width?d.width:void 0,u=d.height?d.height:void 0,f=0;f<d.textImageTiles.length;f++)h=d.textImageTiles[f],v=h.cloneTiles,g=h.matchIds,i=h.tileValue?PearsonGL.qtiEvaluator.replaceParameters(h.tileValue):PearsonGL.qtiEvaluator.replaceParameters(d.globalTileValue),j=h.xcoord,k=h.ycoord,h.zindex?"z-index: "+h.zindex+"; ":"",m=h.tileWidth?h.tileWidth:t,n=h.tileHeight?h.tileHeight:u,l=h.value,p=h.imageComponent,p.protect=!1,o=h.audioComponent,r=h.readOrder,q=$('<div data-id="TI'+f+'" data-tile-value="'+i+'" class="c-tile c-text-tile c-image-tile drag-item original hide-tile" data-clone-state="'+v+'" style="top:'+k+"px;left:"+j+"px;width:"+m+"px;height:"+n+'px" data-readorder='+r+"></div>"),a.options.custom.tile.textImageTiles&&a.options.custom.tile.textImageTiles.length>0&&void 0!==a.options.custom.tile.textImageTiles[0].readOrder?a.allElement.push(q):q.appendTo(e),"textTop"===h.textImage?(q.richtextcomponent(this.createRichTextObj(l)),q.imagecomponent(p)):(q.imagecomponent(p),q.richtextcomponent(this.createRichTextObj(l))),"shake"==a.options.tileEffects?q.addClass("ps-shake"):"glow"==a.options.tileEffects&&q.addClass("ps-glow"),s=q.find("img"),s.attr("draggable","false"),s.on("dragstart",function(){return!1}),o&&""!==o.src&&(a.options.runtimejson.gadgetOptions&&a.options.runtimejson.gadgetOptions.TileSort&&a.options.runtimejson.gadgetOptions.TileSort.customMode&&a.options.runtimejson.gadgetOptions.TileSort.customMode.resetAudioOnPause&&(o.resetAudioOnPause=!0),o.labelOpts=this.labelOpts,q.find(".image-class-wrapper").audioComponent(o,this.gadgetUniqueId)),q.append('<div class="feedback-icon sprite" data-icon="ic-marker"></div>'),q.attr("tabindex","0").attr("role","button").attr("aria-grabbed",!1),this.dragTiles["TI"+f]={},g?this.dragTiles["TI"+f].isDistractor=!1:(g=this.fakeTileName,this.dragTiles["TI"+f].isDistractor=!0,c.valueMode&&(this.dragTiles["TI"+f].isDistractor=!1)),this.dragTiles["TI"+f].locations=g.split(","),this.dragTiles["TI"+f].maxTriesCount=0,this.dragTiles["TI"+f].cloneState=v;setTimeout(function(){$(".custom-sorter-identifier").each(function(a,b){b=$(b);var c=b.find(".custom-holder .drag-item"),d=c.first().css("top").split("px").slice(0,1)[0],e=c.first().css("left").split("px").slice(0,1)[0];c.toArray().every(function(a){var b=$(a).css("top").split("px").slice(0,1)[0],c=$(a).css("left").split("px").slice(0,1)[0];return d===b&&e===c})&&b.addClass("tiles-stacked")})})}},{key:"customTileSortStackedTiles",value:function(){setTimeout(function(){$(".custom-sorter-identifier").each(function(a,b){b=$(b);var c=0,d=b.find(".custom-holder .drag-item:not(.dropped-item)");$(d).each(function(a){$(this).attr("tabindex","0"),$(this).find(".audio-play").attr("tabindex","0"),$(this).find(".audio-pause").attr("tabindex","0")}),d.toArray().every(function(a){c++;var b=$(a).css("top").split("px").slice(0,1)[0],e=$(a).css("left").split("px").slice(0,1)[0],f=$(a).next().css("top").split("px").slice(0,1)[0],g=$(a).next().css("left").split("px").slice(0,1)[0];return f===b&&g===e&&($(a).attr("tabindex","-1"),$(a).find(".audio-play").attr("tabindex","-1"),$(a).find(".audio-pause").attr("tabindex","-1")),c<d.length})})})}},{key:"buildLabels",value:function(){var a=this,b=this.options.custom,c=this.jObject,d=c.find(".custom-holder"),e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0;if(b.textLabels)for(e=0;e<b.textLabels.length;e++)f=b.textLabels[e],g=f.xcoord,h=f.ycoord,i=f.text,j=f.audioComponent,l=f.readOrder,k=f.width?"width:"+f.width+"px;":"",a.options.custom.textLabels&&a.options.custom.textLabels.length>0&&void 0!==a.options.custom.textLabels[0].readOrder?(f=$('<div class="c-label" style="top:'+h+"px;left:"+g+"px;"+k+'" data-readorder='+l+"></div>"),f.richtextcomponent(this.createRichTextObj(i)),f.unbind("mouseup"),j&&""!==j.src&&(j.labelOpts=this.labelOpts,f.find(".gadget-textblock").audioComponent(j,this.gadgetUniqueId)),a.allElement.push(f)):($(d).append('<div class="c-label" style="top:'+h+"px;left:"+g+"px;"+k+'"></div>'),$(d).find(".c-label:last").richtextcomponent(this.createRichTextObj(i)),$(d).find(".c-label:last").unbind("mouseup"),j&&""!==j.src&&(j.labelOpts=this.labelOpts,$(d).find(".c-label:last").find(".gadget-textblock").audioComponent(j,this.gadgetUniqueId)));if(b.imageLabels)for(e=0;e<b.imageLabels.length;e++)f=b.imageLabels[e],g=f.xcoord,h=f.ycoord,i=f.imageComponent.title,j=f.audioComponent,img=f.imageComponent,l=f.readOrder,a.options.custom.imageLabels&&a.options.custom.imageLabels.length>0&&void 0!==a.options.custom.imageLabels[0].readOrder?(f=$('<div class="c-label" style="top:'+h+"px;left:"+g+'px;" data-readorder='+l+' aria-label="'+i+'"></div>'),f.imagecomponent(img),f.unbind("mouseup"),j&&""!==j.src&&(j.labelOpts=this.labelOpts,f.find(".image-class-wrapper").audioComponent(j,this.gadgetUniqueId)),a.allElement.push(f)):($(d).append('<div class="c-label" style="top:'+h+"px;left:"+g+'px;"></div>'),$(d).find(".c-label:last").imagecomponent(img),$(d).find(".c-label:last").unbind("mouseup"),j&&""!==j.src&&(j.labelOpts=this.labelOpts,$(d).find(".c-label:last").find(".image-class-wrapper").audioComponent(j,this.gadgetUniqueId)))}},{key:"buildProgressBar",value:function(){var a=this.jObject,b=null;if(Array.isArray(this.options.custom.progress)&&this.options.custom.progress.length>0&&(b=this.options.custom.progress[0],this.progressBarOptions.useGraphical=!!b.graphicalProgressIndicator,this.progressBarOptions.useNumeric=!!b.numericProgressIndicator),this.progressBarOptions.useGraphical||this.progressBarOptions.useNumeric){var c=$("<div class='progress-indicator'></div>"),d=$("<div class='progress-bar'></div>"),e=$("<div class='progress'></div>");"number"==typeof b.xCoordinate&&c.css("left",b.xCoordinate+"px"),"number"==typeof b.yCoordinate&&c.css("top",b.yCoordinate+"px"),"number"==typeof b.width&&c.width(b.width),c.appendTo(a),this.progressBarOptions.useNumeric&&e.appendTo(c),this.progressBarOptions.useGraphical&&(d.appendTo(c),d.slider({range:"min",min:0,max:100,disabled:!0,create:function(a,b){$(this).children(".ui-slider-handle").removeAttr("href"),$(this).children(".ui-slider-handle").hide()}})),this.setProgressBarValue(0)}}},{key:"setProgressBarValue",value:function(a){if(!(this.progressBarOptions.dropZoneCount<1)){var b="number"==typeof a?a:this.jObject.find(".DMZ").find(".c-tile").length,c=b/this.progressBarOptions.dropZoneCount*100;this.progressBarOptions.useGraphical&&this.jObject.find(".progress-indicator .progress-bar").slider("option","value",c),this.progressBarOptions.useNumeric&&this.jObject.find(".progress-indicator .progress").text(b+" "+this.options.ofLabel+" "+this.progressBarOptions.dropZoneCount)}}},{key:"onCorrect",value:function(){"string"==typeof this.options.correctAudio&&""!==this.options.correctAudio&&this.jObject.find(".dnd-correct-audio").audioComponent("play")}},{key:"onIncorrect",value:function(){"string"==typeof this.options.inCorrectAudio&&""!==this.options.inCorrectAudio&&this.jObject.find(".dnd-in-correct-audio").audioComponent("play")}},{key:"setGadget",value:function(){var a=this.jObject,b=this.scormData.tilePattern,c=void 0,d=void 0,e=void 0,f=!0,g=void 0,h=void 0,i=void 0,j=this.options.custom.tile.cloneTiles,k=this.options.feedback.showGraphicalTreatment;if(this.totalTriesCount=this.scormData.numberOfTries,this.options.submitScoreOnFirstAttempt&&this.scormData.scoreFinalized&&(this.options.scoreFinalized=this.scormData.scoreFinalized),0!==b.length){this.dropZones=b;for(c in b)if(zoneId=b[c],h=zoneId.isCorrect,zoneId.dragId&&(this.dragTiles[zoneId.dragId].isCorrect=h,this.dragTiles[zoneId.dragId].droppedZone=c),zoneId.dragId&&"string"==typeof zoneId.dragId)e=a.find(".c-tile[data-id="+zoneId.dragId+"]:not(.dropped-item)"),j&&(e=$(e).clone(),$(e).addClass("dontClone"),this.totalTriesCount>0&&this.createADragEventForATile($(e),!1)),e.removeClass("ps-shake ps-glow"),a.find(".DMZ[data-id="+c+"]").append(e),$(e).css({top:"auto",left:"auto"}).addClass("dropped-item"),(this.isInstant||1==this.scormData.checkedAnswer)&&($(e).data("ui-draggable")&&$(e).draggable("disable"),i=h?"correct_icon":"incorrect_icon",$(e).find(".feedback-icon").addClass(i).hide(),k||($(e).find(".feedback-icon").show(),$(e).toggleClass("drag-item-correct",h),$(e).toggleClass("drag-item-incorrect",!h)));else if(zoneId.subZones)for(d in zoneId.subZones)(g=zoneId.subZones[d].dragId)&&g.length>0&&(h=zoneId.subZones[d].isCorrect,this.dragTiles[g].isCorrect=h,this.dragTiles[g].droppedZone=d,e=a.find(".c-tile[data-id="+g+"]:not(.dropped-item)"),j&&(e=$(e).clone(),$(e).addClass("dontClone"),this.totalTriesCount>0&&this.createADragEventForATile($(e),!1)),e.removeClass("ps-shake ps-glow"),a.find(".b-drop-zone[data-id="+c+"]").find(".b-cell[data-id="+d+"]").append(e).removeClass("open-cell"),$(e).css({top:"auto",left:"auto"}).addClass("dropped-item"),(this.isInstant||1==this.scormData.checkedAnswer)&&($(e).data("ui-draggable")&&$(e).draggable("disable"),i=h?"correct_icon":"incorrect_icon",$(e).find(".feedback-icon").addClass(i).hide(),k||($(e).find(".feedback-icon").show(),$(e).toggleClass("drag-item-correct",h),$(e).toggleClass("drag-item-incorrect",!h))));else f=!1;if(this.setProgressBarValue(),this.markDropZones(this.isInstant,null,!0),!this.isInstant)if(f&&this.totalTriesCount<this.options.numberOfTries){var l=a.find(".c-checkanswer-button");l.sliderbutton("enable"),1==this.scormData.checkedAnswer&&(l.find(".button-text").html(this.options.buttons.tryAgainButton),l.addClass("try-again"))}else this.options.buttons.showAnswerButtonGroup&&this.totalTriesCount>=this.options.numberOfTries&&(a.find(".c-answer-button").show().sliderbutton("enable"),a.find(".c-myanswer-button").hide().sliderbutton("enable"))}}},{key:"parseLearnerData",value:function(){var a=this.options.scorm.suspendData.data;"object"===(void 0===a?"undefined":_typeof(a))&&(this.scormData=a,this.setGadget())}},{key:"saveLearnerData",value:function(a){if(this.isCommEnabled()){var b=void 0,c=[];if(this.options.scorm.suspendData.data=this.scormData,!a&&!this.options.scoreFinalized)for(b=0;b<this.options.scorm.interactions.length;b++){result=this.getResult(this.options.scorm.interactions[b].objectives[0]),result.correctResponses=[{pattern:[]}],result.learnerResponse=[];var d=void 0,e=void 0,f=void 0;for(d in this.dragTiles)this.dragTiles[d].isDistractor||result.correctResponses[0].pattern.push([d,this.dragTiles[d].locations[0]]);for(d in this.dropZones)if(e=this.dropZones[d],e.dragId&&"string"==typeof e.dragId)result.learnerResponse.push([e.dragId,d]);else if(e.subZones)for(bucketKey in e.subZones)f=e.subZones[bucketKey].dragId,result.learnerResponse.push([f,d]);c.push(result)}this.setLearnerData({gadgetId:this.gadgetUniqueId,data:this.options.scorm,results:c})}}},{key:"calcProgressMeasured",value:function(){var a=this,b=(this.jObject,0),c=this.jObject.find(".DMZ"),d=this.jObject.find(".DMZ").length,e=void 0,f=void 0,g=void 0;for(x=0;x<c.length;x++)$(c[x]).children(".c-tile").length>0&&($(c[x]).hasClass("b-cell")?a.dropZones[$(c[x]).parent().parent().attr("data-id")].subZones[$(c[x]).attr("data-id")].dragId=$(c[x]).children(".c-tile").attr("data-id"):a.dropZones[$(c[x]).attr("data-id")].dragId=$(c[x]).children(".c-tile").attr("data-id"));for(e in this.dropZones)if(f=this.dropZones[e],f.dragId&&"string"==typeof f.dragId)b++;else if(f.subZones)for(g in f.subZones)f.subZones[g].dragId&&b++;return isNaN(b/d)?0:b/d}},{key:"countTotalDropZones",value:function(){var a=this,b=(this.jObject,0);return a.jObject.find(".s-drop-zone, .b-drop-zone").each(function(){var c=$(this).find(".b-cell").length,d=$(this).attr("data-id"),e=!1;for(tile in a.dragTiles){var f=a.dragTiles[tile].locations;for(x=0;x<f.length;x++)if(d===f[x]){e=!0,c>0?b+=c:b++;break}if(e)break}}),b}},{key:"getResult",value:function(a){var b=this,c=this.jObject,d=b.countTotalDropZones(),e={};try{if(a.score.min=0,a.score.raw=a.score.max*(this.calculateScores()/d),b.options.custom.valueMode)a.score.raw=a.score.max*(this.markDropZones(!1,null,!1)/b.jObject.find(".s-drop-zone, .b-drop-zone").length);else{var f=!1;c.find(".s-drop-zone, .b-drop-zone").each(function(){b.options.custom.dropNotFilled&&!b.isDropzoneFilled($(this))&&(b.correctTileAvailable($(this))||(f=!b.correctTileAvailable($(this))))}),b.scormData.allCorrect&&b.options.custom.dropNotFilled&&f&&(a.score.raw=a.score.max)}a.score.max-a.score.min!=0?a.score.scaled=(a.score.raw-a.score.min)/(a.score.max-a.score.min):a.score.scaled=1,e.raw=a.score.raw,e.min=a.score.min,e.max=a.score.max,e.scaled=a.score.scaled,a.progress_measure=b.calcProgressMeasured(),e.progressMeasure=a.progress_measure,a.completion_status="incomplete",a.success_status="unknown",e.completionStatus="incomplete",e.successStatus="unknown",parseFloat(a.progress_measure)>=parseFloat(a.completionThreshold)&&(a.completion_status="completed",e.completionStatus="completed"),this.isInstant||(a.completion_status="incomplete",e.completionStatus="incomplete",1==this.scormData.checkedAnswer&&(this.totalTriesCount>=this.options.numberOfTries||this.scormData.allCorrect)&&(a.completion_status="completed",e.completionStatus="completed")),"completed"===a.completion_status&&(parseFloat(a.score.scaled)>=parseFloat(PearsonGL.globals.comm.getPassingScore())?(a.success_status="passed",e.successStatus="passed"):(a.success_status="failed",e.successStatus="failed")),b.options.submitScoreOnFirstAttempt&&!b.options.scoreFinalized&&(a.completion_status="completed",e.completionStatus="completed")}catch(a){}return e.result=e.scaled,e}},{key:"gadgetUnload",value:function(){this.sendAnalytics("clicked_start_count",this.startClicked)}}]),b}(PearsonGL.Gadget.TileSort),PearsonGL.Gadget.OriginalTileSort=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));if(e.options=$.extend(!0,{feedBackPopUp:!1,randomize:!1,scoreText:"",tilesText:[],tilesImage:[],columnsText:[],columnsImage:[],freeZone:[],draggables:[],droppables:[],textLabels:[],imageLabels:[],labels:[],hideTargetBackground:!1,cloning:!1,tileSortBackground:"",popupcontainment:".main",gadgetName:"OrgTileSort",rotationArrows:!1,feedback:{showGraphicalTreatment:!1},scoreFinalized:!1},e.options||{}),!c)return _possibleConstructorReturn(e);e.jObject=$(a),e.initGadget(e.options.gadgetName);var f=e;e.labelOpts=c.labelOpts,e.isLegacy=!0,void 0==c.feedbackType&&(c.feedbackType="instantFeedback"),c.column&&($.extend(c,c.column[0]),delete c.column,e.isLegacy=!1),$.extend(!0,f.options,c),e.gadgetUniqueId=d,e.jObject.data("gadget_options",e.options),e.jObject.addClass("sorter-identifier"),e.zdex=201,e.reverCheck=!1,e.totalDraggableTile=0,e.clone=[],e.numOfCorrect=0,e.usingKeyboard=!1,e.isInstant="instantFeedback"===e.options.feedbackType,e.submittedTries=0,e.isColumn=!0,e.columnTheme=["th1","th2","th3","th4","th5"],e.scormData&&e.scormData.tilePattern?e.scormData={submittedTries:0,tilePattern:e.scormData.tilePattern,numberOfCorrect:e.numOfCorrect}:e.scormData={submittedTries:0,tilePattern:{},numberOfCorrect:e.numOfCorrect},e.options.submitScoreOnFirstAttempt=e.options.runtimejson.submitScoreOnFirstAttempt,e.options.showCorrectAnswerOnFinalAttempt=e.options.runtimejson.showCorrectAnswerOnFinalAttempt,e.quit=!1,e.isTouchDevice="ontouchstart"in document.documentElement,e.hasBeenInteractedWith=!1;var g=void 0,h=void 0,i=void 0;return""!==e.options.scoreText&&(e.options.feedBackPopUp=!0),e.options.draggables=e.options.draggables.concat(e.options.tilesText,e.options.tilesImage),e.options.droppables=e.options.droppables.concat(e.options.columnsText,e.options.columnsImage),e.options.labels=e.options.labels.concat(e.options.textLabels,e.options.imageLabels),e.options.tilesText.length>0&&e.options.tilesImage.length>0&&(e.options.randomize=!0),e.options.columnsText.length>0&&e.options.columnsImage.length>0&&e.options.droppables.sort(function(){return g=parseFloat(10*Math.random()),h=g%2,i=g>5?1:-1,h*i}),e.options.freeZone.length>e.options.columnsText.length+e.options.columnsImage.length&&(e.isColumn=!1,e.options.droppables=e.options.freeZone,e.jObject.addClass("sorter-freezone")),e.options.numberOfTiles&&(e.options.numberOfTiles=parseInt(PearsonGL.qtiEvaluator.replaceParameters(e.options.numberOfTiles))),e.init(),e}return _inherits(b,a),_createClass(b,[{key:"destroy",value:function(){this.jObject&&(this.jObject.children().remove(),this.jObject.removeClass("sorter-identifier"))}},{key:"init",value:function(){var a=this,b=a.jObject,c=$("<div></div>"),d=$("<div></div>"),e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0;a.startClicked=0,a.dragStatusLive=$('<div aria-live="assertive" class="drag-status-live hidden-label"></div>'),b.append(a.dragStatusLive),setTimeout(function(){$(window).trigger(a.gadgetUniqueId+"stopwatchScoreCheck",a)}),$(window).on(a.gadgetUniqueId+"stopwatchStartPage",function(c,d){a.stopwatch=d,a.stopwatch.options.associatedGadgetId===a.gadgetUniqueId&&(b.prepend('<div class="stopwatch-modal"><div class="stopwatch-message"></div><div class="stopwatch-button"></div></div>'),b.find(".stopwatch-modal").attr("tabindex","0"),b.find(".stopwatch-modal").siblings().css({visibility:"hidden"}),a.stopwatch.options.scorm.hasOwnProperty("suspendData")?a.stopwatch.options.scorm.suspendData.data.startClicked?(b.find(".stopwatch-button").hide(),b.find(".stopwatch-modal").show(),b.find(".stopwatch-message").remove(),b.find(".stopwatch-modal").append('<div class="stopwatch-message"></div>'),a.stopwatch.options.hasOwnProperty("resumeButtonMessageText")&&a.stopwatch.options.resumeButtonMessageText[0].hasOwnProperty("resumeMessageList")?(b.find(".stopwatch-message").append("<p>"+a.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].resumeMessage+"</p>"),a.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.src&&b.find(".stopwatch-message").audioComponent({src:a.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.src,trigger:!0,type:a.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.type},this.gadgetUniqueId)):b.find(".stopwatch-message").append("<p>"+a.stopwatch.labelOpts.pauseMenuText+"</p>"),$(window).trigger(a.gadgetUniqueId+"pauseClock",a.stopwatch.options)):a.stopwatch.options.scorm.suspendData.data.reset?($(window).trigger(a.gadgetUniqueId+"setClock",a.stopwatch.options),b.find(".stopwatch-modal").siblings().css({visibility:"visible"}),b.find(".stopwatch-modal").hide()):(a.stopwatch.options.start?(b.find(".stopwatch-message").append("<p>"+a.stopwatch.options.start[0].startMessage+"</p>"),a.stopwatch.options.start[0].audioComponent.src&&b.find(".stopwatch-message").audioComponent({src:a.stopwatch.options.start[0].audioComponent.src,trigger:!0,type:a.stopwatch.options.start[0].audioComponent.type},this.gadgetUniqueId)):b.find(".stopwatch-message").append("<p>"+a.stopwatch.labelOpts.startMenuText+"</p>"),b.find(".stopwatch-button").sliderbutton({buttonClassName:"stopwatch-button",slider:!0,buttonText:a.stopwatch.labelOpts.startText,clickFunction:function(c){a.startClicked++,b.find(".stopwatch-modal").siblings().css({visibility:"visible"}),setTimeout(function(){b.find(".stopwatch-modal").hide()},200),$(window).trigger(a.gadgetUniqueId+"stopwatchStartClock","startClock")}})):(a.stopwatch.options.start?(b.find(".stopwatch-message").append("<p>"+a.stopwatch.options.start[0].startMessage+"</p>"),a.stopwatch.options.start[0].audioComponent.src&&b.find(".stopwatch-message").audioComponent({src:a.stopwatch.options.start[0].audioComponent.src,trigger:!0,type:a.stopwatch.options.start[0].audioComponent.type},this.gadgetUniqueId)):b.find(".stopwatch-message").append("<p>"+a.stopwatch.labelOpts.startMenuText+"</p>"),b.find(".stopwatch-button").sliderbutton({buttonClassName:"stopwatch-button",slider:!0,buttonText:a.stopwatch.labelOpts.startText,clickFunction:function(c){a.startClicked++,b.find(".stopwatch-modal").siblings().css({visibility:"visible"}),setTimeout(function(){b.find(".stopwatch-modal").hide()},200),$(window).trigger(a.gadgetUniqueId+"stopwatchStartClock","startClock")}})))}),$(window).on(a.gadgetUniqueId+"stopwatchPausePage",function(c,d){a.hasOwnProperty("stopwatch")&&(b.find(".stopwatch-button").hide(),$(window).trigger(a.gadgetUniqueId+"pauseClock","pause"),b.find(".stopwatch-modal").siblings().css({visibility:"hidden"}),b.find(".stopwatch-modal").show(),b.find(".stopwatch-message").remove(),b.find(".stopwatch-modal").append('<div class="stopwatch-message"></div>'),a.stopwatch.options.hasOwnProperty("resumeButtonMessageText")&&a.stopwatch.options.resumeButtonMessageText[0].hasOwnProperty("resumeMessageList")?(b.find(".stopwatch-message").append("<p>"+a.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].resumeMessage+"</p>"),a.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.src&&b.find(".stopwatch-message").audioComponent({src:a.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.src,trigger:!0,type:a.stopwatch.options.resumeButtonMessageText[0].resumeMessageList[0].audioComponent.type},this.gadgetUniqueId)):b.find(".stopwatch-message").append("<p>"+a.stopwatch.labelOpts.pauseMenuText+"</p>"))}),$(window).on(a.gadgetUniqueId+"resumeClock",function(a,c){b.find(".stopwatch-modal").siblings().css({visibility:"visible"}),b.find(".stopwatch-modal").hide()}),$(window).on(a.gadgetUniqueId+"stopwatchResetStart",function(c,d){b.find(".stopwatch-message").remove(),b.find(".stopwatch-button").remove(),b.find(".stopwatch-modal").prepend('<div class="stopwatch-message"></div>'),b.find(".stopwatch-modal").append('<div class="stopwatch-button"></div>'),a.stopwatch.options.start?(b.find(".stopwatch-message").append("<p>"+a.stopwatch.options.start[0].startMessage+"</p>"),a.stopwatch.options.start[0].audioComponent.src&&b.find(".stopwatch-message").audioComponent({src:a.stopwatch.options.start[0].audioComponent.src,trigger:!0,type:a.stopwatch.options.start[0].audioComponent.type},this.gadgetUniqueId)):b.find(".stopwatch-message").append("<p>"+a.stopwatch.labelOpts.startMenuText+"</p>"),b.find(".stopwatch-button").sliderbutton({buttonClassName:"stopwatch-button",slider:!0,buttonText:a.stopwatch.labelOpts.startText,clickFunction:function(c){a.startClicked++,b.find(".stopwatch-modal").siblings().css({visibility:"visible"}),setTimeout(function(){b.find(".stopwatch-modal").hide()},200),$(window).trigger(a.gadgetUniqueId+"stopwatchStartClock","startClock")}}),b.find(".stopwatch-button").show(),b.find(".stopwatch-modal").show()}),$(window).on(a.gadgetUniqueId+"stopwatchSaveData",function(b,c){a.stopwatch=c,a.options.scorm.suspendData&&a.options.scorm.suspendData.data&&(a.options.scorm.suspendData.data.stopwatch=c.options.scorm.suspendData.data)}),b.append('<div class="drag"></div><div class="drop"></div>'),""!==a.options.correctAudio&&(b.append("<div class='dnd-correct-audio' style='display:none'></div>"),b.find(".dnd-correct-audio").audioComponent({src:a.options.correctAudio,trigger:!0,type:"hover"},this.gadgetUniqueId)),""!==a.options.inCorrectAudio&&(b.append("<div class='dnd-in-correct-audio' style='display:none'></div>"),b.find(".dnd-in-correct-audio").audioComponent({src:a.options.inCorrectAudio,trigger:!0,type:"hover"},this.gadgetUniqueId)),void 0!==a.options.tileSortBackground&&a.options.tileSortBackground.length>0&&(image=document.createElement("img"),image.src=a.options.tileSortBackground,$(image).attr("alt",a.options.backgroundTitle?a.options.backgroundTitle:"").addClass("bk-img"),b.append(image),$(image).load(function(){b.css({width:this.width+"px"})}),$(image).Protector(),b.addClass("has-bk"),this.addLongDescription($(image),a.options.longDesc)),a.addDraggables(),a.totalDraggableTile=b.children(".drag").children().size(),a.options.numberOfTiles&&(a.totalDraggableTile=a.options.numberOfTiles),$(a.options.droppables).each(function(c){f=d.clone(),f.attr("id","t"+c).attr("data-dropid",this.dropId).addClass("drop-item"),a.isColumn?(e=$("<div class='drop-container drop-container-"+a.columnTheme[c]+"'></div>"),e.append('<div class="drop-header"></div>'),void 0!==this.dropText&&this.dropText.value.length>0&&(this.dropText.noTabIndex=!0,this.dropText.value=PearsonGL.qtiEvaluator.replaceParameters(this.dropText.value),e.find(".drop-header").append($("<div class='drop-text' aria-hidden='true'></div>").richtextcomponent(this.dropText,!0)),f.append($('<label class="hidden-label"></label>').html(this.dropText.value.replace(/<(?:.|\n)*?>/gm,""))),void 0!==this.dropText.audioComponent&&""!==this.dropText.audioComponent.src&&void 0!==this.dropText.audioComponent.src&&(a.options.runtimejson.gadgetOptions&&a.options.runtimejson.gadgetOptions.TileSort&&a.options.runtimejson.gadgetOptions.TileSort.columnMode&&a.options.runtimejson.gadgetOptions.TileSort.columnMode.resetAudioOnPause&&(this.dropText.audioComponent.resetAudioOnPause=!0),e.find(".gadget-textblock").audioComponent(this.dropText.audioComponent,this.gadgetUniqueId)),e.find(".gadget-textblock").removeAttr("tabindex role")),void 0!==this.dropImage&&""!==this.dropImage.src&&void 0!==this.dropImage.src&&(this.dropImage.protect=!1,this.dropImage.title=PearsonGL.qtiEvaluator.replaceParameters(this.dropImage.title),e.find(".drop-header").append('<table class="image-container"><tr><td class="image-cell" aria-hidden="true"></td></tr></table>'),e.find(".drop-header").find(".image-cell").imagecomponent(this.dropImage),f.append($('<label class="hidden-label"></label>').html(void 0!==this.dropImage.title?this.dropImage.title:"")),void 0!==this.dropImage.audioComponent&&""!==this.dropImage.audioComponent.src&&void 0!==this.dropImage.audioComponent.src&&(a.options.runtimejson.gadgetOptions&&a.options.runtimejson.gadgetOptions.TileSort&&a.options.runtimejson.gadgetOptions.TileSort.columnMode&&a.options.runtimejson.gadgetOptions.TileSort.columnMode.resetAudioOnPause&&(this.dropImage.audioComponent.resetAudioOnPause=!0),e.find(".drop-header").find("span").audioComponent(this.dropImage.audioComponent,this.gadgetUniqueId))),e.append("<div class='drop-button-container'><div class='drop-button' data-icon='drop-button' aria-hidden='false'></div></div>"),e.append("<div style='display:none;' class='correct-mark' data-icon='correct-mark'></div>"),e.append(f),b.find(".drop").append(e),void 0!==this.dropText?b.find(".drop-container").last().addClass("drop-container-text"):b.find(".drop-container").last().addClass("drop-container-image")):(f.append("<div class='drop-bk'><div class='shade'></div></div>"),f.css({left:this.droppableX+"px",top:this.droppableY+"px",width:this.droppableWidth,height:this.droppableHeight}),b.find(".drop").append(f))}),$(a.options.labels).each(function(a){void 0!==this.labelText&&""!==this.labelText.value&&void 0!==this.labelText.value&&(label=$('<div aria-hidden="true" class="labels" id="label'+a+'"></div>'),label.css({left:this.labelX+"px",top:this.labelY+"px"}),this.labelText.noTabIndex=!0,label.richtextcomponent(this.labelText),void 0!==this.labelText.audioComponent&&void 0!==this.labelText.audioComponent.src&&""!==this.labelText.audioComponent.src&&label.find(".gadget-textblock").audioComponent(this.labelText.audioComponent,this.gadgetUniqueId),label.find("*").attr("aria-hidden",!0),label.appendTo(b)),void 0!==this.labelImage&&""!==this.labelImage.src&&void 0!==this.labelImage.src&&(label=$('<div aria-hidden="true" class="labels" id="label'+a+'"></div>'),label.css({left:this.labelX+"px",top:this.labelY+"px"}),this.labelImage.noTabIndex=!0,label.imagecomponent(this.labelImage),void 0!==this.labelImage.audioComponent&&""!==this.labelImage.audioComponent.src&&label.find(".image-class-wrapper").audioComponent(this.labelImage.audioComponent,this.gadgetUniqueId),label.find("*").attr("aria-hidden",!0),label.appendTo(b))}),a.options.hideTargetBackground&&b.find(".drop-item").addClass("no-bk"),$(c,d).remove(),a.isColumn&&(g=parseFloat(b.find(".drop-container").width()),h=parseFloat(b.find(".drop-container").css("margin-right")),i=g*b.find(".drop-container").size()+h*(b.find(".drop-container").size()-1),j=i/2,b.find(".drop").css({width:i+"px",left:"50%",marginLeft:-j+"px"}),b.find(".drop-container").each(function(a){$(this).css("left",g*a+"px")})),a.setupSort();try{global_player.inScreenReaderMode&&a.setScreenReaderMode()}catch(a){}this.isLegacy,a.img_correctIndex=0,a.img_incorrectIndex=0,a.txt_correctIndex=0,a.txt_incorrectIndex=0,a.options.buttons&&a.addButtons(),a.options.rotationArrows&&a.addRotationArrows(),a.isInstant||a.randomizeAnimations(),a.addCorrectDraggables(),this.getLearnerData({type:"matching"}),this.figureOutNumOfTiles(),a.columnTileSortStackTiles()}},{key:"figureOutNumOfTiles",value:function(){var a=this,b=this.jObject;if(a.options.numberOfTiles){if(a.scormData.tilesUsed)for(var c=0;c<a.scormData.tilesUsed.length;c++)b.find(".drag").children('[unique-id="'+a.scormData.tilesUsed[c].id+'"]').remove(),b.find(".drop-item").children('[unique-id="'+a.scormData.tilesUsed[c].id+'"]').remove();else{a.scormData.tilesUsed=[];for(var d=b.find(".drag").children().length-a.options.numberOfTiles,e=0;e<d;e++){var f=$(b.find(".drag").children()[Math.floor(Math.random()*b.find(".drag").children().length)]);a.scormData.tilesUsed.push({id:f.attr("unique-id"),inarray:f.attr("data-inarray")}),b.find(".drop-item").children('[unique-id="'+f.attr("unique-id")+'"]').remove(),f.remove()}}a.progressIndicator(),a.scormData.tryagain||(b.find(".c-checkanswer-button").removeClass("try-again").find(".button-text").html(a.options.buttons.checkAnswerButton),0==b.find(".drag").children().length&&b.find(".c-checkanswer-button").show().sliderbutton("enable"))}}},{key:"columnTileSortStackTiles",value:function(){setTimeout(function(){$(".sorter-identifier").each(function(a,b){b=$(b);var c=0,d=b.find(".drag .drag-item");$(d).each(function(a){$(this).attr("tabindex","0"),$(this).find(".audio-play").attr("tabindex","0"),$(this).find(".audio-pause").attr("tabindex","0")}),d.toArray().reverse().every(function(a){c++;var b=$(a).css("top").split("px").slice(0,1)[0],e=$(a).css("left").split("px").slice(0,1)[0];if(c!==d.length){var f=$(a).prev(".drag-item").css("top").split("px").slice(0,1)[0],g=$(a).prev(".drag-item").css("left").split("px").slice(0,1)[0];f===b&&g===e&&($(a).attr("tabindex","-1"),$(a).find(".audio-play").attr("tabindex","-1"),$(a).find(".audio-pause").attr("tabindex","-1"))}return c<d.length})})})}},{key:"removeDialogs",value:function(){this.jObject.find(".result-pop-up, .modal-dialog-window, .dialog-box-window").remove()}},{key:"doReset",value:function(a){var b=this,c=this.jObject;this.quit=!1,this.numOfCorrect=0,this.scormData.numberOfCorrect=0,this.resetTiles(a),c.find(".result-pop-up,.modal-dialog-window,.dialog-box-window").fadeOut(function(){$(this).remove()}),b.options.rotationArrows&&b.jObject.find(".drag").children().length>1&&(b.jObject.find(".prev-button").sliderbutton("enable"),b.jObject.find(".next-button").sliderbutton("enable"))}},{key:"resetTiles",value:function(a){var b=this,c=this.jObject,d=!1;c.find(".c-checkanswer-button").removeClass("try-again").find(".button-text").html(b.options.buttons.checkAnswerButton),b.setDragStatusLive(b.options.buttons.checkAnswerButton+"button"),c.find(".c-checkanswer-button").show().sliderbutton("disable"),c.find(".c-answer-button").hide(),c.find(".c-myanswer-button").hide(),b.setShowAnswerButtonStates("disable"),c.find(".drag-item").show(),c.find(".correct-tile").hide(),c.find(".drop-item").css("height",""),c.find(".drop-item").each(function(a){$(this).find(".drag-item:not(.correct-tile)").each(function(a){d=!0;var e=$(this),f=e.offset().top-c.find(".drag").first().offset().top,g=e.offset().left-c.find(".drag").first().offset().left;b.isTryAgainClick?e.hasClass("ignore-incorrect")&&(e.css({position:"absolute",width:"",height:"",left:g,top:f}),c.find(".drag").first().append(e),e.animate({top:e.attr("data-top"),left:e.attr("data-left")},"swing",function(){$(this).css({position:"absolute",width:"",height:"",left:"",top:""})})):(e.css({position:"absolute",width:"",height:"",left:g,top:f}),c.find(".drag").first().append(e),e.animate({top:e.attr("data-top"),left:e.attr("data-left")},"swing",function(){$(this).css({position:"absolute",width:"",height:"",left:"",top:""})}))})}),b.resizeColumn(c.find(".drop-item").find(".drag-item:not(.correct-tile)")),d?c.delay(600).queue(function(c){b.reset_draggables(a),c()}):b.reset_draggables(a),b.scormData.tilePattern={},delete b.scormData.checkedAnswer}},{key:"reset_draggables",value:function(a){var b=this,c=this.jObject;c.find(".drag").children().remove(),b.addDraggables(),b.dragSetup(),b.progressIndicator(),b.figureOutNumOfTiles(),b.columnTileSortStackTiles(),"key"===a&&c.find(".drag").children(":first-child").focus()}},{key:"completeActivity",value:function(){this.quit||(this.quit=!0,this.submittedTries=this.options.numberOfTries,this.jObject.find(".drag").find(".drag-item").remove(),this.checkAnswer(),this.showCorrectShowMyAns(!0))}},{key:"checkAnswer",value:function(){var a=this,b=this.jObject,c=!0;if(a.submittedTries++,a.numOfCorrect=0,b.find(".drop-item").each(function(b){var d=$(this);d.find(".drag-item:not(.correct-tile)").each(function(b){var e=$(this);e.attr("data-dragid")===d.attr("data-dropid")?(e.addClass("ignore-correct"),a.numOfCorrect++,a.options.feedback.showGraphicalTreatment||e.addClass("drag-item-correct")):(c=!1,e.addClass("ignore-incorrect"),a.options.feedback.showGraphicalTreatment||e.addClass("drag-item-incorrect")),e.draggable("disable"),e.on("dragstart",function(a){a.preventDefault()})})}),a.scormData.numberOfCorrect=a.numOfCorrect,a.scormData.allCorrect=c,a.scormData.submittedTries=a.submittedTries,a.scormData.checkedAnswer=!0,c&&(b.find(".c-checkanswer-button").removeClass("try-again").find(".button-text").html(a.options.buttons.checkAnswerButton),b.find(".c-checkanswer-button").show().sliderbutton("disable"),b.find(".c-checkanswer-button").find(".button-text").attr("aria-disabled",!1),b.find(".c-answer-button").hide(),b.find(".c-myanswer-button").hide(),$(window).trigger(a.gadgetUniqueId+"stopClock","stopClock"),a.setDragStatusLive("you have got"+a.numOfCorrect+"of"+a.numOfCorrect+"correct. All the tiles show correct feedback"),1==a.submittedTries?a.sendAnalytics("correct_first_attempt"):a.sendAnalytics("correct_after_first_attempt")),a.submittedTries>=a.options.numberOfTries){$(window).trigger(this.gadgetUniqueId+"stopClock","stopClock"),b.find(".c-checkanswer-button").removeClass("try-again").find(".button-text").html(a.options.buttons.checkAnswerButton),b.find(".c-checkanswer-button").show().sliderbutton("disable"),b.find(".c-checkanswer-button").find(".button-text").attr("aria-disabled",!1),b.find(".c-myanswer-button").children().length>0&&(b.find(".c-answer-button").show(),a.setShowAnswerButtonStates("enable")),c&&(b.find(".c-answer-button").hide(),b.find(".c-myanswer-button").hide(),a.setShowAnswerButtonStates("disable")),a.options.showCorrectAnswerOnFinalAttempt&&a.showCorrectShowMyAns(!0);var d="placed_XXofYY";d=d.replace(/\XX/g,a.numOfCorrect),d=d.replace(/\YY/g,a.totalDraggableTile),a.sendAnalytics(d),c||a.setDragStatusLive("you have got"+a.numOfCorrect+"of"+b.find(".drag-item:not(.correct-tile)").length+"correct. Tiles show correct and incorrect feedback.")}else c||a.setDragStatusLive("you have got"+a.numOfCorrect+"of"+b.find(".drag-item:not(.correct-tile)").length+"correct. Tiles show correct and incorrect feedback. Use try again button to sort the incorrect tiles");a.showFeedBack(c),a.saveSubmittedMode(),a.saveLearnerData(!1)}},{key:"showFeedBack",value:function(a){var b=this,c=this.jObject,d=void 0;d=this.options,d.imageComponent=this.pickrandomAnimation(a),d.textMessage=this.pickRandomTextMessage(a),void 0!==d.textMessage&&(d.dialogLayout=d.textMessage.dialogLayout,d.dialogWidth=d.textMessage.dialogWidth,d.dialogHeight=d.textMessage.dialogHeight,d.dialogUnits="pixels",void 0===d.dialogLayout&&void 0!==d.feedback.imageAnimation_feedback&&d.feedback.messages_feedback.correct[0].value===d.textMessage.value&&(d.dialogLayout=d.feedback.imageAnimation_feedback.correct[0].dialogLayout,d.dialogWidth=d.feedback.imageAnimation_feedback.correct[0].dialogWidth,d.dialogHeight=d.feedback.imageAnimation_feedback.correct[0].dialogHeight,d.dialogUnits="pixels"),void 0===d.dialogLayout&&void 0!==d.feedback.imageAnimation_feedback&&d.feedback.messages_feedback.incorrect[0].value===d.textMessage.value&&(d.dialogLayout=d.feedback.imageAnimation_feedback.incorrect[0].dialogLayout,d.dialogWidth=d.feedback.imageAnimation_feedback.incorrect[0].dialogWidth,d.dialogHeight=d.feedback.imageAnimation_feedback.incorrect[0].dialogHeight,d.dialogUnits="pixels")),d.isModal=!0,(d.imageComponent||d.textMessage&&d.textMessage.value&&d.textMessage.value.length>0)&&(this.removeDialogs(),this.options.dialogType=d.imageComponent?"animated":"feedback",d.doAnimate=!(!this.options.imageComponent||!this.options.imageComponent.fps),d.resultsText=d.textMessage?d.textMessage.value:"",d.audioComponent=d.textMessage&&d.textMessage.audioComponent?d.textMessage.audioComponent:null,d.dialogIsCorrect=a,c.dialogcomponent(d),c.find(".result-pop-up").fadeIn(),b.usingKeyboard&&c.find(".result-pop-up").focus()),this.isInstant&&(b.submittedTries=0)}},{key:"pickRandomTextMessage",value:function(a){var b=$.extend(!0,{},this.options.feedback),c=b.messages_feedback,d=void 0,e=void 0,f=void 0,g=this.submittedTries,h=!1,i=g>=this.options.numberOfTries;if(c&&(e=c.correct?c.correct:[],f=c.incorrect?c.incorrect:[],a?(d=e[this.txt_correctIndex],this.txt_correctIndex>=e.length-1?this.txt_correctIndex=0:this.txt_correctIndex++):(d=f[this.txt_incorrectIndex],this.txt_incorrectIndex>=f.length-1?this.txt_incorrectIndex=0:this.txt_incorrectIndex++)),!this.isInstant&&b.attempts_response_text&&b.attempts_response_text.value&&(h=!0),!h&&a&&1===g&&b.first_correct_text.value)d=b.first_correct_text,void 0==b.first_correct_text.value&&(d.value="");else if(h||a||!i||!b.final_incorrect_text.value){if(h&&(i||a)){var j=this.jObject.find(".ignore-correct").length,k=this.totalDraggableTile,l=b.attempts_response_text.value;l=l?l.replace(/\XX/g,j):"",l=l?l.replace(/\YY/g,k):"",b.attempts_response_text.value=l,d=b.attempts_response_text}}else d=b.final_incorrect_text,void 0==b.final_incorrect_text.value&&(d.value="");return d}},{key:"pickrandomAnimation",value:function(a){var b=void 0,c=this.options.feedback,d=c.imageAnimation_feedback,e=void 0,f=void 0,g=!1,h=this.submittedTries,i=h>=this.options.numberOfTries;return d&&(e=d.correct,f=d.incorrect,e&&a&&e[this.img_correctIndex]?(b=e[this.img_correctIndex].imageComponent,this.img_correctIndex>=e.length-1?this.img_correctIndex=0:this.img_correctIndex++):f&&!a&&f[this.img_incorrectIndex]&&(b=f[this.img_incorrectIndex].imageComponent,this.img_incorrectIndex>=f.length-1?this.img_incorrectIndex=0:this.img_incorrectIndex++)),!this.isInstant&&c.attempts_response_text&&c.attempts_response_text.value&&(g=!0),!g&&a&&1===h&&c.first_correct_text&&c.first_correct_text.imageComponent&&c.first_correct_text.imageComponent.src?b=c.first_correct_text.imageComponent:!g&&!a&&i&&c.final_incorrect_text&&c.final_incorrect_text.imageComponent&&c.final_incorrect_text.imageComponent.src?b=c.final_incorrect_text.imageComponent:g&&(i||a)&&(b=""),b&&(b.loops=1),b}},{key:"randomizeAnimations",value:function(){if(this.options.feedback.imageAnimation_feedback){var a=this.options.feedback.imageAnimation_feedback,b=a.correct,c=a.incorrect;b&&PearsonGL.utils.shuffleArray(b),c&&PearsonGL.utils.shuffleArray(c)}}},{key:"addRotationArrows",value:function(){var a=this,b=this.jObject;b.find(".drag").before('<div class="prev-button rotation-arrows" data-icon="ic-arrow-left" alt="'+a.labelOpts.previousButton+'" title="'+a.labelOpts.previousButton+'"></div>'),b.find(".drag").after('<div class="next-button rotation-arrows" data-icon="ic-arrow-right" alt="'+a.labelOpts.nextButton+'" title="'+a.labelOpts.nextButton+'"></div>');var c=200;b.find(".prev-button").sliderbutton({buttonClassName:"prev-button",slider:!1,clickFunction:function(d){b.find(".drag").first().children().length>1&&(b.find(".drag").first().prepend($(b.find(".drag").first().children()[b.find(".drag").first().children().length-1])),c=200,b.find(".drag").first().children().each(function(){c--,$(this).css("z-index",c)}),a.columnTileSortStackTiles())}}),b.find(".next-button").sliderbutton({buttonClassName:"next-button",slider:!1,clickFunction:function(d){b.find(".drag").first().children().length>1&&(b.find(".drag").first().append($(b.find(".drag").first().children()[0])),c=200,b.find(".drag").first().children().each(function(){c--,$(this).css("z-index",c)}),a.columnTileSortStackTiles())}})}},{key:"addButtons",value:function(){var a=this,b=this.options.buttons,c=this.jObject;c.append("<div class='c-button-group'><div class='c-button-wrapper c-checkanswer-button'></div><div class='c-button-wrapper c-reset-button'></div><div class='c-button-wrapper c-answer-button'></div><div class='c-button-wrapper c-myanswer-button'></div></div>"),a.isInstant?c.find(".c-checkanswer-button, .c-answer-button, .c-myanswer-button").remove():(c.find(".c-checkanswer-button").sliderbutton({buttonClassName:"c-button",slider:!0,buttonText:b.checkAnswerButton,clickFunction:function(d,e){a.sendAnalytics("clicked_check_answer_button"),a.usingKeyboard="key"==e,c.find(".result-pop-up,.modal-dialog-window").fadeOut(function(){$(this).remove()});var f=d.jObject;f.find(".button-text").html(b.checkAnswerButton),f.hasClass("base-button-disable")||(f.hasClass("try-again")?(a.sendAnalytics("clicked_try_again_button"),f.removeClass("try-again"),c.find(".incorrect_icon").parent().draggable("enable"),a.isTryAgainClick=!0,a.doReset()):(f.find(".button-text").html(b.tryAgainButton),f.addClass("try-again"),a.checkAnswer(),a.options.submitScoreOnFirstAttempt&&!a.options.scoreFinalized&&(a.options.scoreFinalized=!0,a.scormData.scoreFinalized=!0),c.find(".dropped-item").draggable("disable")))}}),c.find(".c-checkanswer-button").sliderbutton("disable")),b.resetButtonGroup?c.find(".c-reset-button").sliderbutton({buttonClassName:"c-button",slider:!0,buttonText:b.resetButtonGroup[0].resetButtonText||"Start Over",clickFunction:function(d,e){if(!d.jObject.hasClass("base-button-disable")){if(a.isTryAgainClick=!1,b.resetButtonGroup[0].resetConfirmText=b.resetButtonGroup[0].resetConfirmText||"Are you sure you want to start over?",b.resetButtonGroup[0].resetConfirmText){a.removeDialogs();var f=a.options;f.keyPressEventHandler=function(){a.submittedTries=0,a.sendAnalytics("clicked_start_over_button"),a.doReset(e),$(window).trigger(a.gadgetUniqueId+"calculateBestTime","calculateBestTime"),setTimeout(function(){c.find(".stopwatch-modal").siblings().css({visibility:"hidden"}),c.find(".stopwatch-modal").focus()},100),a.setDragStatusLive("start over button clicked all the tiles move back to the starting position")},f.isModal=!0,f.resultsText=b.resetButtonGroup[0].resetConfirmText,f.audioComponent=b.resetButtonGroup[0].audioComponent,a.options.dialogType="confirm",c.dialogcomponent(f),c.find(".checker-pop-up").fadeIn().focus()}else $(window).trigger(a.gadgetUniqueId+"calculateBestTime","calculateBestTime"),a.submittedTries=0,a.doReset(e),setTimeout(function(){c.find(".stopwatch-modal").siblings().css({visibility:"hidden"}),c.find(".stopwatch-modal").focus()},100),a.setDragStatusLive("start over button clicked all the tiles move back to the starting position");a.stopAudio()}}}):c.find(".c-reset-button").hide(),!this.isInstant&&b.showAnswerButtonGroup&&(c.find(".c-answer-button").sliderbutton({buttonClassName:"c-button",slider:!0,buttonText:b.showAnswerButtonGroup[0].showAnswerButton,clickFunction:function(b){b.jObject.hasClass("base-button-disable")||(c.find(".c-answer-button").hide(),c.find(".c-myanswer-button").show(),a.showCorrectShowMyAns(!0),a.setDragStatusLive("show answer button clicked, dropzones have correct tiles"),c.find(".result-pop-up,.modal-dialog-window").fadeOut(function(){$(this).remove()}))}}),c.find(".c-myanswer-button").sliderbutton({buttonClassName:"c-button",slider:!0,buttonText:b.showAnswerButtonGroup[0].showMyAnswersButton,clickFunction:function(b){b.jObject.hasClass("base-button-disable")||(c.find(".c-answer-button").show(),c.find(".c-myanswer-button").hide(),a.showCorrectShowMyAns(!1),a.setDragStatusLive("show my answer button clicked, dropzones have your tiles"))}}),a.options.showCorrectAnswerOnFinalAttempt&&(c.find(".c-answer-button").remove(),c.find(".c-myanswer-button").remove()),c.find(".c-answer-button").sliderbutton("disable")),c.find(".c-answer-button").hide(),c.find(".c-myanswer-button").hide()}},{key:"stopAudio",value:function(){this.jObject.find(".audioToggleIdentifier").each(function(){$(this).audioComponent("pause")})}},{key:"showCorrectShowMyAns",value:function(a){var b=this,c=this.jObject;a?(c.find(".ignore-incorrect").hide(),c.find(".correct-tile").show(),c.find(".correct-tile").each(function(a){$(this).on("dragstart",function(a){a.preventDefault()})}),c.find(".drop-item").each(function(){var a=$(this);a.find(".ignore-correct").each(function(){a.find(".correct-tile[unique-id='"+$(this).attr("unique-id")+"']").hide()})}),b.resizeColumnAnswerButton()):(c.find(".ignore-incorrect").show(),c.find(".correct-tile").hide(),b.resizeColumnAnswerButton())}},{key:"setShowAnswerButtonStates",value:function(a){var b=this.jObject;"enable"===a&&b.find(".c-myanswer-button").children().length>0?(window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){b.find(".c-myanswer-button").sliderbutton(a),b.find(".c-answer-button").sliderbutton(a)},500)):b.find(".c-myanswer-button").children().length>0&&(b.find(".c-myanswer-button").sliderbutton(a),b.find(".c-answer-button").sliderbutton(a))}},{key:"addCorrectDraggables",value:function(){var a=this,b=a.jObject,c=$("<div></div>"),d=void 0,e=void 0,f=void 0,g=void 0,h=void 0;a.options.hasOwnProperty("tilesTextImage")&&(a.options.draggables=a.options.tilesTextImage),$(a.options.draggables).each(function(i){d=c.clone(),d.attr({id:"d"+i,"unique-id":"d"+i,"data-dragid":this.dragId,"aria-hidden":!0,"data-numOfTries":a.options.numberOfTries,"data-inArray":i}).addClass("drag-item correct-tile"),d.append('<div class="drag-bk"><div class="shade"></div></div><div class="marker" data-icon="marker"></div>'),a.options.hasOwnProperty("tilesTextImage")?"textTop"===a.options.draggables[i].textImage?(d.addClass("text-drag"),d.append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),d.find(".drag-text-cell").richtextcomponent(this.dragText),d.attr({"data-default-title":this.dragText.value.replace(/<(?:.|\n)*?>/gm,"")}),d.find(".text-audio-component").append('<label class="drag-state hidden-label"></label>'),d.addClass("image-drag"),d.addClass("image-tile"),d.append($('<label class="hidden-label"></label>').html(this.dragImage.title?this.dragImage.title:"")),this.dragImage.protect=!1,d.append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),d.find(".image-cell").imagecomponent(this.dragImage),d.attr({"data-default-title":this.dragImage.title?this.dragImage.title:""})):(d.addClass("image-drag"),d.addClass("image-tile"),d.append($('<label class="hidden-label"></label>').html(this.dragImage.title?this.dragImage.title:"")),this.dragImage.protect=!1,d.append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),d.find(".image-cell").imagecomponent(this.dragImage),d.attr({"data-default-title":this.dragImage.title?this.dragImage.title:""}),d.addClass("text-drag"),d.append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),d.find(".drag-text-cell").richtextcomponent(this.dragText),d.attr({"data-default-title":this.dragText.value.replace(/<(?:.|\n)*?>/gm,"")}),d.find(".text-audio-component").append('<label class="drag-state hidden-label"></label>')):(void 0!==this.dragText&&""!==this.dragText.value&&void 0!==this.dragText.value&&(d.addClass("text-drag"),d.append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),d.find(".drag-text-cell").richtextcomponent(this.dragText),d.attr({"data-default-title":this.dragText.value.replace(/<(?:.|\n)*?>/gm,"")}),d.find(".text-audio-component").append('<label class="drag-state hidden-label"></label>')),void 0!==this.dragImage&&""!==this.dragImage.src&&void 0!==this.dragImage.src&&(d.addClass("image-drag"),d.addClass("image-tile"),d.append($('<label class="hidden-label"></label>').html(this.dragImage.title?this.dragImage.title:"")),this.dragImage.protect=!1,d.append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),d.find(".image-cell").imagecomponent(this.dragImage),d.attr({"data-default-title":this.dragImage.title?this.dragImage.title:""}))),b.find(".drop-item").each(function(a){var b=$(this);b.attr("data-dropid")===d.attr("data-dragid")&&(b.append(d),f=2*parseFloat(d.find(".drag-text").css("left")),e=2*parseFloat(d.find(".drag-text").css("top")),g=parseFloat(d.width())-f,h=parseFloat(d.height())-e)})}),b.find(".correct-tile").hide()}},{key:"addDraggables",value:function(){var a=this,b=a.jObject,c=$("<div></div>"),d=[],e=void 0,f=void 0;a.options.hasOwnProperty("tilesTextImage")&&(a.options.draggables=a.options.tilesTextImage,b.addClass("text-image-drag")),$(a.options.draggables).each(function(b){f=c.clone(),f.attr({id:"d"+b,"unique-id":"d"+b,"data-dragid":this.dragId,"aria-hidden":!0,"data-numOfTries":a.options.numberOfTries,"data-inArray":b}).addClass("drag-item hide-tile"),f.append('<div class="drag-bk"><div class="shade"></div></div><div class="marker" data-icon="marker"></div>'),d.push(f)}).each(function(c){!0===a.options.randomize?(f=d[c=Math.floor(Math.random()*d.length)],d[c],d.splice(c,1)):(d[c],f=d[c]);var e=!0;b.find(".drop-item").each(function(a){$(this).find(".drag-item:not(.correct-tile)").each(function(a){$(this).attr("unique-id")===f.attr("unique-id")&&(e=!1)})}),e&&b.children(".drag").append(f)}),b.find(".drag").children(":first-child").attr("aria-hidden",!1),a.isColumn&&(clearInterval(e),a.failSafeCounter=0,e=setInterval(function(){b.find(".drag").children().offset()&&!1===isNaN(parseFloat(b.find(".drag").children().offset().top))&&!1===isNaN(parseFloat(b.find(".drag").children().offset().left))?(b.find(".drag").children().each(function(){$(this).attr({"data-top":parseFloat($(this).offset().top-b.offset().top),"data-left":parseFloat($(this).offset().left-b.offset().left)})}),clearInterval(e)):100==++a.failSafeCounter&&clearInterval(e)},100)),$(window).resize(function(){b.find(".drag").children().each(function(){$(this).attr({"data-top":parseFloat($(this).offset().top-b.offset().top),"data-left":b.find(".drag").width()/2-b.find(".drag").children().first().width()/2})})})}},{key:"setScreenReaderMode",value:function(){this.jObject.find(".gadget-textblock").removeClass("audioCursor").attr({audio:"","data-audio-type":""}),this.jObject.find(".image-cell").find(".image-class-wrapper").removeClass("audioCursor").attr({audio:"","data-audio-type":""})}},{key:"focusOnSelf",value:function(a){}},{key:"setupSort",value:function(){var a=this,b=a.jObject,c=void 0,d=void 0,e=void 0,f=void 0,g=!1,h=void 0,i=void 0,j=void 0,k=void 0;!0===a.options.feedBackPopUp&&(b.dialogcomponent(this.options),a.options.popupAudio.runtimejson=a.options.runtimejson,$(a.options.popupAudio.audioClass).audioComponent(a.options.popupAudio,this.gadgetUniqueId),b.find(".result-pop-up").children(".result-close").focus(function(){window.scroll(0,$(this).offset().top-60)})),b.find(".drop-button").each(function(){$(this).sliderbutton({buttonClassName:"drop-button",slider:!1,clickFunction:function(l){a.isInstant?!1===g&&0!==b.find(".drag").children().size()&&(g=!0,e=l.jObject.parent().parent().find(".drop-item"),f=b.find(".drag").children().first(),c=e.offset().top-f.offset().top,c=c+f.offset().top-b.offset().top,d=e.offset().left-f.offset().left,d=d+f.offset().left-b.offset().left,f.draggable("disable"),b.find(".drag").children().first().animate({top:c,left:d},600,function(){$(this).attr("data-numOfTries",parseFloat($(this).attr("data-numOfTries"))-1),a.submittedTries=a.options.numberOfTries-parseFloat($(this).attr("data-numOfTries")),a.scormData.tilePattern["'"+$(this).attr("id")+"'"]={},a.scormData.tilePattern["'"+$(this).attr("id")+"'"].numberOfTries=$(this).attr("data-numOfTries"),a.scormData.tilePattern["'"+$(this).attr("id")+"'"].dropped=!1,a.scormData.tilePattern["'"+$(this).attr("id")+"'"].correct=!1,$(this).attr("data-dragid")===e.attr("data-dropid")?(a.scormData.tilePattern["'"+$(this).attr("id")+"'"].dropped=!0,a.scormData.tilePattern["'"+$(this).attr("id")+"'"].correct=!0,a.onCorrect(),a.numOfCorrect++,a.scormData.numberOfCorrect=a.numOfCorrect,PearsonGL.utils.focusItemOff(f.find(".drag-text")),PearsonGL.utils.focusItemOff(f.find(".image-container")),f.draggable("disable"),f.on("dragstart",function(a){a.preventDefault()}),f.hide("fade",{},20,function(){$(this).css({position:"relative",width:"",height:"",left:"",top:""}),$(this).find(".image-container").css({width:"",height:""}),e.append($(this)),i=2*parseFloat($(this).find(".drag-text").css("left")),h=2*parseFloat($(this).find(".drag-text").css("top")),j=parseFloat($(this).width())-i,k=parseFloat($(this).height())-h,a.options.feedback.showGraphicalTreatment||$(this).addClass("drag-item-correct"),a.stateChecker(),$(this).unbind("mouseenter mouseleave"),$(this).stop().fadeIn(10,function(){a.progressIndicator(),a.saveLearnerData(!1),a.hasBeenInteractedWith=!0,e.parent().find(".correct-mark").fadeOut(500,function(){g=!1})}),a.columnTileSortStackTiles(),a.resizeColumn(f),$(this).removeClass("hide-tile").addClass("show-tile")}),setTimeout(function(){a.showFeedBack(!0)},400)):parseFloat($(this).attr("data-numOfTries"))<=0?(a.scormData.tilePattern["'"+$(this).attr("id")+"'"].dropped=!0,a.onIncorrect(),PearsonGL.utils.focusItemOff(f.find(".drag-text")),PearsonGL.utils.focusItemOff(f.find(".image-container")),f.unbind("mouseenter mouseleave"),f.draggable("disable"),f.on("dragstart",function(a){a.preventDefault()}),a.options.feedback.showGraphicalTreatment||f.addClass("drag-item-incorrect"),f.delay(100).queue(function(c){b.find('[data-dropid="'+$(this).attr("data-dragid")+'"]').append($(this)),$(this).css({position:"relative",width:"",height:"",left:"",top:""}),$(this).find(".image-container").css({width:"",height:""}),i=2*parseFloat($(this).find(".drag-text").css("left")),h=2*parseFloat($(this).find(".drag-text").css("top")),j=parseFloat($(this).width())-i,k=parseFloat($(this).height())-h,b.find(".drag-item-incorrect").removeClass("drag-item-incorrect").addClass("correct-drag"),a.stateChecker(),$(this).fadeIn(10,function(){a.progressIndicator(),a.saveLearnerData(!1),a.hasBeenInteractedWith=!0,g=!1}),a.columnTileSortStackTiles(),a.resizeColumn(f),c(),$(this).removeClass("hide-tile").addClass("show-tile")}),setTimeout(function(){a.showFeedBack(!1)},800)):(a.onIncorrect(),f.unbind("mouseenter mouseleave"),a.options.feedback.showGraphicalTreatment||f.addClass("drag-item-incorrect"),a.showFeedBack(!1),f.delay(20).queue(function(a){$(this).animate({top:$(this).attr("data-top")+"px",left:$(this).attr("data-left")+"px"},600,function(){$(this).delay(10).removeClass("drag-item-incorrect"),g=!1,$(this).hover(function(){$(this).addClass("drag-item-over")},function(){$(this).removeClass("drag-item-over")})}),a()}),b.find(".drag-item:not(.correct-tile, .show-tile)").slice(1).css({left:$(this).attr("data-left")+"px"}),f.draggable("enable"))})):!1===g&&b.find(".drag").children().size()>0&&(g=!0,e=l.jObject.parent().parent().find(".drop-item"),f=b.find(".drag").children().first(),c=e.offset().top-f.offset().top,c=c+f.offset().top-b.offset().top,d=e.offset().left-f.offset().left,d=d+f.offset().left-b.offset().left,b.find(".drag").children().first().css({top:b.find(".drag").children().first().attr("data-top")+"px",left:b.find(".drag").children().first().attr("data-left")+"px"}),b.find(".drag").children().first().animate({top:c,left:d},600,function(){PearsonGL.utils.focusItemOff(f.find(".drag-text")),PearsonGL.utils.focusItemOff(f.find(".image-container")),f.hide("fade",{},20,function(){$(this).css({position:"relative",width:"",height:"",left:"",top:""}),$(this).find(".image-container").css({width:"",height:""}),e.append($(this)),i=2*parseFloat($(this).find(".drag-text").css("left")),h=2*parseFloat($(this).find(".drag-text").css("top")),j=parseFloat($(this).width())-i,k=parseFloat($(this).height())-h,$(this).stop().fadeIn(10,function(){a.saveSubmittedMode(),a.progressIndicator(),a.hasBeenInteractedWith=!0,g=!1,0===b.find(".drag").children().size()&&b.find(".c-checkanswer-button").sliderbutton("enable")}),a.columnTileSortStackTiles(),a.resizeColumn(f)})}))}})}),b.find(".drop-header").hover(function(){$(this).addClass("drop-header-over")},function(){$(this).removeClass("drop-header-over")}),a.lastSelected=null,a.stateChecker(),!0===this.options.progressBar&&(b.append("<div class='progress-indicator' aria-label='progress bar'><div class='progress'></div><div class='progress-bar'></div></div>"),b.find(".progress-bar").slider({range:"min",min:0,max:100,disabled:!0,create:function(a,b){$(this).children(".ui-slider-handle").removeAttr("href"),$(this).children(".ui-slider-handle").hide()},change:function(c,d){d.value>0&&d.value<100?$(this).find(".ui-slider-handle").show():d.value>=100&&$(this).find(".ui-slider-handle").hide(),a.setDragStatusLive("progress"+b.find(".progress").html())}}),b.find(".progress-bar").unbind("click mousedown"),b.find(".ui-slider-handle").removeAttr("tabindex")),a.dragSetup(),a.progressIndicator(),a.dropSetup(),b.find(".drop-button").removeAttr("tabindex"),a.addAccessibility(b)}},{key:"dragSetup",value:function(){var a=this,b=0;a.jObject.children(".drag").children().each(function(c){$(this).attr("data-clone",b),$(this).css("z-index",199-b),"shake"==a.options.tileEffects?$(this).addClass("ps-shake"):"glow"==a.options.tileEffects&&$(this).addClass("ps-glow"),a.makeDrag($(this),c),b++})}},{key:"makeDrag",value:function(a,b){var c=this,d=c.jObject,e=void 0,f=void 0,g=void 0,h=null,i=$("<div class='drag temp-div'></div>");$(a).hasClass("drag-item")&&(c.clone[parseFloat(a.attr("data-clone"))]=a.clone(),c.clone[parseFloat(a.attr("data-clone"))].removeClass("ps-shake ps-glow")),$(a).mouseToTouch(),$(a).hover(function(){$(this).addClass("drag-item-over")},function(){$(this).removeClass("drag-item-over")}),c.options.hasOwnProperty("tilesTextImage")?(c.options.draggables=c.options.tilesTextImage,"textTop"===c.options.draggables[b].textImage?($(a).addClass("text-drag"),$(a).append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),$(a).find(".drag-text-cell").richtextcomponent(c.options.draggables[$(a).attr("data-inArray")].dragText),void 0!==c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent&&void 0!==c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.src&&""!==c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.src&&(c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.stopDefault=!1,c.options.runtimejson.gadgetOptions&&c.options.runtimejson.gadgetOptions.TileSort&&c.options.runtimejson.gadgetOptions.TileSort.columnMode&&c.options.runtimejson.gadgetOptions.TileSort.columnMode.resetAudioOnPause&&(c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.resetAudioOnPause=!0),$(a).find(".gadget-textblock").audioComponent(c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent,this.gadgetUniqueId),"button"===c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.type&&$(a).find(".gadget-textblock").removeAttr("tabindex")),$(a).attr({"data-default-title":PearsonGL.qtiEvaluator.replaceParameters(c.options.draggables[$(a).attr("data-inArray")].dragText.value).replace(/<(?:.|\n)*?>/gm,"")}),$(a).find(".text-audio-component").append('<label class="drag-state hidden-label"></label>'),$(a).addClass("image-drag"),$(a).addClass("image-tile"),$("body").hasClass("safari")&&$(a).append($('<label class="hidden-label"></label>').html(c.options.draggables[$(a).attr("data-inArray")].dragImage.title?PearsonGL.qtiEvaluator.replaceParameters(c.options.draggables[$(a).attr("data-inArray")].dragImage.title):"")),c.options.draggables[$(a).attr("data-inArray")].dragImage.protect=!1,$(a).append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),c.options.draggables[$(a).attr("data-inArray")].dragImage.noTabIndex=!0,$(a).find(".image-cell").imagecomponent(c.options.draggables[$(a).attr("data-inArray")].dragImage),void 0!==c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent&&""!==c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent.src&&(c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent.stopDefault=!1,c.options.runtimejson.gadgetOptions&&c.options.runtimejson.gadgetOptions.TileSort&&c.options.runtimejson.gadgetOptions.TileSort.columnMode&&c.options.runtimejson.gadgetOptions.TileSort.columnMode.resetAudioOnPause&&(c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent.resetAudioOnPause=!0),$(a).find(".image-class-wrapper").audioComponent(c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent,this.gadgetUniqueId)),$(a).attr({"data-default-title":c.options.draggables[$(a).attr("data-inArray")].dragImage.title?PearsonGL.qtiEvaluator.replaceParameters(c.options.draggables[$(a).attr("data-inArray")].dragImage.title):""})):($(a).addClass("image-drag"),$(a).addClass("image-tile"),$("body").hasClass("safari")&&$(a).append($('<label class="hidden-label"></label>').html(c.options.draggables[$(a).attr("data-inArray")].dragImage.title?PearsonGL.qtiEvaluator.replaceParameters(c.options.draggables[$(a).attr("data-inArray")].dragImage.title):"")),c.options.draggables[$(a).attr("data-inArray")].dragImage.protect=!1,$(a).append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),c.options.draggables[$(a).attr("data-inArray")].dragImage.noTabIndex=!0,$(a).find(".image-cell").imagecomponent(c.options.draggables[$(a).attr("data-inArray")].dragImage),void 0!==c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent&&""!==c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent.src&&(c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent.stopDefault=!1,c.options.runtimejson.gadgetOptions&&c.options.runtimejson.gadgetOptions.TileSort&&c.options.runtimejson.gadgetOptions.TileSort.columnMode&&c.options.runtimejson.gadgetOptions.TileSort.columnMode.resetAudioOnPause&&(c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent.resetAudioOnPause=!0),$(a).find(".image-class-wrapper").audioComponent(c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent,this.gadgetUniqueId)),$(a).attr({"data-default-title":c.options.draggables[$(a).attr("data-inArray")].dragImage.title?PearsonGL.qtiEvaluator.replaceParameters(c.options.draggables[$(a).attr("data-inArray")].dragImage.title):""}),$(a).addClass("text-drag"),$(a).append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),$(a).find(".drag-text-cell").richtextcomponent(c.options.draggables[$(a).attr("data-inArray")].dragText),void 0!==c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent&&void 0!==c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.src&&""!==c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.src&&(c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.stopDefault=!1,c.options.runtimejson.gadgetOptions&&c.options.runtimejson.gadgetOptions.TileSort&&c.options.runtimejson.gadgetOptions.TileSort.columnMode&&c.options.runtimejson.gadgetOptions.TileSort.columnMode.resetAudioOnPause&&(c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.resetAudioOnPause=!0),$(a).find(".gadget-textblock").audioComponent(c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent,this.gadgetUniqueId),"button"===c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.type&&$(a).find(".gadget-textblock").removeAttr("tabindex")),$(a).attr({"data-default-title":PearsonGL.qtiEvaluator.replaceParameters(c.options.draggables[$(a).attr("data-inArray")].dragText.value).replace(/<(?:.|\n)*?>/gm,"")}),$(a).find(".text-audio-component").append('<label class="drag-state hidden-label"></label>'))):(null!=c.options.draggables[$(a).attr("data-inArray")]&&void 0!==c.options.draggables[$(a).attr("data-inArray")].dragText&&""!==c.options.draggables[$(a).attr("data-inArray")].dragText.value&&void 0!==c.options.draggables[$(a).attr("data-inArray")].dragText.value&&($(a).addClass("text-drag"),$(a).append("<table class='drag-text'><tr><td class='drag-text-cell'></td></tr></table>"),$(a).find(".drag-text-cell").richtextcomponent(c.options.draggables[$(a).attr("data-inArray")].dragText),void 0!==c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent&&void 0!==c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.src&&""!==c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.src&&(c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.stopDefault=!1,c.options.runtimejson.gadgetOptions&&c.options.runtimejson.gadgetOptions.TileSort&&c.options.runtimejson.gadgetOptions.TileSort.columnMode&&c.options.runtimejson.gadgetOptions.TileSort.columnMode.resetAudioOnPause&&(c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.resetAudioOnPause=!0),$(a).find(".gadget-textblock").audioComponent(c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent,this.gadgetUniqueId),"button"===c.options.draggables[$(a).attr("data-inArray")].dragText.audioComponent.type&&$(a).find(".gadget-textblock").removeAttr("tabindex")),$(a).attr({"data-default-title":PearsonGL.qtiEvaluator.replaceParameters(c.options.draggables[$(a).attr("data-inArray")].dragText.value).replace(/<(?:.|\n)*?>/gm,"")}),$(a).find(".text-audio-component").append('<label class="drag-state hidden-label"></label>')),null!=c.options.draggables[$(a).attr("data-inArray")]&&void 0!==c.options.draggables[$(a).attr("data-inArray")].dragImage&&""!==c.options.draggables[$(a).attr("data-inArray")].dragImage.src&&void 0!==c.options.draggables[$(a).attr("data-inArray")].dragImage.src&&($(a).addClass("image-drag"),$(a).addClass("image-tile"),$("body").hasClass("safari")&&$(a).append($('<label class="hidden-label"></label>').html(c.options.draggables[$(a).attr("data-inArray")].dragImage.title?PearsonGL.qtiEvaluator.replaceParameters(c.options.draggables[$(a).attr("data-inArray")].dragImage.title):"")),c.options.draggables[$(a).attr("data-inArray")].dragImage.protect=!1,$(a).append('<table class="image-container"><tr><td class="image-cell"></td></tr></table>'),c.options.draggables[$(a).attr("data-inArray")].dragImage.noTabIndex=!0,$(a).find(".image-cell").imagecomponent(c.options.draggables[$(a).attr("data-inArray")].dragImage),void 0!==c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent&&""!==c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent.src&&(c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent.stopDefault=!1,c.options.runtimejson.gadgetOptions&&c.options.runtimejson.gadgetOptions.TileSort&&c.options.runtimejson.gadgetOptions.TileSort.columnMode&&c.options.runtimejson.gadgetOptions.TileSort.columnMode.resetAudioOnPause&&(c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent.resetAudioOnPause=!0),$(a).find(".image-class-wrapper").audioComponent(c.options.draggables[$(a).attr("data-inArray")].dragImage.audioComponent,this.gadgetUniqueId)),$(a).attr({"data-default-title":c.options.draggables[$(a).attr("data-inArray")].dragImage.title?PearsonGL.qtiEvaluator.replaceParameters(c.options.draggables[$(a).attr("data-inArray")].dragImage.title):""}))),$(a).draggable({containment:c.jObject,scroll:!0,start:function(b,e){c.isDropping=!0,c.zdex++,a.removeClass("ps-shake ps-glow"),$(this).addClass("drag-item-down"),$(this).find("*").hasClass("audioToggleIdentifier")&&$(this).find(".audioToggleIdentifier").audioComponent("disableAudio"),c.options.cloning&&$(this).parent().hasClass("drag")&&(clone=c.clone[parseFloat($(this).attr("data-clone"))],d.children(".drag").append(clone),c.makeDrag(clone)),$(this).css("z-index",c.zdex),!c.isInstant&&$(this).parent().hasClass("drop-item")&&(f=$(this).offset().top-d.find(".drop").offset().top,g=$(this).offset().left-d.find(".drop").offset().left,h=$(this).parent(),i.css({position:"absolute",width:"0",height:"0",left:g,top:f}),d.find(".temp-div").each(function(){0==$(this).children().length&&$(this).remove()}),d.find(".drop").append(i.append($(this)))),c.stopAudio()},drag:function(a,b){$(this).removeClass("drag-item-down").addClass("drag-item-dragging")},revert:function(a){return!1===a?(c.reverCheck=!0,!0):(c.reverCheck=!1,!1)},stop:function(a){e=$(this),e.draggable("enable"),$(this).removeClass("drag-item-down drag-item-dragging drag-item-over drag-item-overdrop"),setTimeout(function(){e.find("*").hasClass("audioToggleIdentifier")&&e.find(".audioToggleIdentifier").audioComponent("enableAudio")},300),!0===c.reverCheck&&($(this).removeClass("drag-item-down drag-item-dragging drag-item-over drag-item-overdrop"),c.options.cloning&&$(this).parent().hasClass("drag")&&d.children(".drag").children(":last").fadeOut(800).remove(),!c.isInstant&&e.parent().hasClass("temp-div")&&c.onDropEvent(h,e,!1))}});var j=null,k=null,l=!1;$(a).on("touchstart",function(a){k=j=a.originalEvent.touches[0].pageY}),$(a).on("touchmove",function(a){k=a.originalEvent.touches[0].pageY,0==l&&Math.abs(k-j)>30&&(l=!0),1==l&&window.scrollBy(0,5)}),c.columnTileSortStackTiles(),$(a).keydown(function(a){if(($(this).is(":focus")||$(this).is(":active"))&&!$(this).hasClass("ui-draggable-disabled"))switch(c.isDropping=!1,c.collideDetect($(this),d.find(".drop").find(".drop-item")).length>0?(c.isOverDrop=!0,d.find(".drop").find(".drop-item").removeClass("drop-item-over"),$(c.collideDetect($(this),d.find(".drop").find(".drop-item"))[0]).addClass("drop-item-over")):(c.isOverDrop=!1,d.find(".drop").find(".drop-item").removeClass("drop-item-over")),a.keyCode){case 13:c.lastSelected=$(this),c.stateChecker(),c.selectDrag($(this)),!0===c.isOverDrop&&($(c.collideDetect($(this),d.find(".drop").find(".drop-item"))[0]).hasClass("ui-droppable-disabled")||(c.isDropping=!0,c.isOverDrop=!1,c.onDropEvent($(c.collideDetect($(this),d.find(".drop").find(".drop-item"))[0]),$(this),!0),$(this).find("*").hasClass("audioToggleIdentifier")&&$(this).find(".audioToggleIdentifier").audioComponent("enableAudio")));break;case 39:c.zdex++,$(this).css("z-index",c.zdex),$(this).css("left",parseFloat($(this).css("left"))+10),c.checkingAudio($(this)),c.keyEventCloneChecker($(this));break;case 37:c.zdex++,$(this).css("z-index",c.zdex),$(this).css("left",parseFloat($(this).css("left"))-10),c.checkingAudio($(this)),c.keyEventCloneChecker($(this));break;case 38:a.preventDefault(),c.zdex++,$(this).css("z-index",c.zdex),$(this).css("top",parseFloat($(this).css("top"))-10),c.checkingAudio($(this)),c.keyEventCloneChecker($(this)),$(this).position()&&$(this).position().top<$(window).scrollTop()&&$(window).scrollTop($(this).position().top);break;case 40:a.preventDefault(),c.zdex++,$(this).css("z-index",c.zdex),$(this).css("top",parseFloat($(this).css("top"))+10),c.checkingAudio($(this)),c.keyEventCloneChecker($(this)),$(this).position()&&$(this).position().top+$(this).height()>$(window).scrollTop()+(window.innerHeight||document.documentElement.clientHeight)&&$(window).scrollTop($(this).position().top-(window.innerHeight||document.documentElement.clientHeight)+2*$(this).height())}}),$(a).click(function(a){a.stopImmediatePropagation(),a.preventDefault(),$(this).hasClass("ui-draggable-disabled")||(c.lastSelected=$(this),c.stateChecker(),c.selectDrag($(this)))}),$(a).mousedown(function(){c.sendAnalytics("clicked_content")}),$(a).focus(function(a){$(this).hasClass("ui-draggable-disabled")||PearsonGL.utils.focusItemOn(this)}),$(a).blur(function(a){d.find(".drop").children().removeClass("drop-item-over"),$(this).hasClass("ui-draggable-disabled")||(PearsonGL.utils.focusItemOff(this),$(this).removeClass("drag-item-dragging"),d.find(".drop").children().removeClass("drop-item-over"),$(this).find("*").hasClass("audioToggleIdentifier")&&$(this).find(".audioToggleIdentifier").audioComponent("enableAudio"),$(this).parent().hasClass("drag")&&!1===c.isDropping&&$(this).animate({top:$(this).attr("data-top")+"px",left:$(this).attr("data-left")+"px"},400,function(){c.options.cloning&&d.find(".drag").find('[unique-id="'+$(this).attr("unique-id")+'"]').length>=2&&$(this).parent().hasClass("drag")&&$(this).remove()}))}),d.find(".audio-play").on("touchstart",function(a){a.stopPropagation()})}},{key:"keyEventCloneChecker",value:function(a){var b=void 0;this.options.cloning&&this.jObject.find(".drag").find('[unique-id="'+a.attr("unique-id")+'"]').length<2&&a.parent().hasClass("drag")&&(b=this.clone[parseFloat(a.attr("data-clone"))],this.jObject.children(".drag").append(b),this.makeDrag(b))}},{key:"revert",value:function(a,b){var c=this.jObject;a.animate({top:a.attr("data-top")+"px",left:a.attr("data-left")+"px"},600,function(){$(this).find(".marker").hide(),$(this).removeClass("drag-item-incorrect"),c.find('[unique-id="'+a.attr("unique-id")+'"]').attr("data-num-of-tries",parseFloat(a.attr("data-num-of-tries"))),!0===b&&$(this).remove()})}},{key:"selectDrag",value:function(a){var b=this;a.addClass("drag-item-selected"),b.setDragStatusLive(b.options.selectedText),a.find("*").hasClass("drag-state")&&a.find(".drag-state").html(b.options.selectedText),a.hasClass("image-tile")&&a.find(".hidden-label").html((a.attr("data-default-title")?a.attr("data-default-title"):"")+" "+b.options.selectedText),a.attr("aria-grabbed","true"),$(a).focus()}},{key:"stateChecker",value:function(){var a=this;this.jObject.find(".drag-item").each(function(){$(this).attr("aria-grabbed","false"),$(this).find("*").hasClass("drag-state")&&$(this).find(".drag-state").html(""),$(this).hasClass("image-tile")&&$(this).find(".hidden-label").html($(this).attr("data-default-title")?$(this).attr("data-default-title"):""),$(this).hasClass("drag-item-correct")?($(this).find("*").hasClass("drag-state")&&$(this).find(".drag-state").html(a.options.correctText),$(this).hasClass("image-tile")&&$(this).find(".hidden-label").html(($(this).attr("data-default-title")?$(this).attr("data-default-title"):"")+" "+a.options.correctText)):$(this).hasClass("drag-item-incorrect")&&($(this).find("*").hasClass("drag-state")&&$(this).find(".drag-state").html(a.options.incorrectText),$(this).hasClass("image-tile")&&$(this).find(".hidden-label").html(($(this).attr("data-default-title")?$(this).attr("data-default-title"):"")+" "+a.options.incorrectText))})}},{key:"checkingAudio",value:function(a){a.find("*").hasClass("audioToggleIdentifier")&&(a.find(".audioToggleIdentifier").audioComponent("stop"),a.find(".audioToggleIdentifier").audioComponent("disableAudio"),a.parent().hasClass("drag")?a.css("top")===a.attr("data-top")+"px"&&a.css("left")===a.attr("data-left")+"px"&&a.find(".audioToggleIdentifier").audioComponent("enableAudio"):a.parent().hasClass("drop-item")&&a.find(".audioToggleIdentifier").audioComponent("enableAudio"))}},{key:"dropSetup",value:function(){var a=this,b=a.jObject;b.find(".drop-item").each(function(){$(this).droppable({accept:".drag-item",drop:function(b,c){a.onDropEvent($(this),c.draggable,!1)},over:function(a,b){b.draggable.addClass("drag-item-overdrop"),$(this).addClass("drop-item-over")},out:function(a,b){b.draggable.removeClass("drag-item-overdrop"),$(this).removeClass("drop-item-over")}})}),b.find(".drop-item").click(function(b){$(this).hasClass("ui-droppable-disabled")||(b.preventDefault(),null!==a.lastSelected&&void 0!==a.lastSelected&&a.onDropEvent($(this),a.lastSelected,!1))}),b.find(".drop-item").attr({tabindex:"0",role:"button","aria-dropeffect":"move"}),b.find(".drop-item").focus(function(a){PearsonGL.utils.focusItemOn(this)}),b.find(".drop-item").blur(function(a){PearsonGL.utils.focusItemOff(this)}),b.find(".drop-item").keydown(function(b){if(($(this).is(":focus")||$(this).is(":active"))&&!$(this).hasClass("ui-droppable-disabled")&&13===b.keyCode){if(b.preventDefault(),null!==a.lastSelected&&void 0!==a.lastSelected){a.lastSelected;a.onDropEvent($(this),a.lastSelected,!0)}a.stopAudio()}})}},{key:"onDropEvent",value:function(a,b,c){var d=this,e=d.jObject,f=void 0,g=void 0,h=void 0,i=void 0;b.removeClass("drag-item-dragging"),PearsonGL.utils.focusItemOff(b),d.isInstant?(b.attr("data-numOfTries",parseFloat(b.attr("data-numOfTries"))-1),d.submittedTries=d.options.numberOfTries-parseFloat(b.attr("data-numOfTries")),d.scormData.tilePattern["'"+b.attr("id")+"'"]={},d.scormData.tilePattern["'"+b.attr("id")+"'"].numberOfTries=b.attr("data-numOfTries"),d.scormData.tilePattern["'"+b.attr("id")+"'"].dropped=!1,d.scormData.tilePattern["'"+b.attr("id")+"'"].correct=!1,a.attr("data-dropid")===b.attr("data-dragid")?(d.scormData.tilePattern["'"+b.attr("id")+"'"].dropped=!0,d.scormData.tilePattern["'"+b.attr("id")+"'"].correct=!0,d.onCorrect(),d.numOfCorrect++,d.scormData.numberOfCorrect=d.numOfCorrect,b.draggable("disable"),d.setDragStatusLive(d.options.correctText),b.hide("fade",{},20,function(){a.append($(this)),$(this).css({position:"relative",width:"",height:"",left:"",top:""}),$(this).find(".image-container").css({width:"",height:""}),g=2*parseFloat($(this).find(".drag-text").css("left")),f=2*parseFloat($(this).find(".drag-text").css("top")),h=parseFloat($(this).width())-g,i=parseFloat($(this).height())-f,d.options.feedback.showGraphicalTreatment||$(this).addClass("drag-item-correct"),e.find(".drag-item-correct").removeAttr("tabindex role"),e.find(".drag-item-correct").find(".gadget-textblock").removeAttr("tabindex role"),e.find(".drag-item-correct").find(".image-class-wrapper").removeAttr("tabindex role"),d.stateChecker(),$(this).unbind("mouseenter mouseleave"),$(this).fadeIn(10,function(){d.columnTileSortStackTiles(),PearsonGL.utils.focusItemOff($(this).find(".drag-text").removeAttr("tabindex")),PearsonGL.utils.focusItemOff($(this).find(".image-container").removeAttr("tabindex")),e.find(".drag").children(":first-child").attr("aria-hidden",!1),d.setDragStatusLive("dropzone"),d.progressIndicator(),d.saveLearnerData(!1),d.hasBeenInteractedWith=!0,a.parent().find(".correct-mark").fadeOut(500),d.focusOnSelf(a),d.resizeColumn(b)}),$(b).removeClass("hide-tile").addClass("show-tile"),b.draggable("disable"),b.on("dragstart",function(a){a.preventDefault()}),$(b).attr("aria-disabled","true")}),setTimeout(function(){d.showFeedBack(!0)},400)):parseFloat(b.attr("data-numOfTries"))<=0?(d.scormData.tilePattern["'"+b.attr("id")+"'"].dropped=!0,d.onIncorrect(),b.unbind("mouseenter mouseleave"),b.draggable("disable"),d.setDragStatusLive(d.options.incorrectText),d.options.feedback.showGraphicalTreatment||b.addClass("drag-item-incorrect"),b.delay(100).queue(function(a){e.find('[data-dropid="'+$(this).attr("data-dragid")+'"]').append($(this)),$(this).css({position:"relative",width:"",height:"",left:"",top:""}),$(this).find(".image-container").css({width:"",height:""}),g=2*parseFloat($(this).find(".drag-text").css("left")),f=2*parseFloat($(this).find(".drag-text").css("top")),h=parseFloat($(this).width())-g,i=parseFloat($(this).height())-f,e.find(".drag-item-incorrect").removeClass("drag-item-incorrect").addClass("correct-drag"),e.find(".drag-item-incorrect").removeAttr("tabindex role"),e.find(".drag-item-incorrect").find(".gadget-textblock").removeAttr("tabindex role"),e.find(".drag-item-incorrect").find(".image-class-wrapper").removeAttr("tabindex role"),d.stateChecker(),d.focusOnSelf(e.find('[data-dropid="'+$(this).attr("data-dragid")+'"]')),$(this).fadeIn(10,function(){d.progressIndicator(),d.saveLearnerData(!1),d.hasBeenInteractedWith=!0}),PearsonGL.utils.focusItemOff($(this).find(".drag-text")),PearsonGL.utils.focusItemOff($(this).find(".image-container")),d.columnTileSortStackTiles(),d.resizeColumn(b),e.find(".drag").children(":first-child").attr("aria-hidden",!1),d.options.columnsText.length,d.setDragStatusLive("dropzone, tile dropped in the correct dropzone"),a(),$(b).removeClass("hide-tile").addClass("show-tile"),b.draggable("disable"),b.on("dragstart",function(a){a.preventDefault()}),$(b).attr("aria-disabled","true")}),setTimeout(function(){d.showFeedBack(!1)},800)):(d.onIncorrect(),b.unbind("mouseenter mouseleave"),d.options.feedback.showGraphicalTreatment||b.addClass("drag-item-incorrect"),d.showFeedBack(!1),b.delay(20).queue(function(a){b.animate({top:b.attr("data-top")+"px",left:b.attr("data-left")+"px"},600,function(){$(this).delay(10).removeClass("drag-item-incorrect"),d.stateChecker(),$(this).hover(function(){$(this).addClass("drag-item-over")},function(){$(this).removeClass("drag-item-over")}),d.options.cloning&&e.find(".drag").find('[unique-id="'+$(this).attr("unique-id")+'"]').length>=2&&$(this).parent().hasClass("drag")&&e.find(".drag").find('[unique-id="'+$(this).attr("unique-id")+'"]:last').remove(),$(b).focus(),b.removeClass("drag-item-dragging")}),a()}),e.find(".drag-item:not(.correct-tile, .show-tile)").slice(1).css({left:b.attr("data-left")+"px"}),d.columnTileSortStackTiles(),e.find(".drag").children(":first-child").attr("aria-hidden",!1),d.setDragStatusLive("incorrect dropzone, tile moved back to the tile stack"))):b.hide("fade",{},20,function(){$(this).css({position:"relative",width:"",height:"",left:"",top:""}),$(this).find(".image-container").css({width:"",height:""}),a.append($(this)),g=2*parseFloat($(this).find(".drag-text").css("left")),f=2*parseFloat($(this).find(".drag-text").css("top")),h=parseFloat($(this).width())-g,i=parseFloat($(this).height())-f,PearsonGL.utils.focusItemOff($(this).find(".drag-text")),PearsonGL.utils.focusItemOff($(this).find(".image-container")),$(this).fadeIn(10,function(){d.saveSubmittedMode(),d.progressIndicator(),d.hasBeenInteractedWith=!0,d.focusOnSelf(a),0===e.find(".drag").children().size()&&e.find(".c-checkanswer-button").sliderbutton("enable")}),d.columnTileSortStackTiles(),d.resizeColumn(b),d.setDragStatusLive("Dropped")}),a.removeClass("drop-item-over"),d.lastSelected=null,d.stateChecker()}},{key:"setDragStatusLive",value:function(a){this.dragStatusLive.html(a)}},{key:"resizeColumn",value:function(a){var b=this,c=this.jObject,d=void 0,e=void 0;c.find(".drop-item").css({height:""}),c.css({height:""}),b.prevMax=0,c.find(".drop-item").each(function(){$(this).find(".drag-item:not(.correct-tile)").length>b.prevMax&&(b.prevMax=$(this).find(".drag-item:not(.correct-tile)").length,b.prevMax>2&&(d=$(this).find(".drag-item:not(.correct-tile)").length*$(a).height()+$(a).height()+7*($(this).find(".drag-item:not(.correct-tile)").length-3),e=c.height()+20,c.find(".drop-item").css({height:d+"px"}),c.css({height:e+$(a).height()*($(this).find(".drag-item:not(.correct-tile)").length-3)})))})}},{key:"resizeColumnAnswerButton",value:function(){var a=this.jObject,b=0,c=void 0,d=void 0;a.find(".drop-item").each(function(){$(this).find(".drag-item:visible").length>b&&(b=$(this).find(".drag-item:visible").length,d=$(this).find(".drag-item").height())}),b>this.prevMax&&(c=b*d+12*b,a.height()+20,a.find(".drop-item").css({height:c+"px"}))}},{key:"collideDetect",value:function(a,b){var c=a,d=b,e=$([]),f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0;return!(!c||!d)&&(f=c,g=f.offset(),h=g.left,i=g.top,j=h+f.outerWidth(),k=i+f.outerHeight(),l=parseFloat(f.height())/2+i,m=parseFloat(f.width())/2+h,d.not(f).each(function(){return n=$(this),o=n.offset(),p=o.left,q=o.top,r=p+n.outerWidth(),s=q+n.outerHeight(),h>=r||j<=p||i>=s||k<=q||(m<=r&&m>=p&&l<=s&&l>=q?(e=$([]),e.push(this),!1):void 0)}),e)}},{key:"progressIndicator",value:function(){var a=this,b=(this.jObject,void 0);if(!0===this.options.progressBar){b=this.totalDraggableTile-this.jObject.find(".drag").children().length,this.jObject.find(".progress").html(b+" "+this.options.ofLabel+" "+this.totalDraggableTile);var c=b/this.totalDraggableTile*100;0==c&&this.jObject.find(".progress-bar").find(".ui-slider-handle").hide(),this.jObject.find(".progress-bar").slider("option","value",c)}0===this.jObject.find(".drag").children().length&&this.onComplete(),a.options.rotationArrows&&0==a.jObject.find(".drag").children().length&&(a.jObject.find(".prev-button").sliderbutton("disable"),a.jObject.find(".next-button").sliderbutton("disable"))}},{key:"onCorrect",value:function(){this.options.correctAudio&&""!==this.options.correctAudio&&this.jObject.find(".dnd-correct-audio").audioComponent("play")}},{key:"onIncorrect",value:function(){this.options.inCorrectAudio&&""!==this.options.inCorrectAudio&&this.jObject.find(".dnd-in-correct-audio").audioComponent("play")}},{key:"onComplete",value:function(){var a=this;0===a.jObject.find(".drag").children().length&&a.isInstant&&$(window).trigger(a.gadgetUniqueId+"stopClock","stopClock")}},{key:"saveSubmittedMode",value:function(){var a=this,b=a.jObject;a.scormData.tilePattern={},b.find(".drag-item:not(.correct-tile)").each(function(){$(this).parent().hasClass("drop-item")&&(a.scormData.tilePattern["'"+$(this).attr("id")+"'"]={},a.scormData.tilePattern["'"+$(this).attr("id")+"'"].parent=$(this).parent().attr("data-dropid"),$(this).hasClass("ignore-correct")&&(a.scormData.tilePattern["'"+$(this).attr("id")+"'"].correct=!0),$(this).hasClass("ignore-incorrect")&&(a.scormData.tilePattern["'"+$(this).attr("id")+"'"].incorrect=!0))}),b.find(".c-checkanswer-button").hasClass("try-again")?a.scormData.tryagain=!0:a.scormData.tryagain=!1,a.saveLearnerData(!0)}},{key:"setGadget",value:function(){var a=this,b=a.jObject,c=void 0,d=void 0,e=void 0,f=void 0,g=void 0;if(a.numOfCorrect=parseFloat(a.scormData.numberOfCorrect),a.hasBeenInteractedWith=!0,this.options.submitScoreOnFirstAttempt&&this.scormData.scoreFinalized&&(this.options.scoreFinalized=this.scormData.scoreFinalized),a.isInstant)b.find(".drag-item").each(function(){void 0!==a.scormData.tilePattern["'"+$(this).attr("id")+"'"]&&(!0===a.scormData.tilePattern["'"+$(this).attr("id")+"'"].dropped?($(this).removeClass("ps-shake ps-glow"),b.find(".drop").find('[data-dropid="'+$(this).attr("data-dragid")+'"]').append($(this)),$(this).css({position:"relative",width:"",height:"",left:"",top:""}),$(this).find(".image-container").css({width:"",height:""}),d=2*parseFloat($(this).find(".drag-text").css("left")),e=2*parseFloat($(this).find(".drag-text").css("top")),f=parseFloat($(this).width())-d,g=parseFloat($(this).height())-e,a.options.feedback.showGraphicalTreatment||(!0===a.scormData.tilePattern["'"+$(this).attr("id")+"'"].correct?$(this).addClass("drag-item-correct"):$(this).addClass("drag-item-incorrect")),a.stateChecker(),$(this).unbind("mouseenter mouseleave")):(c=parseFloat(b.find(".drag").children().first().css("z-index"))+5,$(this).css("z-index",c),$(this).attr("data-numoftries",a.scormData.tilePattern["'"+$(this).attr("id")+"'"].numberOfTries),b.find(".drag").append($(this))))});else{b.find(".drag-item:not(.correct-tile)").each(function(){void 0!==a.scormData.tilePattern["'"+$(this).attr("id")+"'"]&&(b.find(".drop").find('[data-dropid="'+a.scormData.tilePattern["'"+$(this).attr("id")+"'"].parent+'"]').append($(this)),$(this).css({position:"relative",width:"",height:"",left:"",top:""}),$(this).find(".image-container").css({width:"",height:""}),a.scormData.tilePattern["'"+$(this).attr("id")+"'"].correct&&($(this).addClass("ignore-correct"),a.options.feedback.showGraphicalTreatment||$(this).addClass("drag-item-correct"),$(this).unbind("mouseenter mouseleave"),$(this).draggable("disable")),a.scormData.tilePattern["'"+$(this).attr("id")+"'"].incorrect&&($(this).addClass("ignore-incorrect"),a.options.feedback.showGraphicalTreatment||$(this).addClass("drag-item-incorrect"),$(this).unbind("mouseenter mouseleave"),$(this).draggable("disable")))});var h=a.scormData.allCorrect;a.submittedTries=a.scormData.submittedTries,b.find(".c-checkanswer-button").show().sliderbutton("disable"),a.scormData.tryagain?(b.find(".c-checkanswer-button").find(".button-text").html(a.options.buttons.tryAgainButton),b.find(".c-checkanswer-button").addClass("try-again"),b.find(".c-checkanswer-button").show().sliderbutton("enable")):(b.find(".c-checkanswer-button").removeClass("try-again").find(".button-text").html(a.options.buttons.checkAnswerButton),0==b.find(".drag").children().length&&b.find(".c-checkanswer-button").show().sliderbutton("enable")),h&&(b.find(".c-checkanswer-button").removeClass("try-again").find(".button-text").html(a.options.buttons.checkAnswerButton),b.find(".c-checkanswer-button").show().sliderbutton("disable"),b.find(".c-answer-button").hide(),b.find(".c-myanswer-button").hide()),a.submittedTries==a.options.numberOfTries&&(b.find(".c-checkanswer-button").hide(),b.find(".c-myanswer-button").children().length>0&&(b.find(".c-answer-button").show(),a.setShowAnswerButtonStates("enable")))}a.resizeColumn(b.find(".drop").find(".drag-item")),a.progressIndicator()}},{key:"parseLearnerData",value:function(){var a=this.options.scorm.suspendData.data;"object"===(void 0===a?"undefined":_typeof(a))&&(this.scormData=a,this.setGadget())}},{key:"saveLearnerData",value:function(a){if(this.isCommEnabled()){var b=void 0,c=[];if(this.options.scorm.suspendData.data=this.scormData,!a&&!this.options.scoreFinalized)for(b=0;b<this.options.scorm.interactions.length;b++)result=this.getResult(this.options.scorm.interactions[b].objectives[0]),result.correctResponses=[{pattern:[]}],result.learnerResponse=[],this.jObject.find(".drag-item").each(function(){result.correctResponses[0].pattern.push([$(this).attr("data-dragid"),$(this).attr("data-dragid")]),result.learnerResponse.push([$(this).attr("data-dragid"),$(this).attr("data-dragid")])}),c.push(result);this.setLearnerData({gadgetId:this.gadgetUniqueId,data:this.options.scorm,results:c})}}},{key:"getResult",value:function(a){var b={};try{a.score.min=0,a.score.max!==a.score.raw&&(a.score.raw=a.score.max*(this.numOfCorrect/this.totalDraggableTile),a.score.raw>1&&(a.score.raw=1)),a.score.max-a.score.min!=0?a.score.scaled=(a.score.raw-a.score.min)/(a.score.max-a.score.min):a.score.scaled=1,a.progress_measure=(this.totalDraggableTile-this.jObject.find(".drag").children().size())/this.totalDraggableTile,b.raw=a.score.raw,b.min=a.score.min,b.max=a.score.max,b.scaled=a.score.scaled,b.progressMeasure=a.progress_measure,b.completionStatus="incomplete",b.successStatus="unknown",a.completion_status="incomplete",a.success_status="unknown",parseFloat(a.progress_measure)>=parseFloat(a.completionThreshold)?(a.completion_status="completed",b.completionStatus="completed",parseFloat(a.score.scaled)>=parseFloat(PearsonGL.globals.comm.getPassingScore())?(a.success_status="passed",b.successStatus="passed"):(a.success_status="failed",b.successStatus="failed")):parseFloat(a.score.scaled)>=parseFloat(PearsonGL.globals.comm.getPassingScore())&&(a.success_status="passed",b.successStatus="passed"),this.isInstant||(a.completion_status="incomplete",b.completionStatus="incomplete",1==this.scormData.checkedAnswer&&(this.submittedTries>=this.options.numberOfTries||this.scormData.allCorrect)&&(a.completion_status="completed",b.completionStatus="completed"))}catch(a){}return!0===this.giveAllPoints&&(a.score.raw=a.score.max,a.success_status="passed",b.successStatus="passed",this.giveAllPoints=!1),b.result=b.scaled,b}},{key:"gadgetUnload",value:function(){this.sendAnalytics("clicked_start_count",this.startClicked)}}]),b}(PearsonGL.Gadget.TileSort);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},window.PearsonGL.productConfig=window.PearsonGL.productConfig||{},window.PearsonGL.productConfig.table=window.PearsonGL.productConfig.table||{},PearsonGL.Gadget.Table=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return c?(e.labelOpts={showSolutionText:"Show My Answers",resetButtonText:"Start Over",chartItButtonText:"Chart It",resetConfirmText:"Would you like to start over?",closeToolTip:"Close",yesToolTip:"Yes",yesChartItTip:"Yes",noToolTip:"No",addButtonText:"Add Row",deleteBtnPrefix:"Button clickable",deleteRowToolTip:"Delete Row",deleteRowConfirmation:"Delete table row?",invalidRange:"Value is out of range. Enter a value between {0} and {1}.",numberTooSmall:"Enter a value greater than or equal to {0}.",numberTooBig:"Enter a value less than or equal to {0}.",exceedMaxLen:"Exceeds character limit.",validDataSample:"Invalid data format. Example valid data: {0}.",invalidDateTimeFormat:"Invalid date or invalid date/time format.  The valid format is {0}.",exceedScormDataLimit:"Table data cannot be saved because the data exceeds the specified limit."},e.options=$.extend(!0,{gadgetName:"Table",objectiveDescription:"Table is presented to the user.",editable:!1,noTabIndex:!0,isModal:!0,popupcontainment:".main",deleteRowButtonAlignRight:!!PearsonGL.productConfig.table.deleteRowButtonAlignRight},e.options||{}),PearsonGL.productConfig.table.maxAddOnRows=e.options.maxAddOnRows?e.options.maxAddOnRows:0,e.constants={RESET_BTN:"resetBtn",SOLUTION_BTN:"ansBtn",CHART_IT_BTN:"chartItBtn",ADD_BTN:"addBtn",COL_ID:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],CELL_ID_INDEX:{col:0,row:1,rand:2},DATE_FORMAT:{d:"d -Day of the month as digits; no leading zero for single-digit days.",dd:"dd - Day of the month as digits; leading zero for single-digit days.",ddd:"ddd - Day of the week as a three-letter abbreviation.",dddd:"dddd - Day of the week as its full name.",m:"m - Month as digits; no leading zero for single-digit months.",mm:"mm - Month as digits; leading zero for single-digit months.",mmm:"mmm - Month as a three-letter abbreviation.",mmmm:"mmmm - Month as its full name.",yy:"yy - Year as last two digits; leading zero for years less than 10.",yyyy:"yyyy - Year represented by four digits.",h:"h - Hours; no leading zero for single-digit hours (12-hour clock).",hh:"hh - Hours; leading zero for single-digit hours (12-hour clock).",H:"H - Hours; no leading zero for single-digit hours (24-hour clock).",HH:"HH - Hours; leading zero for single-digit hours (24-hour clock).",M:"M - Minutes; no leading zero for single-digit minutes.",MM:"MM - Minutes; leading zero for single-digit minutes.",s:"s - Seconds; no leading zero for single-digit seconds.",ss:"ss - Seconds; leading zero for single-digit seconds.",t:"t - Lowercase, single-character time marker string: a or p.",tt:"tt - Lowercase, two-character time marker string: am or pm.",T:"T - Uppercase, single-character time marker string: A or P.",TT:"TT - Uppercase, two-character time marker string: AM or PM."}},e.dayNames={en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],es:["dom","lun","mar","mi","jue","vie","sb","domingo","lunes","martes","mircoles","jueves","viernes","sbado"]},e.monthNames={en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],es:["enero","feb","marzo","abr","mayo","jun","jul","agosto","sept","oct","nov","dic","enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},e.jObject=$(a),e.initialize(),e):_possibleConstructorReturn(e)}return _inherits(b,a),_createClass(b,[{key:"initialize",value:function(){var a=this,b=this.jObject;this.scormData={isLocked:!1},this.isShowSolutionAlways=!0,this.isResetBtnEnabled=!1,this.isResetBtnEnabledChecked=!1,this.hasEditableCell=!1,this.isL1Scorm=!0,this.hasChanged=!1,this.isScreenReaderMode=!1,this.cellIdToExportData={},this.exportData={},this.lastRowElem,this.numAddedRows=0,this.addedRowIds=[],this.mergeCells=[],this.solutionActive=!1,this.deleteActivated=!1,this.isEditable=!1;try{this.isScreenReaderMode=global_player.inScreenReaderMode}catch(a){}this.randId=Math.floor(1e5*Math.random()),this.isTabPressed=!1,this.jObject.addClass("table-identifier"),this.initGadget(this.options.gadgetName),this.options.exportData&&this.setupExportData(),PearsonGL.utils.getGlobalizedLabel("table_globalization",a.globalizationComplete.bind(this),this.options.runtimejson.lang),a.options.exportData&&!a.options.chartIt&&$(document).on("PageShowEvent",function(b,c){a.exportAllData()}),$(window).bind("resize.table",function(c){a.jObject.is(":visible")&&(a.table.width()<=400?b.addClass("responsive-table"):b.removeClass("responsive-table"))}),$(window).on("click",function(){a.jObject.find(".max-length-found").unwrap().remove()})}},{key:"saveIfNeeded",value:function(){this.saveLearnerData()}},{key:"globalizationComplete",value:function(a){var b=this,c=$.extend({},this.options);this.transferLabels(a),delete c.scorm,$.extend(this.options,c),this.mergeAllMessages(),this.setupComponents(),$(window).on("keypadPress",function(a){a.keyVal&&b._addKeypadValue(a)}),this.getLearnerData({results:[{correctResponses:[{pattern:"Edited/Viewed Table"}],learnerResponse:"Not Edit Table"}]})}},{key:"findNextDownEditableContent",value:function(a){var b,c,d=$(a).data("focus-id").split("_"),e=$(a).attr("id"),f=this.jObject.find("tr:last"),g=$(a).parent("tr").next("tr");do{if(g.length>0){if(c=g.attr("id").split("_"),b=d[this.constants.CELL_ID_INDEX.col]+"_"+c[0]+"_"+this.randId,this.setFocusOnNextCell(e,b))return;g=g.next("tr")}}while(g.length>0&&g!=f)}},{key:"findNextLeftEditableContent",value:function(a){var b,c,d=a.data("focus-id").split("_"),e=$(a).attr("id");for(b=d[this.constants.CELL_ID_INDEX.col].charCodeAt(0)-1;b>=97;b--)if(c=String.fromCharCode(b)+"_"+d[this.constants.CELL_ID_INDEX.row]+"_"+this.randId,this.setFocusOnNextCell(e,c))return}},{key:"findNextRightEditableContent",value:function(a){var b,c,d=a.data("focus-id").split("_"),e=$(a).attr("id");for(b=d[this.constants.CELL_ID_INDEX.col].charCodeAt(0)+1;b<=97+1*this.options.cols;b++)if(c=String.fromCharCode(b)+"_"+d[this.constants.CELL_ID_INDEX.row]+"_"+this.randId,this.setFocusOnNextCell(e,c))return}},{key:"findNextUpEditableContent",value:function(a){var b,c,d=$(a).data("focus-id").split("_"),e=$(a).attr("id"),f=this.jObject.find("tr:first"),g=$(a).parent("tr").prev("tr");do{if(g.length>0){if(c=g.attr("id").split("_"),b=d[this.constants.CELL_ID_INDEX.col]+"_"+c[0]+"_"+this.randId,this.setFocusOnNextCell(e,b))return;g=g.prev("tr")}}while(g.length>0&&g!=f)}},{key:"getDateTime",value:function(a,b){function c(a){var b,c=e.options.runtimejson.lang;for(b=0;b<e.monthNames[c].length&&e.monthNames[c][b].toLowerCase()!==a.toLowerCase();b++);return b>11?(b-12)%12+1:b%12+1}var d,e=this,f={formatString:b,toString:a},g=b.split(/[\/, -.]+/),h=a.split(/[\/, -.]+/);if(""===a)return f;for(d=0;d<h.length;d++)switch(g[d]){case"m":case"mm":f.month=parseInt(h[d],10);break;case"mmm":case"mmmm":f.month=c(h[d]),f.monthToString=h[d];break;case"d":case"dd":f.date=parseInt(h[d],10);break;case"ddd":case"dddd":f.dayOfWeek=h[d];break;case"yy":case"yyyy":f.year=parseInt(h[d],10);break;default:for(var i=g[d].split(/[: ]+/),j=h[d].split(/[: ]+/),k=0;k<j.length;k++)switch(i[k]){case"h":case"H":case"hh":case"HH":f.hours=parseInt(j[k],10);break;case"M":case"MM":f.minutes=parseInt(j[k],10);break;case"s":case"ss":case"S":case"SS":f.seconds=parseInt(j[k],10);break;case"t":case"tt":case"T":case"TT":f.period=j[k]}}return f}},{key:"getDateTimeFormat",value:function(a){var b="";return a.dateFormat&&"none"!==a.dateFormat&&(b=a.dateFormat),a.timeFormat&&"none"!==a.timeFormat&&(b+=" "+a.timeFormat),b.trim()}},{key:"getScormDataId",value:function(a){var b=a.split("_");return b.length>=3?b[0]+"_"+b[1]+"_":""}},{key:"getNormalCellId",value:function(a){var b=this.getScormDataId(a);return b.substring(0,b.length-1)}},{key:"formatDate",value:function(a,b){var c,d=new Date,e=this.options.runtimejson.lang,f=d.getDate(),g=d.getDay(),h=d.getMonth()+1,i=d.getFullYear(),j=d.getHours(),k=d.getMinutes(),l=d.getSeconds(),m=void 0,n=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMSsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,o=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a};getValue=function(a,b,c,d){var e;for(e=0;e<a.length;e++)if(a[e].toLowerCase()===b.toLowerCase())return e>=c&&e<=d?a[e]:e>d?a[e-d-1]:a[e+c];return""};var p=b.split(/[\/, -.]+/),q=a.split(/[\/, -.]+/);for(c=0;c<q.length;c++)switch(p[c]){case"m":case"mm":h=1*q[c];break;case"mmm":case"mmmm":h=q[c];break;case"d":case"dd":f=1*q[c];break;case"ddd":case"dddd":g=q[c];break;case"yy":case"yyyy":i=q[c];break;default:for(var r=p[c].split(/[: ]+/),s=q[c].split(/[: ]+/),t=0;t<s.length;t++)switch(r[t]){case"h":case"H":case"hh":case"HH":j=1*s[t];break;case"M":case"MM":k=1*s[t];break;case"s":case"ss":case"S":case"SS":l=1*s[t];break;case"t":m=s[t].toLowerCase(),2===m.length&&(m=m.charAt(0));break;case"tt":m=s[t].toLowerCase(),1===m.length&&(m+="m");break;case"T":m=s[t].toUpperCase(),2===m.length&&(m=m.charAt(0));break;case"TT":m=s[t].toUpperCase(),1===m.length&&(m+="M");break;default:return q}}return flags={d:f,dd:o(f),ddd:Math.floor(g)==g&&$.isNumeric(g)?this.dayNames[e][1*g]:getValue(this.dayNames[e],g,0,6),dddd:Math.floor(g)==g&&$.isNumeric(g)?this.dayNames[e][1*g+7]:getValue(this.dayNames[e],g,7,13),m:h,mm:o(h),mmm:Math.floor(h)==h&&$.isNumeric(h)?this.monthNames[e][1*h-1]:getValue(this.monthNames[e],h,0,11),mmmm:Math.floor(h)==h&&$.isNumeric(h)?this.monthNames[e][1*h+11]:getValue(this.monthNames[e],h,12,24),yy:4===String(i).length?String(i).slice(2):i,yyyy:i,h:j%12||12,hh:o(j%12||12),H:j,HH:o(j),M:k,MM:o(k),s:l,ss:o(l),S:l,SS:o(l),t:m||(j<12?"a":"p"),tt:m||(j<12?"am":"pm"),T:m||(j<12?"A":"P"),TT:m||(j<12?"AM":"PM")},b.replace(n,function(a){return a in flags?flags[a]:a.slice(1,a.length-1)})}},{key:"updateExportData",value:function(a,b,c){var d,e=this,f=this.getNormalCellId(a),g=this.cellIdToExportData[f];if(g)for(c&&c.length>0&&(b=e.getDateTime(b,c)),d=0;d<g.length;d++)$.each(this.exportData[g[d]],function(a,c){a===f&&(e.exportData[g[d]][a]=b)})}},{key:"exportTableData",value:function(a,b,c){var d,e,f=this,g={gadgetId:this.gadgetUniqueId},h=this.getNormalCellId(a.attr("id")),i=this.cellIdToExportData[h];if(i){for(c&&c.length>0&&(b=this.getDateTime(b,c)),d=0;d<i.length;d++)e=[],$.each(this.exportData[i[d]],function(a,c){a===h&&(f.exportData[i[d]][a]=b,c=b),e.push(c)}),g[i[d]]=e;f.options.chartIt||a.trigger("tableDataChanged",g)}}},{key:"exportAllData",value:function(){var a,b,c={gadgetId:this.gadgetUniqueId},d=$.map(this.exportData,function(a,b){return b});for(a=0;a<d.length;a++)b=[],$.each(this.exportData[d[a]],function(a,c){b.push(c)}),c[d[a]]=b;$(this.jObject).trigger("tableDataChanged",c)}},{key:"mergeAllMessages",value:function(){var a=this;a.options.reset&&a.options.reset.forEach(function(b){b.buttonText||(b.buttonText=a.labelOpts.resetButtonText),b.resetConfirmText||(b.resetConfirmText="<p>"+a.labelOpts.resetConfirmText+"</p>")}),a.options.showSolution&&a.options.showSolution.forEach(function(b){b.buttonText||(b.buttonText=a.labelOpts.showSolutionText)}),a.options.chartIt&&a.options.chartIt.forEach(function(b){b.buttonText||(b.buttonText=a.labelOpts.chartItButtonText)}),a.options.addButton&&a.options.addButton.forEach(function(b){b.text||(b.text=a.labelOpts.addButtonText)})}},{key:"resetTableData",value:function(){var a,b,c,d,e,f=this.jObject,g=this;f.find(".result-pop-up").fadeOut(),f.children(".checker").fadeOut(),f.find(".start-over").sliderbutton("disable"),f.find(".table-add-button").sliderbutton("enable");f.find("tr.added td");this.scormData={isLocked:!1},this.numAddedRows=0,this.addedRowIds=[],this.nextId=g.options.rows,this.glassPanel&&this.glassPanel.remove(),f.find("tr.added").remove(),c=f.find(".editableContent"),c.each(function(a,c){b=$(c).parent().data("cell-data");var f=$(b.value).text.trim;$(c).hasClass("component_mathquill")||$(c).hasClass("mq-editable-field")?$(c).find(".mq-root-block").empty().append(b.displayValue):$(c).empty().append(b.displayValue),b.required&&$(c).addClass("miss"),e=$(c).parent(),g.scormData[g.getScormDataId(e.attr("id"))]=f,g.options.exportData&&(d="","Date"===b.format&&(d=g.getDateTimeFormat(b)),g.updateExportData(e.attr("id"),f,d))}),c=f.find(".checkableContent"),c.each(function(a,b){$(b).removeClass("checked"),e=$(b).parent(),g.scormData[g.getScormDataId(e.attr("id"))]=""}),this.isResetBtnEnabled=!1,a=this.isShowSolutionAlways?"enable":"disable",f.find(".show-solution").sliderbutton(a),f.find(".chart-it").sliderbutton(a),this.isCommEnabled()&&!g.isL1Scorm&&(g.scormData[g.constants.RESET_BTN]="disable",g.scormData[g.constants.SOLUTION_BTN]=a,g.scormData[g.constants.CHART_IT_BTN]=a,g.saveLearnerData()),g.sendAnalytics("table_revertdata")}},{key:"saveLearnerData",value:function(){if(this.isCommEnabled()){if(PearsonGL.globals.comm.isExceededSuspendDataLimit(this.scormData,this.options.scorm.suspendDataLimit)&&!this.jObject.find(".result-pop-up").is(":visible"))return void this.showValidationError(this.options.exceedScormDataLimit);this.scormData.numAddedRows=this.numAddedRows,this.scormData.addedRowIds=this.addedRowIds,this.scormData.nextId=this.nextId,this.options.scorm.suspendData.data=this.scormData,this.setLearnerData({results:[{learnerResponse:"Edited/Viewed Table",raw:this.options.scorm.interactions[0].objectives[0].score.max,progressMeasure:1,completionStatus:"completed",successStatus:"passed"}]})}}},{key:"setCellStyle",value:function(a,b){var c={},d="";if(b.bgcolor&&(b.bgcolor.indexOf("#")<0&&b.bgcolor.length>=3?c["background-color"]="#"+b.bgcolor:c["background-color"]=b.bgcolor),b.border){for(d in b.border)b.border.hasOwnProperty(d)&&(c["border-"+d]=b.border[d])}$(a).css(c),b.align&&""!==b.align&&$(a).addClass("align-"+b.align),b.valign&&""!==b.valign&&$(a).addClass("valign-"+b.valign)}},{key:"selectAndFocusCellData",value:function(a){var b,c,d=a[0];if(0===$(d).text().trim().length)return void d.focus();document.body.createTextRange?(b=document.body.createTextRange(),b.moveToElementText(d),b.select()):window.getSelection&&(c=window.getSelection(),b=document.createRange(),b.selectNodeContents(d),b.collapse(!1),c.removeAllRanges(),c.addRange(b),d.focus())}},{key:"setFocusOnNextCell",value:function(a,b,c){var d,e;if(c||a.indexOf(b)<0){if(d=this.jObject.find("td[id*='"+b+"']"),e=d.find("div[contenteditable='true']"),d.data("focus-id",b),0===e.length&&this.isScreenReaderMode)return d.focus(),!0;if(e&&e.hasClass("editableContent"))return this.selectAndFocusCellData(e),!0}return!1}},{key:"setEventHandlers",value:function(a){var b,c,d,e=this,f=this,g="cell",h=a.hasClass("editableCell"),i=a.find("div[contentEditable=true]");h&&(f.isEditable=!0),f.options.mathquillMode&&i.length>0&&"Text"==$(a).data("cell-data").format?this.mqFields.push(i):(i.on("keydown",function(a){var b=a.currentTarget.textContent;1===b.length&&""===b&&(b=b.replace("",""),e.textContent=b)}).on("keyup",function(e){c=$(a).data("cell-data"),b=$(e.currentTarget).text().trim(),""===b&&!0!==c.placeholder&&$(e.currentTarget).html("&nbsp;"),f.isResetBtnEnabled||b===$(c.value).text().trim()||(f.jObject.find(".start-over").sliderbutton("enable"),f.isResetBtnEnabled=!0),d=0===f.jObject.find(".required.miss").length?"enable":"disable",f.jObject.find(".show-solution").sliderbutton(d)}),a.hasClass("editableCell")&&a.on("click",function(a){if(PearsonGL.utils.isTouch()&&$(a.currentTarget).hasClass("editableCell")&&f.sendAnalytics("tapped_screen"),$(a.currentTarget).hasClass("nonEditableCell"))i.focus();else{var b=$(a.currentTarget).find(".checkableContent");if("true"===b.attr("checkable")){var c=b.attr("groupName"),d=!1;switch(c){case"on":b.hasClass("checked")||(b.toggleClass("checked"),f.scormData[f.getScormDataId($(a.currentTarget).attr("id"))]="checked",f.isResetBtnEnabledChecked=!0);break;case"checkbox":b.hasClass("checked")?(b.toggleClass("checked"),f.scormData[f.getScormDataId($(a.currentTarget).attr("id"))]=""):(f.scormData[f.getScormDataId($(a.currentTarget).attr("id"))]="checked",d=!0,b.toggleClass("checked"));break;default:var e=$(a.currentTarget).closest("table");if(b.hasClass("checked"))return b.removeClass("checked"),f.isResetBtnEnabledChecked=!1,f.scormData[f.getScormDataId(b.parent().attr("id"))]="",void f.saveLearnerData();e.find(".checkableContent").each(function(a,b){$(b).attr("groupName")===c&&($(b).removeClass("checked"),f.scormData[f.getScormDataId($(b).parent().attr("id"))]="")}),f.isResetBtnEnabledChecked=!0,b.addClass("checked"),f.scormData[f.getScormDataId($(this).attr("id"))]="checked"}!0===f.isResetBtnEnabledChecked?f.scormData[f.constants.RESET_BTN]="enable":f.scormData[f.constants.RESET_BTN]=d?"enable":"disable",f.saveLearnerData(),f.isResetBtnEnabled||f.isResetBtnEnabledChecked||d?f.jObject.find(".start-over").sliderbutton("enable"):f.jObject.find(".start-over").sliderbutton("disable")}}}),i.on("keydown",function(a){$(a.currentTarget).removeClass("miss")}),i.on("keyup",function(e){""===b?(!0!==c.placeholder&&($(e.currentTarget).html("&nbsp;"),a.find("label").text("blank")),$(e.currentTarget).hasClass("required")&&$(e.currentTarget).addClass("miss")):(a.find("label").text(""),a.find(".editableContent").removeAttr("aria-hidden")),d=0===f.jObject.find(".required.miss").length?"enable":"disable",f.jObject.find(".show-solution").sliderbutton(d),f.jObject.find(".chart-it").sliderbutton(d)}),i.on("keyup",function(c){f.isCommEnabled&&!f.isL1Scorm&&(f.scormData[f.constants.RESET_BTN]=f.isResetBtnEnabled?"enable":"disable",f.scormData[f.constants.SOLUTION_BTN]=d,f.scormData[f.constants.CHART_IT_BTN]=d,f.scormData[f.getScormDataId(a.attr("id"))]=b,f.saveLearnerData())}),i.on("paste",function(b){setTimeout(function(){f.scormData[f.getScormDataId(a.attr("id"))]=$(b.currentTarget).text().trim(),f.isDirty=!0},500)}),i.blur(function(e){var h,j="";if(a.removeClass("editableCell-focus"),!(f.jObject.find(".checker").is(":visible")||f.jObject.find(".solution-pop-up").is(":visible")||f.jObject.find(".result-pop-up").is(":visible"))){c=a.data("cell-data");var k=PearsonGL.globals.player&&PearsonGL.globals.player.settings.product;b="psoc3_us"===k?e.currentTarget.outerText:i.text().trim();var l=$(c).text().trim();if(c.header&&""!==c.header&&(g="columnlabel"),b!==l?""===b?f.sendAnalytics("table_deleted"+g):f.sendAnalytics("table_edited"+g):f.sendAnalytics("table_selected"+g),""===b?!0!==c.placeholder&&($(e.currentTarget).html("&nbsp;"),a.find("label").text("blank")):(a.find("label").text(""),a.find(".editableContent").removeAttr("aria-hidden")),b.length>0&&f.validateCellData(a,b)){switch(c.format){case"Percentage":h=PearsonGL.utils.formatNumber(b,c.decimal,c.separator,"",!0);break;case"Number":h=PearsonGL.utils.formatNumber(b,c.decimal,c.separator,"",!1);break;case"Currency":h=PearsonGL.utils.formatNumber(b,c.decimal,c.separator,c.currency,!1);break;case"Date":j=f.getDateTimeFormat(a.data("cell-data")),h=f.formatDate(b,j);break;default:h=b}h!==b&&($(e.currentTarget).text(h),a.find("label").text(h),b=h),$(e.currentTarget).removeClass("miss"),f.hasChanged=!0,f.options.exportData&&f.exportTableData(a,b,j)}else""===b?(!0!==c.placeholder&&($(e.currentTarget).html("&nbsp;"),a.find("label").text("blank")),$(e.currentTarget).hasClass("required")&&$(e.currentTarget).addClass("miss")):$(e.currentTarget).hasClass("required")&&$(e.currentTarget).removeClass("miss");d=0===f.jObject.find(".required.miss").length?"enable":"disable",f.jObject.find(".show-solution").sliderbutton(d),f.jObject.find(".chart-it").sliderbutton(d),f.isCommEnabled&&!f.isL1Scorm&&(f.scormData[f.constants.RESET_BTN]=f.isResetBtnEnabled?"enable":"disable",f.scormData[f.constants.SOLUTION_BTN]=d,f.scormData[f.constants.CHART_IT_BTN]=d,f.scormData[f.getScormDataId(a.attr("id"))]=b,f.saveLearnerData())}}).focus(function(b){a.addClass("editableCell-focus"),PearsonGL.utils.setActiveInputField($(e)),$(window).trigger("inputFocus",{varType:"string"}),f.isTabPressed&&(f.selectAndFocusCellData(i),f.isTabPressed=!1)})),a.keydown(function(a){if(!f.jObject.find(".delete-row").is(":focus"))if(a.keyCode!==PearsonGL.utils.keyCode.enter||a.shiftKey)a.keyCode===PearsonGL.utils.keyCode.right&&a.shiftKey||a.keyCode===PearsonGL.utils.keyCode.left&&a.shiftKey||(a.keyCode==PearsonGL.utils.keyCode.up?PearsonGL.globals.player&&void 0!==PearsonGL.globals.player.PSOCTable&&!0===PearsonGL.globals.player.PSOCTable||(a.preventDefault(),f.findNextUpEditableContent($(a.currentTarget))):a.keyCode===PearsonGL.utils.keyCode.down?PearsonGL.globals.player&&void 0!==PearsonGL.globals.player.PSOCTable&&!0===PearsonGL.globals.player.PSOCTable||(a.preventDefault(),f.findNextDownEditableContent($(a.currentTarget))):a.keyCode===PearsonGL.utils.keyCode.tab&&(f.isTabPressed=!0,f.sendAnalytics("pressed_tab_key")));else if(a.preventDefault(),f.sendAnalytics("pressed_enter_key"),0===$(a.currentTarget).parent("tr").next("tr").length){var b=f.jObject.find("tr:first"),c=b.attr("id").split("_"),d=$(a.currentTarget).data("focus-id").split("_"),e=d[f.constants.CELL_ID_INDEX.col]+"_"+c[0]+"_"+f.randId;f.setFocusOnNextCell(d,e)}else f.findNextDownEditableContent($(a.currentTarget))})}},{key:"_addKeypadValue",value:function(a){var b=this,c=this.jObject.find(".editableCell-focus").find(".editableContent"),d=PearsonGL.utils.getActiveInputField();a.keyVal;if(b.options.mathquillMode){if(!a.keyVal||!d||!b.activeMathQuill||d[0]!==b.activeMathQuill[0])return;return void b.activeMathQuill.data("mathquillObject").onKeypressed(a.keyVal)}if(0==c.length&&this.lastActive?c=this.lastActive:c.length>0&&(this.lastActive=c),a.keyVal&&d&&d[0]===c[0]){var e=(c.text(),"delete"===a.keyVal),f=e?"":a.keyVal,g=window.getSelection(),h=g.rangeCount?g.getRangeAt(0):null;if(h&&(c[0]===h.startContainer||$.contains(c[0],h.startContainer))){if(e)document.execCommand("delete"),c.hasClass("required")&&c.addClass("miss");else if(c.hasClass("placeholder")&&(c.text(""),c.removeClass("placeholder")),document.queryCommandSupported("insertText"))document.execCommand("insertText",!1,f),c.removeClass("miss");else{var i=document.createTextNode(f);h.deleteContents(),h.insertNode(i),h.setEndAfter(i),h.collapse(!1)}btnState=0===b.jObject.find(".required.miss").length?"enable":"disable",b.jObject.find(".show-solution").sliderbutton(btnState),b.jObject.find(".chart-it").sliderbutton(btnState)}}}},{key:"initExportData",value:function(a,b,c){var d,e,f=this.getNormalCellId(a);if(c&&c.length>0&&(b=this.getDateTime(b,c)),this.cellIdToExportData.hasOwnProperty(f))for(d=0;d<this.cellIdToExportData[f].length;d++)e=this.cellIdToExportData[f][d],this.exportData[e][f]=b}},{key:"setGadget",value:function(){var a,b,c="",d=jQuery.extend(!0,{},this.scormData);if(this.scormData.numAddedRows){this.numAddedRows=this.scormData.numAddedRows,this.addedRowIds=this.scormData.addedRowIds,this.nextId=this.scormData.nextId;var e;this.options.table.rows.length;for(e=0;e<this.numAddedRows;e++)this.addRow(this.addedRowIds[e],jQuery.extend(!0,{},this.lastRowData));this.options.maxAddOnRows===this.numAddedRows&&this.jObject.find(".table-add-button").sliderbutton("disable")}this.scormData=d,this.scormData[this.constants.RESET_BTN]&&(this.jObject.find(".start-over").sliderbutton(this.scormData[this.constants.RESET_BTN]),this.isResetBtnEnabled="enable"===this.scormData[this.constants.RESET_BTN]),this.scormData[this.constants.SOLUTION_BTN]&&this.jObject.find(".show-solution").sliderbutton(this.scormData[this.constants.SOLUTION_BTN]),this.scormData[this.constants.CHART_IT_BTN]&&this.jObject.find(".chart-it").sliderbutton(this.scormData[this.constants.CHART_IT_BTN]),this.scormData[this.constants.ADD_BTN]&&this.jObject.find(".table-add-button").sliderbutton(this.scormData[this.constants.ADD_BTN]);for(var c in d)a=this.jObject.find("[id*='"+c+"']"),a.length>0&&(b=$(a).find("div").not(".delete-row"),$(b).parent().hasClass("imageCell")||("true"===$(b).attr("checkable")?$(b).addClass(this.scormData[c]):this.options.mathquillMode?void 0!==$(b)&&$(b).data("mathquillObject").setLatex(this.scormData[c]):$(b).text(this.scormData[c])),$(b).hasClass("required miss")&&this.scormData[c].length>0&&$(b).removeClass("miss"));this.scormData.isLocked&&this.addGlassPanel(),this.saveLearnerData()}},{key:"addGlassPanel",value:function(){this.jObject.find(".editableCell .editableContent").attr("contenteditable",!1).removeClass("editableCell"),this.jObject.addClass("lock-table"),this.glassPanel=$('<div class="glassPanel"></div>'),this.tableArea.prepend(this.glassPanel),this.glassPanel.show()}},{key:"setupChartItButton",value:function(){var a=this.jObject,b=this;b.options.chartIt instanceof Array&&$(b.options.chartIt).each(function(c){b.haschartIt=!0,a.find(".table-footer").append('<div class="chart-it"></div>'),a.find(".chart-it").sliderbutton({buttonClassName:"chart-it-button",slider:!0,buttonText:b.options.chartIt[0].buttonText,clickFunction:function(c){if(!a.find(".modal-dialog-window").is(":visible")&&(a.find(".result-pop-up,.modal-dialog-window").fadeOut(function(){$(this).remove()}),!1===c.jObject.hasClass("base-button-disable")))if(b.options.chartIt[0].confirmText){var d={isModal:!0,noToolTip:b.labelOpts.noToolTip,yesToolTip:b.labelOpts.yesChartItTip,resultsText:PearsonGL.qtiEvaluator.replaceParameters(b.options.chartIt[0].confirmText),dialogType:"confirm",closeToolTip:b.labelOpts.closeToolTip,keyPressEventHandler:function(){b.exportAllData(),a.find(".checker-pop-up,.modal-dialog-window").fadeOut(function(){$(this).remove()})},audioComponent:b.options.chartIt[0].confirmTextAudio?PearsonGL.qtiEvaluator.replaceParameters(b.options.chartIt[0].confirmTextAudio):void 0};d.buttonClassName=c.options.buttonClassName,a.dialogcomponent(d),a.find(".checker-pop-up").fadeIn().focus()}else b.exportAllData()}}),b.isShowSolutionAlways||a.find(".chart-it").sliderbutton("disable"),b.options.scormOn&&!b.isL1Scorm&&(b.scormData[b.constants.CHART_IT_BTN]=b.isShowSolutionAlways?"enable":"disable")})}},{key:"validateMaxChar",value:function(a,b){var c=this;a.on("keydown",function(a){var b=a.currentTarget.textContent;1===b.length&&""===b&&(b=b.replace("",""),a.currentTarget.textContent=b)}).on("keypress",function(a){$(".max-length-found").unwrap().remove();var d=a.currentTarget.textContent;if(b.maxchar>=0&&d.length>b.maxchar-1&&9!==a.keyCode&&16!==a.keyCode&&39!==a.keyCode&&37!==a.keyCode){a.preventDefault(),a.stopPropagation(),c.sendAnalytics("trigger_max_char_count"),a.currentTarget.textContent.length>b.maxchar&&(a.currentTarget.textContent=d.substring(0,b.maxchar));var e=$(a.currentTarget).closest("td");$(a.currentTarget).wrap("<span class='max-len-wrapper'></span>").parent().append('<div tabindex="0" class="max-length-found NO-HIGHLIGHT"><span>'+c.options.exceedMaxLen+'</span><span class="max-length-pointer"></span></div>'),PearsonGL.utils.smartTooltip($(e),$(e).closest(".table-identifier"),$($(e).find(".max-length-found")[0])),window.clearTimeout(c.popuptimeout),c.popuptimeout=window.setTimeout(function(){$(".max-length-found").unwrap().remove()},5e3)}})}},{key:"getRow",value:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=this,p="",j=$("<tr id='"+a+"_"+this.randId+"'></tr>"),q=0;for(g=o.options.cols||b.cols.length,h=0;h<g;h++){i=void 0===b?{editable:!0}:b.cols[h],void 0===i&&(i={editable:!0}),f=!1;do{if(e=this.constants.COL_ID[q]+"_"+a+"_"+this.randId,!($.inArray(e,this.mergeCells)>=0))break;q++,o.options.hasOwnProperty("cols")&&g--,h>=g&&(f=!0)}while(!f);if(f)break;if("row"===i.header||"col"===i.header?(k=$("<th scope='"+i.header+"' id='"+e+"' data-focus-id='"+e+"'></th>"),!0):(k=$("<td id='"+e+"' data-focus-id='"+e+"'></td>"),!1),k.data("cell-data",i),i.rowspan)for(k.attr("rowspan",i.rowspan),k.css("height",1.433*i.rowspan+"em"),c=1;c<i.rowspan;c++)e+=","+this.constants.COL_ID[q]+"_"+(1*a+c)+"_"+this.randId,this.mergeCells.push(this.constants.COL_ID[q]+"_"+(1*a+c)+"_"+this.randId);if(i.colspan){k.attr("colspan",i.colspan);var r;for(c=1;c<i.colspan;c++)r=this.constants.COL_ID[q+c]+"_"+1*a+"_"+this.randId,p+=1===c?r:","+r,e+=","+r,this.mergeCells.push(r),o.options.hasOwnProperty("cols")&&g--;q+=i.colspan}else q++;k.attr("id",e).attr("collspanId",p),d="",i.required&&!0===i.required&&(i.editable=!0,d="required",i.value||(d+=" miss",this.isShowSolutionAlways=!1));var s=null;i.image&&PearsonGL.utils.isNonEmptyString(i.image.src)&&(k.addClass("imageCell"),s=$("<div class='imageContent'></div>"),i.image.audioComponent&&PearsonGL.utils.isNonEmptyString(i.image.audioComponent.src)||(i.image.noTabIndex=!0),s.imagecomponent(i.image),i.image.audioComponent&&PearsonGL.utils.isNonEmptyString(i.image.audioComponent.src)&&(s.find("span").audioComponent(i.image.audioComponent),PearsonGL.utils.isNonEmptyString(i.image.title)&&s.find(".audioCursor").attr("aria-label",i.image.title))),m=i.value?i.value.trim():"",i.displayValue=m,i.value&&""!==m||(i.displayValue="&nbsp;");if(0===m.length&&(m="blank"),n="",!0===i.editable&&""!==i.editable){if("Checkmark"===i.format){var t;t=""===i.groupName||void 0===i.groupName?"checkbox":i.groupName,l=$("<div checkable='true' groupName='"+t+"' checked='false' class='checkableContent'></div>")}else l=$("<div contentEditable='true' checkable='false' class='editableContent "+d+"' ></div>'");(i.maxchar||0===i.maxchar)&&this.validateMaxChar(l,i),i.rowspan&&$(l[0]).addClass("rowspanCell"),k.addClass("editableCell");if("Date"===i.format&&!0===this.options.showPlaceHolder&&(n=o.getDateTimeFormat(i),l.attr("data-ph",n),"blank"===m&&(i.value="",i.displayValue="")),!0===i.placeholder&&PearsonGL.utils.isNonEmptyString(i.value)&&(l.attr("data-ph",$(i.value).text()),i.value="",i.displayValue=""),m="blank"===i.value?"":$(i.value).text().trim(),this.scormData[this.getScormDataId(e)]=m,this.hasEditableCell=!0,$(l[0]).append(i.displayValue),i.audioComponent&&PearsonGL.utils.isNonEmptyString(i.audioComponent.src)){var u=$('<div class="textContainer"></div>');u.audioComponent(i.audioComponent),u.append(l),l=u}s?"top"===i.image.pos?j.append(k.append(s.append(l))):j.append(k.append(s.prepend(l))):j.append(k.append(l)),j.append(k.append(l)),k.on("click",function(a){o.deleteActivated||$(a.currentTarget).find("div[contenteditable='true']").focus(),o.deleteActivated=!1})}else{var u=null;if(i.audioComponent&&PearsonGL.utils.isNonEmptyString(i.audioComponent.src)){var u=$('<div class="textContainer"></div>');u.audioComponent(i.audioComponent),u.append(i.value),l=u}else l=i.value;s?(k.append(s),PearsonGL.utils.isNonEmptyString(i.value)&&("top"===i.image.pos?s.append(l):s.prepend(l)),i.image.longDesc&&o.addLongDescription(s,i.image.longDesc)):k.append(l),j.append(k)}this.options.exportData&&this.initExportData(e,$(i.value).text().trim(),n),this.setCellStyle(k,i),this.setEventHandlers(k)}return j}},{key:"setupComponents",value:function(){var a,b,c=this,d=c.jObject,e=this.options.table;if(this.mqFields=[],this.tableArea=$("<div class='table-area'></div>"),this.table=$("<table class='dataTable'></table>"),this.tableArea.append(this.table),e.border&&this.setCellStyle(this.tableArea,e),this.options.title&&this.options.title.length>0&&this.table.append("<caption>"+this.options.title+"</caption"),void 0!==this.options.minWidth&&this.table.css("min-width",this.options.minWidth+"px"),void 0!==this.options.minHeight&&this.table.css("min-height",this.options.minHeight+"px"),d.append(this.tableArea),e.colwidth&&e.colwidth.length>0){b=$("<colgroup></colgroup>");for(var f=0;f<e.colwidth.length;f++)b.append("<col width='"+e.colwidth[f].width+"%'>");this.table.append(b)}c.options.hasOwnProperty("rows")||(c.options.rows=e.rows.length);var g,h,i=0;for(a=0;a<c.options.rows;a++){i++,g=e.rows[a];for(var j=0;j<g.cols.length;j++)g.cols[j].value&&(g.cols[j].value=PearsonGL.qtiEvaluator.replaceParameters(g.cols[j].value));if(h=this.getRow(i,g),this.table.append(h),a===c.options.rows-1){for(var k=g.cols,l=g.cols.length,j=0;j<l;j++){var m=k[j];if(void 0!==m.value&&-1!==m.value.indexOf("footerEditCell")){g=e.rows[a-1];break}}for(var n="editable",j=0;j<l;j++){var m=k[j];m.hasOwnProperty(n)?m[n]||(g.cols[j][n]=!0):g.cols[j][n]=!0}g.cols.forEach(function(a){void 0!==a.image&&delete a.image}),c.lastRowData=jQuery.extend(!0,{},g);var j;for(j=0;j<c.lastRowData.cols.length;j++)c.lastRowData.cols[j].value=""}}if(this.nextId=i,c.options.mathquillMode&&c.mqFields.length>0)for(var j=0;j<c.mqFields.length;j++){var o=c.mqFields[j],p={};p.onFocus=function(a){c.activeMathQuill=a.jObject,PearsonGL.utils.setActiveInputField(a.jObject),$(window).trigger({type:"inputFocus"}),PearsonGL.utils.isTouch()&&c.sendAnalytics("tapped_screen"),a.jObject.closest("td").addClass("editableCell-focus")},p.onBlur=function(a){a.jObject.closest("td").removeClass("editableCell-focus")},p.hasMaxLengthExceeded=function(a){},p.onChange=function(a){a.jObject.text().trim().length<=1?a.jObject.addClass("miss"):a.jObject.removeClass("miss"),c.jObject.find(".start-over").sliderbutton("enable"),btnState=0===c.jObject.find(".required.miss").length?"enable":"disable",c.jObject.find(".show-solution").sliderbutton(btnState),c.jObject.find(".chart-it").sliderbutton(btnState),c.isCommEnabled&&!c.isL1Scorm&&(c.scormData[c.constants.RESET_BTN]=c.isResetBtnEnabled?"enable":"disable",c.scormData[c.constants.SOLUTION_BTN]=btnState,c.scormData[c.constants.CHART_IT_BTN]=btnState,c.scormData[c.getScormDataId(a.jObject.parent().attr("id"))]=a.getLatex(),c.saveLearnerData())},o.attr({contenteditable:"false",tabindex:"-1"}),o.data("mathquillObject",new PearsonGL.Gadget.ComponentMathquill(o,p))}this.isL1Scorm=!this.hasEditableCell,this.setupAddButton(),d.append('<div class="table-footer"></div>'),this.setupResetButton(),this.setupShowSolutionButton(),this.setupChartItButton(),this.updateFontColor()}},{key:"updateFontColor",value:function(){this.jObject.find(".editableContent").each(function(a,b){if($(b).find("span").css("color")){var c=PearsonGL.utils.rgbColorToHex($(b).find("span").css("color"));$(b).css("color",c)}})}},{key:"setupExportData",value:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=this,o=this.options.exportData,p=function(){n.cellIdToExportData[m]||(n.cellIdToExportData[m]=[]),n.cellIdToExportData[m].push(dataId),n.exportData[dataId]||(n.exportData[dataId]={}),n.exportData[dataId][m]=""};for(a=0;a<o.length;a++)for(k=o[a].data.split(","),dataId=o[a].dataId,b=0;b<k.length;b++)if(k[b].indexOf(":")>-1)for(ranges=k[b].split(":"),f=ranges[1].match(/\d+/),g=$.trim(ranges[0]).match(/^[a-zA-Z]+/)[0].charCodeAt(0),e=ranges[0].match(/\d+/),h=$.trim(ranges[1]).match(/^[a-zA-Z]+/)[0].charCodeAt(0),i=g;i<=h;i++)for(l=String.fromCharCode(i),j=e;j<=f;j++)m=l+"_"+j,p();else c=$.trim(k[b]).match(/^[a-zA-Z]+/),d=k[b].match(/\d+/),m=c+"_"+d,p()}},{key:"addRow",value:function(a,b){var c=this,d=this.jObject,e=c.getRow(a,b);e.addClass("added"),e.find(".checkableContent").each(function(b,d){var e=$(d).attr("groupName");"checkbox"!=e&&"on"!=e&&$(d).attr("groupname",e+"_"+a+"_"+c.randId)});var f=$('<div class="delete-row" data-icon="delete-row" title="'+c.labelOpts.deleteRowToolTip+'" tabindex="0" role="gridcell" aria-labelledby="deleteBtnLabel" />');f.data("rowId",a+"_"+c.randId);var g=e.find("td");if(g.length>0&&(this.options.deleteRowButtonAlignRight?$(g[g.length-1]).append(f):$(g[0]).prepend(f)),f.append('<div id="deleteBtnLabel" style="display:none">'+c.labelOpts.deleteBtnPrefix+"</div>"),f.on("click keypress",function(a){function b(){var a,b=$(e).data("rowId"),d=c.jObject.find("tr[id="+b+"]");d.find("td").each(function(b,d){a=c.getScormDataId($(d).attr("id")),delete c.scormData[a]}),d.remove(),c.numAddedRows--,c.options.maxAddOnRows>c.numAddedRows&&c.jObject.find(".table-add-button").sliderbutton("enable");var f=b.split("_"),g=c.addedRowIds.indexOf(parseInt(f[0],10));g>-1&&c.addedRowIds.splice(g,1),c.saveLearnerData()}if(("click"===a.type||a.keyCode===PearsonGL.utils.keyCode.enter)&&(a.preventDefault(),a.stopPropagation(),!0!==c.solutionActive||!c.hasLockAnswer)){var e=this,f={isModal:!0,resultsText:c.labelOpts.deleteRowConfirmation,dialogType:"confirm",closeToolTip:c.labelOpts.closeToolTip,noToolTip:c.labelOpts.noToolTip,yesToolTip:c.labelOpts.yesToolTip,buttonClassName:"row"};f.keyPressEventHandler=function(){b(),d.find(".checker-pop-up").fadeOut(function(){$(this).remove()})},d.dialogcomponent(f),d.find(".checker-pop-up").fadeIn(500,function(){d.find(".checker-pop-up").focus()}),c.deleteActivated=!0}}),c.options.mathquillMode&&c.mqFields.length>0)for(var h=0;h<c.mqFields.length;h++){var i=c.mqFields[h],j={};j.onFocus=function(a){c.activeMathQuill=a.jObject,PearsonGL.utils.setActiveInputField(a.jObject),$(window).trigger({type:"inputFocus"})},j.onBlur=function(){},j.hasMaxLengthExceeded=function(a){},j.onChange=function(a){},i.attr({contentEditable:"",tabindex:"-1"}),i.data("mathquillObject",new PearsonGL.Gadget.ComponentMathquill(i,j))}c.table.append(e);var k=$(e[0]).find(".editableContent").first();c.options.mathquillMode?k.mousedown().mouseup():k.focus()}},{key:"setupAddButton",value:function(){var a=this.jObject,b=this;if(b.options.maxAddOnRows&&b.options.maxAddOnRows>0){var c=$('<div class="table-add-button"></div>');b.options.showAddRow&&b.options.showAddRow.length>0&&(a.append(c),c.sliderbutton({buttonClassName:"add-row-button",title:b.labelOpts.addButtonText,slider:!0,buttonText:b.options.showAddRow[0].text,clickFunction:function(a){!1!==a.options.enable&&(b.numAddedRows++,b.nextId++,b.addedRowIds.push(b.nextId),b.addRow(b.nextId,jQuery.extend(!0,{},b.lastRowData)),b.saveLearnerData(),b.jObject.find(".start-over").sliderbutton("enable"),b.numAddedRows===b.options.maxAddOnRows&&b.jObject.find(".table-add-button").sliderbutton("disable"))}}))}}},{key:"setupResetButton",value:function(){var a=this.jObject,b=this;this.resetButton=$('<div class="start-over"></div>'),b.options.reset instanceof Array&&$(b.options.reset).each(function(c){a.find(".table-footer").append(b.resetButton),a.find(".start-over").sliderbutton({buttonClassName:"start-over-button",slider:!0,buttonText:b.options.reset[0].buttonText,clickFunction:function(c){if(a.find(".result-pop-up,.modal-dialog-window").fadeOut(function(){$(this).remove()}),!1===c.jObject.hasClass("base-button-disable"))if(b.options.reset[0].confirmText){var d={isModal:!0,buttonClassName:"reset",resultsText:PearsonGL.qtiEvaluator.replaceParameters(b.options.reset[0].confirmText),dialogType:"confirm",closeToolTip:b.labelOpts.closeToolTip,noToolTip:b.labelOpts.noToolTip,yesToolTip:b.labelOpts.yesToolTip};d.keyPressEventHandler=function(){b.resetTableData(),a.find(".checker-pop-up,.modal-dialog-window").fadeOut(function(){$(this).remove()})},b.options.reset[0].confirmTextAudio&&(d.audioComponent=PearsonGL.qtiEvaluator.replaceParameters(b.options.reset[0].confirmTextAudio)),a.dialogcomponent(d),a.find(".checker-pop-up").fadeIn(500,function(){a.find(".checker-pop-up").focus()})}else b.resetTableData()}}),a.find(".start-over").sliderbutton("disable"),b.options.scormOn&&!b.isL1Scorm&&(b.scormData[b.constants.RESET_BTN]="disable")})}},{key:"setupShowSolutionButton",value:function(){if(this.options.showSolution){var a=this.jObject,b=this;b.options.showSolution&&b.options.showSolution.length>0&&b.options.showSolution[0].lockAnswer&&(b.hasLockAnswer=!0),PearsonGL.utils.randomString(8)+PearsonGL.utils.randomString(8),a.find(".table-footer").append('<div class="show-solution"></div>'),this.solution=this.jObject.find(".result-pop-up"),b.options.showSolution instanceof Array&&$(b.options.showSolution).each(function(c){b.hasShowSolution=!0,this.clickFunction=function(c){if(c.options.enable){a.find(".result-pop-up,.modal-dialog-window").fadeOut(function(){$(this).remove()}),b.solution.show(),b.solution.focus(),b.solutionActive=!0,b.hasLockAnswer&&!b.scormData.isLocked&&(b.scormData.isLocked=!0,b.addGlassPanel(),b.jObject.find(".table-add-button").sliderbutton("disable"),b.scormData[b.constants.ADD_BTN]="disable",b.resetButton&&(b.resetButton.sliderbutton("enable"),b.isResetBtnEnabled=!0,b.scormData[b.constants.RESET_BTN]="enable"),b.saveLearnerData());var d=b.options.showSolution[0],e=d.solutionImage||{},f=d.solutionText.audioComponent||{},g=d.solutionText.value,h=PearsonGL.utils.isNonEmptyString(e.src);b.jObject.dialogcomponent({dialogType:h?"animated":"feedback",doAnimate:!1,closeToolTip:b.labelOpts.closeToolTip,resultsText:d.solutionText.value,audioComponent:f,textMessage:{value:g,audioComponent:f},imageComponent:e,dialogHeight:d.dialogHeight,dialogWidth:d.dialogWidth,dialogUnits:"pixels",dialogLayout:d.dialogLayout}),b.sendAnalytics("table_showsolution"),b.hasChanged=!0,a.find(".dialog-box-window, .animated-dialog-box-window").fadeIn().focus(),a.find(".checker").hide()}},this.buttonClassName="show-solution",this.buttonText||(this.buttonText=b.options.showSolution.buttonText),a.find(".show-solution").sliderbutton(this),b.isShowSolutionAlways||a.find(".show-solution").sliderbutton("disable"),b.options.scormOn&&!b.isL1Scorm&&(b.scormData[b.constants.RESET_BTN]=b.isShowSolutionAlways?"enable":"disable")});var c=b.options.showSolution[0];if(c.dialogWidth){var d=(b.table.width()-c.dialogWidth)/2,e=d/b.table.width()*100;this.solution.css("left",e+"%")}}}},{key:"showComfirmResetDlg",value:function(){var a=this.jObject,b=a.children(".checker");a.find(".result-pop-up").fadeOut(),a.find(".modal-dialog-window").hide(),b.fadeIn(),b.focus()}},{key:"showValidationError",value:function(a,b){var c={value:a},d=this.jObject,e=this,f="1234.43122";if(!a||0===a.length){var g=b.data("cell-data");if("Number"===g.format||"Currency"===g.format||"Percentage"===g.format){if(f=g.decimals?parseFloat(f).toFixed(g.decimals):parseFloat(f).toFixed(3),g.separator){var h=f.toString().split(".");h[0]=h[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),f=h.join(".")}"Percentage"===g.format?f+="%":"Currency"===g.format&&g.currency&&(f=g.currency+f)}c.value=PearsonGL.utils.formatString(this.options.validDataSample,f)}var i={isModal:!0,resultsText:c.value,dialogType:"feedback",closeToolTip:e.labelOpts.closeToolTip,noToolTip:e.labelOpts.noToolTip,yesToolTip:e.labelOpts.yesToolTip,keyPressEventHandler:function(){j.remove(),e.selectAndFocusCellData($(b).find("div"))}};d.dialogcomponent(i);var j=d.find(".result-pop-up");j.addClass("dialog-incorrect").fadeIn(),d.find(".modal-dialog-window").show(),j.focus(),$(j).on("closed",function(){j.remove(),d.find(".modal-dialog-window").remove(),e.selectAndFocusCellData($(b).find("div"))})}},{key:"transferLabels",value:function(a){var b=this.options;this.labelOpts=$.extend(this.labelOpts,a),b.resetButtonText=this.labelOpts.resetButtonText,b.chartItButtonText=this.labelOpts.chartItButtonText,b.resetConfirmText=this.labelOpts.resetConfirmText,b.closeToolTip=this.labelOpts.closeToolTip,b.yesToolTip=this.labelOpts.yesToolTip,b.yesChartItTip=this.labelOpts.yesChartItTip,b.noToolTip=this.labelOpts.noToolTip,b.addButtonText=this.labelOpts.addButtonText,b.deleteRowToolTip=this.labelOpts.deleteRowToolTip,b.deleteRowConfirmation=this.labelOpts.deleteRowConfirmation,b.validDataSample=this.labelOpts.validDataSample,b.invalidRange=this.labelOpts.invalidRange,b.numberTooSmall=this.labelOpts.numberTooSmall,b.numberTooBig=this.labelOpts.numberTooBig,b.exceedMaxLen=this.labelOpts.exceedMaxLen,b.invalidDateTimeFormat=this.labelOpts.invalidDateTimeFormat,b.exceedScormDataLimit=this.labelOpts.exceedScormDataLimit}},{key:"sendCumulativeAnalytics",value:function(){var a=0,b=0,c=0;this.jObject.find(".editableContent").each(function(d,e){a++,$(e).text().trim().length>0&&(c+=$(e).text().trim().length,b++)}),this.sendAnalytics("entered_content_"+b+"of"+a+"_cells"),this.sendAnalytics("content_field_character_count",c)}},{key:"validateCellData",value:function(a,b){var c=$(a).data("cell-data");if(!c.format)return!0;if("Date"!==c.format&&"Text"!=c.format){var d=PearsonGL.utils.isNumber(b,c.currency,"Percentage"===c.format);if(!d.isNumber)return this.showValidationError("",a),!1;if(c.hasOwnProperty("minValue")&&c.hasOwnProperty("maxValue")){if(parseFloat(d.value)<parseFloat(c.minValue)||parseFloat(d.value)>parseFloat(c.maxValue))return this.showValidationError(PearsonGL.utils.formatString(this.options.invalidRange,c.minValue,c.maxValue),a),!1}else{if(c.hasOwnProperty("minValue")&&parseFloat(d.value)<parseFloat(c.minValue))return this.showValidationError(PearsonGL.utils.formatString(this.options.numberTooSmall,c.minValue),a),!1;if(c.hasOwnProperty("maxValue")&&parseFloat(d.value)>parseFloat(c.maxValue))return this.showValidationError(PearsonGL.utils.formatString(this.options.numberTooBig,c.maxValue),a),!1}return!0}if("Date"===c.format){var e,f=this.getDateTimeFormat($(a).data("cell-data"));if(f||(f="mm/dd/yy"),!1===this.validateDateFormat(f,b)){var g="<p>"+PearsonGL.utils.formatString(this.options.invalidDateTimeFormat,f)+"</p>",h=f.split(/[\/, -:.]+/);for(e=0;e<h.length;e++)g+="<p>"+this.constants.DATE_FORMAT[h[e]]+"</p>";return this.showValidationError(g,a),!1}return!0}return!0}},{key:"validateDateFormat",value:function(a,b){var c,d,e,f=new Date,g=f.getFullYear(),h=f.getMonth(),i=f.getDate(),j=a.split(/[\/, -.]+/),k=b.split(/[\/, -.]+/),l=this.options.runtimejson.lang;for(c=0;c<k.length;c++)switch(j[c]){case"m":case"mm":if(!$.isNumeric(k[c])||k[c]<1||k[c]>12)return!1;h=1*k[c];break;case"mmm":case"mmmm":for(e=-1,d=0;d<this.monthNames[l].length;d++)if(this.monthNames[l][d].toLowerCase()===k[c].toLowerCase()){e=d;break}if(-1===e){if(Math.floor(k[c])==k[c]&&$.isNumeric(k[c])&&k[c]>=1&&k[c]<=12){h=k[c];break}return!1}h=e>11?(e-12)%12+1:e%12+1;break;case"d":case"dd":if(!$.isNumeric(k[c])||k[c]<1||k[c]>31)return!1;i=1*k[c];break;case"ddd":case"dddd":for(e=-1,d=0;d<this.dayNames[l].length;d++)if(this.dayNames[l][d].toLowerCase()===k[c].toLowerCase()){e=d;break}if(-1===e){if(Math.floor(k[c])==k[c]&&$.isNumeric(k[c])&&k[c]>=0&&k[c]<=6)break;return!1}break;case"yy":if(!k[c].match(/^\d{4}$/)&&!k[c].match(/^\d{2}$/))return!1;g=k[c];break;case"yyyy":if(!k[c].match(/^\d{4}$/))return!1;g=k[c];break;default:for(var m,n=j[c].split(/[: ]+/),o=k[c].split(/[: ]+/),p=0;p<o.length;p++)switch(m=o[p],n[p]){case"h":case"hh":if(!$.isNumeric(m)||isNaN(m)||parseInt(m,10)<1||parseInt(m,10)>12)return!1;break;case"H":case"HH":if(!$.isNumeric(m)||isNaN(m)||parseInt(m,10)<0||parseInt(m,10)>24)return!1;break;case"M":case"MM":case"s":case"ss":case"S":case"SS":if(!$.isNumeric(m)||isNaN(m)||parseInt(m,10)<0||parseInt(m,10)>59)return!1;break;case"t":case"T":case"tt":case"TT":if("A"!==o[p].toUpperCase()&&"P"!==o[p].toUpperCase()&&"AM"!==o[p].toUpperCase()&&"PM"!==o[p].toUpperCase())return!1}}if((4===h||6===h||9===h||11===h)&&31===i)return!1;if(2==h){var q=g%4==0&&g%100!=0||g%400==0;if(i>29||29===i&&!q)return!1}return!0}},{key:"parseLearnerData",value:function(){if(this.isCommEnabled){var a=this.options.scorm.suspendData.data;"object"===(void 0===a?"undefined":_typeof(a))?(this.scormData=a,this.setGadget()):this.isEditable||this.isL1Scorm&&this.saveLearnerData()}}}]),b}(PearsonGL.Gadget.GadgetBase);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.TimedResponse=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return e.options=$.extend(!0,{objectiveDescription:"TimedResponse",gadgetName:"TimedResponse",isModal:!0,isQuestionRandom:!1,isAnswerRandom:!1,startButtonText:"Start",correctAnsAudio:{audioClass:"correct-answer-audio",trigger:!0},incorrectAnsAudio:{audioClass:".incorrect-answer-audio",trigger:!0}},e.options||{}),e.labelOpts={start:"Start",pause:"Pause",resume:"Resume",pauseMessage:"Game is Paused",timer:"Time",points:"Points",timeOver:"Time Over",extendTimeMsg:"Screen reader users press enter to increase the time allowed to complete this activity",seconds:" seconds",pointsEarned:" points earned",correct:"correct",incorrect:"incorrect",removed:"removed"},c?(e.jObject=$(a),e.initialize(),e.addAccessibility(e.jObject),e):_possibleConstructorReturn(e)}return _inherits(b,a),_createClass(b,[{key:"initialize",value:function(){var a=this,b=$.extend({},this.options);this.initGadget(this.options.gadgetName),PearsonGL.utils.getGlobalizedLabel("timedResponse_globalization",function(c){a._transferLabels(c),delete b.scorm,$.extend(a.options,b),a._globalizationComplete()},this.options.runtimejson.lang)}},{key:"_transferLabels",value:function(a){var b=this.options,c=$.extend(!0,this.labelOpts,a);b.start=c.start,b.pause=c.pause,b.resume=c.resume,b.pauseMessage=c.pauseMessage,b.timer=c.timer,b.points=c.points,b.timeOver=c.timeOver,b.extendTimeMsg=c.extendTimeMsg,b.seconds=c.seconds,b.pointsEarned=c.pointsEarned,b.correct=c.correct,b.incorrect=c.incorrect,b.removed=c.removed,$.extend(!0,this.options,b)}},{key:"_globalizationComplete",value:function(){this.quiz=null,this.quizTimer=null,this.currentInterval=0,this.isQuizPaused=!1,this.scoresPerQuestion=[],this.incorrectPerQuestion={},this.clickedWrongAns=[],this.pointsEarned=0,this.maxPoints=0,this.correctAnswer=[{pattern:[]}],this.pauseMessage=!1,this.modalType="",this.displayClock=!0,this.timeInterval,this.timeOnClock,this.globalTime,this.specificTime,this.addDelay=!1,this.delay=1,this.globalPoints,this.specificPoints,this.pointsInterval,this.questionTaken,this.isQuestionSet=!1,this.mapQuestionArray=[],this.correctAnswerId=-1,this.isOptionSet=!1,this.totalOptions=0,this.incorrectOptionsArray=[],this.isFeedbackSet=!1,this.globalOptionsData={},this.mapOptionsArray=[],this.isplayAgainSet=!1,this.isInstructionsSet=!1,this.correctaudio,this.incorrectaudio,this.scormData={},this.noOfTries,this._setUpComponents(),this._setInstructionsPage(),this._setUpEvents(),this.getLearnerData({results:[{correctResponses:[{pattern:"Timed Response Complete"}],learnerResponse:"Timed Response Complete",type:"choice"}]})}},{key:"_setUpComponents",value:function(){var a=this.jObject,b=void 0,c='<div class = "timed-response-identifier"><div class = "scoreboard"><div class = "score" tabindex="0"><div class = "score-text"></div><div class = "points" aria-labelledby="points-label"></div></div><div class = "timer" tabindex="0"><div class = "timer-text"></div><div class = "clock" aria-labelledby="timer-label" aria-hidden="true"></div></div><div class="increase-time" role="button" tabindex="0">'+this.options.extendTimeMsg+'</div><div class = "progress"><div class = "progress-text"></div><progress id="progress-bar" value = "0" min = "0"></progress></div><div class ="pause-resume-button"></div><div class ="resume-button"></div></div><div class = "instruction"><div class = "instruction-text"></div><div class = "start-quiz"></div></div><div class = "question" tabindex="0" aria-labelledby="question-label"><div class = "question-number" aria-hidden="true"></div><div class = "question-text" aria-hidden="true"></div><div class = "question-image" aria-hidden="true"></div></div><div id="question-label" class="question-label hidden-label"></div><div class = "options"></div><div id="points-label" class="points-label hidden-label">0</div><div aria-live="polite"><div id="timer-label" class="timer-label hidden-label"></div></div><div aria-live="polite"><div id="removed-label" class="removed-label hidden-label"></div></div><div aria-live="assertive"><div id="correct-incorrect-label" class="correct-incorrect-label hidden-label"></div></div></div>';for(a.append(c),a.find("#progress-bar").hide(),a.find(".progress-text").hide().attr("tabindex","-1"),b=0;b<this.options.questions.length;b++)this.mapQuestionArray.push(b);this.options.isQuestionRandom&&this.mapQuestionArray.sort(function(){return.5-Math.random()})}},{key:"_setInstructionsPage",value:function(){var a=this.jObject,b=a.find(".options"),c=a.find(".question"),d=a.find(".clock"),e=a.find(".timer-text"),f=a.find(".score-text"),g=a.find(".points"),h=a.find(".instruction-text"),i=a.find(".timed-response-identifier"),j=void 0;this.isInstructionsSet?a.find(".instruction").show():(this.options.instructionButton&&(j=this.options.instructionButton[0])&&(j.text&&h.richtextcomponent(this.createRichTextObj(j.text)),j.audioComponent&&h.find(".gadget-textblock").audioComponent(j.audioComponent)),this.isInstructionsSet=!0),e.html(this.options.timer),f.html(this.options.points),g.html("0"),d.html("0"),c.hide(),b.hide(),i.css("min-height","354px")}},{key:"_clearInstructionsPage",value:function(){this.jObject.find(".instruction").hide()}},{key:"_setQuestionAndOptions",value:function(a){if(null!==a){var b=this,c=void 0,d=!1,e=this.jObject,f=void 0,g=e.find(".question"),h=e.find(".options"),i=void 0,j=e.find(".timed-response-identifier"),k="",l="",m="four-panels";if(this.clickedWrongAns=[],b.incorrectPerQuestion[b.questionTaken]=[],this.globalOptionsData[this.mapQuestionArray[b.questionTaken]]=[],g.find(".question-number").html(this.questionTaken+1+".&nbsp;"),a.showCorrect=!1,a.questionText){var n=a.questionText.value;if(PearsonGL.utils.hasParmContent()&&(n=PearsonGL.qtiEvaluator.replaceParameters(n)),g.find(".question-text").html(n),g.show(),n){var o=n.replace(/_+/g," blank ");e.find(".question-label").html(this.questionTaken+1+o)}}if(e.find("#progress-bar").attr("value",this.questionTaken+1),e.find(".progress-text").html("<span class = 'progress-value'>"+(this.questionTaken+1)+" of "+this.options.questions.length),a.questionImage&&a.questionImage.src&&(f=a.questionImage,e.find(".question-image").imagecomponent(f)),a.options){var p=a.options,q=void 0,r=p.length;for(this.mapOptionsArray=[],this.incorrectOptionsArray=[],c=0;c<r;c++)this.mapOptionsArray[c]=c;for(this.options.isAnswerRandom&&!1===this.isOptionSet&&this.mapOptionsArray.sort(function(){return.5-Math.random()}),this.globalOptionsData[this.mapQuestionArray[b.questionTaken]]=this.mapOptionsArray,r>4&&(m="six-panels"),c=0;c<r;c++)q=this.mapOptionsArray[c],k="",l='<div class ="'+m+" option"+q+'"></div>',h.append(l),p[q].optionText&&p[q].optionText.value&&(k=p[q].optionText.value+"   "),p[q].correct?(this.correctAnswerId=q,this.correctAnswer[0].pattern[b.questionTaken]=this.correctAnswerId):this.incorrectOptionsArray.push(q),this.totalOptions++,i=e.find(".option"+q),void 0,i.sliderbutton({buttonClassName:"answer",buttonText:k,id:q,clickFunction:function(c){var f=c.options.id,g=void 0,h=e.find(".option"+f),i=b.incorrectOptionsArray,j=e.find(".correct-incorrect-label");c.options.enable&&(f===b.correctAnswerId?(e.find(".answer").addClass("base-button-disable"),h.addClass("correct"),j.html(b.options.correct),b.options.correctAnsAudio.src&&b.correctaudio.audioComponent("play"),b._updateScore(),b.addDelay=!0,b.displayClock=!1,b.correctAnswerId=-1,b.quiz,d=!0):f!==b.correctAnswerId&&-1!==$.inArray(f,i)&&!1===d&&(j.html(b.options.incorrect),b.options.incorrectAnsAudio.src&&b.incorrectaudio.audioComponent("play"),i.length>0&&i.splice($.inArray(f,i),1),0===i.length&&(e.find(".option"+b.correctAnswerId).addClass("show-correct"),a.showCorrect=!0,b.addDelay=!0,b._updateScore()),b.currentInterval++,h.removeClass("base-button-over"),h.addClass("incorrect").delay(500).animate({opacity:0},750).attr({tabindex:"-1","aria-hidden":!0}),h.find(".base-button-inside-wrap").attr({tabindex:"-1","aria-hidden":!0}),b.clickedWrongAns.push(f),g=b.mapOptionsArray.indexOf(f),b.incorrectPerQuestion[b.questionTaken].push(g)))}}),p[q].optionImage&&p[q].optionImage.src&&(optionImg=p[q].optionImage,i.find(".base-button-inside-wrap .button-text").imagecomponent(optionImg),k&&(i.find(".base-button-inside-wrap .button-text p").addClass("image-text").find(".image-class-wrapper").attr("tabindex","-1"),i.find(".base-button-inside-wrap").find(".image-class-wrapper").attr("tabindex","-1"))),i.show();h.show(),PearsonGL.utils.initMathJax(e[0]),j.css("min-height",j.height()),r>2&&r<=4&&j.css("min-height","464px"),2==r&&j.css("min-height","342px")}this.maxPoints+=parseInt(this.pointsInterval[0],10),this.isQuestionSet=!0,this.isOptionSet=!0}}},{key:"_updateScore",value:function(){var a=void 0,b=void 0,c=this.jObject;this.scoresPerQuestion[this.questionTaken]||(a=this.pointsInterval.length-(this.incorrectOptionsArray.length+1),b=parseInt(this.pointsInterval[a],10),this.pointsEarned+=b,c.find(".points").html(this.pointsEarned),this.scoresPerQuestion[this.questionTaken]=b),this.isCommEnabled()&&this._saveScormData()}},{key:"_removeIncorrectOption",value:function(){var a=this.jObject,b=0,c={};this.incorrectOptionsArray=PearsonGL.utils.shuffleArray(this.incorrectOptionsArray),this.incorrectOptionsArray.length>0&&(c=a.find(".option"+this.incorrectOptionsArray[b]),c.animate({opacity:0},750),c.sliderbutton("disable"),this.incorrectOptionsArray.splice(b,1),c.find(".image-class").attr("title")?a.find(".removed-label").html(c.find(".image-class").attr("title")+" "+this.options.removed):a.find(".removed-label").html(c.text()+" "+this.options.removed)),0===this.incorrectOptionsArray.length&&(this.addDelay=!0)}},{key:"_removeQuestionAndOptions",value:function(){var a=this.jObject,b=void 0,c=a.find(".question-image .image-class"),d=a.find(".question");for(c&&c.remove(),d.find(".question-number").html(""),d.find(".question-text").html(""),d.hide(),b=0;b<this.totalOptions;b++)a.find(".option"+b).remove();this.totalOptions=0,this.correctAnswerId=-1}},{key:"_hideQuesAndOptions",value:function(){var a=this.jObject,b=void 0,c=a.find(".question"),d=a.find(".options");d.hide(),c.hide(),d.addClass("remove-options"),a.find(".answer").sliderbutton("disable"),this.pauseMessage?a.find(".pause-message").show():(this.options.pauseMessage&&(b='<div class="pause-message"></div>',a.find(".timed-response-identifier").append(b),a.find(".pause-message").richtextcomponent(this.createRichTextObj(this.options.pauseMessage))),this.pauseMessage=!0)}},{key:"_showQuesAndOptions",value:function(){var a=this.jObject,b=a.find(".question"),c=a.find(".options");c.removeClass("remove-options"),a.find(".pause-message").hide(),c.show(),b.show(),a.find(".answer").sliderbutton("enable")}},{key:"_setUpQuiz",value:function(){var a=this,b=this.jObject,c=null,d=b.find(".timer-label"),e=b.find(".points-label");b.find(".question");if(this.options.questions){c=this.options.questions;var f=c.length-1,g=b.find(".clock"),h=b.find(".options");this.options.correctAnsAudio&&this.options.correctAnsAudio.src&&""!==this.options.correctAnsAudio.src&&(this.options.correctAnsAudio.runtimejson=this.options.runtimejson,this.correctaudio=$("<div class='"+this.options.correctAnsAudio.audioClass+"'></div>"),b.append(this.correctaudio),this.correctaudio.audioComponent(this.options.correctAnsAudio)),this.options.incorrectAnsAudio&&this.options.incorrectAnsAudio.src&&""!==this.options.incorrectAnsAudio.src&&(this.options.incorrectAnsAudio.runtimejson=this.options.runtimejson,this.incorrectaudio=$("<div class='"+this.options.incorrectAnsAudio.audioClass+"'></div>"),b.append(this.incorrectaudio),this.incorrectaudio.audioComponent(this.options.incorrectAnsAudio)),this.noOfTries||(this.noOfTries=1,this.isCommEnabled()&&(this.noOfTries&&(this.scormData.noOfTries=this.noOfTries),this.options.scorm&&this.options.scorm.suspendData&&(this.options.scorm.suspendData.data=this.scormData,this.saveLearnerData()))),this.isCommEnabled()&&this._saveScormData(),this.options.progressBar&&(b.find("#progress-bar").show(),b.find(".progress-text").show().attr("tabindex","0"),b.find("#progress-bar").attr("max",this.options.questions.length)),this.questionTaken||(this.questionTaken=0),this.options.delay&&(this.delay=parseInt(this.options.delay)),this.timeOnClock||this._updateClockAndIntervals(c),d.html(a.timeOnClock-1+this.options.seconds),e.html(this.pointsEarned+this.options.pointsEarned),this.quiz=function i(j){a.quizTimer=setTimeout(function(){h.hasClass("remove-options")&&(a._showQuesAndOptions(),j++),a.timeOnClock=--j,a.displayClock&&a.timeOnClock>=0&&g.html(a.timeOnClock),a.isQuestionSet||a.isOptionSet||a._setQuestionAndOptions(c[a.mapQuestionArray[a.questionTaken]]),a.timeInterval[a.currentInterval]&&a.timeOnClock===parseInt(a.timeInterval[a.currentInterval],10)&&a.displayClock&&(a._removeIncorrectOption(),d.html(a.timeOnClock+a.options.seconds),e.html(a.pointsEarned+a.options.pointsEarned),c[a.mapQuestionArray[a.questionTaken]].showCorrect=!1,0!==a.timeOnClock&&0!==a.incorrectOptionsArray.length||(a.addDelay=!0,b.find(".option"+a.correctAnswerId).removeClass("base-button-over").addClass("show-correct"),c[a.mapQuestionArray[a.questionTaken]].showCorrect=!0,a._updateScore()),a.currentInterval++),a.addDelay&&(a.timeOnClock=parseInt(a.delay,10),a.displayClock=!1,a.addDelay=!1),a.timeOnClock>0?i(a.timeOnClock):(a.timeOnClock=0,a.currentInterval=0,g.html(" "),a.isQuestionSet=!1,a.isOptionSet=!1,a.questionTaken<f?(a.questionTaken++,a._updateClockAndIntervals(c),a._removeQuestionAndOptions(),i(a.timeOnClock),d.html(a.timeOnClock-1+" seconds"),b.find(".timer").focus()):(a._removeQuestionAndOptions(),a._enhancedFeedbackMsg()))},1e3)}(a.timeOnClock)}}},{key:"_updateClockAndIntervals",value:function(a){var b=1,c=void 0,d=void 0;if(this.addDelay=!1,this.displayClock=!0,this.questionTaken,!this.timeInterval&&this.options.globalTimeOnClock&&""!==this.options.globalTimeOnClock){if(this.globalTime=this.options.globalTimeOnClock.split(","),this.increaseTime)for(d=0;d<this.globalTime.length;d++)this.globalTime[d]=3*this.globalTime[d];this.timeInterval=this.globalTime}this.pointsInterval||this.options.globalPointsAwarded&&""!==this.options.globalPointsAwarded&&(this.globalPoints=this.options.globalPointsAwarded.split(","),this.pointsInterval=this.globalPoints),a[this.mapQuestionArray[this.questionTaken]].specific?(c=a[this.mapQuestionArray[this.questionTaken]].specific[0].timeOnClock)&&""!==c&&(this.specificTime=c.split(","),this.timeInterval=this.specificTime):this.timeInterval=this.globalTime,this.timeOnClock=parseInt(this.timeInterval[this.currentInterval],10)+parseInt(b,10),a[this.mapQuestionArray[this.questionTaken]].specific?(c=a[this.mapQuestionArray[this.questionTaken]].specific[0].pointsAwarded)&&""!==c&&(this.specificPoints=c.split(","),this.pointsInterval=this.specificPoints):this.pointsInterval=this.globalPoints,this.currentInterval++}},{key:"_feedbackMsg",value:function(){var a=this,b=this.jObject,c=void 0,d=void 0,e=void 0,f=void 0,g=b.find(".pause-resume-button"),h=b.find(".clock"),i=b.find(".start-quiz");if(b.find(".timed-response-identifier").css("min-height","354px"),this.isFeedbackSet||(c='<div class ="feedback"><div class = "feedback-msg"></div><div class = "play-again"></div></div>',b.find(".timed-response-identifier").append(c)),e=b.find(".feedback-msg"),f=b.find(".play-again"),e.show(),h.html(this.options.timeOver),b.find(".options").hide(),g.hide(),this.options.endActivityMsg){var j=this.options.endActivityMsg;PearsonGL.utils.hasParmContent()&&(j=PearsonGL.qtiEvaluator.replaceParameters(j)),d=this.stripHTML(j),d=d.replace(/\XX/g,this.pointsEarned),d=d.replace(/\YY/g,this.maxPoints)}else d="You have scored "+this.pointsEarned+" out of  "+this.maxPoints;this.isFeedbackSet?b.find(".feedback-msg .text-audio-component").html(d):(d&&e.richtextcomponent(this.createRichTextObj(d)),this.options.feedbackAudio&&e.find(".gadget-textblock").audioComponent(this.options.feedbackAudio)),this.options.playAgain&&(this.isplayAgainSet?f.show():(this.isplayAgainSet=!0,f.sliderbutton({buttonClassName:"play-again-button",buttonText:a.options.playAgain[0].text,clickFunction:function(){e.hide(),a._resetQuiz(),a._setInstructionsPage(),i.show(),f.hide(),a.options.correct_first_attempt++}}))),this.isFeedbackSet=!0,this.noOfTries++,this._saveScormData()}},{key:"_enhancedFeedbackMsg",value:function(){var a=this,b=this.jObject,c=void 0,d=void 0,e=null,f=null,g=null,h=null,i=void 0,j=void 0,k=void 0,l=void 0,m=b.find(".start-quiz"),n=b.find(".timed-response-identifier"),o=(b.find(".summary"),b.find(".scoreboard")),p=void 0;if(b.find(".options").hide(),o.hide(),this.sendAnalytics("clicked_all_questions"),this.isFeedbackSet||(c='<div class = "feedback-scoreboard"></div>',n.prepend(c),c='<div class ="feedback"><div class = "feedback-msg"></div><div class = "play-again"></div></div>',b.find(".feedback-scoreboard").append(c)),p=b.find(".feedback-scoreboard"),k=b.find(".feedback-msg"),l=b.find(".play-again"),this.options.endActivityMsg){var q=this.options.endActivityMsg;PearsonGL.utils.hasParmContent()&&(q=PearsonGL.qtiEvaluator.replaceParameters(q)),j=q,j=j.replace(/\XX/g,"<span class = 'result-text'>"+this.pointsEarned+"</span>"),j=j.replace(/\YY/g,"<span class = 'result-text'>"+this.maxPoints+"</span>")}else j="You have scored <span class = 'result-text'>"+this.pointsEarned+"</span> out of <span class = 'result-text'> "+this.maxPoints+"</span>";if(this.pointsEarned==this.maxPoints&&1==this.options.correct_first_attempt&&this.sendAnalytics("correct_first_attempt"),this.isFeedbackSet?b.find(".feedback-msg .text-audio-component").html(j):(j&&k.richtextcomponent(this.createRichTextObj(j)),this.options.feedbackAudio&&k.find(".gadget-textblock").audioComponent(this.options.feedbackAudio)),this.options.playAgain&&(this.isplayAgainSet?l.show():(this.isplayAgainSet=!0,l.sliderbutton({buttonClassName:"play-again-button",buttonText:a.options.playAgain[0].text,clickFunction:function(){k.hide(),a._resetQuiz(),a._setInstructionsPage(),m.show(),l.hide(),o.show(),b.find(".summary").remove(),b.find(".questions-options").remove(),b.find(".pause-resume-button").hide(),p.hide(),a.options.correct_first_attempt++}}))),this.options.questions)for(n.append('<div class = "summary" tabindex="0"></div>'),e=this.options.questions,d=0;d<e.length;d++){var r=e[this.mapQuestionArray[d]],s=void 0;if(r.questionText){var q=r.questionText.value;PearsonGL.utils.hasParmContent()&&(q=PearsonGL.qtiEvaluator.replaceParameters(q)),s=q||"",c='<div class = "questions-options'+d+'" tabindex="0"><div class = "question" aria-labelledby="summary-question-label'+d+'"><span class = "question-number" aria-hidden="true">'+(d+1)+'.&nbsp;</span> <div class = "question-text" aria-hidden="true">'+s+"</div></div></div>",b.find(".summary").append(c),b.find(".summary").append('<div id="summary-question-label'+d+'" class="question-label hidden-label" aria-hidden="true"></div>'),b.find("#summary-question-label"+d).html(d+1+". "+s.replace(/_+/g," blank "))}if(r.questionImage&&r.questionImage.src&&(c='<div class = "question-image"></div>',b.find(".questions-options"+d+" .question").append(c),b.find(".questions-options"+d+" .question-image").imagecomponent(r.questionImage)),r.options)for(f=r.options,g=f.length,h=g>=5||3===g?"six-panels":"four-panels",i=0;i<g;i++){var t=this.globalOptionsData[this.mapQuestionArray[d]][i],u=f[t],v=void 0;c='<div class ="'+h+" option"+i+'"></div>',b.find(".questions-options"+d).append(c),v=b.find(".questions-options"+d+" .option"+i),u.optionText.value&&(c='<div class = "option-text" tabindex="0"> '+u.optionText.value+"</div>",v.append(c)),u.optionImage&&u.optionImage.src&&(c='<div class = "option-image" tabindex="0"></div>',v.append(c),v.find(".option-image").imagecomponent(u.optionImage),u.optionText?v.find(".option-text").css({position:"relative",left:"-10%",float:"left","margin-left":"43%",width:"0"}):"six-panels"===h?v.find(".option-image").css("left","11%"):"four-panels"===h&&v.find(".option-image").css("left","22%")),u.correct&&(r.showCorrect?v.addClass("show-correct"):v.addClass("correct"),v.append('<div tabindex="0" class="hidden-label">'+this.options.correct+"</div>")),this.incorrectPerQuestion[d].indexOf(i)>-1&&(v.addClass("incorrect"),v.append('<div tabindex="0" class="hidden-label">'+this.options.incorrect+"</div>"))}}k.show(),p.show(),b.find(".summary").show(),PearsonGL.utils.initMathJax([k[0],p[0],b.find(".summary")[0]]),this.isFeedbackSet=!0,this.noOfTries++}},{key:"_resetQuiz",value:function(){var a=this.jObject;this.quiz=null,this.quizTimer=null,this.currentInterval=0,this.displayClock=!0,this.timeInterval=void 0,this.timeOnClock=void 0,this.globalTime=void 0,this.specificTime=void 0,this.addDelay=!1,this.globalPoints=void 0,this.specificPoints=void 0,this.pointsInterval=void 0,this.scoresPerQuestion=[],this.pointsEarned=0,this.maxPoints=0,this.questionTaken=void 0,this.isQuestionSet=!1,this.correctAnswerId=-1,this.isOptionSet=!1,this.totalOptions=0,this.incorrectOptionsArray=[],this.scormData={},a.find("#progress-bar").attr("value",0).hide(),a.find(".progress-text").html("").hide().attr("tabindex","-1")}},{key:"_setUpEvents",value:function(){var a=this,b=this.jObject,c=b.find(".start-quiz"),d=b.find(".pause-resume-button"),e=b.find(".resume-button"),f=void 0,g=1;d.addClass("resumed-state"),d.hide(),e.hide(),this.options.startButtonText&&(this.options.start=this.options.startButtonText),c.sliderbutton({buttonClassName:"start-button",buttonText:a.options.start,clickFunction:function(){a._startButtonClicked()}}),a.options.button&&(f=a.options.button[0],a.modalType=f.modalType,a.options.pause=f.pauseText,a.options.resume=f.resumeText,a.options.pauseMessage=f.pauseMessage,d.sliderbutton({buttonClassName:"pause-resume-button",buttonText:a.options.pause,clickFunction:function(){!1===a.isQuizPaused&&a._pause()}}),e.sliderbutton({buttonClassName:"resume-button",buttonText:a.options.resume,clickFunction:function(){d.show(),e.hide(),!0===a.isQuizPaused&&a._resume()}})),$(window).blur(function(){!a.isQuizPaused&&d.is(":visible")&&(g=0)}),b.find(".increase-time").click(function(b){a.increaseTime=!0,$(b.currentTarget).remove(),$(".instruction-text").find(".gadget-textblock").focus()})}},{key:"_pause",value:function(){var a=this.jObject,b=a.find(".pause-resume-button"),c=a.find(".resume-button"),d=a.find(".timed-response-identifier");this.scormData.pauseClicked=!0,b.hide(),c.show(),this._hideQuesAndOptions(),clearTimeout(this.quizTimer),b.addClass("paused-state"),b.removeClass("resumed-state"),this.isQuizPaused=!0,d.append('<div class = "modal"></div>'),"full"===this.modalType?(c.addClass("full-modal-pause-resume-button"),a.find(".pause-message").addClass("full-modal-pause-message"),d.find(".modal").addClass("full-modal")):"gadget"===this.modalType&&(c.addClass("gadget-modal-pause-resume-button"),d.position(),d.height()+1+"px",d.width()),this.sendAnalytics("clicked_pause_button"),PearsonGL.utils.initMathJax([c[0],a.find(".pause-message")[0]])}},{key:"_resume",value:function(){var a=this.jObject,b=a.find(".pause-resume-button"),c=a.find(".resume-button"),d=a.find(".pause-message");this.scormData.pauseClicked=!1,d.hide(),PearsonGL.utils.initMathJax(b[0]),b.removeClass("paused-state"),b.addClass("resumed-state"),"full"===this.modalType?(c.removeClass("full-modal-pause-resume-button"),d.removeClass("full-modal-pause-message")):"gadget"===this.modalType&&c.removeClass("gadget-modal-pause-resume-button"),this.isQuizPaused=!1,this._setUpQuiz(),a.find(".modal").remove()}},{key:"_startButtonClicked",value:function(){var a=this.jObject,b=a.find(".start-quiz"),c=a.find(".pause-resume-button");b.hide(),this._clearInstructionsPage(),this._setUpQuiz(),c.show(),a.find(".increase-time").remove()}},{key:"_saveScormData",value:function(){this.isCommEnabled()&&(void 0!==this.noOfTries&&(this.scormData.noOfTries=this.noOfTries),this.mapQuestionArray&&(this.scormData.mapQuestionArray=this.mapQuestionArray),void 0!==this.pointsEarned&&(this.scormData.pointsEarned=this.pointsEarned),void 0!==this.questionTaken&&(this.scormData.questionTaken=this.questionTaken),void 0!==this.maxPoints&&(this.scormData.maxPoints=this.maxPoints),this.globalOptionsData&&(this.scormData.globalOptionsData=this.globalOptionsData),this.incorrectPerQuestion&&(this.scormData.incorrectPerQuestion=this.incorrectPerQuestion),this.options.scorm&&this.options.scorm.suspendData&&(this.options.scorm.suspendData.data=this.scormData,this.saveLearnerData()))}},{key:"_setGadget",value:function(){var a=this.jObject,b=0,c=0,d=0,e=[];this.options.scorm.interactions&&this.options.scorm.interactions.length>0&&(this.noOfTries=this.scormData.noOfTries,void 0!==this.noOfTries&&(void 0!==this.scormData.questionTaken&&(b=this.scormData.pauseClicked?this.scormData.presentQuestion-1:0),void 0!==this.scormData.pointsEarned&&(c=this.scormData.pauseClicked?this.scormData.pointsEarned:0),void 0!==this.scormData.maxPoints&&(d=this.scormData.maxPoints),this.scormData.mapQuestionArray&&(e=this.scormData.mapQuestionArray),this.timeOnClock=void 0,this.currentInterval=0,this.pointsEarned=c,this.maxPoints=d,a.find(".points").html(this.pointsEarned),this.globalOptionsData=this.scormData.globalOptionsData,this.incorrectPerQuestion=this.scormData.incorrectPerQuestion,b<e.length&&this.scormData.presentQuestion!==e.length?(this.questionTaken=b,this.mapQuestionArray=e,this._startButtonClicked(),this.options.button&&(this.timeOnClock=this.timeOnClock-1,this._pause())):(this._clearInstructionsPage(),this._enhancedFeedbackMsg())))}},{key:"parseLearnerData",value:function(){if(this.isCommEnabled()){var a=this.options.scorm.suspendData.data;"object"===(void 0===a?"undefined":_typeof(a))&&(this.scormData=a,this._setGadget())}}},{key:"saveLearnerData",value:function(){if(this.isCommEnabled()){var a=0;Array.isArray(this.options.scorm.interactions[0].objectives[0])&&this.options.scorm.interactions[0].objectives[0].length>0&&this.options.scorm.interactions[0].objectives[0].score&&(a=this.scoreResult);var b={},c=0,d=1,e=0,f=0,g=[],h="incomplete",i="failed";b.min=this.options.scorm.interactions[0].objectives[0].score.min,b.max=this.options.scorm.interactions[0].objectives[0].score.max,this.options.scorm&&this.options.scorm.interactions&&this.options.scorm.interactions[0]&&this.options.scorm.interactions[0].objectives[0].completionThreshold&&(d=this.options.scorm.interactions[0].objectives[0].completionThreshold);try{void 0!==this.questionTaken&&(f=this.questionTaken+1),this.mapQuestionArray&&(g=this.mapQuestionArray),void 0!==this.scormData.questionTaken&&(e=this.scormData.questionTaken+1),this.scormData.pauseClicked||(this.scormData.pauseClicked=!1),this.scormData.presentQuestion=f,e>=g.length&&(b.max-b.min!=0?(b.scaled=(b.max-b.min)*(this.pointsEarned/this.maxPoints),b.scaled=isNaN(b.scaled)?0:b.scaled):b.scaled=1,a=b.scaled/b.max,c=b.scaled,e/g.length>=d&&(h="completed",i="passed"))}catch(a){}this.setLearnerData({results:[{learnerResponse:"Completed Timed Response",raw:c,progressMeasure:1,result:a,completionStatus:h,successStatus:i}]})}}},{key:"gadgetUnload",value:function(){this.isCommEnabled()&&this.saveLearnerData()}}]),b}(PearsonGL.Gadget.GadgetBase);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.PearsonGL=window.PearsonGL||{},window.PearsonGL.Gadget=window.PearsonGL.Gadget||{},PearsonGL.Gadget.Stopwatch=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return c&&a?(e.labelOpts={startText:"Start",startMenuText:"The stopwatch above will keep your time. When you are ready, press the Start button.",pauseText:"Pause",pauseMenuText:"Your Stopwatch is paused. Press the Resume button to continue.",resumeText:"Resume",bestTimeText:"Your Best Time"},e.options=$.extend(!0,{gadgetName:"Stopwatch",objectiveDescription:"Keeps track of time for a particular activity"},e.options||{}),e.options?(e.jObject=$(a),e.jObject.data("gadget_options",e.options),e.jObject.addClass("stopwatch-identifier"),e.initGadget(e.options.gadgetName),PearsonGL.utils.getGlobalizedLabel("stopwatch_globalization",function(a){$.extend(e.labelOpts,a),delete c.scorm,$.extend(!0,e.options,c),a&&e.transferLabels(),e.buildDom(),e.getLearnerData({type:"matching"})},e.options.runtimejson.lang),e):_possibleConstructorReturn(e)):_possibleConstructorReturn(e)}return _inherits(b,a),_createClass(b,[{key:"transferLabels",value:function(){this.labelOpts.startText=PearsonGL.utils.isNonEmptyString(this.options.startText)?this.options.startText:this.labelOpts.start,this.labelOpts.pauseText=PearsonGL.utils.isNonEmptyString(this.options.pauseText)?this.options.pauseText:this.labelOpts.pause,this.labelOpts.resumeText=PearsonGL.utils.isNonEmptyString(this.options.resumeText)?this.options.resumeText:this.labelOpts.resume,this.labelOpts.bestTimeText=PearsonGL.utils.isNonEmptyString(this.options.bestTimeText)?this.options.bestTimeText:this.labelOpts.best}},{key:"buildDom",value:function(){var a=this,b=a.jObject,c=void 0;a.minutes=0,a.seconds=0,a.timer,a.pauseCount=0,a.startTime=0,a.startClicked=!1,$('<div class="stopwatch-container"><div class="stopwatch-inner-container"><div class = "clock" aria-labelledby="timer-label"><p></p></div><div class="stopwatch-pause-button"></div><div class="stopwatch-resume-button"></div></div><div class="stopwatch-best-time"><p></p></div></div>').appendTo(this.jObject),a.stopwatchStatusLive=$('<div aria-live="assertive" class="hidden-label"></div>'),b.append(a.stopwatchStatusLive),$(window).on(a.options.associatedGadgetId+"stopwatchScoreCheck",function(b,c){a.options.scorm={},c.options.scorm.interactions.length&&(c.options.scorm&&c.options.scorm.suspendData&&c.options.scorm.suspendData.data&&c.options.scorm.suspendData.data.stopwatch?(a.options.scorm.suspendData={},a.options.scorm.suspendData.data=c.options.scorm.suspendData.data.stopwatch,a.shortTime=a.options.scorm.suspendData.data.shortTime):(a.options.scorm.suspendData={},a.options.scorm.suspendData.data={},a.startClicked=!0,a.saveLearnerData(),a.options.scorm.suspendData.data.startClicked=!1,a.startClicked=!1))}),setTimeout(function(){$(window).trigger(a.options.associatedGadgetId+"stopwatchStartPage",a)},100),a.reset=!1,b.find(".clock p").text("0"+a.minutes+":0"+a.seconds),b.find(".stopwatch-pause-button").sliderbutton({buttonClassName:"stopwatch-pause-button",slider:!0,buttonText:this.labelOpts.pauseText,clickFunction:function(b){var c=Date.now();a.pauseCount=a.pauseCount+1,a.sendAnalytics("clicked_pause"),a.sendAnalytics("clicked_pause_count_"+a.pauseCount),a.pauseTimer=setInterval(function(){var b=Date.now()-c;a.pauseSeconds=b/1e3%60,a.pauseSeconds=""+(0|a.pauseSeconds)},1e3),a.setStopwatchStatusLive("stopwatch paused"),b.options.enable&&$(window).trigger(a.options.associatedGadgetId+"stopwatchPausePage","pause")}}),b.find(".stopwatch-pause-button").sliderbutton("disable"),b.find(".stopwatch-pause-button").children().children().focus(function(b){a.setStopwatchStatusLive("pause button, pauses stopwatch time")}),c=a.options.hasOwnProperty("resumeButtonMessageText")&&a.options.resumeButtonMessageText[0].hasOwnProperty("resumeButtonList")?a.options.resumeButtonMessageText[0].resumeButtonList[0].resumeButton:a.labelOpts.resumeText,b.find(".stopwatch-best-time").hide(),b.find(".stopwatch-resume-button").sliderbutton({buttonClassName:"stopwatch-resume-button",slider:!0,buttonText:c,clickFunction:function(c){a.sendAnalytics("clicked_resume"),a.sendAnalytics("clicked_resume_count_"+a.pauseCount),clearInterval(a.pauseTimer),a.sendAnalytics("activity_paused_duration",a.pauseSeconds),a.setStopwatchStatusLive("stopwatch resumed"),$(window).trigger(a.options.associatedGadgetId+"resumeClock","resumeClock"),b.find(".stopwatch-resume-button").hide(),b.find(".stopwatch-pause-button").show(),a.startClicked=!0,a.startClock()}}),b.find(".stopwatch-resume-button").hide(),b.find(".stopwatch-resume-button").children().children().focus(function(b){a.setStopwatchStatusLive("resume button, resumes stopwatch time")}),$(window).on(a.options.associatedGadgetId+"stopwatchStartClock",function(b,c){a.startClicked=!0,a.reset?a.startClock(1):a.startClock()}),a.pauseClock()}},{key:"setStopwatchStatusLive",value:function(a){this.stopwatchStatusLive.html(a)}},{key:"startClock",value:function(a){var b=this,c=b.jObject,d=(parseInt(b.minutes),parseInt(b.seconds),Date.now());a&&0,setTimeout(function(){c.find(".stopwatch-pause-button").sliderbutton("enable")},500),c.find(".stopwatch-best-time").hide(),b.timer=setInterval(function(){var a=Date.now()-d+b.startTime;b.currentTime=a/1e3,seconds=a/1e3%60,minutes=a/6e4%60,seconds=""+(0|seconds),minutes=""+(0|minutes),seconds%10==0&&(minutes>=2?b.setStopwatchStatusLive(minutes+"minutes and"+seconds+"seconds"):b.setStopwatchStatusLive(minutes+"minute and"+seconds+"seconds")),seconds.length<2&&(seconds="0"+seconds),minutes.length<2&&(minutes="0"+minutes),b.minutes=minutes,b.seconds=seconds,c.find(".clock p").text(minutes+":"+seconds)},1e3)}},{key:"pauseClock",value:function(){var a=this,b=a.jObject;$(window).on(a.options.associatedGadgetId+"pauseClock",function(c,d){void 0!==a.currentTime?a.startTime=1e3*a.currentTime:a.startTime=1e3*d.scorm.suspendData.data.currentTime,clearInterval(a.timer),a.options.scorm.hasOwnProperty("suspendData")?a.options.scorm.suspendData.hasOwnProperty("data")&&a.options.scorm.suspendData.data&&0!==a.options.scorm.suspendData.data.prevBestSeconds&&("pause"===d?b.find(".clock p").text(a.minutes+":"+a.seconds):(b.find(".clock p").text(d.scorm.suspendData.data.previousMinutes+":"+d.scorm.suspendData.data.previousSeconds),a.minutes=d.scorm.suspendData.data.previousMinutes,a.seconds=d.scorm.suspendData.data.previousSeconds)):"pause"===d?b.find(".clock p").text(a.minutes+":"+a.seconds):(b.find(".clock p").text(d.scorm.suspendData.data.previousMinutes+":"+d.scorm.suspendData.data.previousSeconds),a.minutes=d.scorm.suspendData.data.previousMinutes,a.seconds=d.scorm.suspendData.data.previousSeconds),b.find(".stopwatch-resume-button").show(),b.find(".stopwatch-pause-button").hide()}),a.stopClock()}},{key:"stopClock",value:function(){var a=this,b=a.jObject;$(window).on(a.options.associatedGadgetId+"stopClock",function(c,d){clearInterval(a.timer),b.find(".clock p").text(a.minutes+":"+a.seconds),b.find(".stopwatch-pause-button").sliderbutton("disable"),a.isComplete=!0,a.shortTime||(a.shortTime=a.currentTime),a.shortTime>=a.currentTime?(a.shortTime=a.currentTime,a.prevBestMinutes=a.minutes,a.prevBestSeconds=a.seconds,b.find(".stopwatch-best-time").show(),b.find(".stopwatch-best-time p").text(a.labelOpts.bestTimeText+" - "+a.prevBestMinutes+":"+a.prevBestSeconds),a.prevBestMinutes>=2?a.setStopwatchStatusLive(a.labelOpts.bestTimeText+a.prevBestMinutes+"minutes and"+a.prevBestSeconds+"seconds"):a.setStopwatchStatusLive(a.labelOpts.bestTimeText+a.prevBestMinutes+"minute and"+a.prevBestSeconds+"seconds")):a.options.scorm.suspendData?(a.prevBestMinutes=a.options.scorm.suspendData.data.prevBestMinutes,a.prevBestSeconds=a.options.scorm.suspendData.data.prevBestSeconds,b.find(".stopwatch-best-time").show(),b.find(".stopwatch-best-time p").text(a.labelOpts.bestTimeText+" - "+a.prevBestMinutes+":"+a.prevBestSeconds),a.prevBestMinutes>=2?a.setStopwatchStatusLive(a.labelOpts.bestTimeText+a.prevBestMinutes+"minutes and"+a.prevBestSeconds+"seconds"):a.setStopwatchStatusLive(a.labelOpts.bestTimeText+a.prevBestMinutes+"minute and"+a.prevBestSeconds+"seconds")):(a.shortTime=a.currentTime,a.prevBestMinutes=a.minutes,a.prevBestSeconds=a.seconds,b.find(".stopwatch-best-time").show(),b.find(".stopwatch-best-time p").text(a.labelOpts.bestTimeText+" - "+a.prevBestMinutes+":"+a.prevBestSeconds),a.prevBestMinutes>=2?a.setStopwatchStatusLive(a.labelOpts.bestTimeText+a.prevBestMinutes+"minutes and"+a.prevBestSeconds+"seconds"):a.setStopwatchStatusLive(a.labelOpts.bestTimeText+a.prevBestMinutes+"minute and"+a.prevBestSeconds+"seconds")),setTimeout(function(){a.setStopwatchStatusLive(" ")},100),a.saveLearnerData(),a.startClicked=!1,a.reset=!0,a.options.scorm.suspendData&&(a.options.scorm.suspendData.data.startClicked=a.startClicked,a.options.scorm.suspendData.data.reset=a.reset),a.isComplete=!1}),a.bestTime()}},{key:"bestTime",value:function(){var a=this,b=a.jObject;$(window).on(a.options.associatedGadgetId+"calculateBestTime",function(c,d){b.find(".stopwatch-pause-button").sliderbutton("disable"),clearInterval(a.timer),a.reset=!0,a.options.scorm.suspendData&&(a.options.scorm.suspendData.data.reset=a.reset),b.find(".clock p").text("00:00"),$(window).trigger(a.options.associatedGadgetId+"stopwatchResetStart","reset")}),a.setTime()}},{key:"setTime",value:function(){var a=this,b=a.jObject;$(window).on(a.options.associatedGadgetId+"setClock",function(c,d){a.minutes=d.scorm.suspendData.data.previousMinutes,a.seconds=d.scorm.suspendData.data.previousSeconds,b.find(".clock p").text(a.minutes+":"+a.seconds),b.find(".stopwatch-best-time").show(),a.prevBestMinutes?b.find(".stopwatch-best-time p").text(a.labelOpts.bestTimeText+" - "+a.options.scorm.suspendData.data.prevBestMinutes+":"+a.options.scorm.suspendData.data.prevBestSeconds):b.find(".stopwatch-best-time p").text(a.labelOpts.bestTimeText+" - "+a.minutes+":"+a.seconds)})}},{key:"saveLearnerData",value:function(){this.startClicked&&(clearInterval(this.timer),this.options.scorm.suspendData&&(this.options.scorm.suspendData.data={previousSeconds:this.seconds,previousMinutes:this.minutes,startClicked:!0,shortTime:this.shortTime,prevBestMinutes:this.prevBestMinutes,prevBestSeconds:this.prevBestSeconds,currentTime:this.currentTime,reset:this.reset}))}},{key:"stop",value:function(){this.saveLearnerData(),$(window).trigger(this.options.associatedGadgetId+"stopwatchSaveData",this),this.startClicked&&$(window).trigger(this.options.associatedGadgetId+"stopwatchPausePage",this)}},{key:"gadgetUnload",value:function(){this.saveLearnerData(),$(window).trigger(this.options.associatedGadgetId+"stopwatchSaveData",this)}}]),b}(PearsonGL.Gadget.GadgetBase),window.PearsonGL=window.PearsonGL||{},window.PearsonGL.globals=window.PearsonGL.globals||{},window.PearsonGL.UIModule=window.PearsonGL.UIModule||{},PearsonGL.UIModule.etextNav=function(){function a(){var a=$("body").find('[id*="footer"]'),b=a.find(".etext-nav-module li"),c=PearsonGL.globals.player.options.pages.options.currPageIndex,d=$("body").find("#next");$(b).each(function(a,b){$(this).removeClass("enav-selected")}),$(b[c]).addClass("enav-selected"),a.attr("aria-label","You are on page "+(c+1)),PearsonGL.utils.focusItemOff(b),PearsonGL.globals.player.options.totalPages===c+1?(d.removeClass("next-submit-button").addClass("next-disable"),d.attr({"aria-disabled":"true",title:"disabled next button"})):d.attr({"aria-disabled":"false",title:"next button"})}function b(b){var c=b,d=$("body").find('[id*="footer"]:first-child'),f=d.find("#pageIndex"),g=c.totalPages,h=$(),i=$(),j=d.find("#prev");d.addClass("hide-footer").removeClass("show-footer"),f.hide(),d.prepend('<nav role="navigation" tabindex="0" aria-label="Go to pages in this sco." class="etext-nav-module"><ul></ul></nav>'),h=d.find(".etext-nav-module"),h.insertAfter(j),i=h.find("ul");for(var k=0;k<g;)k++,i.append("<li role='button' tabindex='0' title='Go to page "+k+"' aria-label='Go to page "+k+"' data-page-jump='"+k+"'></li>");a();var l=0;i.on("click","li",function(b){b.preventDefault(),l=$(b.target).attr("data-page-jump");try{global_player.goToPage(l),a()}catch(a){}}).keyup(function(b){switch(l=$(b.target).attr("data-page-jump"),b.keyCode){case 13:try{global_player.goToPage(l),a()}catch(a){}break;case 9:PearsonGL.utils.focusItemOn($(b.target)),$(this).focus()}}).blur(function(){PearsonGL.utils.focusItemOff($(e.target))}),d.addClass("show-footer").removeClass("hide-footer")}return{init:b,updateSelectedState:a}}(),PearsonGL.UIModule.etextNav.page_show_count=0,PearsonGL.UIModule.etextNav.buildEnav=!1,$(document).ready(function(){$(this).on("PageShowEvent",function(a,b){PearsonGL.UIModule.etextNav.page_show_count>0&&PearsonGL.UIModule.etextNav.updateSelectedState(),0===PearsonGL.UIModule.etextNav.page_show_count?PearsonGL.UIModule.etextNav.buildEnav=!0:PearsonGL.UIModule.etextNav.buildEnav=!1,PearsonGL.UIModule.etextNav.page_show_count++})});var globalRuntimeJsonObj,globalPlayerJsonObj;window.PearsonGL=window.PearsonGL||{},PearsonGL.SectionItem=function(a){this.options={gadgetArray:[],id:"h0",name:""},$.extend(this.options,a)},PearsonGL.Section=function(a,b,c,d){this.options={itemArray:[],currItemIndex:0,runtimejson:{}},this.initialize(a,b,c,d)},PearsonGL.Section.prototype={initialize:function(a,b,c,d){var e,f=b.pages.length,g=this;for($.extend(!0,this.options,b),this.gadgetsOnPage={},this.selector=a,this.sectionLoadedDeferred=c,e=0;e<f;e++)this.options.itemArray.push(new PearsonGL.SectionItem(b.pages[e]));if(0===this.options.itemArray.length)return $(this.selector).remove(),void(this.sectionLoadedDeferred&&this.sectionLoadedDeferred.resolve());globalRuntimeJsonObj?g.options.runtimejson=globalRuntimeJsonObj:$.extend(g.options.runtimejson,d),"header"!=g.options.type&&"footer"!=g.options.type||(g.options.runtimejson.highlightingEnabled=!1),g.populateSection()},populateSection:function(){var a=this,b="";this.options.itemArray.length>0&&(b=this.options.itemArray[this.options.currItemIndex].options,$.ajax({type:"GET",url:"model/"+b.name+".html",dataType:"html",cache:!0,limit:20,success:function(c){a.gotItemModel(c,b)}}))},gotItemModel:function(a,b){var c=this,d={},e=$(a),f=b.collapsed;e.attr("id",this.options.type+c.options.itemArray[c.options.currItemIndex].options.id),e.find("[data-id]").each(function(){var a={},e=$(this).attr("data-id");PearsonGL.utils.isArrayContains(f,e)?$(this).remove():(a.type=$(this).attr("data-gadget"),a.json=b.gadgets[e],d[e]=a,c.gadgetsOnPage[c.options.currItemIndex]=d)});var g="#"+this.options.type+c.options.itemArray[c.options.currItemIndex].options.id;$(g).length<=0&&!$(g).length&&($(this.selector).append(e),this.populateGadgets(c.gadgetsOnPage[c.options.currItemIndex])),$(product).triggerHandler({type:"onloadHeader"}),this.sectionLoadedDeferred&&this.sectionLoadedDeferred.resolve()},populateGadgets:function(a){var b=this;$("#"+this.options.type+b.options.itemArray[b.options.currItemIndex].options.id).find("[data-gadget]").each(function(){var c=$(this).attr("data-id");b.populateGadget($(this),a,c)})},populateGadget:function(a,b,c){var d=void 0;try{d=localStorage.getItem("hidegadgetfail"),d="true"===d}catch(a){}""!==PearsonGL.utils.getQuerystring("hidegadgetfail","",!0)&&(d=PearsonGL.utils.getQuerystring("hidegadgetfail","",!0));try{if(b[c].json){var e,f=this;b[c].json.runtimejson={},$.extend(b[c].json.runtimejson,this.options.runtimejson);var g=this.options.id+"_"+this.options.itemArray[f.options.currItemIndex].options.id+"_"+c;e=new window.PearsonGL.Gadget[b[c].type](a,b[c].json,g),f.options.itemArray[f.options.currItemIndex].options.gadgetArray.push(e)}else window.location.href.indexOf("playerdev.html")>-1&&!d?(PearsonGL.logger.error("Oh snap the gadget didn't have options."),$(a).append("<b>THIS "+b[c].type.toUpperCase()+" IS MISSING ITS OPTIONS!</b>"),$(a).addClass("gadget-fail")):$(a).remove()}catch(b){window.location.href.indexOf("playerdev.html")>-1&&!d&&(PearsonGL.logger.error("Oh snap the gadget didn't load because... "+b),$(a).append("<b>THIS GADGET FAILED TO LOAD!</b>"),$(a).addClass("gadget-fail"))}}};var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();PearsonGL.SubmitDialog=function(){function a(b,c){_classCallCheck(this,a),this.pages=b,this.isHeaderSubmit=!1,this.isFooterSubmit=!1,this.DT_PROGRESS_DIALOG="progressDialog",this.DT_CONFIRM_DIALOG="confirmationDialog",this.DT_NO_DIALOG="noDialog",this.dialogType=this.getDialogType(c),this.version=2,this.dialogs=[],this.state={doFocusTrap:null,focusTrap:null,returnFocusTo:$("body").find(".sco #info-bar-id"),dialogOpened:!1,activeDialog:$()},this.labelOpts={defaultSubmitHeaderButtonTooltip:"Go to pages or turn in your work.",altSubmitHeaderButtonTooltip:"Turn in your work.",browseModeSubmitHeaderButtonTooltip:"Your Progress",cancelButtonLabel:"Cancel",finishButtonLabel:"Turn In",submitButtonLabel:"Submit",confirmFinishTitle:"",confirmFinishMessage:"Are you sure you want to turn in your work?",finalConfirmationMessage:"Your work has been turned in.",footerMessage:"You turned in your work. New changes will not be saved.",headerTitle:"Your Progress",listTitle:"Page",submitHeaderCompleted:"Completed",closeButtonHover:"Close",reviewModeMessage:"You turned in your work. New changes will not be saved.",describedByAccesibleContent:"You can jump to pages by page number",submitFooterAccessibleContent:"To turn in your work, click the Turn In button, or click cancel to close this window.",submitSkipPageLinksContent:"Screen reader users click here to skip to the turn in button.",goToPagePhrase:"Go to page",pageNotDone:"not completed.",pageIsDone:"completed."},this.buildDom()}return _createClass(a,[{key:"transferLabels",value:function(a){var b={},c=$.extend(!0,this.labelOpts,a);b.submitDialogText=c.submitDialogText,this.dialogType===this.submitDialog.DT_PROGRESS_DIALOG?"normal"===this.pages.scormMode?b.submitHeaderButtonTooltip=c.defaultSubmitHeaderButtonTooltip:b.submitHeaderButtonTooltip=c.browseModeSubmitHeaderButtonTooltip:b.submitHeaderButtonTooltip=c.altSubmitHeaderButtonTooltip,b.confirmFinishTitle=c.confirmFinishTitle,b.confirmFinishMessage=c.confirmFinishMessage,b.finishButtonLabel=c.finishButtonLabel,b.cancelButtonLabel=c.cancelButtonLabel,b.finalConfirmationMessage=c.finalConfirmationMessage,b.footerMessage=c.footerMessage,b.headerTitle=c.headerTitle,b.listTitle=c.listTitle,b.submitHeaderCompleted=c.submitHeaderCompleted,b.closeButtonHover=c.closeButtonHover,b.reviewModeMessage=c.reviewModeMessage,b.describedByAccesibleContent=c.describedByAccesibleContent,b.submitFooterAccessibleContent=c.submitFooterAccessibleContent,b.goToPagePhrase=c.goToPagePhrase,b.pageNotDone=c.pageNotDone,b.pageIsDone=c.pageIsDone}},{key:"buildDom",value:function(){var a=$('<div class="dialog-modal-submit-v2" aria-modal="true"></div>'),b=$('\n\t\t\t<div id="submit-v2-confirmation" tabindex="0" class="confirmation-dialog" role="alertdialog">\n\t\t\t\t<div class="submit__content"></div>\n\t\t\t</div>'),c=$('\n\t\t\t<div id="submit-v2-acknowledgement" tabindex="0" class="acknowledgement-dialog" role="alertdialog">\n\t\t\t\t<div class="submit__content"></div>\n\t\t\t</div>'),d=$('\n\t\t<div id="submit-v2-progress" tabindex="-1" class="progress-dialog" role="alertdialog" aria-labelledby="your-progress">\n\t\t\t<div class="submit-header__wrapper">\n\t\t\t\t<h2 id="your-progress" class="submit__title">Your progress</h2>\n\t\t\t\t<div class="submit__list-header left column">\n\t\t\t\t\t<h3>Page</h3>\n\t\t\t\t</div>\n\t\t\t\t<div class="submit__list-header right column">\n\t\t\t\t\t<h3>Completed</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="submit__content scrollable">\n\t\t\t\t<nav aria-label="Navigate pages">\n\t\t\t\t\t<ul role="navigation"></ul>\n\t\t\t\t</nav>\n\t\t\t</div>\n\t\t</div>'),e=$('\n\t\t\t<div class="submit-footer">\n\t\t\t\t<div class="submit-footer__content">\n\t\t\t\t\t<p></p>\n\t\t\t\t</div>\n\t\t\t\t<div class="button-wrapper">\n\t\t\t\t\t<button type="button" class="close-cancel" data-excludeTabbable="true">Cancel</button>\n\t\t\t\t\t<button type="button" class="submit-turn-in" data-excludeTabbable="true">Turn In</button>\n\t\t\t\t</div>\n\t\t\t</div>');$("body").prepend(a);var f=$("body").find(".dialog-modal-submit-v2");f.attr("aria-modal",!0),f.append(d),f.append(b),f.append(c);var g=f.find(".progress-dialog"),h=f.find(".confirmation-dialog"),i=f.find(".acknowledgement-dialog");this.dialogs.push(g[0],h[0],i[0]),this.dialogs.forEach(function(a){e.clone().appendTo($(a))}),this.dialogType===this.DT_PROGRESS_DIALOG?this.state.activeDialog=g:this.state.activeDialog=h,this.addEvents(),this.hideModalDialog()}},{key:"addEvents",value:function(){var a=this,b=$("body").find(".dialog-modal-submit-v2"),c=b.find(".close-cancel").toArray(),d=b.find(".submit-turn-in").toArray();c.forEach(function(b){$(b).buttonComponent({type:"text"}),$(b).click(function(b){a.hideModalDialog()})}),d.forEach(function(b){$(b).buttonComponent({type:"text"}),$(b).click(function(b){$(b.target).closest('[class*="-dialog"]').hasClass("progress-dialog")?a.doConfirmationDialog(b):a.doAcknowledgementDialog(b)})})}},{key:"hideDialogs",value:function(){this.dialogs.forEach(function(a){$(a).addClass("hide")})}},{key:"hideModalDialog",value:function(){var a=$("body").find(".dialog-modal-submit-v2");this.state.focusTrap&&this.state.focusTrap.deactivate(),this.hideDialogs(),a.addClass("hide")}},{key:"showModalDialog",value:function(a){var b=$("body").find(".dialog-modal-submit-v2");this.hideDialogs(),a.removeClass("hide"),b.removeClass("hide"),this.state.activeDialog=a,this.addFocusTrap(a),this.state.focusTrap.activate()}},{key:"getDialogType",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=PearsonGL.utils.getQuerystring("dialogtype","",!0),c=this.DT_NO_DIALOG;return c=a&&a.dialogType?a.dialogType:this.DT_CONFIRM_DIALOG,b&&(c="cd"===b?this.DT_CONFIRM_DIALOG:this.DT_PROGRESS_DIALOG),PearsonGL.logger.log("dialogType",c),c}},{key:"setSubmitButtonPosition",value:function(a){var b=PearsonGL.utils.getQuerystring("submitbutton","",!0);void 0===a.submitLocation||"both"===a.submitLocation?(this.isHeaderSubmit=!0,this.isFooterSubmit=!0):"lastPage"===a.submitLocation?(this.isHeaderSubmit=!1,this.isFooterSubmit=!0):(this.isHeaderSubmit=!0,this.isFooterSubmit=!1),"header"===b&&(this.isHeaderSubmit=!0,this.isFooterSubmit=!1),"footer"===b&&(this.isHeaderSubmit=!1,this.isFooterSubmit=!0),"both"===b&&(this.isHeaderSubmit=!0,this.isFooterSubmit=!0),PearsonGL.logger.log("submitButtonPos",b,"isHeaderSubmit",this.isHeaderSubmit,"isFooterSubmit",this.isFooterSubmit)}},{key:"setSubmitDialogProperties",value:function(){var a=this.pages.options.runtimejson;if(a.pageScorm&&(this.pages.isPageLevelScorm=!0),this.pages.isPageLevelScorm&&PearsonGL.globals.comm&&(this.pages.isPageGadgetScorm=!0),(this.pages.isPageLevelScorm||this.pages.isPageGadgetScorm)&&this.pages.options.scoTotals){var b=parseInt(this.pages.options.totalPages,10);this.pages.options.scoTotals.totalInteractions=parseInt(this.pages.options.scoTotals.totalInteractions,10)+b,this.pages.options.scoTotals.totalObjectives=parseInt(this.pages.options.scoTotals.totalObjectives,10)+b,0===parseInt(a.pageScorm.interactions[0].objectives[0].score.max)?this.pages.options.scoTotals.scoreMax=0:parseInt(a.pageScorm.interactions[0].objectives[0].score.max,10)>0&&(this.pages.options.scoTotals.scoreMax=parseInt(this.pages.options.scoTotals.scoreMax,10)+parseInt(a.pageScorm.interactions[0].objectives[0].score.max*b,10)),this.pages.options.scoTotals.scoreMin=parseInt(this.pages.options.scoTotals.scoreMin+0,10)}if(PearsonGL.globals.comm.setTotalScore(this.pages.options.scoTotals),a.hasOwnProperty("dialogType")){if(a.dialogType===this.DT_NO_DIALOG)return void $("body").find(".info-bar-done").remove();this.setSubmitButtonPosition(a)}else this.dialogType=this.DT_NO_DIALOG;this.dialogType===this.DT_NO_DIALOG||this.dialogType===this.DT_CONFIRM_DIALOG&&("review"===this.pages.scormMode||"browse"===this.pages.scormMode)?$(".info-bar-done").hide():this.isFooterSubmit&&!this.isHeaderSubmit?$(".info-bar-done").hide():$(".info-bar-done").show(),this.dialogType===this.DT_PROGRESS_DIALOG&&$(".info-bar-done").show()}},{key:"doProgressDialog",value:function(){var a=this,b=this.pages.isSubmitted,c=this.pages.scormMode,d=$("#submit-v2-progress"),e=d.find(".submit__title"),f=$("#submit-v2-progress .submit-footer"),g=f.find(".submit-footer__content p"),h=f.find(".submit-turn-in");switch(this.pages.sendAnalytics("clicked_progress_dialog_open"),e.empty().append(this.pages.options.headerTitle),d.find(".submit__list-header .left").empty().append(this.pages.options.listTitle),d.find(".submit__list-header .right").empty().append(this.pages.options.submitHeaderCompleted),c){case"browse":h.addClass("hide"),g.empty();break;case"review":h.addClass("hide"),d.addClass("is-submitted"),g.empty().append(this.pages.options.reviewModeMessage);break;case"normal":h.prop("disabled",!1)}b&&(h.addClass("hide"),d.addClass("is-submitted"),g.empty().append(this.pages.options.reviewModeMessage)),this.pages.checkGadgetsCompleted();var i=$("#submit-v2-progress .submit__content ul");i.empty(),this.pages.pageArray.forEach(function(b,c){var d=c+1,e=1===b.isDone?"page-item-icon-complete":"page-item-icon-not-complete",f=1===b.isDone?a.pages.options.pageIsDone:a.pages.options.pageNotDone,g=a.pages.options.currPageIndex===c?"selected":"";i.append('\n\t\t\t\t<li id="'+d+'" tabindex="0" class="results-page-item flex-row '+g+'" data-icon="results-page-item" data-results-id="'+b.options.id+'">\n\t\t\t\t\t<div class="page-item-txt flex-column">\n\t\t\t\t\t\t<span class="hidden-label">'+a.pages.options.goToPagePhrase+"</span> "+d+' <span class="hidden-label">'+f+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="page-item-icon-p'+d+'" class="page-item-icon flex-column '+e+'" data-icon="page-item-icon"></div>\n\t\t\t\t</li>')}),$("#submit-v2-progress .results-page-item").click(function(b){a.pages.callPageDirect($(b.currentTarget).attr("data-results-id")),a.hideModalDialog()}).keyup(function(b){var c=$(b.currentTarget);switch(b.keyCode){case PearsonGL.utils.keyCode.enter:case PearsonGL.utils.keyCode.space:a.pages.callPageDirect($(c).attr("data-results-id")),a.hideModalDialog();break;case PearsonGL.utils.keyCode.tab:b.preventDefault(),PearsonGL.utils.focusItemOn(c)}}).keydown(function(a){if(a.keyCode===PearsonGL.utils.keyCode.down||a.keyCode===PearsonGL.utils.keyCode.up){var b=$("#submit-v2-progress").find(".results-page-item"),c=$.inArray(document.activeElement,b);return c=c<0?0:c,c=a.keyCode===PearsonGL.utils.keyCode.down?(c+1)%b.length:c-1<0?b.length-1:c-1,b.removeClass("selected"),$(b[c]).addClass("selected text-button-focus"),b[c].focus(),!1}}).blur(function(a){}),this.showModalDialog(d)}},{key:"doConfirmationDialog",value:function(){var a=this.pages.isSubmitted,b=this.pages.scormMode,c=$("#submit-v2-confirmation"),d=$("#submit-v2-confirmation .submit-footer"),e=d.find(".submit-footer__content p"),f=d.find(".submit-turn-in");switch(this.hideModalDialog(),b){case"browse":f.addClass("hide"),e.empty().append(this.pages.options.browseModeMessage);break;case"review":f.addClass("hide"),c.addClass("is-submitted"),e.empty().append(this.pages.options.reviewModeMessage);break;case"normal":f.prop("disabled",!1),e.empty().append(this.pages.options.confirmFinishMessage)}a&&(f.addClass("hide"),c.addClass("is-submitted"),e.empty().append(this.pages.options.reviewModeMessage)),this.showModalDialog(c)}},{key:"doAcknowledgementDialog",value:function(){console.log("Acknowledgement Dialog");var a=$("#submit-v2-acknowledgement"),b=a.find(".submit-footer"),c=b.find(".submit-footer__content p"),d=b.find(".submit-turn-in");this.hideModalDialog(),d.addClass("hide"),c.empty().append(this.pages.options.finalConfirmationMessage),this.showModalDialog(a),this.pages.isSubmitted=!0,PearsonGL.globals.comm.finish()}},{key:"done",value:function(){var a=this,b=$(".info-bar-done");b.click(function(b){a.pages.sendAnalytics("clicked_submit_button_header"),a.displaySubmitDialog()}),b.keydown(function(b){b.keyCode!==PearsonGL.utils.keyCode.enter&&b.keyCode!==PearsonGL.utils.keyCode.space||(a.pages.sendAnalytics("clicked_submit_button_header"),a.displaySubmitDialog())}),b.sliderbutton({buttonClassName:"info-bar-done-hover",slider:!1})}},{key:"getReturnFocusToElement",value:function(a){return a.hasClass("acknowledgement-dialog")||a.hasClass("submitted")?this.state.returnFocusTo:""}},{key:"addFocusTrap",value:function(){var a=this;this.state.focusDialog=$("body").find('.dialog-modal-submit-v2 [id^="submit-v2-"]');var b=this.state.activeDialog[0];console.log("TRAP FOCUS",b);var c={nodeFocusedBeforeActivation:this.getReturnFocusToElement($(b))};this.state.doFocusTrap=new PearsonGL.utils.doFocusTrap(b,c),this.state.focusTrap=this.state.doFocusTrap.focusTrap(b,{onActivate:function(){b.classList.add("trap","is-active")},onDeactivate:function(){b.classList.remove("trap","is-active"),a.hideModalDialog()},initialFocus:this.state.focusDialog,escapeDeactivates:!0,nodeFocusedBeforeActivation:c.nodeFocusedBeforeActivation})}},{key:"displaySubmitDialog",value:function(){this.pages.stopAll(),this.dialogType===this.DT_PROGRESS_DIALOG?this.doProgressDialog():this.doConfirmationDialog()}}]),a}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),globalPlayerJsonObj;window.PearsonGL=window.PearsonGL||{},PearsonGL.Page=function a(b){_classCallCheck(this,a),this.options=$.extend({gadgetArray:[],id:"p0",name:"",objectType:"page",scorm:{}},b),this.isDone=0},PearsonGL.Pages=function(){function a(b,c,d){_classCallCheck(this,a),this.labelOpts={playalt:"play",pausealt:"pause",utilSkipNavText:"Skip navigation",utilSkipLinkText:"Screen reader users click here for an Alternate Activity.",utilDlinkText:"Click for more descriptive text",utilDlinkWinTitle:"Descriptive Text for Visually Impaired users.",utilDlinkPointsText:"Press Enter to receive points for this activity.",utilCloseDlinkText:"Close Activity.",utilLongDescTitle:"Descriptive Text for visually impaired users.",utilLongDescText:"Screen reader users click for additional information.",utilCloseDescText:"Close",utilCloseButtonHover:"Close",previousButtonHover:"Previous",nextButtonHover:"Next",of:"of",loading:"Loading...",aboutText:"Product Version: {PV}\nRoot SCO: {PN}/{RS}\nDeployed: {DP}/{RS}\nID: {ID}\nLast Update: {LU}\nGadget ID: {GI}\nGadget Type: {GT}\nGadget Max Score: {MS}\nSCORM Mode: {SM}",printToolTip:"Print",refreshToolTip:"Reset",defaultSubmitHeaderButtonTooltip:"Go to pages or turn in your work.",altSubmitHeaderButtonTooltip:"Turn in your work.",browseModeSubmitHeaderButtonTooltip:"Your Progress",cancelButtonLabel:"Cancel",finishButtonLabel:"Turn In",submitButtonLabel:"Submit",confirmFinishTitle:"",confirmFinishMessage:"Are you sure you want to turn in your work?",finalConfirmationMessage:"Your work has been turned in.",footerMessage:"You turned in your work. New changes will not be saved.",headerTitle:"Your Progress",listTitle:"Page",submitHeaderCompleted:"Completed",closeButtonHover:"Close",reviewModeMessage:"You turned in your work. New changes will not be saved.",describedByAccesibleContent:"You can jump to pages by page number",submitFooterAccessibleContent:"To turn in your work, click the Turn In button, or click cancel to close this window.",submitSkipPageLinksContent:"Screen reader users click here to skip to the turn in button.",goToPagePhrase:"Go to page",pageNotDone:"not completed.",pageIsDone:"completed.",exitButtonLabel:"Exit",mdSubmitHeaderButtonTooltip:"Finish",mdConfirmSubmitTitle:"",mdConfirmExitMessage:"Are you sure you are<br />ready to exit this lesson?",mdFooterExitMessage:"This lesson has been exited.<br />Please close the browser window.",mdConfirmSubmitMessage:"Are you sure you are<br />ready to submit this lesson?",mdFooterSubmitMessage:"This lesson has been submitted.<br />Please close the browser window."},this.options={currPageIndex:0,totalPages:1,id:"",scoTotals:{},runtimejson:{},hasEnav:!1},this.doFocusTrap,this.focusTrap,this.focusDialog,this.returnFocusTo,this.initialize(b,c,d)}return _createClass(a,[{key:"initialize",value:function(a,b,c){var d=this;this.selector=a,this.jObject=jQuery(a),$.extend(this.options,b),this.options.totalPages=b.pages.length,this.gadgetsOnPage={},this.print(),this.refresh($(".info-bar-refresh")),this.lmsconnected=!1,this.scormMode="",this.scormData={},this.isQuitActivity=!1,this.isNoDialog=!1,this.isPageLevelScorm=!1,this.isPageGadgetScorm=!1,this.isSubmitted=!1,this.startTime=new Date,this.printAdded=!1,this.presentation=null,this.pageArray=[],this.supplementalPageArray=[],this.isShowingSupplementPage=!1,this.gadgetsHash={},this.isFirstPageLoaded=!1,this.isNextDisabled=!1,this.isPrevDisabled=!1,this.isNextLocked=!1,this.translateHandlerOn=!1,this.hideGadgetFailure=!1,this.pageSettings={},this.options.runtimejson=c,this.analyticsData={category:"Player",eventType:"event",action:this.options.runtimejson.product+" "+PearsonGL.utils.getScoId()},this.continueLoad(),$(window).on("played",function(a,b){void 0!==this.curPlayingComp&&this.curPlayingComp.stop(),b.source?this.curPlayingComp=b.source:this.curPlayingComp=b}),$(window).on("paused ended",function(a,b){this.curPlayingComp!==b&&this.curPlayingComp!==b.source||(this.curPlayingComp=void 0)}),$(window).on("hasAutoplayAudio",function(){d.pageSettings[d.options.currPageIndex]||(d.pageSettings[d.options.currPageIndex]={}),d.pageSettings[d.options.currPageIndex].hasAutoplayAudio=!0}),""!==PearsonGL.utils.getQuerystring("uselockstep","",!0)&&(this.options.runtimejson.lockstep=!0),this.options.runtimejson.lockstep&&($(window).on("LearnerDataLoaded",function(){d.updatePageLock()}),$("body").addClass("lockstep-active"));try{this.hideGadgetFailure="true"===localStorage.getItem("hidegadgetfail")}catch(a){}this.hideGadgetFailure=this.hideGadgetFailure||"true"===PearsonGL.utils.getQuerystring("hidegadgetfail","false",!0),PearsonGL.globals.comm.subscribeToPostMessages(this.handlePostMessage.bind(this))}},{key:"continueLoad",value:function(a){var b=this;""!==PearsonGL.utils.getQuerystring("lang","",!0)&&(this.options.runtimejson.lang=PearsonGL.utils.getQuerystring("lang","en",!0)),this.lmsconnected=PearsonGL.globals.comm.isConnected(),this.scormMode=PearsonGL.globals.comm.getMode(),this.submitDialog=new PearsonGL.SubmitDialog(this,this.options.runtimejson),"review"!==this.scormMode&&this.options.runtimejson.cmiMode&&(this.scormMode=this.options.runtimejson.cmiMode),"review"===this.scormMode&&this.disableAllGadgets();for(var c=0;c<this.options.pages.length;c++)this.pageArray.push(new PearsonGL.Page(this.options.pages[c]));this.getBookmark(),this.setBookmark(),global_player.about(),this.sendAnalytics("sco_opened_page "+(this.options.currPageIndex+1)+" of "+this.options.pages.length),$("body").find(".info-bar-done").hide(),$(product).on("onloadHeader",function(a){b.loadHeaderEvents()}),PearsonGL.utils.getGlobalizedLabel("player_globalization",function(a){b.transferLabels(a),b.globalizationComplete()},this.options.runtimejson.lang),this.submitDialog.setSubmitDialogProperties()}},{key:"transferLabels",value:function(a){var b=this.options,c=$.extend(!0,this.labelOpts,a);if(b.playalt=c.playalt,b.pausealt=c.pausealt,b.submitDialogText=c.submitDialogText,b.previousButtonHover=c.previousButtonHover,b.nextButtonHover=c.nextButtonHover,b.of=c.of,b.loading=c.loading,b.aboutText=c.aboutText,b.printToolTip=c.printToolTip,b.refreshToolTip=c.refreshToolTip,this.submitDialog.dialogType===this.submitDialog.DT_PROGRESS_DIALOG?"normal"===this.scormMode?b.submitHeaderButtonTooltip=c.defaultSubmitHeaderButtonTooltip:b.submitHeaderButtonTooltip=c.browseModeSubmitHeaderButtonTooltip:b.submitHeaderButtonTooltip=c.altSubmitHeaderButtonTooltip,b.confirmFinishTitle=c.confirmFinishTitle,b.confirmFinishMessage=c.confirmFinishMessage,b.finishButtonLabel=c.finishButtonLabel,b.cancelButtonLabel=c.cancelButtonLabel,b.finalConfirmationMessage=c.finalConfirmationMessage,b.footerMessage=c.footerMessage,b.headerTitle=c.headerTitle,b.listTitle=c.listTitle,b.submitHeaderCompleted=c.submitHeaderCompleted,b.closeButtonHover=c.closeButtonHover,b.reviewModeMessage=c.reviewModeMessage,b.describedByAccesibleContent=c.describedByAccesibleContent,b.submitFooterAccessibleContent=c.submitFooterAccessibleContent,b.submitSkipPageLinksContent=c.submitSkipPageLinksContent,b.goToPagePhrase=c.goToPagePhrase,b.pageNotDone=c.pageNotDone,b.pageIsDone=c.pageIsDone,"object"!==("undefined"==typeof customSubmitContent?"undefined":_typeof(customSubmitContent))||customSubmitContent.customSubmitText||this.lmsconnected||(b.submitHeaderButtonTooltip=c.mdSubmitHeaderButtonTooltip,b.confirmFinishTitle=c.mdConfirmSubmitTitle,b.confirmFinishMessage=c.mdConfirmExitMessage,b.finishButtonLabel=c.exitButtonLabel,b.footerMessage=c.mdFooterExitMessage,b.finalConfirmationMessage=c.mdFooterExitMessage),"object"===_typeof(window.PearsonGL.customSubmitContent)&&window.PearsonGL.customSubmitContent.customSubmitText){var d=window.PearsonGL.customSubmitContent;d.product&&"southafrica"===d.product&&b.runtimejson&&"en"===b.runtimejson.lang&&(b.submitHeaderButtonTooltip=d.defaultSubmitHeaderButtonTooltip,b.confirmFinishTitle=d.confirmFinishTitle,b.confirmFinishMessage=d.confirmFinishMessage,b.finishButtonLabel=d.finishButtonLabel,b.footerMessage=d.footerMessage,b.finalConfirmationMessage=d.finalConfirmationMessage,b.defaultSubmitHeaderButtonTooltip=d.defaultSubmitHeaderButtonTooltip,b.altSubmitHeaderButtonTooltip=d.altSubmitHeaderButtonTooltip,b.submitHeaderButtonTooltip=d.submitHeaderButtonTooltip,b.reviewModeMessage=d.reviewModeMessage,b.footerMessage=d.footerMessage,b.submitFooterAccessibleContent=d.submitFooterAccessibleContent,b.submitSkipPageLinksContent=d.submitSkipPageLinksContent),d.product&&"religion3"===d.product&&(c.utilDlinkWinTitle=d.utilDlinkWinTitle,c.utilLongDescTitle=d.utilLongDescTitle)}global_player.utilDlinkText=c.utilDlinkText,global_player.utilSkipNavText=c.utilSkipNavText,global_player.utilSkipLinkText=c.utilSkipLinkText,global_player.utilDlinkWinTitle=c.utilDlinkWinTitle,global_player.utilDlinkPointsText=c.utilDlinkPointsText,global_player.utilCloseDlinkText=c.utilCloseDlinkText,global_player.utilLongDescText=c.utilLongDescText,global_player.utilLongDescTitle=c.utilLongDescTitle,global_player.utilScreenReaderMode=c.utilScreenReaderMode,global_player.utilScreenReaderModeFeedback=c.utilScreenReaderModeFeedback,global_player.utilCloseDescText=c.utilCloseDescText,global_player.utilCloseButtonHover=c.closeButtonHover}},{key:"globalizationComplete",value:function(){this.submitDialog.done(),this.print(),this.textToSpeech(),this.refresh($(".info-bar-refresh")),$("html").attr("lang",this.options.runtimejson.lang),$("#next").attr("title",this.options.nextButtonHover),$("#prev").attr({title:this.options.previousButtonHover,"aria-disabled":!0}),this.updateIndex(this.options.currPageIndex+1,this.options.totalPages),this.startScoTimer(),this.startPageTimer()}},{key:"loadHeaderEvents",value:function(){this.globalizationComplete()}},{key:"refresh",value:function(a){a.sliderbutton({buttonClassName:"info-bar-refresh",slider:!1,clickFunction:function(){location.reload(!0)}})}},{key:"print",value:function(){var a=this;$(".info-bar-print").sliderbutton({buttonClassName:"info-bar-print",slider:!1,clickFunction:function(b,c){a.sendAnalytics("clicked_header_print_button"),a.printCurrentPage()}})}},{key:"handleInlineDisplay",value:function(a){for(var b=PearsonGL.utils.getQuerystring("pr","").split(","),c=!1,d=!1,e=!1,f=!1,g=!1,h=!1,i=a.options.totalPages,j=$("body").find(".header"),k=$("body").find(".footer"),l="",m=0;m<b.length;m++)"sp"===b[m]&&(l=b[m]),"vb"===b[m]&&(c=!0),"vf"===b[m]&&(d=!0),"vh"===b[m]&&(e=!0),"lb"===b[m]&&(f=!0),"enav"===b[m]&&(this.options.hasEnav=!0,g=!0);if("sp"===l){var n=k.find("*"),o=k.find('[tabindex="0"]').toArray(),p=function(){k.attr({"aria-hidden":!0}),k.removeClass("show-footer").addClass("hide-footer"),o.forEach(function(a,b){a._prevTabIndex=$(a).attr("tabindex"),$(a).attr("tabindex","-1")})},q=function(){k.attr({"aria-hidden":!1}),o.forEach(function(a,b){$(a).attr("tabindex",a._prevTabIndex)})};if($("html").addClass("pr-sp"),!0===c&&$("html").addClass("vb"),!0===e&&$("html").addClass("vh"),!0===d&&$("html").addClass("vf"),!0===f&&$("html").addClass("lb"),a.options.totalPages>1?h=!0:n.length>1?$.each(n,function(a,b){$(b).hasClass("gadget")&&(h=!0)}):h=!1,e&&j.show(),d||h?(1===i?k.addClass("no-paging"):k.removeClass("no-paging"),k.removeClass("hide-footer").addClass("show-footer"),q()):p(),h&&$("html").addClass("vf"),g&&i>1&&($("html").addClass("enav"),PearsonGL.UIModule)){$("html").removeClass("vf");var r=PearsonGL.UIModule.etextNav;if(r&&r.buildEnav){var s={totalPages:i,currIndex:a.options.currPageIndex};r.init(s)}}}else j.show(),k.removeClass("hide-footer").addClass("show-footer");this.updateIndex(this.options.currPageIndex+1,this.options.totalPages)}},{key:"setSupplementalPages",value:function(a){this.supplementalJsonData=a,this.supplementalPageArray=[];for(var b=0;b<a.pages.length;b++)this.supplementalPageArray.push(new PearsonGL.Page(a.pages[b]))}},{key:"populatePage",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pageArray,b=arguments[1],c=this,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.id;if($.isNumeric(b)||(b=this.options.currPageIndex),a.length>0){var f=a[b].options;$("<div></div>").load("model/"+f.name+".html?q="+PearsonGL.utils.getQuerystring("q",""),function(g){c.gotPageModel(g,f,a,b,d,e)})}else $(".loading, .dialog-modal").remove(),alert("No pages were found.")}},{key:"gotPageModel",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.pageArray,d=arguments[3],e=this,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.options.id;$.isNumeric(d)||(d=this.options.currPageIndex);var h=this,i={},j=$(a),k=b.collapsed,l="#"+f+c[d].options.id,m=!1;if($(".page").filter(":visible").attr("aria-hidden","true").addClass("hidden-page"),$(l).length<=0){j.attr("id",f+c[d].options.id);for(var n=0;n<k.length;n++)j.find("[data-id='"+k[n]+"']").remove();var o=!1;j.find("[data-gadget]").each(function(a,c){var d=$(c),f={},g=d.attr("data-id");!d.attr("data-import")||(d.attr("data-import"),d.attr("data-selector")?d.attr("data-selector"):d.attr("class"));f.type=d.attr("data-gadget"),f.json=b.gadgets[g],"Presentation"===f.type&&f.json&&(o=!0),i[g]=f,e.gadgetsOnPage[l]=i}),o&&j.addClass("hidden-page-minimum"),$(".main").append(j).attr("role","main"),this.presentation=null;var p=h.populateGadgets(h.gadgetsOnPage[l],c,d,f,g);o&&(this.presentation.initialize(j,p),this.presentation.start(),j.removeClass("hidden-page-minimum")),m=!0}else j=$(l);var q=$("body").find(".page-title");q.hide(),q.not("[data-move='g_title']")?$(".logo").after($(l).find(".page-title").attr("id","page-title-"+d)):$(l).find(".page-title").attr("id","page-title-"+d),$("[data-place]").hide(),$("[data-move]").hide().attr("aria-hidden","true"),$(l).find("[data-move]").attr("data--move-id",d),$(l).find("[data-move]").each(function(){var a=$("[data-place='"+$(this).attr("data-move")+"']");if(a.length>0){var b=a.find("[data--move-id='"+$(this).attr("data--move-id")+"']");b.length>0&&b.remove(),a.append($(this))}else $(this).remove()});var r=$("[data--move-id='"+d+"']");if(r.attr("aria-hidden","false").show(),r.parent("[data-place]").show(),$("#page-title-"+d).hasClass("presentation-hidden")||$("#page-title-"+d).show(),$(".logo").show(),m){j.attr({"aria-hidden":"false"}),$(".header").length>0?PearsonGL.utils.initMathJax([j[0],$(".header")[0]]):PearsonGL.utils.initMathJax(j[0]);var s=j.find(".info-bar-refresh");s.length>0&&h.refresh(s)}else j.removeClass("hidden-page").attr("aria-hidden","false");this.pageShowEvent(c,d),this.handleInlineDisplay(this),$("#header-id").removeClass("hide"),$("#footer-id").removeClass("hide"),$(".loading, .dialog-modal").remove(),$(product).triggerHandler({type:"productCallBackFunction",params:[d]}),this.isScoreEnabled(d),this.updatePageLock()}},{key:"pageShowEvent",value:function(a,b){for(var c=a[b],d=c.options.gadgetArray,e=!1,f=!1,g=0;g<d.length;g++){d[g].gadgetPageShowEvent();var h=$(d[g].getjObject()),i=h.find(".video-component-identifier").filter(":visible");h.hasClass("container-identifier")&&h.is(":visible")&&(e=!0),h.hasClass("drawpad-identifier")&&h.is(":visible")&&(f=!0),i.length>0&&i.videoComponent("gadgetPageShowEvent")}e&&f?$("body").addClass("container-active"):$("body").removeClass("container-active"),this.isFirstPageLoaded||(this.isFirstPageLoaded=!0,PearsonGL.globals.player.settings&&PearsonGL.globals.player.settings.activityTime&&PearsonGL.globals.player.startKeepAlive(),this.isPageLevelScorm&&this.checkGadgetsCompleted(),$(window).trigger("firstPageLoaded",this.pageSettings[this.options.currPageIndex])),PearsonGL.utils.iOSMathJaxFix();var j=$(".info-bar-print");j.attr({title:this.options.printToolTip,"aria-hidden":!j.is(":visible")}),$(".info-bar-refresh").attr({title:this.options.refreshToolTip,"aria-label":this.options.refreshToolTip,tabindex:0}),$(".info-bar-done-hover").attr({title:this.options.submitHeaderButtonTooltip,"aria-label":this.options.submitHeaderButtonTooltip,tabindex:0}),$(".logo").removeAttr("tabindex");var k=$(".header").find(".navbar-nav.pull-right");k.length>0&&(k.attr({role:"menubar"}),k.find("li").each(function(a,b){b=$(b),b.children().length>0?b.attr({role:"menuitem"}):b.css({display:"none"})})),this.triggerPageShowEvent()}},{key:"triggerPageShowEvent",value:function(a){var b={pageIndex:this.options.currPageIndex+1,totalPages:this.options.totalPages,lmsconnected:this.lmsconnected,scormMode:this.scormMode};PearsonGL.globals.comm.isReady(),$(document).triggerHandler("PageShowEvent",b),this.setPagingButtonState()}},{key:"populateGadgets",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pageArray,c=arguments[2],d=this,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.options.id,g=[];$.isNumeric(c)||(c=this.options.currPageIndex),$("#"+e+b[c].options.id).find("[data-gadget]").each(function(e,h){var i=$(h),j=i.attr("data-id");g.push(j),d.populateGadget(i,a,j,b,c,f)}),b.isSubmitted&&this.toggleTabbing(!1),this.isPageLevelScorm&&this.checkGadgetsCompleted(),$(".loading, .dialog-modal").remove();var h=this.options.pages[c].flexible_layouts;return PearsonGL.utils.isNonEmptyArray(h)&&h.forEach(function(a){$("#"+d.options.pages[c].id+' *[data-id="'+a.id+'"]').removeClass("split-column").addClass(a.layout)}),g}},{key:"populateGadget",value:function(a,b,c,d,e,f){var g=d[e].options,h=b[c].type,i=b[c].json,j=f+"_"+g.id+"_"+c;if("object"!==(void 0===i?"undefined":_typeof(i)))return PearsonGL.logger.warn("Gadget "+h+" failed to load due to missing JSON config."),a.append("<b>THIS "+h.toUpperCase()+" IS MISSING ITS OPTIONS!</b>"),a.addClass("gadget-fail"),void((-1===window.location.href.indexOf("playerdev.html")||this.hideGadgetFailure)&&a.remove());try{if(i.runtimejson=$.extend({},this.options.runtimejson),i.pageType=g.name,"g_title"===c&&(i.runtimejson.highlightingEnabled=!1),h.toLowerCase()!==i.class.toLowerCase()&&!/^DrawPad/.test(h))throw"gadget options class name doesn't match layout class name";var k=new window.PearsonGL.Gadget[h](a,i,j);"Presentation"===h&&(this.presentation=k),g.gadgetArray.push(k),this.gadgetsHash[j]=k,a.data("gadgetUniqueId",j),(k.options.scormOn||k.isCommEnabled())&&PearsonGL.utils.isNonEmptyArray(k.options.scorm.interactions)&&k.options.scorm.interactions.forEach(function(a){PearsonGL.utils.isNonEmptyArray(a.objectives)&&a.objectives.forEach(function(a){a.score.min=isNaN(a.score.min)?0:a.score.min})})}catch(b){PearsonGL.logger.error(h+" failed to load:"),PearsonGL.logger.error(b),window.location.href.indexOf("playerdev.html")>-1&&!this.hideGadgetFailure?(a.append("<b>THIS "+h.toUpperCase()+" FAILED TO LOAD!</b>"),a.addClass("gadget-fail")):(a.append("<span class='gadget-fail-message'>Loading Error</span>"),a.addClass("gadget-fail-player"))}}},{key:"iterateCurrentPageGadgets",value:function(a){var b=this.pageArray[this.options.currPageIndex],c=b.options.gadgetArray;Array.isArray(c)&&c.forEach(a)}},{key:"unloadAllGadgets",value:function(){for(var a=this.pageArray[this.options.currPageIndex],b=a.options.gadgetArray,c=0;c<b.length;c++)b[c].gadgetUnload();PearsonGL.globals.comm.commit(),this.stopAll(),this.endScoTimer(),this.endPageTimer()}},{key:"disableAllGadgets",value:function(){$("text, textarea, select").attr("disabled","disabled"),0===$("div.disableField").length&&$('\n\t\t\t\t<div class="disableField">\n\t\t\t\t\t<p>'+this.options.reviewModeMessage+"</p>\n\t\t\t\t</div>\n\t\t\t").appendTo("#main-id")}},{key:"updatePageLock",value:function(){var a=this.pageArray[this.options.currPageIndex],b=a.options.gadgetArray,c=!0;if(this.options.runtimejson.lockstep&&"normal"===this.scormMode){if(!a.isDone)a:for(var d=0;d<b.length;d++){var e=b[d].options;if(void 0!==e.scorm&&void 0!==e.scorm.interactions)for(var f=0;f<e.scorm.interactions.length;f++)for(var g=e.scorm.interactions[f],h=0;h<g.objectives.length;h++)if("completed"!==g.objectives[h].completion_status){c=!1;break a}}if(this.isNextLocked=!c,this.setPagingButtonState(!0),!this.isNextLocked&&this.options.currPageIndex+1===this.options.totalPages){$(".sco").find("#next").hasClass("next-submit-button")&&$("body").removeClass("lockstep-active")}}}},{key:"checkGadgetsCompleted",value:function(){var a=this.pageArray[this.options.currPageIndex],b=a.options.gadgetArray,c=1;if(PearsonGL.globals.comm)a:for(var d=0;d<b.length;d++){var e=b[d].options;if(void 0!==e.scorm&&void 0!==e.scorm.interactions)for(var f=e.scorm.interactions,g=0;g<f.length;g++)for(var h=f[g].objectives,i=0;i<h.length;i++)if("completed"!==h[i].completion_status){c=0;break a}}this.isPageLevelScorm||this.isPageGadgetScorm?this.setPageLevelScorm(c):a.isDone=c,this.setBookmark(),this.translateHandlerOn=!1,this.updateSMTranslate()}},{key:"goToPage",value:function(a){this.stopAll(),this.checkGadgetsCompleted(),this.callPageDirect(a)}},{key:"callPageDirect",value:function(a){var b=["main"],c=0;if(void 0!==a&&(a+="",b=a.split(":")),("supplemental"===b[0].toLowerCase()||"supp"===b[0].toLowerCase())&&2===b.length&&parseInt(b[1],10)<=this.supplementalPageArray.length)return this.isShowingSupplementPage=!0,void this.populatePage(this.supplementalPageArray,parseInt(b[1],10)-1,"supplemental",this.supplementalJsonData.id);if(this.isShowingSupplementPage=!1,"main"===b[0].toLowerCase()&&2===b.length)c=parseInt(b[1],10)-1;else if($.isNumeric(a)||"supplemental"===b[0].toLowerCase()||"supp"===b[0].toLowerCase())$.isNumeric(a)&&(c=parseInt(a,10)-1);else if(void 0!==a)for(var d=0;d<this.pageArray.length;d++)if(a==this.pageArray[d].options.id){c=d;break}c>=this.pageArray.length&&(c=0),this.options.currPageIndex=parseInt(c,10),this.populatePage(),this.hideDialogBoxes(),this.setBookmark(!0)}},{key:"canUserJumpPages",value:function(){return!(this.options.runtimejson.lockstep&&"normal"===this.scormMode)}},{key:"next",value:function(){return this.checkGadgetsCompleted(),this.hideDialogBoxes(),this.endPageTimer(),this.options.currPageIndex<this.options.totalPages-1&&(this.sendAnalytics("clicked_page_next"),this.stopAll(),this.options.currPageIndex++,this.populatePage(),this.isPrevDisabled=!1,$("#prev").removeClass("prev-disable").attr("aria-disabled",!1)),this.options.currPageIndex>=this.options.totalPages-1&&(this.isNextDisabled=!0,$("#next").addClass(this.getNextButtonStyle())),this.setBookmark(!0),window.scroll(0,0),this.options.currPageIndex+1}},{key:"prev",value:function(){return this.checkGadgetsCompleted(),this.hideDialogBoxes(),this.endPageTimer(),this.options.currPageIndex>0&&(this.sendAnalytics("clicked_page_back"),this.stopAll(),this.options.currPageIndex--,this.populatePage(),this.isNextDisabled=!1,$("#next").removeClass("next-disable").removeClass("next-submit-button")),0===this.options.currPageIndex&&(this.isPrevDisabled=!0,$("#prev").addClass("prev-disable"),$("#prev").attr("aria-disabled",!0)),this.options.currPageIndex+1<this.options.totalPages&&$("#next").removeClass("next-disable").removeClass("next-submit-button").attr("aria-disabled",!1),this.setBookmark(!0),window.scroll(0,0),this.options.currPageIndex+1}},{key:"updateIndex",value:function(a,b){var c=$("#next");if($("#pageIndex").html("\n\t\t\t<span class='currentPageHighlight footer-page-number'>"+a+"</span>\n\t\t\t"+this.options.of+"\n\t\t\t<span class='total-pages footer-page-number'>"+b+"</span>\n\t\t"),this.submitDialog.isFooterSubmit&&"normal"===this.scormMode&&!this.options.hasEnav){1===a&&b>1&&a<b?(c.removeClass("next-submit-button"),c.attr("title",this.labelOpts.nextButtonHover)):a===b&&(c.addClass("next-submit-button"),c.attr("title",this.labelOpts.nextButtonHover));var d=c.hasClass("next-submit-button")?this.labelOpts.altSubmitHeaderButtonTooltip:this.labelOpts.nextButtonHover;c.attr("title",d)}}},{key:"setPagingButtonState",value:function(a){var b=$("#prev"),c=$("#next"),d=this.options.totalPages,e=this.options.currPageIndex+1;e<=d&&1===e?(this.isNextDisabled=!1,this.isPrevDisabled=!0,b.addClass("prev-disable"),c.removeClass(this.getNextButtonStyle())):(this.isNextDisabled=!1,this.isPrevDisabled=!1,b.removeClass("prev-disable"),c.removeClass("next-disable").removeClass("next-submit-button")),e>=d&&(this.isNextDisabled=!0,this.isPrevDisabled=!1,b.removeClass("prev-disable"),c.addClass(this.getNextButtonStyle())),1!==d&&0!==d||(this.isNextDisabled=!0,this.isPrevDisabled=!0,b.addClass("prev-disable"),c.addClass("next-disable")),this.isNextLocked&&(this.isNextDisabled=!0,c.addClass("next-disable")),a||this.updateIndex(this.options.currPageIndex+1,this.options.totalPages),"normal"!==this.scormMode&&e<=d&&c.removeClass("next-submit-button"),b.attr("aria-disabled",b.hasClass("prev-disable")),c.hasClass("next-submit-button")||c.attr("aria-disabled",c.hasClass("next-disable"))}},{key:"getNextButtonStyle",value:function(){return this.isNextLocked||this.submitDialog.dialogType===this.submitDialog.DT_NO_DIALOG||"normal"!==this.scormMode||this.options.currPageIndex+1!==this.options.totalPages?"next-disable":this.submitDialog.isFooterSubmit&&!this.options.hasEnav?"next-submit-button":"next-disable"}},{key:"canActivateSubmitButton",value:function(){return!this.options.hasEnav&&this.submitDialog.dialogType!==this.submitDialog.DT_NO_DIALOG&&"review"!==this.scormMode&&"browse"!==this.scormMode&&this.submitDialog.isFooterSubmit&&!this.isNextLocked}},{key:"toggleTabbing",value:function(a){a?($(".sco div").find("[tabindex]").attr("tabindex","0"),$("textarea, input, button").not(".persist-disabled").removeAttr("disabled"),$(".logo").focus()):($(".sco div").find("[tabindex]").attr("tabindex","-1"),$("textarea, input, button").attr("disabled","disabled"))}},{key:"hideModalAndDialogs",value:function(){this.hideDialogBoxes(),$(".dialog-modal").hide(),this.isSubmitted&&this.lmsconnected&&$(".dialog-modal, .disableField").remove()}},{key:"hideDialogBoxes",value:function(){$("#dialog-confirm-before-submit, #dialog-confirm, #dialog-confirm-short, #dialog-final-confirm").hide(),$(".description-pop-up").remove(),this.submitDialog&&this.addFocusTrap()}},{key:"addFocusTrap",value:function(){var a=$("body").find("[aria-labelledby='your-progress']:visible"),b=$(a).attr("id"),c=$("body").find(".info-bar-done"),d=this.submitDialog;if(!d||2!==d.version)if(a.length>0){this.returnFocusTo=PearsonGL.utils.getActiveElement(),this.focusDialog=a[0];var e=this.focusDialog,f={nodeFocusedBeforeActivation:this.returnFocusTo};this.doFocusTrap=new PearsonGL.utils.doFocusTrap(e,f),this.focusTrap=this.doFocusTrap.focusTrap(e,{onActivate:function(){$(e).addClass("trap is-active"),$(".dialog-modal").show()},onDeactivate:function(){if($(e).removeClass("is-active"),d.dialogType===d.DT_PROGRESS_DIALOG){"dialog-confirm-before-submit"===b&&($(e).find(".continue-btn").blur(),$(e).find(".dialog-close-btn").blur());var g=$(a).find(".dialog-close-btn.close-text").length,h=$(a).find(".submit-btn");1===g&&(c.focus(),f.nodeFocusedBeforeActivation=c,$(".dialog-modal").hide()),"dialog-confirm-before-submit"===b&&$(PearsonGL.utils.getActiveElement()===h[0])&&(c.focus(),f.nodeFocusedBeforeActivation=c,$(".dialog-modal").hide())}d.dialogType===d.DT_CONFIRM_DIALOG&&$(".dialog-modal").hide(),$(".dialog-modal").hide(),$(e).hide()},initialFocus:this.focusDialog,escapeDeactivates:!0,nodeFocusedBeforeActivation:f.nodeFocusedBeforeActivation}),this.focusTrap.activate()}else this.focusTrap&&this.focusTrap.deactivate()}},{key:"getBookmark",value:function(){var a=PearsonGL.globals.comm.getBookmark(),b=PearsonGL.utils.getQuerystring("pageId"),c=void 0;if(PearsonGL.utils.isNonEmptyString(a)){c=a.slice(a.indexOf("_")+1);var d={};try{d=$.parseJSON(PearsonGL.globals.comm.getSuspendData())}catch(a){PearsonGL.logger.warn("error parsing suspend data JSON")}if(d="object"===(void 0===d?"undefined":_typeof(d))?d:{},Array.isArray(d.pages)){var e=d.pages.filter(function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PearsonGL.utils.isNonEmptyString(a.id)&&a.data&&"number"==typeof a.data.pageDone});this.pageArray.forEach(function(a){e.forEach(function(b){var c=b.id.slice(b.id.indexOf("_")+1);a.options.id===c&&(a.isDone=b.data.pageDone)})})}else this.pageArray.forEach(function(a){for(var b in d){var c=b.slice(b.indexOf("_")+1);a.options.id===c&&(a.isDone=1===d[b].pageDone?1:0)}})}b&&this.canUserJumpPages()?this.callPageDirect(b):c?this.callPageDirect(c):this.callPageDirect()}},{key:"setBookmark",value:function(a){if(!this.isSubmitted&&"browse"!==this.scormMode&&"review"!==this.scormMode&&this.pageArray.length>0){var b=this.options.id,c=this.pageArray[this.options.currPageIndex].options.name,d=this.pageArray[this.options.currPageIndex].options.id,e=this.pageArray[this.options.currPageIndex],f=b+"_"+d,g={pageDone:e.isDone};PearsonGL.globals.comm&&(PearsonGL.globals.comm.setBookmark(f),PearsonGL.globals.comm.setSuspendDataById(f,c,g),a&&PearsonGL.globals.comm.commit())}}},{key:"isScoreEnabled",value:function(a){this.pageSettings[a]||(this.pageSettings[a]={});var b=this.pageSettings[a];if(b.hasScore)return void PearsonGL.globals.comm.setScoreStatus(b.hasScore);b.hasScore=!1;var c=this.pageArray[a],d=c.options.gadgetArray;if("normal"===this.scormMode)if(this.isPageLevelScorm)b.hasScore=!0;else for(var e=0;e<d.length&&!0!==b.hasScore;e++){var f=d[e].options;if(void 0!==f.scorm&&void 0!==f.scorm.interactions)for(var g=0;g<f.scorm.interactions.length;g++){b.hasScore=!0;break}}PearsonGL.globals.comm.setScoreStatus(b.hasScore)}},{key:"setPageLevelScorm",value:function(a){var b=this.pageArray[this.options.currPageIndex];if(1!==b.isDone){var c=this.options.id+"_"+this.pageArray[this.options.currPageIndex].options.id+"_"+b.options.name;if(b.options.gadgetName="page_scorm_"+b.options.id,$.extend(b.options.scorm,this.options.runtimejson.pageScorm),PearsonGL.globals.comm.getLearnerData({id:c,objectiveDesc:b.options.name+" is presented to the Learner",name:b.options.gadgetName,objectType:b.options.objectType,data:b.options.scorm,weighting:1}),PearsonGL.globals.comm.setLearnerData({id:c,data:b.options.scorm,results:[{raw:b.options.scorm.interactions[0].objectives[0].score.max,max:b.options.scorm.interactions[0].objectives[0].score.max,progressMeasure:1,completionStatus:"completed",successStatus:"passed"}]}),b.options.scorm.interactions.length>0)for(var d=b.options.scorm.interactions,e=0;e<d.length;e++)for(var f=b.options.scorm.interactions[e],g=f.objectives,h=0;h<g.length;h++)g[h].score.max=isNaN(g[h].score.max)?0:g[h].score.max,g[h].score.min=isNaN(g[h].score.min)?0:g[h].score.min;this.isPageGadgetScorm?b.isDone=1===a?1:0:b.isDone=1}}},{key:"displaySubmitDialog",value:function(a){this.submitDialog.displaySubmitDialog(a)}},{key:"handlePostMessage",value:function(a){"StopAllAudioVideo"===a&&this.stopAll()}},{key:"sendAnalytics",value:function(a,b){this.analyticsData.label=a,this.analyticsData.value=b,PearsonGL.globals.comm.sendAnalytics(this.analyticsData)}},{key:"startScoTimer",value:function(){var a=new Date;this.startcount=Math.floor(a.getTime()/1e3)}},{key:"endScoTimer",value:function(){var a=new Date,b=Math.floor(a.getTime()/1e3),c=b-this.startcount;this.sendAnalytics("sco_accessed",c)}},{key:"startPageTimer",value:function(){var a=new Date;this.startPageCount=Math.floor(a.getTime()/1e3)}},{key:"endPageTimer",value:function(){var a=new Date,b=Math.floor(a.getTime()/1e3),c=b-this.startPageCount;this.sendAnalytics("sco_closed_page "+(this.options.currPageIndex+1)+" of "+this.options.pages.length,c),this.startPageTimer()}},{key:"stopAudio",value:function(){var a=this.isShowingSupplementPage?this.supplementalPageArray[this.options.currPageIndex]:this.pageArray[this.options.currPageIndex];if(a){var b=$("#"+a.options.id),c=b.find(".audioToggleIdentifier, #audio-component");c.length>0&&$.each(c,function(a,b){$(this).audioComponent("pause")})}}},{key:"setAudioVolumes",value:function(a){var b=this.isShowingSupplementPage?this.supplementalPageArray[this.options.currPageIndex]:this.pageArray[this.options.currPageIndex],c=b.options.gadgetArray;if(b){var d=$("#"+b.options.id);d.find(".audioToggleIdentifier, #audio-component").each(function(b,c){$(this).audioComponent("setVolume",a)}),d.find(".video-component-identifier").each(function(b,c){$(this).videoComponent("setVolume",100*a)}),c.forEach(function(b){PearsonGL.Gadget.AudioPlayer&&b instanceof PearsonGL.Gadget.AudioPlayer?b.setVolume(100*a):PearsonGL.Gadget.VideoPlayer&&b instanceof PearsonGL.Gadget.VideoPlayer&&b.setVolume(100*a)})}}},{key:"stopAll",value:function(){for(var a=this.pageArray[this.options.currPageIndex],b=a.options.gadgetArray,c=0;c<b.length;c++){b[c].stop(),$.isFunction(b[c].sendCumulativeAnalytics)&&b[c].sendCumulativeAnalytics();var d=$(b[c].getjObject()),e=d.find(".video-component-identifier");e.length>0&&e.videoComponent("stop"),d.find(".audioToggleIdentifier, #audio-component").each(function(a,b){$(b).audioComponent("pause")})}}},{key:"textToSpeech",value:function(){var a=this,b=$(".text-to-speech"),c=!1,d=void 0;b.sliderbutton({buttonClassName:"text-to-speech",slider:!1,clickFunction:function(b,e){c?(d=$("#thss-toolbar").css("left"),$("#thss-toolbar").hide().css("left",-9999),c=!1):($("#thss-toolbar").length>0?$("#thss-toolbar").show().css("left",d):TexthelpSpeechStream.addToolbar(PearsonGL.utils.getScoId(),parseInt(a.options.currPageIndex+1)),c=!0)}}),$(document).bind("PageShowEvent",function(b){"function"==typeof $rw_setPageId&&$rw_setPageId(parseInt(a.options.currPageIndex+1))})}},{key:"showTranslateButton",value:function(){var a=this,b=$("body").find(".translate-button");b.sliderbutton({buttonClassName:"translate-button",slider:!1,clickFunction:function(b,c){PearsonGL.globals.useSMTranslate=!PearsonGL.globals.useSMTranslate,a.updateSMTranslate()}}),b.show(),$(document).bind("PageShowEvent",function(b){"function"==typeof $rw_setPageId&&$rw_setPageId(parseInt(a.options.currPageIndex+1)),a.updateSMTranslate()})}},{key:"addTranslationLanguage",value:function(a){!1===a.hasAudio||"false"===a.hasAudio?texthelp.SpeechStream.ui.translateData.translateAutoSpeech=!1:texthelp.SpeechStream.ui.translateData.translateAutoSpeech=!0,$rw_setTranslateTarget(a.language)}},{key:"updateSMTranslate",value:function(){var a=$("body"),b=this;!0===PearsonGL.globals.useSMTranslate?(a.find(".translate-button").addClass("translate-red"),a.find("p, img, td, th, .tilesort").addClass("translate-cursor"),a.find("svg").attr("class","translate-cursor"),a.find(".picklist-wrapper p, .button-text p, .base-button p, .c-tile p").removeClass("translate-cursor"),a.addClass("body-border"),a.prepend('<div class="translate-border-top" /><div class="translate-border-left" />'),a.find(".translate-button").css("right","16px")):(a.find(".translate-button").removeClass("translate-red"),a.find("p, img, td, th, svg, .tilesort, .dialog-correct, .dialog-incorrect").removeClass("translate-cursor"),a.removeClass("body-border"),a.find(".translate-border-top, .translate-border-left").remove(),a.find(".translate-button").css("right","")),!0===PearsonGL.globals.useSMTranslate&&!1===this.translateHandlerOn&&$("p, img, td, th, svg").not("a, .button-text, .button-text > p, .base-button, .base-button > p").click(function(a){$(a.target).is(":input")||(b.translateHandlerOn=!0,!0===PearsonGL.globals.useSMTranslate&&(PearsonGL.globals.player.stopAudio(),$rw_successmakerTranslateSection($(this)[0])))}),$(".tilesort").not(".c-tile").click(function(){var a=$(this).find("img");!0===PearsonGL.globals.useSMTranslate&&void 0!==a&&$rw_successmakerTranslateSection(a[0])})}},{key:"printCurrentPage",value:function(){var a=this,b=this.pageArray[this.options.currPageIndex],c=b.options.gadgetArray,d=b.options.id,e=[],f=[];$(".footer").hide();for(var g=0;g<c.length;g++){var h=c[g].options;if("HotSpot"===h.gadgetName)$(".hotspot").css("width","960px"),$(".pop-up").css({position:"relative","max-height":"none"}),$(".pop-up .container").css({"max-height":"none"});else if("MultipleLayers"===h.gadgetName){this.jObject.find(".multiple-layers").css("width","960px");for(var i=this.jObject.find(".ui-accordion-content"),j=0;j<$(".ui-accordion-content").length;j++)"block"===i[j].style.display&&f.push(j);i.show(),this.jObject.find(".multi-layer-info-box").css({position:"relative"}),this.jObject.find(".info-layer-all").css({height:"auto","max-height":"none"})}}html2canvas(document.body,{onrendered:function(b){$(".print-shot").remove(),$("body").append('<div class="print-shot"></div>'),a.stopAll();for(var g=0;g<c.length;g++){var h=c[g].options;if(void 0!==h.groups)for(var i=0;i<h.groups.length;i++)e.push(h.groups[i].groupName)}a.options.runtimejson.printOptions&&a.options.runtimejson.printOptions.addCommonCore&&$(".sco").prepend('<div class="print-common-core" style="height:0">'+$(".footer-text").html()+"</div>");var j=$(".sco-title").html();a.options.runtimejson.printOptions&&a.options.runtimejson.printOptions.addScoTitle&&void 0!==j&&$(".sco").prepend('<div class="print-sco-title" style="height:0">'+j+"</div>"),0===$(".print-div").length&&$(".print-shot").append('<div class="print-div"></div>');var k=$(".print-div"),l=!1,m="";$("#"+d+" textarea").each(function(a,b){var c=$(b);c.parent().hasClass("max-len-wrapper")&&($(".max-length-found").remove(),c.unwrap());var d=c.parent().find(".gadget-textblock").html(),f=c.parent().attr("id");if(c.get(0).scrollHeight>c.height()&&(l=!0),""!==c.val()&&null!==c.val()){if(void 0!==d)k.append('<span class="print-title">'+d+"</span><br /><br />");else{var g=f.replace(/[^0-9]/g,"");m!==f&&(void 0!==e[g]&&k.append('<span class="group-title">'+e[g]+"</span><br /><br />"),m=f)}c.val()!==c.attr("placeholder")&&k.append(c.val()+"<br /><br />")}}),l&&!$(".worksheet-fixed-layout")||k.remove(),$(".worksheet-fixed-layout")||($(".print-shot").prepend(b),$(".sco").hide()),window.print(),window.setTimeout(function(){if($(".first-page-title, .print-sco-title, .print-common-core").remove(),k.remove(),$(".print-shot").remove(),$(".footer, .sco").show(),$(".hotspot").css("width",""),$(".pop-up").css({position:"absolute","max-height":""}),$(".pop-up .container").css({"max-height":""}),$(".ui-accordion-content").hide(),f.length>0)for(var a=0;a<f.length;a++)$(".ui-accordion-content")[f[a]].style.display="block";$(".multiple-layers").css("width",""),$(".info-layer-all").css({height:"","max-height":""}),$(".multi-layer-info-box").css({position:"",height:""})},500)}})}}]),a}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},product={};window.PearsonGL=window.PearsonGL||{},window.PearsonGL.globals=window.PearsonGL.globals||{},window.PearsonGL.Player=function(){global_player=this,PearsonGL.utils.ieAjaxOfflineSupport(),this.initialize()},window.PearsonGL.Player.prototype={initialize:function(){var a=this,b=this,c=new $.Deferred,d=new $.Deferred;this.options={totalPages:0,pages:[]},this.utilDlinkText="",this.utilSkipNavText="",this.utilSkipLinkText="",this.utilDlinkWinTitle="",this.utilDlinkPointsText="",this.utilCloseDlinkText="Close",this.utilLongDescText="",this.utilLongDescTitle="",this.utilCloseDescText="Close",this.isTouch="ontouchstart"in document.documentElement,this.sectionLoadedDeferred=$.Deferred(),this.parmDeferred=$.Deferred(),this.parseParmJsonDeferred=$.Deferred(),this.metadataJsonDeferred=new $.Deferred,this.commDeferred=new $.Deferred,this.hasShownFlashTrustedAlert=!1,this.scoJson={},this.allowUnloadExit=!0,this.lastActivityTime=new Date,this.settings={hasReplaceableVals:!1,user:{},masterVolume:1},this.autosaveLockKeys={},this.globalScoRootPath="",this.rootScoPath="",this.isEditParmMode=!1,PearsonGL.globals.audioContext=null,PearsonGL.globals.masterVolumeGainNode=null,PearsonGL.globals.useSMTranslate=!1,this.preloadAudio={hasStarted:!1,loadedAudio:{},waitingToLoadAudio:[],hasInteracted:!1,loadingAudio:[],deferreds:{}},PearsonGL.globals.audioComponentCount=0,PearsonGL.globals.browserData=PearsonGL.utils.browserDetect();try{PearsonGL.globals.disableButtonAutoplay="true"===PearsonGL.utils.getQuerystring("noap",""),PearsonGL.globals.disableButtonAutoplay=PearsonGL.globals.disableButtonAutoplay||window.localStorage&&"true"===window.localStorage.getItem("noap")}catch(a){}if(PearsonGL.globals.isUnloading=!1,-1!==document.location.href.indexOf("player.html"))this.globalScoRootPath=document.location.href.split("player.html")[0];else if(-1!==document.location.href.indexOf("playerdev.html"))this.globalScoRootPath=document.location.href.split("playerdev.html")[0];else if(PearsonGL.utils.isOnDCATEditMode())try{var e=window.parent.pagePreviewPath||pagePreviewPath;this.globalScoRootPath=e.substring(0,e.lastIndexOf("/")+1),PearsonGL.globals.disableButtonAutoplay=!0}catch(a){}else try{this.isEditParmMode=!0;var f;if(Com.Gadget.Config)f=Com.Gadget.Config.AssetManager.BASE,this.rootScoPath="/samples/"+f.substring(f.indexOf("digitalpath"))+"/",this.globalScoRootPath="/authored/"+f.substring(f.indexOf("digitalpath"))+"/"+scoidconfig+"/";else{var f=Com.Gadget.AssetManager.BASE;this.rootScoPath=f,this.globalScoRootPath=f.replace(/samples/i,"authored"),this.globalScoRootPath+=scoidconfig+"/"}}catch(a){}PearsonGL.globals.globalScoRootPath=this.globalScoRootPath,this.defaultQValue=PearsonGL.utils.isOnDCAT()||b.isEditParmMode?(new Date).getTime():"",this.paths={scoJsonPath:this.globalScoRootPath+"auth/sco.json?q="+PearsonGL.utils.getQuerystring("q",this.defaultQValue),playerJsonPath:this.globalScoRootPath+"auth/player.json?q="+PearsonGL.utils.getQuerystring("q",this.defaultQValue),metadataJsonPath:this.globalScoRootPath+"auth/metadata.json?q="+PearsonGL.utils.getQuerystring("q",this.defaultQValue),parametersJsonPath:this.globalScoRootPath+"auth/parameters.json?q="+PearsonGL.utils.getQuerystring("q",this.defaultQValue),runtimeJsonPath:this.rootScoPath+"config/runtime.json?q="+PearsonGL.utils.getQuerystring("q",this.defaultQValue)},$.when(c,d,b.parmDeferred).then(this.loadMetadataJson.bind(this)),$("<div></div>").load(this.paths.scoJsonPath,function(a,d){b.scoJson=$.parseJSON(a),c.resolve()}),PearsonGL.globals.runtimeJson?(this.processRuntimeJsonData(PearsonGL.globals.runtimeJson),d.resolve()):$("<div></div>").load(this.paths.runtimeJsonPath,function(a,c){b.processRuntimeJsonData(a),d.resolve()}),$(window).bind("scroll.headerfix",function(){var a,b=$(window).scrollTop(),c=$("body").find("#header-id");c.length>0&&void 0!==c.offset()&&(a=c.offset().top,Math.abs(b-a)>1&&(c.css("position","absolute"),window.setTimeout(function(){c.css("position","fixed")},1)))}),$(window).resize(function(b){clearTimeout(a.resizeTimer),a.resizeTimer=setTimeout(function(){if($("body").hasClass("chrome")){if(!PearsonGL.utils.isDevToolsOpen()){var a=document.getElementsByTagName("body")[0];PearsonGL.utils.detectZoom()>1?a.classList.add("zoom-in"):a.classList.remove("zoom-in")}}else{var b=document.getElementsByTagName("body")[0];$("body").hasClass("firefox")&&$("body").hasClass("mac")&&2===window.devicePixelRatio?PearsonGL.utils.detectZoom()>2?b.classList.add("zoom-in"):b.classList.remove("zoom-in"):PearsonGL.utils.detectZoom()>=1.05?b.classList.add("zoom-in"):b.classList.remove("zoom-in")}},200)}),$(window).ready(function(b){clearTimeout(a.resizeTimer),$("body").hasClass("chrome")?PearsonGL.utils.isDevToolsOpen()||(a.resizeTimer=setTimeout(function(){var a=document.getElementsByTagName("body")[0];PearsonGL.utils.detectZoom()>1?a.classList.add("zoom-in"):a.classList.remove("zoom-in")},200)):a.resizeTimer=setTimeout(function(){var a=document.getElementsByTagName("body")[0];$("body").hasClass("firefox")&&$("body").hasClass("mac")&&2===window.devicePixelRatio?PearsonGL.utils.detectZoom()>2?a.classList.add("zoom-in"):a.classList.remove("zoom-in"):PearsonGL.utils.detectZoom()>=1.05?a.classList.add("zoom-in"):a.classList.remove("zoom-in")},200)}),PearsonGL.globals.browserData.specialFlags.isIE&&$("body").on("mouseup touchend","a",function(a){/^javascript:playerGoToPage/i.test($(this).attr("href"))&&(b.allowUnloadExit=!1),setTimeout(function(){b.allowUnloadExit=!0},0)}),PearsonGL.globals.browserData.specialFlags.isiOS&&"onpagehide"in window||window.chrome&&chrome.runtime&&chrome.runtime.id?window.addEventListener("pagehide",function(a){PearsonGL.globals.isUnloading=!0,b.exit()}):window.addEventListener("beforeunload",function(a){PearsonGL.globals.isUnloading=!0,b.allowUnloadExit&&b.exit()}),$(window).on("firstAudioAutoplayComplete",function(){b.hasParmContent&&!b.preloadAudio.hasStarted&&b.preloadAudioSeq()}),$(window).on("orientationchange",function(){PearsonGL.utils.iOSMathJaxFix()}),window.playerGoToPage=this.goToPage.bind(this),this.applyiOSLockupFix(),this.applyMathJaxZoomFix()},loadMetadataJson:function(){function a(a){(PearsonGL.utils.isOnDCAT()||c.isEditParmMode)&&"Authored"===a.scoType&&(c.paths.playerJsonPath=c.globalScoRootPath+"../"+a.masterSCOId+"/auth/player.json?q="+PearsonGL.utils.getQuerystring("q",c.defaultQValue))}function b(a){$.getJSON(a,function(a){$.extend(!0,c.settings,a),c.startPlayer(c.scoJson)})}var c=this;PearsonGL.globals.metadata?(this.metadataJsonDeferred.resolve(PearsonGL.globals.metadata),globalPlayerJsonObj?($.extend(!0,this.settings,globalPlayerJsonObj),this.startPlayer(this.scoJson)):(a(PearsonGL.globals.metadata),$("<div></div>").load(this.paths.playerJsonPath,function(a,b){var d=$.parseJSON(a);$.extend(!0,c.settings,d),c.startPlayer(c.scoJson)}))):$.getJSON(this.paths.metadataJsonPath,function(d){PearsonGL.globals.metadata={scoType:d.ScoType,masterSCOId:d.MasterSCO,scoId:d.SCOID},c.metadataJsonDeferred.resolve(PearsonGL.globals.metadata),a(PearsonGL.globals.metadata),$.getJSON(c.paths.playerJsonPath,function(a){$.extend(!0,c.settings,a),c.startPlayer(c.scoJson)}).fail(function(){b(c.paths.playerJsonPath)})}).fail(function(){b(c.paths.playerJsonPath)})},processRuntimeJsonData:function(a){var b=this,c=PearsonGL.globals.runtimeJson||$.parseJSON(a);if(c){if(c.replaceableVals&&(this.settings.hasReplaceableVals=!0,this.updateWithURLParams(c)),$.extend(!0,this.settings,c),this.runtimeJson=c,this.runtimeJson&&this.runtimeJson.enableAudioContext&&!PearsonGL.utils.isOnDCATEditMode()&&!PearsonGL.utils.isOnDCAT())try{window.AudioContext=window.AudioContext||window.webkitAudioContext,PearsonGL.globals.audioContext=new AudioContext,PearsonGL.globals.masterVolumeGainNode=PearsonGL.globals.audioContext.createGain(),PearsonGL.globals.masterVolumeGainNode.gain.value=this.settings.masterVolume,PearsonGL.globals.masterVolumeGainNode.connect(PearsonGL.globals.audioContext.destination)}catch(a){}this.hasParmContent=this.runtimeJson.authoring&&this.runtimeJson.authoring.hasParmContent,this.hasCJS=this.hasParmContent||this.runtimeJson.authoring&&this.runtimeJson.authoring.hasCJS,this.hasParmContent?$("<div></div>").load(this.paths.parametersJsonPath,function(a,c){try{b.parmJson=$.parseJSON(a),PearsonGL.utils.findAuthAssetUrl(b.parmJson)}catch(a){console.error("unable to parse parameters JSON: "+a)}b.parmDeferred.resolve()}):this.parmDeferred.resolve()}},startPlayer:function(a){var b,c=this,d=this,e=$.Deferred();PearsonGL.globals.useLocalStorage=d.settings.useLocalStorage,PearsonGL.globals.hasLocalStorage=!1,"y"===PearsonGL.utils.getQuerystring("tc","n")&&(PearsonGL.globals.commType="tinCan");var f=parseInt(PearsonGL.utils.getQuerystring("autosave",void 0),10);!isNaN(f)&&f>=3&&f<=1800&&setInterval(function(){var a=!1;Object.keys(c.autosaveLockKeys).length>0||(c.iterateCurrentPageGadgets(function(b){b.isDirty&&(b.saveIfNeeded(),a=!0)}),a&&PearsonGL.globals.comm.saveState())},1e3*f),PearsonGL.globals.comm=new PearsonGL.CommunicationLayer(d.settings,e),e.done(function(){var c="/theme/"+a.theme;if(d.commDeferred.resolve(),$("link[data-themeLink=true]").attr("href","css"+c+"/"+a.theme+".css").attr("data-theme-name",a.theme),PearsonGL.globals.comm.subscribeToPostMessages(d.processPostMessage.bind(d)),PearsonGL.globals.metadata&&PearsonGL.globals.metadata.scoId&&PearsonGL.globals.comm.sendPlatformPostMessage({action:"getGADetails",scoId:PearsonGL.globals.metadata.scoId}),d.parseParmJsonDeferred.always(function(){if($(window).trigger("parmManagerReady"),PearsonGL.globals.comm.firePostMessageEvent({type:"parmManagerReady"}),PearsonGL.parmMgr&&PearsonGL.parmMgr.isParm("splitTimePerQ")&&PearsonGL.parmMgr.getParameter("splitTimePerQ").expression.indexOf("totalTimePerQ")>-1&&(PearsonGL.globals.audioContext=null,PearsonGL.globals.masterVolumeGainNode=null,PearsonGL.globals.isSpeedGame=!0),d.parmJson&&PearsonGL.parmMgr){if(PearsonGL.globals.browserData&&(PearsonGL.globals.browserData.specialFlags.isiOS||PearsonGL.globals.browserData.specialFlags.isAndroid)){if(!d.settings.activityTime){var a=function a(){d.preloadAudio.hasInteracted=!0,$(".sco").off("touchstart touchmove",a)};$(".sco").on("touchstart touchmove",a)}}else d.preloadAudio.hasInteracted=!0;(PearsonGL.globals.audioContext||d.preloadAudio.hasInteracted)&&d.preloadAudioSeq()}}),d.hasCJS){var e=d.globalScoRootPath+"auth/masterParameters.js?q="+PearsonGL.utils.getQuerystring("q",d.defaultQValue),f=d.globalScoRootPath+"auth/rootParameters.js?q="+PearsonGL.utils.getQuerystring("q",d.defaultQValue);PearsonGL.utils.isOnDCAT()||d.isEditParmMode?(PearsonGL.globals.metadata&&"Authored"===PearsonGL.globals.metadata.scoType&&(e=d.globalScoRootPath+"../"+PearsonGL.globals.metadata.masterSCOId+"/auth/masterParameters.js?q="+PearsonGL.utils.getQuerystring("q",d.defaultQValue)),f=d.globalScoRootPath.replace(/authored/i,"js"),f=f.substring(0,f.length-1),f=f.substring(0,f.lastIndexOf("/"))+"/rootParameters.js?q="+PearsonGL.utils.getQuerystring("q",d.defaultQValue)):PearsonGL.globals&&PearsonGL.globals.rootSCOurl&&PearsonGL.globals.rootSCOurl.length>0&&(f=PearsonGL.globals.rootSCOurl+"auth/rootParameters.js?q="+PearsonGL.utils.getQuerystring("q",d.defaultQValue));var g,h;if(PearsonGL.globals.browserData.specialFlags.isIE&&window.location.href.indexOf("http")<0){var i=document.createElement("script"),j=document.createElement("script");g=new $.Deferred,h=new $.Deferred,i.onload=function(){g.resolve()},j.onload=function(){h.resolve()},i.setAttribute("type","text/javascript"),j.setAttribute("type","text/javascript"),i.setAttribute("src",e),j.setAttribute("src",f),$("head")[0].appendChild(i),$("head")[0].appendChild(j)}else g=$.getScript(e),h=$.getScript(f),g.fail(function(a,b,c){console.error("Error downloading and executing Master CJS..."+b+": "+c)}),h.fail(function(a,b,c){console.error("Error downloading and executing Root CJS..."+b+": "+c)});d.parmJson&&PearsonGL.parmMgr?$.when(g,h).always(function(){try{PearsonGL.parmMgr.parseParmJson(d.parmJson)}catch(a){$(".main").dialogcomponent({dialogType:"feedback",resultsText:"Loading Error"}),$(".main .result-pop-up").addClass("dialog-incorrect parameters-error").fadeIn().focus(),console.error("Error evaluating parameters..."+a)}d.parseParmJsonDeferred.resolve()}):d.parseParmJsonDeferred.resolve()}else d.parseParmJsonDeferred.resolve();if(!window.skipExecution){var k=$.Deferred();d.sectionDeferreds=[],d.sectionDeferredMap={};var l,m,n=a.sections.length>1?a.sections.sort(function(a,b){return"main"==a.sectiontype?1:-1}):a.sections;for(b=0;b<n.length;b++)l=n[b].sectiontype.toLowerCase(),"footer"!==l&&"header"!==l||(d.sectionDeferredMap[l]=d.sectionDeferreds.length,d.sectionDeferreds[d.sectionDeferreds.length]=$.Deferred()),m=d.globalScoRootPath+"auth/"+n[b].sectionName+".json?q="+PearsonGL.utils.getQuerystring("q",d.defaultQValue),$("<div></div>").load(m,function(b,c){var e=!0,f=null;try{f=$.parseJSON(b),PearsonGL.utils.findAuthAssetUrl(f),d.parseParmJsonDeferred.always(function(){d.sectionSelector(f,a,k,d.settings)})}catch(a){e=!1}"error"!=c||e||(m.indexOf("footerSection.json")>-1?d.sectionDeferreds[d.sectionDeferredMap.footer].resolve():m.indexOf("headerSection.json")>-1&&d.sectionDeferreds[d.sectionDeferredMap.header].resolve())})}})},applyMathJaxZoomFix:function(){this.settings.authoring&&this.settings.authoring.HasMathML&&$("body").on("touchstart","#MathJax_ZoomOverlay, #MathJax_Zoom",function(){MathJax&&MathJax.Extension&&MathJax.Extension.MathZoom&&MathJax.Extension.MathZoom.Remove&&MathJax.Extension.MathZoom.Remove()})},applyiOSLockupFix:function(){var a=this;PearsonGL.globals.browserData.specialFlags.isiOS&&!PearsonGL.globals.browserData.specialFlags.isiOS8OrGreater&&$("body").on("touchstart",function(b){a.textInputType(b.target)&&b.target!==document.activeElement||$(b.target).hasClass("hackclass")||(a.textInputType()&&b.preventDefault(),window.top.postMessage({type:"touched"},"*"))})},updateWithURLParams:function(a){var b;if(a.replaceableVals)for(var c=Object.keys(a.replaceableVals),d=0;d<c.length;d++)b=_typeof(a.replaceableVals[c[d]]),value=PearsonGL.utils.getQuerystring(c[d],null),""!==value&&("number"===b?value=parseFloat(value):"boolean"===b&&(value="true"===value),a.replaceableVals[c[d]]=value)},loadHTMLImport:function(a,b){var c=void 0,d=void 0,e=void 0;e=function(a){document.querySelector("."+b).innerHTML=this.responseText,this.removeEventListener("error",c),this.removeEventListener("load",e)},c=function(a){this.removeEventListener("error",c),this.removeEventListener("load",e),PearsonGL.logger.log("there was an error loading the html import file")},d=new XMLHttpRequest,d.addEventListener("error",c),d.addEventListener("load",e),d.open("GET",a),d.send()},loadAudio:function(a,b){var c=this,d=a.replace(/^.*[\\\/]/,"");if(PearsonGL.globals.audioContext){if(this.preloadAudio.loadedAudio[d])return b&&b.resolve(),this.preloadAudio.loadedAudio[d];if(-1===$.inArray(a,this.preloadAudio.loadingAudio)){onError=function(){PearsonGL.logger.log("Failed to decode audio data "+a)},this.preloadAudio.loadingAudio.push(a);var e=new XMLHttpRequest;e.open("GET",a,!0),e.responseType="arraybuffer",e.onload=function(){var f=e.response;if(4===e.readyState)switch(e.status){case 200:PearsonGL.globals.audioContext.decodeAudioData(f,function(e){if(d&&d.length>0&&(c.preloadAudio.loadedAudio[d]=e,b&&b.resolve(),c.preloadAudio.deferreds[a])){var f;for(f=0;f<c.preloadAudio.deferreds[a].length;f++)c.preloadAudio.deferreds[a][f].resolve()}},onError);break;case 404:c.preloadAudio.loadedAudio[d]=null,b&&b.resolve()}},e.onError=function(){PearsonGL.logger.log("HTTP request failed: "+a)},e.send()}else b&&(this.preloadAudio.deferreds[a]||(this.preloadAudio.deferreds[a]=[]),this.preloadAudio.deferreds[a].push(b))}else if(!this.preloadAudio.loadedAudio[d])if(this.preloadAudio.hasInteracted){this.preloadAudio.loadedAudio[d]={};var f=new Audio;f.src=a}else this.preloadAudio.waitingToLoadAudio.push(a)},preloadAudioSeq:function(){var a,b,c,d;if(this.hasParmContent&&PearsonGL.parmMgr){var d,e=PearsonGL.parmMgr.getAssets("audio");for(d in e)this.loadAudio(e[d]);var f=PearsonGL.parmMgr.getAudioSeqParms();if(!1===this.preloadAudio.hasStarted&&(PearsonGL.globals.audioContext||!PearsonGL.globals.audioContext&&this.preloadAudio.hasInteracted)){if(this.preloadAudio.hasStarted=!0,this.preloadAudio.waitingToLoadAudio.length>0){for(a=0;a<this.preloadAudio.waitingToLoadAudio.length;a++)this.loadAudio(this.preloadAudio.waitingToLoadAudio[a]);this.preloadAudio.waitingToLoadAudio.length=0}for(a=0;a<f.length;a++)if(c=PearsonGL.parmMgr.getValue(f[a]))for(b=0;b<c.length;b++)PearsonGL.utils.isNonEmptyString(c[b])&&c[b].indexOf(".mp3")>-1&&this.loadAudio(PearsonGL.qtiEvaluator.evaluateAsset(c[b]))}}},textInputType:function(a){var b=a||document.activeElement,c=$(b).prop("tagName");return!!("TEXTAREA"===c||"INPUT"===c&&"text"===$(b).attr("type")||"INPUT"===c&&"password"===$(b).attr("type")||$(b).attr("contenteditable"))},fixBlur:function(){this.isTouch&&this.textInputType()&&$("#header-skip").focus().blur()},processPostMessage:function(a){var b=$("body");if("string"==typeof a)try{if(!(a=$.parseJSON(evt.data)))return}catch(a){return}if("touched"===a.type)this.fixBlur();else if("view"===a.type)"setFont"===a.method&&a.payload?(b.toggleClass("nextext-small","small"===a.payload.fontSize),b.toggleClass("nextext-medium","medium"===a.payload.fontSize),b.toggleClass("nextext-large","large"===a.payload.fontSize)):"setMode"===a.method&&a.payload&&(b.toggleClass("nextext-default","default"===a.payload.mode),b.toggleClass("nextext-night","night"===a.payload.mode),b.toggleClass("nextext-sepia","sepia"===a.payload.mode));else if("GADetails"===a.action){var c=a.GADetails||{};this.settings.user.userId=c.userId,this.settings.user.userRole=c.userRole,this.settings.user.userOrg=c.userOrg,PearsonGL.logger.log("received user data, userId: '"+c.userId+"', userRole: '"+c.userRole+"', userOrg: '"+c.userOrg+"'")}},sectionSelector:function(a,b,c){var d=this;if("main"==a.type.toLowerCase())$.when.apply($,this.sectionDeferreds).done(function(){a.scoTotals=b.scoTotals,d.options.pages=new PearsonGL.Pages("."+a.type,a,d.settings),d.options.totalPages=a.pages.length,d.options.totalPages>1&&$("html").addClass("multi-page"),d.setPagingButtonsEvents(),c.resolveWith(d)});else if("supplemental"===a.type.toLowerCase())c.done(function(){this.options.pages.setSupplementalPages(a)});else{var e;"footer"!==a.type.toLowerCase()&&"header"!==a.type.toLowerCase()||(e=this.sectionDeferreds[this.sectionDeferredMap[a.type]]),this.options[a.type]=new PearsonGL.Section("."+a.type,a,e,this.settings)}},loadingModal:function(){void 0!==this.options.pages.options.runtimejson.spinner&&1!=this.options.pages.options.runtimejson.spinner||($("body").append('<div class="loading"></div><div class="dialog-modal"></div>'),this.spinner=new Spinner({color:"#0072B4"}).spin(),$("body").find(".loading").append(this.spinner.el))},listenForKey:function(a,b){13===b.keyCode||32===b.keyCode?"next"===a?this.options.pages.updateIndex(this.options.pages.next(),this.options.totalPages):this.options.pages.updateIndex(this.options.pages.prev(),this.options.totalPages):9===b.keyCode&&"next"===a&&$(".logo").focus()},setPagingButtonsEvents:function(){var a=this,b=this.options.pages,c={buttonClassName:"prev",slider:!1},d={buttonClassName:"next",slider:!1};$("#prev").click(function(){b.isPrevDisabled||(global_player.loadingModal(),a.options.pages.updateIndex(a.options.pages.prev(),a.options.totalPages))}).keydown(function(c){b.isPrevDisabled||a.listenForKey("prev",c)}).sliderbutton(c),$("#next").click(function(){b.isNextDisabled?b.canActivateSubmitButton()&&(b.sendAnalytics("clicked_submit_button_lastpage"),b.displaySubmitDialog()):(global_player.loadingModal(),a.options.pages.updateIndex(a.options.pages.next(),a.options.totalPages))}).keydown(function(c){b.isNextDisabled?b.canActivateSubmitButton()&&13===c.keyCode&&(b.sendAnalytics("clicked_submit_button_lastpage"),b.displaySubmitDialog()):a.listenForKey("next",c)}).sliderbutton(d)},pageJumpAction:function(a){var b=this.options.pages;b.options.currPageIndex=a,b.populatePage(),b.setPagingButtonState()},about:function(){var a=this;jQuery.event.props.push("touches");var b=$("body");b.on("keydown",function(b){b.which===PearsonGL.utils.keyCode.v&&(a.vDown=!0)}),b.on("keyup",function(b){b.which===PearsonGL.utils.keyCode.v&&(a.vDown=!1)}),b.click(function(b){if(b.shiftKey&&a.vDown&&(b.metaKey||b.altKey)){var c=$(b.target).closest("[data-gadget]"),d=c.length>0?c.data("gadgetUniqueId"):void 0,e=c.length>0?c.attr("data-gadget"):void 0,f=a.getAboutStr(d,e);a.vDown=!1,console.log(f),alert(f)}}),b.on("touchend",function(b){if(b.originalEvent.touches.length+b.originalEvent.changedTouches.length===7){var c=$(b.target).closest("[data-gadget]"),d=c.length>0?c.data("gadgetUniqueId"):void 0,e=c.length>0?c.attr("data-gadget"):void 0,f=a.getAboutStr(d,e);clearTimeout(a.aboutDialogTimeout),a.aboutDialogTimeout=setTimeout(function(){console.log(f),alert(f)},200)}})},getAboutStr:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"N/A",b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"N/A",c=this.options.pages.options.aboutText,d=PearsonGL.utils.getScoId(),e="Unknown",f="Unknown",g="N/A",h="N/A",i="N/A",j="N/A",k=PearsonGL.globals.comm.getMode();if(this.options.pages.options.runtimejson.productVersion&&(e=/^[\d\.]+$/.test(this.options.pages.options.runtimejson.productVersion)?this.options.pages.options.runtimejson.productVersion:"Dev Build"),this.options.pages.options.runtimejson.timeLastBuild&&(f=PearsonGL.utils.getFormattedDateTime(this.options.pages.options.runtimejson.timeLastBuild)),this.options.pages.options.runtimejson.product&&(h=this.options.pages.options.runtimejson.product),this.options.pages.options.runtimejson.deployProduct&&(i=this.options.pages.options.runtimejson.deployProduct),this.options.pages.options.runtimejson.rootSco&&(j=this.options.pages.options.runtimejson.rootSco),"N/A"!==a){var l=[],m=this.getGadgetByID(a);(m.options.scormOn||m.isCommEnabled())&&m.options.scorm.interactions.length>0&&m.options.scorm.interactions.forEach(function(a){a.objectives.forEach(function(a){l.push(a.score.max)})}),g=l.length>0?l.join(", "):"No score authored"}return c=c.replace(/\{PV}/g,e),c=c.replace(/\{ID}/g,d),c=c.replace(/\{LU}/g,f),c=c.replace(/\{MS}/g,g),c=c.replace(/\{GI}/g,a),c=c.replace(/\{GT}/g,b),c=c.replace(/\{PN}/g,h),c=c.replace(/\{DP}/g,i),c=c.replace(/\{RS}/g,j),c=c.replace(/\{SM}/g,k)},exit:function(){this.options.pages.sendAnalytics("sco_closed"),this.options.pages.unloadAllGadgets(),PearsonGL.globals.comm.exit()},loadLocalStorage:function(a){!0===a&&(PearsonGL.globals.useLocalStorage=!0)},getCurrentPageData:function(){var a=this.options.pages;return{id:a.pageArray[a.options.currPageIndex].options.id,index:a.options.currPageIndex}},goToPage:function(a,b){(b||this.options.pages.canUserJumpPages())&&this.options.pages.goToPage(a)},getGadgetByID:function(a){return this.options.pages&&this.options.pages.gadgetsHash?this.options.pages.gadgetsHash[a]:null},iterateCurrentPageGadgets:function(a){this.options.pages&&this.options.pages.iterateCurrentPageGadgets(a)},stopAudio:function(){this.options.pages&&this.options.pages.stopAudio()},setMasterVolume:function(a){var b=parseFloat(a);if(isNaN(b)||b<0||b>1)return void PearsonGL.logger.warn("Player received invalid volume: "+a);this.settings.masterVolume=b,PearsonGL.globals.masterVolumeGainNode&&(PearsonGL.globals.masterVolumeGainNode.gain.value=b),this.options.pages.setAudioVolumes(b)},getMasterVolume:function(){return this.settings.masterVolume},getAudioBuffer:function(a){return this.loadAudio(a)},startKeepAlive:function(){var a,b=this;this.settings.activityTime&&(this.lastMouseX=-1,this.lastMouseY=-1,$(".sco").on("mousemove keypress scroll touchstart touchmove",function(c){b.preloadAudio.hasInteracted=!0,PearsonGL.hasParmContent&&!1===b.preloadAudio.hasStarted&&b.preloadAudioSeq(),(a=new Date)-b.lastActivityTime>=b.settings.activityTime&&(b.lastActivityTime=a,"mousemove"===c.type?b.lastMouseX==c.screenX&&b.lastMouseY==c.screenY||(PearsonGL.globals.comm.sendKeepAlive(),b.lastMouseX=c.screenX,b.lastMouseY=c.screenY):PearsonGL.globals.comm.sendKeepAlive())}))},mediaIsActive:function(){this.settings.activityTime&&(currentTime=new Date,currentTime-this.lastActivityTime>=this.settings.activityTime&&(this.lastActivityTime=currentTime,PearsonGL.globals.comm.sendKeepAlive()))},showSpeechButton:function(){this.options.pages&&this.options.totalPages>0&&this.options.pages.showTranslateButton()},updateTranslationLanguage:function(a){this.options.pages&&this.options.totalPages>0&&this.options.pages.addTranslationLanguage(a)},addAutosaveLock:function(a){a&&PearsonGL.utils.isNonEmptyString(a.gadgetUniqueId)&&(a=a.gadgetUniqueId),PearsonGL.utils.isNonEmptyString(a)&&(this.autosaveLockKeys[a]=!0)},removeAutosaveLock:function(a){a&&PearsonGL.utils.isNonEmptyString(a.gadgetUniqueId)&&(a=a.gadgetUniqueId),PearsonGL.utils.isNonEmptyString(a)&&delete this.autosaveLockKeys[a]}};var global_player={};PearsonGL.globals.player=new PearsonGL.Player;var scoDataModel={Fluid_Layout:{pageFunction:function(a,b){return fluid_layout_function(a,b)},gadgetLinks:{"r5-c1-g8":["r5-c2-g5"],"r4-c1-g6":["r4-c2-g12"]},sliderReset:{"r5-c2-g5":["r5-c1-g8"],"r4-c2-g12":["r4-c1-g6"]}}};window.PearsonGL=window.PearsonGL||{},window.PearsonGL.productConfig=window.PearsonGL.productConfig||{},window.PearsonGL.productConfig.table={deleteRowButtonAlignRight:!0,maxAddOnRows:0};var PearsonBaseCustom=PearsonBaseCustom||{};PearsonBaseCustom=function(){function a(a){function j(){var a=f.find("tr:last-child"),b=(f.find(".delete-row"),$()),c=$(),h=$(),i=$();d.find(".table-mask")&&d.find(".table-mask").length||e.children(".table-mask").length||(b=a.clone(),c=b.find("td"),c.empty(),b.removeAttr("id"),c.each(function(a){var b=$.map(this.attributes,function(a){return a.name}),c=$(this);$.each(b,function(a,b){"style"!==b&&c.removeAttr(b)})}),e.append('<table class="table-mask"><tbody></tbody></table>'),h=e.find(".table-mask"),i=e.find(".table-mask tbody"),i.append(b),h.prepend(f.find("colgroup").clone()),i.append('<div class="table-row-mask"></div>'),g.removeClass("hide"),d.find(".add-row-button").attr("style",""))}function k(a){a.preventDefault();var b=f.find("tr.added");b.length!==PearsonGL.productConfig.table.maxAddOnRows&&b.length+1===PearsonGL.productConfig.table.maxAddOnRows&&(e.find(".table-mask").remove(),g.addClass("hide"))}b=a.the_page,d=a.table_gadget,e=a.table_area,f=a.data_table,g=a.table_add_row_elem,h=a.add_row_btn,g.length>0&&(i=!0,j()),c=function(a){a.preventDefault(),a.stopPropagation(),f.find("tr.added").length<=PearsonGL.productConfig.table.maxAddOnRows&&j()},h.on("click",k),$(document).on("CustomTableDeleteRowEvent",function(a,b){console.log("CustomTableDeleteRowEvent",a),c(a)})}var b,c,d,e,f,g,h,i=!1;return{init:a,handleDeleteRow:a.handleDeleteRow}}(),$(window).off("showfeedback").on("showfeedback",function(a,b){function c(a){$(document).trigger("CustomTableDeleteRowEvent",a)}$("body").find(".page:not(.hidden-page)").find(".table-identifier").find(".checker-pop-up").find(".yes .button-text").on("click",c)}),$(document).ready(function(){$(this).on("PageShowEvent",function(a){var b=$("body").find(".page:not(.hidden-page)"),c=b.find(".table-identifier"),d=c.find(".add-row-button"),e=c.find(".add-row-button .button-text"),f=c.find(".table-area"),g=c.find(".dataTable");PearsonBaseCustom.init({the_page:b,table_gadget:c,table_area:f,data_table:g,table_add_row_elem:d,add_row_btn:e})})});