/*
    Pearson Realize: Realize Platform - v [7e128d2]
    Copyright 2015, Pearson Education, Inc.  -  http://www.pearsonschool.com/
*/
function removeFirstCharacter(e){"use strict";return e.substr(1)}function getSearchParams(e){"use strict";return e=e||location.search,removeFirstCharacter(e).split("&").reduce(function(e,t){var n=t.split("="),r=n[0],s=n[1];return e[r]=angular.isUndefined(s)||s,e},{})}var searchParams=getSearchParams(),USE_MOCKS=searchParams&&searchParams.e2etest&&"mocked"===searchParams.e2etest||"true"===localStorage.USE_MOCKS;angular.module("RealizeDirectives",["ngSanitize","TypeaheadInitializer","Realize.common.helpers","Realize.common.alerts","Realize.content","Realize.common.mediaQueryService","lst.search.widget","Realize.profile.itemBoxes","Realize.program.content.toolbar","Realize.dragAndDrop.directives","rlzComponents.components.rubricSidePanel","rlzComponents.components.browseAll","Realize.constants.lexileTelemetry","Realize.constants.draTelemetry"]),angular.module("RealizeDataServices",["Realize.paths","RealizeDataServices.ProgramService","Realize.common.keyStore","Realize.common.helpers","Realize.common.browserInfoService","Realize.common.mediaQueryService","Realize.NbcLearn.Constants","Realize.content","Realize.standards.standardDataService"]),angular.module("ModalServices",["Realize.common.keyboardSupport.keyCodes","NotebookApp"]);try{angular.module("Realize.Discussions")}catch(e){angular.module("Realize.Discussions",[])}try{angular.module("realize.templates")}catch(e){angular.module("realize.templates",[])}angular.module("RealizeApp",["Realize.api","RealizeApp.Config","RealizeApp.logout","ngRoute","ngAnimate","Realize.ui.tokenEnabledSrc","ui.bootstrap","Realize.filters","RealizeDataServices","Realize.ExternalItem","Realize.content","Realize.classRoster","ModalServices","AssessmentServices","ui","ui.sortable","RealizeDirectives","Realize.quicklinks","webStorageModule","Realize.eText","Realize.discussionPrompt","Realize.standards","Realize.leveledReaders","Realize.myContent","Realize.assessment","Realize.eText2Builder","Realize.adaptiveHomework","Realize.calendar","Realize.core.security.permissions","Realize.ui.modal.UnsavedChangesModal","Realize.Discussions","Realize.NbcLearn","Realize.sidebar","Realize.paths","Realize.analytics","Realize.Interceptors.SessionTimeout","Realize.core.directives.htmlUnsafe","realize.core.isoDateService","realize.template-protection","popover.templateOverride","realize-lib.ui.disable-auto-attrs","Realize.content.media-icon","Realize.Content.customizedMessage","Realize.reporting","Realize.ui.scrollTopOnLoad","Realize.assignment","Realize.recommendation","Realize.admin","realize-lib.core.services.log","Realize.user.currentUser","Realize.classLanding","Realize.classes.edit","Realize.common.alerts","Realize.common.ltiContentViewerDirective","Realize.common.coTeachersAlert","Realize.common.keyboardSupport.keyCodes","Realize.common.dateFilterDecorator","Realize.common.helpers","Realize.common.keyStore","Realize.common.browserInfoService","Realize.common.mediaQueryService","Realize.common.paginator","Realize.common.adaptiveIconDirective","Realize.common.realizeReaderSelectionIconDirective","Realize.common.teacherIconDirective","Realize.common.toolTipSupport.keyboardAccess","Realize.common.optionalFeaturesService","Realize.header","Realize.navigationService","Realize.prompts","Realize.resources","Realize.heartbeat","Realize.teacher.profile","Realize.student.profile","Realize.search.telemetry","Realize.constants.googleClassroom","Realize.webStorage.storageDecorator","components.assignmentFacade","components.analytics","components.breadCrumb","rlzComponents.components.banner","rlzComponents.breadcrumbTelementryModule","rlzComponents.components.rubricSidePanel","rlzComponents.components.playlist","rlzComponents.components.googleClassroom","rlzComponents.components.browseAll","rlzComponents.components.services.playlist","rlzComponents.components.playlistTelemetryService","rlzComponents.utilities.routeChangeWatchService",window.Components.default]).config(["$windowProvider","currentUserProvider",function(e,t){"use strict";var n=new e.$get;t.setPreloadData(n.currentUser)}]).constant("DISTANT_FUTURE_DATE",9999999999999).constant("QL_MAX_LINKS",3).constant("OPEN_ED_LINKS",{OPEN_ED:"https://www.opened.com/",TIPS:"http://help.pearsoncmg.com/realize/instructor/en/Help.htm#cshid=1001"}).constant("CODE_ASSIGNMENT_HAS_NO_PROGRAM","NO_PROGRAM").constant("HEADER_HEIGHT",45).constant("TEACHER_RESOURCES_DRAWER","teacherResourceDrawerOpen_").constant("COLORS",{BLUE_DARK:"#004168",GREEN:"#68a51a",BLUE:"#026ecb",RED_DARK:"#9e0b0f",GREEN_DARK:"#416b0c",BLUE_DARKEST:"#003250",RED_DARKER:"#6c090c",BLUE_DARKER:"#003766",BLUE_LIGHT:"#0189ff",YELLOW_LIGHT:"#fdd03a",RED_LIGHT:"#ed5932"}).constant("TOC_TITLE_LIMITS",{DEFAULT_LIMIT:75,DEFAULT_SIDEBAR_LIMIT:55,MOBILE_IMODE_LIMIT:60,MOBILE_IMODE_SIDEBAR_LIMIT:40}).constant("uiDateConfig",{prevText:"&#xf0d9;",nextText:"&#xf0da;"}).value("LOG_LEVEL",window.jsLogLevel).run(["$currentUser","lkGoogleSettings",function(e,t){"use strict";var n,r=e.getAttribute("profile.locale"),s=!1;t.locale=r,moment.locale(r),UXF.Common.i18n.load(r,n,s)}]).run(["$location","$rootScope","$http","Modal","SessionTimeoutModal","$log","$window","$document","webStorage","PATH","KeyStore","AccessibilityService","Content","ClassRoster","Permissions","Analytics","NBC_PROGRAM_NAME","$currentUser","BrowserInfo","heartbeatApiService","lwcI18nFilter","RealizeHelpers","googleClassroomService","routeChangeWatchService","featureManagementService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R){"use strict";function C(){var s=e.search().isConsentDenied,i=t.currentUser.getAttribute("googleImportedUser"),o=c.REST+"/users/googleconsentscreen?consentScreenStatus=true";if(v.isStudent&&i&&!s&&R.isGoogleClassroomEnabled()){var l=E.getUserMappingQuery();E.setIsConsentCSSCallMade(!0),E.classSyncServiceQuery(l).then(function(e){var s=e.data.userMapping;if(s.hasProvidedConsent&&s.hasValidToken)E.setGoogleConsentAsked(!0);else{n.post(o).then(function(e){return a.info("Google consent will not be asked again"),e},function(e){return a.error("Error setting dont consent popup",e),e});var i=t.$new();i.closeBtnClickHandler=function(){E.setGoogleConsentAsked(!0),r.hideDialog(),i.$destroy()},i.title=A("googleClassroom.bannerTitle"),i.body="EarlyLearner"===v.getUserTheme()?A("googleClassroom.linkAccountsPopup.earlyLearnerMessage"):A("googleClassroom.linkAccountsPopup.message"),i.buttons=[{title:A("googleClassroom.linkAccountsPopup.cancel"),isDefault:!1,clickHandler:r.cancelGoogleDialog},{title:A("googleClassroom.linkAccountsPopup.linkAccount"),isDefault:!0,clickHandler:r.redirectToClassSyncWebapp}],r.showDialog("templates/partials/simpleDialog.html",i)}}).catch(function(e){a.error("error",e)})}}var D,b;window.heartbeatFeatureEnabled&&(a.info("heartbeat started"),T.sendHeartbeatEvent(!0)),t.currentUser=v,t.isLtiAUser=!1,angular.forEach(t.currentUser.roles,function(e){"ROLE_LTI_A_USER"===e&&(t.isLtiAUser=!0)}),t.isNbcLearnUser=function(){return t.currentUser.$isSubscribedTo(h)},t.getMessage=function(e,t,n){return A(e,t,n)},t.servicesState=i.servicesState,t.hasCommentFeature=function(){return"true"===t.servicesState["comments.feature.enabled"]},t.indexBodyClass=function(){return{"show-subnav":"titleOnly"===t.subnavState,"show-subnav-menu":"hasMenu"===t.subnavState,"hide-platform":t.hidePlatform,"preview-mode":t.currentUser.getAttribute("admin.previewMode"),isIE:S.isIE,isIE8:S.isIE8,isSafari:S.browser.isSafari,isAndroid:S.OS.isAndroid,isIDevice:S.isIDevice,iosKeyboardOpen:t.iosKeyboardOpen,isReviewer:t.currentUser.isReviewer,altBkgd:v.isNbcLearnUser()&&t.currentUser.isTeacher}},S.isIDevice&&(D=function(){t.iosKeyboardOpen=!0},o.on("focus","input, select, textarea",D),b=function(){t.iosKeyboardOpen=!1},o.on("blur","input, select, textarea",b)),t.viewLoading=!0,t.pageLoading=function(){t.viewLoading=!0},t.pageLoaded=function(){t.viewLoading=!1},t.sessionStorageClear=function(){l.clear()},t.httpSessionTimedOutReceived=!1,t.$on("httpSessionTimedOut",function(){a.info("RECEIVED httpSessionTimedOut event",t.httpSessionTimedOutReceived),!1===t.httpSessionTimedOutReceived&&(t.httpSessionTimedOutReceived=!0,t.sessionStorageClear(),T.stopHeartbeats(),s.showDialog())}),y.initializeWatchersForRootScope(),t.$on("$routeChangeStart",function(){t.pageLoading(),r.hideDialog();var n=e.search().googleConsentAsked;"true"===n&&E.setGoogleConsentAsked(!0),$(".tooltip").remove(),$(".dropdown.open").removeClass("open"),$.datepicker._hideDatepicker(),E.getGoogleConsentAsked()||"/"===e.path()||E.getIsConsentCSSCallMade()||C(),"complete"===t.currentUser.getAttribute("profile.wizard")||t.isLtiAUser||(a.log("[$routeChangeStart] aborted. wizard incomplete. "),e.path("/welcome"))}),t.$on("$routeChangeSuccess",function(){t.pageLoaded()});var P=function(e){var n=t.$new();n.title="Something went wrong!",n.body="We're sorry, we were unable to process your request because: "+e,n.closeBtnClickHandler=r.hideDialog,n.buttons=[{title:"OK",isDefault:!0,clickHandler:r.hideDialog}],r.showDialog("templates/partials/simpleDialog.html",n)};t.$on("$routeChangeError",function(n,r,s,i){t.pageLoaded(),a.warn("ROUTE CHANGE ERROR",n,r,s,i),angular.isString(i)&&(i={type:"back",errorMessage:i}),"redirect"===i.type?(a.warn("ROUTE REDIRECT ORDER ",i.path),e.path(i.path).replace()):"back"===i.type&&(i.errorMessage&&P(i.errorMessage),s&&s.path?e.path(s.path):i.useBack&&n.currentScope.back())}),t.hidePlatform=!1,t.location=e,t.$watch("location.path()",function(e,n){a.log("path watch",e,n);var r=e.split("/")[1];t.siteSection="section-"+r,"browseAll"===r&&(t.siteSection="section-search"),"section-"===t.siteSection&&(t.siteSection="section-home"),"section-classes"===t.siteSection&&e.split("/").length>2&&"Student"===t.currentUser.primaryOrgRole&&(t.siteSection="section-classes student");var s=c.TEMPLATE_CACHE+c.SUBNAV;e.search("/search")>=0&&e.search("/content/")<0&&e.search("/standards/")<0&&e.search("/assessment/")<0&&e.search("/leveledreaders")<0&&e.search("/playlist")<0?(t.subnavState="titleOnly",t.subNavTemplate=s+"searchSubnav.html",t.hidePlatform=!1):e.search("/standards")>=0&&e.search("/content/")<0&&e.search("/review/")>=0?(t.subnavState="titleOnly",t.subNavTemplate=s+"programSubnav.html",t.hidePlatform=!1):e.search("/standards")>=0&&e.search("/content/")<0&&e.search("/data")<0?e.match(/assessment\/[a-z0-9\-]+\/[0-9]+\/edit$/)?t.subnavState="hidden":(t.subnavState="hasMenu",t.subNavTemplate=s+"programSubnav.html",t.hidePlatform=!1):e.match(/\/remediation$/)&&e.search("/myLibrary")>=0?(t.subnavState="titleOnly",t.subNavTemplate=s+"myLibrarySubnav.html",t.hidePlatform=!1):e.match(/\/remediation$/)?(t.subnavState=e.search("/search")>=0||e.search("/browseAll")>=0?"hidden":"hasMenu",t.hidePlatform=!1,t.subNavTemplate=s+"programSubnav.html"):e.search("/content/")>=0&&e.search("/manualScore/")<0&&e.search("/discussPrompt/")<0&&e.search("/adaptivehomework/")<0?(t.subnavState="hidden",t.hidePlatform=!0):e.match(/\/edit\/preview$/)?(t.subnavState="hidden",t.hidePlatform=!0):e.match(/\/search\/assessment\/[a-z0-9\-]+\/[0-9]+\/edit$/)?(t.subnavState="hidden",t.hidePlatform=!1):e.match(/\/myLibrary\/assessment\/[a-z0-9\-]+\/[0-9]+\/edit$/)?(t.subnavState="titleOnly",t.subNavTemplate=s+"myLibrarySubnav.html",t.hidePlatform=!1):e.search("/myLibrary/lesson")>=0||e.search("/myLibrary/tier")>=0||0===e.search("/myLibrary/file")||0===e.search("/myLibrary/link")||0===e.search("/myLibrary/essayPrompt")||0===e.search("/myLibrary/assessment/essay")||0===e.search("/myLibrary/assessment/create")?(t.subnavState="titleOnly",t.subNavTemplate=s+"myLibrarySubnav.html",t.hidePlatform=!1):e.match(/assessment\/[a-z0-9\-]+\/[0-9]+\/edit$/)?(e.match(/\/myLibrary\/program\/[a-z0-9\-]+\/[0-9]/)?(t.subnavState="titleOnly",t.subNavTemplate=s+"myLibrarySubnav.html"):(t.subnavState="hasMenu",t.subNavTemplate=s+"programSubnav.html"),t.hidePlatform=!1):e.match(/\/myLibrary\/program\/[a-z0-9\-]+\/[0-9]/)&&e.match(/assessment\/[a-z0-9\-]+\/[0-9]+\/addQuestionBank$/)?(t.subnavState="titleOnly",t.subNavTemplate=s+"myLibrarySubnav.html",t.hidePlatform=!1):e.search("/program/")>=0&&!t.currentUser.isStudent?(t.subnavState="hasMenu",t.subNavTemplate=s+"programSubnav.html",t.hidePlatform=!1):e.search("/browseAll")>=0&&e.search("/browseAll/playlist")<0&&!t.currentUser.isStudent?(t.subnavState="titleOnly",t.subNavTemplate=s+"browseAllContent.html",t.hidePlatform=!1):e.search("/program/")>=0&&t.currentUser.isReviewer?(t.subnavState="titleOnly",t.subNavTemplate=s+"programSubnav.html",t.hidePlatform=!1):e.search("/program/")>=0&&t.currentUser.isStudent?(t.subnavState="titleOnly",t.subNavTemplate=s+"programSubnav.html",t.hidePlatform=!1):e.search("/program")>=0&&e.search("/program/")<0&&e.search("/program-")<0?(t.subnavState="titleOnly",t.subNavTemplate=s+"programListSubnav.html",t.hidePlatform=!1):e.search("/centers/")>=0?(t.subnavState="titleOnly",t.subNavTemplate=s+"centersSubnav.ctrl.html",t.hidePlatform=!1):e.search("/centers")>=0&&e.search("/centers/")<0?(t.subnavState="titleOnly",t.subNavTemplate=s+"centersLandingSubnav.html",t.hidePlatform=!1):e.search("/grades")>=0&&e.search("/grades/")<0?(t.subnavState="titleOnly",t.subNavTemplate=s+"gradesListSubnav.html",t.hidePlatform=!1):e.search("/grades/")>=0&&e.search("/overview")>=0?(t.subnavState="titleOnly",t.subNavTemplate=s+"gradesSubnav.ctrl.html",t.hidePlatform=!1):e.search("/classes")>=0&&e.search("/classes/")<0?(t.subnavState="titleOnly",t.subNavTemplate=s+"classesListSubnav.html"):e.search("/classes/")>=0&&(e.search("/create")<0||e.search("/discussPrompt")>=0||e.search("/adaptivehomework")>=0)?(t.subnavState="hasMenu",t.subNavTemplate=s+"classesSubnav.ctrl.html",t.hidePlatform=!1):e.search("/classes/create/options")>=0||e.search("/error/no-programs-pageSource-data")>=0?(t.subnavState="titleOnly",t.subNavTemplate=s+"zeroStateClassGetStarted.html",t.hidePlatform=!1):e.search("/classes/")>=0&&e.search("/discussPrompt")<0&&e.search("/create")>=0?(t.subnavState="titleOnly",t.subNavTemplate=s+"classesCreateSubnav.html",t.hidePlatform=!1):e.search("/data")>=0&&e.search("/data/")<0?(t.subnavState="titleOnly",t.subNavTemplate=s+"classesListSubnav.html"):e.search("/data/")>=0&&(e.search("/overview")>=0||e.search("/standards")>=0||e.search("/scoreSummary")>=0)?(t.subnavState="hasMenu",t.subNavTemplate=s+"dataSubnav.ctrl.html",t.hidePlatform=!1):e.search("/admin")>=0&&e.search("/admin/")<0?(t.subnavState="hasMenu",t.subNavTemplate=s+"adminSubnav.html",t.hidePlatform=!1):e.search("/admin/")>=0&&e.search("/patools")>0?(t.subnavState="titleOnly",t.subNavTemplate=s+"adminPatoolsSubnav.html",t.hidePlatform=!1):"/"===e?(t.subnavState="hidden",t.hidePlatform=!1):e.search("/welcome")>=0?(t.subnavState="hidden",t.hidePlatform=!0):e.search("/myLibrary/playlist")>=0||e.search("/search/playlist")>=0||e.search("/browseAll/playlist")>=0?(t.subnavState="hidden",t.subNavTemplate="",t.hidePlatform=!1):(t.subnavState="hidden",t.subNavTemplate="",t.hidePlatform=!1),(-1===e.search("search")||-1===e.search("searchOpenEd"))&&(t.keywords=null)}),d.init(),d.setFocusElements('a, button, input[type=file], input[type=radio], .sortableList, .customCheckbox [class*="icon-"]'),t.keyStore=new u,$("#pageWrap").on("focus",d.keyboardFocusableElements,function(){var e=$(this);window.setTimeout(function(){if(t.isKeyboardInUse){var n=!0,r=e.offset().top,s=$(document).scrollTop(),a=$("#globalNav:visible").outerHeight(n)+$("#sectionNav:visible").outerHeight(n);("hasMenu"===t.subnavState&&a>r-s||"titleOnly"===t.subnavState&&a>r-s||"hidden"===t.subnavState&&a>r-s)&&$(document).scrollTop(0)}},0)}),t.goToDefaultErrorPage=function(){e.path("/error/default")},t.$on("$destroy",function(){S.isIDevice&&(o.off("focus","input, select, textarea",D),o.off("blur","input, select, textarea",b))}),t.$on("messages.locale.changed",function(e){a.debug("[RealizeApp] messages.locale.changed handler",e,arguments),I.reloadWindow()}),t.$on("user.locale.changed",function(e){a.debug("[RealizeApp] user.locale.changed handler",e,arguments),I.reloadWindow()})}]),angular.module("Realize.api",["components.paths"]).constant("USE_MOCKS",USE_MOCKS).config(["$windowProvider","PathsProvider",function(e,t){"use strict";var n=new e.$get;t.setPaths({REST:n.restPath,MEDIA:n.rootPath+"/realizeit/componentArchitecture/dist"})}]),angular.module("RealizeApp.Config",["ngRoute","ModalServices","Realize.user.currentUser","RealizeDataServices","Realize.paths","Realize.Interceptors.SessionTimeout","Realize.Interceptors.CSRFToken","Realize.core.security.permissions","Realize.common.mediaQueryService","Realize.common.tokenRecovery","Realize.common.optionalFeaturesService","lk-google-picker","Realize.comments","rlzComponents.components.services.oneDrive"]).config(["UserProvider","MEDIA_PATH","$currentUserProvider","$compileProvider","$locationProvider","$routeProvider","$httpProvider","$provide","SessionTimeoutServiceProvider","CommonTokenRecoveryProvider","PermissionsProvider","MediaQueryProvider","OptionalFeaturesProvider","lkGoogleSettingsProvider","$windowProvider","oneDriveSettingsProvider",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f){"use strict";var h,v,S,T,A;e.setBaseAvatarImagePath(t+"/skins/default/images/profile_icons/"),n.setPreloadData(window.currentUser),s.html5Mode(!0),i.interceptors.push("CommonTokenInterceptor"),i.interceptors.push("CSRFTokenInterceptor"),r.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|tel|filesystem):/),r.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|tel|filesystem):/),h=["$rootScope","$q",function(e,t){return function(n){return e.$broadcast("httpSessionTimedOut"),t.reject(n)}}],c.setSessionTimeoutServiceProvider(l),l.addEventHandler(h),l.addEventHandler("CommonTokenRecovery",999),a.when("/error/:errorType",{controller:"ErrorCtrl",templateUrl:"templates/views/error.html"}),v=["$rootScope",function(e){return!e.currentUser.isFederatedUser}],S=["$rootScope",function(e){return e.currentUser.isFederatedUser}],T={create_class:v,edit_class:v,edit_class_in_SIS:S,add_student:v,add_student_in_SIS:S,edit_student:v,edit_profile:v,edit_profile_in_SIS:S},u.setPermissions(T),A={desktop:{minWidth:980},largeTablet:{maxWidth:979,minWidth:768},smallTablet:{maxWidth:767}},d.setBreakpoints(A),m.setServicesState(window.servicesState),m.updateServicesState("notebook.integration.enabled",window.realizeNotebookIntegrationEnabled),o.decorator("$rootScope",["$delegate",function(e){return e.safeApply=function(t){var n=e.$$phase;-1!==["$apply","$digest"].indexOf(n)?t&&angular.isFunction(t)&&t():e.$apply(t)},e}]),g.configure({features:[],clientId:p.$get().googleClientId,views:["DocsView().setIncludeFolders(true)"]});var I={clientId:p.$get().oneDriveAppId,action:"share",advanced:{redirectUri:p.$get().rootPath+"/home"}};f.setOneDriveOptions(I)}]),angular.module("Realize.paths",[]).constant("REST_PATH",window.restPath).constant("ROOT_PATH",window.rootPath).constant("TEMPLATE_PATH",window.rootPath).constant("MEDIA_PATH",window.mediaPath).constant("SCRIPT_PATH",window.mediaPath+"/js").constant("COMPONENT_TEMPLATE_PATH",window.mediaPath+"/js").constant("THUMBNAIL_PATH",window.thumbnailPath).constant("SHARED_THUMBNAIL_PATH",window.thumbnailPath+"/shared").constant("CONTINEO_SERVER_URL",window.contineoServerUrl).constant("CONTINEO_CAT_URL",window.contineoCatUrl).constant("CONTINEO_SERVER_HELP_URL",window.contineoServerHelpUrl).constant("DISCUSSION_API_URL",window.discussionApiUrl).constant("DISCUSSION_UI_DIST_PATH",window.discussionUIDistributionPath).constant("PATH",{REST:window.restPath,ROOT:window.rootPath,COMPONENT:window.mediaPath+"/js",TEMPLATES:window.rootPath,MEDIA:window.mediaPath,IMAGES:window.mediaPath+"/skins/default/images",THUMBNAILS:window.thumbnailPath,SHARED_THUMBNAILS:window.thumbnailPath+"/shared",TEMPLATE_CACHE:"templates",TEMPLATE_ROOT:"templates",SUBNAV:"/app/header/subNav/"}),angular.module("popover.templateOverride",[]).run(["$templateCache",function(e){"use strict";e.put("template/popover/popover.html",'<div class="popover {{placement}}" tabindex="0" aria-live="assertive" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind-html="title" ng-show="title"></h3>\n      <div class="popover-content" ng-bind-html="content"></div>\n  </div>\n</div>\n')}]),angular.module("realize.template-protection",["realize.templates"]).factory("templateInterceptor",["$log","$templateCache","$browser",function(e,t,n){"use strict";return{request:function(e){if(0===e.url.indexOf("templates/")){var r=t.get(e.url);r&&t.put(n.baseHref()+e.url,r)}return e}}}]).config(["$httpProvider",function(e){"use strict";e.interceptors.push("templateInterceptor")}]),angular.module("TypeaheadInitializer",["ui.bootstrap.typeahead"]).constant("LIB_PATH",window.mediaPath+"/lib").config(["$provide",function(e){"use strict";e.decorator("typeaheadDirective",["$delegate",function(e){var t=e[0];t.priority=-1;var n=t.link;return t.compile=function(){var e=function(e,t,r,s){var a="[typeahead-popup]",i=e.$eval(r.typeaheadCloseOnTab);angular.isDefined(i)&&t.on("keydown",function(t){var n=angular.element(a);9===t.which&&(t.stopImmediatePropagation(),n.scope().matches=[],n.scope().active=-1,e.$digest())}),t.on("focus",function(){s.$setViewValue(s.$viewValue)}),n.apply(this,arguments)};return e},e}]),e.decorator("typeaheadPopupDirective",["$delegate",function(e){var t=e[0];t.templateUrl="templates/partials/typeahead.html";var n=t.link;return t.compile=function(){var e=function(e){n.apply(this,arguments);var t,r,s,a=angular.element(".typeahead.dropdown-menu"),i=angular.element("[typeahead]"),o=i.attr("typeahead-scroll-down-interval"),l=e.$eval(o)||3;e.$watch("active",function(n,i){t=n>i&&n%l===0,r=i>n,s=n===e.matches.length-1,(t||r||s)&&a.scrollTo("li:eq("+n+"):has(a.kb-mode)",0,{axis:"y"})}),e.isOpen=function(){var t=e.matches.length>0;return t?e.$emit("typeaheadPopup.hasMatches"):e.$emit("typeaheadPopup.noMatches"),t}};return e},e}]),e.decorator("typeaheadMatchDirective",["$delegate","Messages",function(e,t){var n=e[0],r=n.link;return n.compile=function(){var e=function(e){r.apply(this,arguments),e.Messages=t};return e},e}])}]),angular.module("Realize.admin",["RealizeDataServices","Realize.admin.landing.adminLandingController","Realize.admin.programs.addProgramController","Realize.admin.jobs.adminJobsListingController","Realize.admin.programs.existingProgramsController","Realize.admin.messages.adminMessagesEditorController","Realize.admin.programs.programTaxonomyService","Realize.admin.commonCartridge","Realize.admin.ltiConsumer","Realize.admin.adminJobsService","Realize.admin.publish.publishTipFilter","Realize.admin.publish.publishClick"]).config(["$routeProvider",function(e){"use strict";var t=["$q","$rootScope",function(e,t){var n=t.currentUser.hasRole("ROLE_LIBRARY_ADMIN")||t.currentUser.hasRole("ROLE_OLE_GOD")||t.currentUser.hasRole("ROLE_CACHE_GOD")||t.currentUser.hasRole("ROLE_PEARSON_ADMIN");return n?e.when(1):e.reject("Insufficient Privledges!")}];e.when("/admin/patools/messages",{controller:"AdminMessagesEditorController",templateUrl:"templates/admin/messages/adminMessagesEditor.html",resolve:{_security:t}}).when("/admin/patools",{controller:"AdminLandingController",templateUrl:"templates/admin/landing/adminLanding.html",resolve:{_security:t}}).when("/admin/patools/addprogram",{controller:"AdminAddProgramController",templateUrl:"templates/admin/programs/adminAddProgram.html",resolve:{_security:t}}).when("/admin/patools/existingprograms",{controller:"ExistingProgramsController",templateUrl:"templates/admin/programs/existingPrograms.html",resolve:{_security:t,ProgramData:["ProgramTaxonomyService",function(e){return e.getAllPrograms()}]}}).when("/admin/patools/jobservicelisting",{controller:"AdminJobsListingController",controllerAs:"adminJobsListing",templateUrl:"templates/admin/jobs/adminJobsListing.html",resolve:{_security:t,JobsData:["AdminJobsService","$currentUser",function(e,t){return e.getJobs({state:"active",SUBMITTED_BY_USERID:t.userName,getMinimalJobDetailsAttributes:!0})}],lastSearch:["$currentUser",function(e){return{type:"filters",filters:{state:"active",SUBMITTED_BY_USERID:e.userName,getMinimalJobDetailsAttributes:!0}}}]}}).when("/admin/patools/jobservicelisting/:jobId",{controller:"AdminJobsListingController",controllerAs:"adminJobsListing",templateUrl:"templates/admin/jobs/adminJobsListing.html",resolve:{_security:t,JobsData:["AdminJobsService","$route","$log",function(e,t,n){var r=t.current.params.jobId;return e.getJobById(r).then(function(e){return e},function(e){return n.debug("error getting jobs!",e),[]})}],lastSearch:["$route",function(e){return{type:"id",searchId:e.current.params.jobId}}]}}).when("/admin/patools/commoncartridge/:activeTab",{controller:"AdminCommonCartridgeManagementController",templateUrl:"templates/admin/commonCartridge/cartridgeManagement.html",resolve:{_security:t}}).when("/admin/patools/ltiConsumer/:activeTab",{controller:"AdminLTIConsumerConfigController",controllerAs:"ltiConfigCtrl",templateUrl:"templates/admin/ltiConsumer/ltiConsumerConfig.html",resolve:{_security:t}})}]),angular.module("Realize.analytics.assignments",["realize-lib.analytics","realize-lib.analytics.google","realize-lib.analytics.track-click"]).config(["AnalyticsProvider",function(e){"use strict";e.addTracker("assignment.action",["GoogleAnalytics","AnalyticsEvent",function(e,t){if(t.status&&t.assignment){var n={completed:"Completed",in_progress:"In Progress",not_started:"Not Started"},r=t.category?t.category:"Classes",s=n[t.status]+"- "+t.assignment.$getTitle(),a=t.action?t.action:s,i=t.label;i?e.trackEvent(r,a,i):e.trackEvent("Classes",n[t.status]+"- "+t.assignment.$getTitle())}}])}]),angular.module("Realize.analytics.centers",["realize-lib.analytics","realize-lib.analytics.google","realize-lib.analytics.track-click"]).config(["AnalyticsProvider",function(e){"use strict";e.addTracker("centers.list.sort",["GoogleAnalytics","AnalyticsEvent",function(e,t){var n={subject:"Show by Subject",grade:"Show by Grade",favorite:"Show by Favorites"};e.trackEvent("Centers",n[t.action])}]),e.addTracker("centers.open",["GoogleAnalytics","AnalyticsEvent",function(e,t){t.program&&e.trackEvent("Centers","Program ("+t.program.title+")")}]),e.addTracker("centers.action",["GoogleAnalytics","AnalyticsEvent",function(e,t){if(t.program){var n=t.label;t.content&&t.content.id!==t.program.id&&(n="Asset ("+t.content.$getTitle()+"): "+n),e.trackEvent("Centers","Program ("+t.program.title+")",n)}}]),e.addTracker("centers.info",["GoogleAnalytics","AnalyticsEvent",function(e,t){if(t.program&&t.item){var n="Info ("+t.item.$getTitle()+")";t.content&&t.content.id!==t.program.id&&(n="Asset ("+t.content.$getTitle()+"): "+n),e.trackEvent("Centers","Program ("+t.program.title+")",n)}}]),e.addTracker("centers.email",["GoogleAnalytics","AnalyticsEvent",function(e,t){if(t.program&&t.item){var n="Email ("+t.item.$getTitle()+")";t.content&&t.content.id!==t.program.id&&(n="Asset ("+t.content.$getTitle()+"): "+n),e.trackEvent("Centers","Program ("+t.program.title+")",n)}}]),e.addTracker("centers.teacherResources",["GoogleAnalytics","AnalyticsEvent",function(e,t){if(t.program&&t.item){var n="Teacher Resources ("+t.item.$getTitle()+")";t.content&&t.content.id!==t.program.id&&(n="Asset ("+t.content.$getTitle()+"): "+n),e.trackEvent("Centers","Program ("+t.program.title+")",n)}}]),e.addTracker("centers.contentQuicklink",["GoogleAnalytics","AnalyticsEvent",function(e,t){t.program&&t.content&&t.label&&e.trackEvent("Centers","Program ("+t.program.title+")","Asset ("+t.content.$getTitle()+"): "+t.label)}])}]),angular.module("Realize.analytics",["realize-lib.analytics","realize-lib.analytics.google","realize-lib.analytics.track-click","Realize.analytics.programs","Realize.analytics.centers","Realize.analytics.assignments","components.utilities.sha256","Realize.user.currentUser"]).constant("ANALYTIC_CONSTANTS",{STANDARD_THEME:"Standard"}).config(["GoogleAnalyticsProvider",function(e){"use strict";e.setProfile(window.googleAnalyticsId),e.setDevMode(!0)}]).config(["AnalyticsProvider",function(e){"use strict";e.addTracker("track.action",["GoogleAnalytics","AnalyticsEvent",function(e,t){e.trackEvent(t.category,t.action,t.label)}])}]).run(["GoogleAnalytics","ANALYTIC_CONSTANTS","sha256","$currentUser",function(e,t,n,r){"use strict";e.trackPageview(),e.setOptions({dimension1:r.primaryOrgRole,dimension2:r.primaryOrgId,dimension4:t.STANDARD_THEME,userId:n(r.userId||"")})}]),angular.module("Realize.analytics.programs",["realize-lib.analytics","realize-lib.analytics.google","realize-lib.analytics.track-click"]).config(["AnalyticsProvider",function(e){"use strict";e.addTracker("programs.list.sort",["GoogleAnalytics","AnalyticsEvent",function(e,t){var n={subject:"Show by Subject",grade:"Show by Grade",favorite:"Show by Favorites"};e.trackEvent("Programs",n[t.action])}]),e.addTracker("programs.open",["GoogleAnalytics","AnalyticsEvent",function(e,t){t.program&&e.trackEvent("Programs","Program ("+t.program.title+")")}]),e.addTracker("programs.action",["GoogleAnalytics","AnalyticsEvent",function(e,t){if(t.program){var n=t.label;t.content&&t.content.id!==t.program.id&&(n="Asset ("+t.content.$getTitle()+"): "+n),e.trackEvent("Programs","Program ("+t.program.title+")",n)}}]),e.addTracker("programs.info",["GoogleAnalytics","AnalyticsEvent",function(e,t){if(t.program&&t.item){var n="Info ("+t.item.$getTitle()+")";t.content&&t.content.id!==t.program.id&&(n="Asset ("+t.content.$getTitle()+"): "+n),e.trackEvent("Programs","Program ("+t.program.title+")",n)}}]),e.addTracker("programs.teacherResources",["GoogleAnalytics","AnalyticsEvent",function(e,t){if(t.program&&t.item){var n="Teacher Resources ("+t.item.$getTitle()+")";t.content&&t.content.id!==t.program.id&&(n="Asset ("+t.content.$getTitle()+"): "+n),e.trackEvent("Programs","Program ("+t.program.title+")",n)}}]),e.addTracker("programs.contentQuicklink",["GoogleAnalytics","AnalyticsEvent",function(e,t){if(t.program&&t.content&&t.label){var n="Asset ("+t.content.$getTitle()+"): "+t.label;e.trackEvent("Programs","Program ("+t.program.title+")",n)}}])}]),angular.module("Realize.assignment.constants",[]).constant("ASSIGNMENT_CONSTANTS",{ASSIGNEE_TYPE:{CLASS:"CLASS",GROUP:"GROUP",STUDENT:"STUDENT"},ASSIGNMENT_TYPE:{BASIC:"BASIC",ENRICHMENT:"ENRICHMENT",REMEDIATION:"REMEDIATION"},GRADE_TYPE:{ALL:"ALL",GRADED:"GRADED",NOT_GRADED:"NOT_GRADED",NOTGRADED:"NOTGRADED"},STATUS:{COMPLETED:"completed",IN_PROGRESS:"in_progress",NOT_STARTED:"not_started",UNKNOWN:"unknown",SUBMITTED:"submitted"},ATTACHMENT_STATUS:{DELETED:"Marked for Deletion",LIVE:"Not Marked for Deletion",UNKNOWN:"UNKNOWN"},PAGE_SIZE:{MOBILE:5,DESKTOP:10},EXTERNAL_SOURCE:{OPENED:"OpenEd"},FILE_TYPE:{OPENED:"OpenEd"},ASSIGNMENT_STATUS:{COMPLETED:"realize.assignment.completed",IN_PROGRESS:"realize.assignment.inprogress",NOT_STARTED:"realize.assignment.notstarted",ALL:"realize.assignment.all"},TITLE_MAX_LENGTH:75,ONESOURCE:"ONESOURCE",ASC:"ASC",DESC:"DESC",INACTIVE:"INACTIVE",DUE_DATE:"DUE_DATE",TITLE:"TITLE",AVAILABLE:"AVAILABLE",CURRENT:"current",EVERYONE:"EVERYONE",FILTER_STATE_KEY:"assignments.class.filters",SORT_STATE_KEY:"realize.assignments.class.sort",SORT_ASSIGNMENT_STUDENT_KEY:"realize.assignments.student.sort",ASSIGNMENT_BYCLASS_KEY:"realize.assignment.byclass",CLASS_DATE_RANGE:"classDateRange",CUSTOM_DATE_RANGE:"customRange",OPTIONAL_FEATURES:{COMMENTS:"comments.feature.enabled"},TABS:{ASSIGNMENTSBYCLASS:"assignmentsByClass",ASSIGNMENTSBYSTUDENT:"assignmentsByStudent"},DATE_FORMAT:{MM_DD_YY:"MM/DD/YY",MM_DD_YYYY:"MM/DD/YYYY",MM_DD_YY_TIME:"MM/DD/YY h:mma"},TIMES:{MIN_TIME:"12:00 am",MAX_TIME:"11:59 pm",MID_DAY:"12:00 pm",MINUTES:"minutes",DAY:"day",DAYS:"days",AM:"am",PM:"pm"},DEFAULT_REMEDIATION_DAYS:7,ADD_REMEDIATION_DAYS:1,DEEP_LINKED_URL:"deepLinkedUrl"}),angular.module("Realize.assignment.modalCtrl",["Realize.common.alerts","Realize.constants.mediaType","Realize.externalItem.Strategy","Realize.constants.contribSource","Realize.assignment.utilService","realize.core.isoDateService","Realize.common.timeDropdownDirective","rlzComponents.components.rubricSidePanel","Realize.search.telemetry","rlzComponents.components.telemetry.constants","rlzComponents.components.myLibrary"]).controller("AssignmentModalCtrl",["$scope","$rootScope","$log","$q","$location","Assignment","AssignmentFacadeService","ASSIGNMENT_CONSTANTS","lwcI18nFilter","AlertService","InlineAlertService","$route","AssignmentDataGenerator","RangeDatepickerOptions","DatepickerUtil","MEDIA_TYPE","$window","ExternalItemStrategy","CONTRIBUTOR_SOURCE","AssignmentUtil","ISODateService","rubricEventTracking","telemetryUtilitiesService","HEADER_HEIGHT","searchTelemetryUtilitiesService","Toast","GOOGLE_CLASSROOM","TELEMETRY_CONSTANTS","myLibraryEventTracking",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R,C,D,b,P){"use strict";
function w(){var t=h.innerHeight;e.modalBodyMaxHeight=t-y-Q-X-Z,e.$applyAsync()}var L=new g("#start-date","#due-date"),O=new g("#due-date","#remediation-date",o.ADD_REMEDIATION_DAYS),N=v.getExternalProviderName(),M=[],k=function(){var e=Date.now(),t=moment.duration(30,o.TIMES.MINUTES);return moment(Math.ceil(+e/+t)*+t).format("LT").toLowerCase()},z=function(){return e.startDate===e.dueDate},U=function(e){return e===moment().format(o.DATE_FORMAT.MM_DD_YYYY)},F=function(){var e=moment(),t=moment().endOf(o.TIMES.DAY),n=t.diff(e,o.TIMES.MINUTES);return 30>n},x=function(e,t){return moment(e,"h:mma").isBefore(moment(t,"h:mma"))},B=function(){var t=e.setTime&&e.time.start&&!e.startDateOptions.disabled&&U(e.startDate);if(t&&F())e.selectStartTime("");else if(t&&x(e.time.start,k()))e.selectStartTime(k());else if(!e.time.start){var n=U(e.startDate)?k():e.hours[0];e.selectStartTime(n)}},V=function(){e.time.due&&e.dueDate===e.startDate&&x(e.time.due,e.time.start)?e.selectDueTime(e.hours[e.hours.length-1]):e.time.start&&e.startDateOptions.disabled&&U(e.dueDate)&&x(e.time.due,k())&&e.selectDueTime(k())},H=function(){e.assignment.allowRemediation&&e.time.due&&e.selectRemediationTime(e.time.due)},G=function(){e.dueDate&&(e.remediationDueDate=a.getDefaultRemediationDateString(e.dueDate))},j=function(e){return function(){var t="#"+e,n=angular.element(t).datepicker();angular.element("#ui-datepicker-div").addClass("assign-dates-stack-order"),n.on("keydown",function(e){p.customizedKeydownEventForDatepicker(e,t)}),M.push(n)}},q=function(){return function(){angular.element("#ui-datepicker-div").removeClass("assign-dates-stack-order")}},Y=function(){return e.assignmentForm.startDate.$valid&&e.assignmentForm.dueDate.$valid&&e.assignmentForm.startTime.$valid&&e.assignmentForm.dueTime.$valid},W=function(){var t,n,r=new Date;t=e.startDate+" "+e.time.start,n=e.dueDate+" "+e.time.due,(!e.editMode&&U(e.startDate)||e.editMode&&U(e.startDate)&&!e.isAssignmentStarted())&&(e.isStartTimeBeforeCurrentTime=new Date(t)<r,e.assignmentForm.startTime.$setValidity("pattern",!e.isStartTimeBeforeCurrentTime)),e.isDueTimeBeforeStartTime=new Date(n)<new Date(t),e.assignmentForm.dueTime.$setValidity("pattern",!e.isDueTimeBeforeStartTime)},K=!1;e.mediaTypeOverride=void 0,e.startDateOptions=L.start,e.startDateOptions.minDate=0,e.dueDateOptions=L.end,e.dueDateOptions.minDate=0,e.remediationDueDateOptions=O.end,e.remediationDueDateOptions.minDate=0,e.setTime=!1,e.hours=T.getHours(),e.limtStartTimes=e.hours.length-1,e.time={start:e.hours[0],due:e.hours[e.hours.length-1],remediation:e.hours[e.hours.length-1]},e.startDateOptions.$setBeforeShow(j("start-date")),e.dueDateOptions.$setBeforeShow(j("due-date")),e.remediationDueDateOptions.$setBeforeShow(j("remediation-date")),e.startDateOptions.$setOnClose(q),e.dueDateOptions.$setOnClose(q),e.remediationDueDateOptions.$setOnClose(q),e.isStartTimeBeforeCurrentTime=!1,e.isDueTimeBeforeStartTime=!1,e.assignment={assignees:[]},e.titleMaxLength=o.TITLE_MAX_LENGTH,e.createMode="create"===e.mode,e.editMode="edit"===e.mode,e.disableSave=!0,e.getSelectedAssignees=function(){return _.filter(e.assignees,function(e){return e.selected===!0})},e.startHourIsDisabled=function(t){var n=t<e.hours.indexOf(k());return U(e.startDate)&&(F()||n)},e.hourIsDisabled=function(t){var n=e.hours[t];return e.time.start&&!e.startDateOptions.disabled&&z()?x(n,e.time.start):e.time.start&&e.startDateOptions.disabled&&U(e.dueDate)?x(n,k()):void 0},e.remediationhourIsDisabled=function(t){return e.time.due&&U(e.remediationDueDate)?t<e.hours.indexOf(k()):void 0},e.selectStartTime=function(t){e.$broadcast("time.updated.in.controller","startTime"),e.time.start=t},e.selectDueTime=function(t){e.$broadcast("time.updated.in.controller","dueTime"),e.time.due=t,H()},e.selectRemediationTime=function(t){e.$broadcast("time.updated.in.controller","remediationTime"),e.time.remediation=t},e.isEtext=function(){var t="eText"===e.item.mediaType||"Selected Reading"===e.item.mediaType,n="true"===h.realizeNotebookIntegrationEnabled;return t&&n},e.$watch("startDate",function(t,n){t!==n&&(e.isStartTimeBeforeCurrentTime=!1,B(),V())}),e.$watch("dueDate",function(t,n){t!==n&&(e.isDueTimeBeforeStartTime=!1,V(),G())}),e.$watch("time.start",function(t,n){t!==n&&(e.isStartTimeBeforeCurrentTime=!1,V())}),e.$watch("time.due",function(){e.isDueTimeBeforeStartTime=!1}),e.$on("time.autocorrected",function(t,n){"dueTime"===n&&(H(),e.assignmentForm.remediationTime.$setViewValue(e.time.remediation),e.assignmentForm.remediationTime.$render())}),e.$watch("setTime",function(t,n){t!==n&&(e.setTime===!1?(e.selectStartTime(o.TIMES.MIN_TIME),e.selectDueTime(o.TIMES.MAX_TIME),e.selectRemediationTime(o.TIMES.MAX_TIME)):e.setTime===!0&&B())});var Q=48,X=48,Z=110,J=angular.element(h);w(),J.on("resize",w),e.$on("$destroy",function(){J.off("resize",w)}),e.preSelectedItems=[],e.assignees=[],e.typeAndSelectConfig={results:e.assignees,formText:{mainLabel:l("assignmentForm.chooseAssignees.label"),help:l("assignmentForm.chooseAssignees.help"),noMatch:l("assignmentForm.chooseAssignees.noMatchNotification"),submitError:l("assignmentForm.errorNotification.assignee.message"),addAllLabel:l("calendar.eventForm.chooseClasses.addAllClasses"),offScreenRemove:l("assignmentForm.removeAssignee.a11y"),placeholder:l("assignmentForm.chooseAssignees.optional"),from:l("assignmentForm.chooseAssignees.from")},isAddAllEnabled:!1,isFormSubmitted:function(){return e.assignPressed},customFilter:function(e){if(-1===e.search(","))return{assigneeTitle:e};var t=e.split(","),n=$.trim(t[0]),r=$.trim(t[1]);return{lastName:n,firstName:r}},popoverPlacement:"left-top",preSelectedItems:e.preSelectedItems,hideRemoveIcon:function(t){return e.editMode&&(e.getSelectedAssignees().length<=1||e.isAssignmentStarted()&&t.preSelected)}},e.$watch("remediationDisplay + hasOtherLanguage + isContentRTAEnabled",function(){e.hasOtherLanguages&&(e.remediationDisplay||e.isContentRTAEnabled)?e.typeAndSelectConfig.customClasses="twoOptions":(e.remediationDisplay||e.hasOtherLanguages||e.isContentRTAEnabled)&&(e.typeAndSelectConfig.customClasses="oneOption")}),e.matchTmplUrl="templates/assignment/assignmentModalTypeaheadMatch.html",e.selectedItemTmplUrl="templates/assignment/assignmentModalSelectedItem.html",e.$on("typeAndSelect.itemRemoved",function(t,n){n.preSelected&&(n.removedFromEdit=!0),e.assignmentForm.$setDirty()}),e.validate={title:function(){return $.trim(e.assignment.title).length<=0},startDate:function(){var t=e.assignmentForm;return t.startDate.$invalid},dueDate:function(){var t=e.assignmentForm;return t.dueDate.$invalid},remediationDueDate:function(){var t=e.assignmentForm;return t.remediationDueDate?t.remediationDueDate.$invalid:!0},showMessage:function(){return this.title()||this.startDate()||this.dueDate()},assignees:function(){return _.isEmpty(e.getSelectedAssignees())},startTime:function(){var t=e.assignmentForm;return t.startTime.$invalid},dueTime:function(){var t=e.assignmentForm;return t.dueTime.$invalid},remediationTime:function(){var t=e.assignmentForm;return t.remediationTime?t.remediationTime.$invalid:!0}},e.formDataChanged=function(){var t=e.getSelectedAssignees(),n=_.filter(e.assignees,function(e){return e.preSelected}),r={startDate:e.item.parsedStart.format(o.DATE_FORMAT.MM_DD_YYYY),dueDate:e.item.parsedEnd.format(o.DATE_FORMAT.MM_DD_YYYY),remediationDueDate:e.item.parsedRemediationEnd?e.item.parsedRemediationEnd.format(o.DATE_FORMAT.MM_DD_YYYY):0},s={startTime:e.item.parsedStart.format("LT").toLowerCase(),dueTime:e.item.parsedEnd.format("LT").toLowerCase(),remediationTime:e.item.parsedRemediationEnd?e.item.parsedRemediationEnd.format("LT").toLowerCase():0},a={title:e.item.title!==e.assignment.title,startDate:r.startDate!==e.startDate,dueDate:r.dueDate!==e.dueDate,remediationDueDate:r.remediationDueDate!==e.remediationDueDate,instruction:e.item.instructions!==e.assignment.instructions&&!(null===e.item.instructions&&""===e.assignment.instructions),assignees:!_.isEqual(t,n),multiLanguage:e.item.allowMultipleLanguage!==e.assignment.allowMultipleLanguage,RRSActivity:e.item.includeRRSActivity!==e.assignment.includeRRSActivity,remediation:e.item.allowRemediation!==e.assignment.allowRemediation,startTime:s.startTime!==e.time.start,dueTime:s.dueTime!==e.time.due,remediationTime:s.remediationTime!==e.time.remediation};return _.any(a)},e.saveAssignment=function(r){if(r.preventDefault(),r.stopPropagation(),e.assignPressed=!0,null!==e.assignment.instructions&&(e.assignment.instructions=e.assignment.instructions.substring(0,250)),e.setTime&&Y()&&W(),e.assignmentForm.$valid&&!e.validate.assignees()){var o=e.assignment;e.isInProgress=!0;var m;m=e.editMode?T.showAssignmentEditExternalError():T.showAssignmentCreateExternalError();var g=e.assignment.contentItem.contentItems.length>1,p=function(e){C.close(),e.status===D.ACCOUNT_REVOKED_STATUS_CODE?C.error(T.showUnableToAccessExternalAccountError()):C.error(m)},h=function(e){u.addAlert(e,{type:"googleError",msg:m.msg})},v=function(e){!K&&e.selected&&e.isFromGoogleClass()&&(K=!0)},I=function(t,r){var l=e.startDate+" "+e.time.start,c=e.dueDate+" "+e.time.due;if(e.assignment.allowRemediation&&e.remediationDisplay){e.remediationDueDate||(e.remediationDueDate=G());var u=e.remediationDueDate+" "+e.time.remediation;o.remediationDueDate=A.toDateTimeString(new Date(u))}o.startDate=A.toDateTimeString(new Date(l)),o.dueDate=A.toDateTimeString(new Date(c));var d=new a(o);n.log("Creating assignment object",d),d.hasRemediation=e.remediationDisplay,d.hasMultipleLanguage=e.hasOtherLanguages,d.useRubric=e.assignment.useRubric,d.multiSelectRequest=e.multiSelectRequest,T.getProgramHierarchy(e.item,d.itemUuid).then(function(n){var a="";a=e.assigntype===b.LESSON_ASSET_MULTI_SELECT.ASSIGN_SELECTED?b.DESCRIPTION.MULTI_SELECT:e.item.mediaType,0===s.path().search("/myLibrary")?P.onAssignContent(e.item.id,a):R.sendTelemetryEventsFromCreateAssignment(n,a),n="programHierarchy="+encodeURIComponent(JSON.stringify(n)),i.saveAssignment(d,n).then(t,r)})};if(e.editMode){e.isAssignmentStarted()?e.assignment.assignees=_.filter(e.assignees,function(e){var t=!e.preSelected&&e.selected;return void 0!==t&&v(e),t}):(e.assignment.removedAssignees=_.filter(e.assignees,function(e){return e.removedFromEdit&&!e.selected}),e.assignment.assignees=_.filter(e.assignees,function(e){return v(e),e.selected}));var E,y=e.assignment.assignmentId;E=K?["</strong>",l("googleClassroom.editAssignment.successNotification.message")].join(" "):["<strong>",l("assignmentList.editAssignment.successNotification.assignmentEdited.title"),"</strong>",l("assignmentList.editAssignment.successNotification.assignmentEdited.message")].join(" ");var w=function(n){var r=_.findWhere(n.assignedTo,{classUuid:t.currentRoster.classId});y=r&&r.assignmentId?r.assignmentId:e.assignment.assignmentId;var s=function(){u.addAlert(y,{type:"success",msg:E})};e.useBannerAlert?(c.addAlert("success","ok-sign",E,2),e.close(),d.reload()):(e.$emit("assignmentListByClass.drawer.close"),t.$broadcast("assignment:edit:success",{assignment:new a(angular.extend(e.item,e.assignment)),callback:s}),e.close())},L=function(t){if(t.data&&-1!==t.data.errorCode.indexOf(D.EXTERNAL_ERROR))p(t),e.close(),h(y);else{var n=l("program.errorNotification.generic.message");c.addAlert("error","exclamation-sign",n,2),e.close(),d.reload()}};I(w,L)}else{e.assignment.assignees=_.filter(e.assignees,function(e){return v(e),e.selected});var $;$=K?["</strong>",l("googleClassroom.createAssignment.successNotification.message")].join(" "):e.assignment.contentItem.mediaType===f.DISCUSSION_PROMPT&&e.assignment.contentItem.contribSource===S.MY_UPLOADS?["<strong>",l("prompt.successNotification.assignedPrompt.title"),"</strong>",l("prompt.successNotification.assignedPrompt.message")].join(" "):["<strong>",l("program.createAssignment.successNotification.title"),"</strong>",l("program.createAssignment.successNotification.message")].join(" ");var O=function(){var t=e.assignment.contentItem.mediaType!==f.PLAYLIST.toLowerCase();t&&!g&&u.addAlert(e.assignment.contentItem.id,{type:"success",msg:$}),e.$emit("assignmentModal.alert.toggle",{show:!0,alertDetails:{msg:$,type:"success",icon:"ok-sign"},assignedItem:e.assignment.contentItem}),e.close()},N=function(t){if(t.data&&-1!==t.data.errorCode.indexOf(D.EXTERNAL_ERROR))p(t),e.close(),h(e.assignment.contentItem.id);else{var n=l("program.errorNotification.generic.message");c.addAlert("error","exclamation-sign",n,1),e.$emit("assignmentModal.alert.toggle",{show:!0,alertDetails:{msg:n,type:"error",icon:"exclamation-sign"}}),e.close()}};I(O,N)}}},e.remediationDisplay=!1,e.useRubricDisplay=!1,e.hasOtherLanguages=!1,e.isContentRTAEnabled=!1,e.editingAlert=!1,e.isTitleInvalid=function(){return e.assignmentForm.title.$invalid&&e.assignPressed};var et=function(t){var n=_.findWhere(e.checkedItems,{id:t.id});if(e.checkedItems&&n&&t.rubricAvailable||!e.checkedItems&&t.rubricAvailable)return e.useRubricDisplay=!0,void 0;if(t.contentItems&&t.contentItems.length)for(var r=0;r<t.contentItems.length&&!e.useRubricDisplay;r++)et(t.contentItems[r])},tt=function(t){return et(t),e.editMode?e.item.useRubric:e.createMode?e.useRubricDisplay:void 0};e.areAssignmentDatesInvalid=function(){return e.assignPressed&&(e.assignmentForm.startDate.$invalid||e.assignmentForm.dueDate.$invalid||e.isStartTimeBeforeCurrentTime||e.isDueTimeBeforeStartTime)},e.onChangeUseRubric=function(t){e.productName?I.onUseRubricForAssignmentSelection(t,e.productName):T.getProgramHierarchy(e.item,e.assignment.itemUuid).then(function(n){e.productName=E.getProgramTitle(n),I.onUseRubricForAssignmentSelection(t,e.productName)})};var nt=function(t){var n=_.findWhere(e.checkedItems,{id:t.id});if(e.checkedItems&&n&&null!==t.associatedRemediation&&"Assessment"===t.contentType||!e.checkedItems&&null!==t.associatedRemediation&&"Assessment"===t.contentType)e.remediationDisplay=!0;else if(t.contentItems&&t.contentItems.length>0){var r;for(r=0;r<t.contentItems.length&&!e.remediationDisplay;r++)nt(t.contentItems[r])}return e.editMode?e.item.allowRemediation:e.createMode?e.remediationDisplay:void 0};e.hasOtherLanguage=!1;var rt=function(t){if(e.editMode)return t.hasOtherLanguages;if(e.createMode){var n=_.findWhere(e.checkedItems,{id:t.id});if(e.checkedItems&&n&&t.hasOtherLanguages||!e.checkedItems&&t.hasOtherLanguages)e.hasOtherLanguage=!0;else if(t.contentItems&&t.contentItems.length>0){var r;for(r=0;r<t.contentItems.length&&!e.hasOtherLanguage;r++)rt(t.contentItems[r])}return e.hasOtherLanguage}};if(e.editMode){var st=moment(),at=e.item.$getLegibleDateObj();e.startDate=at.startDate.format(o.DATE_FORMAT.MM_DD_YYYY),e.dueDate=at.dueDate.format(o.DATE_FORMAT.MM_DD_YYYY),e.setTime=!0,e.isAssignmentStarted=function(){return at.startDate.isBefore(st)||at.startDate.isSame(st)},e.isAssignmentDue=function(){return at.dueDate.isBefore(st)},e.isTodayOrBefore=function(){return at.startDate.isBefore(moment().endOf(o.TIMES.DAY))},e.editingAlert=e.isAssignmentStarted(),e.startDateOptions.minDate=e.isAssignmentStarted()?at.startDate.format(o.DATE_FORMAT.MM_DD_YY):0,e.startDateOptions.disabled=e.isAssignmentStarted(),e.dueDateOptions.minDate=e.isAssignmentDue()?at.dueDate.format(o.DATE_FORMAT.MM_DD_YY):0,e.selectStartTime(at.startDate.format("LT").toLowerCase()),e.selectDueTime(at.dueDate.format("LT").toLowerCase()),at.remediationDueDate?(e.remediationDueDate=at.remediationDueDate.format(o.DATE_FORMAT.MM_DD_YYYY),e.remediationDueDateOptions.minDate=e.isAssignmentDue()?at.remediationDueDate.format(o.DATE_FORMAT.MM_DD_YY):0,e.selectRemediationTime(at.remediationDueDate.format("LT").toLowerCase())):(e.remediationDueDate=0,e.selectRemediationTime(0))}e.item.contentItem&&e.item.contentItem.fileType===N&&(e.item.contentItem.id=e.item.itemUuid);var it=angular.isDefined(e.item.externalItemId)?N:o.ONESOURCE,ot=!0,lt=m.getInstance(it,e.item,e.createMode,ot),ct=function(t){return t.length>0?_.filter(t,function(t){_.contains(e.selectedStudents,t.studentId)&&e.classId===t.classId&&(t.selected=!0)}):void 0},ut=function(){var t={assignees:e.assignees,classUuids:[],contentItem:e.item,itemUuid:"",itemVersion:"",title:"",dueDate:null,startDate:null,instructions:null,allowRemediation:!1,allowMultipleLanguage:!1,includeRRSActivity:!1};return t},dt=e.item.mediaType===f.PLAYLIST.toLowerCase(),mt=!dt&&"multiselect"===e.assigntype&&e.item.contentItems.length>1?ut():lt.getAssignmentData();e.assignment=new a(mt),e.assignment.removedAssignees=[],e.closeEditingAlert=function(){e.editingAlert=!1};var gt=function(e){var n=t.currentUser.getAttribute("classes.withoutPrograms");return!n||n.length<1?e:_.filter(e,function(e){return!_.isEmpty(e.productIds)||!_.contains(n,e.classId)})};lt.getAssignees().then(function(t){angular.extend(e.assignees,gt(t)),"multiselect"===e.assigntype&&angular.extend(e.assignees,ct(e.assignees)),e.assignees.length>0&&e.editMode&&lt.getPreSelectedAssignees(e.item,e.assignees).then(function(t){angular.extend(e.preSelectedItems,t),e.$broadcast("typeAndSelect.selectPrePopulatedItems",e.preSelectedItems)})});var pt=function(t){e.isContentRTAEnabled=t.mediaType===f.REALIZE_READER_SELECTION,e.createMode&&(e.assignment.allowMultipleLanguage=rt(t),e.assignment.includeRRSActivity=e.isContentRTAEnabled),e.assignment.allowRemediation=nt(t),e.assignment.useRubric=tt(t),e.disableSave=!1,e.hasOtherLanguages=rt(t)},ft=function(){var t=_.map(e.multiSelectRequest,function(e){return e.itemUuid});lt.getCustomContent(t).then(function(e){pt(e)},function(){e.disableSave=!1})},ht=function(){var t=_.map(e.item.contentItem.contentItems,function(e){return e.id});lt.getCustomContent(t).then(function(e){pt(e)},function(){e.disableSave=!1})},vt=function(){lt.getContent().then(function(e){pt(e)},function(){e.disableSave=!1})};"multiselect"===e.assigntype&&e.item.contentItems.length>1?ft():"edit"!==e.mode||"MULTIRESOURCE"!==e.item.type&&"PLAYLIST"!==e.item.type?vt():("PLAYLIST"===e.item.type&&(e.mediaTypeOverride=f.PLAYLIST.toLowerCase()),ht()),e.$on("$destroy",function(){M.forEach(function(e){e.off()}),M=null})}]),angular.module("Realize.assignment",["Realize.assignment.constants","Realize.assignment.model.assignment","Realize.assignment.facadeService","Realize.assignment.common.landingCtrl","Realize.assignment.teacher.levelOneCtrl","Realize.assignment.teacher.levelTwoCtrl","Realize.assignment.teacher.assignmentsByStudent","Realize.assignment.teacher.notebook.notebookTokenService","Realize.assignment.teacher.notebook.notebookCtrl","Realize.assignment.teacher.manualScoreTestCtrl","Realize.assignment.teacher.manualScoreReviewCtrl","Realize.assignment.student.levelOneCtrl","Realize.assignment.sideDrawer","Realize.assignment.bottomDrawer","Realize.assignment.modal","Realize.assignment.filters","Realize.assignment.modalCtrl","Realize.assignment.zeroState","Realize.assignment.listByClass","Realize.assignment.listByStudent","Realize.assignment.tabStudent","Realize.assignment.zeroStateService","Realize.assignment.assignmentsListByStudentService","Realize.assignment.common.RRSSCOReview","Realize.common.fitToContentDirective","Realize.assignment.viewOptions","Realize.assignment.turnInAssignment"]),angular.module("Realize.assignment.bottomDrawer",["Realize.assignment.utilService"]).directive("assignmentBottomDrawer",["AssignmentUtil","breadcrumbTelemetryService","BREADCRUMB_TELEMETRY_CONSTANTS",function(e,t,n){"use strict";return{templateUrl:"templates/assignment/assignmentBottomDrawer.html",replace:!0,link:function(r){r.breadcrumbHandler=function(r,s,a){r.stopPropagation();var i=r.currentTarget.text,o={page:n.PAGE.ASSIGNMENT,subpage:n.SUBPAGE.ASSIGNMENTS_BY_CLASS_STATUS,area:n.AREA.CLASSES};t.sendTelemetryEvents(i,a,o),e.navigateToSourceProgram(s)}}}}]),angular.module("Realize.assignment.facadeService",["Realize.assignment.utilService","RealizeDataServices","Realize.user.currentUser","Realize.classRoster.classDataService","Realize.content.model.contentItem","Realize.content.model.openEdItem","Realize.assignment.model.assignment","Realize.ExternalItem","Realize.assignment.viewOptions","realize.core.isoDateService","rlzComponents.components.i18n","webStorageModule"]).factory("AssignmentFacadeService",["$http","$log","$currentUser","$q","Content","REST_PATH","$location","ASSIGNMENT_CONSTANTS","ClassRoster","Messages","OpenEdItem","ISODateService","numberFilter","AssignmentUtil","ClassDataService","Assignment","ExternalItemStrategy","AssignmentViewOptions","lwcAssignment","lwcI18nFilter","webStorage",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A){"use strict";function I(e){return t.warn("Y U NO USE Assignment model"),f(e)}function E(n,s,i){var l=a+"/v2/classes/"+s+"/assignments/"+i;return e({url:l,method:"GET"}).then(function(e){var t=e.data;return"Sequence"===t.contentItem.fileType?(angular.forEach(t.contentItem.contentItems,function(e){return"Learning Model"===e.mediaType&&e.contentItems.length?u.retrieveItemsInList(e.contentItems,function(e){return e.externalSource===o.EXTERNAL_SOURCE.OPENED}).then(function(){return new n(t)}):void 0}),u.retrieveItemsInList(t.contentItem.contentItems,function(e){return e.externalSource===o.EXTERNAL_SOURCE.OPENED}).then(function(){return new n(t)})):t.contentItem.externalSource===o.EXTERNAL_SOURCE.OPENED?u.getPromise(t.contentItem.externalId).then(function(r){var s=e.data.contentItem.id;return t.contentItem=r,e.data.contentItem.originalEquellaItemId=s,new n(t)}):new n(t)},function(e){return t.error("Error getting assignment",e),r.reject(C(e))})}var y=[],R="standardMasteryByClass",C=function(e){var t={type:"redirect"};return t.path=e.data&&"404"===e.data.errorCode?"error/item-not-found":"error/default",t},D=function(e){return!(!e.contentItem||e.contentItem.externalSource!==o.EXTERNAL_SOURCE.OPENED)},b=function(e){var t=e.assignments;return angular.forEach(t,function(e,n){t[n]=new f(e)}),e},P=function(e){var t={};return angular.extend(t,e),t.startDate&&(t.startDate=d.toStartOfDayStringWithZone(new Date(t.startDate))),t.endDate&&(t.endDate=d.toStartOfNextDayStringWithZone(new Date(t.endDate))),t.dueDateStartRange&&(t.dueDateStartRange=d.toStartOfDayStringWithZone(new Date(t.dueDateStartRange))),t.dueDateEndRange&&(t.dueDateEndRange=d.toStartOfNextDayStringWithZone(new Date(t.dueDateEndRange))),t},w=function(e){return e&&e.userAssignmentDataList&&e.userAssignmentDataList.length>0},L=function(t,n){var r=a+"/v2/assignments/userAssignment/"+t+"/attachments/status";return e({url:r,method:"PUT",params:{status:n}}).then(function(e){return e.data})},$=function(t,n,r,s){var i=a+"/v2/classes/"+n+"/assignments/"+t+"/status";return e({url:i,method:"PUT",params:{status:r,isGoogleImportedClass:s}})},O=function(e,n){if(!angular.isObject(e))return e;var r,s,a,i,o=["assignees","assignedTo","studentClass","removedAssignees","contentItem","OpenEdItem","assignmentSource","multiSelectRequest"],l=[],c=[],u=function(e,t,n){var r=[];return e.sort(function(e,t){return e.type.toLowerCase().localeCompare(t.type.toLowerCase())}),angular.forEach(e,function(e,s){var a=encodeURIComponent(t+"["+s+"]");n&&(a="assignment."+a),r.push(e.$getSerializedString(a))}),r},d=function(e,t){var n=[];return angular.forEach(e,function(e,r){var s=encodeURIComponent(t+"["+r+"]"),a=s+".itemUuid="+e.itemUuid,i=a+"&"+s+".itemVersion="+e.itemVersion;n.push(i)}),n};if(angular.forEach(e,function(e,t){angular.isFunction(e)||_.contains(o,t)||!e||0===e.length||l.push("assignment."+t+"="+encodeURIComponent(e))}),angular.isDefined(e.externalSourceId)){var m=h.getExternalProviderName(),g=["externalResource="+!0,"externalItem.externalSource="+m,"externalItem.externalId="+e.externalSourceId,"externalItem.title="+e.contentItem.title,"externalItem.contribSource="+m,"externalItem.thumbnailUrls[0]="+e.contentItem.thumbnailUrls[0]];l=l.concat(g)}return s=l.join("&"),a=u(e.assignees,"newAssignedTo"),e.removedAssignees&&e.removedAssignees.length>0&&(c=u(e.removedAssignees,"assignedTo",!0)),e.multiSelectRequest&&(i=d(e.multiSelectRequest,"multiSelectItems"),s+="&"+i.join("&")),r=a.concat(c).join("&"),n&&(s+="&"+n),r?s+"&"+r:(t.debug("assigneePayload",r),t.debug("assignmentPayload",s),s)},N=function(e){var t,n=function(e,t){var n=e,r=[t+".userAssignmentId="+n.userAssignmentId,t+".score="+n.score,t+".scoreSent="+n.scoreSent];return r.join("&")},r=function(e,t){var r=[];return angular.forEach(e,function(e,s){var a=encodeURIComponent(t+"["+s+"]");r.push(n(e,a))}),r};return angular.isObject(e)?(t=r(e.userAssignmentDataList,"userAssignmentDataList"),t.push("studentUuid="+e.studentUuid),t.join("&")):e},M=function(e,t){return n.isTeacher&&t.page>1&&e.numberOfAssignments>0&&0===e.assignments.length};return I.saveAssignment=function(t,r){var s=a+"/v2/assignments",i={assignmentObj:t,programHierarchyObj:r};return e.post(s,i,{transformRequest:function(e){return O(e.assignmentObj,e.programHierarchyObj)}}).then(function(e){return n.setAttribute("assignments.created",!0),e.data})},I.getAssignmentsWithExternalProviderData=function(e){var t=function(e){return D(e)},n=function(e){return e.contentItem?e.contentItem.externalId:void 0},r=function(e,t){var n=_.find(e,function(e){return!!e.contentItem&&e.contentItem.externalId===t.id});n&&(t.originalEquellaItemId=n.contentItem.id,n.contentItem=t)};return u.retrieveItemsInList(e.assignments,t,n,r).then(function(t){return angular.forEach(t,function(e,n){angular.extend(t[n],e)}),e})},I.getAssignmentsByClass=function(s,i){var o=a+"/v2/classes/"+s+"/assignments";return i=i||(n.isTeacher?v.getDefaultFilter(s):v.getDefaultStudentFilter()),e({url:o,method:"GET",params:P(i)}).then(function(e){return M(e.data,i)?(i.page=1,I.getAssignmentsByClass(s,i)):(e.data.page=i.page,b(e.data))},function(e){return t.error("error getting assignments",e),r.reject("error getting assignments",e)})},I.getAssignmentsByStudent=function(n){var s=a+"/v2/classes/"+n+"/students/assignments";return e({url:s,method:"GET"}).then(function(e){return _.each(e.data,function(e,t){e.id=t}),e.data},function(e){return t.error("error getting assignments",e),r.reject("error getting assignments",e)})},I.getActiveCountForUser=function(t){return e({url:a+"/v2/assignments/"+t+"/count",method:"GET"}).then(function(e){return parseInt(e.data,10)},function(e){return r.reject(e)})},I.getStudentAssignmentsCount=function(n,s){var i=a+"/v2/classes/"+n+"/students/"+s+"/assignments/count/";return e({url:i,method:"GET"}).then(function(e){return e.data},function(e){return t.error("error getting assignments",e),r.reject("error getting assignments",e)})},I.getStudentAssignmentsByStatus=function(n,s,i,o){var l,c=a+"/v2/classes/"+n+"/students/"+s+"/assignments/completionStatus/"+i;return l=o||v.getDefaultStudentFilter(),e({url:c,method:"GET",params:P(l)}).then(function(e){return b(e.data)},function(e){return t.error("error getting assignments",e),r.reject("error getting assignments",e)})},I.getAssignmentsCountByClass=function(t){var n=a+"/v2/classes/"+t+"/assignmentsCount";return e.get(n).then(function(e){return e.data},function(e){return r.reject("error getting assignments count",e)})},I.get=function(e,t){var n=function(e){return new f(e)};return E(n,e,t)},I.getLWCAssignment=function(e,t){var n=function(e){return new S(e)};return E(n,e,t)},I.preview=function(e){n.previewItemsStatusList={},n.isPreviewingAssignment=!0,i.path(e)},I.previewItem=function(e){var r=[e.id,e.version].join(" ");n.previewItemsStatusList[r]=e.selectedLanguage,t.debug("previewItemsStatusList",n.previewItemsStatusList)},I.updateLanguagePreference=function(t,n){var r=a+"/v2/assignments/userAssignment/"+t+"/language/"+n;return e.put(r).then(function(e){return e.data})},I.setInProgress=function(t,n,r,s){var i=a+"/v2/assignments/userAssignment/"+t+"/status",o={status:"IN_PROGRESS"};return n&&(o.isAdaptive=n,o.classUuid=r,o.assignmentId=s),e({url:i,method:"PUT",params:o}).then(function(e){return e.data})},I.setCompleted=function(t,n,r){var s=a+"/v2/assignments/userAssignment/"+t+"/status",i={status:"COMPLETED"};return n&&(i.isAdaptive=n),r&&(i.itemType=r),e({url:s,method:"PUT",params:i}).then(function(e){return e.data})},I.getAllAssignedTos=function(t){var n=a+"/v2/assignments/"+t+"/assignedTos";return e.get(n).then(function(e){return e.data},function(e){return r.reject("error getting all assignees",e)})},I.getClassesReportingData=function(e){return p.getClassesReportingData(e)},I.dismissPastDueWarning=function(e){y.push(e)},I.isPastDueWarningDismissed=function(e){return _.contains(y,e)},I.saveManuallyEnteredScore=function(t){var n=a+"/v2/assignments/userAssignment/manualScore";return e.post(n,t,{transformRequest:function(e){return N(e)}}).then(function(e){return e.data})},I.hasScore=function(e){return!(!(e&&e.userAssignmentDataList&&e.userAssignmentDataList.length>0)||"COMPLETED"!==e.userAssignmentDataList[0].completionStatus&&"MANUAL"!==e.userAssignmentDataList[0].scoreSource||!angular.isNumber(e.userAssignmentDataList[0].score))},I.hasScoreSourceManual=function(e){return!!(e&&e.userAssignmentDataList&&e.userAssignmentDataList.length>0&&"MANUAL"===e.userAssignmentDataList[0].scoreSource)},I.getScore=function(e){return w(e)?e.userAssignmentDataList[0].score:void 0},I.getEssayScore=function(e,t){if(w(e)){var n=e.userAssignmentDataList[0];return n.correctAnswers/n.totalQuestions*t}},I.isManualScoreType=function(e){return e&&"TEST"===e.itemType&&w(e)&&e.userAssignmentDataList[0]&&"COMPLETED"===e.userAssignmentDataList[0].completionStatus&&e.userAssignmentDataList[0].manualScore},I.isNotScored=function(e){return e&&"TEST"===e.itemType&&w(e)&&e.userAssignmentDataList[0]&&"COMPLETED"===e.userAssignmentDataList[0].completionStatus&&e.userAssignmentDataList[0].needsManualScoring},I.isScoreSent=function(e){return e&&"TEST"===e.itemType&&w(e)&&e.userAssignmentDataList[0]&&"COMPLETED"===e.userAssignmentDataList[0].completionStatus&&e.userAssignmentDataList[0].scoreSent},I.scoredAndSent=function(e){return!I.isNotScored(e)&&I.isScoreSent(e)},I.computeScoreStatus=function(e){return{isManualScore:I.isManualScoreType(e),isNotScored:I.isNotScored(e),isScoreSent:I.isScoreSent(e),score:I.getScore(e)}},I.getScoreStatusCounts=function(e){var n,r,s,a={};return a.studentCount=e.length,a.scoreCount=_.countBy(e,function(e){return e.isNotScored?"notScored":"scored"}),a.sendCount=_.countBy(e,function(e){return e.isScoreSent?"sent":"notSent"}),n=a.scoreCount.notScored,r=a.studentCount,s=a.sendCount.sent,a.isPartiallyScored=n>0&&r>n,a.isPartiallySent=s>0&&r>s,a.allScoresSent=a.sendCount.sent===r,a.allUnscored=a.scoreCount.notScored===r,t.log("scoringReviewStatus: ",a),a},I.getUploadAttachmentUrl=function(e){return a+"/v2/assignments/userAssignment/"+e+"/attachments"},I.attachLink=function(t,n,r,s){var a=I.getUploadAttachmentUrl(n);return e({url:a,method:"POST",params:{assignmentId:t,url:r,title:s}}).then(function(e){return JSON.parse(e.data)})},I.removeAttachment=function(e){var t=e.$getPrimaryMetadata().userAssignmentId;return L(t,o.ATTACHMENT_STATUS.DELETED).then(function(){var t=e.$getUserAttachment();return e.$getPrimaryMetadata().attachmentUrl=null,t})},I.reattachAttachment=function(e,t){var n=e.$getPrimaryMetadata().userAssignmentId;return L(n,o.ATTACHMENT_STATUS.LIVE).then(function(){e.$getPrimaryMetadata().attachmentUrl=t.path})},I.hideAssignment=function(e,n,r,s){return $(e.assignmentId,n,"INACTIVE",r).then(function(){e.status="INACTIVE";var t=A.get(R+"."+s+"."+n);t&&t.assignmentIds&&t.assignmentIds.includes(e.assignmentId)&&I.resetlocalStorageData(t,s,n)},function(e){t.error("Failed to hide assignment",e)})},I.unhideAssignment=function(e,n,r){return $(e.assignmentId,n,"AVAILABLE",r).then(function(){e.status="AVAILABLE"},function(e){t.error("Failed to unhide assignment",e)})},I.bulkShowHide=function(t,n,r,s){var i=a+"/v2/classes/"+t+"/assignments/status";return e({url:i,method:"PUT",params:{assignmentIds:n,status:r,isGoogleImportedClass:s}})},I.publishScores=function(n,s){var i=a+"/v2/classes/"+s+"/assignments/"+n+"/scores";return e({url:i,method:"POST"}).then(function(e){return t.log("Published assignment scores",e),e.data},function(e){return t.error("Failed to publish assignment scores",e),r.reject(e)
})},I.deleteUserAssignment=function(t){var n=a+"/v2/assignments/userAssignment/"+t;return e.delete(n).then(function(e){return e.data},function(e){return r.reject("Error deleting userAssignment",e)})},I.restoreUserAssignment=function(t){var n=a+"/v2/assignments/userAssignment/"+t+"/undelete";return e.post(n).then(function(e){return e.data},function(e){return r.reject("Error undo deleting userAssignment",e)})},I.resetlocalStorageData=function(e,t,n){e.standards&&(e.standards=T("masteryByStandard.filter.allStandards"),e.isAllStandards=!0),e.contentCategory&&(e.contentCategory=T("masteryByStandard.filter.allCategories"),e.isAllContentCategory=!0),e.assignmentId&&(e.assignmentId=T("masteryByStandard.filter.allAssignments"),e.isAllAssignment=!0),e.assignmentTitle&&(e.assignmentTitle=T("masteryByStandard.filter.allAssignments")),e.assignmentIds=[],A.add(R+"."+t+"."+n,e)},I}]),angular.module("Realize.assignment.modal",["ModalServices","RealizeDataServices","Realize.content","Realize.assessment.assessmentDataService","Realize.constants.mediaType"]).directive("assignmentModal",["$log","Modal","$location","ClassRoster","Content","Assessment","MEDIA_TYPE","ClassUtil","Permissions","$rootScope",function(e,t,n,r,s,a,i,o,l,c){"use strict";var u=!1,d=function(e){var r="assignmentForm.zeroState.noClasses.title",s="assignmentForm.zeroState.noClasses.message",a={OK:{title:"assignmentForm.zeroState.noClasses.action.createClass",handler:function(){n.path("classes/create")},isDefault:!0},CANCEL:{title:"assignmentForm.zeroState.noClasses.action.cancel",handler:e}};t.simpleDialog(r,s,a,{id:"assignModalZeroClassStateModal"}),u=!1},m=function(e){var r="assignmentForm.zeroState.noStudents.title",s="assignmentForm.zeroState.noStudents.message",a={OK:{title:"assignmentForm.zeroState.noStudents.action.goToClass",handler:function(){n.path("classes")},isDefault:!0},CANCEL:{title:"assignmentForm.zeroState.noStudents.action.cancel",handler:e}};t.simpleDialog(r,s,a,{id:"assignModalZeroStudentStateModal"}),u=!1},g=function(){var e="federatedUser.assignmentForm.zeroState.noStudents.title",n="federatedUser.assignmentForm.zeroState.noStudents.message";t.simpleDialog(e,n,null,{id:"assignModalZeroStudentStateFederatedUser"}),u=!1},p=function(){var e="federatedUser.assignmentForm.zeroState.noClasses.title",n="federatedUser.assignmentForm.zeroState.noClasses.message";t.simpleDialog(e,n,null,{id:"assignModalZeroHiddenClassesStateFederatedUser"}),u=!1},f=function(){var e="assignmentForm.zeroState.noQuestions.title",n="assignmentForm.zeroState.noQuestions.message";t.simpleDialog(e,n,null,{id:"assignModalZeroQuestionStateModal"}),u=!1},h=function(){var e="assignmentForm.zeroState.missingItem.title",n="assignmentForm.zeroState.missingItem.message";t.simpleDialog(e,n,null,{id:"assignModalMissingItemModal"}),u=!1},v=function(){var e="assignmentForm.zeroState.brokenItem.title",n="assignmentForm.zeroState.brokenItem.message";t.simpleDialog(e,n,null,{id:"assignModalBrokenItemModal"}),u=!1},S=function(e,n){var r="noPrograms.modal.assignments.heading",s="noPrograms.modal.assignments.message",a={OK:{title:"noPrograms.modal.action.ok",handler:e,isDefault:!0},CANCEL:{title:"noPrograms.modal.action.cancel",handler:n}};t.simpleDialog(r,s,a,{id:"assignModalNoPrograms"}),u=!1};return{link:function(s,T,A){var I,E=null;I=function(T){if(u)return!1;T.preventDefault(),T.stopPropagation();var I=c.currentUser,y=s.$eval(A.assignmentModal),R=s.$eval(A.contentJson),C=s.$eval(A.checkedItems),D=function(){s.$eval(A.onSaveAssignment)},b=function(){s.$eval(A.onCancelAssignment)},P=function(){r.get().then(function(e){var n=o.hasAtLeastOneStudentInRosters(e),r=0===e.length,a=I.getAttribute("classes.created"),i=l.hasPermission("create_class");r&&i?d(b):r&&a&&!i?p():!n&&i?m(b):n||i?(E=s.$new(!0),E.item=y,E.mode=A.mode,E.assigntype=A.assigntype,E.classId=A.classId,E.selectedStudents=s.$eval(A.selectedStudents),E.useBannerAlert=s.$eval(A.useBannerAlert),E.classes=e,E.multiSelectRequest=R,E.checkedItems=C,E.close=function(e){t.hideDialog(),e?b():D(),E.$destroy()},E.$emit("assignmentModal.alert.toggle",{show:!1}),t.showDialog("templates/assignment/assignmentModal.html",E),u=!1):g()})},w=function(){!y.isExternalResource()&&y.$isTest()?(y=y.$getDefaultVersion(),a.getInfo(y.id,y.version).then(function(e){0===e.questionCount?f():P()},function(t){e.error(t),u=!1,v()})):P()},L=function(e){var t=[i.DISCUSSION_PROMPT,i.PLAYLIST],n=t.findIndex(function(t){return t.toLowerCase()===e.toLowerCase()});return n>-1},$=function(e){e||(e=angular.noop),I.showNoProgramModal(!0)?(S(function(){var e=I.getAttribute("classes.withoutPrograms");I.setAttribute("hideNoProgramModal",!0),e.length>1?n.path("classes"):n.path(["classes",e[0],"manage"].join("/"))},function(){I.setAttribute("hideNoProgramModal",!0),e()}),s.$applyAsync()):e()};if("multiselect"===A.assigntype&&y.contentItems.length>1)P();else if("BROKEN"!==y.mediaType&&("create"!==A.mode||L(y.mediaType)||y.attachments&&0!==y.attachments.length||"My Uploads"===y.contribSource))if(u=!0,"edit"===A.mode){var O=s.$eval(A.assignmentModal);O.missingContentItem?h():(E=s.$new(!0),E.item=O,E.mode=A.mode,E.useBannerAlert=s.$eval(A.useBannerAlert),E.close=function(){t.hideDialog(),E.$destroy()},E.$emit("assignmentModal.alert.toggle",{show:!1}),t.showDialog("templates/assignment/assignmentModal.html",E),u=!1)}else $(w);else $(v);s.$applyAsync()},T.on("click",I)}}}]),angular.module("Realize.assignment.sideDrawer",["Realize.common.mediaQueryService","Realize.analytics","Realize.assignment.utilService"]).directive("assignmentSideDrawer",["$timeout","$rootScope","$location","MediaQuery","AssignmentUtil","breadcrumbTelemetryService","BREADCRUMB_TELEMETRY_CONSTANTS",function(e,t,n,r,s,a,i){"use strict";function o(){function e(e,t){t.tabIndex=f.nextIndex}f.reset(),p.find("li:not(.rowHeader)").each(function(t,n){angular.element(n).find("a, button").each(e),n.classList.contains("selected")&&angular.element(".drawerContainer").find("a, button").each(e)}),h.find("a, button").each(function(e,t){t.tabIndex=f.nextIndex})}function l(){function e(e,t){t.removeAttribute("tabindex")}p.find("[tabindex]").each(e),h.find("[tabindex]").each(e)}function c(){g.find("a, button").attr("tabindex","-1")}function u(){m=p.find("li.selected").first()}function d(){return g.find(":focusable").first()}var m,g,p,f,h=angular.element("#footer");return f=function(){function e(){return n}function t(){return n+=1}var n,r,s=-1;return angular.element("[tabindex]").each(function(e,t){s=Math.max(s,t.tabIndex)}),n=s+1,r={reset:function(){n=s+1}},Object.defineProperties(r,{currentIndex:{get:e},nextIndex:{get:t}}),r}(),{templateUrl:"templates/assignment/assignmentSideDrawer.html",link:function(n,f){function h(){e(function(){var n,r,s,a,i,l,c=g.height(),m=c/2,f=p.height(),h=angular.element(".itemRow.selected:not(.itemRow.selected-remove)");0===h.length&&(h=angular.element(".itemRow.selected-add")),n=h.position().top,r=h.height()/2,i=m-r,l=f>c,i>n?(s="top",a=0):l&&n+i>f?(s="bot",a=f-c-8):(s="mid",a=n-m+r),g.css({marginTop:a}),angular.element("body","html").animate({scrollTop:a},200),e(o,0),t.isKeyboardInUse&&(u(),d().focus())},0)}g=f.find(".drawerContainer"),p=angular.element("ul.assignmentList");var v,S,T=function(){n.$emit("assignmentListByClass.drawer.close")},A=function(){m.find(":focusable").first().focus()};c(),n.resetDrawer=function(){T(),t.isKeyboardInUse&&A(),c(),l(),setTimeout(function(){g.css({marginTop:0})})},v=n.$watch("assignmentSelected",function(t){angular.isDefined(t)?(u(),e(h,200)):n.resetDrawer()}),S=n.$on("window.breakpoint.change",function(){r.breakpoint.isDesktop||(l(),v(),S())}),n.showScore=function(e){return!(e.contentItem.$isTest()||"ADAPTIVE"===e.type)&&e.studentsCompleted>=1},n.breadcrumbHandler=function(e,t,n){e.stopPropagation();var r=e.currentTarget.text,o={page:i.PAGE.ASSIGNMENT,subpage:i.SUBPAGE.ASSIGNMENTS_BY_CLASS_STATUS,area:i.AREA.CLASSES};a.sendTelemetryEvents(r,n,o),s.navigateToSourceProgram(t)},n.$on("$destroy",function(){l()})}}}]),angular.module("Realize.assignment.tabStudent",["Realize.assignment.facadeService","Realize.assignment.viewOptions","Realize.common.mediaQueryService","Realize.comment.commentsUtilService","Realize.assignment.constants","rlzComponents.assignmentTelemetryModule","rlzComponents.routedComponents.assignments.constants"]).directive("assignmentTabStudent",[function(){"use strict";return{scope:{assignments:"=?",status:"@",active:"@",total:"=",roster:"=",studentId:"=",studentName:"="},templateUrl:"templates/assignment/assignmentTabStudent.html",controller:["$log","$scope","$location","AssignmentFacadeService","AssignmentViewOptions","$rootScope","lwcI18nFilter","MediaQuery","$filter","$routeParams","OptionalFeatures","commentsUtilService","ASSIGNMENT_CONSTANTS","assignmentTelemetryService","ASSIGNMENT_TELEMETRY_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p){t.requestFilter=s.getStudentFilterByStatus(t.status),t.pageSize=t.requestFilter.pageSize,t.studentAssignmentIdsWithPosts={},t.isOtherCallLoading=!1,t.MAX_ADAPTIVE_SCORE=5,t.fetchCommentsForFirstTabTriggered=!1;var f={dueDate:m.DUE_DATE},h=!1,v=a.currentUser,S=function(e){return angular.isDefined(e)?e.lastModifiedDate>e.lastAccessDate:void 0},T=function(){u.isAvailable(m.OPTIONAL_FEATURES.COMMENTS)?d.getStudentAssignmentIdsWithPostsByClassId(c.classId).then(function(e){angular.extend(t.studentAssignmentIdsWithPosts,e),h=!0,a.pageLoaded()}).catch(function(){a.pageLoaded()}):a.pageLoaded()},A=function(){var e=t.status,n={sortField:t.requestFilter.sortField,sortOrder:t.requestFilter.sortOrder};e===m.STATUS.NOT_STARTED?v.setAttribute(m.ASSIGNMENT_STATUS.NOT_STARTED,n,!0):e===m.STATUS.IN_PROGRESS?v.setAttribute(m.ASSIGNMENT_STATUS.IN_PROGRESS,n,!0):e===m.STATUS.COMPLETED&&v.setAttribute(m.ASSIGNMENT_STATUS.COMPLETED,n,!0)},I=function(){var e;return e=t.requestFilter.sortField===m.DUE_DATE?i("assignmentList.columnHeader.dueDate.label"):p.EMPTY_STRING},E=function(){var e;return e=t.requestFilter.sortOrder===m.ASC?p.DESCRIPTION.ASC:p.DESCRIPTION.DESC},y=function(){var e,n=t.status;return n===m.STATUS.NOT_STARTED?e=p.STATUS.NOT_STARTED:n===m.STATUS.IN_PROGRESS?e=p.STATUS.IN_PROGRESS:n===m.STATUS.COMPLETED&&(e=p.STATUS.COMPLETED),e},R=function(){return t.loading=!0,t.requestFilter.includeLessonDetails=!1,T(),r.getStudentAssignmentsByStatus(t.roster.classId,t.studentId,t.status,t.requestFilter).then(function(e){t.assignments=e.assignments,r.getAssignmentsWithExternalProviderData(e),o.breakpoint.isDesktop||$("html, body").animate({scrollTop:0},0),t.isOtherCallLoading||(t.loading=!1)})},C={PLAYLIST:"PLAYLIST"};t.roleBasedMessages={not_started_zero:"assignmentListStudent.zeroState.noNotStarted.message",progress_zero:"assignmentListStudent.zeroState.noInProgress.message",completed_zero:"assignmentListStudent.zeroState.noCompleted.message"},t.pageStart=function(){return(t.requestFilter.page-1)*t.requestFilter.pageSize+1},t.pageEnd=function(){return t.requestFilter.page*t.requestFilter.pageSize<=t.total?t.requestFilter.page*t.requestFilter.pageSize:t.total},t.getOverrideMediaType=function(e){var t=e.type===C.PLAYLIST?C.PLAYLIST.toLowerCase():void 0;return t},t.assignmentSortByAscOrDescAria=function(){var e={ascending:"assignmentListStudent.columnHeader.sortedAscending",descending:"assignmentListStudent.columnHeader.sortedDescending"};return"ASC"===t.requestFilter.sortOrder?e.ascending:e.descending},t.showNewCommentNotification=function(e){var n,r=e.$findItemMetadata(e.itemUuid,t.studentId);return angular.isDefined(r)?(n=r.userAssignmentId,S(t.studentAssignmentIdsWithPosts[n])):!1},t.sortBy=function(e,n){e&&(e.stopPropagation(),e.preventDefault()),t.requestFilter.sortOrder=t.requestFilter.sortField!==f[n]?"ASC":"ASC"===t.requestFilter.sortOrder?"DESC":"ASC",t.requestFilter.page=1,t.requestFilter.sortField=f[n],A(),R(),g.sendAssignmentSortTelemetryEvent(I(),E(),p.EMPTY_STRING,y())},t.getSortSelectors=function(){var e=["sortBy"];return e.push(t.requestFilter.sortOrder===m.ASC?"icon-sort-down":"icon-sort-up"),e},t.open=function(e,t){if(e){if(e.stopPropagation(),e.target){if(e.target.hasAttribute("download"))return;if(e.target.href&&e.target.href.search("/download/")>=0)return}e.preventDefault()}var r=n.path();n.path(r+"/"+t.assignmentId)},t.justCompleted=function(e){return t.completedAssignmentId&&e.$getAssignmentStatus()===m.STATUS.COMPLETED&&e.assignmentId===t.completedAssignmentId},t.needScoreStudent=function(e){return e.hasManualScore&&(e.hasNotSentScore||e.hasNotScored)},t.showScore=function(e){var t=e.hasManualScore&&!e.hasNotSentScore&&!e.hasNotScored,n=!e.hasManualScore&&null!==e.averageScore;return(t||n)&&!e.isAdaptiveAssignment()&&!e.hasEssayScoring},t.showEssayScores=function(e){var t=e.studentMetadata[0],n=r.getEssayScore(t,e.maxScore);return[l("number")(n,0),e.maxScore].join("/")},t.showStar=function(e){var t=!e.hasManualScore&&null!==e.averageScore;return t&&e.isAdaptiveAssignment()},t.showDash=function(e){return!e.hasManualScore&&(_.isNull(e.averageScore)||_.isUndefined(e.averageScore))},t.getAdaptiveScore=function(e){return l("number")(e.averageScore,0)},t.$watch("requestFilter.pageSize",function(e){var n=Math.ceil(t.total/e);t.pages=_.range(1,n+1)}),t.$watch("requestFilter.page",function(e,t){t&&e!==t&&R()}),t.$watch("active",function(e){t.assignments||e!==t.status||R(),_.isEmpty(t.studentAssignmentIdsWithPosts)&&!t.fetchCommentsForFirstTabTriggered&&(t.fetchCommentsForFirstTabTriggered=!0,T())})}]}}]),angular.module("Realize.assignment.utilService",["Realize.assignment.facadeService","RealizeDataServices","Realize.common.optionalFeaturesService","Realize.user.currentUser","webStorageModule","rlzComponents.components.googleClassroom","rlzComponents.components.googleClassroom.constants","rlzComponents.components.dataViewerModal"]).service("AssignmentUtil",["$q","User","$location","OptionalFeatures","$currentUser","$filter","ProgramService","ASSIGNMENT_CONSTANTS","MEDIA_TYPE","webStorage","googleClassroomService","GOOGLE_CLASSROOM","GoogleClassroomConstants","lwcI18nFilter","Assessment","dataViewerModal",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f){"use strict";var h;this.getAssigneeIdsFromItemAssignedToCollection=function(e,t){var n,r=[],s=[],a=[];return angular.forEach(e,function(e){!e.classUuid||e.groupUuid||e.studentUuid||r.push(e.classUuid),e.groupUuid&&s.push(e.groupUuid),e.studentUuid&&a.push(e.studentUuid)}),r=_.uniq(r),angular.forEach(r,function(e){e===t&&(n=t)}),s=_.uniq(s),a=_.uniq(a),{classUuids:n,groupUuids:s,studentUuids:a}},this.getAssigneeList=function(e,n,r){var s,a=[];return e?(s=this.getAssigneesName(e.classUuids,e.groupUuids,e.studentUuids,n.students,n,r),s.missingStudentIds.length>0&&t.getUsersByIds(s.missingStudentIds).then(function(e){var t=_.filter(e,function(e){return null!==e});s.students=s.students.concat(_.pluck(t,"lastFirst")),s.students=_.sortBy(s.students,function(e){return e.toLowerCase()})}),a=a.concat(s.classes,s.groups,s.students),a.join(" | ")):void 0},this.getAssigneesName=function(e,t,n,r,s,a){var i=[],o=[],l=[],c=[];return e&&e.length>0&&i.push(s.className),t&&angular.forEach(t,function(e){var t=_.findWhere(a,{groupId:e});t&&o.push(t.groupName)}),n&&angular.forEach(n,function(e){var t=_.findWhere(s.students,{userId:e});if(t)l.push(t.lastFirst);else{var n=_.find(r,function(t){return angular.isDefined(t.studentInfo)&&t.studentInfo.userId===e});n&&n.studentInfo.lastFirst?l.push(n.studentInfo.lastFirst):c.push(e)}}),{classes:i,groups:_.sortBy(o,function(e){return e.toLowerCase()}),students:_.sortBy(l,function(e){return e.toLowerCase()}),missingStudentIds:c}},this.generateNotebookReviewLink=function(e,t,r){var a,i=n.path(),o="allstudents/"+t+"/review",l="allstudents";return s.isStudent?a=[i,o].join("/"):r?(i.indexOf("/gradeInput")>-1?n.search("gradeInput",!0):n.search("gradeInput",null),i=i.split(l)[0]+l,a=[i,t,"review"].join("/")):a=[i.substring(0,i.indexOf("/student")),"assignments",e.assignmentId,o].join("/"),a},this.isNotebookEnabled=function(e,t){var n=r.isAvailable("notebook.integration.enabled")&&e.includeRRSActivity&&this.isCompletedOrSubmitted(e);return t?n&&t.isRRS():n&&e.isRRS()},this.generateNotebookBackLink=function(e){var t,r,a=n.search()||{};return s.isStudent?(t=n.path().split("/allstudents")[0],n.search("status",a.status)):a.activeTab?t=[n.path().split("/assignments")[0],"student",e,"assignments"].join("/"):(r=a.gradeInput?"/gradeInput":"",t=n.path().split("/allstudents")[0]+"/allstudents"+r),t},this.generateRRSSCOReviewLink=function(e,t,r,a){var i,o=t.$findItemMetadata(e.id,r);if(s.isTeacher){var l=a?r:t.assignmentId;i=n.path()+"/"+l}else i=n.path();return[i,"RRSSCOReview",e.id,e.version,"userAssignmentId",o.userAssignmentId].join("/")},this.gotoRRSSCOReviewPage=function(e,t,r,s){var a=this.generateRRSSCOReviewLink(e,t,r,s);n.path(a)},this.gotoNotebookReviewPage=function(e,t,r,s){var a,i,o;r?(a=r.id,n.search("contentId",a)):a=e.contentItem.id,i=e.$findItemMetadata(a,t),o=this.generateNotebookReviewLink(e,i.userAssignmentId,s),n.path(o)},this.showRRSActivities=function(e,t){return e.includeRRSActivity&&t.isRRS()&&t.RRSActivities&&t.RRSActivities.length>0&&this.isCompletedOrSubmitted(e)},this.showRRSSCO=function(e,t,n){var r=e.$findItemMetadata(t.id,n);return!!r},this.showScoreForRRSSCO=function(e,t,n){var r=e.$findItemMetadata(t.id,n);return r&&r.userAssignmentDataList&&r.userAssignmentDataList.length>0},this.getScoreForRRSSCO=function(e,t,n){var r=e.$findItemMetadata(t.id,n),s=r.userAssignmentDataList[0];return a("number")(s.score,0)},this.isSubmitted=function(e){return e.isSubmitted()&&s.isStudent},this.isCompletedOrSubmitted=function(e){return s.isStudent?e.$isCompleted()||e.isSubmitted():s.isTeacher},this.getHours=function(){var e,t=[],n=function(e){return 12>e?"am":"pm"};for(e=0;24>e;e++){var r=e%12,s=0===r?"12":r,a=n(e);t.push(s+":00 "+a),t.push(s+":30 "+a)}return t.push(o.TIMES.MAX_TIME),t},this.sortByStudentName=function(e){return _.sortBy(e,function(e){return e.studentInfo.lastFirst.toLowerCase()})},this.navigateToSourceProgram=function(e){n.path(e)},this.getAssignmentWithProgramHierarchy=function(e){if(e.programHierarchy&&e.programHierarchy.length>0){var t=[];_.forEach(e.programHierarchy,function(e){if(e.containerMediaType!==l.LEARNING_MODEL){var n={id:e.parentItemUuid,title:e.containerTitle,url:e.path};t.push(n)}}),_.isEmpty(t)||(e.breadcrumb=t)}return e},this.setRemediationContainerDetails=function(e){h=e};var v=function(e,t){return i.get(e[2],e[3]).then(function(e){if(e){if(t[0].containerTitle=e.title,t.length>=2&&e.contentItems&&e.contentItems.length>=1){var n=_.find(e.contentItems,function(e){return e.id===t[1].parentItemUuid});n&&n.title&&(t[1].containerTitle=n.title)}return t.reverse()}return t.reverse()})},S=function(e,t){var n=Math.floor(e.length/3),r=-1!==e.indexOf(l.REMEDIATION.toLowerCase()),s=[],a=1,i=r?n+1:n;if(_.times(n,function(){var t={parentItemUuid:e[a+1],distanceFrom:i,root:i===(r?n+1:n)?!0:!1,containerMediaType:e[a]};s.push(t),a+=3,i-=1}),s=_.filter(s,function(e){return e.parentItemUuid!==t}),r){var o={parentItemUuid:h?h.id:"",distanceFrom:1,root:!1,containerMediaType:l.REMEDIATION,containerTitle:h?h.title:""};s.push(o)}return v(e,s)},T=function(e){for(var t=[],n=0;n<e.length&&!(t.length>0&&1===e[n].distanceFrom);n++)t.push(e[n]);return t};this.getProgramHierarchy=function(t,r){var s=n.path(),a=-1!==s.indexOf("/program"),i=-1!==s.indexOf("/myContent"),o=-1!==s.indexOf("/lesson"),l=-1!==s.indexOf("/resources"),u=-1!==s.indexOf("/standards"),d=-1!==s.indexOf("/leveledreaders"),m=-1!==s.indexOf("/search/lesson"),g=-1!==s.indexOf("/search/adaptivehomework"),p=-1!==s.indexOf("/search/discussionprompt"),f=-1!==s.indexOf("/remediation"),h=l||u||d,v=n.url().split("/");if(!a||i||h){if(a&&i&&!h)return v.pop(),S(v,r);var A,I=c.get("contentFromDetails"),E=l&&o,y=u&&o,R=d&&o,C=E||y||R;if((m||g||p||f||C)&&I)A=T(I);else{var D=t.fromDetails&&t.fromDetails.length>0;A=D?T(t.fromDetails):null}return e.resolve(A)}return S(v,r)},this.redirectToRealizeSyncWebApp=function(){var e={area:d.SETTINGS,page:d.ACCOUNT_LINKING,product:m.EVENT_TYPE.PROGRAM_NOT_AVAILABLE,name:d.CONNECT_CLASS,description:d.GOOGLE_CONNECT};u.redirectToRealizeSyncWebApp(n.absUrl(),m.LAUNCH,e)};var A=function(e){return e.some(function(e){return e.scoreSent})};this.setDataLinkDetails=function(e){var t=!1,n=[],r=[],s=!1;angular.forEach(e.studentMetadata,function(e){e.markCompleted&&A(e.userAssignmentDataList)&&("Sequence"===e.itemType&&-1===n.indexOf(e.studentUuid)?n.push(e.studentUuid):"TEST"===e.itemType&&-1===r.indexOf(e.studentUuid)&&r.push(e.studentUuid)),"Sequence"!==e.itemType||s||(s=!0)}),t=s?n.some(function(e){return r.indexOf(e)>-1}):r.length>0,e.showDataLink=t,e.isSequenceExist=s},this.showUnableToAccessExternalAccountError=function(){return{msg:g("googleClassroom.unableToAccess"),action:{actionId:"reconnectGoogleClassRoom",actionClass:"syncFailed__reconnectGoogleClassRoom",actionLabel:g("googleClassroom.reconnectYourGoogleClass"),onCustomAction:function(){this.redirectToRealizeSyncWebApp()}}}},this.showAssignmentSyncGenericExternalError=function(){return{msg:[g("googleClassroom.somethingWentWrong"),g("googleClassroom.unableToSync")].join(" ")}},this.showAssignmentCreateGenericExternalError=function(){return{msg:[g("googleClassroom.notSyncedWithGoogleClassroom"),g("googleClassroom.syncAssignment")].join(" ")}},this.showAssignmentCreateExternalError=function(){return{msg:g("googleClassroom.createAssignment.errorNotification.message")}},this.showAssignmentEditExternalError=function(){return{msg:g("googleClassroom.editAssignment.errorNotification.message")}};var I=function(e){return a("date")(e,"MM-DD-YYYY")},E=function(){return f.deactivate()},y=function(e){var t="assessmentLanding__page",n={label:g("global.modal.close.a11y"),action:function(){E()},className:"modal__close",disabled:!1},r=[n];f.activate({cssClass:t,heading:g("dataViewerModal.heading.message"),description:e,buttons:r,closeAction:function(){E()}})};this.generateAndRedirectToReportScreen=function(t,r,s,a){r=r?r:t.itemUuid,s=s?s:t.itemVersion;var i=e.defer();return p.getInfo(r,s).then(function(e){c.add(o.DEEP_LINKED_URL,n.path());var s=["data",n.path().split("/")[2],"overview","assignment",t.assignmentId,"recap",e.assessmentId,"itemUuid",r,"student",I(t.startDate),I(t.dueDate)].join("/");a?i.resolve(s):n.path(s)}).catch(function(e){return i.reject(e)}),i.promise};var R=function(e){var t,n;return angular.forEach(e.studentMetadata,function(e){"TEST"===e.itemType&&e.markCompleted&&angular.forEach(e.userAssignmentLanguageList,function(e){e.isSelected&&(t=e.itemUuid,n=e.itemVersion)})}),[t,n]},C=function(e){var t=[],n=!1;return angular.forEach(e.studentMetadata,function(e){"TEST"===e.itemType&&(-1===t.indexOf(e.studentUuid)?t.push(e.studentUuid):n=!0)}),n};this.redirectToReportScreen=function(e){if(e.isSequenceExist)if(C(e))y(e);else{var t=R(e);this.generateAndRedirectToReportScreen(e,t[0],t[1])}else this.generateAndRedirectToReportScreen(e)}}]),angular.module("Realize.assignment.viewOptions",["Realize.user.currentUser","Realize.common.DateRangeSelectorService","Realize.common.browserInfoService","Realize.assignment.constants"]).service("AssignmentViewOptions",["$log","$currentUser","DateRangeSelectorService","BrowserInfo","ASSIGNMENT_CONSTANTS",function(e,t,n,r,s){"use strict";var a=this,i={view:s.EVERYONE,graded:s.GRADE_TYPE.ALL},o={page:1,sortField:s.DUE_DATE,sortOrder:s.DESC,assignmentStatus:s.AVAILABLE,pageSize:r.isMobileDevice?s.PAGE_SIZE.MOBILE:s.PAGE_SIZE.DESKTOP},l=function(e,t){return t?e+".hidden":e},c=function(e,n,r,s){var a=t.getAttribute(n)||{};a[e]=r,t.setAttribute(n,a,s)};a.getDefaultFilter=function(e){var r=l(e,!1),a=t.getAttribute(s.FILTER_STATE_KEY)||{},c=t.getAttribute(s.SORT_STATE_KEY)||{},u=n.getSavedDateRange(t,s.CLASS_DATE_RANGE),d=t.getAttribute(s.ASSIGNMENT_BYCLASS_KEY)||{};return angular.extend({},i,a[e],o,c[r],d,{startDate:u.startDate,endDate:u.endDate,includeIfNoAssignees:!1})},a.getDefaultFilterForHidden=function(e){var n=l(e,!0),r=t.getAttribute(s.SORT_STATE_KEY)||{},a=t.getAttribute(s.ASSIGNMENT_BYCLASS_KEY)||{};return angular.extend({},o,r[n],a,{assignmentStatus:s.INACTIVE})},a.saveSortOptions=function(e,t,n){var r=l(e,n);c(r,s.SORT_STATE_KEY,{sortField:t.sortField,sortOrder:t.sortOrder,page:t.page},!1)},a.saveFilterOptions=function(e,t){c(e,s.FILTER_STATE_KEY,{view:t.view,graded:t.graded},!0)},a.getUpdatedFilter=function(e,n){var r=l(e,!1),a=t.getAttribute(s.SORT_STATE_KEY)||{},i=t.getAttribute(s.ASSIGNMENT_BYCLASS_KEY)||{};return angular.extend({},o,a[r],i,{assignmentStatus:s.AVAILABLE,includeIfNoAssignees:!1,startDate:n.dateRange.startDate,endDate:n.dateRange.endDate,view:n.viewing.toUpperCase(),graded:n.grade.toUpperCase()===s.NOTGRADED?s.NOT_GRADED:n.grade.toUpperCase()})},a.getDefaultStudentFilter=function(){return angular.extend({},o)},a.getStudentFilterByStatus=function(e){var n;return e===s.STATUS.NOT_STARTED?(n=t.getAttribute(s.ASSIGNMENT_STATUS.NOT_STARTED)||{},angular.extend({},o,{sortOrder:s.ASC},n)):e===s.STATUS.IN_PROGRESS?(n=t.getAttribute(s.ASSIGNMENT_STATUS.IN_PROGRESS)||{},angular.extend({},o,{sortOrder:s.ASC},n)):e===s.STATUS.COMPLETED?(n=t.getAttribute(s.ASSIGNMENT_STATUS.COMPLETED)||{},angular.extend({},o,n)):angular.extend({},o,n)}}]),angular.module("Realize.assignment.filters",["Realize.assignment.constants","rlzComponents.components.i18n","Realize.filters.ellipses","Realize.analytics","Realize.common.DateRangeSelectorService","Realize.common.mediaQueryService"]).directive("assignmentsFilters",["$log","$rootScope","$routeParams","ASSIGNMENT_CONSTANTS","Analytics","DateRangeSelectorService","MediaQuery",function(e,t,n,r,s,a,i){"use strict";var o=[{id:"next7Days",analyticLabel:"Next 7 days",label:"dateRangeSelector.filter.rangeOption.next7Days",order:1},{id:"next14Days",analyticLabel:"Next 14 days",label:"dateRangeSelector.filter.rangeOption.next14Days",order:2},{id:"next30Days",analyticLabel:"Next 30 days",label:"dateRangeSelector.filter.rangeOption.next30Days",order:3},{id:"last7Days",analyticLabel:"Last 7 days",label:"dateRangeSelector.filter.rangeOption.last7Days",order:4},{id:"last14Days",analyticLabel:"Last 14 days",label:"dateRangeSelector.filter.rangeOption.last14Days",order:5},{id:"last30Days",analyticLabel:"Last 30 days",label:"dateRangeSelector.filter.rangeOption.last30Days",order:6},{id:"customRange",analyticLabel:"Custom dates",label:"dateRangeSelector.filter.rangeOption.customRange",order:7},{id:"entireClassDuration",analyticLabel:"Entire class duration",label:"assignmentList.filters.when.entireClassDuration",order:8,"default":!0}];return{templateUrl:"templates/assignment/assignmentsFilters.html",scope:{assignmentData:"=",filters:"="},link:function(e){var l=n.classId,c=t.currentUser.getAttribute("assignments.class.filters"),u=angular.isDefined(c)?c[l]:void 0,d=!!u,m=function(){$("#ui-datepicker-div").addClass("assignmentsFilter")},g=function(){$("#ui-datepicker-div").removeClass("assignmentsFilter")},p=function(){var t={viewTypes:e.assignmentData.viewTypes};e.hiddenFilterOptions={view:{everyone:!1,wholeClass:!_.contains(t.viewTypes,r.ASSIGNEE_TYPE.CLASS),group:!_.contains(t.viewTypes,r.ASSIGNEE_TYPE.GROUP),individual:!0}}},f=function(){angular.extend(e.filters,{viewing:"everyone",grade:"all",dateRange:{id:null,startDate:null,endDate:null},show:"current"}),e.hiddenFilterOptions={view:{everyone:!1,group:!0,wholeClass:!0,individual:!0}},$(".dropdown.open").removeClass("open")},h=function(){e.$emit("assignment:searchFilterUpdated",e.filters)};if(f(),p(),e.customDateRangeOptions=o,e.userAttributeId="classDateRange",d){u&&(e.filters.viewing=u.view?u.view.toLowerCase():"everyone",e.filters.grade="all");var v=a.getSavedDateRange(t.currentUser,e.userAttributeId);e.filters.dateRange.startDate=v.startDate,e.filters.dateRange.endDate=v.endDate}e.dateRangeSelectorOption=function(e){e.$setBeforeShow(m),e.$setOnClose(g)},e.useShortLabels=!i.breakpoint.isDesktop,e.$watch("filters",function(n,r){if(n&&r!==n){var s=a.getSavedOption(t.currentUser,e.userAttributeId),i=angular.isUndefined(s)&&e.filters.viewing!==r.viewing,o=e.filters.dateRange.startDate&&e.filters.dateRange.endDate,l=!e.filters.dateRange.startDate&&!e.filters.dateRange.endDate&&"entireClassDuration"===s,c=e.filters.show!==r.show;(o||l||c||i)&&h()}},!0),e.$watch("assignmentData.viewTypes + assignmentData.gradeTypes",function(){p()}),e.$on("assignment:filter:viewHidden",function(){e.filters.show="hidden"}),e.$on("dateRangeSelector.selection.change",function(e,t){var n=t.analyticLabel;s.track("track.action",{category:"Classes",action:"Assignments",label:"When Filter - "+n})}),e.$on("window.breakpoint.change",function(){e.useShortLabels=!i.breakpoint.isDesktop})}}}]),angular.module("Realize.assignment.turnInAssignment",["Realize.assignment.facadeService","Realize.recommendation.facadeService"]).service("TurnInAssignmentService",["$q","$log","$rootScope","AssignmentFacadeService","RecommendationFacadeService",function(e,t,n,r,s){"use strict";var a=this,i=!1;a.markComplete=function(n){var s=n.$getPrimaryMetadata();return r.setCompleted(s.userAssignmentId,i,s.itemType).then(function(e){return t.log("Assignment was submitted successfully",e),a.checkAndMarkChildAdaptiveAssignment(n).catch(function(e){t.warn(e)})},function(n){return t.error("Failed to mark assignment as complete",n),e.reject()})},a.checkAndMarkChildAdaptiveAssignment=function(n){var r=n.$getChildAdaptiveUserAssignment();return r&&!r.markCompleted?s.submitAssignment(r.classUuid,r.assignmentId,r.userAssignmentId).then(function(e){t.log("Submitting child adaptive assignment for complete",e),a.assignmentMarkedCompleteFn(n)},function(e){t.error("Failed to mark adaptive assignment as complete",e)}):(a.assignmentMarkedCompleteFn(n),e.when())},a.assignmentMarkedCompleteFn=function(e){n.justCompletedAssignment=e.assignmentId}}]),angular.module("Realize.classLanding",["Realize.classLanding.teacherClassesCtrl","Realize.classLanding.studentClassesCtrl"]),angular.module("Realize.classRoster.classDataService",["RealizeDataServices","Realize.paths","Realize.constants.googleClassroom"]).service("ClassDataService",["$log","$q","$http","$rootScope","REST_PATH","ClassRoster",function(e,t,n,r,s,a){"use strict";var i=this;i.getClassesReportingData=function(e){var i=s+"/v2/classes/assignments/results",o=[],l=!1,c=!1,u={};return n.get(i,{params:{needLoginStats:!!e}}).then(function(t){return r.currentUser.$setInactiveRosterCount(t.data.inactiveCount||0),l=angular.isDefined(t.data.coTeachersByClass)&&!_.isEmpty(t.data.coTeachersByClass),l&&(u=t.data.coTeachersByClass),r.currentUser.setAttribute("hasCoTeachers",l,c),angular.forEach(t.data.rosters,function(e){var n=new a(e);n.reportingData=t.data.classActivityDataMap?t.data.classActivityDataMap[n.classId]||{}:{},n.$setSharedTeachers(u[n.classId]),o.push(n)}),e?{rosters:o,teacherStat:t.data.teacherLoginStatistics}:o},function(e){return t.reject(e)})}}]),angular.module("Realize.classRoster",["Realize.classRoster.classDataService","Realize.classRoster.classRosterTheme","Realize.earlyLearner.teacher"]),angular.module("RealizeDataServices").factory("ClassRoster",["$http","$log","MEDIA_PATH","REST_PATH","$q","$rootScope","$cacheFactory","RealizeHelpers","User","BrowserInfo","GOOGLE_CLASSROOM",function(e,t,n,r,s,a,i,o,l,c,u){"use strict";function d(e){if(angular.copy(e||{},this),this.classImageUrl){var t,n=this.classImageUrl.split("/"),r=n[n.length-1];_.findWhere(d.thumbnailBank,{image:r})?this.classImageUrl=d.thumbnailRoot+r.replace(".png",c.isHDDisplay?"@2x.png":".png"):(t=d.thumbnailBank[2],this.classImageUrl=d.thumbnailRoot+(c.isHDDisplay?t.retina:t.image))}}var m=i("ClassRosterCache"),g=[],p=function(e){if(angular.isString(e))return r+"/class_roster/"+e;if(!angular.isObject(e))return t.error("query must be an object!",e),void 0;if(e.id||e.classId){var n=e.id||e.classId;return r+"/class_roster/"+n}return e.studentId?r+"/class_roster/get_class_rosters_by_student":o.buildUrl(r+"/class_roster",e)},f=function(e,t){m.put(e,t),g.push(e),g=_.uniq(g)
};d.clearRostersWithStudentDetailsFromCache=function(){var e=[];angular.forEach(g,function(t){var n=m.get(t);n&&angular.isDefined(n.students)&&e.push(t)}),angular.forEach(e,function(e){m.remove(e)}),g=_.difference(g,e)},d.prototype.$clearCache=function(){var e=this;m.remove(p(e.classId));var t=[];angular.forEach(g,function(e){e.indexOf("?")>=0&&t.push(e)}),angular.forEach(t,function(e){m.remove(e)}),t.push(p(e.classId)),g=_.difference(g,t)},d.prototype.$updateCache=function(){var e=p(this.classId);this.$clearCache(),f(e,this)},d.get=function(n){n&&n.assignmentApiV2&&delete n.assignmentApiV2,angular.isString(n)&&(n={id:n}),angular.isObject(n)||(n={});var i=r+"/class_roster",o=s.defer(),c=!1,u=!1,g=p(n);if(n.noCachedData!==!0&&m.get(g))t.debug("using cache:",g,m.get(g)),o.resolve(m.get(g));else{if(n.studentId&&(i=r+"/class_roster/get_class_rosters_by_student",u=!0),n.id||n.classId){var h=n.id||n.classId;i=r+"/class_roster/"+h,c=!0}e.get(i,{cache:!1,params:c||u||$.isEmptyObject(n)?null:n}).then(function(e){var t;c?(t=new d(e.data.roster),t.students=[],e.data.studentUsers?angular.forEach(e.data.studentUsers.users,function(e){var n=new l(angular.extend(e.rumbaUser,{userAttributes:e.attributes}));t.students.push(n)}):t.students=[]):u?(t=[],angular.forEach(e.data,function(e){var n=new d(e);n.reportingData={},t.push(n)})):(t=[],a.currentUser.$setInactiveRosterCount(e.data.inactiveCount||0),angular.forEach(e.data.rosters,function(n){var r=new d(n);r.reportingData=e.data.classActivityDataMap?e.data.classActivityDataMap[r.classId]||{}:{},t.push(r)})),f(g,t),o.resolve(t)},function(e){o.reject(e)})}return o.promise},d.getClassesWithMetadata=function(t){var n=s.defer();return a.assigneesData&&!a.dirtyAssigneesData?n.resolve(a.assigneesData):e.get(r+"/user/classmetadata?excludeClassDetails="+(t?!0:!1)).then(function(e){var r=e.data,s={classRosters:[],groups:[],students:[]};t&&n.resolve(r),angular.forEach(r.classRosters,function(e){s.classRosters.push(new d(e))}),angular.forEach(r.groups,function(e){s.groups.push(e)}),angular.forEach(r.students,function(e){s.students.push(e)}),a.assigneesData=s,n.resolve(a.assigneesData)},function(e){return s.reject("Error getting group and student data",e)}),n.promise},d.deleteAll=function(t,n){return e["delete"](r+"/class_roster").then(function(e){return a.dirtyAssigneesData=!0,e.data},function(e){return s.reject(e)}).then(t,n)},d.getActivity=function(t){var n,a;return angular.isArray(t)?(a=r+"/class_roster/activity",n=e.get(a,{params:{classIds:t}})):(a=r+"/class_roster/"+t+"/activity",n=e.get(a)),n.then(function(e){return e.data},function(e){return s.reject(e)})},d.getAssignmentActivity=function(t,n,s){var a,i;return angular.isArray(t)?(i=r+"/class_roster/activity/assignment",a=e.get(i,{params:{classIds:t}})):(i=r+"/class_roster/"+t+"/activity/assignment",a=e.get(i)),angular.isDefined(n)&&angular.isFunction(n)&&a.success(n),angular.isDefined(s)&&angular.isFunction(s)&&a.error(s),a},d.thumbnailRoot=n+"/skins/default/images/class_roster_icons/",d.thumbnailBank=[];var h;for(h=1;15>h;h++){var v={caption:"Class Image "+h,image:"class"+h+".png",retina:"class"+h+"@2x.png"};d.thumbnailBank.push(v)}return d.prototype.$hasProductId=function(e){var t=this;return $.Enumerable.From(t.productIds).IndexOf(e)>=0},d.prototype.$save=function(n,i){var o=r+"/class_roster",l=this;return _.isString(l.classId)&&!_.isEmpty(l.classId.trim())&&(o+="/"+l.classId),angular.isArray(l.productIds)&&(l.productIds=$.Enumerable.From(l.productIds).Where(function(e){return angular.isDefined(e)&&null!==e&&e.length>0}).ToArray()),e.post(o,l).then(function(e){if(t.log("class roster $save success",e.data),l.classId=e.data.classId,a.dirtyAssigneesData=!0,l.updateTheme){d.clearRostersWithStudentDetailsFromCache();var n=!1;angular.forEach(l.students,function(e){e.setAttribute("profile.learningExperience",l.learningExperience,n)})}return l.$updateCache(),l},function(e){return s.reject(e)}).then(n,i)},d.prototype.$delete=function(t,n){var i=this,o=r+"/class_roster/"+i.classId;return e["delete"](o).then(function(){return a.dirtyAssigneesData=!0,i.$clearCache(),i},function(e){return s.reject(e)}).then(t,n)},d.prototype.$hide=function(n,i){var o=this,l=r+"/class_roster/"+o.classId+"/status";return e.post(l,{status:"Inactive"}).then(function(){return o.status="INACTIVE",t.debug(o),a.currentUser.removeClassWithoutPrograms(o.classId),a.dirtyAssigneesData=!0,o},function(e){return s.reject(e)}).then(n,i)},d.prototype.$unhide=function(n,i){var o=this,l=r+"/class_roster/"+o.classId+"/status";return e.post(l,{status:"Active"}).then(function(){return o.status="ACTIVE",t.debug(o),o.productIds&&o.productIds.length||a.currentUser.addClassWithoutPrograms(o.classId),a.dirtyAssigneesData=!0,o},function(e){return s.reject(e)}).then(n,i)},d.prototype.$addStudents=function(n,s,i){var o=this,l=r+"/class_roster/"+o.classId+"/students",c={studentIds:angular.isArray(n)?n.length?n:"":[n]};t.log("addStudents",o,c),d.clearRostersWithStudentDetailsFromCache();var u=e.post(l,c);return a.dirtyAssigneesData=!0,angular.isDefined(s)&&angular.isFunction(s)&&u.success(s),angular.isDefined(i)&&angular.isFunction(i)&&u.error(i),u},d.prototype.$removeStudents=function(t,n,s){var i=this,o=r+"/class_roster/"+i.classId+"/students",l={studentIds:angular.isArray(t)?t.length?t:"":[t]},c=e["delete"](o,{params:l});return a.dirtyAssigneesData=!0,angular.isDefined(n)&&angular.isFunction(n)&&c.success(n),angular.isDefined(s)&&angular.isFunction(s)&&c.error(s),c},d.prototype.$hasCoTeachers=function(){var e=this;return e.teacherIds&&e.teacherIds.length>1},d.prototype.$setSharedTeachers=function(e){this.sharedTeachers=e||[]},d.prototype.$getSharedTeachers=function(){return this.sharedTeachers},d.prototype.isGoogleClass=function(){return this.rosterSource===u.ROSTER_SOURCE.GOOGLE_CLASSROOM},d}]),angular.module("RealizeApp").directive("classRosterDetails",["$log","User","$rootScope",function(e,t,n){"use strict";return{restrict:"EA",replace:!0,scope:{classReference:"=",affiliations:"=?",thumbnails:"=",showErrors:"="},templateUrl:"templates/partials/classRosterDetails.html",link:function(e){e.getMessage=n.getMessage,e.classReference.detailsForm=e.detailsForm;var t=function(t){e.classReference.classImageUrl=t.url,e.selectedThumb=t};e.userChooseThumb=function(n){e.detailsForm.$setDirty(),t(n)},e.chooseInstitution=function(t){e.detailsForm.$setDirty(),e.classReference.orgIndex=t},t(e.thumbnails[0])}}}]),angular.module("RealizeApp").directive("classRosterPrograms",["$log","User","$rootScope",function(e,t,n){"use strict";return{restrict:"EA",replace:!0,scope:{classReference:"=classReference",affiliations:"=",programLimit:"="},templateUrl:"templates/classRoster/classRosterPrograms.dir.html",controller:["$scope",function(t){t.getMessage=n.getMessage,t.programList=[],t.programLimit=t.programLimit||8;var r=function(){t.subscribedPrograms=_.where(t.programList,{subscribed:!0})},s=function(e){t.programList=t.affiliations[e].products,t.classReference.organizationId=t.affiliations[e].organizationId,angular.forEach(t.programList,function(e){e.checked=t.classReference.$hasProductId(e.productId)}),r()};t.setProductId=function(n){e.log("setProductId",n,t.classReference.productIds),t.classReference.$hasProductId(n)?t.classReference.productIds=$.Enumerable.From(t.classReference.productIds).Where("$ != '"+n+"'").ToArray():(t.classReference.productIds.push(n),t.$emit("class-roster-programs.productAdded",t.classReference)),t.productCount=t.classReference.productIds.length,t.$emit("class-roster-programs.productIdsChanged",t.classReference)},t.$watch("classReference.orgIndex",function(e){angular.isDefined(e)&&s(e)}),s(t.classReference.orgIndex)}]}}]),angular.module("Realize.classRoster.classRosterTheme",["Realize.paths","Realize.classRosterThemes.constants"]).directive("classRosterTheme",["PATH","CLASS_ROSTER_THEMES",function(e,t){"use strict";return{scope:{classReference:"=",form:"="},controller:function(){this.themes=t,this.setSelectedTheme=function(e){this.classReference.learningExperience=e,this.form.$setDirty()}},bindToController:!0,controllerAs:"classRosterThemeCtrl",templateUrl:e.TEMPLATE_ROOT+"/classRoster/classRosterTheme.dir.html"}}]),angular.module("RealizeApp").controller("ClassWizCtrl",["$q","$scope","ClassRoster","User","$log","$window","$debounce","Modal","$timeout","$rootScope","$location","AlertService","UnsavedChangesModal","lwcI18nFilter","MediaQuery","Analytics",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f){"use strict";var h=function(e,t,n){for(;0>t;)t+=e.length;for(;0>n;)n+=e.length;if(n>=e.length)for(var r=n-e.length;r--+1;)e.push(void 0);return e.splice(n,0,e.splice(t,1)[0]),e};t.showStudentTips=!0,t.isDemoUser=c.currentUser.getAttribute("isSelfRegUser"),t.activeClass=0,t.isCheckForUnsavedChanges=!0,t.globalClassSettings={hidePassword:!1,programLimit:8,isAttemptSave:!1},t.classes=[],t.progressPercent=0,t.rosterThumbs=$.Enumerable.From(n.thumbnailBank).Select("a => {caption: a.caption, image: a.image, url: '"+n.thumbnailRoot+"' + a.image}").ToArray(),t.numRows=1;var v=!1,S=function(){t.maxVisible=p.breakpoint.isDesktop?4:3},T=function(e){var t;for(t in e)e.hasOwnProperty(t)&&"$"!==t[0]&&e[t].$pristine&&e[t].$setViewValue(e[t].$modelValue)},A=function(e,s){var a,i=t.currentUser.oleAffiliations[e].organizationId,o=new n({detailsValid:!1,orgIndex:e,organizationId:i,productIds:[],students:[],learningExperience:"Standard"});for(a=0;s>a;a++)o.students.push(new r({organizationId:i}));return o},I=function(){t.rosterCompleteSuccess=!1,t.rosterUpdateSuccess=!1,t.rosterError=!1,t.rosterIncompleteError=!1;var e=A(0,10);t.classes.push(e),t.selectTab(null,t.classes.length-1),t.globalClassSettings.isAttemptSave=!1},E=function(){return t.classes[t.activeClass]||[]};t.selectTab=function(e,n){e&&(e.preventDefault(),e.stopPropagation()),n>t.maxVisible-1?(h(t.classes,n,t.maxVisible-1),t.activeClass=t.maxVisible-1):t.activeClass=n},t.setProgress=function(e){t.progressPercent=e},t.newStudentsErrors=function(e){var t=[],n=!1;return $.each(e,function(e,r){if(""!==r.userName){if(_.contains(t,r.userName))return n="usernameDup";t.push(r.userName)}}),n},t.isCurrentClassDetailsInvalid=function(){var e=E();return e&&e.detailsForm?e.detailsForm.$invalid:!1},t.isCurrentClassDetailsDirty=function(){var e=E();return e&&e.detailsForm?e.detailsForm.$dirty:!1},t.isCurrentClassDetailsPristine=function(){var e=E();return e&&e.detailsForm?e.detailsForm.$pristine:!1},t.isCurrentClassStudentsDirty=function(){var e=!1;return _.each(t.classes,function(t){_.each(t.students,function(t){t.$form.$dirty&&(e=!0)})}),e};var y=function(e){return e.firstName&&e.lastName&&e.userName&&e.password},R="createClass.successNotification.classCreated.",C="<strong>"+g(R+"title")+"</strong> "+g(R+"message"),D="<strong>"+g(R+"demoUser.Message.success")+"</strong>"+g(R+"demoUser.Message.messageBody1")+"<strong>"+g(R+"demoUser.Message.studentAndGroups")+"</strong>"+g(R+"demoUser.Message.messageBody2");t.saveSuccess=function(){var e=_.filter(t.classes[0].students,function(e){return e.fullName.length>1}).length,n=t.isDemoUser&&e>0?D:C;d.addAlert("success","ok-sign",n),t.isCheckForUnsavedChanges=!1,v||u.path("/classes")},t.saveRoster=function(){t.globalClassSettings.isAttemptSave=!0,t.rosterCompleteSuccess=!1,t.rosterUpdateSuccess=!1,t.rosterError=!1,t.rosterIncompleteError=!1,t.pageLoaded();var n=E();if(f.track("track.action",{category:"Classes",action:"Choose Theme",label:n.learningExperience}),t.isCurrentClassDetailsInvalid())return E().className||l(function(){$("html, body").animate({scrollTop:0},"fast")},300),e.reject("form is invalid!");if(E().productIds.length<1)return t.programError=!0,e.reject("form is invalid!");var r=_.filter(n.students,function(e){var t="password not shown"===e.password;return e.$form&&e.$form.$dirty&&Object.keys(e.$form.$error).length>0&&!t});if(r.length>0)return angular.forEach(r,function(e){T(e.$form)}),t.rosterIncompleteError=!0,e.reject("form is invalid!");var a=_.filter(n.students,function(e){var t="password not shown"===e.password,n=e.$form&&e.$form.$dirty&&e.$form.$valid;return(n||t)&&!e.addedToRoster}),i=!!(n.classId&&n.classId.length>0);t.setProgress(0),t.saveIncrement=100/(a.length+1);var c={updatingTitle:g("createClass.updatingProgress.title"),savingTitle:g("createClass.savingProgress.title"),updatingMsg:g("createClass.updatingProgress.message"),savingMsg:g("createClass.savingProgress.message")},u=o.progressDialog(t.$new(),{progressHeader:i?c.updatingTitle:c.savingTitle,progressMessage:i?c.updatingMsg:c.savingMsg}).then(function(){0===a.length&&u.fakeProgress()});$.each(n.productIds,function(e,t){t||n.productIds.splice(e,1)});var d=function(e){i?t.rosterUpdateSuccess=!0:t.rosterCompleteSuccess=!0,u.progressComplete().then(function(){l(function(){o.hideDialog()},500).finally(function(){l(function(){t.saveSuccess()},800).finally(function(){e.resolve(!0)})})})},m=e.defer();return n.$save(function(){t.currentUser.getAttribute("classes.created")||t.currentUser.setAttribute("classes.created",!0);var e=t.currentUser.getAttribute("classes.withoutPrograms")||[];0===n.productIds.length?_.contains(e,n.classId)||e.push(n.classId):e=_.without(e,n.classId),t.currentUser.setAttribute("classes.withoutPrograms",e),a.length>0?t.addStudentsToRoster(a,n).then(function(){d(m)},function(e){t.rosterError=!0,u.then(function(){l(function(){o.hideDialog(),m.reject(e)},500)})}):d(m)},function(e){l(function(){o.hideDialog()},1e3),s.error("class roster save error:",e),m.reject(e)}),m.promise},t.addRoster=function(e){if(e.preventDefault(),e.stopPropagation(),100===t.progressPercent)t.setProgress(0),I();else if(t.isCurrentClassDetailsPristine())s.warn("addRoster, form invalid, cannot add (not dirty)",t.createClassForm);else{var n=t.$new();n.delegate={close:function(){o.hideDialog()},discard:function(){o.hideDialog(),I()},save:function(){o.hideDialog(),angular.isDefined(E().classId)?I():t.saveRoster().then(I)}},o.showDialog("templates/partials/unsaved_edit_dialog.html",n)}},t.addStudentRows=function(e,n){var s,a=t.isDemoUser?g("demo.autoGenerate.username.placeHolder"):"",i=E();for(s=0;n>s;s++)i.students.push(new r({organizationId:i.organizationId,userName:a}))},t.addStudentsToRoster=function(n,r){var s=e.defer(),a=e.defer(),i=[],o=!1,l=0,c=[],u=function(e){angular.forEach(e,function(e){angular.forEach(r.students,function(t){t.userId===e&&(t.addedToRoster=!0,t.disableEdits=!0)})})};return angular.forEach(n,function(e){y(e)&&(e.userId?(t.setProgress(Math.floor(t.progressPercent+t.saveIncrement)),i.push(e.userId)):(c.push(e),++l))}),angular.forEach(c,function(e){e.serverErrors=[],e.$create().success(function(){i.push(e.userId)}).error(function(t){o=!0,t.data&&($.extend(e,t.data),i.push(e.userId));var n={ULC0003W:g("global.studentUser.error.rumbaUserExists")};e.serverErrors.push({code:t.errorCode,message:t.errorMessage,uimessage:n[t.errorCode]||t.errorMessage})}).finally(function(){t.setProgress(Math.floor(t.progressPercent+t.saveIncrement)),l--,0>=l&&a.resolve(!0)})}),a.promise.then(function(){r.$addStudents(i).then(function(){o?s.reject(i):(u(i),s.resolve(i)),t.setProgress(100)},function(e){s.reject(e),t.setProgress(100)})}),0>=l&&a.resolve(!0),s.promise},t.$on("window.breakpoint.change",function(){S(),t.selectTab(null,t.activeClass)}),t.$on("class-roster-programs.productIdsChanged",function(e,n){t.programError=!1,n.detailsForm.$setDirty()});var b=new m(function(){return v=!0,t.saveRoster()}),P=c.$on("$locationChangeStart",function(e){var n=function(){angular.forEach(t.classes,function(e){e.$clearCache()}),t.classes=[]};t.isCheckForUnsavedChanges&&(t.isCurrentClassStudentsDirty()||t.isCurrentClassDetailsDirty()&&100!==t.progressPercent)?b.showDialog(e).then(function(){t.isCheckForUnsavedChanges=!1,n(),t.wizardDirty=!1},function(){c.viewLoading=!1}):n()});t.$on("$destroy",function(){P()}),t.closeFirstVisitInfo=function(){t.currentUser.setAttribute("classes.info.seen",!0,!0)};var w=function(){c.pageLoading(),l(function(){S(),t.classes.push(),I(),c.pageLoaded()},10)};w()}]),angular.module("RealizeApp").directive("crStudentGrid",["$log","ClassRoster","Messages","User","$debounce","FormService","KEY_CODES","$timeout","$rootScope","$filter","$document",function(e,t,n,r,s,a,i,o,l,c,u){"use strict";return{restrict:"A",replace:!0,scope:{students:"=",orgId:"=",addStudentForm:"=",hidePassword:"="},templateUrl:"templates/partials/studentGrid.html",controller:["$scope",function(t){function d(){var e=p.split(","),n=e[1],r=n&&$.trim(n).length>0?$.trim(n):void 0,s=e[0],a=s&&$.trim(s).length>0?$.trim(s):void 0;return g(r,a,t.orgId)}var m=function(e,t){"$"===t[0]||e[t].$pristine||e[t].$setViewValue(e[t].$modelValue)};t.validUsername=/^[^,\s]+$/,t.isDemoUser=l.currentUser.getAttribute("isSelfRegUser"),t.$watch("orgId",function(e){e&&_.each(t.students,function(n){_.isEmpty(n)||(n.organizationId=e,t.isDemoUser&&(n.userName=c("lwcI18n")("demo.autoGenerate.username.placeHolder")))})}),t.typeaheadOnSelect=function(n,r){e.log("selected: ",n,r);var s=t.students[r];angular.isString(n)&&s.$setLastFirst(n),angular.isObject(n)&&(s.$setLastFirst(n.lastFirst),s.userName=n.userName,s.userId=n.userId,s.disableEdits=!0,s.password="password not shown",a.forceValidPassword(s.$form)),t.currentFocusedElement=$(":focus")},t.getMessage=n.getMessage;var g=function(n,s){return r.query({firstname:n,lastname:s,organization:t.orgId},!0).then(function(e){var n=t.students;return n?(n=_.filter(n,function(e){return angular.isObject(e)}),_.reject(e,function(e){return angular.isDefined(_.findWhere(n,{userName:e.userName}))})):e},function(t){return e.error("error in student query: ",t),[]})},p="";t.findStudents=function(e){return e&&e.length<3?void 0:(p=e,s(d,100))},t.matchTmplUrl="templates/partials/student_grid_typeaheadMatch.html",t.isNextRowAvailable=function(e){return $(e.target).closest("tbody").next().length>0},t.removeStudentRow=function(n,r){t.nextFocusedElement=t.isNextRowAvailable(n)?$(n.target).closest("tbody").next().find(":focusable").first():$(n.target).closest(".students").parent().next().find(":focusable").first();var s=t.students.splice(r,1);e.log("Removed 1 student from the table!",s)},t.studentNameUpdated=function(e){e.$setLastFirst(e.$form.studentName.$viewValue),m(e.$form,"password")},t.getNextRemoveButton=function(){return $(t.currentFocusedElement).parent().nextAll(".remove").find("a:first")};var f=function(e){t.currentFocusedElement&&e.keyCode===i.TAB?o(function(){t.getNextRemoveButton().focus(),t.currentFocusedElement=void 0},0):t.nextFocusedElement&&e.keyCode===i.TAB&&o(function(){$(t.nextFocusedElement).focus(),t.nextFocusedElement=void 0},0)};u.on("keydown",f),t.$on("$destroy",function(){t.currentFocusedElement=null,t.nextFocusedElement=null,u.off("keydown",f)})}]}}]),angular.module("RealizeApp").directive("crUnique",["$log",function(e){"use strict";return{require:"ngModel",link:function(t,n,r,s){s.$parsers.unshift(function(n){if(n){var a,i=t.$eval(r.crUnique),o=r.crUniqueField;a=o?_.find(i,function(e){return e[o]===n}):_.contains(i,n),a&&e.log("crUnique duplicate found!",a),s.$setValidity("unique",!a)}return n})}}}]),angular.module("Realize.common.tokenInterceptor",[]).provider("CommonTokenInterceptor",function(){"use strict";function e(e,t){return t.headers=t.headers||{},t.headers=angular.extend(t.headers,{Authorization:e}),t}var t=[];this.registerTokenProvider=function(e){t.push(e)},this.$get=["$injector","$log","$q",function(n,r,s){return{updateHeaderAndReturn:e,request:function(a){var i;return t.forEach(function(e){try{var t=n.get(e);angular.isFunction(t.shouldIntercept)&&angular.isFunction(t.getToken)?t.shouldIntercept(a)&&(i=t):r.log("The provider "+e+"does not have a appropriate api\n","Methods required :  shouldIntercept and getToken")}catch(s){r.log("Failed to get provider :",e,s.getMessage())}}),angular.isDefined(i)?i.getToken().then(function(t){return e(t,a)},function(e){return s.reject(e)}):a}}}]}),angular.module("Realize.common.tokenRecovery",[]).provider("CommonTokenRecovery",function(){"use strict";var e,t=[];this.registerTokenProvider=function(e){t.push(e)},this.setSessionTimeoutServiceProvider=function(t){e=t},this.$get=["$injector","$log",function(n,r){return function(s){var a,i=n.get("$http");return t.forEach(function(e){try{var t=n.get(e);angular.isFunction(t.shouldIntercept)&&angular.isFunction(t.recoverToken)?t.shouldIntercept(s.config)&&(a=t):r.log("The provider "+e+"does not have a appropriate api\n","Methods required :  shouldIntercept and recoverToken")}catch(i){r.log("Failed to get provider :",e,i.getMessage())}}),angular.isDefined(a)?s.config.headers.authorizationretry===!0?e.breakOutOfChain(s):a.recoverToken(s.config).then(function(){return s.config.headers=s.config.headers||{},s.config.headers=angular.extend(s.config.headers,{authorizationretry:!0}),i(s.config).then(e.breakOutOfChain,e.breakOutOfChain)},e.breakOutOfChain):s}}]}),angular.module("Realize.common.fitToContentDirective",[]).directive("fitToContent",[function(){"use strict";return{restrict:"A",link:function(e,t){t.on("load",function(){var e=t[0].contentWindow.document.body.scrollHeight+"px";t.css("height",e)})}}}]),function(){"use strict";angular.module("Realize.common.handlePostMessage",[]).factory("sendPostMessage",["$window",function(e){function t(t,n,r){n=n||e,r=r||"*","string"==typeof t&&(t=angular.toJson(t)),n.postMessage(t,r)}return t}]).run(["$window","$log","$rootScope",function(e,t,n){angular.element(e).on("message",function(e){var r;if(e=e.originalEvent||e,e&&e.data){try{r=angular.fromJson(e.data)}catch(s){t.warn("Error parsing message as JSON, likely it's text.",s,e.data),r=e.data}n.$broadcast("postMessageEvent",{origin:e.origin,source:e.source,data:r})}})}])}(),angular.module("Realize.common.helpers",[]).service("RealizeHelpers",["$window","$log",function(e,t){"use strict";var n=this;n.sortedKeys=function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);return n.sort()},n.forEachSorted=function(e,t,r){var s,a=n.sortedKeys(e);for(s=0;s<a.length;s++)t.call(r,e[a[s]],a[s]);return a},n.encodeUriQuery=function(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")},n.buildUrl=function(e,t){if(!t)return e;var r=[];return n.forEachSorted(t,function(e,t){null!==e&&void 0!==e&&(angular.isArray(e)||(e=[e]),angular.forEach(e,function(e){angular.isObject(e)&&(e=angular.toJson(e)),r.push(n.encodeUriQuery(t)+"="+n.encodeUriQuery(e))}))}),e+(-1===e.indexOf("?")?"?":"&")+r.join("&")},n.killEvent=function(e){e&&(e.stopPropagation(),e.preventDefault())},n.getParentScope=function(e,t){return e.hasOwnProperty(t)?e:e.$parent?n.getParentScope(e.$parent,t):void 0},n.updateParentScopeValue=function(e,t,r){var s=n.getParentScope(e,t);s?s[t]=r:e[t]=r},n.convertFacetsToParams=function(e){var t={};return angular.forEach(e,function(e,n){angular.forEach(e,function(e){angular.isUndefined(t[n])?t[n]=[e.value]:$.inArray(e.value,t[n])<0&&(t[n]=t[n].concat(e.value))})}),t},n.isElementScrolledToBottom=function(e,t){return t=t||0,e[0].scrollHeight-e.scrollTop()<e.outerHeight()+t},n.isNullOrUndefined=function(e){return angular.isUndefined(e)||null===e},n.removeIllegalXmlCharacters=function(e){var t=/[^\u0009\u000A\u000D\u0020-\uD7FF\uE000-\uFFFD]/g,n=/[^\uD800-\uDBFF][\uDC00-\uDFFF]/g;return e=e.replace(t,"").replace(n,"")},n.reloadWindow=function(){t.debug("reloading window!!!"),e.location.reload()}}]),angular.module("Realize.common.keyStore",[]).factory("KeyStore",function(){"use strict";function e(){var e={};this.add=this.set=function(t,n){e[t]=n},this.get=function(t){return e[t]},this.remove=function(t){delete e[t]},this.empty=function(){e={}}}return e}),angular.module("Realize.common.optionalFeaturesService",[]).provider("OptionalFeatures",function(){"use strict";var e={};this.setServicesState=function(t){e=t},this.updateServicesState=function(t,n){e&&(e[t]=n)},this.$get=function(){var t=this;return t.isAvailable=function(t){return"true"===e[t]},t}}),angular.module("RealizeApp").filter("sidebarEllipses",["$rootScope","$filter","TOC_TITLE_LIMITS","BrowserInfo","MediaQuery",function(e,t,n,r,s){"use strict";return function(e,a){var i=r.isMobileDevice&&!s.breakpoint.isDesktop?n.MOBILE_IMODE_SIDEBAR_LIMIT:n.DEFAULT_SIDEBAR_LIMIT,o=r.isMobileDevice&&!s.breakpoint.isDesktop?n.MOBILE_IMODE_LIMIT:n.DEFAULT_LIMIT;return t("ellipses")(e,a?i:o)}}]),angular.module("RealizeApp").filter("videoSanitize",["RealizeHelpers","BrowserInfo",function(e,t){"use strict";var n=0,r=function(){return n++,(new Date).getTime()+"-"+n},s=function(){var e=9===t.browser.msieVersion,n=t.browser.isChrome;return e||n};return function(t){return s()?e.buildUrl(t,{media_guid:r()}):t}}]),angular.module("Realize.content.constants",[]).constant("CONTENT_CONSTANTS",{FACET:{PLAYER_TARGET:"PLAYER_TARGET"},MEDIA_TYPE:{QUESTION_BANK:"Question Bank",ADAPTIVE:"ADAPTIVE",ADAPTIVE_HOMEWORK:"Adaptive Homework",RRSSCO:"RRSSCO",DISCUSSION_PROMPT:"Discussion Prompt",GOOGLE_DOC:"Google Doc"},FILE_TYPE:{SCO:"SCO",TIN_CAN_SCO:"TinCanSCO",URL:"URL",PDF:"PDF",GOORU:"GOORU",OPEN_ED:"OPENED",TEST:"TEST",SEQUENCE:"Sequence"},ITEM_TYPE:{RRSSCO:"RRSSCO"},PLAYER_TARGET:{MATHXL:"mathxl",REALIZE:"realize",TESTNAV:"testnav"},QUESTION_BANK_TYPE:{TEST:"Test"},STAR_POPOVER_TYPE:{FIRST_CORRECT_ANSWER:"firstCorrectAnswer",FIRST_STAR_GAINED:"firstStarGained",FIRST_STAR_LOST:"firstStarLost"},CONTENT_VIEWER_ACTIVITY:{STARTS:"starts",STOPS:"stops"},SEARCH_RESULT_PAGE_SIZE:10,FIXED_VALUE_MAX_QUESTIONS:15,FIXED_VALUE_MAX_SCORE:5,MAX_ASSESSMENT_CUSTOMISE_VERSIONS:5}),angular.module("Realize.content.contentController",["Realize.content.contentViewerService","Realize.assignment.facadeService","Realize.reporting.data.TrackingService","Realize.recommendation.facadeService","Realize.user.currentUser","Realize.navigationService","Realize.tinCanConfigService","lst.rating.ui.component","Realize.common.gradedStarDirective","Realize.constants.mediaType","Realize.content.viewProgress","Realize.paths","Realize.content.constants","angular.status.bar.notification.ui.component","Realize.common.popOverComponent","Realize.content.contentResolver","Realize.content.contentSourceService","Realize.common.handlePostMessage","Realize.assignment.constants","Realize.assignment.utilService","rlzComponents.components.rubricSidePanel","rlzComponents.assignmentTelemetryModule","rlzComponents.routedComponents.assignments.constants","rlzComponents.components.featureManagement","Realize.constants.googleClassroom","rlzComponents.contentViewerTelemetryModule"]).controller("ContentCtrl",["$sce","$scope","$rootScope","$location","$log","$window","$filter","ContentViewerData","ContentViewer","AssignmentFacadeService","TinCanConfigService","$routeParams","TrackingService","BrowserInfo","MediaQuery","$timeout","RecommendationFacadeService","$currentUser","NavigationService","MEDIA_TYPE","COMPONENT_TEMPLATE_PATH","ViewProgressService","lwcI18nFilter","Modal","PATH","CONTENT_CONSTANTS","lstNotificationService","ContentResolver","ContentSource","sendPostMessage","assignmentViewerService","$document","$q","assignmentCompletedAlertHelperService","ASSIGNMENT_CONSTANTS","AssignmentUtil","telemetryUtilitiesService","rubricEventTracking","assignmentTelemetryService","featureManagementService","GOOGLE_CLASSROOM","contentViewerTelemetryService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R,C,D,b,P,w,L,$,O,N,M,k,z,U,F,x,B,V){"use strict";function H(e,n,r,s){if(!t.content.isExternalResource()){var a=d.classId||"na",i=t.getAdaptiveAssignmentId()||"na",o=t.isRecommendation&&t.isAssessment;m.trackContent(a,e,n,i,s,{userAssignmentId:r,isAdaptiveAssessment:o})}}angular.element("html").addClass("contentViewer");var G,j=function(){return G||(G=a.document.getElementById("contentViewerFixedHeader")),G};n.viewLoading=!0,t.currentUser=v,t.isStudent=v.isStudent,t.isEditing=d.editing,t.assignmentStatus="loading",t.isRubricInteractive=!1,t.showCannotScoreRubricWarningMessage=!1,t.isAdaptive=!1,t.isReview=v.isTeacher,t.isReady=!1,t.enableContinueButtonToggle="true"===a.toggleSubmitAndContinueButton,t.userAssignmentId=d.userAssignmentId||d.assignmentUserId,t.studentId=r.search().studentId,t.parentUserAssignmentId=d.userAssignmentId||d.assignmentUserId,t.noOfStarsAnimated=0,t.viewProgressPage=A+"/content/viewProgress.html",t.hashCharRegPattern=/#/g,t.hashCharURIEncode="%23",t.starPopOverType=null,t.stopTrackingTimeSpent=null,t.isTrackingRecommendation=!1,t.isAdaptiveLessonLevelAssignment=!1;var q={},Y=angular.element("#pageWrap");D.clearNotification(),t.trackAdaptiveAssignment=!0,t.parentContentId=d.itemId,t.parentContentVersion=d.itemVersion,t.assignmentViewerHeaderVisible=!1,t.assignmentViewerAssetsVisible=!1,t.showSidePanel=d.rubric?!0:!1,t.isNativeRealizeReaderEnabled=a.realizeReaderEnabled,t.isLtiAUser=!1,t.isSaveButtonVisible=!1,t.isHideExitAndBackButton=!1,angular.forEach(v.roles,function(e){"ROLE_LTI_A_USER"===e&&(t.isLtiAUser=!0)});var W=O.defer(),K={exit:"exit",turnIn:"turnIn",tabSwitch:"tabSwitch"},Q=function(){return t.assignmentStatus===M.STATUS.COMPLETED||t.assignmentStatus===M.STATUS.SUBMITTED};t.isEarlyLearnerStudent=function(){var e="EarlyLearner";return v.isStudent&&e.indexOf(v.getAttribute("profile.learningExperience"))>-1};var X=t.isEarlyLearnerStudent(),Z=function(){if(L.isAssignmentViewer()&&t.lwcAssignment){var e=r.search().studentId;t.assignmentStatus=e&&!_.isEmpty(e)?t.lwcAssignment.getAssignmentStatus(e):r.search().status?r.search().status:t.lwcAssignment.getAssignmentStatus()}};angular.isUndefined(v.isPreviewingAssignment)&&(v.isPreviewingAssignment=l.getPreviewStatus(r.path())),t.isPreviewMode=v.isPreviewingAssignment;var J=function(e){var n=t.lwcAssignment.findItemMetadataByUserAssignmentId(e);t.rubricConfig.overriddenPercentageScore=c.getScore(n)};t.$on("assessment-player.question.rubricGuid",function(e,n){if(t.rubricGuid=n.rubricGuid?n.rubricGuid:void 0,t.questionId=n.questionId,t.showSidePanel=!1,t.rubricConfig.isRubricInteractive=!1,t.showRubricScoringWarningMessage()&&!t.rubricPanelHeightCalculated){t.rubricPanelHeightCalculated=!0;var r=t.rubricPanelHeight.height,s=63,a=2,i=r.substring(0,r.length-a);t.rubricPanelHeight={height:i-s+"px"}}angular.isDefined(n.manualScore)&&(t.rubricConfig.overriddenScore=n.manualScore),t.rubricConfig.isScoreSent=n.isScoreSent,t.hasRubric()}),t.$on("essayScorer.telemetry.event",function(e,n){var r,s,a;L.isAssignmentViewer()?(a="Assignment Viewer",r=t.lwcAssignment.contentItem.programs[0],s=t.lwcAssignment.contentItem.title):(a="Content Viewer",r=t.content.programs[0],s=t.content.title),F.sendEssayScorerTelemetryEvent(a,r,n.name,n.subpage,s)});var et=function(){var e={};t.rubricConfig=e,Z();var n=t.lwcAssignment.programHierarchy;e.programTitle=z.getProgramTitle(n),e.isScoreMode=(Q()||t.lwcAssignment.isAssignmentPastDueDate())&&!t.isPreviewMode,e.isRubricInteractive=v.isTeacher&&e.isScoreMode,e.showCannotScoreRubricWarningMessage=!e.isRubricInteractive&&v.isTeacher&&!t.isPreviewMode,J(t.userAssignmentId)},tt=function(){var e={};t.rubricConfig=e,k.getProgramHierarchy(t.content,t.content.id).then(function(t){e.programTitle=z.getProgramTitle(t)}),e.isScoreMode=!1,e.isRubricInteractive=!1,e.showCannotScoreRubricWarningMessage=!1};L.isAssignmentViewer()&&(n.hidePlatform=!0,t.lwcAssignment=o.assignment,t.assignmentViewerHeaderVisible=t.lwcAssignment&&Object.keys(t.lwcAssignment).length>0&&!X,t.assignmentViewerAssetsVisible=L.isLesson(t.lwcAssignment)&&!X,t.lwcAssignment&&!X&&et());var nt=function(){var e=$[0].getElementById("pageWrap");e&&angular.element(e).removeClass()},rt=function(){return t.isRRSItem?document.getElementById("rrsFrame"):t.content.fileType===C.FILE_TYPE.TIN_CAN_SCO?document.querySelector('[name="tinCanScoPlayer"]'):void 0},st=function(e){if(t.isRRSItem||t.content.fileType===C.FILE_TYPE.TIN_CAN_SCO){var n=rt();if(n&&t.isRRSItem){W=O.defer();var r={action:"exitRRSIFrame",data:{type:e,userAssignmentId:t.userAssignmentId}};s.debug("RR SCO :: From R: [RGHT-72208] : Sending post to RR"),w(r,n.contentWindow)
}else n&&t.content.fileType===C.FILE_TYPE.TIN_CAN_SCO&&(n.src="")}};t.onAssetSelectProxy=function(e,n,r){var a=K.tabSwitch;return st(a),t.isRRSItem?(s.debug("RR SCO :: From R: [RGHT-72208] : Deferring Asset Switch"),W.promise.then(function(){s.debug("promise resolved for asset select"),t.onAssetSelect(e,n,r)}),W):(t.onAssetSelect(e,n,r),O.when())},t.onAssetSelect=function(e,n,r){t.isLanguageSelectOptionEnabled=!1,t.showSidePanel=!1,t.assetContentId=null,t.assetContentVersion=null,t.multiLangMetadataObj=null,t.lwcAssignment.allowMultipleLanguage&&angular.forEach(t.lwcAssignment.studentMetadata,function(s){s.userAssignmentId===r&&s.userAssignmentLanguageList.length>1&&"not_started"===s.status&&(c.getLWCAssignment(d.classId,d.assignmentId).then(function(e){t.customAssignment=e}),angular.isUndefined(t.customAssignment)&&(t.customAssignment=t.lwcAssignment),t.studentDataObject=t.customAssignment.studentMetadata.filter(function(e){return e.userAssignmentId===r}),!angular.isUndefined(t.studentDataObject)&&t.studentDataObject.length>0&&"not_started"===t.studentDataObject[0].status&&(t.isLanguageSelectOptionEnabled=!0,t.assetContentId=e,t.assetContentVersion=n,t.multiLangMetadataObj=s))}),J(r),t.isLanguageSelectOptionEnabled||t.onSelectAVAsset(e,n,r)},t.onSubmitLanguageChange=function(e,n){var r=function(){t.metadataObject=t.lwcAssignment.studentMetadata.filter(function(t){return t.userAssignmentId===e}),angular.forEach(t.metadataObject[0].userAssignmentLanguageList,function(e){e.isSelected=e.itemUuid===n,e.isSelected&&(t.metadataObject[0].status="in_progress")})};v.isPreviewingAssignment?(r(),t.onSelectAVAsset(n,t.assetContentVersion,e)):c.updateLanguagePreference(e,n).then(function(){r(),t.onSelectAVAsset(n,t.assetContentVersion,e)},function(e){s.error("Failed to update language preference",e)})},t.onSelectAVAsset=function(e,n,r){if(t.stopTrackingTimeSpent(),t.isAdaptive=!1,t.showProgress=!1,t.showSummary=!1,t.isReady=!1,t.isAdaptiveLessonLevelAssignment=!1,!e||!n||!r)throw new Error("Required params missing for switching Assignment Viewer tab");b(e,n).then(function(e){nt(),t.userAssignmentId=r,t.setupContentViewer(e),e.mediaType===T.ADAPTIVE_HOMEWORK&&(o=e),ft()})},t.shouldIncludeFooterElement=function(){return t.isRecommendation||t.isReady},t.shouldHideFooter=function(){return t.showProgress||t.showSummary&&!t.isReady},t.isAssignmentViewerLesson=function(){return t.assignmentViewerHeaderVisible&&t.lwcAssignment.isLesson()},t.setupContentViewer=function(o,u){t.showLoading=!0,t.showSplash=!1,t.showPageNavigation=!1,t.isRRSItem=!1,t.showContentViewerBanner=!1,t.rubricGuid=void 0,D.clearNotification(),t.hasRubric=function(){if(t.isEarlyLearnerStudent())return!1;t.rubricConfig.rubricGuid=t.content.rubricGuid?t.content.rubricGuid:t.rubricGuid;var e=t.content.rubricAvailable&&void 0!==t.rubricConfig.rubricGuid;return L.isAssignmentViewer()?t.lwcAssignment?t.lwcAssignment.useRubric&&e:!1:e},t.onRubricSelect=function(){return!0};var m=t.$watch("viewLoading",function(e){if(!e){var t=1e3;f(function(){h(),m()},t)}}),h=function(){t.$evalAsync(function(){var e=function(){return t.shouldIncludeFooterElement()&&!t.shouldHideFooter()},n=function(){var e=40;return t.assignmentViewerHeaderVisible?r():e},r=function(){return o?o.offsetHeight:0},s=function(){var t=60;return e()?t:0},i=function(e){return e+"px"},o=j();t.headerHeight=n(),t.contentHeight=a.innerHeight-t.headerHeight-s();var l=i(t.contentHeight),c="Test"!==t.content.mediaType||g.isIDevice?l:i(t.contentHeight-60);t.loaderStyle={height:i(a.innerHeight-120)},t.rrsContainerStyle={height:l},t.rubricPanelHeight={height:c}})};a.addEventListener("resize",_.throttle(h,100)),t.$on("$destroy",function(){a.removeEventListener("resize",h),angular.element("html").removeClass("contentViewer")}),l.setupController(t,o);var S=t.content.fileType,A=t.content.mediaType,I=A===T.LEVELED_READER&&S===C.FILE_TYPE.URL,y=A===T.GOOGLE_DOC,R=i("contains")(t.content.restrictedDownloadContent,"download"),b=["PDF","DOC","PPT","Doc/Docx","PPT/PPTX","DOCX","PPTX"],P=g.OS.isIOS&&_.contains(b,S);t.enableDownload=function(){return R&&(!g.OS.isIOS||P)&&!y},t.downloadLinkLabel=function(){return p.breakpoint.isDesktop?P?E("contentViewer.action.open"):E("contentViewer.action.download"):""},t.showSiblings=function(){return t.content.siblings&&!t.isStudent&&!t.isEditing},t.isContentUrlInvalid=!t.content.url||null===t.content.url;var w=at();t.getIsContentUrlInvalid=function(){return A===T.GOOGLE_DOC?!w||t.isContentUrlInvalid:t.isContentUrlInvalid},t.isContentUrlRequired=A!==T.TEST&&A!==T.ADAPTIVE_HOMEWORK,t.isAssessment=A===T.TEST,t.isScoOrTest=A===T.TEST||S===C.FILE_TYPE.TEST||S===C.FILE_TYPE.SCO||S===C.FILE_TYPE.TIN_CAN_SCO,t.hasEssayScorer=t.content.hasEssayScoring,t.isReviewMode=t.content.isReviewMode,t.isRecommendation=t.isAdaptive&&A!==T.ADAPTIVE_HOMEWORK,t.showSidePanel=d.rubric&&A!==T.TEST,(A===T.AUDIO||A===T.VIDEO)&&(t.contentUrl=g.isIDevice&&t.content.ipadUrl&&t.content.ipadTokenRetrievalUrl?t.content.ipadUrl:t.content.url),t.fileName=t.content.hasOwnProperty("file")&&""===t.content.file?t.content.file:t.content.attachments&&t.content.attachments.length?t.content.attachments[0].file:"",t.clearMediaClass=function(){t.content.mediaClass&&Y.removeClass(t.content.mediaClass)},t.pickMediaClass=function(){return t.clearMediaClass(),t.content&&A?((A===T.REALIZE_READER_SELECTION||A===T.ETEXT||A===T.INTERACTIVE_MEDIA||A===T.SELECTED_READING||A===T.LINK&&S!==C.FILE_TYPE.OPEN_ED||I)&&(t.content.mediaClass="mediaType-"+t.content.mediaType.toLowerCase().replace(/\s/g,"-"),Y.addClass(t.content.mediaClass)),void 0):(t.content.mediaClass="",void 0)};var $=function(){return t.isRecommendation&&t.isTrackingRecommendation};if(t.$on("$routeChangeStart",t.clearMediaClass),t.$watch("content.mediaType",t.pickMediaClass),t.pickMediaClass(),t.clearMediaClass(),(A===T.REALIZE_READER_SELECTION||A===T.SELECTED_READING||A===T.ETEXT||A===T.LINK||A===T.INTERACTIVE_MEDIA||I)&&t.pickMediaClass(),t.content.displayThumbnail=A===T.REALIZE_READER_SELECTION||A===T.SELECTED_READING||A===T.ETEXT||I?t.content.$getThumbnailUrl("ETEXT",!1):"",t.fileSize=t.content.hasOwnProperty("size")&&""===t.content.size?t.content.size:t.content.attachments&&t.content.attachments.length?t.content.attachments[0].size:"",A===T.PARTNER_LINK&&(t.content.isNewWindowLtiLaunch=t.content.ltiLaunchSettings.openNewWindow||"https"===r.protocol()&&-1===t.content.url.indexOf("https"),t.content.displayThumbnail=t.content.$getThumbnailUrl("PARTNER_LINK",!1)),A===T.ADAPTIVE_HOMEWORK&&!v.isPreviewingAssignment)if(t.adaptiveAssignmentState={},t.isAdaptive=!0,t.lwcAssignment.isLesson()){t.isAdaptiveLessonLevelAssignment=!0;var O=r.search().studentId;t.assignmentStatus=t.lwcAssignment.getChildAdaptiveUserAssignment(O).status,t.viewReport()}else c.getLWCAssignment(d.classId,d.assignmentId).then(function(e){s.log("Retrieved assignment",e),t.lwcAssignment=e,t.assignmentStatus=t.lwcAssignment.getAssignmentStatus(r.search().studentId),t.viewReport()},function(e){s.log("Retrieving lwcAssignment failed",e),t.back()});t.$on("assessment-player.hasEssayScorer.exit",function(e,n){t.back(n)}),t.isRecommendation&&t.isAssessment&&!t.isReview?(t.enableContinueButtonToggle&&(s.log("Enabling continue button toggle for Assessment Recommendation"),t.$on("assessment-player.player-directive.questionStatusChanged",function(e,n){e.defaultPrevented||(e.preventDefault(),t.$evalAsync(function(){s.log("questionStatusChanged in content ctrl : ",n.questionStatus),t.questionCompleted="Completed"===n.questionStatus,t.disableContinueButton=!t.questionCompleted}))}),t.questionCompleted=!1,t.disableContinueButton=!0),t.$on("assessment-player.player-directive.assessmentSubmitted",function(e,n){e.defaultPrevented||(e.preventDefault(),t.$evalAsync(function(){s.log("assessmentSubmitted in content ctrl : ",n),t.assessmentSubmitted=n.assessmentSubmitted,t.disableContinueButton=t.enableContinueButtonToggle&&!n.assessmentSubmitted&&!t.questionCompleted}))}),t.assessmentSubmitted=!1):t.disableContinueButton=t.isRecommendation?!1:!0,t.showBack=!0,t.stopTrackingTimeSpent||(t.isAdaptive||A===T.ADAPTIVE_HOMEWORK?t.stopTrackingTimeSpent=function(){$()&&t.stopTrackingCurrentRecommendation(),t.trackAdaptiveAssignment||(t.isRecommendation=!1,H(t.parentContentId,t.parentContentVersion,t.parentUserAssignmentId,C.CONTENT_VIEWER_ACTIVITY.STOPS),t.trackAdaptiveAssignment=!0)}:(t.stopTrackingTimeSpent=function(){H(t.content.id,t.content.version,t.userAssignmentId,C.CONTENT_VIEWER_ACTIVITY.STOPS)},ft()),t.$on("$destroy",function(){a.onbeforeunload=null})),!t.isEarlyLearnerStudent()&&u&&(t.$on("$locationChangeStart",t.stopTrackingTimeSpent),a.onbeforeunload=function(){t.$evalAsync(t.stopTrackingTimeSpent)}),t.isLanguageSelectOptionEnabled&&(t.isLanguageSelectOptionEnabled=!1,c.setInProgress(t.userAssignmentId,t.isAdaptive,d.classId,d.assignmentId).then(function(e){s.debug("Marking assignment to in progress",e)},function(e){s.error("Failed to update assignment status",e)})),A!==T.ADAPTIVE_HOMEWORK&&(t.assignmentStatus="in_progress",t.disableReportButton=!1,n.viewLoading=!1,t.showLoading=!1),A===T.ADAPTIVE_HOMEWORK&&v.isPreviewingAssignment&&(t.disableReportButton=!1,n.viewLoading=!1,t.showLoading=!1,t.enableAdaptiveHomework=!0),A===T.REALIZE_READER_SELECTION&&(t.isRRSItem=!0,t.rrsConfig={},t.rrsConfig.url=l.getRRSUrl(t.content),t.rrsConfig.trustedUrl=e.trustAsResourceUrl(t.rrsConfig.url),Z()),A===T.LEARNING_RESOURCE&&(t.learningResourceConfig={},t.learningResourceConfig.trustedUrl=e.trustAsResourceUrl(t.content.launchUrl)),A===T.GOOGLE_DOC&&(t.googleDocConfig={},t.googleDocConfig.trustedUrl=e.trustAsResourceUrl(w)),N.setAssignmentCompleted(!1),dt(),t.shouldDisplaySaveButton()},t.shouldDisplaySaveButton=function(){var e=!!r.search().isLtiaResourceLaunch,n=t.isLtiAUser;e&&n&&(t.isHideExitAndBackButton=!0),t.isSaveButtonVisible=t.isLtiaResourceRRSLaunch()},t.isLtiaResourceRRSLaunch=function(){var e=!!r.search().isLtiaResourceLaunch,n=t.isLtiAUser,s=t.isStudent,a=t.content.mediaType===T.REALIZE_READER_SELECTION;return e&&n&&s&&a?!0:!1},t.onLtiAResourceRRSSave=function(e){V.sendLtiAResourceSaveEvent(t.content.id,t.content.title),t.onBack(e)};var at=function(){var e=t.content.url;if(t.isPreviewMode||!t.userAssignmentId||!L.isAssignmentViewer())return e;var n=o.ClassRoster.isGoogleClass(),r=o.isGoogleClassroomEnabled,s=t.lwcAssignment.findItemMetadataByUserAssignmentId(t.userAssignmentId);return X&&n||n&&r?it(s):e},it=function(e){return e&&e.studentGoogleDocAssignmentId?[a.googleDocBaseUrl,e.studentGoogleDocAssignmentId].join("/"):void 0};t.updateAdaptiveAssignmentState=function(){if(_.isEmpty(t.adaptiveAssignmentState))s.log("Unable to restore Adaptive Assignment. Exiting !"),t.back();else{var e=t.adaptiveAssignmentState.currentRecommendation;t.assessmentId=e.assessmentId,t.userAssignmentId=e.userAssignmentId,t.noOfStarsAnimated=e.noOfStars,t.sessionId="",t.isReview=e.isReview,t.isReady=e.isReady}},t.showStatusMessage=function(e){"true"===e||e===!0?(t.notificationMsg=E("contentViewer.statusBarMessage.correct"),t.notificationType="success"):(t.notificationMsg=E("contentViewer.statusBarMessage.incorrect"),t.notificationType="failure"),D.addNotification(t.notificationType,t.notificationMsg,"true","3000",angular.element(".content-navbar").height())},t.isPopOverAllowed=function(){return v.isStudent&&t.isRecommendation&&!t.isReview},t.showPopOverAlert=function(){return t.starPopOverType&&!v.getAttribute(t.getStarPopOverAttribute(t.starPopOverType))},t.getStarPopOverAttribute=function(e){return[t.getAdaptiveAssignmentId(),"popOverShown",e].join(".")},t.updateStarPopOverAttribute=function(){var e=t.getStarPopOverAttribute(t.starPopOverType);v.setAttribute(e,!0),t.starPopOverType===C.STAR_POPOVER_TYPE.FIRST_STAR_GAINED&&(e=t.getStarPopOverAttribute(C.STAR_POPOVER_TYPE.FIRST_CORRECT_ANSWER),v.setAttribute(e,!0))},t.getStarPopOverText=function(){var e=["contentViewer","popOverText",t.starPopOverType].join(".");return E(e)},t.showStarPopOver=function(){t.$evalAsync(function(){t.isPopOverAllowed()&&t.showPopOverAlert()?(t.starPopOverShown=!0,t.$broadcast("popOverComponent.show"),t.updateStarPopOverAttribute()):t.clearPopOver()})},t.$watch("notificationType",function(e){"success"===e&&0===t.noOfStarsAnimated&&(t.starPopOverType=C.STAR_POPOVER_TYPE.FIRST_CORRECT_ANSWER)}),t.$watch("noOfStarsAnimated",function(e,n){0===n&&e>0&&5>e?t.starPopOverType=C.STAR_POPOVER_TYPE.FIRST_STAR_GAINED:n&&n>e&&(t.starPopOverType=C.STAR_POPOVER_TYPE.FIRST_STAR_LOST)}),t.clearPopOver=function(){t.$broadcast("popOverComponent.close"),t.starPopOverShown=!1,t.starPopOverType=void 0},t.removePopOverAttributes=function(){angular.forEach(C.STAR_POPOVER_TYPE,function(e){var n=t.getStarPopOverAttribute(e);s.log("Deleted ",n,v.deleteAttribute(n))})},t.gotoSibling=function(e){var t=r.path().split("content/")[0],n=t+["content",e.id,e.version].join("/");S.replaceLocationWith(n)},t.startTrackingAdaptiveUserAssignment=function(e){t.isTrackingRecommendation=!0,H(t.content.id,t.content.version,e,C.CONTENT_VIEWER_ACTIVITY.STARTS)},t.stopTrackingCurrentRecommendation=function(){t.isTrackingRecommendation=!1,H(t.content.id,t.content.version,t.userAssignmentId,C.CONTENT_VIEWER_ACTIVITY.STOPS)},t.gotoRecommendation=function(e){t.adaptiveAssignmentState.currentRecommendation=e,b(e.itemId,e.itemVersion).then(function(e){t.updateAdaptiveAssignmentState(),t.setupContentViewer(e),t.isReview||t.startTrackingAdaptiveUserAssignment(t.userAssignmentId),t.showStarPopOver()})},t.loadRecommendation=function(){var e=d.classId;h.getRecommendation(e,t.getAdaptiveAssignmentId(),t.isFirstRecommendation).then(function(e){var n;e.recommendationStatus&&"ready"!==e.recommendationStatus?(s.log("got Recommendation : ",e),t.noOfStarsAnimated=e.noOfStars,n=f(function(){t.processRecommendation(e)},3e3)):(s.log("No More Recommendations : ",e),t.noOfStarsAnimated=e.noOfStars,n=f(function(){t.viewReport()},3e3)),t.$on("$destroy",function(){f.cancel(n)})})},t.processRecommendation=function(e){if(t.isFirstRecommendation=!1,e.itemId||e.itemVersion||(e.itemId=e.assessmentMapping.equellaItemId,e.itemVersion=e.assessmentMapping.equellaItemVersion,e.assessmentId=e.assessmentMapping.assessmentId),e.isReview=t.isReview,e.isReady=t.isReady,e.noOfStars=t.noOfStarsAnimated,e.userAssignmentId)t.gotoRecommendation(e);else{var n=e.recommendationId,r=e.questionId?e.questionId:e.itemId;h.getUserAssignmentId(d.classId,t.getAdaptiveAssignmentId(),e,"english").then(function(a){e.assessmentId&&l.createAdaptiveStudentSession(e.itemId,e.itemVersion,a,e.assessmentId).then(function(n){t.createAdaptiveStudentSession=n,t.assessmentId=e.assessmentId,s.log("createAdaptiveStudentSession",t.createAdaptiveStudentSession)}),h.sendRecommendationFollowedEvent(d.classId,n,r).then(function(n){s.log("Recommendation Followed Event Sent",n),e.userAssignmentId=a,t.gotoRecommendation(e)})})}},t.submitAssessmentRecommendation=function(){t.$on("uxfReviewItemPlayer.summary.get.success",function(e){if(!e.defaultPrevented){e.preventDefault(),s.log("AssessmentRecommendation ready to submit",e),t.showLoading=!0;var n=e.targetScope.$parent.session.sequence.sessionId,r=e.targetScope.sessionId,a=e.targetScope.listOfQuestion[0];h.submitRecommendation(t.isAssessment,d.classId,t.getAdaptiveAssignmentId(),t.userAssignmentId,a,r,n).then(function(e){s.log("AssessmentRecommendation Submitted",e),t.showStatusMessage(e),c.setCompleted(t.userAssignmentId,!0).then(function(e){s.log("Marked Assessment Recommendation as complete",e),t.stopTrackingCurrentRecommendation(),t.next()})})}}),t.$broadcast("content-viewer.recommendation.continue")},t.getAdaptiveAssignmentId=function(){return t.isAdaptiveLessonLevelAssignment?t.lwcAssignment.getChildAdaptiveUserAssignment().assignmentId:d.assignmentId},t.submitInstructionalRecommendation=function(){h.submitRecommendation(t.isAssessment,d.classId,t.getAdaptiveAssignmentId(),t.userAssignmentId,t.content.id).then(function(e){s.log("InstructionalRecommendation Submitted",e),c.setCompleted(t.userAssignmentId,!0).then(function(e){s.log("Marked Instructional Recommendation as complete",e),t.stopTrackingCurrentRecommendation(),t.next()})})},t.next=function(e){var n,r=0;e&&e.currentTarget.disabled?e.stopPropagation():(t.showLoading=!0,t.isFirstRecommendation||(r=500,s.log("start delay for loading recommendation : ",moment(Date.now()).format("MM/DD/YYYY hh:mm:ss:SSS"))),n=f(function(){s.log("end delay for loading recommendation : ",moment(Date.now()).format("MM/DD/YYYY hh:mm:ss:SSS")),t.loadRecommendation()},r)),t.$on("$destroy",function(){f.cancel(n)})},t.viewTask=function(e){t.showProgress=!1,t.showSummary=!1,t.showLoading=!0,t.isReview="CurrentItem"!==e.status||v.isTeacher,t.processRecommendation(e)},t.loadAdaptiveAssignmentReport=function(e){e&&e.currentTarget.disabled?e.stopPropagation():(t.isReview||t.isAssessment||t.stopTrackingCurrentRecommendation(),!t.isAssessment||t.isReview||t.assessmentSubmitted?t.$evalAsync(function(){t.clearPopOver(),t.showLoading=!0,t.clearMediaClass(),t.setupContentViewer(o)}):(t.$on("assessment-player.player-directive.assessmentSaved",function(e,n){e.defaultPrevented||(e.preventDefault(),t.$evalAsync(function(){s.log("assessmentSaved in content ctrl : ",n),t.clearPopOver(),t.showLoading=!0,t.setupContentViewer(o)}))}),t.$broadcast("content-viewer.recommendation.save")))},t.disableWarningModal=function(){t.warningEnabled=!1},t.viewReport=function(){(t.content.fileType===C.FILE_TYPE.SCO||t.content.fileType===C.FILE_TYPE.TIN_CAN_SCO)&&angular.element("iframe").remove(),t.showLoading=!0,q=r.search(),I.getProgressReport(d.classId,t.getAdaptiveAssignmentId(),v.isTeacher,q.studentId).then(function(e){t.tasks=e.adaptiveAssignmentDataList,t.latestTaskStatus=t.tasks.length>0?t.tasks[t.tasks.length-1].status:null,v.isTeacher?(t.teacherReview=!0,t.studentName=q.studentName):(t.teacherReview=!1,t.goalStatus=5===e.noOfStars?E("contentViewer.assignmentSummary.goalMet",[t.tasks.length]):E("contentViewer.assignmentSummary.goalNotMet",[t.tasks.length])),"completed"===t.assignmentStatus?(t.noOfStarsAnimated=e.noOfStars,t.showProgress=!1,t.showSplash=!1,t.showSummary=!0,t.showRemainingTasks=!1,t.isReady="completed"!==t.assignmentStatus):e.isSplashScreen||0===t.tasks.length?(t.noOfStarsAnimated=0,t.isFirstRecommendation=!0,t.showSplash=!0,t.maxTasks=e.maximumRecommendationLimit,t.startTrackingAdaptiveUserAssignment(t.getAdaptivePrimaryAssignmentUserId()),t.trackAdaptiveAssignment=!1):e.isViewSummary&&null!==t.latestTaskStatus?(t.noOfStarsAnimated=e.noOfStars,t.showProgress=!1,t.showSummary=!0,t.showRemainingTasks=!1,t.isReady="completed"!==t.assignmentStatus,t.trackAdaptiveAssignment&&t.startTrackingAdaptiveUserAssignment(t.getAdaptivePrimaryAssignmentUserId()||t.userAssignmentId)):(t.noOfStarsAnimated=e.noOfStars,t.showSummary=!1,t.showProgress=!0,t.maxTasks=e.maximumRecommendationLimit,t.showRemainingTasks=t.tasks.length!==t.maxTasks,t.remainingTasks=t.maxTasks-t.tasks.length,t.tasks[t.tasks.length-1].status="CurrentItem",t.trackAdaptiveAssignment&&(t.startTrackingAdaptiveUserAssignment(t.getAdaptivePrimaryAssignmentUserId()),t.trackAdaptiveAssignment=!1)),t.showRemainingTaskbar=function(){return t.showProgress&&!t.showSummary&&t.showRemainingTasks},t.showLoading=!1,n.viewLoading=!1},function(e){s.log("Unable to load progress report. Exiting !",e),t.back()})},t.continue=function(e){e&&e.currentTarget.disabled?e.stopPropagation():(t.clearPopOver(),t.clearMediaClass(),t.disableReportButton=!0,t.disableContinueButton=!0,t.assessmentSubmitted?(s.log("Recommendation already submitted. Loading next recommendation"),t.next()):(s.log("Submitting recommendation"),t.isAssessment?t.submitAssessmentRecommendation():(t.showLoading=!0,t.submitInstructionalRecommendation())))},t.submitAssignment=function(e){e&&e.currentTarget.disabled?e.stopPropagation():(t.removePopOverAttributes(),h.submitAssignment(d.classId,t.getAdaptiveAssignmentId(),t.getAdaptivePrimaryAssignmentUserId()).then(function(e){s.log("Submitted Adaptive lwcAssignment",e),t.back()}))},t.getAdaptivePrimaryAssignmentUserId=function(){return t.isAdaptiveLessonLevelAssignment?t.lwcAssignment.getChildAdaptiveUserAssignment().userAssignmentId:t.lwcAssignment.getPrimaryMetadata().userAssignmentId},t.beforeTurnIn=function(){return st(K.turnIn),t.isRRSItem?(s.debug("RR SCO :: From R: [RGHT-72208] : Defering Promise"),W.promise):O.resolve()},t.onBack=function(e){return t.isRRSItem&&!N.isAssignmentCompleted()?(st(K.exit),W.promise.then(function(){t.back(e)}),void 0):(t.back(e),void 0)},t.back=function(e){var i=document.querySelector("iframe");if(e&&e.stopPropagation(),!t.isLtiaResourceRRSLaunch()){if(t.clearMediaClass(),t.$broadcast("preNavigationChange","backButton"),t.content.fileType===C.FILE_TYPE.TIN_CAN_SCO&&i)try{angular.element(i.contentWindow).trigger("beforeunload")}catch(e){}if(t.isRRSItem||st(),t.isLtiAUser&&r.search().backUrl){var l=r.search().backUrl;return S.navigateOutsideAngularContext(l),void 0}t.isEarlyLearnerStudent()&&(n.viewLoading=!0,r.path().indexOf("assignment")>-1&&-1===a.location.href.indexOf("completed")&&!v.attemptCompleted&&(t.isScoOrTest||t.isAdaptive)?c.getLWCAssignment(d.classId,d.assignmentId).then(function(e){return(e.isScoOrTest()||e.isAdaptiveAssignment())&&e.isCompleted()?(t.lwcAssignment&&t.lwcAssignment.isCompleted()||(n.justCompletedAssignment=f),r.search("completed",!0),r.path("/intermediateBackRouteHandler"),void 0):(r.path("/intermediateBackRouteHandler"),void 0)},function(e){s.log("Failed to retrieve assignment, returning to list",e),r.path("/intermediateBackRouteHandler")}):r.path("/intermediateBackRouteHandler"));var u=r.path(),m=u.split("/content/")[0],g=!1,p=r.search()||{};if(r.search("editing",null),r.search("rubric",null),o.siblings&&u.match(/\/content\//))return t.goBack(m,!0),void 0;if(u.match(/\/edit\/preview$/)?(m=u.split("/preview")[0],g=!0):u.match(/\/remediation\//)?(m=u.split("/remediation")[0]+"/remediation",g=!0):u.match(/\/assignment\//)?m=u.split("/assignment/")[0]:u.match(/\/center\//)&&(m=u.split("/center")[0]),(u.match(/\/student\/.*\/preview\//)||u.match(/\/gooru/))&&(g=!0),u.match(/assignments/)&&!v.attemptCompleted&&(t.isScoOrTest||t.isAdaptive)){var f=u.split("assignments/")[1].split("/")[0],h=u.split("assignments")[0]+"assignments";return t.lwcAssignment&&null!=t.lwcAssignment.parentAssignmentId&&(f=t.lwcAssignment.parentAssignmentId),c.getLWCAssignment(d.classId,f).then(function(e){return e.isScoOrTest()||e.isAdaptiveAssignment()?"Student"===v.primaryOrgRole?e.isCompleted()?(t.lwcAssignment&&t.lwcAssignment.isCompleted()||(n.justCompletedAssignment=f),t.goBack(h,!0),void 0):(t.goBack(m,g),void 0):v.isPreviewingAssignment?(v.isPreviewingAssignment=!1,u.match("/allstudents/preview")||u.match("/student")?(m=u.split("/preview")[0],t.goBack(m,g),void 0):p.studentNavigationBackId?(m="classes/"+t.currentRoster.classId+"/student/"+p.studentNavigationBackId+"/assignments",t.goBack(m,!0),void 0):(t.goBack(h,!0),void 0)):(t.goBack(m,g),void 0):(t.goBack(m,g),void 0)},function(e){s.log("Failed to retrieve lwcAssignment, returning to list",e),t.goBack(h,!0)}),void 0}v.attemptCompleted=void 0,t.goBack(m,g)}},t.submitEssayHandler=function(e){if(e){var n=t.$new();n.close=y.hideDialog,n.dialogId="essay-scorer-submit",n.title=E("essayScoreAssignment.submit.dialog.modalTitle"),n.body=E("essayScoreAssignment.submit.dialog.message"),n.isDismissible=!1,n.buttons=[{title:E("essayScoreAssignment.submit.dialog.action.cancel"),clickHandler:n.close},{title:E("essayScoreAssignment.submit.dialog.action.submit"),clickHandler:t.submitTest,isDefault:!0}],n.dismissed=!1,n.closeBtnClickHandler=n.close,y.showDialog(R.TEMPLATE_CACHE+"/partials/simpleDialog.html",n)}else t.warningEnabled=!1,t.answerError=!0},t.$on("assessment-player.hasEssayScorer.answerError",function(e,n){t.answerError=n.answerError,t.warningEnabled=n.warningEnabled}),t.$on("assessment-player.hasEssayScorer.warningMessageCode",function(e,n){"isReviewMode"!==t.isReviewMode&&(t.warningEnabled=!0,t.warningMessage=n.warningMessage),t.answerError=!1}),t.submitTest=function(e){t.warningEnabled=!1,y.hideDialog(),t.$broadcast("essayScorer.submitTest",e)};var ot=function(){var e=function(){t.back(event)},n="",r="assessmentBuilder.preventResubmissionTest.message",s={OK:{title:"assessmentBuilder.action.ok",handler:e,isDefault:!0}};y.simpleDialog(n,r,s,{id:"preventResubmissionTestModal"})};t.$on("assessment-player.player-directive.preventResubmissionTest",function(){ot()}),t.localizeTaskName=function(e){var t=E("contentViewer.viewProgress.task");return t+" "+e.split(" ")[1]},t.getReviewMode=function(){return t.isReviewMode||t.isReview&&v.isTeacher},t.showToolbar=function(){var e=t.enableToolsDropdown()||t.enableDownload()||t.showPageNavigation||t.hasRubric();return!(t.showSummary||t.showProgress)&&e&&t.assignmentViewerHeaderVisible&&!t.isLanguageSelectOptionEnabled},t.enableToolsDropdown=function(){return angular.isDefined(t.content.associatedTools)&&null!==t.content.associatedTools},t.showDiscussionLanding=function(){return t.content.mediaType===T.DISCUSSION_PROMPT&&t.lwcAssignment.isLesson()},t.showAdaptiveBar=function(){return(t.isRecommendation||t.showProgress)&&!t.showSummary},t.showNotificationBar=function(){return t.notificationMsg=pt.getDefaultMessage(),gt(t.content.mediaType)?!0:angular.isDefined(t.isPreviewMode)&&angular.isDefined(t.userAssignmentId)?t.showRubricScoringWarningMessage()?(t.notificationMsg=pt.getMessageForRubricTestNavScoring(),t.notificationMsgUrl=pt.getMessageUrlForRubricTestNavScoring(),t.notificationMsgPart3=pt.getMessagePart3ForRubricTestNavScoring(),t.programTitle=z.getProgramTitle(t.lwcAssignment.programHierarchy),!0):!(!t.currentUser.isTeacher||t.isPreviewMode||mt(t.content.mediaType,t.content.fileType)||t.showContentViewerBanner||t.isContentUrlInvalid&&t.isContentUrlRequired):!1},t.showRubricScoringWarningMessage=function(){return t.isRecommendation||Z(),t.content.mediaType===T.TEST&&t.hasRubric()&&t.currentUser.isTeacher&&!t.isPreviewMode&&mt(t.content.mediaType,t.content.fileType)&&Q()&&lt()},t.displayEditLinkForGoogleDoc=function(e){return e.mediaType===T.GOOGLE_DOC&&x.isGoogleClassroomEnabled()&&g.OS.isMobileDevice?!0:!1};var lt=function(){var e=t.lwcAssignment.getItemStatus(t.content.id,r.search().studentId);return e===M.STATUS.COMPLETED||e===M.STATUS.SUBMITTED},ct=function(){t.showContentViewerBanner=M.STATUS.NOT_STARTED===t.assignmentStatus},ut=function(){var e=r.search().studentId;t.showContentViewerBanner=M.STATUS.NOT_STARTED===t.lwcAssignment.getItemStatus(t.content.id,e)},dt=function(){!t.isRRSItem&&angular.isDefined(t.isPreviewMode)&&(t.isPreviewMode||!L.isAssignmentViewer()||!t.currentUser.isTeacher||t.isContentUrlInvalid&&t.isContentUrlRequired||!t.isAssignmentViewerLesson()||(t.isAdaptiveLessonLevelAssignment?ct():ut()))},mt=function(e,t){var n=[T.TEST,T.ADAPTIVE_HOMEWORK,T.REALIZE_READER_SELECTION,T.DISCUSSION_PROMPT],r=[C.FILE_TYPE.SCO,C.FILE_TYPE.TIN_CAN_SCO];return-1!==n.indexOf(e)||-1!==r.indexOf(t)},gt=function(e){if(e===T.REALIZE_READER_SELECTION&&L.isAssignmentViewer()&&("submitted"===t.assignmentStatus||"completed"===t.assignmentStatus)){if(t.currentUser.isTeacher&&!t.isPreviewMode)return t.notificationMsg=pt.getMessageForRrsTeacherReview(),!0;if(t.currentUser.isStudent)return t.notificationMsg=pt.getMessageForRrsStudentSelfReview(),!0}return!1},pt={getMessageForRrsTeacherReview:function(){return E("contentViewer.notification.reviewable.nonAssignmentWork.message")},getMessageForRrsStudentSelfReview:function(){return E("contentViewer.notification.student.postTurnIn.selfReviewMessage")},getDefaultMessage:function(){return E("contentViewer.notification.nonReviewable.message")},getMessageForRubricTestNavScoring:function(){return E("assignmentViewer.scoringWarning.messagePart1")},getMessageUrlForRubricTestNavScoring:function(){return E("assignmentViewer.scoringWarning.urlPart2")},getMessagePart3ForRubricTestNavScoring:function(){return E("assignmentViewer.scoringWarning.messagePart3")}},ft=function(){H(t.content.id,t.content.version,t.userAssignmentId,C.CONTENT_VIEWER_ACTIVITY.STARTS)};t.currentPageChange=function(e){t.currentPage=e},t.closeSidebar=function(e,n){t.showSidePanel=!t.showSidePanel;var r=t.content.externalId,s=t.rubricConfig.programTitle,a=t.showSidePanel;t.showSidePanel&&setTimeout(function(){var e=document.getElementById("rubricCloseButton"),t=document.getElementById("noRubricCloseButton");e?e.focus():t.focus()},100),e||U.nonAssignmentRubricButtonEvents(r,s,a,n)};var ht=function(e){var n=e.data;if(s.debug("RR SCO :: From R: [RGHT-72208] : ",n),"getGADetails"===n.action){var a={action:"GADetails",GADetails:{userId:window.btoa(v.userId),userRole:v.primaryOrgRole,userOrg:v.primaryOrgId}};w(a,e.source,e.origin)}else if("getTCConfig"!==n.action||t.isRRSItem)if("getAuthorization"!==e.action||t.isRRSItem)if("rrInitialized"===e.data.action){var i=r.search().studentId||"",o=t.assignmentStatus,l={action:"contentViewerData",data:{pages:t.content.pages,studentId:i,assignmentStatus:o,assignmentViewer:L.isAssignmentViewer()}};w(l,e.source,e.origin)}else"rrUnloadComplete"===e.data.action?(s.debug("RR SCO :: From R: [RGHT-72208] : message from RR ",e.data),s.debug("RR SCO :: From R: [RGHT-72208] : Resolving promise for UA:",t.userAssignmentId),W.resolve()):s.log("Not supported call for TCConfig listener.");else u.getTinCanAuthToken().then(function(t){w(t,e.source,e.origin)});else{var c=t.userAssignmentId;void 0===c&&(c=""),u.getTinCanSCOSettings(c).then(function(t){w(t,e.source,e.origin)})}};t.$on("postMessageEvent",function(e,t){ht(t)});var vt=!0;t.setupContentViewer(o,vt),L.isAssignmentViewer()||tt()}]),angular.module("Realize.content",["Realize.content.model.contentItem","Realize.content.model.gooruItem","Realize.content.model.openEdItem","Realize.content.contentController","Realize.content.contentResolver","Realize.content.contentSourceService","Realize.content.contentViewerService","Realize.content.contentDataService","Realize.content.constants","Realize.content.model.questionBank","Realize.content.model.questionBankItem"]),angular.module("Realize.content.contentDataService",["Realize.content.constants","Realize.paths"]).factory("ContentDataService",["$http","$q","$log","REST_PATH","CONTENT_CONSTANTS",function(e,t,n,r,s){"use strict";var a={};return a.getAvailableBankPlayerTarget=function(a){return e({url:r+"/items",method:"GET",params:{QUESTION_BANK_TYPE:s.QUESTION_BANK_TYPE.TEST,OLE_PRODUCT_ID:a,"includedFacets[]":s.FACET.PLAYER_TARGET}}).then(function(e){if(e.data){var t=e.data.facets[0],n=[];return t&&t.values&&(n=_.chain(t.values).pluck("value").map(function(e){return e.toLowerCase()}).uniq().value()),n}},function(e){return n.error("Failed to retrieve question bank facet",e),t.reject("Failed to retrieve question bank facet",e)})},a.hasNonNativeBank=function(e){return a.getAvailableBankPlayerTarget(e).then(function(e){return void 0!==_.find(e,function(e){return e===s.PLAYER_TARGET.MATHXL||e===s.PLAYER_TARGET.TESTNAV})})},a.getAvailableBankPlayerTargetMap=function(e){return a.getAvailableBankPlayerTarget(e).then(function(e){var t=_.find(e,function(e){return e===s.PLAYER_TARGET.MATHXL||e===s.PLAYER_TARGET.TESTNAV}),n=_.find(e,function(e){return e===s.PLAYER_TARGET.REALIZE});return{hasNative:angular.isDefined(n),hasNonNative:angular.isDefined(t)}})},a}]),angular.module("Realize.content.contentResolver",["Realize.assessment.assessmentDataService","Realize.content.model.contentItem","Realize.content.contentSourceService","Realize.content.constants","components.realize.user"]).factory("ContentResolver",["$rootScope","$route","$log","$q","$window","Content","ContentSource","Assessment","MEDIA_TYPE","LwcRumbaDataService",function(e,t,n,r,s,a,i,o,l,c){"use strict";return function(u,d){function m(e){h.program=e,v()&&f.resolve()}function g(e){h.content=e,v()&&f.resolve()}n.log("overrideContentId, overrideContentVersion ",u,d);var p=r.defer(),f=r.defer(),h={program:!1,tier:!1,lesson:!1,content:!1},v=function(){return h.program!==!1&&h.tier!==!1&&h.lesson!==!1&&h.content!==!1
};f.promise.then(function(){n.log("content resolve jobs done",h);var e=null;if("na"!==h.lesson){if(h.lesson&&"realize-presenter"===h.lesson.playerTarget){var t=_.map(h.lesson.contentItems,function(e){return"Learning Model"===e.mediaType?e.contentItems:e});h.content.siblings=_.flatten(t)}e=$.Enumerable.From(h.lesson.contentItems).Where("$.id == '"+h.content.id+"'").FirstOrDefault(null),null===e&&$.Enumerable.From(h.lesson.contentItems).Where("$.mediaType == 'Learning Model'").ForEach(function(t){e=$.Enumerable.From(t.contentItems).Where("$.id == '"+h.content.id+"'").FirstOrDefault(null)})}else"na"!==h.tier?e=$.Enumerable.From(h.tier.contentItems).Where("$.id == '"+h.content.id+"'").FirstOrDefault(null):"na"!==h.program&&(e=$.Enumerable.From(h.program.contentItems).Where("$.id == '"+h.content.id+"'").FirstOrDefault(null));null!==e&&(h.content.associativeProps=angular.copy(e.associativeProps)),p.resolve(h.content)}),!t.current.params.programId||t.current.params.lessonId||t.current.params.tierId?m("na"):t.current.params.programId&&e.currentProgram&&e.currentProgram.id===t.current.params.programId&&e.currentProgram.version===t.current.params.programVersion?m(e.currentProgram):a.get({contentId:t.current.params.programId,version:t.current.params.programVersion}).then(function(t){e.currentProgram=t,m(t)}),t.current.params.tierId&&!t.current.params.lessonId?a.get({contentId:t.current.params.tierId,version:t.current.params.tierVersion}).then(function(e){h.tier=e,v()&&f.resolve()}):(h.tier="na",v()&&f.resolve()),t.current.params.lessonId?a.get({contentId:t.current.params.lessonId,version:t.current.params.lessonVersion,levels:3}).then(function(e){h.lesson=e,v()&&f.resolve()}):(h.lesson="na",v()&&f.resolve());var S=i.getByPath(),T=new a({broken:!0,mediaType:"broken"});return S.get({contentId:u||t.current.params.itemId,version:d||t.current.params.itemVersion,levels:1}).then(function(e){if(!e.isOpenEdItem()&&e.$isTestNavTest())o.getInfo(e.id,e.version).then(function(n){n.externalProps&&(e.qtiExternalProps=n.externalProps,e.hasEssayScoring=n.hasEssayScoring,e.isReviewMode=t.current.params.isReviewMode),g(e)},function(e){n.error("Failed to get assessment info",e),g(T)});else if(angular.isFunction(e.isLtiItem)&&e.isLtiItem()){var r=t.current.params.programId,i=t.current.params.programVersion,u=t.current.params.classId,d={};r&&(d.programId=r),i&&(d.programVersion=i),u&&(d.classId=u),a.getLtiLaunchInfo(e.id,e.version,d).then(function(t){e.ltiLaunchSettings=t.settings,e.ltiLaunchParams=t.launchParams,g(e)}).catch(function(e){n.error("Failed to get LTI content item params",e),g(T)})}else if(e.essayPrompt)e.hasEssayScoring=!0,g(e);else if(e.mediaType===l.REALIZE_READER_SELECTION){e.samlTicket="";var m="";try{m=e.url.split("launch.html")[0],c.getSAMLTicket(m).then(function(t){e.samlTicket=t,g(e)},function(t){n.error("Failed to get saml ticket",t),g(e)})}catch(p){n.error("Failed to get RRS content item params",p),g(T)}}else if(e.mediaType===l.LEARNING_RESOURCE){e.samlTicket="";var f=t.current.params.classId,h=e.url.split("//")[1].split("/")[0],v=s.ltiServiceWebToolLaunchUrl,S="resourceId="+e.id,A="resourceName="+e.title,I="resourceURL="+e.url,E="toolDomain="+h,y=v+"?"+E,R=[y,S,A,I].join("&");f&&(R=R+"&classId="+f);try{c.getSAMLTicket(R).then(function(t){e.samlTicket=t;var n="ticket="+t,r=[E,S,A,I].join("&");f&&(r=r+"&classId="+f),r=r+"&"+n;var s=v+"?"+encodeURIComponent(r);e.launchUrl=s,g(e)},function(t){n.error("Failed to get saml ticket",t),g(e)})}catch(p){n.error("Failed to get learning resource content item params",p),g(T)}}else g(e)},function(e){n.error("Failed to retrieve item",e),g(T)}),p.promise}}]),angular.module("Realize.content.contentSourceService",["Realize.content.model.contentItem","Realize.content.model.openEdItem"]).factory("ContentSource",["Content","OpenEdItem","$location",function(e,t,n){"use strict";var r="opened",s=function(n){return angular.isString(n)?(n=n.toLowerCase(),n===r?t:e):e};return s.PROVIDER={Open_ED:"OpenEd",REALIZE:"Realize",GOORU:"Gooru"},s.PROVIDER.PATH={Realize:"/search",OpenEd:"/searchOpenEd"},s.PROVIDER.FILE_TYPE={OpenEd:"OpenEd"},s.PROVIDER.VERSION={OpenEd:"open_ed"},s.getByPath=function(r){return r=r||n.path(),r.indexOf(s.PROVIDER.PATH.OpenEd)>=0||r.indexOf("/"+s.PROVIDER.VERSION.OpenEd)>=0?t:e},s}]),angular.module("Realize.content.contentViewerService",["Realize.content.model.contentItem","Realize.assessment.assessmentDataService","ModalServices","Realize.paths","RealizeDataServices.ProgramService","Realize.common.mediaQueryService","Realize.content.constants","Realize.constants.mediaType"]).factory("ContentViewer",["$rootScope","$routeParams","$location","$log","$window","$filter","Content","Assessment","Modal","PATH","ProgramService","MediaQuery","CONTENT_CONSTANTS","MEDIA_TYPE",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g){"use strict";var p={setupController:function(i,c){i.titleMax=75,i.currentPage=0,i.toolPreview=function(e){l.toolDialog(i,e,"Solution",angular.element("#toolsDropButton"))},i.loadTools=function(){i.loadingTools=!0,i.showSidePanel&&(i.showSidePanel=!1),u.loadAssociatedTools(i.content).then(function(){i.loadingTools=!1},function(){i.loadingTools=!1})},i.loadToolsDropdown=function(){u.loadAssociatedTools(i.content).then(function(e){i.toolsList=e})},i.toolsMenuConfig={icon:"wrench",direction:"down",text:d.breakpoint.isDesktop?a("lwcI18n")("contentViewer.action.tools"):"",toggleClick:i.loadTools,ariaLabelText:a("lwcI18n")("contentViewer.action.tools")},t.programId&&(i.program=e.currentProgram),i.content=c;var p=function(){0===i.content.attachments.length&&(i.content.attachments[0]={}),i.content.mediaType=g.NOT_AVAILABLE},f=function(){var e=o.getTestSession(i.content.id,i.content.version);return e.then(function(e){i.skipSplashScreen=!1,i.sessionId=e,r.log("Test found, get session!!",i.sessionId,i.content.language)},p),e},h=function(e){var t=o.getAdaptiveStudentSession(i.content.id,i.content.version,i.userAssignmentId,e);return t.then(function(e){i.skipSplashScreen=!0,i.sessionId=e,r.log("Test found for student , get Adaptive student session!!",i.sessionId,i.content.language)},p),t},v=function(e){var t=o.getStudentSession(i.content.id,i.content.version,e,i.userAssignmentId);return t.then(function(e){i.skipSplashScreen=!1,i.sessionId=e,r.log("Test found for student , get session!!",i.sessionId,i.content.language)},p),t},S=function(){return/.*\/assessment\/.*\/preview$/.test(n.path())},T=function(){return/.*\/assignments\/.*\/preview/.test(n.path())},A=function(){return angular.isDefined(t.assignmentId)};if(i.content.mediaType===g.TEST||i.content.mediaType===g.QUESTION_BANK){var I;i.currentUser.isTeacher&&(angular.isDefined(t.studentId)||angular.isDefined(t.userAssignmentId))&&!T()?(I=o.getStudentSessionFromTeacher(i.content.id,i.content.version,i.userAssignmentId),I.then(function(e){i.tryAgainHandler=void 0,i.skipSplashScreen=!1,o.getSummary(e).then(function(t){t.status===m.STUDENT_STATUS.NOT_STARTED.toUpperCase()?i.showContentViewerBanner=!0:i.sessionId=e}),r.log("Test found, get session!!",i.sessionId)},p)):I=i.currentUser.isStudent&&angular.isDefined(t.assignmentId)?i.isAdaptive&&i.assessmentId?h(i.assessmentId):v(!1,!1):f(!1)}i.content.fileType!==m.FILE_TYPE.SCO&&i.content.fileType!==m.FILE_TYPE.TIN_CAN_SCO||!t.assignmentUserId||(i.assignmentUserId=i.userAssignmentId),i.content.fileType===m.FILE_TYPE.TIN_CAN_SCO&&null!==i.content.url&&(i.content.url=i.content.url+"?tc=y");var E=i.content.fileType&&i.content.fileType.toUpperCase()===m.FILE_TYPE.OPEN_ED,y=function(){return(i.content.mediaType===g.DOCUMENT||i.content.mediaType===g.LEVELED_READER&&i.content.fileType===m.FILE_TYPE.PDF)&&angular.isDefined(i.content.pages)&&i.content.pages.length>1},R="Download Only"!==i.content.restrictedDownloadContent;i.$watch("content.mediaType",function(e){(e===g.DOCUMENT||e===g.LEVELED_READER)&&(i.content.pages=i.content.previews,i.currentPage=1,i.showPageNavigation=!E&&y()&&R)}),i.getTitle=function(e){var t=S()||A()?"original":"";return e?e.$getTitle(t):i.content.$getTitle(t)},i.assessmentMessageHandler=function(e){r.log("assessment message handler",e);var t=i.$new();switch(angular.extend(t,e),t.close=l.hideDialog,e.messageType){case"assessment-player.error":i.icon="assessment-error";break;case"assessment-player.question.feedbackcorrect":i.icon="assessment-feedback-correct";break;case"assessment-player.question.feedbackincorrect":i.icon="assessment-feedback-incorrect";break;default:i.icon=null}l.showDialog("templates/app/programs/toc/assessment/assessmentErrorDialog.html",t)},i.tryAgainHandler=function(){r.log("assessment try again handler");var e=i.$new();e.close=l.hideDialog,e.ok=function(){var e;e=i.currentUser.isStudent&&angular.isDefined(t.assignmentId)?v(!0,!0):f(!0),l.hideDialog()},l.showDialog("templates/app/programs/toc/assessment/assessmentTryAgainDialog.html",e)},i.download=function(e,t){e.stopPropagation(),e.preventDefault(),t.restrictedDownloadContent.search(/download/gi)>=0&&t.url&&s.open(t.attachments[0].downloadURL,"_blank")}},createAdaptiveStudentSession:function(e,t,n,r){return o.getAdaptiveStudentSession(e,t,n,r)},getRRSUrl:function(e){var t=e.url.split("book")[0],n="book/"+e.bookId,r="?ticket="+e.samlTicket;return t+n+r},getPreviewStatus:function(e){return e.match(/\/preview\//)?!0:!1}};return p}]),angular.module("Realize.Content.customizedMessage",["Realize.constants.mediaType"]).directive("customizedMessage",["MEDIA_TYPE",function(e){"use strict";return{templateUrl:"templates/content/customizedMessage.dir.html",link:function(t,n,r){var s,a,i,o,l,c,u=t.$eval(r.customizedMessage),d=t.$eval(r.thumbnailView),m=t.$eval(r.forSearchResult);t.messageCode="",t.customizedDate="",t.messageClass="customized",s=function(){return u.$isCustomizedTest()},i=function(){var e=u.$isTest()&&!u.originalItemId&&!u.$isCustomizedTest();return("Link"===u.mediaType||e||u.isDiscussionPrompt())&&"My Uploads"===u.contribSource},a=function(){return"Link"!==u.mediaType&&!u.$isLesson()&&!u.$isTest()&&!u.isDiscussionPrompt()&&"My Uploads"===u.contribSource},o=function(){return u.$isLesson()&&"My Uploads"===u.contribSource},l=function(){return u.$hasCustomizedLesson()},c=function(t){return t.mediaType===e.ADAPTIVE_HOMEWORK},m&&a()?(t.messageCode="searchResults.status.uploadedByYou",t.customizedDate=u.contribDate):m&&i()?(t.messageCode="searchResults.status.addedByYou",t.customizedDate=u.contribDate):m&&o()?(t.messageCode="content.customizedOn",t.customizedDate=u.contribDate):!m&&l()?(t.messageCode="content.customizedOn",t.customizedDate=u.customizedItem.contribDate):s()?(d||(t.messageClass="customized-date-text"),t.messageCode="content.customizedOn",t.customizedDate=u.$getCustomizeContribDate()):c(u)&&(t.messageClass+=" adaptive",t.messageCode="content.poweredByKnewton"),d&&"content.customizedOn"===t.messageCode&&(t.messageCode="content.customized")}}}]),angular.module("Realize.content.fullscreenPlayer",[]).directive("fullscreenPlayer",["$log","$sce",function(e,t){"use strict";return{restrict:"AE",scope:{sourceTitle:"=",sourceUrl:"=",back:"=?"},templateUrl:"templates/content/fullscreen.player.dir.html",link:function(e){e.$watch("sourceUrl",function(n){e.trustedUrl=t.trustAsResourceUrl(n)}),e.$on("fullscreenplayer.notification",function(t,n,r,s){var a={title:r,message:s};n=angular.lowercase(n),"info"===n&&(e.alertInfo=a)}),e.$emit("fullscreenplayer.loaded")}}}]),angular.module("Realize.content.media-icon",["realize-lib.ui.fallback-strategy","Realize.filters.mediaIcon","Realize.imgUtils.imgSwap","Realize.constants.contentUploadTypes"]).run(["$templateCache",function(e){"use strict";e.put("/templates/realize-lib/content/media-icon/media-icon.html",['<div class="mediaIcon with-tab" aria-hidden="true">','<img data-e2e-id="mediaIconImageId" ng-src="{{ src }}" alt="{{ content.$getTitle() }}"','fallback-strategy="fallback"',' image-swap="{{ imgLoadedAsync }}" />',"<span ng-transclude></span>","</div>"].join("\n"))}]).directive("mediaIcon",["$log","$filter","MEDIA_PATH","CONTENT_UPLOAD_TYPES",function(e,t,n,r){"use strict";return{scope:!0,replace:!0,transclude:!0,templateUrl:"/templates/realize-lib/content/media-icon/media-icon.html",compile:function(){var s=n+"/skins/default/images",a=s+"/default_icons";return function(n,i,o){if(n.content=n.$eval(o.mediaIcon),n.mediaType=t("mediaIcon")(n.content),o.overrideMediaType&&(n.mediaType=o.overrideMediaType),n.imgLoadedAsync=null,angular.isDefined(n.mediaType)){i.addClass(n.mediaType);var l=s+"/mediatype/icon/",c=!1,u="TIER",d=i.hasClass("large"),m="tool"===o.type,g=function(){return n.mediaType===r.LINK&&n.content.externalSource===r.GOOGLE_DRIVE&&n.content.fileType===r.URL},p=function(){return n.content.externalSource===r.GOOGLE_DOC&&n.content.fileType===r.URL},f=function(){return n.mediaType===r.LINK&&n.content.externalSource===r.ONE_DRIVE&&n.content.fileType===r.URL},h=function(){var e,t,r,s=l;if(d&&(s+="large/"),e=s+n.mediaType+"@2x.png",n.mediaType.indexOf("test")>=0&&n.content.essayPrompt&&(e=s+"toc_essayscorer_list@2x.png"),m)return i.removeClass("mediaIcon").removeClass("with-tab"),n.fallback=[a+"/tool@2x.png"],e=n.content.$getThumbnailUrl("TOOL",!1),e&&e!==r||(e=n.fallback.shift()),e.indexOf("@2x")>0&&n.fallback.unshift(e.replace("@2x","")),n.src=e,void 0;if(n.content.root)"dropdown"===o.type?(r=a+"/no_program_dropdown@2x.png",e=n.content.$getThumbnailUrl("PROGRAM_SUBNAV")):"course"===o.type?(r=a+"/no_program_thumb_course@2x.png",e=n.content.$getThumbnailUrl("PROGRAM"),i.removeClass("mediaIcon")):(t=d?"large":"small",r=a+"/no_program_home"+t+"@2x.png",e=n.content.$getThumbnailUrl("HOME",d)),i.removeClass("with-tab");else if(n.content.isGroupedContent&&"course"===o.type)r=a+"/no_program_thumb_course@2x.png",e=n.content.$getThumbnailUrl("PROGRAM"),i.removeClass("mediaIcon");else if("etext"===n.mediaType&&"program"===o.type)r=a+"/no_program_etext@2x.png",e=n.content.$getThumbnailUrl("ETEXT",!1)||r,i.removeClass("with-tab");else if("interactive_media"===n.mediaType?e=s+"activity@2x.png":"selected_reading"===n.mediaType||"leveled_reader"===n.mediaType?e=s+"etext@2x.png":"center"===n.mediaType?(t=d?"_grid":"",e=s+"center@2x.png"):n.content.isExternalResource&&n.content.isExternalResource()?(e=a+n.content.getExternalResourceDefaultImage(),i.removeClass("with-tab")):"video"===n.mediaType&&n.content.$isNbcItem&&n.content.$isNbcItem()?e=s+"nbc_learn_video@2x.png":p()?e=s+"google_doc@2x.png":g()?e=s+"google_drive_link@2x.png":f()?e=s+"one_drive_link@2x.png":"playlist"===n.mediaType&&(e=s+"playlist@2x.png"),r=e,n.content.thumbnailUrls&&n.content.thumbnailUrls.length){var h=n.content.$getThumbnailUrl(u,o.large?n.$eval(o.large):!1);h?(e=h,i.removeClass("with-tab").removeClass("mediaIcon").addClass("customImage"),c=!0):i.hasClass("customImage")&&i.removeClass("customImage").addClass("mediaIcon").addClass("with-tab")}n.fallback=[r],n.$on("fallbackStrategy.fallback.applied",function(e,t){var n=e.targetScope.content;n&&!n.isExternalResource()&&t.parent().hasClass("customImage")&&t.parent().addClass("mediaIcon with-tab fallback-applied")}),e&&e!==r||(e=n.fallback.shift()),e.indexOf("@2x")>0&&n.fallback.unshift(e.replace("@2x","")),n.src=e};h(),o.$observe("large",function(e){d=n.$eval(e),d?i.addClass("large"):i.removeClass("large"),h()})}else if(n.content.isExternalResource&&n.content.isExternalResource()){var v=n.content.$getThumbnailUrl();v&&(n.imgLoadedAsync=v),n.src=a+n.content.getExternalResourceDefaultImage()}else e.error("Media type is undefined!",n.content)}}}}]),angular.module("Realize.content.viewProgress",["Realize.paths"]).service("ViewProgressService",["$q","$http","$log","PATH",function(e,t,n,r){"use strict";this.getProgressReport=function(s,a,i,o){var l=r.REST+"/v2/classes/"+s+"/assignments/"+a+"/results";return i&&o&&(l=r.REST+"/v2/classes/"+s+"/assignments/"+a+"/students/"+o+"/results"),t.get(l).then(function(e){var t=e.data;return n.log("get assignment progress success",e),t},function(t){return n.log("get assignment progress failed",t),e.reject(t)})}}]),angular.module("Realize.discuss.constants",[]).constant("DISCUSS_CONSTANTS",{TYPE_FILE:"file",TYPE_LINK:"link",TYPE_ONEDRIVE:"oneDrive",ANALYTICS:{ATTACH_FILE:"Attach a file",ATTACH_GOOGLE_DRIVE_LINK:"Attach Google Drive link",ATTACH_ONE_DRIVE_LINK:"Attach One Drive link",ASSIGNMENT:"Assignments",CLASSES:"Classes",DISCUSS:"Discuss",DOWNLOAD_ATTACHED_FILE:"Download attachment",DOWNLOAD_ATTACHED_GOOGLE_LINK:"Download Google Link",DISCUSS_THREAD:"Discussion thread",EDIT_COMMENT:"Edit comment",HIDE_COMMENT:"Hide comment",POST_COMMENT:"Post a comment",REMOVE_COMMENT:"Remove comment",REVIEW_DISCUSSION:"View Student Status - Review Discussion Change student",POST_DISCUSSION_COMMENT:"Post discussion comment"},EVENT_TYPE:{ATTACH:"Attach",ATTACHMENT:"Attachment",GOOGLE_DRIVE_FILE:"Google Drive File",ONE_DRIVE_FILE:"One Drive File",POST_MY_COMMENT:"Post my comment",UPDATE_COMMENT:"Update a comment",UPDATE_MY_COMMENT:"Update my comment",PROGRAM_NOT_AVAILABLE:"Program Not Available"}}),angular.module("Realize.Discussions",["DiscussApp","FileUpload.ChooseButton","Realize.Attach.attachmentModalUtilService","Realize.common.browserInfoService","Realize.common.tokenInterceptor","Realize.common.tokenRecovery","Realize.constants.fileUploadErrorResponse","Realize.Discussions.Helpers","Realize.Discussions.StateManager","Realize.Discussions.Token"]).constant("DISCUSS_APP_MESSAGE_LOCATION",window.mediaPath+"/js/discuss/locale/realize_discuss").constant("DISCUSS_INTEGRATION_MESSAGE_LOCATION",window.mediaPath+"/js/discuss/locale/realize_messages").config(["DiscussRestAPIBasePathProvider","CommonTokenInterceptorProvider","CommonTokenRecoveryProvider","DiscussLocaleProvider","rlzMessagesProvider","DISCUSS_APP_MESSAGE_LOCATION","DISCUSS_INTEGRATION_MESSAGE_LOCATION",function(e,t,n,r,s,a,i){"use strict";var o=window.discussionApiUrl;e.set(o),t.registerTokenProvider("DiscussTokenSvc"),n.registerTokenProvider("DiscussTokenSvc"),r.init(void 0,a),s.addLanguageFile(i)}]).config(["DiscussPermissionsProvider",function(e){"use strict";var t=window.currentUser,n=!0;"Student"===t.primaryOrgRole&&(n=!1);var r={create_discussion:n,hide_discussion:n,hide_comment:n,edit_comment:!0,remove_comment:!0};e.setPermissions(r)}]).config(["DiscussAttachmentOptionsProvider",function(e){"use strict";var t={attachFromComputer:!0,attachFromGoogleDrive:!0,attachFromOneDrive:!0};e.configureAttachmentButtons(t)}]).config(["DiscussModelCustomizationsProvider","DiscussThumbnailCustomizationsProvider",function(e,t){"use strict";var n=["GetClassMembers","ParticipantSvc",function(e,t){function n(e,n){return n.authorDisplayName=t.getAuthorDisplayName(n.author,e),n.displayNameForComments=t.getReplyDisplayName(n.author,e),n.customAuthorAvatarUrl=t.getAuthorAvatarImage(n.author,e),angular.isDefined(n.posts)&&angular.forEach(n.posts,function(n){n.authorDisplayName=t.getAuthorDisplayName(n.author,e),n.displayNameForComments=t.getReplyDisplayName(n.author,e),n.customAuthorAvatarUrl=t.getAuthorAvatarImage(n.author,e)}),n}return function(t,r){return e(r).then(function(e){return Array.isArray(t)||"object"!=typeof t?Array.isArray(t)?t.map(n.bind(null,e)):void 0:n(e,t)})}}];e.setServiceThatTransformsPosts(n);var r=["GetPostItem","BrowserInfo",function(e,t){return function(n){return n.meta.thumbnail||n.meta.thumbnail2x?t.isHDDisplay?n.meta.thumbnail2x?n.meta.thumbnail2x:n.meta.thumbnail:n.meta.thumbnail?n.meta.thumbnail:n.meta.thumbnail2x:e(n).then(function(e){return e.$getThumbnailUrl("",!1)},function(){return""})}}];t.setServiceThatProvidesPostThumbnails(r)}]),angular.module("RealizeDirectives").directive("addStudentModal",["$log","Modal","Messages","$location","$timeout","$route","User","$rootScope","$filter",function(e,t,n,r,s,a,i,o,l){"use strict";return{link:function(r,c,u){var d=function(n){e.log("add-student-modal CLICK",c),n.preventDefault(),n.stopPropagation();var d=r.currentRoster,m=r.$new(!0);m.isDemoUser=o.currentUser.getAttribute("isSelfRegUser"),m.className=d.className,m.student=new i({userName:m.isDemoUser?l("lwcI18n")("demo.autoGenerate.username.placeHolder"):"",firstName:"",lastName:"",primaryOrgRole:"Student",primaryOrgId:d.organizationId,organizationId:d.organizationId,userAttributes:{}}),m.$watch("existingStudent",function(e){var t;e&&(angular.isString(e)?m.student.$setLastFirst(e):angular.isObject(e)&&(e.password="password not shown",e.disableEdits=!0,m.student=e,t=s(function(){angular.forEach(m.addStudentForm.password.$error,function(e,t){m.addStudentForm.password.$setValidity(t,!0)}),angular.forEach(m.addStudentForm.userName.$error,function(e,t){m.addStudentForm.userName.$setValidity(t,!0)}),m.addStudentForm.userName.$setPristine(),m.addStudentForm.password.$setPristine()}),m.$on("$destroy",function(){s.cancel(t)})))}),m.matchTmplUrl="templates/partials/student_add_typeaheadMatch.html",m.findStudents=function(e){if(e&&e.length<3)return[];var t=e.split(","),n=t[1],r=n&&$.trim(n).length>0?$.trim(n):void 0,s=t[0],a=s&&$.trim(s).length>0?$.trim(s):void 0;return i.query({firstname:r,lastname:a,organization:d.organizationId},!0).then(function(e){return _.reject(e,function(e){return _.find(d.studentIds,function(t){return t===e.userId})})})};var g=function(){m.$destroy(),r.$eval(u.reload)&&a.reload()};m.cancel=function(){t.hideDialog(),g()},m.save=function(){if(m.addStudentForm.$invalid)return m.isInProgress=!1,void 0;if(m.student.userId)d.$addStudents(m.student.userId,function(){$.Enumerable.From(d.students).Count("$.userId == '"+m.student.userId+"'")<=0&&(m.student.userAttributes["profile.learningExperience"]=d.learningExperience,d.students.push(m.student)),r.$emit("addStudentModal.studentAdded",m.student),t.hideDialog(),g()});else{var e=function(){d.$addStudents(m.student.userId,function(){$.Enumerable.From(d.students).Count("$.userId == '"+m.student.userId+"'")<=0&&(d.students.push(m.student),d.studentIds.push(m.student.userId)),r.$emit("addStudentModal.studentAdded",m.student),m.student.userAttributes["profile.learningExperience"]=d.learningExperience,t.hideDialog(),g()})};m.student.$save().then(e,e)}},t.showDialog("templates/partials/student_add.html",m),r.$applyAsync()};r.getMessage=n.getMessage,c.on("click",d)}}}]),angular.module("RealizeApp").directive("ajaxSubmit",["$q","$log","$parse","$http","$rootScope",function(e,t,n,r,s){"use strict";return{link:function(t,r,a){var i,o=n(a.ajaxData);i=function(){var n=e.defer(),i=n.promise;return r.ajaxSubmit({url:t.$eval(a.ajaxSubmit),data:o(t),dataType:"json",type:"POST",success:function(e){s.isIE9&&e.success===!1&&t.$applyAsync(function(){n.reject(e)}),t.$applyAsync(function(){n.resolve(e)})},error:function(e){t.$applyAsync(function(){n.reject(e)})}}),i},r.on("submit",function(){(!angular.isDefined(a.ajaxValidator)||t.$eval(a.ajaxValidator))&&t.$applyAsync(function(){var e=i();t.$emit("onAjaxSubmit",e)})})}}}]),angular.module("RealizeDirectives").directive("autoFocus",["AccessibilityService",function(e){"use strict";return{priority:-2,link:function(t,n,r){var s=!1;t.$watch(r.autoFocus,function(t){s||(t!==!1&&(n[0].focus(),s=!0),e.applyStyleToFocusableElements())})}}}]),angular.module("RealizeApp").directive("adjustHeightForBar",["$log","$window",function(e,t){"use strict";return{restrict:"A",link:function(e,n,r){var s=angular.element(t),a=r.adjustHeightForBar,i=function(){var e=angular.element(a).height(),t=s.height()-e-4;n.attr("height",t)};i(),s.on("resize",i),n.on("$destroy",function(){s.off("resize",i)})}}}]),angular.module("RealizeApp").directive("blackList",[function(){"use strict";return{require:"ngModel",link:function(e,t,n,r){r.$parsers.push(function(e){var t,s,a=e;for(t=0,s=n.blackList.length;s>t;t++)a=e.replace(n.blackList[t],"");return a!==e&&(r.$setViewValue(a),r.$render()),a})}}}]),angular.module("RealizeApp").directive("ngBlur",["$log","$parse",function(e,t){"use strict";return function(e,n,r){var s=t(r.ngBlur);n.on("blur",function(t){e.$applyAsync(function(){s(e,{$event:t})})})}}]),angular.module("RealizeDirectives").directive("checkboxCustom",["$log","KEY_CODES",function(e,t){"use strict";return{require:"ngModel",template:function(e,t){var n=['<div class="customCheckbox">','<input type="checkbox" ng-hide="true" tabindex="-1">','<i tabindex="{{tabIndexVal}}" class="customCheckboxInput"','role="checkbox" aria-labelledby="',t.labelId,'" aria-checked="{{isChecked}}"></i>','<span ng-if="',void 0!==t.label,'" id="',t.labelId,'" data-e2e-id="custom-checkbox-label" class="customCheckboxLabel"','aria-checked="{{ isChecked }}">',t.label,"</span>","</div>"].join("");return n},replace:!0,scope:!0,link:function(e,n,r,s){e.isChecked=e.$eval(r.ngModel);var a,i,o=n.find("i.customCheckboxInput"),l=n.find("input"),c="mixed",u=".checkboxCustom";r.ngDisabled&&r.$observe("ngDisabled",function(t){e.$eval(t)?n.addClass("disabled"):n.removeClass("disabled")}),r.name&&l.attr("name",r.name),e.tabIndexVal=r.tabIndex?r.tabIndex:0,a=function(e){r.customIcons?o.removeClass(r.checkedIcon).removeClass(r.uncheckedIcon).removeClass(r.indeterminateIcon).addClass(e===c?r.indeterminateIcon:e?r.checkedIcon:r.uncheckedIcon):o.removeClass("icon-check-empty").removeClass("icon-check").removeClass("icon-minus-sign-alt").addClass(e===c?"icon-minus-sign-alt":e?"icon-check":"icon-check-empty")},i=function(t){t&&(t.preventDefault(),t.stopPropagation()),e.$eval(r.ngDisabled)||(e.isChecked=!s.$viewValue,s.$setViewValue(e.isChecked),a(s.$viewValue),e.$applyAsync(function(e){r.callback&&e[r.callback](r.id,s.$viewValue)}))},e.$watch(r.ngModel,function(t){a(t),e.$parent[r.ngModel]=t,t&&(s.$setViewValue(t),e.isChecked=t)}),o.on("click"+u,i),n.on("click"+u,"span.customCheckboxLabel",i),o.on("keydown"+u,function(e){e.which===t.SPACE&&(e.preventDefault(),i())}),e.$on("$destroy",function(){o.off(u),n.off("click"+u,"span.customCheckboxLabel",i)})}}}]),angular.module("realize-lib.ui.disable-auto-attrs",[]).directive("disableAutoAttrs",[function(){"use strict";return{restrict:"A",link:function(e,t){t.attr("autocomplete","off"),t.attr("autocorrect","off"),t.attr("autocapitalize","off"),t.attr("spellcheck","false")}}}]),angular.module("RealizeDirectives").directive("docPlayer",["$log","$rootScope","$http","RealizeHelpers","Messages","BrowserInfo",function(e,t,n,r,s,a){"use strict";return{scope:{pages:"=docPlayer",docType:"=",pageNum:"=page",scrollSpeed:"@",offsetX:"@",offsetY:"@"},template:['<div class="doc-preview" ng-switch="pages.length" scroll-spy="docPlayerPages" ','scroll-spy-on="[data-page]" style="overflow:auto;" tabindex="0">','<div ng-switch-when="0" class="no-document-message">{{noDocumentPreviewMessage}}</div>',"<div ng-switch-default>",'<div class="doc-preview-page" ng-repeat="page in pages">','<img alt="{{ imagePreviewMessage }}" ng-init="setPageUrl(page, $index)" ','data-page="{{ $index + 1 }}" ng-src="{{ pageUrls[$index] }}" />',"</div>","</div>","</div>"].join(""),link:function(n,i,o){var l={page:1,changed:!1};n.pageUrls=[],n.noDocumentPreviewMessage=s.getMessage("contentViewer.docPreview.noPreview"),n.imagePreviewMessage=s.getMessage("contentViewer.docPreview.imagePreviewA11y"),n.setPageUrl=function(e,r){a.isIDevice&&e.ipadUrl&&e.ipadTokenRetrievalUrl?t.currentUser.$getIpadPreview(e,function(e){n.pageUrls[r]=e}):n.pageUrls[r]=e.url},n.$on("scrollSpy.docPlayerPages",function(e,t){var s=.75*$(".doc-preview-page").height(),a=_.reject(t,function(e){return e.top>s});l.page!==a.length&&(l.page=a.length,l.changed=!0,r.updateParentScopeValue(n,o.page,a.length))}),n.$watch("pageNum",function(t,r){return e.log("pageNum watch",t,r),l.page!==t&&(t=t>n.pages.length?n.pages.length:1>t?1:t,l.page=parseInt(t,10)),angular.element("#docCurrentPage")[0].value=t,l.changed?(l.changed=!1,void 0):(angular.isDefined(n.offsetX)&&""!==n.offsetX||(n.offsetX=0),angular.isDefined(n.offsetY)&&""!==n.offsetY||(n.offsetY=0),angular.isDefined(n.scrollSpeed)&&""!==n.scrollSpeed||(n.scrollSpeed=0),n.offsetX=parseInt(n.offsetX,10),n.offsetY=parseInt(n.offsetY,10),n.scrollSpeed=parseInt(n.scrollSpeed,10),angular.isDefined(t)&&""!==t&&angular.element(".doc-preview").scrollTo("img[data-page="+t+"]",n.scrollSpeed,{offset:{left:n.offsetX,top:n.offsetY}}),void 0)})}}}]),angular.module("Realize.dragAndDrop.directives",[]).directive("dragDropList",["$log","$rootScope","KEY_CODES","Messages",function(e,t,n,r){"use strict";return{link:function(s,a,i){var o,l,c=s.$eval(i.uiSortable);s.$watch(i.ngModel,function(e){o=e},!0),s.moveItemInList=function(e,t){var n=o[e];o.splice(e,1),o.splice(t,0,n),s.$apply(s.model)},s.dragDropEnabled=c&&angular.isDefined(c.enabled)?c.enabled:!0,s.dragDropEnabled?$(a).attr("tabindex",0).attr("role","listbox").focusin(function(){e.log("$rootScope.isKeyboardInUse: "+t.isKeyboardInUse),t.isKeyboardInUse&&l()}):$(a).removeAttr("tabindex"),l=function(){e.log("== init keyboardMode"),$(a).find("a").attr("tabindex",-1),$(a).attr("aria-dropeffect","none").attr("aria-grabbed","false");var t=$(a).children(i.dragDropSelector),l=function(){var e;return angular.forEach(s.KBdragDropList.items,function(t,n){t.hasFocus&&(e=n)}),e},u=function(){var e;return angular.forEach(s.KBdragDropList.items,function(t,n){t.isSelected&&(e=n)}),e},d=function(e){var n=angular.element(t[e]).offset().top,r=angular.element(t[e]).outerHeight(!0),s=angular.element(window).height(),a=n+r-s;a>0&&angular.element(document).scrollTop(a)},m=function(e){angular.forEach(s.KBdragDropList.items,function(t,n){t.hasFocus=e===n}),t.removeClass("keyboardFocus keyboardSelected"),$.each(t,function(t){$(this).toggleClass("keyboardFocus",e===t);var n=e+1;$(a).attr("aria-label",[r.getMessage("editProgram.offscreen.dragAndDrop.position"),n,o[e].$getTitle()].join(" "))}),d(e)},g=function(e){angular.forEach(s.KBdragDropList.items,function(t,n){t.isSelected=e===n}),t.removeClass("keyboardFocus keyboardSelected"),$.each(t,function(t){$(this).toggleClass("keyboardSelected",e===t),$(a).attr("aria-grabbed","true").attr("aria-dropeffect","move")})},p=function(e){s.KBdragDropList.selectionMode=!s.KBdragDropList.selectionMode,u()===e?(s.KBdragDropList.items[e].isSelected=!1,$(a).attr("aria-grabbed","false").attr("aria-dropeffect","none"),m(e)):g(e)},f=function(e){e<s.KBdragDropList.items.length-1&&m(e+1)},h=function(e){e>0&&m(e-1)},v=function(e){e<s.KBdragDropList.items.length-1&&(s.moveItemInList(e,e+1),t=$(a).children(i.dragDropSelector),m(e+1),g(e+1))},S=function(e){e>0&&(s.moveItemInList(e,e-1),t=$(a).children(i.dragDropSelector),m(e-1),g(e-1))};angular.isUndefined(s.KBdragDropList)?(s.KBdragDropList={},s.KBdragDropList.items=[],s.KBdragDropList.selectionMode=!1,angular.forEach(o,function(){var e={};e.hasFocus=!1,e.isSelected=!1,this.push(e)},s.KBdragDropList.items),m(0)):s.KBdragDropList.selectionMode===!0?g(u()):m(l()),$(a).keydown(function(r){if(r.which===n.UP&&(r.preventDefault(),s.KBdragDropList.selectionMode?S(u()):h(l())),r.which===n.DOWN&&(r.preventDefault(),s.KBdragDropList.selectionMode?v(u()):f(l())),(r.which===n.SPACE||r.which===n.ENTER)&&(r.preventDefault(),p(l())),r.which===c.keyCode){r.preventDefault();var i=c.keyAction;i(l()),s.$apply(s.model)}$(this).focusout(function(){e.log("== keyboardMode focusout()"),$(this).unbind(r),$(a).removeAttr("aria-grabbed").removeAttr("aria-dropeffect"),t.removeClass("keyboardFocus keyboardSelected")})})}}}}]),angular.module("RealizeDirectives").directive("dropdownAddItem",["$log","TEMPLATE_PATH","Messages",function(e,t,n){"use strict";return{scope:{position:"=",isdropup:"="},templateUrl:"templates/partials/lessonAddItem.html",replace:!0,link:function(e){function t(){e.menuDirection=e.isdropup?"up":"down"}e.getMessage=n.getMessage,e.$watch("isdropup",t)}}}]).directive("dropdownA11y",["$log","KEY_CODES","$timeout","BrowserInfo",function(e,t,n,r){"use strict";return{link:function(e,s,a){function i(e){var t=e||0;u=n(function(){I()},t)}var o,l,c,u,d,m,g,p=s.next("[role=menu]"),f=".dropdownA11y",h=!1,v=function(e){var t;for(t=1;t<arguments.length;t++)if(e.which===arguments[t])return!0;return!1},S=function(){return s.is("input")&&"text"===s.attr("type")},T=function(e){e.focus(),c=e
},A=function(){s.click()},I=function(){o=p.find(":focusable"),T(o.first())},E=function(){A(),T(s)},y=function(){l=o.index(s.parent().find(":focus"));var e=0===l;e?T(o.eq(o.length-1)):T(o.eq(l-1))},R=function(){l=o.index(s.parent().find(":focus"));var e=l===o.length-1;e?T(o.eq(0)):T(o.eq(l+1))},C=function(e){var t=c.attr("ng-click")||c.parent().attr("ql-click");angular.isDefined(t)&&(r.browser.isMSIE&&r.browser.msieVersion<=9&&e.preventDefault(),c.scope().$apply(function(){c.scope().$eval(t)}),T(s))},D=e.$eval(a.ddA11yToggleOnly);d=function(n){var r=v(n,t.DOWN),a=v(n,t.SPACE,t.ENTER);a&&(S()||(n.preventDefault(),A(),i(50))),r&&(n.preventDefault(),s.parent().hasClass("open")||A(),angular.isDefined(e.loadingTools)&&e.loadingTools?e.$watch("loadingTools",function(e){e||i()}):I())};var b=function(){h||i(50)},P=function(){h=!h};s.on("mouseenter",P),s.on("mouseleave",P),s.on("click",b),s.on("keydown",d),p.find("a").attr("tabindex",-1),r.OS.isAndroid&&(m=function(e){var t=e.target||e.srcElement;T(t)},p.on("touchstart"+f,m)),g=function(e){switch(e.which){case t.ESC:e.preventDefault(),e.stopPropagation(),E();break;case t.UP:if(D)break;e.preventDefault(),y();break;case t.DOWN:if(D)break;e.preventDefault(),R();break;case t.ENTER:if(D)break;angular.isDefined(c)&&(C(e),n(function(){},0)),A()}},p.on("keydown"+f,g),e.$on("$destroy",function(){p.off(f),u&&n.cancel(u)})}}}]),angular.module("RealizeDirectives").directive("enterKeyShim",["BrowserInfo",function(e){"use strict";return{link:function(t,n){var r,s,a=8===e.browser.msieVersion,i=9===e.browser.msieVersion;(a||i)&&(r=function(e){13===e.which&&(angular.element("body").focus(),n.find('button[type="submit"]').click())},s=n.find("input"),s.on("keypress",r)),t.$on("$destroy",function(){s&&s.off("keypress",r)})}}}]),angular.module("RealizeDirectives").directive("peteFade",[function(){"use strict";return{link:function(e,t,n){e.$watch(n.peteFade,function(e){e?$(t).fadeOut("slow"):$(t).fadeIn("slow")})}}}]).directive("removeCue",["$log","$timeout",function(e,t){"use strict";return{link:function(e,n,r){var s,a,i;s=function(){var s=r.timeout||0;$(n).addClass("remove"),i=t(function(){$(n).fadeOut("slow",function(){$(this).removeClass("remove"),angular.isDefined(r.onRemoveComplete)&&(e.$eval(r.onRemoveComplete),e.$apply()),$(this).fadeIn("fast")})},s)},a=function(){t.cancel(i),$(n).removeClass("remove")},e.$watch(r.removeCue,function(e,t){e?s():t&&a()})}}}]).directive("fadeBackground",["$log","$timeout",function(e,t){"use strict";return{link:function(e,n,r){e.$eval(r.enabled)&&t(function(){$(n).animate({backgroundColor:r.fadeBackground},1e3,function(){e.$apply(e.$eval(r.onComplete))})},e.$eval(r.timeout))}}}]).directive("classCue",["$log","$timeout",function(e,t){"use strict";return{link:function(e,n,r){var s,a=function(e){if(angular.isDefined(r.classTimeout)){var s=r.classTimeout||1e3;t(function(){angular.element(n).removeClass(e)},s)}};e.$watch(r.trigger,function(t,i){if(angular.isDefined(t)&&angular.isDefined(i)){var o=e.$eval(r.classCue);o&&(angular.element(n).addClass(o),s=o),s&&s!==o&&angular.element(n).removeClass(s),a(o)}})}}}]),angular.module("RealizeApp").constant("FILE_SIZE_VALIDATOR",{MIN_FILE_SIZE:1024,MAX_FILE_SIZE:10485760}).directive("fileValidator",["$log","FILE_SIZE_VALIDATOR","FormService",function(e,t,n){"use strict";return{require:"ngModel",link:function(e,r,s,a){var i=s.minSizeLimit||t.MIN_FILE_SIZE,o=s.sizeLimit||t.MAX_FILE_SIZE,l=function(e){return n.isValidFileType(n.getExtension(e))},c=function(e){return!n.containsRestrictedChars(e)};s.fileTypeValidator&&(l=e.$eval(s.fileTypeValidator)),a.$render=angular.noop,a.$parsers.push(function(e){return a.$setValidity("isVirusFree",!0),angular.isDefined(e)&&angular.isObject(e)?(a.$setValidity("minFileSize",e.size>=i),a.$setValidity("size",e.size<=o),a.$setValidity("filetype",l(e.name)),a.$setValidity("fileName",c(e.name))):(a.$setValidity("minFileSize",!0),a.$setValidity("size",!0),a.$setValidity("filetype",angular.isString(e)?l(e):!0),a.$setValidity("fileName",angular.isString(e)?c(e):!0)),e});var u=function(){e.$applyAsync(function(){s.multiple?a.$setViewValue(r[0].files):a.$setViewValue(r[0].files?r[0].files[0]:r[0].form.file.value)})};r.on("change",u)}}}]),angular.module("RealizeApp").directive("ngFocus",["$log","$parse",function(e,t){"use strict";return function(e,n,r){var s=t(r.ngFocus);n.on("focus",function(t){e.$eval(r.timeoutApplyOnFocus)?setTimeout(function(){e.$apply(function(){s(e,{$event:t})})}):e.$apply(function(){s(e,{$event:t})})})}}]),angular.module("RealizeDirectives").directive("focusOnDropdown",["$timeout",function(e){"use strict";return{link:function(t,n,r){var s,a=r.focusOnDropdown,i=n.find(".dropdown-toggle"),o=".focusOnDropdown";i.on("click"+o,function(){s=e(function(){a&&n.hasClass("open")&&n.find(a).focus()},100)}),t.$on("$destroy",function(){i.off(o),e.cancel(s)})}}}]),angular.module("RealizeDirectives.formResetOn",[]).directive("resetOn",function(){"use strict";return{link:function(e,t,n){angular.isFunction(t[0].reset)&&e.$watch(n.resetOn,function(){e.$eval(n.resetOn)&&t[0].reset()})}}}),angular.module("RealizeDirectives.formSubmitOn",[]).directive("submitOn",function(){"use strict";return{link:function(e,t,n){if(angular.isFunction(t.submit)&&n.submitOn&&n.submitOn.length>0)var r=e.$watch(n.submitOn,function(){e.$eval(n.submitOn)&&(t.submit(),e.$eval(n.oneSubmit)&&r())})}}}),angular.module("RealizeApp").directive("gradeInputValidate",[function(){"use strict";return{require:"ngModel",link:function(e,t,n,r){r.$parsers.unshift(function(e){if(e){var t=/^\s*-?[0-9]{1,3}\s*$/;return r.$setValidity("pattern",t.test(e)),e}})}}}]),angular.module("Realize.imgUtils.imgSwap",[]).directive("imageSwap",["$log",function(e){"use strict";return function(t,n,r){function s(){n.get(0).src=i}function a(){e.error("Swap-Image Error: ",{defaultSrc:n.get(0).src,swapSrc:i})}var i;r.$observe("imageSwap",function(){if(i=r.imageSwap){var e=document.createElement("IMG");e.addEventListener("load",s),e.addEventListener("error",a),e.src=i}})}}]),angular.module("RealizeApp").directive("jsonEditor",[function(){"use strict";return{scope:{json:"=jsonEditor"},link:function(e,t){var n,r=(new Date).getTime(),s=function(){e.$apply(function(){angular.extend(e.json,n.get())})};n=new jsoneditor.JSONEditor(t[0],{mode:"form",name:"Realize Copy",change:s}),e.$watch("json",function(e){e&&0!==Object.keys(e).length&&Object.keys(e).length>0&&e.$$jsonEditor!==r&&(Object.defineProperty(e,"$$jsonEditor",{value:r}),n.set(e))},!0)}}}]),angular.module("RealizeDirectives").directive("linkPreview",["$log","$rootScope","$window","BrowserInfo",function(e,t,n,r){"use strict";return{scope:{link:"=",linkText:"@",isAdaptive:"="},replace:!0,template:['<div class="content-body link">','<div class="container new-window">','<div class="table-wrapper">','<img id="previewBox" alt="" />','<a class="details" href="{{ url }}" target="_blank">','<div class="button-wrapper">','<div class="click-text">{{ linkText }}</div>','<div class="click-button"><i class="icon-arrow-right" /></div>',"</div>","</a>","</div>","</div>","</div>"].join(""),controller:["$scope",function(e){var s,a,i,o,l,c,u,d=angular.element(n),m=$(".content-body.link"),g=$(".content-body.link .button-wrapper"),p=".linkPreview";if(e.url=e.link.$getUrl(),s=angular.element(document.createElement("img")),s.attr("id","previewBox"),a=!1,i=function(e){a||(a=!0,e?($("#previewBox").replaceWith(s),$("#pageWrap").removeClass("mediaType-link")):$("#previewBox").remove())},o=function(){i(!0)},l=function(){i(!1)},s.on("error"+p,l),s.on("load"+p,o),c=function(e){s.attr("src",e),setTimeout(function(){0===s.context.width&&i(!1)},5e3)},e.link.previews&&0!==e.link.previews.length){var f=e.link.previews[0];r.isIDevice&&f.ipadTokenRetrievalUrl&&f.ipadUrl?t.currentUser.$getIpadPreview(f,function(e){c(e)}):c(f.url)}else i(!1);u=function(){e.isAdaptive&&g.css({"margin-top":(d.height()-100)/2-77})},u(),d.on("resize",u),e.$on("$destroy",function(){s.off(p),d.off("resize",u),m.css({width:"initial"})})}]}}]),angular.module("RealizeDirectives").directive("maxlengthShim",["$log",function(e){"use strict";return{require:"ngModel",link:function(t,n,r,s){var a=n.is("[maxlength]"),i=!Modernizr.input.max,o=n.is("textarea");if(a&&i&&o){e.log("maxlength polyfilled");var l=r.maxlength,c=function(e){if(e.length>l){var t=e.substring(0,l);return s.$setViewValue(t),s.$render(),t}return e};s.$parsers.push(c)}}}}]).directive("characterCounter",[function(){"use strict";return function(e,t,n){var r=e.$eval(n.characterLimit);t.html(r),e.$watch(n.characterCounter,function(e){angular.isString(e)&&t.html(r-e.length)})}}]),angular.module("RealizeDirectives").directive("mediaPlayer",["$timeout","$window","$filter","BrowserInfo",function(e,t,n,r){"use strict";var s=t.mejs;return s.plugins.flash=[{version:[9,0,124],types:["video/mp4","video/m4v","video/mov","video/flv","video/rtmp","video/x-flv","audio/flv","audio/x-flv","audio/mp3","audio/xmp3","audio/x-mp3","audio/m4a","audio/mpeg","video/youtube","video/x-youtube"]}],{scope:{src:"@",mediaType:"@"},replace:!0,template:['<div ng-switch="mediaType">','<audio ng-switch-when="audio" ng-src="{{ srcAudio }}" type="audio/mp3" controls="controls">',"</audio>",'<video ng-switch-when="video" ng-src="{{ srcVideo }}" ></video>',"</div>"].join(""),link:function(t,s,a){t.$watch("src",function(i){if(i){t.srcVideo=n("videoSanitize")(i),t.srcAudio=i;var o=e(function(){var e={};"audio"===a.mediaType?(r.browser.isFirefox||r.browser.isMSIE)&&(e.mode="shim"):r.browser.isMSIE&&(e.mode="shim"),$(s).find(a.mediaType).mediaelementplayer(e)},100);t.$on("$destroy",function(){e.cancel(o)})}}),t.$on("$routeChangeStart",function(){$(".mejs-container .mejs-pause").click(),$("body > .me-plugin").remove()})}}}]),angular.module("RealizeDirectives").directive("supportModal",["$log","Modal","Content",function(e,t,n){"use strict";return{link:function(r,s,a){function i(){c||(c=r.$new(),c.close=t.hideDialog),c.item=l,c.publishModalItem=!1,e.log("modalScope - Support Modal",c),c.onContentClick=function(e,t){var n=r.$eval(a.onContentClick);n(e,t)},t.showDialog("templates/partials/programSupportDialog.html",c)}function o(){if(l)i();else{var t=function(t){l=t,e.log("got TS",l,m),m&&(l.associativeProps=m.associatedPropertyMap),i()};n.get({contentId:u,version:d},r.$eval(a.getLess)).then(t)}}var l,c,u=r.$eval(a.supportModal),d=0,m=r.$eval(a.tsProps);s.on("click",function(e){e.preventDefault(),e.stopPropagation(),o(),r.$applyAsync()})}}}]).directive("modalClick",["$log","Modal","Messages",function(e,t,n){"use strict";return{link:function(e,r,s){var a=null,i=angular.isUndefined(s.isGroupedContent)?!1:e.$eval(s.isGroupedContent);r.on("click",function(r){e.$eval(s.onDisable)||(r.preventDefault(),r.stopPropagation(),i?a=e:(a=e.$new(!0),a.item=e.$eval(s.modalClick),a.params=e.$eval(s.params),a.getMessage=n.getMessage,a.currentUser=e.currentUser),a.close=function(){t.hideDialog(),i||a.$destroy()},t.showDialog(s.modalTemplate,a),a.isClose=!1,e.$apply())})}}}]),angular.module("RealizeDirectives").directive("peteMore",["$log","$timeout",function(e,t){"use strict";return{template:['<ul class="quicklinks moreOrLess">','<li class="no-margin">','<a href="javascript://" ng-click="toggleMore($event)" aria-expanded="{{more}}">',"<span>{{ text }}</span></a>","</li>","</ul>"].join(""),replace:!0,scope:{more:"=",moreText:"@moreText",lessText:"@lessText",onToggle:"&"},controller:["$scope","$attrs",function(e,n){e.text=e.moreText,e.icon="caret-down";var r=$(".modalRegion").has(".modal").length?!0:!1,s=$(".modalRegion .modal");e.$watch("more",function(t){t===!0&&(e.text=e.lessText,e.$parent.$eval(n.onMore)),t===!1&&(e.text=e.moreText,e.$parent.$eval(n.onLess))}),e.toggleMore=function(n){n.preventDefault(),n.stopPropagation(),r&&s.removeClass("drop-shadow"),e.more=!e.more,r&&t(function(){s.addClass("drop-shadow")},5),e.onToggle({$event:n,toggle:e.more})}}]}}]),angular.module("RealizeDirectives").directive("openEdFrame",["$sce",function(e){"use strict";return{replace:!0,scope:{item:"="},template:'<iframe class="openEdFrame" ng-src="{{ trustedUrl }}" width="100%" frameBorder="0"></iframe>',link:function(t){t.$watch("item",function(n){n&&(t.trustedUrl=e.trustAsResourceUrl(t.item.url))})}}}]),angular.module("RealizeApp").directive("passwordField",["$log","$browser","$sniffer","KEY_CODES",function(e,t,n,r){"use strict";function s(e){return angular.isUndefined(e)||""===e||null===e}return{require:"ngModel",restrict:"EA",template:["<div>",'<input type="text" autocorrect="off" autocapitalize="off" />','<input type="password" />',"</div>"].join(""),replace:!0,compile:function(e,a){return e.find("input").each(function(e,t){a.ngDisabled&&$(t).attr("ng-disabled",a.ngDisabled),a.ngClass&&$(t).attr("ng-class",a.ngClass),a.focus&&$(t).attr("auto-focus",""),a.maxlength&&$(t).attr("maxlength",a.maxlength)}),e.find('input[type="text"]').each(function(e,t){a.passwordFieldId&&$(t).attr("id",a.passwordFieldId)}),e.find('input[type="password"]').each(function(e,t){a.passwordFieldId&&$(t).attr("id","passwordIndex-"+a.passwordFieldId)}),function(e,a,i,o){var l,c,u,d=a.children(),m=d.eq(0),g=d.eq(1),p=".passwordField";l=function(t){var n=t.target,r=angular.element(n).val();o.$viewValue!==r&&e.$applyAsync(function(){o.$setViewValue(r),o.$render()})},n.hasEvent("input")?(m.on("input"+p,l),g.on("input"+p,l)):(u=function(e){var n=e.keyCode;n===r.CMD_LEFT||r.SHIFT<=n&&n<=r.ALT||r.LEFT<=n&&n<=r.DOWN||c||(c=t.defer(function(){l(e),c=null}))},m.on("keydown"+p,u),g.on("keydown"+p,u),m.on("change"+p,l),g.on("change"+p,l)),o.$render=function(){m.val(s(o.$viewValue)?"":o.$viewValue),g.val(s(o.$viewValue)?"":o.$viewValue)},e.$watch(i.toggle,function(e){e===!0?(m.css("display","none"),g.css("display","block")):(m.css("display","block"),g.css("display","none"))}),e.$on("$destroy",function(){m.off(p),g.off(p)})}}}}]),angular.module("RealizeDirectives").directive("placeholderShim",["$log","BrowserInfo",function(e,t){"use strict";return{link:function(n,r,s){if(Modernizr.input.placeholder||($(r).attr("placeholder",s.placeholder),$(r).placeholder()),t.browser.isMSIE){e.log("IE10/IE11 placeholder detected");var a=r.context.form.name,i=r.context.name,o=!1;if(a&&i)var l=a+"."+i,c=n.$watch(l,function(t){if(e.log("fieldWatch fired"),t)var r=n.$watch(l+".$dirty",function(t){e.log("dirtyWatch fired"),t&&!o&&(o=!0,n.$eval(a).$setPristine(),r(),c())})})}}}}]).directive("placeholderBinding",["$log","$filter",function(e,t){"use strict";return function(e,n,r){e.$watch(r.placeholderBinding,function(e){e&&r.ellipses&&(e=t("ellipses")(e,r.ellipses)),$(n).text(e||r.placeholder)})}}]),angular.module("RealizeDirectives").directive("reaPopover",function(){"use strict";return{link:function(e,t,n){$(n.target).click(function(){var e=$(t).css("display");$("*[rea-popover]").fadeOut("fast"),"none"===e?$(t).fadeIn("fast"):$(t).fadeOut("fast")})}}}),angular.module("RealizeDirectives").directive("reaPosition",["$log","$timeout",function(e,t){"use strict";return{link:function(e,n,r){var s=function(){var e={},s=["my","at","of","collision"];angular.forEach(s,function(t){angular.isDefined(r[t])&&(e[t]=r[t])}),t(function(){$(n).position(e)})};e.$watch(r.reaPosition,function(e){e&&s()}),s()}}}]).directive("hasFixedElements",[function(){"use strict";return function(e,t){Modernizr.touch&&e.$on("$viewContentLoaded",function(){var n=angular.element("input"),r=".hasFixedElements";n.on("focus"+r,function(){t.addClass("fixfixed")}),n.on("blur"+r,function(){t.removeClass("fixfixed")}),e.$on("$destroy",function(){n.off(r)})})}}]),angular.module("RealizeDirectives").directive("programFilterBar",["$log","$rootScope",function(e,t){"use strict";return{replace:!0,templateUrl:"templates/partials/programFilterBar.html",controller:["$scope",function(e){e.tocView=t.currentUser.getAttribute("programs.tocView")||"thumbnail",e.changeTocView=function(n){t.currentUser.setAttribute("programs.tocView",n),e.tocView=n}}]}}]).directive("programContent",["$log","$route","$location","$rootScope","$currentUser","AlertService","Content","$timeout","webStorage","TEACHER_RESOURCES_DRAWER","MEDIA_TYPE","rubricEventTracking","telemetryUtilitiesService","AssignmentUtil","ProgramService","$filter","assessmentEventTrackingService","ASSESSMENT_EVENT_TRACKING_CONSTANTS","Assessment","TELEMETRY_CONSTANTS","addToPlaylistService","PLAYLIST_CONSTANTS","playlistTelemetryService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E){"use strict";return{replace:!0,templateUrl:"templates/views/program.html",controller:["$scope",function(e){e.alertDetails=a.alerts[0],e.alertIsSet=a.alertIsSet(),e.contentItemTemplate="templates/partials/programContentItem.html";var t=c+e.currentUser.userId,s=o(function(){var n=l.get(t),r=e.content,s=r&&!_.isEmpty(r.contentItems),a=r&&!_.isEmpty(r.associatedTeacherSupport)&&!_.isEmpty(r.associatedTeacherSupport.contentItems);n&&s&&a&&(e.sidebarOpen=n)}),y=l.get("originalItemId");if(l.remove("originalItemId"),y){var R=f("filter")(e.content.contentItems,function(e){return e.id===y});if(R&&R.length>0){var C=R[0],D=!1;i.getCustomisedVersions(C,D).then(function(t){t&&t.length>0&&(e.content.contentItems=p.addCustomisedItemstoList(t,C.id,e.content.contentItems))})}}e.$watch("sidebarOpen",function(e){angular.isDefined(e)&&l.add(t,e)}),e.$on("assignmentModal.alert.toggle",function(t,n){n.show?(e.alertDetails=a.alerts[0],e.alertIsSet=a.alertIsSet()):e.alertIsSet=!1}),e.open=function(e,t){e&&(e.preventDefault(),e.stopPropagation()),t=t.$getDefaultVersion();var s=n.path(),a="content";"Lesson"===t.mediaType&&(a="lesson"),"Tier"===t.mediaType&&(a=n.path().indexOf("tier")<0?"tier":"tier2"),"Center"===t.mediaType&&(a="center"),"Adaptive Homework"===t.mediaType&&(a="adaptivehomework"),t.mediaType===u.DISCUSSION_PROMPT&&(a="discussionprompt"),s=t.$isNbcItem()?["/nbclearn/video",t.id,t.version].join("/"):[s,a,t.id,t.version].join("/"),t.isRubricViewSelected?(n.path(s).search("rubric","true"),b(t)):n.path(s),r.openedItem={associativeProps:t.associativeProps,id:t.id}},e.hasRemediation=function(e){return e&&e.$hasRemediation()},e.viewRemediation=function(t,r){var s;r.stopPropagation(),s=i.getRoute(t,e.program)+"/remediation",n.path(s)},e.showRubric=function(t,r){r&&r.stopPropagation(),b(t),n.path(i.getRoute(t,e.program)).search("rubric","true")};var b=function(t){e.productName?d.clickOnRubricQuickLink(!1,e.productName,t.externalId,t.title):g.getProgramHierarchy(t,t.id).then(function(n){e.productName=m.getProgramTitle(n),d.clickOnRubricQuickLink(!1,e.productName,t.externalId,t.title)})};e.hiddenContentFilter=function(t){return i.isHiddenViaCustomize(t)||t.originalItem&&i.isHiddenViaCustomize(t.originalItem)||e.currentUser.isStudent&&t.hideFromStudent?!1:!0},e.hideCentersFromStudent=function(t){return e.currentUser.isStudent&&"Center"===t.mediaType?!1:!0},e.openMyContent=function(){n.path(i.getRoute(e.program)+"/myContent")},e.myContentItemCount="X",e.openLessonEdit=function(e,t){t.stopPropagation(),r.addItemSearchResults=!1;var s=n.path(),a=e.$getDefaultVersion();n.path([s,"lesson",a.id,a.version,"edit"].join("/"))},e.activateAddToPlaylistModal=function(t,n){t.stopPropagation();var r={contentIdList:[n.id],cssClass:I.CSS_CLASS.BROWSE_ALL,contentTitle:n.title,closeAction:function(){t.currentTarget.querySelector("a").focus()}};A.invokeDefaultFlow(r),E.onAddToPlaylistLessonQuicklink(e.program.title)},e.hasTierAndLesson=function(e){return e.$isLesson()||e.isTier()},e.canUserEditAssessment=e.currentUser.hasRole("ROLE_TEACHER"),e.inCentersTab=n.path().indexOf("centers")>=0,e.getVersionInProgress=!1;var P=function(t,n){S.getCustomizedVersionCount(t.id).then(function(r){var s={id:n?v.CLOSE:v.OPEN,area:T.EVENT_TYPE.PROGRAMS,page:"list"===e.tocView?T.EVENT_TYPE.TABLE_OF_CONTENTS:T.EVENT_TYPE.TABLE_OF_CONTENTS_THUMBNAIL_VIEW,product:e.program.title,name:v.NAME.ASSESSMENT_VERSIONS_BUTTON,description:t.$getTitle(),value:r};h.sendTelemetryEvents(s)})};e.viewCustomisedVersions=function(t,n){var r=angular.element(n.currentTarget.parentNode.parentNode);if(r.hasClass("quick-list-dropdown-trigger")&&r.find(".dropdown-toggle")[0].click(),n.stopPropagation(),!e.getVersionInProgress)if(t.showCustomisedVersions){e.getVersionInProgress=!0,e.content.contentItems=p.removeCustomisedItemsfromList(t,e.content.contentItems),e.getVersionInProgress=!1;var s=!0;P(t,s)}else e.getVersionInProgress=!0,i.getCustomisedVersions(t,!1).then(function(n){if(e.getVersionInProgress=!1,n&&n.length>0){e.content.contentItems=p.addCustomisedItemstoList(n,t.id,e.content.contentItems);var r=!1;P(t,r)}})},e.$on("$destroy",function(){o.cancel(s)})}]}}]).directive("programView",function(){"use strict";return{template:"<div program-filter-bar></div><div program-content></div>"}}),angular.module("RealizeDirectives").directive("programsLanding",["$log","SHARED_THUMBNAIL_PATH","$rootScope","$location","BrowserInfo",function(e,t,n,r,s){"use strict";return{replace:!0,templateUrl:function(e,t){return t.template||"templates/views/programlist.html"},controller:["$scope",function(a){a.programs.length||(n.viewLoading=!0),a.favorites=n.currentUser.getAttribute(a.favoriteAttr)||[],a.getMessage=n.getMessage,a.thumbnailStyle=function(e){return{visibility:""===e.thumbnailLocation?"hidden":"visible"}},a.programThumb=function(e){if(""===e.thumbnailLocation)return"";var n=".png";return s.isHDDisplay&&(n="@2x"+n),t+"/"+e.thumbnailLocation+"_course"+n},a.sortBy=n.currentUser.getAttribute(a.sortByAttr)||"+gradeNumbers[0]",a.sortPrograms=function(e,t){e&&(e.stopPropagation(),e.preventDefault()),a.sortBy=a.sortBy.substr(1)===t?a.sortBy="-"===a.sortBy[0]?"+"+t:"-"+t:"+"+t,n.currentUser.setAttribute(a.sortByAttr,a.sortBy)},a.inCentersTab=r.path().indexOf("centers")>=0,a.toggleFavorite=function(t,r){t.stopPropagation(),t.preventDefault();var s,i=a.favorites.length,o=!1;for(s=0;i>s;s++)if(r.id===a.favorites[s]){a.favorites.splice(s,1),r.isFavorite="",o=!0;break}o||(a.favorites.push(r.id),r.isFavorite=!0),n.currentUser.setAttribute(a.favoriteAttr,a.favorites),e.log("Toggle favorite status for program id:",r.id),a.favorites.length<1&&a.sortBy.indexOf("isFavorite")>0&&a.sortPrograms(null,"gradeNumbers[0]")}}]}}]),angular.module("RealizeApp").directive("replaceWith",["$log","$http","$templateCache","$compile",function(e,t,n,r){"use strict";return{restrict:"EA",terminal:!0,replace:!0,compile:function(s,a){var i=a.replaceWith;return function(s,a){s.$watch(i,function(i){i&&t.get(i,{cache:n}).success(function(e){var t=angular.element("<div/>").html(e).contents();a.replaceWith(r(t)(s))}).error(function(){e.error("Failed to load template: ",i)})})}}}}]),angular.module("RealizeDirectives").directive("reportOverview",["$rootScope","$log","$location","$timeout","Modal","$window","Messages","Analytics","COLORS","ROOT_PATH","BrowserInfo","itemAnalysisUtilities",function(e,t,n,r,s,a,i,o,l,c,u,d){"use strict";function m(e){e.data&&(e.graphType=angular.element(a).width()>=980&&e.data.length<=18||angular.element(a).width()<980&&e.data.length<=11?"bar":"line")}function g(e,t,n,r){var s,a,i=e.data;if(angular.isDefined(t)&&(a=0,0<i.length)){for(s=0;s<i.length;s++)a+=i[s][t];a/=i.length,e.average=a}m(e),angular.forEach(e.data,function(e,t){this[t].x=e[n],this[t].y=e[r]},e.data)}function p(e,t,n,r){e.$applyAsync(function(){e.hoverTitle=t[n],e.hoverAssignmentDueDate=t.assignmentDueDate,e.hoverScore=t[r],e.hoverData=t,e.showGraphInfo=!0})}function f(e){e&&e.$applyAsync(function(){e.showGraphInfo=!1})}return{replace:!0,scope:{reportData:"=",filterData:"="},templateUrl:"templates/partials/report_overview_template.html",link:function(e,h,v){function S(t,r){var s=e.filterData.startDate.replace(/\//g,"-"),a=e.filterData.endDate.replace(/\//g,"-"),i=c+[n.path(),t,s,a,r].join("/"),o=n.search();return o&&(i=i+"?"+$.param(o)),i}var T,A,I,E,y,R,C,D,b,P=angular.element(a);switch(e.reportType=v.type,e.data=null,e.getMessage=i.getMessage,e.assetTitleCutoffLen=62,e.graphAreaProperties={width:700,height:220,margins:{left:50,bottom:50,right:20,top:10}},e.gotoPath=function(e){n.path(e),n.search({})},e.setAverage=function(t){e.average=t},e.$on("reportAverageUpdated",function(t,n){if(e.reportType===n.reportType){var s=n.updatedAverage;s=Math.round(100*s)/100,r(function(){e.setAverage(s)},100)}}),e.reportType){case"mastery":e.displayGraphInfo=function(t){p(e,t,"assessmentTitle","percentScore")},e.hideGraphInfo=function(){f(e)},e.goToAssignment=function(t){e.$applyAsync(function(){o.track("track.action",{category:"Data",action:"Mastery drilldown"}),d.onScoresDrilldown(t.programHierarchy,t.percentScore);var r=e.filterData.startDate.replace(/\//g,"-"),s=e.filterData.endDate.replace(/\//g,"-");n.path(n.path()+["/assignment",t.assignmentId,"recap",t.assessmentId,"student",r,s,t.index].join("/"))})},e.getAssignmentLink=function(e){return S(["assignment",e.assignmentId,"recap",e.assessmentId,"student"].join("/"),e.index)};break;case"progress":e.displayGraphInfo=function(t){p(e,t,"assignmentTitle","percentProgress")},e.hideGraphInfo=function(){f(e)},e.goToAssignment=function(t,r){e.$applyAsync(function(){o.track("track.action",{category:"Data",action:"Progress drilldown"});var s=e.filterData.startDate.replace(/\//g,"-"),a=e.filterData.endDate.replace(/\//g,"-");n.path(n.path()+["/assignment",t.assignmentId,"progress/recap",s,a,r].join("/"))})},e.getAssignmentLink=function(e,t){return S(["assignment",e.assignmentId,"progress/recap"].join("/"),t)};break;case"usage":e.displayGraphInfo=function(t){p(e,t,"assignmentTitle","minutes","timeout")},e.hideGraphInfo=function(){f(e)},e.goToAssignment=function(t,r){e.$applyAsync(function(){o.track("track.action",{category:"Data",action:"Usage drilldown"});var s=e.filterData.startDate.replace(/\//g,"-"),a=e.filterData.endDate.replace(/\//g,"-");n.path(n.path()+["/assignment",t.assignmentId,"usage/recap",s,a,r].join("/"))})},e.getAssignmentLink=function(e,t){return S(["assignment",e.assignmentId,"usage/recap"].join("/"),t)};break;case"studentAssessment":e.displayGraphInfo=function(t){p(e,t,"assessmentTitle","percentScore")},e.hideGraphInfo=function(){f(e)},e.goToAssignment=function(t,r){e.$applyAsync(function(){o.track("track.action",{category:"Grades",action:"Mastery drilldown"});var s=e.filterData.startDate.replace(/\//g,"-"),a=e.filterData.endDate.replace(/\//g,"-");n.path([n.path(),"assignment",t.assignmentId,"assessments",t.assessmentSessionId,s,a,r].join("/"))})},e.getAssignmentLink=function(e,t){return S(["assignment",e.assignmentId,"assessments",e.assessmentSessionId].join("/"),t)},T="masterable",A=[!0,!1],I={"false":{fillType:"striped",strokeColor:l.BLUE_DARK,strokeWidth:3}},E={"false":{type:"mastery",stroke:"10,5"}},u.browser.isIE&&8===u.browser.version&&(E["false"].stroke="-");break;case"studentProgress":e.goToStudentProgressDetail=function(t){e.$applyAsync(function(){if(0===t.numberOfItemsInCategory)s.simpleDialog("grades.overview.progress.zeroStateModal.title","grades.overview.progress.zeroStateModal.content",null,{id:"studentProgressZeroCountModal"});else{var r={assignmentsCompletedOnTime:"Completed On Time",assignmentsCompletedPastDue:"Completed Past Due",assignmentsInProgress:"In Progress",assignmentsNotStarted:"Not Started"};o.track("track.action",{category:"Grades",action:"Progress drilldown",label:r[t.categoryName]});var a=e.filterData.startDate.replace(/\//g,"-"),i=e.filterData.endDate.replace(/\//g,"-");n.path([n.path(),"assignments","status",t.categoryName,a,i].join("/"))}})},e.getAssignmentLink=function(e,t){return S(["assignment",e.assignmentId,"assessments",e.assessmentSessionId].join("/"),t)},T="categoryName",A=["assignmentsCompletedOnTime","assignmentsCompletedPastDue","assignmentsInProgress","assignmentsNotStarted"],I={assignmentsCompletedOnTime:{fillType:"completed",strokeColor:l.GREEN,strokeColorOnHover:l.GREEN_DARK},assignmentsCompletedPastDue:{fillType:"completed",strokeColor:l.GREEN,strokeColorOnHover:l.GREEN_DARK},assignmentsNotStarted:{fillType:"notStarted",strokeColor:l.RED_DARK,strokeColorOnHover:l.RED_DARKER},assignmentsInProgress:{fillType:"inProgress",strokeColor:l.BLUE,strokeColorOnHover:l.BLUE_DARKEST}}}y=function(e){return e>=80?["score-high",l.BLUE_LIGHT]:e>=60?["score-mid",l.YELLOW_LIGHT]:["score-low",l.RED_LIGHT]},R=function(){var t=[];switch(e.average=0,e.reportType){case"mastery":e.data=e.reportData.mastery,e.data&&e.data.length>0&&(angular.forEach(e.data,function(e){var t=y(e.percentScore);e.pointClass=t[0],e.pointHover=t[1],e.pointStroke=e.pointHover,e.label=e.assignmentTitle}),g(e,"percentScore","assignmentDueDate","percentScore"));break;case"progress":e.data=e.reportData.progress,e.data&&e.data.length>0&&(angular.forEach(e.data,function(e){var t=y(e.percentProgress);e.pointClass=t[0],e.pointHover=t[1],e.pointStroke=e.pointHover,e.label=e.assignmentTitle}),g(e,"percentProgress","assignmentDueDate","percentProgress"));break;case"usage":var n,r,s=e.reportData.usage,a=180,i=5;e.data=s,s&&s.length>0&&(angular.forEach(e.data,function(e){e.label=e.assignmentTitle,e.minutes=e.averageUse/6e4,e.minutes<0&&(e.minutes=0),e.timeout&&(e.pointClass="timeout")}),r=_.pluck(s,"minutes"),n=_.max(r),e.maxY=n>a?a:n>i?n:i,g(e,"minutes","assignmentDueDate","minutes"));break;case"studentAssessment":e.data=e.reportData.studentAssessment,e.data&&e.data.length>0&&g(e,"percentScore","assignmentDueDate","percentScore");break;case"studentProgress":angular.isObject(e.reportData.studentProgress)&&(e.data=[],angular.forEach(e.reportData.studentProgress,function(t,n){var r={};r.numberOfItemsInCategory=t,r.categoryName=n,r.categoryLocaleKey="grades.overview.progress.categoryNames."+n,e.data.push(r)}),g(e,null,"categoryLocaleKey","numberOfItemsInCategory"),e.average=e.reportData.studentProgress.assignmentsCompletedOnTime+e.reportData.studentProgress.assignmentsCompletedPastDue)}var o=angular.isDefined(T);angular.isDefined(T)&&angular.isObject(E)?angular.forEach(A,function(n){var r={value:n,key:T,data:[]};r.data=$.Enumerable.From(e.data).Where(function(e){return e[T]===n}).ToArray(),0!==r.data.length&&(t.push(r),r.lineGraphDisplayProperties=E[n])}):t[0]={data:e.data},e.dataBuckets=t,angular.forEach(e.data,function(e){e.displayProperties=o&&angular.isObject(I)&&angular.isObject(I[e[T]])?I[e[T]]:{}}),"usage"!==e.reportType&&"studentProgress"!==e.reportType?e.setAverage(e.average):0===e.average&&"studentProgress"!==e.reportType&&(e.average="00:00")},R(),C=function(){e.filterData&&(e.startDate=e.filterData.startDate,e.endDate=e.filterData.endDate)},e.$watch("filterData.startDate + filterData.endDate",function(){C()}),e.$watch("reportData['"+e.reportType+"']",function(){R()}),D={lastComparison:null,target:980},b=function(n){var r=$(n.target).width()>D.target?"resize-greater":"resize-lesser";if(r!==D.lastComparison){D.lastComparison=r,D.lastType=e.graphType;var s="resize-lesser"===D.lastComparison?450:700;u.isIDevice&&f(e),e.$applyAsync(function(){m(e)}),e.$broadcast("graph-resized",{width:s}),t.debug("graph resized graphWidth = "+s+", graphType = "+e.graphType)}},P.on("resize",b),e.$on("$destroy",function(){P.off("resize",b)})}}}]),angular.module("RealizeDirectives").directive("resetPasswordModal",["$log","Modal","TEMPLATE_PATH","$rootScope","User",function(e,t,n,r,s){"use strict";return{link:function(n,a,i){var o=function(a){a.preventDefault(),a.stopPropagation();var o=n.$new(!0),l=i.resetType,c=r.currentUser,u=n.$eval(i.onSuccess),d=function(){o.$destroy()},m=function(e){t.hideDialog(),u(e),d()},g=function(t){e.log(t),o.resetPassword.currentPassword.$setValidity("password",!1),o.isInProgress=!1};angular.isDefined(u)&&angular.isFunction(u)||(u=angular.noop),o.isResetStudent="student"===l,o.forgotPasswordUrl=window.forgotPasswordUrl+"?service="+window.location,o.isResetStudent?(o.editUser=n.$eval(i.student),o.editUser||e.error("Cannot find student",i.student)):o.editUser=c,o.cancel=function(){t.hideDialog(),d()},o.isResetDisabled=function(e){return e.$pristine||e.$invalid||o.isInProgress},o.save=function(){if(o.isInProgress=!0,o.resetPassword.$invalid)return o.isInProgress=!1,void 0;
if(o.isResetStudent){var t=o.editUser,n=t.userId;n?s.updatePasswordForUser(t,o.currentPassword,o.password).then(function(){m(n)},g):e.error("Failed to reset password for student",t)}else s.updatePasswordForUser(c,o.currentPassword,o.password).then(m,g)},t.showDialog("templates/partials/reset_password.html",o),n.$applyAsync()};a.on("click",o)}}}]),angular.module("RealizeDirectives").directive("responsiveTable",["$log","$timeout",function(e,t){"use strict";return{link:function(e,n,r){function s(){var t=n.width(),s=0,a=e.$parent[r.reportTo],i=n.find(r.responsiveColumns),o=!0;angular.isDefined(r.evenlySpaced)&&(o=r.evenlySpaced),r.siblings&&n.find(r.siblings).each(function(e,n){var r=angular.element(n);r.is(":visible")&&"none"!==r.css("display")&&(t-=r.outerWidth())}),i.each(function(){var e=angular.element(this);e.html($("<div/>").css("overflow-x","auto").append(e.html()))});var l=$.makeArray(i.children("div"));if(o){var c=_.reduce(l,function(e,t){var n=angular.element(t).width();return n>e?n:e},0);i.each(function(){angular.element(this).width(c)}),l=$.makeArray(i.children("div"))}for(;t>0&&l.length;){var u=l.shift(),d=angular.element(u).width();t-=u.scrollWidth,angular.element(u).parent().width(Math.max(u.scrollWidth,d)),t>0&&s++}a>s&&s>0&&(e.$parent[r.reportTo]=s),i.each(function(){var e=angular.element(this);e.html(e.children("div").html())})}var a=!1,i=e.$eval(r.reportTo);t(function(){s(),a=!0}),r.watch&&e.$watchCollection(r.watch,function(n,o){a&&n!==o&&(e.$parent[r.reportTo]=i,t(s))})}}}]),angular.module("RealizeDirectives").directive("responsiveTitle",["$log","$window","$filter",function(e,t,n){"use strict";return{scope:{title:"@responsiveTitle"},link:function(e,r,s){var a=parseInt(s.characterLimit,10)||75,i=(parseInt(s.responsiveLowerLimit,10)||45,parseInt(s.responsiveUpperLimit,10)||60),o=i,l=Math.floor(o/2);e.$watch("title",function(){if(angular.element(t).width()>979)r.html(n("ellipses")(e.title,a));else{var s=e.title,i=s.lastIndexOf(" ",l);r.attr("title",s),s=n("ellipses")(s,o),r.prepend(s.substr(0,i)),r.append('<div class="title-overflow" />').append(s.substr(i))}})}}}]).directive("textClamp",["$log","$window",function(e,t){"use strict";function n(e,n){return t.getComputedStyle||(t.getComputedStyle=function(e){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return"float"===t&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(e,t,n){return n.toUpperCase()})),e.currentStyle&&e.currentStyle[t]?e.currentStyle[t]:null},this}),t.getComputedStyle(e,null).getPropertyValue(n)}function r(e){var t=n(e,"line-height");return"normal"===t&&(t=1.2*parseInt(n(e,"font-size"),10)),parseInt(t,10)}function s(e,t){var n=t||e.clientHeight,s=r(e);return Math.max(Math.floor(n/s),0)}function a(e,t){var n=r(e);return n*t}function i(e,t){function n(e){if(3===e.nodeType)(t||!s.test(e.nodeValue))&&r.push(e);else{var a,i;for(a=0,i=e.childNodes.length;i>a;++a)n(e.childNodes[a])}}var r=[],s=/^\s*$/;return n(e),r}function o(e){return e.nodeValue.length&&e.nodeValue.length>0?(e.nodeValue=e.nodeValue.substr(0,e.nodeValue.length-1),e.nodeValue):!1}function l(t){var n=i(t),r=n.map(function(e){return e.nodeValue}),s=$(document.body).append('<div id="temp_clamp_div" style="postion:absolute;visibility:hidden;width:'+t.clientWidth+'px;"></div>');$("#temp_clamp_div").text(r.join());var a=$("#temp_clamp_div").height();return e.log("temp",a,s),$("#temp_clamp_div").remove(),a}function c(t,n){var r=i(t),s=l(t);if(s>n){if(0===r.length)return e.log("out of text nodes"),void 0;var a=r[r.length-1];if(o(a))e.log("chopping");else{if(!(l(t)>n&&i(t).length>0))return e.log("done"),void 0;e.log("keep chopping!"),a.parentNode!==t&&a.parentNode.removeChild(a)}c(t,n)}else e.log("fits")}return{priority:-1,link:function(t,n,r){function i(){"auto"===o?o=s(n[0]):l&&(o=s(n[0],parseInt(o,10)));var t=a(n[0],o);e.log("textClamp height",t,n[0].clientHeight),t<=n[0].clientHeight&&c(n[0],t)}var o=r.textClamp,l=o.indexOf&&(o.indexOf("px")>-1||o.indexOf("em")>-1);t.$watch(r.ngBind,function(){var e=n.text();i(),r.$set("title",e)})}}}]),angular.module("RealizeDirectives").directive("scoPlayer",["$log","$window","$route","$sce","REST_PATH","CONTENT_CONSTANTS",function(e,t,n,r,s,a){"use strict";var i="2-",o=function(e){var t=s+"/v2/assignment/student/sco/"+i+e;return t},l=function(e){var t=o(e)+"/review";return t};return{scope:{sco:"=",studentAttempt:"=",review:"="},replace:!0,template:['<iframe class="flexboxIosIframeResizeFix" ng-src="{{ url }}" ','width="{{ width }}" height="{{ height }}" frameBorder="0"></iframe>'].join(""),controller:["$scope",function(n){n.$watch("sco",function(s,i){if(e.log("scoPlayer content watch",s,i),s){var c=function(){if(s.url)return s.url;var t=_.find(s.attachments,function(e){return!e.url.match(/assignment\/student\/sco/)});return t&&s.url?t.url:(e.error("Cannot find url to launch SCO",s.attachments),void 0)};n.url=n.sco.fileType===a.FILE_TYPE.TIN_CAN_SCO?n.sco.url:n.sco.mediaType===a.MEDIA_TYPE.RRSSCO?r.trustAsResourceUrl(n.sco.url):n.studentAttempt?n.review?l(n.studentAttempt):o(n.studentAttempt):c();var u=angular.element(t),d=angular.element(".content-navbar").height(),m=angular.element(".content-controlbar").height(),g=!s.renderSizeList||0===s.renderSizeList.length,p=function(){return(t.innerHeight||u.height())-d-m},f=function(){n.$applyAsync(function(){n.height=p()})};g?(n.width="100%",n.height=p(),u.on("resize",f)):(n.width=s.renderSizeList[0].width,n.height=s.renderSizeList[0].height),n.$on("$destroy",function(){u.off("resize",f)})}})}],link:function(e,t){e.$on("$destroy",function(){t.src="",t.remove()})}}}]),angular.module("RealizeDirectives").directive("scrollReset",["$timeout",function(e){"use strict";return{link:function(t,n){e(function(){n.scrollTop(1)},250)}}}]),angular.module("RealizeApp").directive("scrollSpy",[function(){"use strict";var e=0;return{link:function(t,n,r){var s=r.scrollSpy||"scrollSpy"+e++;t[s]=[],n.scroll(function(){var e;e=r.scrollSpyOn?$(this).find(r.scrollSpyOn).map(function(){return $(this).position()}).get():$(this).children().map(function(){return $(this).position()}).get(),t.$apply(function(){t[s]=e}),t.$emit("scrollSpy."+s,e)})}}}]),angular.module("RealizeDirectives").directive("scrollTo",[function(){"use strict";return{link:function(e,t,n){t.click(function(){var e=$("#"+n.scrollTo).offset().top;$("html, body").animate({scrollTop:e},500)})}}}]),angular.module("Realize.ui.scrollTopOnLoad",["duScroll"]).directive("scrollTopOnLoad",["$document","$timeout",function(e,t){"use strict";return{scope:{selector:"@scrollTopOnLoad"},link:function(n){t(function(){if(n.selector){var t=angular.element(n.selector),r=t.offset().top;e.scrollToElement(t,r)}else e.scrollTop(0)},300)}}}]),angular.module("RealizeDirectives").directive("searchInput",["$log","Messages","BrowserInfo",function(e,t,n){"use strict";return{scope:{keywords:"=?",submitFn:"&onSubmit",placeholder:"@",submitText:"@",populateKeywordsFn:"&"},replace:!0,template:['<form ng-submit="submit()" class="searchInputForm" name="searchInputForm">','<div class="searchField clearfix" ng-class="{focused: searchInputFocused}">','<label for="directiveSearchInput" class="a11yOffScreen" >{{ placeholder }}</label>','<input id="directiveSearchInput" type="text" ng-model="newKeywords" black-list="/" ','ng-focus="searchInputFocused = 1" ng-blur="searchInputFocused = 0" ','placeholder="{{ placeholder }}" placeholder-shim ','ng-click="$event.stopPropagation()" />','<button type="submit" ng-disabled="!newKeywords || searchInputForm.$pristine">','{{ submitText || ("header.search.button.text" | lwcI18n) }}',"</button>","</div>","</form>"].join(""),link:function(e,r,s){var a,i,o;angular.isFunction(e.populateKeywordsFn)&&(e.keywords=e.populateKeywordsFn()()),e.getMessage=t.getMessage,e.newKeywords=e.keywords,!n.browser.isMIE||8!==n.browser.msieVersion&&9!==n.browser.msieVersion||(a=function(e){$(this).blur().focus(),$(this).off(e)},i=function(e){angular.isFunction(a)&&(a(e),a=void 0)},o=r.find("input"),o.on("keydown mousedown",i)),angular.isDefined(e.keywords)&&e.$eval(s.bind)&&e.$watch("newKeywords",function(t){e.keywords=t}),e.$on("searchInput.clear",function(){e.newKeywords=""}),e.submit=function(){e.submitFn({keywords:e.newKeywords})},e.$on("$destroy",function(){a&&o.off("keydown mousedown",i)})}}}]),angular.module("RealizeDirectives").directive("showDatepicker",[function(){"use strict";return{scope:{highlightWeek:"@"},link:function(e,t,n){e.showHighlight=function(){var e=$("a.ui-state-active");e.length&&e.removeClass("ui-state-active").closest("tr").addClass("ui-state-active")},t.on("click",function(t){var r=angular.element(n.showDatepicker);return t.preventDefault(),t.stopPropagation(),$.datepicker._datepickerShowing&&$.datepicker._lastInput===r[0]?r.datepicker("hide"):$.datepicker._datepickerShowing&&$.datepicker._lastInput!==r[0]?($.datepicker._hideDatepicker(),r.datepicker("show")):(r.datepicker("show"),e.highlightWeek&&e.showHighlight()),!1}),e.$on("datepicker.showWeeklyHighlight",function(){e.showHighlight()})}}}]),angular.module("RealizeDirectives").directive("showErrorOnTarget",[function(){"use strict";return{scope:{target:"=",message:"=",type:"="},replace:!0,template:['<div class="show-error-target" ng-show="false">','<div alert alert-type="{{ type }}" alert-on="true">','<div class="icon-container"><i ng-class="iconClass"></i></div>','<div class="message-container"><span>{{ message }}</span></div>',"</div>","</div>"].join(""),link:function(e,t){var n=function(n,r,s){var a=$(t).find("[alert]"),i=$(t).find(".message-container > span"),o=$(t).find(".icon-container i");e.iconClass="success"===s?"icon-ok-sign":"icon-exclamation-sign",!n||e.currentTarget===n&&e.currentMessage===r||(i.html(""),i.append(r),o.removeClass().addClass(e.iconClass),a.find("div:first").removeClass("alert-error alert-success alert-").addClass("alert-"+s),n.html(""),n.append(a.clone(!0)))};e.$watch("target",function(t){n(t,e.message,e.type),e.currentTarget=t}),e.$watch("message",function(t){n(e.target,t,e.type),e.currentMessage=t}),e.$watch("type",function(t){n(e.target,e.message,t),e.currentType=t})}}}]),angular.module("RealizeDirectives").directive("showHide",[function(){"use strict";return{template:['<ul class="quicklinks student-tips-link pull-right">','<li class="no-margin">','<a href="javascript://" ng-click="toggleShow($event)">','<i class="icon-{{ icon }}"></i>',"<span>{{ text }}</span>","</a>","</li>","</ul>"].join(""),replace:!0,scope:{show:"=",hideText:"@hideText",showText:"@showText"},controller:["$scope","$attrs",function(e,t){e.text=e.hideText,e.icon="info-sign",e.$watch("show",function(n){n===!0&&(e.text=e.hideText,e.$parent.$eval(t.onShow)),n===!1&&(e.text=e.showText,e.$parent.$eval(t.onHide))}),e.toggleShow=function(t){t.preventDefault(),t.stopPropagation(),e.show=!e.show}}]}}]),angular.module("RealizeApp").directive("studentNameValidator",[function(){"use strict";return{priority:2,require:"ngModel",link:function(e,t,n,r){var s=function(e){var t=angular.isDefined(e),s=angular.isString(e),a=t?s?e:e[n.studentNameValidator]:e,i=["[\\']?","[0-9A-Za-z\\- ]+","[\\']?","(","[\\.]?","[0-9A-Za-z\\- ]+","[\\']?",")?"].join(""),o=a&&new RegExp("(^"+i+"(,\\s?)"+i+"$)").test(a);return r.$setValidity("studentName",o),e};r.$parsers.push(s),r.$formatters.push(s)}}}]),angular.module("RealizeDirectives").directive("themeModal",["$log","Modal","Messages","$location","Content","$rootScope","$window",function(e,t,n,r,s,a,i){"use strict";return{link:function(e,r,a){var o,l=null;o=function(r){r.preventDefault(),r.stopPropagation(),l=e.$new(!0),l.item=e.$eval(a.themeModal),l.mode=a.mode,l.themes=["forest","outerspace"],l.close=function(){t.hideDialog(),l.$destroy()},l.selectTheme=function(e){l.themeName=e};var o=function(e){return{subject:n.getMessage("center.themeModal.email.subject"),body:n.getMessage("center.themeModal.email.bodyPt1")+"%20'"+l.item.$getTitle()+"'%20"+n.getMessage("center.themeModal.email.bodyPt2")+"%0D%0A%0D%0A"+e+"%0D%0A%0D%0A"+n.getMessage("center.themeModal.email.bodyPt3")}};l.submit=function(e){e.preventDefault();var t=l.studentCenterData.url+"/?themeName="+l.themeName;if("launch"===l.mode)i.open(t,"_blank");else{var n=o(t);i.location.href=["mailto:?subject=",n.subject,"&body=",n.body].join("")}s.setStudentCenterData({centerId:l.item.id,themeName:l.themeName}),l.close()},s.setStudentCenterData({centerId:l.item.id}).then(function(e){l.studentCenterData=e,l.themeName=e.themeName,t.showDialog("templates/directives/themeModal.dir.html",l)}),e.$applyAsync()},r.on("click",o)}}}]),angular.module("RealizeApp").directive("typeAndSelect",["$log","$timeout","Messages","BrowserInfo",function(e,t,n,r){"use strict";return{templateUrl:"templates/partials/typeAndSelect.html",replace:!0,scope:{config:"=typeAndSelect",popupMatchTmplUrl:"=",selectedItemTmplUrl:"="},link:function(e,s,a){e.Messages=n;var i=function(){return!1},o=i,l=["top","right","bottom","left","left-top"];e.results=e.config.results,e.formText=e.config.formText,e.popoverPlacement=e.config.popoverPlacement,-1===l.indexOf(e.popoverPlacement)&&(e.popoverPlacement=l[0]),e.isAddAllEnabled=e.config.isAddAllEnabled||!1,e.formSubmitted=e.config.isFormSubmitted||i,e.customFilter=e.config.customFilter,e.preSelectedItems=e.config.preSelectedItems||[],e.hideRemoveIcon=e.config.hideRemoveIcon||o,e.customClasses=e.config.customClasses||"",e.config.searchBufferMS=angular.isNumber(e.config.searchBufferMS)?parseInt(e.config.searchBufferMS):0,e.$watch("config",function(){e.customClasses=e.config.customClasses||""},!0),e.$eval(a.inModal)&&r.OS.isIOS&&s.on("focus",".typeahead.dropdown-menu a",function(e){e&&e.target&&(e.stopPropagation(),angular.element(e.target).click())});var c=0,u=function(t,n){n.selected=!0,n.addedIndex=c++,n.hideRemoveIcon=e.hideRemoveIcon,e.keyword="",e.$emit("typeAndSelect.itemAdded",n)};e.typeaheadOnSelect=function(t,n){n&&$.inArray(n,e.results)>=0&&u(t,n)};var d;e.$on("typeaheadPopup.noMatches",function(){e.config.searchBufferMS>0?(d&&t.cancel(d),e.typeaheadFocused&&angular.isDefined(e.keyword)&&e.keyword.length>0&&(d=t(function(){e.noMatch=!0},e.config.searchBufferMS))):e.noMatch=!0}),e.$on("typeaheadPopup.hasMatches",function(){d&&t.cancel(d),e.noMatch=!1}),e.removeSelection=function(t){e.addAllClicked=!1,delete t.selected,e.$emit("typeAndSelect.itemRemoved",t)},e.availableResult=function(e){return!e.selected},e.getSelectedItems=function(){return _.filter(e.results,function(e){return e.selected===!0})},e.getAvailableItems=function(){return _.filter(e.results,function(t){return e.availableResult(t)})},e.addAllItems=function(){var t=e.getAvailableItems();_.each(t,function(e){e.selected=!0}),e.addAllClicked=!0,e.$digest()},e.disableInput=function(){return e.isAddAllEnabled&&e.addAllClicked},e.displayAddAllOption=function(){return e.isAddAllEnabled&&!e.addAllClicked&&e.getAvailableItems().length>0};var m=function(){_.each(e.preSelectedItems,function(e){e.preSelected=!0,u(void 0,e)})};angular.isArray(e.preSelectedItems)&&e.preSelectedItems.length>0?m():e.$on("typeAndSelect.selectPrePopulatedItems",function(t,n){void 0!==n&&n.length>0&&(e.preSelectedItems=n,m())})}}}]),angular.module("RealizeApp").directive("validateInputMatch",[function(){"use strict";return{require:"ngModel",link:function(e,t,n,r){if(!n.validateInputMatch)throw"validateInputMatch expects a model as an argument!";e.$watch(n.validateInputMatch,function(e){r.$viewValue&&r.$setValidity("validateInputMatch",e===r.$viewValue)}),r.$parsers.push(function(t){if(!t)return r.$setValidity("validateInputMatch",!0),t;var s=t===e.$eval(n.validateInputMatch);return r.$setValidity("validateInputMatch",s),s?t:""})}}}]),angular.module("Realize.earlyLearner.teacher.changeThemeCtrl",["Realize.paths","RealizeDataServices","rlzComponents.components.i18n","Realize.classRosterThemes.constants","Realize.ui.modal.UnsavedChangesModal","Realize.earlyLearner.teacher.earlyLearnerService","Realize.alerts.alertService","Realize.analytics"]).controller("ChangeThemeCtrl",["$rootScope","EarlyLearnerService","resolveClassRosterData","EARLY_LEARNER_CONSTANTS","UnsavedChangesModal","AlertService","lwcI18nFilter","Analytics","ClassRoster",function(e,t,n,r,s,a,i,o,l){"use strict";var c,u=this,d=function(e){var t=e&&e.userAttributes,n=r.PROFILE_KEY;return t&&t[n]===r.THEME_EARLY_LEARNER};u.selectAll=!0,u.hasUnsavedChanges=!0,u.students=n.students||[],u.students.forEach(function(e){e.themeSelected=d(e),e.themeSelected||(u.selectAll=!1)}),u.toggleAllStudents=function(){u.students.forEach(function(e){e.themeSelected=u.selectAll})},u.onSelectionChange=function(e){if(e.themeSelected)for(var t=u.students.length-1;t>=0;t--){if(!u.students[t].themeSelected)return u.selectAll=!1,void 0;u.selectAll=!0}else u.selectAll=!1},u.changeTheme=function(){var e=[],n=[];u.students.forEach(function(t){t.themeSelected?e.push(t):n.push(t)}),u.hasUnsavedChanges=!1,l.clearRostersWithStudentDetailsFromCache(),t.saveTheme(e,n).then(function(){e.forEach(function(){o.track("track.action",{category:"Classes",action:"Change Student Theme",label:"EarlyLearner"})}),n.forEach(function(){o.track("track.action",{category:"Classes",action:"Change Student Theme",label:"Standard"})}),t.goBack(),a.addAlert("success","ok-sign",i("earlyLearner.changeTheme.successMessage"))},function(){a.addAlert("error","exclamation-sign",i("earlyLearner.changeTheme.errorMessage")),u.alertDetails=a.alerts[0],u.alertIsSet=a.alertIsSet()})},u.back=function(e){u.hasUnsavedChanges=e,t.goBack()},c=new s(u.changeTheme),e.$on("$locationChangeStart",function(t){u.hasUnsavedChanges&&u.changeThemeForm&&u.changeThemeForm.$dirty&&c.showDialog(t).catch(function(){e.viewLoading=!1})})}]),angular.module("Realize.earlyLearner.teacher.config",["Realize.paths"]).config(["$routeProvider","PATH",function(e,t){"use strict";e.when("/classes/:classId/students/changeTheme",{controller:"ChangeThemeCtrl",controllerAs:"changeThemeCtrl",templateUrl:t.TEMPLATE_ROOT+"/early-learner/changeTheme.html",resolve:{hasPermission:["$q","$currentUser",function(e,t){return t.isTeacher?e.when({}):e.reject("Insufficient Privileges!")}],resolveClassRosterData:["Resolve",function(e){return e.ClassRoster()}]}})}]),angular.module("Realize.earlyLearner.teacher",["Realize.earlyLearner.teacher.config","Realize.earlyLearner.teacher.earlyLearnerService","Realize.earlyLearner.teacher.changeThemeCtrl"]),angular.module("Realize.earlyLearner.teacher.earlyLearnerService",["Realize.paths","Realize.classRosterThemes.constants"]).factory("EarlyLearnerService",["$location","$http","REST_PATH","EARLY_LEARNER_CONSTANTS",function(e,t,n,r){"use strict";var s="/changeTheme";return{gotoChangeThemePage:function(){var t=e.path().split("?")[0]+s;e.path(t)},goBack:function(){e.path(e.path().split(s)[0])},saveTheme:function(e,s){var a=function(e){return e.userId},i=e.map(a),o=s.map(a);return t.post(n+"/users/learningexperience",{earlyLearnerStudentIds:i,standardStudentIds:o}).then(function(){e.forEach(function(e){e.setAttribute(r.PROFILE_KEY,r.THEME_EARLY_LEARNER,!1)}),s.forEach(function(e){e.setAttribute(r.PROFILE_KEY,r.THEME_STANDARD,!1)})})}}}]),angular.module("Realize.heartbeat.constants",[]).constant("HEARTBEAT_CONSTANTS",{AUTH_TOKEN_URL:"/heartbeat/tokens",HEARTBEAT_KEYSTORE_KEY:"heartbeatTokenKey",HTTP_STATUS_CODE:{UNAUTHORISED:401,INTERNAL_SERVER:500}}),angular.module("Realize.heartbeat.keyStore",[]).factory("heartbeatKeyStore",function(){"use strict";var e=this,t={};return e.addHeartbeatToken=function(e,n){t[e]=n},e.getHeartbeatToken=function(e){return t[e]},e.removeHeartbeatToken=function(e){delete t[e]},e.emptyHeartbeatTokenStore=function(){t={}},e}),angular.module("Realize.heartbeat",["Realize.heartbeat.keyStore","Realize.heartbeat.constants","Realize.common.tokenInterceptor","Realize.common.tokenRecovery","Realize.heartbeat.TokenService","Realize.heartbeat.heartbeatsApiService","Realize.heartbeat.contentViewerTrackingService"]).config(["CommonTokenInterceptorProvider","CommonTokenRecoveryProvider",function(e,t){"use strict";e.registerTokenProvider("HeartbeatTokenService"),t.registerTokenProvider("HeartbeatTokenService")}]),angular.module("Realize.heartbeat.contentViewerTrackingService",["Realize.heartbeat.TokenService","Realize.content.constants"]).factory("heartbeatContentViewerService",["$log","$http","CONTENT_CONSTANTS",function(e,t,n){"use strict";var r=this,s=!1;return r.sendHeartbeatTrackingEvent=function(r,a,i,o,l,c,u){function d(e){var t=0;return _.each(e,function(n,r){var s=e.charCodeAt(r);t=(t<<5)-t+s,t&=t}),Math.abs(t)}function m(){return f={classId:r,contentId:a,contentVersion:i,assignmentId:o,userAssignmentId:c,lmsName:u},JSON.stringify({activityId:c?c:d(r+o+a+i),activityData:f})}function g(){if(l===n.CONTENT_VIEWER_ACTIVITY.STARTS)p=window.heartbeatOpenContentEventUrl;else{if(l!==n.CONTENT_VIEWER_ACTIVITY.STOPS)return e.warn("Heartbeat-Service: Ignoring unknown content viewer action",l),!1;p=window.heartbeatCloseContentEventUrl}return!0}var p,f={};if(!s||!window.isEarlyLearner)return window.heartbeatFeatureEnabled&&g()?(l===n.CONTENT_VIEWER_ACTIVITY.STOPS&&(s=!0),t({method:"POST",url:p,data:m(),headers:{"Content-Type":"application/json"}}).catch(function(t){e.error("Heartbeat-Service: content viewer tracking("+l+")call failed with error",t)})):void 0},r}]),angular.module("Realize.heartbeat.heartbeatsApiService",["Realize.heartbeat.constants","Realize.heartbeat.TokenService"]).factory("heartbeatApiService",["$http","$log","$timeout",function(e,t,n){"use strict";var r,s=this,a=window.heartbeatPulseIntervalInMillis,i=!1;return s.nextHeartbeat=function(){s.cancelPendingHeartbeat(),r=n(s.sendHeartbeatEvent,a)},s.cancelPendingHeartbeat=function(){n.cancel(r)},s.stopHeartbeats=function(){i=!0,s.cancelPendingHeartbeat()},s.sendHeartbeatEvent=function(n){if(!i){var r=n?window.heartbeatLoginEventUrl:window.heartbeatEventUrl;return e({url:r,method:"POST"}).catch(function(e){t.error("Heartbeat notification event missed",e)}).finally(function(){i||s.nextHeartbeat()})}},s}]),angular.module("Realize.heartbeat.TokenService",["Realize.paths","Realize.heartbeat.constants"]).factory("HeartbeatTokenService",["REST_PATH","$http","$log","$q","HEARTBEAT_CONSTANTS","heartbeatKeyStore","CommonTokenInterceptor",function(e,t,n,r,s,a,i){"use strict";function o(){return a.getHeartbeatToken(s.HEARTBEAT_KEYSTORE_KEY)}function l(e){a.addHeartbeatToken(s.HEARTBEAT_KEYSTORE_KEY,e)}function c(){a.removeHeartbeatToken(s.HEARTBEAT_KEYSTORE_KEY)}var u,d={};return d.shouldIntercept=function(e){return e.url.indexOf("/heartbeat/events/")>-1},d.getToken=function(){var n=o();return n?r.when(n):t({url:e+s.AUTH_TOKEN_URL,method:"GET"}).then(function(e){return u="Bearer "+e.data.access_token,l(u),u},function(e){return r.reject(e)})},d.recoverToken=function(e){return c(),d.getToken().then(function(t){return i.updateHeaderAndReturn(t,e)})},d}]),angular.module("Realize.filters.brStrip",[]).filter("brStrip",["$log",function(e){"use strict";return function(t){var n;try{n=t.replace(/<br\s*\/?\s*>/g,"")}catch(r){e.warn("the question/response text is not valid!!",t),n=t}return n}}]),angular.module("Realize.filters.capitalizeFirstWord",[]).filter("capitalizeFirstWord",function(){"use strict";return function(e){return angular.uppercase(e.charAt(0))+angular.lowercase(e.substr(1))}}),angular.module("Realize.filters.centerPrograms",[]).filter("centerPrograms",function(){"use strict";return function(e,t){var n=t===!1;return _.filter(e,function(e){return n?!0:e.$isCenterProgram()})}}),angular.module("Realize.filters.contains",[]).filter("contains",function(){"use strict";return function(e,t,n){if(!e)return!1;angular.isString(n)||(n="i");var r=new RegExp(t,n);return e.search(r)>=0}}),angular.module("Realize.filters.displayFullName",[]).filter("displayFullName",function(){"use strict";return function(e){return e?_.map(e,function(e){return e.firstName+" "+e.lastName}):""}}),angular.module("Realize.filters.ellipses",[]).filter("ellipses",function(){"use strict";return function(e,t,n){return angular.isString(e)&&t?(n||(n="..."),e.length<=t?e:e.substr(0,t)+n):e}}),angular.module("Realize.filters.excludeCurrentUser",[]).filter("excludeCurrentUser",["$rootScope",function(e){"use strict";return function(t){return t?angular.isArray(t)?_.filter(t,function(t){return t.userId!==e.currentUser.userId}):t:""}}]),angular.module("Realize.filters.fileSize",[]).filter("fileSize",function(){"use strict";var e=function(e,t,n,r){e=e.toString().replace(",","").replace(" ","");var s=isFinite(+e)?+e:0,a=isFinite(+t)?Math.abs(t):0,i=r?",":r,o=n?".":n,l="",c=function(e,t){var n=Math.pow(10,t);return(Math.round(e*n)/n).toString()};if(l=(a?c(s,a):Math.round(s).toString()).split("."),l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(l[1]||"").length<a)for(l[1]=l[1]||"";l[1].length<a;)l[1]+="0";return l.join(o)};return function(t){var n;if(!t)return"N/A";var r=1073741824,s=1048576,a=1024;return n=t>=r?e(t/r,2,".","")+" GB":t>=s?e(t/s,2,".","")+" MB":t>=a?e(t/a,0)+" KB":e(t,0)+" bytes"}}),angular.module("Realize.filters.getExtension",[]).filter("getExtension",function(){"use strict";return function(e,t){if(e){var n=e.lastIndexOf("."),r=e.slice(n);return-1===n?t:r}}}),angular.module("Realize.filters.getFilename",[]).filter("getFileName",function(){"use strict";return function(e){if(!e)return"";var t,n;return t=e.split(/(\/|\\)/),e=t[t.length-1],n=e.search("_grid")>-1?e.lastIndexOf("_grid"):e.search("@2x")>-1?e.lastIndexOf("@2x"):e.lastIndexOf("."),e.substring(0,n)}}),angular.module("Realize.filters.handleEmptyResponse",[]).filter("handleEmptyResponse",function(){"use strict";return function(e){return null!==e&&0===e.length?"-":e}}),angular.module("Realize.filters.letterizeNumber",[]).filter("letterizeNumber",function(){"use strict";var e="A".charCodeAt(0);return function(t){return String.fromCharCode(e+t)}}),angular.module("Realize.filters.mediaIcon",["Realize.filters.underscores"]).filter("mediaIcon",["$filter",function(e){"use strict";return function(t){if(angular.isDefined(t)&&null!==t&&angular.isDefined(t.mediaType)&&angular.isDefined(t.fileType)){var n=angular.lowercase(t.mediaType),r=angular.lowercase(t.fileType);if("document"===n){if(r.search(/\.(doc|txt|rtf)/))return"document";if(-1!==r.indexOf("ppt"))return"slideshow";if(-1!==r.indexOf("pdf"))return"pdf"}return"Visual Learning"===t.contentType?"visual_learning":-1!==n.indexOf("remediation")?"lesson":e("underscores")(n)}}}]),angular.module("Realize.filters.nospace",[]).filter("nospace",function(){"use strict";return function(e){return angular.isString(e)?e.replace(/ /g,""):e}}),angular.module("Realize.filters.pipes",[]).filter("pipes",function(){"use strict";return function(e){return e?angular.isArray(e)?e.join(" | "):e:""}}),angular.module("Realize.filters",["Realize.filters.brStrip","Realize.filters.capitalizeFirstWord","Realize.filters.centerPrograms","Realize.filters.contains","Realize.filters.displayFullName","Realize.filters.ellipses","Realize.filters.excludeCurrentUser","Realize.filters.fileSize","Realize.filters.getExtension","Realize.filters.getFilename","Realize.filters.handleEmptyResponse","Realize.filters.letterizeNumber","Realize.filters.mediaIcon","Realize.filters.nospace","Realize.filters.pipes","Realize.filters.removeExtension","Realize.filters.replace","Realize.filters.standardNumber","Realize.filters.stripProtocol","Realize.filters.strReplace","Realize.filters.toArray","Realize.filters.trunc","Realize.filters.underscores","Realize.filters.underscoreToCamelCase"]),angular.module("Realize.filters.removeExtension",[]).filter("removeExtension",function(){"use strict";return function(e){if(e){var t=e.lastIndexOf(".");return-1===t?e:e.substring(0,t)}}}),angular.module("Realize.filters.replace",[]).filter("replace",function(){"use strict";return function(e){if(e){if(arguments.length>1){var t;for(t=1;t<arguments.length;t++)e=e.replace("%"+t,arguments[t])}return e}}}),angular.module("Realize.filters.standardNumber",[]).filter("standardNumber",[function(){"use strict";return function(e){if(e){var t=e.split("\\");return t.length&&t.length>0?t[t.length-1]:void 0}}}]),angular.module("Realize.filters.strReplace",[]).filter("strReplace",function(){"use strict";return function(e,t,n){return angular.isString(e)&&t?(n||(n=" "),e.replace(t,n)):e}}),angular.module("Realize.filters.stripProtocol",[]).filter("stripProtocol",function(){"use strict";return function(e){return angular.isString(e)?e.replace(/^\s*(https|http):/,""):e}}),angular.module("Realize.filters.toArray",[]).filter("toArray",function(){"use strict";return function(e){return _.toArray(e)}}),angular.module("Realize.filters.trunc",[]).filter("trunc",function(){"use strict";return function(e,t){return angular.isString(e)&&t?e.substr(0,t):e}}),angular.module("Realize.filters.underscoreToCamelCase",[]).filter("underscoreToCamelCase",function(){"use strict";return function(e){return angular.isString(e)?e.replace(/_([a-z])/g,function(e){return angular.uppercase(e[1])}):e}}),angular.module("Realize.filters.underscores",[]).filter("underscores",function(){"use strict";return function(e){return angular.isString(e)?e.replace(/ /g,"_"):e}}),angular.module("Realize.NbcLearn.Constants",[]).constant("NBCLEARN_ID",window.nbcLearnRssId).constant("NBC_PROGRAM_NAME","NBC Learn Video Streaming"),angular.module("Realize.NbcLearn",["Realize.content.fullscreenPlayer","Realize.content.model.contentItem","Realize.rss.RssSvc","Realize.NbcLearn.Constants","Realize.NbcLearn.browse","Realize.NbcLearn.article","Realize.NbcLearn.FeedView","Realize.NbcLearn.NbcLearnService","Realize.NbcLearn.content.content","Realize.NbcLearn.content.viewer","RealizeDataServices"]).config(["$routeProvider","REST_PATH","RssSvcProvider","NbcLearnServiceProvider",function(e,t,n,r){"use strict";var s={controller:"NbcLearnVideoPlayerCtrl",templateUrl:"templates/nbclearn/content/viewer.html",resolve:{content:["Content","$route",function(e,t){return e.get({contentId:t.current.params.contentId,version:t.current.params.contentVersion},!0,!0)}]}};n.setUrl(t+"/rss/feed/"),r.setEmbedPath(t+"/nbc/learn/embedurl"),e.when("/nbclearn/video/:contentId",s).when("/nbclearn/video/:contentId/:contentVersion",s).when("/nbclearn/classes/:classUuid/assignments/:assignmentId/video/:contentId/:contentVersion",s).when("/nbclearn/browse",{controller:"NBCLearnBrowseCtrl",controllerAs:"nbcLearnBrowseCtrl",templateUrl:"templates/nbclearn/browse/nbclearn.browse.view.html",resolve:{UserData:["$rootScope","User",function(e,t){return t.getCurrentUser()}]}}).when("/nbclearn/article/:articleId",{controller:"nbcLearnArticleCtrl",templateUrl:"templates/nbclearn/article/nbclearn.article.view.html",resolve:{NBCArticleData:["RssSvc","NBCLEARN_ID","$route","$q","NbcLearnService",function(e,t,n,r,s){var a=r.defer();return e.get(t,n.current.params.articleId).then(function(e){s.getEmbedUrl(e.link).then(function(t){a.resolve({embedUrl:t,article:e})},a.reject)},a.reject),a.promise}]}})}]),angular.module("Realize.NbcLearn.NbcLearnService",[]).provider("NbcLearnService",[function(){"use strict";var e;this.setEmbedPath=function(t){e=t},this.$get=["$log","$http",function(t,n){var r=this;return r.getEmbedUrl=function(r){var s=r.replace(/^.+cuecard=(\d+).*/,"$1");return n.get(e,{params:{id:s}}).then(function(e){var t=e.data.replace(/\"/g,"");return t},function(e){return t.error("Error retrieving URL for NBC Learn: ",e),e})},r}]}]),angular.module("Realize.prompt.constants",[]).constant("PROMPT_CONSTANTS",{ANALYTICS:{CREATE_PROMPT:"Create a prompt",CREATE_SAVE_PROMPT:"Create Prompt - Save Prompt",EDIT_SAVE_PROMPT:"Edit Prompt - Save Prompt",MY_PROMPT_LIST:"My prompt",OPEN_DISCUSSION:"Open discussion",OPEN_PROMPT:"Open prompt",REMOVE_PROMPT:"Remove prompt",SAVE_PROMPT:"Save prompt"}}),angular.module("Realize.prompts",["Realize.Prompt.Setting","Realize.Prompt.List","Realize.Prompt.StateManager","Realize.Prompt.promptApiUtilService","Realize.Active.Discussion","Realize.prompt.constants"]),angular.module("Realize.Prompt.promptApiUtilService",["Realize.paths","Realize.analytics"]).service("promptApiUtilService",["$q","$http","$log","REST_PATH","Analytics",function(e,t,n,r,s){"use strict";
var a=this,i=r+"/prompts",o={headers:{"Content-Type":"application/json"}},l=i+"/",c=angular.extend({},o);a.savePromptData=function(n,r){var s=i+"?classId="+r;return t.post(s,JSON.stringify(n),o).then(function(e){return e.data},function(t){return 404===t.status?{}:e.reject(t)})},a.getPromptList=function(n){var r=angular.extend({},o);return r.params={classId:n},t.get(i,r).then(function(e){return e.data},function(t){return 404===t.status?{}:e.reject(t)})},a.deletePrompt=function(n){var r=l+n;return t.delete(r).then(function(e){return e},function(t){return e.reject("Error deleting prompt",t)})},a.unDeletePrompt=function(e,n){var r=l+e+"/mappings",s={classId:n};return t.post(r,JSON.stringify(s),c)},a.updatePrompt=function(n,r){var s=l+n;return t.put(s,JSON.stringify(r),c).then(function(e){return e.data},function(t){return 404===t.status?{}:e.reject(t)})},a.getActiveDiscussionList=function(n){var s=angular.extend({},o),a=r+"/discussions/classes/"+n;return t.get(a,s).then(function(e){return e.data},function(t){return 404===t.status?{}:e.reject(t)})},a.analyticsForPrompt=function(e){s.track("track.action",{category:"Classes",action:"Discuss",label:e})}}]),angular.module("Realize.Prompt.StateManager",["Realize.paths","Realize.Prompt.promptApiUtilService","Realize.content.model.contentItem"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n=["$q",function(e){return e.when({})}],r={controller:"PromptCtrl",controllerAs:"promptCtrl",templateUrl:t.TEMPLATE_ROOT+"/prompt/prompt.dir.html",resolve:{ClassRosterData:["Resolve",function(e){return e.ClassRoster()}],CurrentPromptList:["promptApiUtilService","$route","$currentUser",function(e,t,n){return n.isTeacher?e.getPromptList(t.current.params.classId):null}],GetActiveDiscussionList:["promptApiUtilService","$route",function(e,t){return e.getActiveDiscussionList(t.current.params.classId)}],_security:n},reloadOnSearch:!1};e.when("/classes/:classId/discussPrompt",r)}]).controller("PromptCtrl",["$scope","CurrentPromptList","GetActiveDiscussionList","Content","$location","promptApiUtilService","$route","$rootScope","$currentUser",function(e,t,n,r,s,a,i,o,l){"use strict";e.promptList=[],e.activeList=[],e.currentView="active";var c=s.search();_.isEmpty(t)||(e.currentView="list",e.promptList=_.map(t,function(e){return new r(e)})),_.isEmpty(n)?_.isEmpty(n)&&l.isStudent?(e.currentView="active",e.studentZeroDiscussionState=!0):(e.currentView="active",e.zeroDiscussionState=!0):(e.currentView="active",e.activeList=n,e.zeroDiscussionState=!1),e.$on("prompt.view.change.zeroState",function(){e.promptList.length||(e.currentView="list",e.showZeroState=!0)}),"list"===c.discuss||"myPrompts"===c.activeTab&&!c.promptView?(e.currentView="list",e.$emit("prompt.view.change.zeroState"),s.search("discuss",null),o.isZeroState=!1):"create"===c.promptView&&(e.currentView="create"),e.getPromptView=function(t){return e.currentView===t},e.showDiscussion=function(){return!e.zeroDiscussionState&&!e.studentZeroDiscussionState},e.$on("prompt.view.change",function(t,n){e.prompt={},"list"===n?(o.viewLoading=!0,s.search("promptView",null),a.getPromptList(i.current.params.classId).then(function(t){e.promptList=t&&t.length?_.map(t,function(e){return new r(e)}):[],"active"===e.currentView&&!e.promptList.length||"create"===e.currentView&&!e.promptList.length&&!e.activeList.length?e.$emit("prompt.view.change.zeroState"):"create"===e.currentView&&!e.promptList.length&&e.activeList.length?e.$emit("prompt.view.change.zeroState"):e.currentView=n,o.viewLoading=!1})):"active"===n?(o.viewLoading=!0,s.search("promptView",null),a.getActiveDiscussionList(i.current.params.classId).then(function(t){e.activeList=t,0!==e.activeList.length&&(e.zeroDiscussionState=!1),e.currentView=n,o.viewLoading=!1})):e.currentView=n}),e.$on("discuss.prompt.createView.change",function(t,n){e.$broadcast("prompt.createView.change",n)}),e.$on("prompt.mode.editing",function(t,n,r){e.prompt={id:n.id,title:n.title,body:n.discussionPrompt,thumbnails:n.thumbnailUrls[0]},e.currentView=r})}]),angular.module("Realize.reporting.BarGraph",["RealizeDataServices"]).directive("barGraph",["$log","Messages","$window","$rootScope","KEY_CODES","BrowserInfo",function(e,t,n,r,s,a){"use strict";var i,o,l=6048e5,c=l/7,u=5,d="#026ecb";return{replace:!0,scope:{data:"=localData",start:"=min",end:"=max",yMax:"=",whenHover:"&",whenHoverOut:"&",whenClick:"&",generateUrl:"=?"},link:function(r,l,m){r.getMessage=t.getMessage;var g,p,f,h,v,S,T;T=parseInt(r.yMax,10);var A=function(t){e.debug("bar graph set graphWidth "+t),i={height:220,padding:{bottom:50,left:64,right:20,top:10}},i.width=angular.isNumber(t)?t:angular.element(n).width()<980?450:700,o={height:i.height-i.padding.bottom-i.padding.top,width:i.width-i.padding.left-i.padding.right,bar:{width:25,gap:2,dy:4},group:{gap:5},offset:{x:5,y:10},x1:i.padding.left,y1:i.padding.top,xLabelFontSize:14,yLabelFontSize:14},i.transform="translate("+i.padding.left+", "+i.padding.top+")",o.x2=o.x1+o.width,o.y2=o.y1+o.height,o.transform="translate("+i.padding.left+", "+(i.padding.top+o.height)+") scale(1,-1)"},I=function(){l.empty(),g=d3.select(l[0]).append("svg").attr("width",i.width).attr("height",i.height).attr("class","svgGraph"),p=g.append("g").attr("transform",o.transform).attr("class","bar-group"),f=d3.scale.linear().domain([0,T]).range([0,o.height]).clamp(!0),g.append("line").attr("class","axes x").attr("x1",o.x1).attr("x2",o.x2).attr("y1",o.y2).attr("y2",o.y2),g.append("line").attr("class","axes y").attr("x1",o.x1).attr("x2",o.x1).attr("y1",o.y1).attr("y2",o.y2),g.append("text").attr("class","axis-label x").attr("text-anchor","middle").attr("x",i.width/2).attr("y",i.height-o.offset.y).attr("font-size",o.xLabelFontSize).text(m.labelX),g.append("text").attr("class","axis-label y").attr("transform",o.transform).attr("text-anchor","middle").attr("x",-i.height/2+o.offset.y).attr("y",o.offset.y).attr("transform","rotate(-90)").attr("font-size",o.yLabelFontSize).text(m.labelY);var e=d3.svg.axis().scale(d3.scale.linear().domain([0,T]).range([o.height,0])).orient("left").ticks(parseInt(m.ticks,10)||1).tickSubdivide(parseInt(m.subTicks,10)||3).tickSize(6,6,0).tickFormat(function(e){return e+m.ySuffix});g.append("g").attr("class","axes y").attr("transform",i.transform).call(e),h=function(e){v=[[],{},{}],angular.forEach(e,function(e){$.inArray(e.x,v[0])<0?(v[0].push(e.x),v[1][e.x]=1):v[1][e.x]++});var t=function(){var t=(new Date(e[0].x)-new Date(r.start))/c;return Math.max(o.offset.x,Math.min(o.offset.x*(t+1),(o.width-(e.length*(o.bar.width+o.offset.x)+v[0].length*o.group.gap))/2))}();return angular.forEach(e,function(n,r){e[r].displayAt=t,v[2][n.x]?v[2][n.x].push(t+o.bar.width/2):v[2][n.x]=[t+o.bar.width/2],t+=o.offset.x+o.bar.width,0===--v[1][n.x]&&(t+=o.group.gap)}),e},S=function(e){e=_.sortBy(e,function(e){return new Date(e.assignmentDueDate)}),l.find(".bar-group").empty(),l.find(".tickX,.ruleX").remove();var t,n=!1,c=p.selectAll("path").data(h(e)).enter(),m=function(e){r.whenHover({data:e})},S=function(){n||(r.whenHoverOut(),t&&(t=void 0))},T=function(e,s){return d3.event.preventDefault(),d3.event.stopPropagation(),!a.OS.isAndroid||t&&t===e?a.OS.isIOS&&t===e?(m(e),void 0):(n=!0,r.whenClick({data:e,index:s}),void 0):(t=e,m(e),void 0)};c=c.append("a").attr("class","bar-anchor").attr("focusable",!0).attr("role","link").attr("aria-label",function(e){return e.label}).on("keydown",function(e,t){d3.event.keyCode===s.ENTER&&T(e,t)}).on("focus",function(e){m(e)}).on("blur",function(){S()}),r.generateUrl&&c.attr("xlink:href",function(e,t){return r.generateUrl(e,t)}),r.whenClick&&c.on("click",function(e,t){T(e,t)}),c=c.append("path").attr("class",function(e){var t="bar";return angular.isString(e.pointClass)&&(t+=" "+e.pointClass),t}).attr("fill-type",function(e){return angular.isString(e.displayProperties.fillType)?e.displayProperties.fillType:"fill"}).attr("d",function(e){var t=e.displayAt,n=0,r=o.bar.width,s=0===e.y?1.5:f(e.y);return"M"+t+","+n+" L"+t+","+(n+s)+" "+(t+r)+","+(n+s)+" "+(t+r)+","+n}).attr("stroke-width",function(e){return angular.isNumber(e.displayProperties.strokeWidth)?e.displayProperties.strokeWidth:0}).attr("stroke",function(e){return e.pointStroke||(e.pointStroke=d),angular.isString(e.displayProperties.strokeColor)?e.displayProperties.strokeColor:e.pointStroke}),c.on("mouseover",function(e){m(e)}).on("mouseout",function(){S()}),g.selectAll(".tickX").data(v[0]).enter().append("line").attr("transform","translate("+i.padding.left+", 0)").attr("class","tick tickX").attr("y1",o.y2).attr("y2",o.y2+u).attr("x1",function(e){return d3.mean(v[2][e])}).attr("x2",function(e){return d3.mean(v[2][e])}),g.selectAll(".ruleX").data(v[0]).enter().append("text").attr("transform","translate("+i.padding.left+", 0)").attr("class","rule ruleX").attr("y",o.y2+2*o.offset.y).attr("x",function(e){return d3.mean(v[2][e])}).text(function(e){return moment(e,"MM/DD/YYYY").format("MMM DD").replace(".","")});var A=d3.mean(r.data,function(e){return e.y});p.append("line").attr("class","averageLine").attr("x1",0).attr("x2",o.width).attr("y1",f(A)).attr("y2",f(A))},r.data&&r.data.length&&S(r.data)};A(),I(),r.$watch("data",function(){r.data&&r.data.length&&S(r.data)}),r.$watch("start + end",function(){I()}),r.$on("graph-resized",function(e,t){A(t.width),I()})}}}]),angular.module("Realize.reporting.CategoryBarGraph",["RealizeDataServices"]).directive("categoryBarGraph",["$log","Messages","$window","$rootScope","COLORS","KEY_CODES",function(e,t,n,r,s,a){"use strict";function i(e,t,n){var r=d3.svg.axis().scale(e).orient("left").tickSize(6,0).tickFormat(function(e){return e+t});return angular.isArray(n)&&r.tickValues(n),o.append("g").attr("class","axes y").attr("transform",l.transform).call(r),r}var o,l,c;return{replace:!0,scope:{data:"=localData",start:"=min",end:"=max",whenHover:"&",whenHoverOut:"&",whenClick:"&",generateUrl:"=?"},link:function(r,u,d){r.getMessage=t.getMessage;var m,g,p,f,h,v,S=function(){e.debug("in draw of category bar...",r.data),l={height:220,width:angular.element(n).width()<980?450:700,padding:{bottom:50,left:50,right:20,top:10}},c={height:l.height-l.padding.bottom-l.padding.top,width:l.width-l.padding.left-l.padding.right,bar:{width:25,gap:2,dy:4},offset:{x:5,y:10},x1:l.padding.left,y1:l.padding.top,xLabelFontSize:14,yLabelFontSize:14},l.transform="translate("+l.padding.left+", "+l.padding.top+")",c.x2=c.x1+c.width,c.y2=c.y1+c.height,c.transform="translate("+l.padding.left+", "+(l.padding.top+c.height)+") scale(1,-1)",u.empty(),o=d3.select(u[0]).append("svg").attr("width",l.width).attr("height",l.height).attr("class","svgGraph"),m=o.append("g").attr("transform",c.transform).attr("class","bar-group"),g=d3.scale.linear().range([c.height,0]),f=d3.scale.ordinal().rangeRoundBands([0,c.width],.1),p=i(g,d.ySuffix),h=d3.svg.axis().scale(f).orient("bottom"),o.append("text").attr("class","axis-label x").attr("text-anchor","middle").attr("x",l.width/2).attr("y",l.height-c.offset.y).attr("font-size",c.xLabelFontSize).text(d.labelX),o.append("text").attr("class","axis-label y").attr("transform",c.transform).attr("text-anchor","middle").attr("x",-l.height/2+c.offset.y).attr("y",c.offset.y).attr("transform","rotate(-90)").attr("font-size",c.yLabelFontSize).text(d.labelY);var S=!1;v=function(){e.debug("in update of category bar"),u.find(".bar-group").empty();var n=d3.max(r.data,function(e){return e.y});n>100&&(n=100);var i,d;10>=n?(i=2,d=10):20>=n?(i=5,d=20):50>=n?(i=10,d=50):(i=20,d=100);for(var v=[],T=0;d>=T;)v.push(T),T+=i;e.debug("tick values "+v+", yMax = "+d),g.domain([0,d]),p.tickValues(v),o.select(".axes.y").call(p),o.selectAll(".axes.y g text").each(function(){d3.select(this).attr("class","ruleY")}),S||(S=!0,f.domain(r.data.map(function(e){return t.getMessage(e.x)})),h.tickSize(r.data.length,0,0),o.append("g").attr("class","axes x "+(450===l.width?"small-font":"large-font")).attr("transform","translate("+l.padding.left+","+(l.padding.top+c.height)+")").call(h));var A=!1,I=m.selectAll("rect").data(r.data).enter(),E=function(e){r.whenHover({data:e})},y=function(){A||r.whenHoverOut()},R=function(e,t){d3.event.preventDefault(),d3.event.stopPropagation(),A=!0,r.whenClick({data:e,index:t})};I=I.append("a").attr("class","bar-anchor").attr("focusable",!0),r.generateUrl&&I.attr("xlink:href",function(e,t){return r.generateUrl(e,t)}),I.on("keydown",function(e,t){d3.event.keyCode===a.ENTER&&R(e,t)}).on("focus",function(e){E(e)}).on("blur",function(){y()}),I=I.append("rect").attr("class",function(e){return"bar "+e.categoryName}).attr("fill-type",function(e){return angular.isString(e.displayProperties.fillType)?e.displayProperties.fillType:"fill"}).attr("x",function(e){return f(e.x)}).attr("y",0).attr("width",f.rangeBand()).attr("height",function(e){return e.y>d&&(e.y=d),0===e.y?c.y1-8:c.height-g(e.y)}).attr("stroke-width",function(e){return angular.isNumber(e.displayProperties.strokeWidth)?e.displayProperties.strokeWidth:0}).attr("stroke",function(e){return angular.isString(e.displayProperties.strokeColor)?e.displayProperties.strokeColor:s.BLUE}).attr("title",function(e){return e.categoryName}),I.on("mouseover",function(t){e.debug("on hover ",t.numberOfItemsInCategory),E(t)}).on("mouseout",function(){y()}).on("click",function(e,t){R(e,t)})},r.data&&r.data.length&&v()};S(),r.$watch("data",function(){r.data&&r.data.length&&v(r.data)}),r.$watch("start + end",function(){S()}),r.$on("graph-resized",function(e,t){l.width=t.width,S()})}}}]),angular.module("Realize.reporting.LineGraph",["ModalServices","Realize.standards.standardDataService","Realize.common.keyboardSupport.keyCodes","Realize.common.browserInfoService"]).directive("lineGraph",["$log","Messages","$window","$rootScope","Modal","KEY_CODES","BrowserInfo",function(e,t,n,r,s,a,i){"use strict";var o=55,l=10,c=5,u=2,d=!1,m=6,g=7,p=45,f={DAY:"DAY",WEEK:"WEEK"};return{replace:!0,scope:{data:"=localData",whenHover:"&",whenHoverOut:"&",whenClick:"&",generateUrl:"=?",yMax:"=",start:"=min",end:"=max"},templateUrl:"templates/reporting/lineGraph.html",link:function(h,v,S){function T(){O.extent([z,U]),O(k.selectAll(".x.brush")),ft()}function A(){return!d&&!H}function I(){var e,t,n,r,s;return n=new Date(z.getFullYear(),z.getMonth(),z.getDate()),r=new Date(U.getFullYear(),U.getMonth(),U.getDate()),s=n.clone().addWeeks(u),U.isBefore(s)?(t=d3.time.day.range(n,r).length,e=f.DAY):(t=d3.time.week.range(n,r).length,e=f.WEEK),{extent:t,extentType:e}}function E(t,n,r){var s;switch(t){case f.DAY:s=r.clone().addDays(n);break;case f.WEEK:s=r.clone().addWeeks(n);break;default:e.error("cant determine date based on offset","time interval type unknown",arguments)}return s}h.getMessage=t.getMessage,h.reportType=S.type;var y,R,C,D,b,P,w,L,O,N,M,k,z,U,F,x,B,V,H,G,j,q,Y,W,K,Q,X=v.find(".graph-container"),Z=960,J=400,et=function(t){e.debug("line graph set graphWidth "+t),J=H?240:d?260:400,G={padding:{bottom:50,left:o,right:20,top:10},margin:{top:10,right:l,bottom:H?65:d?80:230,left:o},dot:{width:25,gap:2,dy:4},group:{gap:5},offset:{x:5,y:10},xLabelFontSize:14,yLabelFontSize:14},G.height=J-G.margin.top-G.margin.bottom-10,G.x1=G.padding.left,G.y1=G.padding.top,G.y2=G.y1+G.height,j={margin:{top:d?255:280,right:l,bottom:d?10:50,left:o}},j.height=J-j.margin.top-j.margin.bottom,Z=angular.isNumber(t)?t:angular.element(n).width()<980?450:700,q=Z-G.margin.left-G.margin.right,G.x2=G.x1+q},tt={type:"standard",stroke:""};i.isIDevice&&(tt.stroke="");var nt=function(e){var t;angular.forEach(e,function(e){angular.isObject(e.lineGraphDisplayProperties)?(t={},angular.copy(tt,t),angular.extend(t,e.lineGraphDisplayProperties),e.lineGraphDisplayProperties=t):e.lineGraphDisplayProperties=tt})},rt=function(t){var n=0,s=0,a=0,i=0;for(F=0,n=0;n<t.length;n++)for(i+=t[n].data.length,s=0;s<t[n].data.length;s++)a+=t[n].data[s].y;0!==i&&0!==a&&(F=Math.round(a/i)),e.debug("setAverage: ",F,i,a),r.$broadcast("reportAverageUpdated",{updatedAverage:F,reportType:h.reportType})},st=d3.svg.line().x(function(e){return e.displayAt}).y(function(e){return C(e.y)}),at=d3.svg.line().x(function(e){return P(new Date(e.x))}).y(function(e){return w(e.y)}),it=function(){N.select(".averageLine").remove(),M.append("svg:line").attr("class","averageLine").attr("x1",0).attr("x2",q).attr("y1",C(F)).attr("y2",C(F))},ot=function(e){return"[object Date]"!==Object.prototype.toString.call(e)||isNaN(e.getTime())?!1:!0},lt=function(t){var n=[];return 0!==t.length&&ot(z)&&ot(U)?(angular.forEach(t,function(e){var t=[];angular.forEach(e.data,function(e){var n=new Date(e.x);return n.isAfter(U)?!1:(n.between(z,U)&&t.push(e),void 0)}),t.length>0&&n.push({data:t,lineGraphDisplayProperties:e.lineGraphDisplayProperties})}),e.log("Viewport StartDate="+z,"Viewport EndDate = "+U),n):n},ct=function(t,n){var r=0;if(angular.isArray(n))for(r=0;r<n.length;r++)if(n[r]&&n[r].assignmentId===t)return r;e.error("lineGraph.js: findIndexByAssignmentId: Cannot find item with id: "+t)},ut=function(e,t){var n=0,r=[];if(angular.isArray(t))for(n=0;n<t.length;n++)if(t[n]&&t[n].data&&t[n].data.indexOf(e)>-1){r=t[n].data;break}return r},dt=function(e){var t=!1,n=function(e){h.whenHover({data:e})},r=function(){t||h.whenHoverOut()},s=B(e),a=M.selectAll(".points").data(s).enter().append("g").attr("class",function(e){return"points "+e.lineGraphDisplayProperties.type});a.append("svg:path").attr("class","line").attr("stroke-dasharray",function(e){return e.lineGraphDisplayProperties.stroke}).attr("clip-path","url(#clip_"+h.reportType+")").attr("d",function(e){return st(e.data)});var o=a.selectAll("point-on-line-bg").data(function(e){return e.data}).enter().append("a").attr("focusable",!0).attr("role","link").attr("aria-label",function(e){return e.label});o.on("focus",function(e){n(e)}).on("blur",function(){r()}),h.generateUrl&&o.attr("xlink:href",function(e,t){return h.generateUrl(e,t)}),o.append("svg:circle").attr("class",function(e){var t="point-on-line-bg";return angular.isString(e.pointClass)&&(t+=" "+e.pointClass),t}).attr("r",g).attr("cx",function(e){return e.displayAt}).attr("cy",function(e){return C(e.y)}),a.selectAll("point-on-line").data(function(e){return e.data}).enter().append("svg:circle").attr("class",function(e){var t="point-on-line";return angular.isString(e.pointClass)&&(t+=" "+e.pointClass),t}).attr("r",m).on("mouseover",function(e){h.whenHover({data:e})}).on("mouseout",function(){Q&&(Q=void 0),h.whenHoverOut()}).on("click",function(e){return!i.OS.isIOS5&&!i.OS.isAndroid||Q&&Q===e?(h.whenClick({data:e,index:ct(e.assignmentId,ut(e,y))}),void 0):(Q=e,h.whenHover({data:e}),void 0)}).attr("cx",function(e){return e.displayAt}).attr("cy",function(e){return C(e.y)})},mt=function(){N.selectAll(".ruleTopX").data(Y[0]).enter().append("text").attr("transform",function(e){return"translate("+(G.padding.left+d3.mean(Y[2][e]))+","+(G.y2+2*G.offset.y)+")rotate("+p+")"}).attr("class","rule ruleX ruleTopX").text(function(e){return moment(e,"MM/DD/YYYY").format("MMM DD").replace(".","")}),N.selectAll(".tickX").data(Y[0]).enter().append("line").attr("transform","translate("+G.padding.left+", 0)").attr("class","tick tickX").attr("y1",G.y2).attr("y2",G.y2+c).attr("x1",function(e){return d3.mean(Y[2][e])}).attr("x2",function(e){return d3.mean(Y[2][e])})},gt=function(e){rt(e),it(),M.selectAll(".points").remove(),N.selectAll(".ruleTopX").remove(),N.selectAll(".tickX").remove(),0!==e.length&&(dt(e),mt())},pt=function(){var e=lt(h.data);gt(e)},ft=function(){R.domain(O.empty()?[z,U]:O.extent());var e=O.extent();O.empty()||(z=new Date(e[0]),U=new Date(e[1])),pt()},ht=function(){k.select(".contextArea").remove(),P=d3.time.scale().range([0,q]),w=d3.scale.linear().range([j.height,0]).clamp(!0);var e=Date.parse(V[0].x),n=Date.parse(V[1].x);U.isAfter(n)&&(n=U),P.domain([e,n]),w.domain(C.domain()),L=d3.svg.axis().scale(P).orient("bottom").tickFormat(d3.time.format("%b %d")),O=d3.svg.brush().x(P).on("brush",ft);var r=k.append("g").attr("class","contextArea");r.append("g").attr("class","axes x").attr("transform","translate( 0 ,"+j.height+")").call(L),r.append("g").attr("class","x brush").call(O).selectAll("rect").attr("y",-6).attr("height",j.height+7),T(),r.append("svg:text").attr("class","x instructions pan_zoom").attr("text-anchor","left").attr("x",0).attr("y",-10).attr("font-size",14).text(t.getMessage("lineGraph.instructionForPanAndZoom"));var s=r.selectAll(".points").data(h.data).enter().append("g").attr("class",function(e){return"points "+e.lineGraphDisplayProperties.type});s.append("svg:path").attr("class","line").attr("stroke-dasharray",function(e){return e.lineGraphDisplayProperties.stroke}).attr("d",function(e){return at(e.data)})},vt=function(e){var t=[],n=[];return angular.forEach(e,function(e){0!==e.data.length&&(t.push(e.data[0]),t.push(e.data[e.data.length-1]))}),n=t.sort(function(e,t){return e=new Date(e.x),t=new Date(t.x),t>e?-1:e>t?1:0}),[n[0],n[n.length-1]]},St=function(){var e=!0;return angular.forEach(h.data,function(t){var n=t.data;if(n.length>=1){var r=n[0].x,s=n[n.length-1].x,a=Date.parse(r).between(z,U),i=Date.parse(s).between(z,U);if(!a||!i)return e=!1,!1}}),e};h.isNavigatePanAreaWithKeyboardSet=!1;var Tt=function(){var e;h.isNavigatePanAreaWithKeyboardSet||(h.isNavigatePanAreaWithKeyboardSet=!0,$(v).keydown(function(t){if(A){var n=!1;if(t.shiftKey===!0?t.which===a.LEFT?(n=!0,z.addWeeks(-1*u)):t.which===a.RIGHT?(n=!0,z.addWeeks(u)):t.which===a.UP?(t.preventDefault(),n=!0,U.addWeeks(u)):t.which===a.DOWN&&(t.preventDefault(),n=!0,U.addWeeks(-1*u)):t.which===a.LEFT?(e=I(),n=W(e.extent,e.extentType)):t.which===a.RIGHT&&(e=I(),n=K(e.extent,e.extentType)),n){if(z.isAfter(U)){var r=z.clone();z=U,U=r}z.isBefore(Date.parse(V[0].x))&&(z=Date.parse(V[0].x)),U.isAfter(Date.parse(V[1].x))&&(U=Date.parse(V[1].x)),T()}}}))},At=function(){X.empty(),e.log("in draw"),y=h.data,y[0].data&&(y[0].data=_.sortBy(y[0].data,function(e){return new Date(e.assignmentDueDate)})),nt(y),V=vt(y),z=Date.parse(V[0].x),U=Date.parse(V[0].x).addWeeks(u),H=St(),et(),R=d3.time.scale().range([0,q]),C=d3.scale.linear().range([G.height,0]).clamp(!0),R.domain(d3.extent([Date.parse(V[0].x),Date.parse(V[1].x)])),C.domain([0,parseInt(h.yMax,10)]),D=d3.svg.axis().scale(R).orient("bottom"),b=d3.svg.axis().scale(C).orient("left").ticks(parseInt(S.ticks,10)||1).tickSubdivide(parseInt(S.subTicks,10)||3).tickSize(6,6,0).tickFormat(function(e){return e+S.ySuffix}),N=d3.select(X[0]).append("svg:svg").attr("class","line-graph").attr("width",Z).attr("height",J),d||N.append("defs").append("clipPath").attr("id","clip_"+h.reportType).append("rect").attr("width",q).attr("height",G.height),M=N.append("g").attr("class","graph-area").attr("transform","translate("+G.margin.left+","+G.margin.top+")"),k=N.append("g").attr("class","date-range context").attr("transform","translate("+j.margin.left+","+j.margin.top+")"),N.append("line").attr("class","axes x").attr("x1",G.x1).attr("x2",G.x2).attr("y1",G.y2).attr("y2",G.y2),M.append("g").attr("class","axes y").call(b),N.append("text").attr("class","axis-label x").attr("text-anchor","middle").attr("x",q/2).attr("y",G.height+G.margin.top+(H?G.margin.bottom-5:d?G.margin.bottom/2:G.margin.bottom/4)).attr("font-size",14).text(t.getMessage(S.labelX)),N.append("text").attr("class","axis-label y").attr("text-anchor","middle").attr("x",-G.height/2).attr("y",G.margin.top).attr("transform","rotate(-90)").attr("font-size",14).text(t.getMessage(S.labelY)),B=function(e){var t,n=0;Y=[[],{},{}],angular.forEach(e,function(e){var t=e.data;angular.forEach(t,function(e){$.inArray(e.x,Y[0])<0?(Y[0].push(e.x),Y[1][e.x]=1):Y[1][e.x]++,n+=1})}),Y[0]=_.sortBy(Y[0],function(e){return new Date(e)}),t=n>=q-1?1:Math.floor(q/n);var r=function(e){var n=0;return angular.forEach(Y[0],function(r){new Date(r).isBefore(new Date(e))&&(n+=Y[1][r]*t)}),Y[2][e]&&(n+=Y[2][e].length*t),n};return angular.forEach(e,function(e){var n,s,a=e.data;angular.forEach(a,function(e,i){0===i?(s=r(a[i].x),n=a[0].x):n!==a[i].x&&(s=r(a[i].x),n=a[i].x),a[i].displayAt=s,Y[2][e.x]?Y[2][e.x].push(s):Y[2][e.x]=[s],s+=t}),e.data=a}),e},x(y),$(v).removeAttr("tabindex"),A()&&($(v).attr("tabindex",0),Tt())};x=function(){N.selectAll(".points").remove(),H?pt():d?pt():ht(),N.selectAll(".contextArea .axes.x text").attr("class","rule ruleX").attr("transform",function(){return"translate(5,10)rotate("+p+")"})},h.$watch("start + end",function(){At()}),h.$watch("data",function(){e.debug("line graph updated data received"),At()}),h.$on("graph-resized",function(e,t){et(t.width),At()}),h.$on("$destroy",function(){}),W=function(e,t){var n=Date.parse(V[0].x);if(Date.equals(n,z))return!1;var r=E(t,-1*e,z);r.isBefore(n)&&(r=n),z=r;var s=Date.parse(V[1].x),a=E(t,e,r);return a.isAfter(s)&&(a=s),U=a,!0},K=function(e,t){var n=Date.parse(V[1].x);if(Date.equals(n,U))return!1;var r=E(t,e,U);r.isAfter(n)&&(r=n),U=r;var s=Date.parse(V[0].x),a=E(t,-1*e,r);return a.isBefore(s)&&(a=s),z=a,!0},h.panLeft=function(e){e.preventDefault(),e.stopPropagation(),W(u,f.WEEK)&&pt()},h.panRight=function(e){e.preventDefault(),e.stopPropagation(),K(u,f.WEEK)&&pt()},h.showA11yPanZoomInstruction=function(){return!d&&!H},h.usePanAreaFallback=function(){return!H&&d},h.showA11yPanZoomInstructions=function(e){e.preventDefault(),e.stopPropagation();var t=r.$new(),n=function(){s.hideDialog()};t.isDismissible=!1,t.closeBtnClickHandler=n,s.simpleDialog("lineGraph.a11y.modal.title","lineGraph.a11y.modal.message",{OK:{title:"lineGraph.a11y.modal.action.ok",handler:n,isDefault:!0}},{id:"lineGraphA11yInstructionModal"})}}}}]),angular.module("Realize.reporting.ReportService",["RealizeDataServices","Realize.constants.questionType"]).factory("ReportService",["$http","$log","$q","REST_PATH","CODE_ASSIGNMENT_HAS_NO_PROGRAM","Assignment","ISODateService","RangeDatepickerOptions","QUESTION_TYPE",function(e,t,n,r,s,a,i,o,l){"use strict";var c={};c.currentProgram=null,c.masteryReportList=[],c.progressReportList=[],c.usageReportList=[],c.reformatDate=function(e){var t=$.fullCalendar.parseISO8601(e);return t?t.toString("MM/dd/yyyy"):e};var u=function(e,t){return!angular.isArray(e.programs)||1===e.programs.length&&e.programs[0]===s?e.programs=[]:1===e.programs.length&&(t=t.concat(e.programs)),t},d=function(t,n,r){var s,a={};return n&&(a.dateRangeFrom=i.toStartOfDayStringWithZone(new Date(n))),r&&(a.dateRangeTo=i.toStartOfNextDayStringWithZone(new Date(r))),s=e.get(t,{params:a}).then(function(e){var t=[],n=[];return angular.forEach(e.data,function(e,r){var s=angular.extend({},e);n=u(s,n),s.assignmentDueDate=c.reformatDate(s.assignmentDueDate),s.index=r,t.push(s)}),n=_.reject(n,function(e){return!e}),t=_.sortBy(t,function(e){return new Date(e.assignmentDueDate)}),t.programList=_.uniq(n),t})};c.getScores=function(n,s,a){var i=[r,"mastery","class",n,"assignment",s,"assessment",a,"scoreSummary"].join("/");return e.get(i).then(function(e){var t=e.data.questions,n=_.reject(t,function(e){return e.questionType===l.MULTIPLE_CHOICE||e.questionType===l.GRIDDED_RESPONSE});return e.data.isPAF=n.length>0,e.data},function(e){t.error("Failed to retrieve score summary",e)})},c.getProgressReport=function(e,n,s){var a=[r,"/classes/",e,"/progress"].join("");return d(a,n,s).then(function(e){return c.progressReportList=e,e},function(e){t.error("Failed to retrieve progress report",e)})},c.getMasteryReport=function(e,n,s){var a=[r,"/mastery/class/",e].join("");return d(a,n,s).then(function(e){return c.masteryReportList=e,e},function(e){t.error("Failed to retrieve mastery report",e)})},c.getUsageReport=function(e,n,s){var a=[r,"/classes/",e,"/usage"].join("");return d(a,n,s).then(function(e){var t=angular.copy(e);return delete t.programList,delete t.move,c.usageReportList=t,e},function(e){t.error("Failed to retrieve usage report",e)})},c.getStudentProgress=function(t,n){return e.get([r,"/classes/",t,"/assignments/",n,"/progress"].join(""))},c.averageMastery=function(t,n,s){return e.get([r,"/mastery/standard/class/",t,"/assignment/",n,"/assessment/",s].join(""))},c.getStudentUsage=function(t,n){return e.get([r,"/classes/",t,"/assignments/",n,"/usage"].join(""))},c.studentMastery=function(t,n,s){return e.get([r,"/mastery/student/class/",t,"/assignment/",n,"/assessment/",s].join(""))},c.getStudentTestReport=function(n,s,a,o){var l=[r,"/data/assessments"].join(""),d=[],m={classId:n,dateRangeFrom:i.toStartOfDayStringWithZone(new Date(a)),dateRangeTo:i.toStartOfNextDayStringWithZone(new Date(o))},g=e.get(l,{params:m});return g.then(function(e){angular.forEach(e.data,function(e){d=u(e,d),e.assignmentDueDate=c.reformatDate(e.assignmentDueDate)}),d=_.uniq(d),e.data.programList=_.filter(d,function(e){return!!e}),c.studentTestReportList=e.data},function(e){t.error("getStudentGradeReport: error url = "+l+", response = "+e)}),g},c.setReportFilters=function(e){c.reportFilters=e},c.getReportFilters=function(){return c.reportFilters},c.resetReportFilters=function(){c.reportFilters=void 0},c.getStudentProgressByClass=function(e){var t={assignmentsCompletedOnTime:0,assignmentsCompletedPastDue:0,assignmentsInProgress:0,assignmentsNotStarted:0};return angular.forEach(e,function(e){"NOT_STARTED"===e.status?++t.assignmentsNotStarted:"IN_PROGRESS"===e.status?++t.assignmentsInProgress:"COMPLETED"===e.status?++t.assignmentsCompletedOnTime:"COMPLETED_PAST_DUE"===e.status&&++t.assignmentsCompletedPastDue}),t},c.getStudentProgressReportForStudent=function(n,s,a){var o=[r,"/classes/"+n+"/reports/assignmentprogress"].join(""),l={dateRangeFrom:i.toStartOfDayStringWithZone(new Date(s)),dateRangeTo:i.toStartOfNextDayStringWithZone(new Date(a))},d=e.get(o,{params:l});return d.then(function(e){var t,n=e.data,r=[];if(angular.forEach(e.data,function(e){r=u(e,r)}),t=_.indexOf(r,c.reportFilters.program),-1!==t){var s=c.reportFilters.program;n=[],angular.forEach(e.data,function(e){1===e.programs.length&&s===e.programs[0]&&n.push(e)})}c.studentProgressRecapCounts=c.getStudentProgressByClass(n),e.data={},e.data.studentProgress=c.studentProgressRecapCounts,e.data.programFilterIndex=t,e.data.programList=r},function(e){t.error("getStudentProgressReport: error url = "+o+", response = "+e)}),d},c.getStudentProgressRecap=function(t,s,o,l,c){var u,d,m=[r,"classes",t,"reports/studentprogress",c].join("/"),g={dateRangeFrom:i.toStartOfDayStringWithZone(new Date(s)),dateRangeTo:i.toStartOfNextDayStringWithZone(new Date(o))};return l&&(g.program=l),d=function(e){var t=[];return angular.forEach(e.data,function(e){t.push(new a(e))}),t},u=function(e){return n.defer().reject(e)},e.get(m,{params:g}).then(d,u)};var m=new o("#filterDateStart","#filterDateEnd");return c.startDateOptions=m.start,c.dueDateOptions=m.end,c.CONSTANTS={RECAP:{ELLIPSES_NAME:25}},c}]),angular.module("Realize.reporting",["Realize.common.DateRangeSelector","Realize.reporting.ReportService","Realize.reporting.MasteryByStandardReport","Realize.reporting.MasteryByAssignmentService","Realize.reporting.LineGraph","Realize.reporting.BarGraph","Realize.reporting.CategoryBarGraph","Realize.reporting.friendlyTimeFilter","Realize.reporting.friendlyTime","Realize.reporting.data.UsageRecapCtrl","Realize.reporting.data.TrackingService","Realize.reporting.data.DataClassOverviewCtrl","Realize.reporting.data.DataCtrl","Realize.reporting.data.MasteryCtrl","Realize.reporting.data.MasteryStandardCtrl","Realize.reporting.data.IndividualStudentReportCtrl","Realize.reporting.data.ProgressCtrl","Realize.reporting.data.masteryByStandardsFilters","Realize.reporting.data.ItemAnalysisCtrl","Realize.reporting.grades.GradesHomeCtrl","Realize.reporting.grades.GradesOverviewCtrl","Realize.reporting.grades.StudentProgressRecapCtrl","Realize.reporting.grades.StudentItemAnalysisCtrl","Realize.reporting.grades.StudentItemAnalysisSvc"]).constant("MASTERY_NAME_MAXLENGTH",18).constant("MASTERY_THRESHOLD",.7),angular.module("Realize.reporting.friendlyTime",[]).directive("friendlyTime",["$log","$filter",function(e,t){"use strict";function n(e,t){return Math.floor(e/t)}var r=36e5,s=6e4,a=1e3;return{restrict:"A",templateUrl:"templates/reporting/timeFriendly.dir.html",scope:{timeToDisplay:"=friendlyTime",zeroState:"=?"},link:function(e){function i(t){if(t=Math.round(t),0===t)return[0,l("usageRecap.time.second")].join(" ");
if(!angular.isNumber(t))return e.zeroState||o;var i,c,u,d=t;i=n(d,r),e.hours=i,d-=(i||0)*r,c=n(d,s),e.minutes=c,d-=(c||0)*s,u=n(d,a),e.seconds=u}var o="-",l=t("lwcI18n");e.$watch("timeToDisplay",i)}}}]),angular.module("Realize.reporting.friendlyTimeFilter",[]).filter("friendlyTime",["$log","$filter",function(e,t){"use strict";return function(e,n){var r="-",s=t("lwcI18n");if(0===e)return[0,s("usageRecap.time.second")].join(" ");if(!angular.isNumber(e))return n||r;var a,i,o,l,c,u=36e5,d=6e4,m=1e3;return a=[],c=e,i=Math.floor(c/u),i&&(c-=i*u,a.push([i,s("usageRecap.time.hour")].join(" "))),o=Math.floor(c/d),o&&(c-=o*d,a.push([o,s("usageRecap.time.minute")].join(" "))),l=Math.floor(c/m),l&&a.push([l,s("usageRecap.time.second")].join(" ")),a.length?a.join(", "):n||r}}]),angular.module("RealizeApp").service("SearchSvc",["$log","Messages","$http","$rootScope","$location","$filter","MEDIA_TYPE","webStorage",function(e,t,n,r,s,a,i,o){"use strict";var l,c=["FEATURED_RESOURCES","GRADE","TEACHER_ONLY","RUBRIC","MEDIA_TYPE","CONTENT_TYPE","SOURCE","LIBRARY_TITLE","COMPREHENSION_SKILLS","TEXT_FEATURES","GENRES","CONTENT_AREAS","LANGUAGE"],u=["MEDIA_TYPE","RUBRIC","CONTENT_TYPE","SOURCE","LIBRARY_TITLE","LANGUAGE"],d=[],m=[];this.INCLUDED_FACETS=r.currentUser.isStudent?u:c,this.sortFacets=function(e){var t,n={};for(t=0;t<e.length;t++){"TEACHER_ONLY"===e[t].fieldName&&(e[t].values=$.Enumerable.From(e[t].values).Where("$.value === 'Yes' || $.value === 'No'").ToArray());var r=$.inArray(e[t].fieldName,this.INCLUDED_FACETS);-1!==r&&(n[r]=e[t])}return n},this.calculateResultCountIndexes=function(e,t,n){var r={};return r.start=1+e*(t-1),r.end=r.start+e-1,r.end>n&&(r.end=n),r},this.getFacetMap=function(e){var t={};return angular.forEach(e,function(e){t[e.fieldName]={},angular.forEach(e.values,function(n){n.displayName||(n.displayName=n.value),n.facet=e.fieldName,t[e.fieldName][n.value]=n})}),t.SOURCE&&angular.isDefined(t.SOURCE["My Uploads"])&&(t.SOURCE["My Uploads"].displayName="My Content"),t.RUBRIC&&(t.RUBRIC.true&&(t.RUBRIC.true.displayName="Has Rubric(s)"),t.RUBRIC.false&&(t.RUBRIC.false.displayName="No Rubric(s)")),t},this.groupResults=function(e,t){return _.chain(e).groupBy(function(e){return e[t]?e[t]:Math.random()}).map(function(e){var t;return 1===e.length?t=e[0]:(t=angular.copy(e[0]),t.contentGroup=e),t}).value()};var g=function(e){if(e.containerMediaType!==i.LEARNING_MODEL){var t=l.split(e.parentItemUuid),n=-1!==e.containerMediaType.indexOf(i.REMEDIATION),r=n?t[0]:t[0]+e.parentItemUuid+"/0",s={id:e.parentItemUuid,title:e.containerTitle,url:r};m.push(s)}e.hasOwnProperty("parent")&&g(e.parent)};this.getBreadcrumbHierarchy=function(e,t){return d=[],_.map(e,function(e){m=[],l=e.path,g(e);var n=m.length,r=n>=1?m[n-1].id:null,s=a("filter")(t,{id:r},!0);s&&s.length>0&&d.push(m.reverse())}),d},this.navigateToSourceProgram=function(e){s.search("keywords",null),s.path(e)},this.storeContentFromDetails=function(e){var t=_.isEmpty(e.fromDetails)?null:e.fromDetails;t?o.add("contentFromDetails",t):o.remove("contentFromDetails")},this.addMyContent=function(e){return angular.forEach(e,function(e){"My Uploads"!==e.contribSource||e.originalItemId||(e.myContent=!0)}),e}}]),angular.module("Realize.constants.searchTelemetryEvent",[]).constant("SEARCH_TELEMETRY_EVENT",{OPEN:"Open",CLOSE:"Close",ADD:"Add",ASSIGN:"Assign",NAME:"Breadcrumb",MORE:"More link",LESS:"Less link",MORE_TEXT:"More",SEARCH_DATA:"Search",PROGRAM_DATA:"Programs",DESCRIPTION:"Total number of source hierarchies for content item is",INFORMATION_MODAL:"Information modal",PAGE_TYPE:{SEARCH_PAGE:"Search results",RESOURCES_PAGE:"Resources",STANDARDS_PAGE:"Standards",LEAVELED_READERS_PAGE:"Leveled readers",CREATE_AN_ASSIGNMENT:"Create an assignment"},LEVEL_TYPE:{SINGLETON:"singleton",ROOT:"root",LEAF:"leaf",INTERMEDIATE:"intermediate"}}),angular.module("Realize.search.telemetry",["Realize.constants.searchTelemetryEvent","rlzComponents.components.telemetry.constants"]).service("searchTelemetryUtilitiesService",["$location","telemetryService","baseTelemetryEvents","SEARCH_TELEMETRY_EVENT","DRA_TELEMETRY","TELEMETRY_FACETS_CONSTANTS","TELEMETRY_CONSTANTS",function(e,t,n,r,s,a,i){"use strict";this.sendTelemetryEventsFromSearch=function(e,s,a){var i=e.currentTarget.text,o={extensions:{area:l(),page:d(),product:c(s),description:m(i,s),value:f(s)},definition:{name:r.NAME}};o.extensions["sub-page"]="infoModal"===a?r.INFORMATION_MODAL:"";var u=n.createEventData(r.OPEN,o);t.sendTelemetryEvent(u)},this.sendTelemetryEventsFromMoreOrLess=function(e,s){var a={extensions:{area:l(),page:d(),product:u(s),description:r.DESCRIPTION+" "+s.length,value:h(s)},definition:{name:e===r.MORE_TEXT?r.MORE:r.LESS}},i=n.createEventData(e===r.MORE_TEXT?r.OPEN:r.CLOSE,a);t.sendTelemetryEvent(i)},this.sendTelemetryEventsFromCreateAssignment=function(s,a){var i=o(s),l={extensions:{area:-1!==e.path().indexOf("/program")?r.PROGRAM_DATA:r.SEARCH_DATA,page:-1!==e.path().indexOf("/program")?"":r.PAGE_TYPE.SEARCH_PAGE,product:i.length>0?c(i):"",description:a,value:i.length>0?f(i):""},definition:{name:r.ASSIGN}};l.extensions["sub-page"]=r.PAGE_TYPE.CREATE_AN_ASSIGNMENT;var u=n.createEventData(r.ADD,l);t.sendTelemetryEvent(u)},this.sendTelemetryEventsFromSearchButton=function(e){var s={extensions:{area:r.SEARCH_DATA,page:r.PAGE_TYPE.SEARCH_PAGE,value:e},definition:{name:r.SEARCH_DATA}},a=n.createEventData(r.SEARCH_DATA,s);t.sendTelemetryEvent(a)},this.sendTelemetryEventForBrowse=function(e,r,s,o,l){var c=a.FACET.FILTER,u={extensions:{area:l,page:e,product:i.NO_PROGRAM_AVAILABLE,description:r,value:o},definition:{name:s+" "+c}};u.extensions["sub-page"]=a.FACET.FACET_PANEL;var d=n.createEventData(c,u);t.sendTelemetryEvent(d)},this.sendTelemetryEventForDra=function(e,r,o,l,c,u){var d=c!==u?c+"-"+u:c,m={extensions:{area:i.EVENT_TYPE.PROGRAMS,page:s.LEVELED_READERS,"sub-page":a.FACET.FACET_PANEL,product:l,description:e,value:o,LeveledReaderType:s.DRA,LeveledReaderScale:d},definition:{name:r}},g=n.createEventData(a.FACET.FILTER,m);t.sendTelemetryEvent(g)};var o=function(e){var t=[];return e&&e.length>0&&_.forEach(e,function(e){if(e.containerTitle){var n={title:e.containerTitle};t.push(n)}}),t.reverse()},l=function(){return e.path().match(/\/(resources|standards|leveledreaders)/)?r.PROGRAM_DATA:r.SEARCH_DATA},c=function(e){return e[0].title},u=function(e){var t=e[0],n=t[0];return n.title},d=function(){return e.path().match(/\/resources/)?r.PAGE_TYPE.RESOURCES_PAGE:e.path().match(/\/standards/)?r.PAGE_TYPE.STANDARDS_PAGE:e.path().match(/\/leveledreaders/)?r.PAGE_TYPE.LEAVELED_READERS_PAGE:r.PAGE_TYPE.SEARCH_PAGE},m=function(e,t){var n,s=t.length,a=p(e,t);return n=0===a&&1===s?r.LEVEL_TYPE.SINGLETON:0===a?r.LEVEL_TYPE.ROOT:a===s-1?r.LEVEL_TYPE.LEAF:r.LEVEL_TYPE.INTERMEDIATE,n+" "+g(a,e,t)},g=function(e,t,n){var r=n.slice(0,e+1);return f(r)},p=function(e,t){var n;return t.map(function(t,r){t.title===e&&(n=r)}),n},f=function(e){var t=e.map(function(e){return e.title}).join(" > ");return t},h=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=f(e[n]);return t.join(" ")}}]),angular.module("RealizeApp").service("AccessibilityService",["$log","$rootScope",function(e,t){"use strict";var n,r,s,a,i,o=angular.element("body");return n=this,r=function(){t.isKeyboardInUse=!t.isKeyboardInUse,t.isKeyboardInUse&&(a=function(e){$(this).unbind(e),r(),n.applyStyleToFocusableElements()},o.on("mousedown",a))},s=function(){i=function(){t.isKeyboardInUse||r(),n.applyStyleToFocusableElements()},o.on("keydown",i)},n.init=function(){t.isKeyboardInUse=!1,s()},n.setFocusElements=function(e){n.keyboardFocusableElements=e},n.applyStyleToFocusableElements=function(){$(n.keyboardFocusableElements).toggleClass("kb-mode",t.isKeyboardInUse)},t.skipNav=function(e){e.stopPropagation(),$("#skipTarget").next("div").find(":focusable").first().focus()},t.$on("$viewContentLoaded",function(){n.applyStyleToFocusableElements()}),t.$on("$destroy",function(){a&&o.off("mousedown",a),i&&o.off("keydown",i)}),n}]),angular.module("RealizeDataServices").factory("Assignee",["$log","ASSIGNMENT_CONSTANTS","GOOGLE_CLASSROOM",function(e,t,n){"use strict";function r(t,n){var r=this;angular.copy(t||{},r),r.type=n,r.className&&r.classId||e.warn("Invalid assignee - Missing className or classId",r),r.$isClass()?r.assigneeTitle=r.name=t.className:r.$isGroup()?(r.assigneeId=t.groupId,r.assigneeTitle=r.name=t.groupName):r.$isStudent()&&(r.name=t.lastName||t.firstName?(t.lastName||"")+", "+(t.firstName||""):t.studentName,r.assigneeId=t.studentId,r.assigneeTitle=r.name),r.rosterSource=t.rosterSource}return r.prototype.$isClass=function(){return this.type===t.ASSIGNEE_TYPE.CLASS},r.prototype.$isGroup=function(){return this.type===t.ASSIGNEE_TYPE.GROUP},r.prototype.$isStudent=function(){return this.type===t.ASSIGNEE_TYPE.STUDENT},r.prototype.$getSerializedString=function(e){var t=this,n=e+".classUuid="+t.classId;return t.$isClass()?n:t.$isGroup()?n+"&"+e+".groupUuid="+t.assigneeId:t.$isStudent()?n+"&"+e+".studentUuid="+t.assigneeId:void 0},r.prototype.isFromGoogleClass=function(){return this.rosterSource===n.ROSTER_SOURCE.GOOGLE_CLASSROOM},r}]),angular.module("RealizeApp").service("AssignmentDataGenerator",["RealizeAssignmentDataGenerator","ExternalAssignmentDataGenerator","ASSIGNMENT_CONSTANTS","AssignmentFacadeService","ClassRoster","Assignee","$log",function(e,t,n,r,s,a,i){"use strict";var o=this;o.getInstance=function(r,s,a,i){var o=this;return angular.isString(r)?r===n.ONESOURCE?new e(s,a,o,i):new t(r,s,a,o):new e(s,a,o)},o.createAssignmentObjectInCreateMode=function(e){var t=angular.isDefined(e.originalEquellaItemId)?e.originalEquellaItemId:e.id,n={assignees:[],classUuids:[],contentItem:e,itemUuid:t,itemVersion:e.version,dueDate:null,startDate:null,instructions:null,allowRemediation:!1,allowMultipleLanguage:!1,includeRRSActivity:!1};return n},o.createAssignmentAttachment=function(e){return{mediaType:e.mediaType,fileType:e.fileType,contentType:e.contentType}};var l=function(e,t){return _.findWhere(e,{classId:t})};o.getAssignees=function(){return s.getClassesWithMetadata().then(function(e){var t=[];return e.classRosters&&angular.forEach(e.classRosters,function(e){e.studentIds.length>0&&t.push(new a(e,n.ASSIGNEE_TYPE.CLASS))}),e.groups&&angular.forEach(e.groups,function(r){var s=l(e.classRosters,r.classId);s?(r.className=s.className,r.rosterSource=s.rosterSource):i.error("Cannot find matching class for",r),t.push(new a(r,n.ASSIGNEE_TYPE.GROUP))}),e.students&&angular.forEach(e.students,function(r){var s=l(e.classRosters,r.classId);s?r.rosterSource=s.rosterSource:i.error("Cannot find matching class for",r),t.push(new a(r,n.ASSIGNEE_TYPE.STUDENT))}),t})},o.getPreSelectedAssignees=function(e,t){return r.getAllAssignedTos(e.assignmentId).then(function(e){var r=[],s=function(e){var n=_.findWhere(t,e);n?r.push(n):i.error("Cannot find pre-selected assignee",e)};return e&&angular.forEach(e,function(e){var t={classId:e.classUuid};e.groupUuid||e.studentUuid?e.groupUuid&&!e.studentUuid?(t.type=n.ASSIGNEE_TYPE.GROUP,t.groupId=e.groupUuid):(t.type=n.ASSIGNEE_TYPE.STUDENT,t.studentId=e.studentUuid):t.type=n.ASSIGNEE_TYPE.CLASS,s(t)}),r})}}]),angular.module("RealizeApp").service("ClassUtil",[function(){"use strict";this.hasAtLeastOneStudentInRosters=function(e){var t=_.chain(e).pluck("studentIds").flatten().value(),n=_.filter(t,function(e){return angular.isDefined(e)}),r=n.length>0;return r},this.hasAtLeastOneClassWithProduct=function(e,t){return 0===t.length||e.length!==t.length}}]),angular.module("Realize.Interceptors.CSRFToken",["Realize.paths"]).constant("CSRFTOKEN",window.csrfToken).service("CSRFTokenInterceptor",["PATH","CSRFTOKEN",function(e,t){"use strict";return{request:function(n){return-1!==n.url.indexOf(e.REST)?(n.headers=angular.extend(n.headers||{},{"X-Realize-Token":t}),n):n}}}]),angular.module("RealizeDataServices").config(["$httpProvider",function(e){"use strict";e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",e.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded",e.defaults.transformRequest=function(e){if(!angular.isObject(e))return e;var t={};return angular.forEach(e,function(e,n){angular.isFunction(e)||(t[n]=e)}),$.param(t,!0)}}]),angular.module("RealizeDataServices").factory("DatepickerOptions",["$log","Messages","BrowserInfo","$timeout",function(e,t,n,r){"use strict";function s(e){var s=this,a=function(t){(n.browser.isFirefox&&t&&!t._keyEvent||"click"===event.type)&&r(function(){$(e).blur()})};s.fixFocusIE=!1,s.onSelect=function(e,t){s.fixFocusIE=!0,angular.element(this).blur().change().focus(),angular.forEach(s.onSelectCallBacks,function(n){n(e,t)})},s.onClose=function(e,t){s.fixFocusIE=!0,a(t),angular.forEach(s.onCloseCallBacks,function(n){n(e,t)})},s.beforeShow=function(e,t){var r=n.browser.isMSIE?!s.fixFocusIE:!0;return n.browser.isMSIE&&(s.fixFocusIE=!1),angular.forEach(s.beforeShowCallBacks,function(n){n(e,t)}),r},s.monthNames=t.getMessagesAsArray("calendar.monthNames"),s.dayNamesMin=t.getMessagesAsArray("calendar.dayNamesMin"),s.beforeShowCallBacks=[],s.onCloseCallBacks=[],s.onSelectCallBacks=[]}return s.prototype.$setOnSelect=function(e){this.onSelectCallBacks.push(e)},s.prototype.$setOnClose=function(e){this.onCloseCallBacks.push(e)},s.prototype.$setBeforeShow=function(e){this.beforeShowCallBacks.push(e)},s.formatDate=function(e,t){return t=t||0,moment(e).add(t,"days").format("MM/DD/YY")},s}]).factory("StartDatepickerOptions",["$log","DatepickerOptions",function(e,t){"use strict";function n(e,n){t.call(this,e),this.$setBeforeShow(function(){var r=angular.element(n).datepicker("getDate")||0;r&&angular.element(e).datepicker("option","maxDate",t.formatDate(r))})}return n.prototype=Object.create(t.prototype),n.prototype.constructor=t,n}]).factory("EndDatepickerOptions",["$log","DatepickerOptions",function(e,t){"use strict";function n(e,n,r){t.call(this,e),this.$setBeforeShow(function(){var s=angular.element(n).datepicker("getDate")||0;s&&angular.element(e).datepicker("option","minDate",t.formatDate(s,r))})}return n.prototype=Object.create(t.prototype),n.prototype.constructor=t,n}]).factory("RangeDatepickerOptions",["$log","StartDatepickerOptions","EndDatepickerOptions",function(e,t,n){"use strict";function r(e,r,s){this.start=new t(e,r),this.end=new n(r,e,s)}return r}]),angular.module("RealizeApp").service("DatepickerUtil",["$log","KEY_CODES",function(e,t){"use strict";this.customizedKeydownEventForDatepicker=function(e,n){var r,s=e.keyCode||e.which;if(s!==t.TAB){if(e.preventDefault(),e.stopImmediatePropagation(),!_.contains(_.values(t),s))return!1;var a=angular.element(n).val().split("/"),i=new Date(a[2],a[0]-1,a[1]);switch(s){case t.LEFT:(e.ctrlKey||e.metaKey)&&i.setDate(i.getDate()-1),e.altKey&&i.setMonth(i.getMonth()-1);break;case t.UP:(e.ctrlKey||e.metaKey)&&i.setDate(i.getDate()-7),e.altKey&&i.setFullYear(i.getFullYear()+1);break;case t.RIGHT:(e.ctrlKey||e.metaKey)&&i.setDate(i.getDate()+1),e.altKey&&i.setMonth(i.getMonth()+1);break;case t.DOWN:(e.ctrlKey||e.metaKey)&&i.setDate(i.getDate()+7),e.altKey&&i.setFullYear(i.getFullYear()-1);break;case t.PAGE_UP:i.setMonth(i.getMonth()-1),e.ctrlKey&&i.setFullYear(i.getFullYear()-1);break;case t.PAGE_DOWN:i.setMonth(i.getMonth()+1),e.ctrlKey&&i.setFullYear(i.getFullYear()+1);break;case t.ESC:i=null,angular.element(n).datepicker("hide");break;case t.ENTER:angular.element(n).datepicker("hide")}null!==i&&(angular.element(n).datepicker("setDate",i),r=i.getMonth()+1+"/"+i.getDate()+"/"+i.getYear(),angular.element(n).attr("title",r))}}}]),angular.module("RealizeApp").factory("$debounce",["$rootScope","$browser","$q","$exceptionHandler",function(e,t,n,r){"use strict";function s(s,l,c){var u,d,m,g=n.defer(),p=g.promise,f=angular.isDefined(c)&&!c,h=!1;angular.forEach(i,function(e,t){angular.equals(i[t].fn,s)&&(h=!0,m=t)}),h?(a[i[m].timeoutId].reject("bounced"),t.defer.cancel(i[m].timeoutId)):(m=o++,i[m]={fn:s});var v=function(){delete i[m];try{g.resolve(s())}catch(t){g.reject(t),r(t)}f||e.$apply()};return u=t.defer(v,l),i[m].timeoutId=u,d=function(){delete a[p.$$timeoutId]},p.$$timeoutId=u,a[u]=g,p.then(d,d),p}var a={},i={},o=0;return s.cancel=function(e){return e&&a.hasOwnProperty(e.$$timeoutId)?(a[e.$$timeoutId].reject("canceled"),t.defer.cancel(e.$$timeoutId)):!1},s}]),angular.module("RealizeDataServices").factory("FormService",["Modal","$window","$log","ROOT_PATH",function(e,t,n,r){"use strict";var s={},a=["%"];return s.shouldBeDownloadOnly=function(e){var t=["DOC","DOCX","PDF","PPT","PPTX","RTF","TXT"];return $.inArray(e,t)>=0},s.getExtension=function(e){return e.lastIndexOf(".")>=0?e.substring(e.lastIndexOf(".")+1).toUpperCase():void 0},s.getMediaType=function(e){var t={JPG:"Image",GIF:"Image",PNG:"Image",MP3:"Audio",MP4:"Video",DOC:"Document",DOCX:"Document",PPT:"Document",PPTX:"Document",PDF:"Document",TXT:"Document",RTF:"Document"};return t[e]||"Unknown"},s.isValidFileType=function(e){return angular.isDefined(e)?"Unknown"!==s.getMediaType(e):!1},s.containsRestrictedChars=function(e,t){var n=!1,r=a;return angular.isDefined(t)&&angular.isArray(t)&&(r=a.concat(t)),angular.forEach(r,function(t){e.lastIndexOf(t)>=0&&(n=!0)}),n},s.openUserAgreement=function(e){e.stopPropagation(),e.preventDefault(),t.open(r+"/prelogin/userAgreement.html","_blank")},s.setFileValidity=function(e,t,n,r,a){var i=function(e){var t=s.getExtension(e);return s.isValidFileType(t)};a=a||10485760,r=r||i,e.$apply(function(){if(t.files){var e=t.files[0];if(!angular.isDefined(e))return n.$setValidity("required",!1),void 0;n.$setValidity("size",e.size<=a)}else{if(t.value.length<1)return n.$setValidity("required",!1),void 0;n.$setValidity("size",!0)}n.$setValidity("required",!0),n.$setValidity("filetype",r(t.value))})},s.getUploadFileData=function(e){return n.log("getUploadFileData",e),angular.isString(e.file)?e.fileType=s.getExtension(e.file):e.file&&(e.fileType=s.getExtension(e.file.name)),e.mediaType=s.getMediaType(e.fileType),e.restrictedDownloadContent=s.shouldBeDownloadOnly(e.fileType)?"Download Only":"Stream/View",e.associativeProps={},{json:angular.toJson(e)}},s.setFormFieldsDirty=function(e,t){angular.forEach(t,function(t){e[t].$dirty=!0})},s.isFormContainingAnyNonEmptyFields=function(e,t){return t=Array.isArray(t)?t:[t],t.filter(function(t){return angular.isDefined(e[t].$modelValue)?"boolean"==typeof e[t].$modelValue||"object"==typeof e[t].$modelValue?e[t].$modelValue:e[t].$modelValue.length>0:!1}).length>0},s.forceValidPassword=function(e){var t=["pwdLength","pwdLetter","pwdNumber","required"];angular.forEach(t,function(t){e.password.$setValidity(t,!0)})},s}]),angular.module("RealizeApp").factory("Group",["$log","$http","$q","REST_PATH","$rootScope",function(e,t,n,r,s){"use strict";var a=function(e){e.id=e.id||e.groupId,e.name=e.name||e.groupName,e.descr=e.descr||e.groupDescription,e.classMembers=e.classMembers||e.classStudents||{},e.members={},angular.forEach(e.classMembers,function(t,n){e.members[n]={studentIds:t,students:[]}})},i=function(e){var t=this;angular.copy(e||{},t),a(t)};return i.prototype.$getMembers=function(e){var t=this;return t.members[e]||(t.members[e]={studentIds:[],students:[]}),t.members[e]},i.prototype.$syncMembers=function(e){var t=this,n=t.$getMembers(e.classId),r=$.Enumerable.From(e.students);angular.forEach(n.studentIds,function(e){var t=r.FirstOrDefault(null,'$.userId === "'+e+'"');null!==t&&n.students.push(t)})},i.prototype.$save=function(){var i=this,o={},l=null;return i.id?(o={groupName:i.name},l=t.post(r+"/groups/"+i.id,o).then(function(){return s.dirtyAssigneesData=!0,i},function(e){return n.reject("error updating group",e)})):(o={groupName:i.name},l=t.post(r+"/groups",o).then(function(e){return i.id=e.data.groupId||e.data.id,a(i),s.dirtyAssigneesData=!0,i},function(t){return e.log("error creating group",t),n.reject(t)})),l},i.prototype.$saveMembers=function(a){var i,o=this.$getMembers(a).studentIds;return o.length||(o=""),i=t.post(r+"/groups/"+this.id+"/classes/"+a+"/students",{studentIds:o}).then(function(t){return e.log("student update success",t),s.dirtyAssigneesData=!0,t},function(t){return e.error("student update error",t),n.reject(t)})},i.prototype.$delete=function(){},i.prototype.$addStudents=function(e,t){var n=this,r=n.$getMembers(e),s=$.Enumerable.From(r.students);angular.isArray(t)?angular.forEach(t,function(e){null===s.FirstOrDefault(null,'$.userId === "'+e.userId+'"')&&(r.students.push(e),r.studentIds.push(e.userId))}):null===s.FirstOrDefault(null,'$.userId === "'+t.userId+'"')&&(r.students.push(t),r.studentIds.push(t.userId))},i.prototype.$removeStudents=function(e,t){var n=this,r=n.$getMembers(e),s=$.Enumerable.From(r.students);r.students=angular.isArray(t)?s.Except(t).ToArray():s.Except([t]).ToArray(),r.studentIds=$.Enumerable.From(r.students).Select("$.userId").ToArray()},i.getAll=function(){var e=t.get(r+"/groups").then(function(e){var t=[];return angular.forEach(e.data,function(e){t.push(new i(e))}),t},function(e){return n.reject("error getting groups",e)});return e},i.getAllByUser=function(){},i.getAllByOwner=function(e){var n=t.get(r+"/groups/"+e).then(function(e){var t=[];return angular.forEach(e.data,function(e){t.push(new i(e))}),t});return n},i.getById=function(){},i}]),angular.module("RealizeApp").service("InfoModalService",["$log","$location","Messages","$rootScope",function(e,t,n,r){"use strict";var s="BR",a="L",i=this,o=[];i.hideInfoItem=function(e){var t=_.isArray(e)&&_.isEmpty(e.join("").trim()),n=_.isString(e)&&0===e.trim().length;return angular.isUndefined(e)||t||n},i.hideInfoItemFromStudent=function(e){return i.hideInfoItem(e)||r.currentUser.isStudent},i.hideInfoItemOnLevels=function(){return i.hideInfoItemFromStudent(o)};var l=function(e,t){i.hideInfoItemFromStudent(e)||o.push(t+": "+e)},c=function(e){if(e.lexile){for(var t=e.lexile.split(","),n=0;n<t.length;n++)t[n]!==s&&t[n].substr(t[n].length-1,t[n].length)!==a&&(t[n]=parseInt(t[n])<0?s+t[n].substr(1)+a:t[n]+a);e.lexile=t.join(",")}return e.lexile};i.createLevelsArray=function(e){return o=[],l(c(e),n.getMessage("program.info.levels.lexile")),l(e.guidedReading,n.getMessage("program.info.levels.guidedReading")),l(e.readingMaturityMetric,n.getMessage("program.info.levels.readingMaturityMetric")),l(e.developmentalReadingAssessment,n.getMessage("program.info.levels.dra")),l(e.quantile,n.getMessage("program.info.levels.quantile")),o.join("; ")},i.navigateToSourceProgram=function(e){t.search("keywords",null),t.path(e)}}]),angular.module("realize.core.isoDateService",[]).service("ISODateService",[function(){"use strict";this.toDateTimeString=function(e){return e.toString("yyyy-MM-ddTHH:mm:ss")+this.getOffsetFromUTC(e)},this.toDateString=function(e){return e.toString("yyyy-MM-dd")},this.toDateStringWithZone=function(e){return e.toString("yyyy-MM-ddT00:00:00")+this.getOffsetFromUTC(e)},this.toStartOfDayStringWithZone=this.toDateStringWithZone,this.toStartOfNextDayStringWithZone=function(e){var t=e.clone().clearTime().add({days:1});return this.toDateTimeString(t)},this.toEndOfDayStringWithZone=function(e){var t=e.clone().clearTime().add({hours:23,minutes:59,seconds:59});return this.toDateTimeString(t)},this.getStringForOffset=function(e){return(0>e?"+":"-")+this.pad(Math.floor(Math.abs(e)/60),2)+":"+this.pad(Math.abs(e)%60,2)},this.getOffsetFromUTC=function(e){angular.isUndefined(e)&&(e=new Date);var t=e.getTimezoneOffset();return this.getStringForOffset(t)},this.pad=function(e,t,n){angular.isUndefined(t)&&(t=2),angular.isUndefined(n)&&(n="0");var r="";for(r+=e;r.length<t;)r=n+r;return r}}]),angular.module("ModalServices").factory("ModalGet",["$http","$templateCache","$q","$log",function(e,t,n,r){"use strict";return function(s){var a=e.get(s,{cache:t}).then(function(e){return r.log("modal http",s),e.data},function(e){return r.warn("[Modal] getModalHtml ERROR: ",e),n.reject(e)});return a}}]).factory("Modal",["ModalGet","$compile","$log","$timeout","$location","Messages","$q","$rootScope","$window","KEY_CODES","googleClassroomService",function(e,t,n,r,s,a,i,o,l,c,u){"use strict";var d=null,m=angular.element(".modalRegion");e("templates/partials/modal_progress.html");var g=function(){var e=i.defer(),t=angular.element;return angular.isElement(d)?(d.addClass("hide"),r(function(){d.modal("hide"),m.empty(),e.resolve(),angular.element(".modal-backdrop").remove()},400),t("#skipNav a").attr("tabindex",1),t("#globalNav .section a").attr("tabindex",2),t("#keywordSearchDropdown").attr("tabindex",3),t("#usernameDropdown").attr("tabindex",5),t("#globalSearch #SearchTextInput, #globalSearch button").attr("tabindex",4),t("#sectionNav a").removeAttr("tabindex",-1),t("#footer a").removeAttr("tabindex",-1),t("#sectionBody a, #sectionBody area, #sectionBody button, #sectionBody input, #sectionBody object, #sectionBody select, #sectionBody textarea").removeAttr("tabindex",-1),t("#skipTarget, div.customCheckbox input[type='checkbox']").attr("tabindex",-1),t("body").children().removeAttr("aria-hidden","true"),t(".modalRegion").removeAttr("aria-hidden","false"),t(".modal").off("hide")):e.resolve(),e.promise},p=function(s,o){return e(s).then(function(e){return e=e.replace(/<!--[\s\S]*?-->/g,""),g().then(function(){var s,i,l,u;d=$($.trim(e)),m.hide().append(d),o.getMessage=a.getMessage,s=function(){t(d)(o),r(function(){"assignmentModal"===d.attr("id")&&0===d.find(".modal-header h1").length?(n.warn("AssignmentModal's scope is destoryed, not displaying modal"),g()):m.show(),d.find("[auto-focus='']:visible").focus()},10),u=function(e){e.which===c.ESC&&(g(),o.$emit("modal:close"))},$(d).on("keydown",u),o.$emit("modal:shown")},d.on("shown",s),i=function(){o.$emit("modal:hidden")},d.on("hide",i),d.modal({backdrop:"static",keyboard:!1}),$("#skipNav a").attr("tabindex",-1),$("#globalNav .section a").attr("tabindex",-1),$("#usernameDropdown").attr("tabindex",-1),$("#keywordSearchDropdown").attr("tabindex",-1),$("#globalSearch #SearchTextInput, #globalSearch button").attr("tabindex",-1),$("#sectionNav a").attr("tabindex",-1),$("#footer a").attr("tabindex",-1),$("#sectionBody a, #sectionBody area, #sectionBody button, #sectionBody input, #sectionBody object, #sectionBody select, #sectionBody textarea, #sectionBody a").attr("tabindex",-1),$("body").children().attr("aria-hidden","true"),$(".modalRegion").attr("aria-hidden","false"),$(".modal-backdrop").attr("tabindex",-1),$(".quick-list-dropdown .open").removeClass("open"),l=function(){o.$broadcast("modal.hidden")},$(d).on("hidden",l),o.$on("$destroy",function(){d.off("shown",s),d.off("hide",i),$(d).off("hidden",l),u&&$(d).off("keydown",u)})},function(e){return n.error("error destroying dialog",e),i.reject(e)})},function(e){return n.error("error building dialog",e),i.reject(e)})},f=function(){return g()},h=function(e,t){angular.forEach(t,function(t,n){e[n]=t}),angular.isUndefined(e.setProgress)&&(n.log("[[ WARNING ]] progress-modal expecting a setProgress method, none found"),e.setProgress=function(t){e.progressPercent=t}),angular.isUndefined(e.progressPercent)&&(e.progressPercent=0),angular.isUndefined(e.progressIncrement)&&(e.progressIncrement=10);var s,a;e.fakeProgress=function(t){s=t||100,r(function n(){100-(e.progressPercent+e.progressIncrement)>0&&(e.setProgress(e.progressPercent+e.progressIncrement),a=r(n,s))},s)},e.progressComplete=function(t){return a&&r.cancel(a),t=t||1e3,e.setProgress(100),{then:function(e){r(e,t)}}};var o=p("templates/partials/modal_progress.html",e);return o.then(function(){return e},function(e){return n.error("error building progress dialog",e),i.reject(e)}),e.then=function(t){return o.then(t),e},e.close=function(){f()},e},v=function(e,t,n,s){t=angular.copy(t),t.pages=t.previews||[],n&&(t.title=a.getMessage(n));var i=e.$new(!0);return i.selectedTool=t,i.currentPage=1,i.close=function(){f().then(function(){r(function(){s&&s.focus()}),i.$destroy()})},i.download=function(e,t){e.stopPropagation(),e.preventDefault(),t.restrictedDownloadContent.search(/download/gi)>=0&&l.open(t.attachments[0].downloadURL,"_blank")},p("templates/partials/toolPopupModal.html",i)},S={OK:"OK",CANCEL:"CANCEL"},T=function(e,t,r,s){s=s||{};var l=o.$new(!0),c=function(){f().then(function(){l.$destroy()})},u=i.defer(),d=u.promise,m=!1;if(l.buttons=[],angular.isDefined(r)&&angular.isObject(r)){var g=r[S.OK],h=r[S.CANCEL];h&&g?d=d.then(g.handler,h.handler):h?d=d.then(null,h.handler):g&&(m=!0,d=d.then(g.handler,null)),h&&l.buttons.push({buttonType:"cancel",title:h.title?a.getMessageOrDefault(h.title,h.title):a.getMessageOrDefault("Cancel","Cancel"),isDefault:!!h.isDefault,clickHandler:function(){u.reject()}}),g&&l.buttons.push({buttonType:"ok",title:g.title?a.getMessageOrDefault(g.title,g.title):a.getMessageOrDefault("Ok","Ok"),isDefault:!!g.isDefault,clickHandler:function(){u.resolve()}})}else m=!0,l.buttons.push({buttonType:"ok",title:a.getMessageOrDefault("OK","OK"),isDefault:!0,clickHandler:function(){u.resolve()}});return d.then(c,c),s.id&&(l.dialogId=s.id),l.title=a.getMessageOrDefault(e,e),l.body=a.getMessageOrDefault(t,t),l.closeBtnClickHandler=m?u.resolve:u.reject,n.debug("launching simple dialog: ",s,"scope: ",l),p("templates/partials/simpleDialog.html",l)},A=function(){u.setGoogleConsentAsked(!0),s.search("googleConsentAsked","true"),u.redirectToRealizeSyncWebApp(s.absUrl().toString(),"","")},I=function(){return u.setGoogleConsentAsked(!0),g()};return{showDialog:p,hideDialog:f,progressDialog:h,toolDialog:v,simpleDialog:T,cancelGoogleDialog:I,redirectToClassSyncWebapp:A,BUTTONS:S}}]).factory("SessionTimeoutModal",["$rootScope","Modal","$window","ROOT_PATH",function(e,t,n,r){"use strict";var s="templates/partials/session_timeout_dialog.html",a=function(e){s=e},i=function(){n.location.href=r+"/j_spring_security_logout"},o=function(e){i=e},l=function(){var n=e.$new();return n.close=function(e){e.stopPropagation(),e.preventDefault(),t.hideDialog()},n.$on("modal.hidden",i),t.showDialog(s,n)};return{showDialog:l,setTemplate:a,setOnHidden:o}}]),angular.module("Realize.navigationService",["ngRoute"]).factory("NavigationService",["$rootScope","$location","$log","$route","$window",function(e,t,n,r,s){"use strict";var a={};a.stack=[];var i=["/program","/classes","/data"],o=[/classes\/.+\/assignments\/student\/.+/],l=function(e){var t=!1;return angular.forEach(o,function(n){angular.isObject(n)&&n.test(e)?t=!0:e===n&&(t=!0)}),t},c=function(e,t){(!a.stack.length||e!==t&&e!==a.stack[a.stack.length-1])&&($.inArray(e,i)>=0?a.stack=[e]:l(e)||a.stack.push(e))};return a.navigateOutsideAngularContext=function(e){s.location.href=e},a.back=function(e,r){if(a.stack.pop(),r&&a.stack.pop(),!r&&a.stack.length)t.path(a.stack.pop());else{if(!angular.isDefined(e))return n.warn("going back... location stack empty... no fallback provided!"),!1;angular.isFunction(e)?t.path(e(t.path())):angular.isString(e)?t.path(e):angular.isObject(e)&&a.back(angular.element(e.target).scope().navigationFallback,r)}return t.replace(),!0},a.replaceLocationWith=function(e){a.stack.pop(),t.path(e)},a.routeParentByParams=function(){for(var e={},t=!1,n=0;n<arguments.length&&!t;)e.name=arguments[n],r.current.params[e.name+"Id"]&&(e.id=r.current.params[e.name+"Id"],e.version=r.current.params[e.name+"Version"],t=!0),n+=1;return e},e.back=e.goBack=a.back,e.$watch("location.path()",function(t,n){c(t,n),e.$broadcast("navigation.event.location.change")}),e.$on("$routeChangeStart",function(e,t,n){a.previousRoute=n}),a}]).run(["$rootScope","NavigationService",function(e,t){"use strict";e.back=e.goBack=t.back}]),angular.module("Realize.core.security.permissions",[]).provider("Permissions",[function(){"use strict";var e={};this.definePermissions=function(t){angular.forEach(t,function(t){e[t]=!1})},this.setPermissions=function(t){angular.extend(e,t)},this.addPermission=function(t,n){e[t]=n},this.$get=["$injector",function(t){var n=this;return n.getPermissions=function(){return angular.extend({},e)},n.hasPermission=function(n){return e[n]&&t.invoke(e[n])},n}]}]),angular.module("RealizeDataServices.ProgramService",["Realize.content.model.contentItem","Realize.paths","Realize.common.optionalFeaturesService"]).service("ProgramService",["$log","$q","$cacheFactory","Content","$http","MEDIA_TYPE","PATH",function(e,t,n,r,s,a,i){"use strict";
var o=this,l=n("ProgramCache"),c=[i.REST,"allPrograms"].join("/"),u=[i.REST,"programs"].join("/");o.get=function(n,s){var a=n+"_"+s,i=l.get(a);return i?t.when(i):r.get({contentId:n,version:s}).then(function(e){return l.put(a,e),e},function(n){return e.error("Program Service: error getting program data!",n),t.reject(n)})};var d=function(n,s){return n[s]?(n[s].contentItems||(n[s].contentItems=[]),0===n[s].contentItems.length?r.get({contentId:n[s].id,version:n[s].version}).then(function(e){return angular.copy(e,n[s]),e},function(r){return e.error("Program Service: error loading "+s+" for: ",n),t.reject(r)}):t.when(n[s])):t.reject("Program has no "+s)};o.loadAssociatedTools=function(e){return d(e,"associatedTools")},o.loadAssociatedTeacherSupport=function(e){return d(e,"associatedTeacherSupport")},o.getAllStatePrograms=function(){var t=null,n=c;return t=s.get(n,{cache:!0}).then(function(t){e.log("program getAllStatePrograms success handler");var n=[];return angular.forEach(t.data.results,function(e){n.push(new r(e))}),{results:n,totalMatches:t.data.totalMatches}})},o.getAllPrograms=function(){var t=null;return t=s.get(u,{cache:!0}).then(function(t){e.log("program getAllPrograms success handler");var n=[];return angular.forEach(t.data.results,function(e){n.push(new r(e))}),{results:n,totalMatches:t.data.totalMatches}})},o.getProgramByName=function(e){return o.getAllPrograms().then(function(n){var r=_.find(n,function(t){return t.name===e});return r?r.id:t.reject("")})},o.getAllCenters=function(){var t=null,n=[i.REST,"centers"].join("/");return t=s.get(n,{cache:!0}).then(function(t){e.log("program getAllCenters success handler");var n=[];return angular.forEach(t.data.results,function(e){n.push(new r(e))}),{results:n,totalMatches:t.data.totalMatches}})},o.getEssayPromptAccess=function(e){var t=[i.REST,"essayPrompts"].join("/"),n={programs:angular.toJson(e.programs)};return s.get(t,{params:n}).then(function(e){return"true"===e.data.toString()})},o.addCustomisedItemstoList=function(e,t,n){return n.map(function(r,s){r.mediaType!==a.LEARNING_MODEL?r.id===t&&(n[s].showCustomisedVersions=!0,angular.forEach(e,function(e,t){n.splice(s+t+1,0,e)})):r.contentItems.map(function(n,s){n.id===t&&(r.contentItems[s].showCustomisedVersions=!0,angular.forEach(e,function(e,t){r.contentItems.splice(s+t+1,0,e)}))})}),n},o.removeCustomisedItemsfromList=function(e,t){return t=t.filter(function(n,r){return n.mediaType!==a.LEARNING_MODEL?(n.id===e.id&&(t[r].showCustomisedVersions=!1),n.originalItemId!==e.id):(n.contentItems&&(n.contentItems=n.contentItems.filter(function(t,r){return t.id===e.id&&(n.contentItems[r].showCustomisedVersions=!1),t.originalItemId!==e.id})),!0)})}}]),angular.module("RealizeApp").service("ProgramsLandingService",["$log","$q","$rootScope","ProgramService",function(e,t,n,r){"use strict";var s=function(r,s){var a=t.defer(),i=n.currentUser.getAttribute(r)||[];return s.then(function(t){e.log("ProgramsList success handler",arguments);var n,r=t.results,s=r.length,o=$.Enumerable.From(i);for(n=0;s>n;n++)r[n].isFavorite=o.IndexOf(r[n].id)>=0?!0:"",r[n].gradeNumbers?(r[n].gradeNumbers[0]="K"===r[n].gradeNumbers[0]?0:parseInt(r[n].gradeNumbers[0],10),isNaN(r[n].gradeNumbers[0])&&(r[n].gradeNumbers[0]=99)):r[n].gradeNumbers=[99];a.resolve({programs:r,totalMatches:t.totalMatches})}),a.promise};this.getProgramListInfo=function(e){return e?s("programsWithCenters.favorites",r.getAllCenters()):s("programs.favorites",r.getAllPrograms())},this.getEssayPromptAccess=function(e){return r.getEssayPromptAccess(e)}}]),angular.module("RealizeDataServices").factory("RealizeAssignmentDataGenerator",["Content","ASSIGNMENT_CONSTANTS",function(e,t){"use strict";var n=function(n,r,s,a){function i(){return c.editAssignment&&c.itemToBeAssigned&&c.itemToBeAssigned.contentItem}function o(){angular.isDefined(c.itemToBeAssigned.originalEquellaItemId)&&c.createNewAssignment&&(c.itemToBeAssigned.id=c.itemToBeAssigned.originalEquellaItemId)}function l(){var e={};return o(),c.createNewAssignment?e={contentId:c.itemToBeAssigned.id,version:c.itemToBeAssigned.version,levels:"Lesson"===c.itemToBeAssigned.mediaType?3:1}:i()&&(e={contentId:c.itemToBeAssigned.itemUuid,version:c.itemToBeAssigned.itemVersion,levels:"Lesson"===c.itemToBeAssigned.contentItem.mediaType?3:1}),e}var c=angular.extend(this,s);return c.itemToBeAssigned=n,c.createNewAssignment=r,c.editAssignment=!r,c.itemMode=a,c.getContent=function(){var t=l();return e.get({contentId:t.contentId,version:t.version,levels:t.levels,allLanguages:!0})},c.getCustomContent=function(t){return e.getCustomContent(t)},c.getAssignmentData=function(){var e;return c.createNewAssignment?(c.itemToBeAssigned=c.itemMode?c.itemToBeAssigned:c.itemToBeAssigned.$getDefaultVersion(),e=c.createAssignmentObjectInCreateMode(c.itemToBeAssigned),e.title=c.itemToBeAssigned.$getTitle().substring(0,t.TITLE_MAX_LENGTH),c.itemToBeAssigned.assignmentAttachment=c.createAssignmentAttachment(c.itemToBeAssigned)):i()&&(c.itemToBeAssigned.allowRemediation=n.allowRemediation,c.itemToBeAssigned.allowMultipleLanguage=n.allowMultipleLanguage,c.itemToBeAssigned.includeRRSActivity=n.includeRRSActivity,e={title:c.itemToBeAssigned.title,assignees:c.itemToBeAssigned.assignees||[],assignedTo:c.itemToBeAssigned.assignedTo||[],classUuids:c.itemToBeAssigned.classUuids,contentItem:c.itemToBeAssigned.contentItem,assignmentId:c.itemToBeAssigned.assignmentId,groupId:c.itemToBeAssigned.groupId,classUuid:c.itemToBeAssigned.classUuid,userId:c.itemToBeAssigned.userId,multiClassId:c.itemToBeAssigned.multiClassId,itemUuid:c.itemToBeAssigned.itemUuid,itemVersion:c.itemToBeAssigned.itemVersion,updateId:c.itemToBeAssigned.updateId,dueDate:new Date(c.itemToBeAssigned.dueDate).toString("MM/dd/yyyy"),startDate:new Date(c.itemToBeAssigned.startDate).toString("MM/dd/yyyy"),instructions:c.itemToBeAssigned.instructions,allowRemediation:c.itemToBeAssigned.allowRemediation,allowMultipleLanguage:c.itemToBeAssigned.allowMultipleLanguage,includeRRSActivity:c.itemToBeAssigned.includeRRSActivity}),e},c};return n}]),angular.module("RealizeApp").factory("Resolve",["Content","Assessment","ClassRoster","Group","User","AssignmentFacadeService","AssignmentViewOptions","MyContent","$q","$rootScope","$log","$route","AssessmentPlayerService","ReportService","DISTANT_FUTURE_DATE","ProgramsLandingService","$location","NavigationService","ContentSource","CalendarService","CLASS_ROSTER_THEMES","$http","PATH","googleClassroomService","featureManagementService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R){"use strict";var C=function(){function n(e){i.program=e,o()&&a.resolve()}function r(e){i.content=e,o()&&a.resolve()}var s=l.defer(),a=l.defer(),i={program:!1,tier:!1,lesson:!1,content:!1},o=function(){return i.program!==!1&&i.tier!==!1&&i.lesson!==!1&&i.content!==!1};a.promise.then(function(){u.log("content resolve jobs done",i);var e=null;if("na"!==i.lesson){if(i.lesson&&"realize-presenter"===i.lesson.playerTarget){var t=_.map(i.lesson.contentItems,function(e){return"Learning Model"===e.mediaType?e.contentItems:e});i.content.siblings=_.flatten(t)}e=$.Enumerable.From(i.lesson.contentItems).Where("$.id == '"+i.content.id+"'").FirstOrDefault(null),null===e&&$.Enumerable.From(i.lesson.contentItems).Where("$.mediaType == 'Learning Model'").ForEach(function(t){e=$.Enumerable.From(t.contentItems).Where("$.id == '"+i.content.id+"'").FirstOrDefault(null)})}else"na"!==i.tier?e=$.Enumerable.From(i.tier.contentItems).Where("$.id == '"+i.content.id+"'").FirstOrDefault(null):"na"!==i.program&&(e=$.Enumerable.From(i.program.contentItems).Where("$.id == '"+i.content.id+"'").FirstOrDefault(null));null!==e&&(i.content.associativeProps=angular.copy(e.associativeProps)),s.resolve(i.content)}),!d.current.params.programId||d.current.params.lessonId||d.current.params.tierId?n("na"):d.current.params.programId&&c.currentProgram&&c.currentProgram.id===d.current.params.programId&&c.currentProgram.version===d.current.params.programVersion?n(c.currentProgram):e.get({contentId:d.current.params.programId,version:d.current.params.programVersion}).then(function(e){c.currentProgram=e,n(e)}),d.current.params.tierId&&!d.current.params.lessonId?e.get({contentId:d.current.params.tierId,version:d.current.params.tierVersion}).then(function(e){i.tier=e,o()&&a.resolve()}):(i.tier="na",o()&&a.resolve()),d.current.params.lessonId?e.get({contentId:d.current.params.lessonId,version:d.current.params.lessonVersion,levels:3}).then(function(e){i.lesson=e,o()&&a.resolve()}):(i.lesson="na",o()&&a.resolve());var m=S.getByPath(),g=new e({broken:!0,mediaType:"broken"});return m.get({contentId:d.current.params.itemId,version:d.current.params.itemVersion,levels:1}).then(function(n){if(!n.isExternalResource()&&n.$isTestNavTest())t.getInfo(n.id,n.version).then(function(e){e.externalProps&&(n.qtiExternalProps=e.externalProps),r(n)},function(e){u.error("Failed to get assessment info",e),r(g)});else if(angular.isFunction(n.isLtiItem)&&n.isLtiItem()){var s=d.current.params.programId,a=d.current.params.programVersion,i={};s&&(i.programId=s),a&&(i.programVersion=a),e.getLtiLaunchInfo(n.id,n.version,i).then(function(e){n.ltiLaunchSettings=e.settings,n.ltiLaunchParams=e.launchParams,r(n)}).catch(function(e){u.error("Failed to get LTI content item params",e),r(g)})}else r(n)},function(e){u.error("Failed to retrieve item",e),r(g)}),s.promise},D=function(){return n.get(d.current.params.classId).then(function(e){return e.learningExperience=e.learningExperience||A[0].name,c.currentRoster=e,e},function(){return l.reject("error getting roster! "+d.current.params.classId)})},b=function(t){var n=l.defer();if(c.currentProgram&&c.currentProgram.id===d.current.params.programId&&c.currentProgram.version===d.current.params.programVersion)n.resolve(c.currentProgram);else{var r=function(t){c.currentProgram=t;var r={},s="true"===h.search().forceOriginalView?t:t.$getDefaultVersion();if(t.$hasAssociatedItem("Teacher Support")){var a={contentId:t.associatedTeacherSupport.id,version:t.associatedTeacherSupport.version};r.teacherSupport=e.get(a).then(function(e){return s.associatedTeacherSupport=e,e})}r.essayPrompt=f.getEssayPromptAccess(s).then(function(e){return s.hasEssayPromptAccess=e,e}),l.all(r).then(function(){n.resolve(s)},function(e){u.error("Failed to load teacher support",e),n.resolve(s)})},s=function(e){n.reject(e)};t?e.getWithoutInsertingCustomized({contentId:d.current.params.programId,version:d.current.params.programVersion,levels:1}).then(r,s):e.get({contentId:d.current.params.programId,version:d.current.params.programVersion,levels:1}).then(r,s)}return n.promise};return{ProgramListInfo:f.getProgramListInfo,Program:b,eText:function(){var t=l.defer();return b().then(function(n){n.library&&n.library.length>0?e.queryFast({LIBRARY_TITLE:n.library[0],MEDIA_TYPE:"eText",filterBySubscriptions:!0,NOT_ITEM_STATUS:["deleted","archived"]},function(e){t.resolve(e)},function(e){t.reject(e)}):t.resolve([])},function(e){t.reject(e)}),t.promise},ClassRoster:function(){return D()},ClassRosters:function(){return n.get().then(function(e){return e.learningExperience=e.learningExperience||A[0].name,e},function(){return l.reject("error getting rosters!")})},AssignmentErrorData:function(){var e=y.getClassSyncQueryForClassAssignment(d.current.params.classId,d.current.params.assignmentId);return D().then(function(e){return e.isGoogleClass()}).then(function(t){return t&&R.isGoogleClassroomEnabled()?y.classSyncServiceQuery(e).then(function(e){return e}).catch(function(e){return e}):void 0})},GroupList:function(){var e=l.defer();return r.getAll().then(function(t){e.resolve(t)}),e.promise},TeacherAssignmentsByClass:function(){var e=l.defer();return a.getAssignmentsCountByClass(d.current.params.classId).then(function(t){var n={};n.assignmentsCount=t,0===n.assignmentsCount.totalActive?(angular.extend(n,{assignments:[],gradeTypes:[],viewTypes:[]}),e.resolve(n)):a.getAssignmentsByClass(d.current.params.classId).then(function(t){angular.extend(n,{assignments:t.assignments,totalMatched:t.numberOfAssignments,gradeTypes:t.gradeTypes,viewTypes:t.viewTypes,page:t.page}),e.resolve(n)},function(t){e.reject(t)})}),e.promise},TeacherSingleAssignment:function(){var e=function(e,t){var n=e.assignment.getFilteredStudentList(t);return e.notStartedList=n.notStarted,e.inProgressList=n.inProgress,e.completedList=n.completed,e},t=l.all([this.ClassRoster(),a.get(d.current.params.classId,d.current.params.assignmentId)]).then(function(t){var n={};n.roster=t[0],n.assignment=t[1];var r=n.assignment.studentMetadata;n.assignment.contentItem.$isLesson()&&(n.assignment.childContents=n.assignment.$getLessonItems(),r=_.where(n.assignment.studentMetadata,{itemType:"Sequence",assignmentId:n.assignment.assignmentId})),n.assignment.contentItem.isRRS()&&(r=_.where(n.assignment.studentMetadata,{itemType:"Realize Reader Selection",assignmentId:n.assignment.assignmentId}));var a=[];return angular.forEach(r,function(e){var t=_.findWhere(n.roster.students,{userId:e.studentUuid});if(t)e.studentInfo=t;else{var r=s.getUserById(e.studentUuid).then(function(t){return e.studentInfo=t,t?void 0:(u.error("Cannot find matching student: ",e),void 0)});a.push(r)}e.attachmentUrl&&(e.attachmentObj=n.assignment.$getUserAttachment(e.attachmentUrl)),e.$isLate=function(){return n.assignment.$isLate(this)}}),l.all(a).then(function(){return e(n,r)},function(t){return u.error("Failed to retrieve missing students:",t),e(n,r)})});return t},StudentAssignmentsByStatus:function(e){var t=d.current.params.classId,n=c.currentUser.userId,r=i.getStudentFilterByStatus(e);return r.includeCounts=!0,a.getStudentAssignmentsByStatus(t,n,e,r)},StudentAssignmentsCount:function(){var e=d.current.params.classId,t=c.currentUser.userId;return a.getStudentAssignmentsCount(e,t)},StudentAssignmentsByClass:function(){return a.getAssignmentsByClass(d.current.params.classId)},StudentSingleAssignment:function(){return a.get(d.current.params.classId,d.current.params.assignmentId)},SingleLWCAssignment:function(){return a.getLWCAssignment(d.current.params.classId,d.current.params.assignmentId)},TeacherAssignmentData:function(){return a.get(d.current.params.classId,d.current.params.assignmentId)},Lesson:function(t){var n=l.defer(),r=l.defer(),s={lesson:!1,tier:!1,program:!1};r.promise.then(function(){var e;"na"!==s.program&&"na"!==s.tier?e=$.Enumerable.From(s.tier.contentItems).Where("$.id == '"+s.lesson.id+"'").FirstOrDefault(null):"na"!==s.program&&(e=$.Enumerable.From(s.program.contentItems).Where("$.id == '"+s.lesson.id+"'").FirstOrDefault(null)),e&&(s.lesson.associativeProps=angular.copy(e.associativeProps)),n.resolve(s.lesson)}),angular.isDefined(d.current.params.programId)?(angular.isDefined(d.current.params.tierId)?e.get({contentId:d.current.params.tierId,version:d.current.params.tierVersion}).then(function(e){s.tier=e,s.program!==!1&&s.lesson!==!1&&r.resolve()}):s.tier="na",d.current.params.programId&&c.currentProgram&&c.currentProgram.id===d.current.params.programId&&c.currentProgram.version===d.current.params.programVersion?(s.program=c.currentProgram,s.tier!==!1&&s.lesson!==!1&&r.resolve()):e.get({contentId:d.current.params.programId,version:d.current.params.programVersion}).then(function(e){s.program=c.currentProgram=e,s.tier!==!1&&s.lesson!==!1&&r.resolve()})):(s.program="na",s.tier="na");var a="",i="";return d.current.params.itemId&&d.current.params.itemVersion?(a=d.current.params.itemId,i=d.current.params.itemVersion):d.current.params.lessonId&&d.current.params.lessonVersion?(a=d.current.params.lessonId,i=d.current.params.lessonVersion):r.reject("unexpected lesson param name"),t?e.getWithoutInsertingCustomized({contentId:a,version:i,levels:3}).then(function(e){s.lesson=e,s.program!==!1&&s.tier!==!1&&r.resolve()}):e.get({contentId:a,version:i,levels:3}).then(function(e){s.lesson=e,s.program!==!1&&s.tier!==!1&&r.resolve()}),n.promise},Content:C,MyContent:function(){var t=l.defer();return b().then(function(n){var r=o.buildStringOriginalIdCustomizedIdForItem(n);r.then(function(n){o.get({containerId:n,useSearch:!1}).then(function(n){var r=(n.results||[]).map(function(t){return t=new e(t),t.myContent=!0,t});t.resolve(r)},t.reject)})}),t.promise},AssessmentBuilder:function(){return C().then(function(e){var n=l.all([t.getInfo(e.id,e.version),e.$getAssignedStatus(),o.getOriginalIdFromCustomized(e.id)]).then(function(t){return e.assessmentId=t[0].assessmentId,e.active=t[0].active,e.nativeAssessment=t[0].nativeAssessment,e.assignedStatus=t[1],e.originalItemId=t[2].originalItemId,e.userCreated=!1,u.log("BuilderCtrl - Assessment loaded!",e.assessmentId,": active = ",e.active),e});return n})},UserCreatedAssessment:function(){var e=this.AssessmentBuilder();return e.then(function(e){return e.userCreated=!0,e})},EssayPromptAssessment:function(){return this.EssayPromptBuilder().then(function(e){return e.isNewTest=!1,e})},EssayPromptBuilder:function(){return C().then(function(e){var n=l.all([t.getInfo(e.id,e.version),o.getOriginalIdFromCustomized(e.id)]).then(function(n){return e.assessmentId=n[0].assessmentId,e.originalItemId=n[1].originalItemId,t.loadAssessment(e.assessmentId,!0)});return n})},CreateAssessment:function(){return b().then(function(){return{userCreated:!0,active:!0,inMyLibrary:!0}})},Remediation:function(){function n(e,t){!e["spanish description"]||""===e["spanish description"]||"Spanish"!==t&&"es"!==c.currentUser.getAttribute("profile.locale")||(e.description=e["spanish description"])}function r(t,n){return e.getAssessment(t).then(function(e){var t=e.data,r=$.Enumerable.From(t.questions).Where("$.skillDetails && $.skillDetails.length > 0"),s={};return angular.forEach(n.remediationSkills,function(e,t){var n=r.Where(function(t){return $.Enumerable.From(t.skillDetails).Where(function(t){return t.id===e.name}).Count()>0}).ToArray();e.associatedQuestions=n,n&&n.length>0&&(s[t]=e)}),n.remediationSkills=s,u.debug("promise in getQuestionsGroupedBySkills"),n})}var s,a,i,o,m,g=l.defer();return a=function(e){return e.remediationType&&"enrichment"===e.remediationType.toLowerCase()},i=function(e){return!a(e)},o=function(t,r){var s,a=!1;return t.remediationSkills={},angular.forEach(t.associatedRemediation.contentItems,function(o){i(o)&&angular.forEach(o.skills,function(i){n(r[i],o.language),t.remediationSkills[i]||(a=!0,s=r&&r[i]&&r[i].description?r[i].description:i,t.remediationSkills[i]={name:i,description:s,items:[]}),t.remediationSkills[i].items.push(new e(o))})}),a?m(t):void 0},m=function(e){return t.getInfo(e.id,e.version).then(function(e){var t=e.assessmentId;return u.debug("buildQuestionsMap: got assessment id "+t),t}).then(function(t){return r(t,e)})},e.get({contentId:d.current.params.itemId,version:d.current.params.itemVersion,levels:2}).then(function(t){return u.debug("content resolver"),t.enrichment=[],$.Enumerable.From(t.associatedRemediation.contentItems).Where(a).Distinct().ForEach(function(n){t.enrichment.push(new e(n))}),s=$.Enumerable.From(t.associatedRemediation.contentItems).Where(i).SelectMany("$.skills").Distinct().ToArray(),t}).then(function(t){u.debug("next promise after content resolver"),s.length>0?e.getSkillsById(s).then(function(e){return u.debug("next promise after skills 1"),e.data}).then(function(e){return u.debug("next promise after skills 2"),o(t,e)}).then(function(){u.debug("next promise after buildRemediationMap with skills"),g.resolve(t)},function(e){u.error("error handler in remediation viewer"+e),g.resolve(t)}):(o(t,{}),u.debug("next promise after buildRemediationMap without skills"),g.resolve(t))},function(e){u.error("error in getting remediation content ",e),g.reject({type:"back",itemNotFound:!0})}),g.promise},Tier:function(){var t=l.defer(),n=l.defer(),r={tier:!1,program:!1};return n.promise.then(function(){u.log("tier resolve jobs done",r);var e=$.Enumerable.From(r.program.contentItems).Where("$.id == '"+r.tier.id+"'").FirstOrDefault(null);if(null!==e&&(r.tier.associativeProps=angular.copy(e.associativeProps)),r.tier.$hasAssociatedItem("Teacher Support")){var n=r.tier.$setAssociatedItem("Teacher Support");n.then(function(){t.resolve(r.tier)})}else t.resolve(r.tier)}),e.get({contentId:d.current.params.itemId,version:d.current.params.itemVersion,levels:1}).then(function(e){r.tier=e,r.program!==!1&&n.resolve()}),d.current.params.programId&&c.currentProgram&&c.currentProgram.id===d.current.params.programId&&c.currentProgram.version===parseInt(d.current.params.programVersion)?(r.program=c.currentProgram,r.tier!==!1&&n.resolve()):e.get({contentId:d.current.params.programId,version:d.current.params.programVersion}).then(function(e){r.program=c.currentProgram=e,r.tier!==!1&&n.resolve()}),t.promise},StudentClasses:function(){var e=l.defer(),t=a.getClassesReportingData();return t.then(function(t){var n=[],r=[];n=t,$.Enumerable.From(n).OrderBy("$.reportingData.nextAssignmentDueDate").ForEach(function(e){e.minAssignment=e.reportingData.nextAssignmentDueDate?e.reportingData.nextAssignmentDueDate:p,e.numCompletedAssignments=e.reportingData.assignmentCompletionCount}),r=$.Enumerable.From(n).OrderBy("$.minAssignment").ToArray(),e.resolve(r)}),e.promise},StudentRostersOnly:function(){return n.get({studentId:!0})},Classes:function(){return a.getClassesReportingData()},StudentItemAnalysis:function(){var e=l.defer(),t=function(){m.finalReport(d.current.params.sessionId,!0).then(function(t){var n=g.studentTestReportList;g.currentProgram&&(n=_.filter(g.studentTestReportList,function(e){return 1===e.programs.length&&e.programs[0]===g.currentProgram})),e.resolve({assessments:n,current:t})})};if(g.studentTestReportList)t();else{var n=d.current.params.filterStartDate.replace(/-/g,"/"),r=d.current.params.filterEndDate.replace(/-/g,"/");g.getStudentTestReport(d.current.params.classId,c.currentUser.userId,n,r).then(function(){t()})}return e.promise},StudentProgressRecap:function(){var e,t=l.defer(),n={filters:{}},r=function(){n.filters.startDate=d.current.params.filterStartDate.replace(/-/g,"/"),n.filters.endDate=d.current.params.filterEndDate.replace(/-/g,"/"),n.filters.program=null,n.counts=g.studentProgressRecapCounts,e=g.getStudentProgressRecap(d.current.params.classId,n.filters.startDate,n.filters.endDate,n.filters.program,d.current.params.status),e.then(function(e){n.assignments=e,t.resolve(n)})};if(g.studentProgressRecapCounts)r();else{var s=d.current.params.filterStartDate.replace(/-/g,"/"),a=d.current.params.filterEndDate.replace(/-/g,"/");e=g.getStudentProgressReportForStudent(d.current.params.classId,s,a),e.then(function(){r()})}return t.promise},CalendarEvents:function(){var e=c.currentUser.getAttribute("classCalendar.view")||"month",t=c.currentUser.getAttribute("classCalendar.currentRefDate")||new Date,n=T.getDateRange(t,e);return T.getEvents(d.current.params.classId,{start:n.startDate,end:n.endDate})},CentersProgramListInfo:function(){return f.getProgramListInfo(!0)},CurrentProgramLoaded:function(){var t=l.defer();if(c.currentProgram&&c.currentProgram.id===d.current.params.programId&&c.currentProgram.version===d.current.params.programVersion&&!c.currentProgram.programDirty)t.resolve();else{var n=angular.isDefined(d.current.params.programId)&&angular.isDefined(d.current.params.programVersion);n?e.get({contentId:d.current.params.programId,version:d.current.params.programVersion,levels:1},!0).then(function(e){c.currentProgram=e,t.resolve()}):(c.currentProgram=void 0,t.resolve())}return t.promise},CenterContainer:function(){return e.get({contentId:d.current.params.centerContainerId,version:d.current.params.centerContainerVersion,levels:1},!0).then(function(e){return e.$setAssociatedItem("Teacher Support",!0).then(function(){return e})},function(){l.reject()})},CenterContainerTier:function(){var t=l.defer();return e.get({contentId:d.current.params.itemId,version:d.current.params.itemVersion,levels:1},!0).then(function(e){var n=v.routeParentByParams("tier","centerContainer"),r=e.$propagateAssociativeProps(n),s=[r];if(e.$hasAssociatedItem("Teacher Support")){var a=e.$setAssociatedItem("Teacher Support");s.push(a)}return l.all(s).then(function(){t.resolve(e)})}),t.promise},CenterContent:function(){var t=l.defer();return e.get({contentId:d.current.params.itemId,version:d.current.params.itemVersion,levels:1},!0).then(function(e){var n=v.routeParentByParams("center","tier2","tier","centerContainer"),r=e.$propagateAssociativeProps(n),s=[r];if(e.$hasAssociatedItem("Tools")){var a=e.$setAssociatedItem("Tools");s.push(a)}if(e.$hasAssociatedItem("Teacher Support")){var i=e.$setAssociatedItem("Teacher Support");s.push(i)}return l.all(s).then(function(){t.resolve(e)})}),t.promise},UserMapping:function(){var e=l.defer(),t=E.REST+"/externalMappings/user/";return I.get(t).then(function(t){var n=t.data;e.resolve(n)}).catch(function(t){e.reject(t)}),e.promise}}}]),angular.module("Realize.rss.RssSvc",[]).provider("RssSvc",[function(){"use strict";var e;this.setUrl=function(t){e=t},this.$get=["$log","$http",function(t,n){var r=this,s=function(e){return e.data},a=function(e){return e};return r.query=function(t,r){return n.get(e+t,{params:r}).then(s,a)},r.get=function(t,r,i){return n.get(e+t+"/"+r,{params:i}).then(s,a)},r}]}]),angular.module("Realize.Interceptors.SessionTimeout",[]).provider("SessionTimeoutService",function(){"use strict";var e=[];this.addEventHandler=function(t,n){(!n||0>n)&&(n=0),e.push({eventHandler:t,priority:n}),e=_.sortBy(e,function(e){return-1*e.priority})},this.$get=["$q","$log","$injector",function(t,n,r){var s=this,a=!1;s.setSessionExpiryStatus=function(e){a=e||a},s.getSessionExpiryStatus=function(){return a},s.getEventHandlerChain=function(){return e},s.breakOutOfChain=function(e){return t.reject(e)};var i=s.continueToNextInChain=function(e){return e};return s.executeEventHandlers=function(n){var s,a,o,l,c;for(0===e.length&&t.reject(n),s=0,l=function(){c=angular.isString(e[s].eventHandler)?r.get(e[s].eventHandler):r.invoke(e[s].eventHandler)},l(),a=t.when(c(n)),s=1;s<e.length;s++)l(),o=c,a=a.then(o,i);return a},s}]}).config(["$httpProvider",function(e){"use strict";var t=["$q","SessionTimeoutService",function(e,t){return{responseError:function(n){return 401===n.status?t.executeEventHandlers(n):e.reject(n)}}}];e.interceptors.push(t)}]),angular.module("Realize.tinCanConfigService",["Realize.paths"]).service("TinCanConfigService",["$http","$log","$q","PATH",function(e,t,n,r){"use strict";var s=this;s.getTinCanSCOSettings=function(s){var a=r.REST+"/tincan/configs?userAssignmentId="+s;return e({url:a,method:"GET"}).then(function(e){return e.data},function(e){return t.error("error getting tincansco settings",e),n.reject("error getting incansco settings",e)})},s.getTinCanAuthToken=function(){var s=r.REST+"/tincan/authorization";return e({url:s,method:"GET"}).then(function(e){return e.data},function(e){return t.error("error getting authorization token",e),n.reject("error getting authorization token",e)})}}]),angular.module("Realize.sidebar.ShowSidebar",[]).directive("showSidebar",["$rootScope",function(e){"use strict";return{link:function(t,n){n.on("click",function(){e.$broadcast("sidebar:open"),$("html, body").animate({scrollTop:0},0)})}}}]),angular.module("Realize.sidebar.GroupsSidebarCtrl",["RealizeApp","Realize.content","Realize.common.alerts"]).controller("GroupsSidebarCtrl",["$scope","$rootScope","$location","InlineAlertService","Content","Messages","Modal","TEMPLATE_PATH","$filter","Group","$log",function(e,t,n,r,s,a,i,o,l,c,u){"use strict";e.getMessage=a.getMessage,c.getAll().then(function(t){var n=e.content;e.groups=t,angular.forEach(e.groups,function(e){e.$syncMembers(n)}),e.$emit("$dataLoaded")},function(e){u.log("error getting groups!",e)}),e.getStudentCount=function(t){var n=e.content,r=$.Enumerable.From(t.$getMembers(n.classId).students);return r.Count()},e.studentPopover=function(t){var n=e.content,r=$.Enumerable.From(t.$getMembers(n.classId).students),s=r.Select("$.lastFirst").ToArray().sort(),i=s.slice(0,10).join("<br>"),o=r.Count()-10,c="<br><i>"+a.getMessage("studentList.groups.sidebar.moreCount")+"</i>";return c=o>0?l("replace")(c,o):"",i.length>0?i+c:a.getMessage("studentList.groups.sidebar.zeroState.message")},e.studentList=function(t,n){t&&(t.preventDefault(),t.stopPropagation());var r=e.$new();r.students=n.$getMembers(e.content.classId).students;var s=function(){r.$destroy()};r.done=function(){i.hideDialog(),s()},i.showDialog("templates/partials/groups_student_list.html",r)},e.hide=function(t){t.stopPropagation(),e.show=!1},e.manageGroup=function(t,n){t&&(t.preventDefault(),t.stopPropagation());var s=e.$new(!0),o=function(){s.$destroy()};s.cancel=function(){i.hideDialog(),o()},s.readyToSave=function(){return!s.isInProgress&&!s.createGroupForm.$invalid&&!s.createGroupForm.name.$pristine},s.save=function(){s.isInProgress=!0,s.group.$save().then(function(){var t="groupUpdated";s.isEditing?angular.copy(s.group,n):(e.groups.push(angular.copy(s.group)),t="groupCreated"),i.hideDialog(),r.addAlert(s.group.id,{type:"success",msg:["<strong>",a.getMessage("studentList.groups.manage.successNotification."+t+".title"),"</strong> ",a.getMessage("studentList.groups.manage.successNotification."+t+".message")].join("")}),o()},function(){})},angular.isDefined(n)?(s.isEditing=!0,s.group=angular.copy(n)):(s.isEditing=!1,s.group=new c),s.group.classId=e.content.classId,i.showDialog("templates/partials/groups_manage.html",s)},e.manageGroupStudents=function(t,n){e.manageStudentsMode=!0,e.managingGroupId=n.id,e.$emit("manageStudentsMode",n)};var d=function(){e.manageStudentsMode=!1};e.$on("manageStudentsCanceled",d),e.$on("manageStudentsCompleted",d)}]),angular.module("Realize.sidebar",["Realize.sidebar.PlatformSidebar","Realize.sidebar.ShowSidebar","Realize.sidebar.GroupsSidebarCtrl","Realize.sidebar.TeacherSupportSidebarCtrl","Realize.sidebar.StudentEtextToolsSidebarCtrl"]),angular.module("Realize.sidebar.PlatformSidebar",["Realize.user.currentUser","Realize.paths"]).directive("platformSidebar",["currentUser","$timeout",function(e,t){"use strict";var n=600;return{scope:{content:"=",show:"=",openHandler:"=",indexFocus:"=?"},replace:!1,templateUrl:"templates/sidebar/sidebar.platform.html",link:function(r,s,a){function i(e){e&&(angular.isUndefined(r.indexFocus)||r.indexFocus)&&t(function(){s.find("a").first().focus()},n,!1)}r.template=a.template,r.currentUser=e,r.$on("$dataLoaded",function(){t(function(){i(!1)})}),r.$on("sidebar:close",function(){t(function(){r.show=!1})}),r.$on("sidebar:open",function(){t(function(){r.show=!0,i(!0)})})}}}]),angular.module("Realize.sidebar.StudentEtextToolsSidebarCtrl",["RealizeApp","ModalServices","RealizeDataServices","Realize.content"]).controller("StudentEtextToolsSidebarCtrl",["$log","$scope","$rootScope","$location","$timeout","$window","Modal","Content","Messages",function(e,t,n,r,s,a,i,o,l){"use strict";t.currentUser=n.currentUser,t.getMessage=l.getMessage,t.openTool=function(e,n){if(e.stopPropagation(),"Document"===n.mediaType)i.toolDialog(t,n);else if(n.attachments.length){var r=n.attachments[0].file;/^https?:\/\//.test(r)?"Desmos"===n.mediaType?a.open(r,"desmos"):a.open(r,"_blank"):a.open("http://"+r,"_blank")}},t.openEtext=function(e,t){e.stopPropagation(),r.path(["content",t.id,t.version].join("/"))}}]),angular.module("Realize.sidebar.TeacherSupportSidebarCtrl",["RealizeApp","RealizeDataServices","Realize.content","webStorageModule"]).controller("TeacherSupportSidebarCtrl",["$log","$scope","$rootScope","$location","$timeout","Content","Messages","lwcI18nFilter",function(e,t,n,r,s,a,i,o){"use strict";t.currentUser=n.currentUser,t.getMessage=i.getMessage,t.open=function(e,n){e.stopPropagation(),t.openHandler.call(null,e,n)},t.hide=function(e){e.stopPropagation(),t.show=!1},t.isCustomizedItem=function(e){return e.$isCustomizedTest()?o("content.action.editCustomize"):o("program.action.customize")},t.canUserEditAssessment=n.currentUser.hasRole("ROLE_TEACHER");var l=r.path().indexOf("program")>=0,c=r.path().indexOf("lesson")>=0,u=r.path().indexOf("centers")>=0,d=r.path().indexOf("center/")>=0;
t.removeHideQuicklinkinTeacherResource=function(){return(l||c)&&!u&&!d}}]),angular.module("Realize.user.currentUser",["Realize.paths","RealizeDataServices"]).provider("$currentUser",function(){"use strict";var e={};this.setPreloadData=function(t){e=t},this.$get=["User","$http","$log","$q","REST_PATH","$cacheFactory",function(t,n,r,s,a,i){var o=new t(e);return o.updateProductSubscriptions=function(e){e=angular.isArray(e)?e:[e];var t=a+"/user/subscribe";return n.post(t,{"courses[]":e}).then(function(e){return o.subscribedCourses=e.data,angular.forEach(o.oleAffiliations,function(e){angular.forEach(e.products,function(e){_.contains(o.subscribedCourses,e.productName)&&(e.subscribed=!0)})}),o.subscribedCourses},function(e){return r.debug("error updating subscriptions: ",e.data),s.reject(e.data)}).finally(function(){var e=[a,"programs"].join("/"),t=[a,"centers"].join("/"),n=i.get("$http");n.remove(e),n.remove(t)})},o}]}),angular.module("RealizeDataServices").service("RumbaDataService",["$http","$q","REST_PATH",function(e,t,n){"use strict";var r=this;r.getOrgDetails=function(r){return e.get(n+"/rumba/orgs",{params:{"id[]":r},cache:!0}).then(function(e){return e.data},function(e){return t.reject(e)})},r.checkUsernameAvailability=function(r){var s=n+"/check_username";return e.get(s,{params:{username:r},cache:!0}).then(function(e){return e.data},function(e){return t.reject(e)})},r.getProductDetails=function(r){var s=n+"/rumba/products/"+r;return e.get(s,{cache:!0}).then(function(e){return e.data},function(e){return t.reject(e)})}}]),angular.module("RealizeDataServices").directive("rumbaEmailValidate",[function(){"use strict";return{require:"ngModel",link:function(e,t,n,r){var s=function(t){if(!angular.isString(t)||_.isEmpty(t))return e.$eval(n.ngDisabled);var s,a="",i=t.split("@");s=i[0],2===i.length&&(a=i[1]);var o=a&&a.length>0,l=a&&"-"!==a[0],c=a&&"_"!==a[0]&&"_"!==a[a.length-1],u=a&&/^([^\.]+\.[^\.]+)+$/g.test(a),d=s&&!s.match(/\.\./);return r.$setValidity("emailDomainRequired",o),r.$setValidity("emailDomainHyphenStart",l),r.$setValidity("emailDomainUnderscoreRule",c),r.$setValidity("emailDomainPeriodRule",u),r.$setValidity("emailPeriodRule",d),o&&l&&c&&u&&d};r.$parsers.unshift(function(e){var t=s(e);return r.$setValidity("email",t),t?e:void 0}),r.$formatters.unshift(function(e){return r.$setValidity("email",s(e)),e})}}}]),angular.module("RealizeDataServices").directive("rumbaPasswordValidate",[function(){"use strict";return{require:"ngModel",restrict:"A",link:function(e,t,n,r){if(!n.rumbaPasswordValidate)throw"You must supply the user object to validate against as the value of the directive attribute.";var s=function(t){var s=e.$eval(n.rumbaPasswordValidate),a=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};if(!(n.disallowEmpty||angular.isString(t)&&t))return r.$setValidity("pwdLength",!1),r.$setValidity("pwdNumber",!0),r.$setValidity("pwdLetter",!0),void 0;var i=t.length>=8,o=t.length<=32,l=/[A-z]/.test(t),c=/\d/.test(t)||/[\~\!\@\#\$\%\^\&\*\(\)\_\-\+\=\|\,\.\]\[\'\:\;\?\\\/><\`\{\}\"]/.test(t),u=angular.isDefined(s.userName)&&s.userName.length&&t.search(new RegExp(a(s.userName),"ig"))<0||!(s.userName&&s.userName.length&&t.length),d=angular.isDefined(s.firstName)?t.search(new RegExp(s.firstName,"ig"))<0||!(s.firstName&&s.firstName.length&&t.length):!0,m=angular.isDefined(s.lastName)?t.search(new RegExp(s.lastName,"ig"))<0||!(s.lastName&&s.lastName.length&&t.length):!0,g=/^\S*$/.test(t);return r.$setValidity("pwdLength",i),r.$setValidity("pwdMaxLength",o),r.$setValidity("pwdLetter",l),r.$setValidity("pwdNumber",c),r.$setValidity("pwdUsername",u),r.$setValidity("pwdFirst",d),r.$setValidity("pwdLast",m),r.$setValidity("pwdSpaces",g),r.$setValidity("pwd",i&&l&&c&&u&&d&&m&&g),t};r.$parsers.unshift(s),r.$formatters.unshift(s),n.revalidateWith&&e.$watch(n.revalidateWith,function(){s(r.$viewValue)})}}}]),angular.module("RealizeDataServices").directive("rumbaUsernameAvailable",["$log","RumbaDataService",function(e,t){"use strict";return{require:"ngModel",link:function(e,n,r,s){s.$parsers.unshift(function(e){return e&&t.checkUsernameAvailability(e).then(function(t){s.$viewValue===e&&s.$setValidity("rumbaUsername",t&&"false"!==t)}),e})}}}]),angular.module("RealizeDataServices").directive("rumbaUsernameValidate",[function(){"use strict";return{require:"ngModel",link:function(e,t,n,r){r.$parsers.unshift(function(e){if(e){var t=/^[^,\s]+$/;return r.$setValidity("minLength",e.length>=1),r.$setValidity("maxLength",e.length<=75),r.$setValidity("pattern",t.test(e)),e}})}}}]),angular.module("RealizeDataServices").constant("USER_ATTRIBUTE_KEY",{DISMISS_OPEN_ED_SEARCH_TIPS_FOREVER:"open_ed.search.tips.dismiss.forever"}).provider("User",function(){"use strict";var e="/avatars/",t=["en","es"],n="en";this.setBaseAvatarImagePath=function(t){e=t},this.$get=["$q","$http","$log","$cacheFactory","REST_PATH","RumbaDataService","$rootScope","$window","BrowserInfo","NBC_PROGRAM_NAME",function(r,s,a,i,o,l,c,u,d,m){function g(e){var t=this;t.userAttributes={},e&&angular.copy(e,t),t.emailAddress=t.rumbaEmail,t.$updateNames(),t.oleAffiliations=_.uniq(t.oleAffiliations,function(e){return e.organizationId});var n=_.pluck(t.oleAffiliations,"organizationId");n.length>0&&l.getOrgDetails(n).then(function(e){angular.forEach(e,function(e){var n=_.findWhere(t.oleAffiliations,{organizationId:e.organizationId});if(n){n.orgDetails=e;var r=t.getStateCode();n.orgDetails.organizationId===t.primaryOrgId&&!r&&t.hasRole("ROLE_LIBRARY_ADMIN")&&t.setStateCode(e.state)}})}),"Student"===t.primaryOrgRole&&"lti-org-id"!==t.primaryOrgId&&"student_center_org_id"!==t.primaryOrgId&&l.getProductDetails(t.primaryOrgId).then(function(e){t.productIdMap={},angular.forEach(e,function(e){t.productIdMap[e.productId]=e.productDisplayName})}),t.$setAvatar(t.getAttribute("profile.avatar")),t.isLibraryAdmin=t.hasRole("ROLE_LIBRARY_ADMIN"),t.isTeacher=t.hasRole("ROLE_TEACHER"),t.isStudent=t.hasRole("ROLE_STUDENT"),t.isReviewer=t.hasRole("ROLE_REVIEWER"),t.isContentReviewer=t.hasRole("ROLE_CONTENT_REVIEWER"),t.isContentPromoter=t.hasRole("ROLE_CONTENT_PROMOTER"),t.userAttributes&&(t.isNativeRealizeUser="native"===t.userAttributes.userDomain,t.isFederatedUser="federated"===t.userAttributes.userDomain,t.userAttributes["profile.locale"]=t.$validateLocale(t.userAttributes["profile.locale"])),t.userTheme=t.getAttribute("profile.learningExperience"),t.inactiveRosterCount=0,t.TEACHER_RESOURCES_DRAWER_KEY="teacherResourceDrawerOpen_"+t.userId}function p(e){i.get("$http").put(o+"/check_username?username="+e,[200,!1])}return g.prototype.$getAffiliationsOrgIds=function(){return _.unique(_.pluck(this.affiliations,"organizationId"))},g.prototype.$setAvatar=function(t,n){var s=this,a=r.defer();return angular.isDefined(n)||(n=!0),s.setAttribute("profile.avatar",t,n).then(function(){var t=e,n=s.getAttribute("profile.avatar");t+="Student"===s.primaryOrgRole?n||"default_student":n||"default_teacher",s.avatarUrl=t+(d.isHDDisplay?"@2x.png":".png"),a.resolve(s)},a.reject),a.promise},g.prototype.$setLocale=function(e,t,n){angular.isDefined(t)||(t=!0);var r=this;return e=r.$validateLocale(e),a.log("user $setLocale",e),r.setAttribute("profile.locale",e,t).then(function(){n||c.$broadcast("user.locale.changed",r,e)})},g.prototype.$validateLocale=function(e){return e||(e=u.systemLang),-1!==t.indexOf(e)?e:n},g.prototype.$getIpadPreview=function(e,t){s.get(e.ipadTokenRetrievalUrl).then(function(n){var r=e.ipadUrl.replace("{IPAD_TOKEN}",n.data);t(r)})},g.prototype.$toggleAttribute=function(e){var t=this;if(t.userAttributes){t.userAttributes[e]=t.userAttributes[e]?!1:!0;var n=s.post(o+"/user/attribute",$.param({key:e,val:t.userAttributes[e]}));return n}},g.prototype.setAttribute=function(e,t,n){var a=this,i=r.defer();if(angular.isDefined(n)||(n=!0),!a.userAttributes||a.getAttribute(e)===t)return i.resolve(),i.promise;if(a.userAttributes[e]=angular.copy(t),angular.isString(t)||(t=angular.toJson(t)),n){var l=s.post(o+"/user/attribute",$.param({key:e,val:t}));return l}return i.resolve(),i.promise},g.prototype.getAttribute=function(e,t){var n,r=this;if(r.userAttributes){if(t){var a=s.get(o+"/user/attribute").then(function(t){r.userAttributes[e]=t.data[e]});return a}try{n=angular.fromJson(r.userAttributes[e])}catch(i){n=r.userAttributes[e]}return n}},g.prototype.deleteAttribute=function(e){var t=s.delete(o+"/user/attribute?key="+e);return t},g.prototype.hasRole=function(e){return _.contains(this.roles,e)},g.prototype.$getInactiveRosterCount=function(){var e=this,t=Number(e.inactiveRosterCount);return isNaN(t)?0:t},g.prototype.$setInactiveRosterCount=function(e){var t=this;e=Number(e),t.inactiveRosterCount=isNaN(e)?0:e},g.prototype.showNoProgramModal=function(e){var t=this,n=t.getAttribute("classes.withoutPrograms")||[],r=e?!1:t.getAttribute("hideNoProgramModal");return n.length>0&&!r},g.prototype.removeClassWithoutPrograms=function(e){var t=this,n=t.getAttribute("classes.withoutPrograms")||[],r=n.indexOf(e);return r>-1?n.splice(r,1):n},g.prototype.addClassWithoutPrograms=function(e){var t=this,n=t.getAttribute("classes.withoutPrograms")||[],r=n.indexOf(e);return r>-1?n:n.push(r)},g.prototype.$hasCenter=function(){var e=this;return e.isLibraryAdmin||e.getAttribute("hasCenter")},g.prototype.$hasLeveledReader=function(){var e=this;return e.getAttribute("hasLeveledReader")},g.prototype.$create=function(){var e=this,t=s.post(o+"/rumba/user/create_user",{firstName:e.firstName,lastName:e.lastName,userName:e.userName,password:e.password,"orgIds[]":[e.organizationId]});return t.success(function(t){p(e.userName),angular.extend(e,t)}),t},g.prototype.$save=function(){var e,t=this,n=o+"/user",i=!1;angular.isDefined(t.userId)&&t.userId.length>0&&(n+="/"+t.userId,i=!0),t.orgIds=t.organizationId?[t.organizationId]:t.primaryOrgIds&&t.primaryOrgIds.length>0?t.primaryOrgIds:t.primaryOrgId&&t.primaryOrgId.length>0?[t.primaryOrgId]:[],e=angular.copy(t),i&&(e.password=null,e.middleName||(e.middleName=null));var l=s.post(n,e).then(function(e){return a.log("saved user",e),delete e.data.password,angular.extend(t,e.data),i||p(t.userName),t},function(e){return"ULC0003W"===e.errorCode?(angular.extend(t,e.data),t):(a.error("RUMBA creation ERROR:",e),r.reject("RUMBA creation ERROR:"+e))});return l},g.prototype.$update=function(){var e=o+"/user/"+this.userId;c.dirtyAssigneesData=!0;var t={userName:this.userName,firstName:this.firstName,lastName:this.lastName,emailAddress:this.emailAddress,password:this.password};return this.middleName&&this.middleName.length>0&&(t.middleName=this.middleName),s.post(e,t)},g.updatePasswordForUser=function(e,t,n){e.password=n;var r=o+"/user/"+e.userId+"/password";return s.post(r,{currentPassword:t,newPassword:n,csrfToken:u.csrfToken})},g.prototype.$setFirstName=function(e){this.firstName=e,this.$updateNames()},g.prototype.$setLastName=function(e){this.lastName=e,this.$updateNames()},g.prototype.$setMiddleName=function(e){var t=this;this.middleName=e,this.setAttribute("profile.middleName",e,t.userId===c.currentUser.userId).then(function(){t.$updateNames()})},g.prototype.$setLastFirst=function(e){if(angular.isString(e)&&-1!==e.search(",")){var t=e.split(","),n=t[0].trim(),r=t[1].trim();this.firstName=r,this.lastName=n,this.$updateNames()}},g.prototype.$updateNames=function(){!angular.isString(this.middleName)&&this.getAttribute("profile.middleName")&&(this.middleName=this.getAttribute("profile.middleName")),this.fullName=this.middleName&&$.trim(this.middleName).length>0?[this.firstName,this.middleName,this.lastName].join(" "):[this.firstName,this.lastName].join(" "),this.firstAndLast=[this.firstName,this.lastName].join(" "),this.lastFirst=[this.lastName,this.firstName].join(", ")},g.prototype.$canCustomizeItems=function(){return c.currentUser.hasRole("ROLE_TEACHER")},g.findStudents=function(e){return a.log("findStudents",e),angular.isDefined(e)||(e={}),angular.isDefined(e.pageSize)||(e.pageSize=15),s.get(o+"/student_search",{params:e}).success(function(e){var t=[];return angular.forEach(e.users,function(e){t.push(new g(e.rumbaUser))}),t})},g.query=function(e,t){var n=r.defer();if(n.resolve([]),c.currentUser.getAttribute("isSelfRegUser"))return n.promise;var a=o+"/student_search";return angular.isDefined(e)||(e={}),angular.isDefined(e.pageSize)||(e.pageSize=50),angular.isDefined(e.firstname)&&(e.firstname+="*"),angular.isDefined(e.lastname)&&(e.lastname+="*"),s.get(a,{params:e,cache:!!t}).then(function(e){var t=[];return angular.forEach(e.data.users,function(e){e.rumbaUser.userAttributes=e.attributes,t.push(new g(e.rumbaUser))}),t},function(e){return r.reject(e)})},g.getUserById=function(e){var t=o+"/user/"+e;return s.get(t).then(function(e){return new g(e.data)},function(e){return r.reject(e)})},g.getCurrentUser=function(){var e=o+"/user";return s.get(e).then(function(e){return e.data},function(e){return r.reject(e)})},g.getUsersByIds=function(e){var t={};return angular.forEach(e,function(e){var n=g.getUserById(e).then(function(e){return e},function(){return null});t[e]=n}),r.all(t)},g.updateCurrentUserAttributes=function(e){return s.post(o+"/user/profile",e).then(function(){angular.extend(c.currentUser.userAttributes,e)},function(e){a.error("error updating user profile",e)})},g.prototype.$isSubscribedTo=function(e){var t=this;return _.contains(t.subscribedCourses,e)},g.prototype.isNbcLearnUser=function(){return this.$isSubscribedTo(m)},g.prototype.setGoogleClassroomEnabled=function(e){this.setAttribute("google.classroom.enable",!!e,!0)},g.prototype.isGoogleClassroomEnabled=function(){return this.isTeacher&&this.getAttribute("google.classroom.enable")},g.prototype.getLocale=function(){return this.getAttribute("profile.locale")},g.prototype.setStateCode=function(e){return this.setAttribute("profile.current.statecode",e)},g.prototype.getStateCode=function(){return this.getAttribute("profile.current.statecode")},g.prototype.getUserTheme=function(){return null===this.getAttribute("profile.learningExperience")?"Standard":this.getAttribute("profile.learningExperience")},g.getSSOUrlDetails=function(){var e=o+"/rumba/ssourl/details";return s.get(e).then(function(e){return e.data},function(e){return r.reject("Failed to get SSO url details",e)})},g.prototype.getFeatureAttributes=function(){var e=this;return e.featureAttributes||{}},g}]}),angular.module("Realize.webStorage.storageDecorator",["webStorageModule"]).config(["$provide",function(e){"use strict";e.decorator("webStorage",["$delegate",function(e){function t(t){t="undefined"!=typeof t?!!t:!0,Object.keys(localStorage).forEach(function(t){var r=n.find(function(e){return e.test(t)});r||e.local.remove(t)}),t&&(e.session.clear(),e.memory.clear())}var n=[new RegExp("^standardMasteryByClass.*"),new RegExp("^standardMasteryByAssignment.*")];return e.clear=t,e}])}]),angular.module("Realize.admin.commonCartridge.cartridgeDataService",["Realize.paths"]).service("CommonCartridgeDataSvc",["$http","PATH",function(e,t){"use strict";var n=t.REST+"/commoncartridge";this.createCartridge=function(t){return e.post(n,t,{headers:{"Content-Type":void 0},transformRequest:function(){var e=new FormData;return e.append("programId",t.programId),e.append("programVersion",t.programVersion),e.append("includeAccessRole",t.includeAccessRole),e.append("includeAuthoredKeywords",t.includeAuthoredKeywords),e.append("includeGradeLevelMetadata",t.includeGradeLevelMetadata),e.append("createKeywordsFromContainer",t.createKeywordsFromContainer),e.append("ccVersion",t.ccVersion),e.append("standardsProvider",t.standardsProvider||""),e.append("standardsRegion",t.standardsRegion||""),e.append("standardsVersion",t.standardsVersion||""),e.append("standardsMapping",t.standardsMapping),e}})},this.listCartridges=function(){return e.get(n)},this.deleteCartridge=function(t){return e.delete([n,t].join("/"))},this.undeleteCartridge=function(t){return e.post([n,t,"undelete"].join("/"))}}]),angular.module("Realize.admin.commonCartridge.cartridgeExportController",["Realize.common.helpers","Realize.paths","RealizeDirectives.formResetOn","RealizeDataServices","Realize.admin.commonCartridge.cartridgeDataService","Realize.admin.commonCartridge.supportedVersions"]).controller("CartridgeExportController",["$scope","$log","$timeout","lwcI18nFilter","ProgramService","RealizeHelpers","PATH","CommonCartridgeDataSvc","SUPPORTED_CARTRIDGE_VERSIONS",function(e,t,n,r,s,a,i,o,l){"use strict";function c(){function t(e){return e&&""!==e}var n=!0,r=[e.cartridgeExportInfo.standardsProvider,e.cartridgeExportInfo.standardsRegion,e.cartridgeExportInfo.standardsVersion,e.cartridgeExportInfo.standardsMapFile];e.uiState.includeStandardsMapping&&(n=r.every(t)&&e.checkMapFileValidity(e.cartridgeExportInfo.standardsMapFile.name)),e.uiState.canExportCartridge=n&&angular.isDefined(e.cartridgeExportInfo.version)&&angular.isDefined(e.cartridgeExportInfo.program)}var u,d={success:{heading:r("commonCartridgeAdmin.cartridgeExport.successAlert.heading"),body:r("commonCartridgeAdmin.cartridgeExport.successAlert.body")},genericError:{heading:r("commonCartridgeAdmin.cartridgeExport.errorAlert.generic.heading"),body:r("commonCartridgeAdmin.cartridgeExport.errorAlert.generic.body")},mapFileError:{heading:r("commonCartridgeAdmin.cartridgeExport.errorAlert.mappingFile.heading"),body:r("commonCartridgeAdmin.cartridgeExport.errorAlert.mappingFile.body")},exportInProgress:{heading:r("commonCartridgeAdmin.cartridgeExport.errorAlert.exportInProgress.heading"),body:r("commonCartridgeAdmin.cartridgeExport.errorAlert.exportInProgress.body")}},m="PUBLISHED";e.fullProgramList=[],s.getAllStatePrograms().then(function(t){var n=t.results||[];e.fullProgramList=_.filter(n,function(e){return e.status===m})}),e.cartridgeExportInfo={includeAccessRole:!1,includeAuthoredKeywords:!1,includeGradeLevelMetadata:!1,createKeywordsFromContainer:!1},e.uiState={canExportCartridge:!1,isExportingCartridge:!1,includeStandardsMapping:!1,isCartridgeExported:!1},e.formState={reset:!1},e.includeStandardsChanged=function(){c()},e.standardsProviderChanged=function(){e.cartridgeExportInfo.standardsProvider=a.removeIllegalXmlCharacters(e.cartridgeExportInfo.standardsProvider).replace(/[<>&"']/g,""),c()},e.standardsRegionChanged=function(){e.cartridgeExportInfo.standardsRegion=a.removeIllegalXmlCharacters(e.cartridgeExportInfo.standardsRegion).replace(/[<>&"']/g,""),c()},e.standardsVersionChanged=function(){e.cartridgeExportInfo.standardsVersion=a.removeIllegalXmlCharacters(e.cartridgeExportInfo.standardsVersion).replace(/[<>&"']/g,""),c()},e.standardsMappingFileChanged=function(){c()},e.checkMapFileValidity=function(e){if(e){var t=e.split(".");return"csv"===t.reverse()[0].toLowerCase()}},e.supportedCartridgeVersions=l,e.setCartridgeVersion=function(t){e.cartridgeExportInfo.version=t,e.cartridgeExportInfo.includeGradeLevelMetadata=!1,e.uiState.showGradeMetadataToggle=/1\.3/.test(t.description),c()},e.setCartridgeVersion(e.supportedCartridgeVersions[0]),e.setCartridgeProgram=function(t){e.cartridgeExportInfo.program=t,c()},e.programSearchText="",e.programListTemplate=[i.TEMPLATE_CACHE,"admin","commonCartridge","cartridgeExport_programTypeaheadMatch.html"].join("/"),e.programSearchTxtChange=function(){e.uiState.canExportCartridge=e.fullProgramList.filter(function(t){return t.name===e.programSearchText}).length>0,!e.uiState.canExportCartridge&&angular.isDefined(e.cartridgeExportInfo.program)&&e.setCartridgeProgram(void 0)},e.exportCartridge=function(){if(c(),e.uiState.canExportCartridge){e.uiState.isExportingCartridge=!0;var t={programId:e.cartridgeExportInfo.program.id,programVersion:e.cartridgeExportInfo.program.version,ccVersion:e.cartridgeExportInfo.version.description,includeAccessRole:e.cartridgeExportInfo.includeAccessRole,includeAuthoredKeywords:e.cartridgeExportInfo.includeAuthoredKeywords,includeGradeLevelMetadata:e.cartridgeExportInfo.includeGradeLevelMetadata,createKeywordsFromContainer:e.cartridgeExportInfo.createKeywordsFromContainer};e.uiState.includeStandardsMapping&&(t.standardsProvider=e.cartridgeExportInfo.standardsProvider,t.standardsRegion=e.cartridgeExportInfo.standardsRegion,t.standardsVersion=e.cartridgeExportInfo.standardsVersion,t.standardsMapping=e.cartridgeExportInfo.standardsMapFile),o.createCartridge(t).then(function(){e.uiState.isCartridgeExported=!0,e.uiState.isExportingCartridge=!1,e.$emit("commonCartridge.showAlert",{autoClose:!0,type:"success",icon:"ok-sign",msg:["<b>",d.success.heading,"</b> ",d.success.body].join("")})}).catch(function(t){var n=422===t.status?d.mapFileError:501===t.status?d.exportInProgress:d.genericError;e.uiState.isExportingCartridge=!1,e.$emit("commonCartridge.showAlert",{autoClose:!1,type:"error",icon:"exclamation-sign",msg:["<b>",n.heading,"</b> ",n.body].join("")})})}},e.resetForm=function(){e.formState.reset=!0,e.uiState.includeStandardsMapping=e.cartridgeExportInfo.program=e.cartridgeExportInfo.includeAccessRole=e.cartridgeExportInfo.includeAuthoredKeywords=e.cartridgeExportInfo.includeGradeLevelMetadata=e.cartridgeExportInfo.createKeywordsFromContainer=e.cartridgeExportInfo.standardsProvider=e.cartridgeExportInfo.standardsRegion=e.cartridgeExportInfo.standardsVersion=e.cartridgeExportInfo.standardsMapFile=void 0,e.programSearchText="",u=n(function(){e.uiState.isExportingCartridge=e.uiState.isCartridgeExported=e.uiState.canExportCartridge=e.uiState.includeStandardsMapping=e.uiState.showGradeMetadataToggle=e.formState.reset=e.cartridgeExportInfo.includeAuthoredKeywords=e.cartridgeExportInfo.includeGradeLevelMetadata=e.cartridgeExportInfo.createKeywordsFromContainer=e.cartridgeExportInfo.includeAccessRole=!1,c()},100)},e.$on("$destroy",function(){n.cancel(u)})}]),angular.module("Realize.admin.commonCartridge.keysetService",["Realize.paths"]).service("keysetService",["$http","PATH",function(e,t){"use strict";var n={CONSUMERKEY:"{ConsumerKey}",ORG_ID:"{OrgID}"},r={CREATE:t.REST+"/commoncartridge/keysets/",UPDATE:[t.REST,"/commoncartridge/keysets/",n.CONSUMERKEY,"/programs"].join(""),DELETE:t.REST+"/commoncartridge/keysets/",SEARCH:t.REST+"/commoncartridge/consumers",ORG_PROGRAMS:[t.REST,"/commoncartridge/keysets/",n.ORG_ID,"/programs"].join("")};this.createKeyset=function(t,n){return e.post(r.CREATE+t,{programIds:n})},this.search=function(t){return e.get(r.SEARCH+"?keyword="+t)},this.deleteKeyset=function(t){return e.delete(r.DELETE+t,{params:{consumerKey:t}})},this.updateKeyset=function(t){var s={data:{programIds:t.products},headers:{"Content-Type":"application/json"},method:"PUT",transformRequest:function(e){return JSON.stringify(e)},url:r.UPDATE.replace(n.CONSUMERKEY,t.consumerKey)};return e(s)},this.getProgramsForOrg=function(t){return e.get(r.ORG_PROGRAMS.replace(n.ORG_ID,t)).then(function(e){return e.data.results})}}]),angular.module("Realize.admin.commonCartridge.cartridgeManagementController",["Realize.user.currentUser","Realize.paths"]).controller("AdminCommonCartridgeManagementController",["$scope","$routeParams","$location","$timeout","PATH","$currentUser",function(e,t,n,r,s,a){"use strict";var i,o=[s.TEMPLATE_CACHE,"admin","commonCartridge"].join("/"),l={exportCartridge:[o,"cartridgeExport.html"].join("/"),cartridgeRepository:[o,"cartridgeRepository.html"].join("/"),createKeys:[o,"createKeys.html"].join("/"),manageKeys:[o,"manageKeys.html"].join("/")};e.back=function(t){t.preventDefault(),e.goBack("/admin/patools",!0)},e.activeTab=t.activeTab||"exportCartridge",i=r(function(){e.tabTemplate=l[e.activeTab]},20),e.uiState={showExportInfo:"exportCartridge"===e.activeTab&&a.getAttribute("commonCartridgeExport.hasSeenExportInfo")!==!0},e.uiState.showExportInfo&&(e.closeFirstExportInfo=function(){a.setAttribute("commonCartridgeExport.hasSeenExportInfo",!0),e.uiState.showExportInfo=!1}),e.showTab=function(t){n.path("/admin/patools/commoncartridge/"+t).replace(),e.activeTab=t},e.$on("commonCartridge.showAlert",function(t,n){t.preventDefault(),e.alertIsSet=!0,e.alertDetails=n}),e.$on("$destroy",function(){r.cancel(i)})}]),angular.module("Realize.admin.commonCartridge.cartridgeRepositoryController",["Realize.common.DateRangeSelector","RealizeDataServices","Realize.paths","Realize.admin.commonCartridge.supportedVersions","Realize.admin.commonCartridge.cartridgeDataService"]).controller("CartridgeRepositoryCtrl",["$scope","$timeout","Analytics","ProgramService","PATH","lwcI18nFilter","CommonCartridgeDataSvc","SUPPORTED_CARTRIDGE_VERSIONS",function(e,t,n,r,s,a,i,o){"use strict";function l(){function e(e){var t=m.filter(function(t){return t.id===e.programId&&t.version===e.programVersion})[0];return t?t:m.filter(function(t){return t.id===e.programId&&t.version>e.programVersion}).sort(function(e,t){return e.version-t.version})[0]}d&&m&&(d.forEach(function(t){var n=e(t)||{};t.programName=n.title,t.programState=n.stateCode,t.dateExported=moment(t.dateExported),t.fileName=t.fileName||""}),p.applyFilter(),p.uiState.isFinishedLoading=!0)}function c(){p.uiState.canUpdateFilter=p.filterData.dateRange.startDate&&p.filterData.dateRange.endDate}function u(e){e&&e.startDate&&e.endDate&&(p.filterData.startDateFormatted=moment(e.startDate).format(h),p.filterData.endDateFormatted=moment(e.endDate).format(h),n.track("track.action",{category:"Data",action:"Change Calendar Range"})),c()}var d,m,g,p=this,f={ALL:{label:a("commonCartridgeAdmin.cartridgeRepository.statusFilterOpts.all"),isAll:!0},IN_PROGRESS:{label:a("commonCartridgeAdmin.cartridgeRepository.statusFilterOpts.inProgress"),value:"IN_PROGRESS"},SUCCESS:{label:a("commonCartridgeAdmin.cartridgeRepository.statusFilterOpts.success"),value:"COMPLETE"},FAIL:{label:a("commonCartridgeAdmin.cartridgeRepository.statusFilterOpts.fail"),value:"ERROR"},POTENTIAL_ISSUES:{label:a("commonCartridgeAdmin.cartridgeRepository.statusFilterOpts.potentialIssues"),value:"POTENTIAL_ISSUES"}},h="MM/DD/YYYY";r.getAllStatePrograms().then(function(e){m=e.results,l()}),i.listCartridges().then(function(e){d=e.data,p.pagerData.totalItems=d.length,l()}).catch(function(){e.pageLoaded()}),this.downloadPaths={cartridge:[s.REST,"commoncartridge"].join("/"),log:[s.REST,"commoncartridge","log"].join("/")},this.possibleExportStatuses=[f.ALL,f.IN_PROGRESS,f.SUCCESS,f.FAIL,f.POTENTIAL_ISSUES],this.possibleCartridgeVersions=[{description:a("commonCartridgeAdmin.cartridgeRepository.versionFilterOpts.any"),isAll:!0}].concat(o),this.uiState={canUpdateFilter:!0,isFilterUpdating:!1,isFinishedLoading:!1},this.filterData=e.filterData={programSearchText:"",dateRange:{},status:this.possibleExportStatuses[0],version:this.possibleCartridgeVersions[0]},this.sortField="-dateExported",this.sortBy=function(e){if(this.sortField.substr(1)===e){var t="+"===this.sortField[0]?"-":"+";this.sortField=t+e}else this.sortField="+"+e},e.currentPage=1,this.pagerData=e.pagerData={startIndex:0,endIndex:9,pageSize:10,get currentPage(){return e.currentPage},set currentPage(t){e.currentPage=t},totalItems:0},this.filteredResults=[],this.setStatusFilter=function(e){this.filterData.status=e},this.setVersionFilter=function(e){this.filterData.version=e},this.applyFilter=function(){this.uiState.isFilterUpdating=!0,g=t(function(){this.pagerData.startIndex=0,this.pagerData.endIndex=this.pagerData.pageSize-1,this.pagerData.currentPage=1;var e,t,n=this.filterData.programSearchText,r=this.filterData.status,s=this.filterData.version,a=this.filterData.dateRange.startDate,i=this.filterData.dateRange.endDate,o=n.length>0,l=!r.isAll,c=!s.isAll,u=angular.isDefined(a)&&angular.isDefined(i);u&&(e=moment(a).format(h),t=moment(i).format(h)),this.filteredResults=d.filter(function(d){var m=!o||-1!==(d.programName||"").toLowerCase().indexOf(n.toLowerCase()),g=!l||d.status===r.value,p=!c||d.ccVersion===s.description,f=!u||(d.dateExported.format(h)===e||d.dateExported.isAfter(a))&&(d.dateExported.format(h)===t||d.dateExported.isBefore(i));return m&&f&&p&&g},50),this.pagerData.totalItems=this.filteredResults.length,this.pagerData.totalItems<this.pagerData.pageSize&&(this.pagerData.endIndex=this.pagerData.totalItems-1),this.uiState.isFilterUpdating=!1}.bind(this))},this.deleteCartridge=function(e){e.status!==f.IN_PROGRESS.value&&i.deleteCartridge(e.ccId).then(function(){e.active=!1})},this.undeleteCartridge=function(e){i.undeleteCartridge(e.ccId).then(function(){e.active=!0})},e.$watch("filterData.dateRange",function(e,t){u(t)},!0),e.$on("dateRangeSelector.selection.change",function(e,t,n){u(n)}),e.$watch("currentPage",function(){p.pagerData.startIndex=(p.pagerData.currentPage-1)*p.pagerData.pageSize,p.pagerData.endIndex=p.pagerData.currentPage*p.pagerData.pageSize-1,p.pagerData.totalItems<p.pagerData.endIndex+1&&(p.pagerData.endIndex=p.pagerData.totalItems-1)},!0),e.$on("$destroy",function(){t.cancel(g)})}]),angular.module("Realize.admin.commonCartridge.createKeysController",["RealizeDataServices","Realize.common.keyboardSupport.keyCodes","Realize.admin.commonCartridge.keysetService"]).controller("AdminCommonCartridgeCreateKeysController",["$scope","KEY_CODES","lwcI18nFilter","keysetService",function(e,t,n,r){"use strict";function s(){e.uiState.canCreateKeys=e.uiState.hasVerifiedOrgId&&e.keyset.programs.length>0}function a(){return{programs:[],organizationId:"",organization:void 0,secret:void 0,key:void 0}}e.keyset=a(),e.uiState={canCreateKeys:!1,isCreatingKeys:!1,isVerifyingOrgId:!1,hasCreatedKeys:!1,hasVerifiedInvalidOrgId:!1,hasVerifiedOrgId:!1,get isVerifyBtnDisabled(){return(e.keyset.organizationId||"").length<1||this.isVerifyingOrgId||this.hasVerifiedOrgId||this.hasVerifiedInvalidOrgId}},e.orgSearch={verifyButtons:{verify:n("commonCartridgeAdmin.createKeys.orgIdVerify"),verified:n("commonCartridgeAdmin.createKeys.orgIdVerified")},error:"",errorMessages:{noPrograms:n("commonCartridgeAdmin.createKeys.orgIdNotSubscribed"),orgNotFound:n("commonCartridgeAdmin.createKeys.orgIdNotFound")}},e.orgIdKeyup=function(n){angular.isDefined(n)&&n.which===t.ENTER&&!e.uiState.hasVerifiedOrgId&&e.keyset.organizationId.length>0&&e.verifyOrgId()},e.$watch("keyset.organizationId",function(t,n){t!==n&&(e.uiState.hasVerifiedOrgId=e.uiState.hasVerifiedInvalidOrgId=e.uiState.canCreateKeys=!1)}),e.verifyOrgId=function(){e.uiState.isVerifyingOrgId=!0,e.orgSearch.error="",r.getProgramsForOrg(e.keyset.organizationId).then(function(t){t.length<1?e.orgSearch.error=e.orgSearch.errorMessages.noPrograms:(e.fullProgramList=e.typeAndSelectConfig.results=angular.copy(t),e.uiState.hasVerifiedOrgId=!0)}).catch(function(){e.orgSearch.error=e.orgSearch.errorMessages.orgNotFound,e.uiState.hasVerifiedInvalidOrgId=!0}).finally(function(){e.uiState.isVerifyingOrgId=!1})},e.typeAndSelectConfig={results:e.fullProgramList,formText:{mainLabel:n("commonCartridgeAdmin.createKeys.programsSelect.mainLabel"),help:n("commonCartridgeAdmin.createKeys.programsSelect.help"),noMatch:n("commonCartridgeAdmin.createKeys.programsSelect.alert.noMatch"),submitError:n("commonCartridgeAdmin.createKeys.programsSelect.alert.submitError"),addAllLabel:n("commonCartridgeAdmin.createKeys.programsSelect.addAllLabel"),offScreenRemove:n("commonCartridgeAdmin.createKeys.programsSelect.offScreenRemove.a11y"),placeholder:n("commonCartridgeAdmin.createKeys.programsSelect.placeholder")},isAddAllEnabled:!1,isFormSubmitted:function(){return e.uiState.hasCreatedKeys},customFilter:function(e){return{title:e}},searchBufferMS:300,popupMatchTmplUrl:"templates/admin/commonCartridge/createKeys_programTypeaheadMatch.html",selectedItemTmplUrl:"templates/admin/commonCartridge/createKeys_programTypeaheadSelectedItem.html"},e.$on("typeAndSelect.itemAdded",function(){e.setKeysetPrograms()}),e.$on("typeAndSelect.itemRemoved",function(){e.setKeysetPrograms()}),e.setKeysetPrograms=function(){e.keyset.programs=e.fullProgramList.filter(function(e){return e.selected===!0}),s()},e.createKeys=function(){if(s(),e.uiState.canCreateKeys){e.uiState.isCreatingKeys=!0;var t=e.keyset.organizationId,a=e.keyset.programs.map(function(e){return e.id});r.createKeyset(t,a).then(function(t){e.keyset.secret=t.data.secret,e.keyset.key=t.data.consumerKey,e.keyset.organizationName=t.data.consumerName,e.keyset.programs=t.data.products,e.uiState.hasCreatedKeys=!0,e.uiState.canCreateKeys=!1
}).catch(function(t){var r=n(404===t.status?"commonCartridgeAdmin.createKeys.invalidOrgId":"commonCartridgeAdmin.createKeys.errorCreatingKeys");e.$emit("commonCartridge.showAlert",{autoClose:!1,type:"error",icon:"exclamation-sign",msg:r})}).finally(function(){e.uiState.isCreatingKeys=!1})}},e.createNewKeyset=function(){e.keyset=a(),e.uiState.hasVerifiedOrgId=!1,e.uiState.hasCreatedKeys=!1,e.orgSearch.error="",e.fullProgramList=[]}}]),angular.module("Realize.admin.commonCartridge.manageKeysController",["ModalServices","RealizeDataServices","Realize.common.keyboardSupport.keyCodes","Realize.admin.commonCartridge.editKeysetDirective","Realize.admin.commonCartridge.keysetService"]).controller("AdminCommonCartridgeManageKeysController",["$scope","Modal","KEY_CODES","ProgramService","lwcI18nFilter","keysetService",function(e,t,n,r,s,a){"use strict";function i(t){return(e.keysetSearch.results||[]).filter(function(e){return e.consumerKey===t})}function o(t){if(t.programs=e.fullProgramList.filter(function(e){return-1!==t.products.indexOf(e.id)&&"PUBLISHED"===e.status}),t.programs.length===t.products.length)return t;var n=e.fullProgramList.filter(function(e){return-1!==t.products.indexOf(e.id)&&"SUBMITTED"===e.status});return n.forEach(function(e){t.programs.push(e)}),t}function l(t){t.isBeingDeleted=!0,a.deleteKeyset(t.consumerKey).then(function(){c(t)}).catch(function(){e.$emit("commonCartridge.showAlert",{autoClose:!1,type:"error",icon:"exclamation-sign",msg:s("commonCartridgeAdmin.manageKeys.errorSearchingKeys")})})}function c(t){var n=i(t.consumerKey);if(n.length>0){var r=e.keysetSearch.results.indexOf(n[0]);e.keysetSearch.results.splice(r,1),0===e.keysetSearch.results.length&&(e.uiState.hasSearchResults=!1)}}e.uiState={canSearch:!1,hasSearchResults:!1,isSearchFocused:!1,isSearching:!1,hasLoadedPrograms:!1},r.getAllStatePrograms().then(function(t){e.fullProgramList=t.results,e.uiState.programsLoaded=!0}),e.keysetSearch={searchText:"",resultsSearchText:"",results:null},e.setSearchFocused=function(t){e.uiState.isSearchFocused=!!t},e.searchTextChange=function(t){e.uiState.canSearch=e.keysetSearch.searchText.length>0,angular.isDefined(t)&&t.which===n.ENTER&&e.uiState.canSearch&&e.search()},e.$watch("keysetSearch.searchText",function(){e.searchTextChange()}),e.search=function(){e.uiState.isSearching=!0,a.search(e.keysetSearch.searchText).then(function(t){e.uiState.hasSearchResults=!0,e.keysetSearch.resultsSearchText=e.keysetSearch.searchText,e.keysetSearch.searchText="",e.keysetSearch.results=t.data.map(function(e){return o(e)})}).catch(function(){e.$emit("commonCartridge.showAlert",{autoClose:!1,type:"error",icon:"exclamation-sign",msg:s("commonCartridgeAdmin.manageKeys.errorSearchingKeys")})}).finally(function(){e.uiState.isSearching=e.uiState.canSearch=e.uiState.isSearchFocused=!1})},e.editKeyset=function(t){e.keysetToEdit=t},e.onKeysetUpdate=function(t){if(t.isDeleted===!0)c(t);else{var n=i(t.consumerKey);n.length>0&&(n=n[0],n.products=t.products,o(n))}e.$emit("commonCartridge.showAlert",{autoClose:!0,type:"success",icon:"ok-sign",msg:["<b>",s("commonCartridgeAdmin.manageKeys.editKeyset.success"),"</b> ",s("commonCartridgeAdmin.manageKeys.editKeyset.saveSuccessMsg")].join("")})},e.deleteKeyset=function(e){var n={};n[t.BUTTONS.OK]={title:s("commonCartridgeAdmin.manageKeys.confirmDelete.buttons.remove"),handler:function(){e.isBeingDeleted=!0,l(e)}},n[t.BUTTONS.CANCEL]={title:s("commonCartridgeAdmin.manageKeys.confirmDelete.buttons.cancel"),handler:angular.noop},t.simpleDialog(s("commonCartridgeAdmin.manageKeys.confirmDelete.heading"),s("commonCartridgeAdmin.manageKeys.confirmDelete.body"),n)}}]),angular.module("Realize.admin.commonCartridge",["Realize.admin.commonCartridge.cartridgeManagementController","Realize.admin.commonCartridge.cartridgeExportController","Realize.admin.commonCartridge.cartridgeRepositoryController","Realize.admin.commonCartridge.createKeysController","Realize.admin.commonCartridge.manageKeysController"]),angular.module("Realize.admin.commonCartridge.supportedVersions",[]).constant("SUPPORTED_CARTRIDGE_VERSIONS",window.supportedCommonCartridgeVersions),angular.module("Realize.admin.adminJobsService",["Realize.paths","Realize.admin.jobs.jobModel","Realize.common.helpers"]).service("AdminJobsService",["$q","$http","PATH","Job","RealizeHelpers",function(e,t,n,r,s){"use strict";this.getJobs=function(s){var a=n.REST+"/jobs";return s=s||{},t.get(a,{params:s}).then(function(e){var t=[];return angular.forEach(e.data,function(e,n){t.push(new r(n,e))}),t},function(t){return e.reject(t.data)})},this.getJobById=function(s,a){var i=n.REST+"/jobs/"+s,o={getMinimalJobDetailsAttributes:!a};return t.get(i,{params:o}).then(function(e){var t=[];return angular.forEach(e.data,function(e,n){t.push(new r(n,e))}),t},e.reject)},this.getLogUrl=function(e){angular.isArray(e)||(e=[e]);var t=n.REST+"/jobs/logs";return s.buildUrl(t,{jobIds:e})}}]),angular.module("Realize.admin.jobs.adminJobsListingController",["rlzComponents.components.i18n","Realize.admin.adminJobsService","Realize.user.currentUser","Realize.common.DateRangeSelector","admin.jobs.programMetadataFilter","ModalServices","Realize.filters.underscores","Realize.filters.underscoreToCamelCase","Realize.filters.strReplace"]).controller("AdminJobsListingController",["$scope","$log","AdminJobsService","JobsData","$currentUser","Modal","lwcI18nFilter","lastSearch","$location","strReplaceFilter",function(e,t,n,r,s,a,i,o,l,c){"use strict";this.locationFallback="/admin/patools",this.jobs=r,this.jobTypeReplace=/_/g,this.filters={state:"active",JOB_NAME:"all",SUBMITTED_BY_USERID:s.userName,getMinimalJobDetailsAttributes:!0},this.lastSearch=o,this.dateRangeOptions=[{id:"all",analyticLabel:"All",label:"dateRangeSelector.filter.rangeOption.all",order:1,"default":!0},{id:"yesterday",analyticLabel:"Yesterday",label:"dateRangeSelector.filter.rangeOption.yesterday",order:2},{id:"today",analyticLabel:"Today",label:"dateRangeSelector.filter.rangeOption.today",order:3},{id:"last7Days",analyticLabel:"Last 7 days",label:"dateRangeSelector.filter.rangeOption.last7Days",order:4},{id:"last14Days",analyticLabel:"Last 14 days",label:"dateRangeSelector.filter.rangeOption.last14Days",order:5}],Object.defineProperty(this,"zeroStateMessage",{get:function(){return this.lastSearch&&"id"===this.lastSearch.type?"jobSelector.zeroState.idNotFound":"jobSelector.zeroState.filtersNotFound"}}),this.search=function(){var e=this,r=angular.copy(this.filters);"all"===r.JOB_NAME&&delete r.JOB_NAME,r.DATE_COMPLETED&&("all"!==r.DATE_COMPLETED.id&&(r.DATE_COMPLETED_START=moment(r.DATE_COMPLETED.startDate).format(),r.DATE_COMPLETED_END=moment(r.DATE_COMPLETED.endDate).format()),delete r.DATE_COMPLETED),"completed"===r.state&&(r.DATE_COMPLETED_START=moment().add(-24,"hours").format(),r.DATE_COMPLETED_END=moment().format()),r.SUBMITTED_BY_USERID||delete r.SUBMITTED_BY_USERID,r.LIBRARIES||delete r.LIBRARIES,e.isLoading=!0,n.getJobs(r).then(function(t){e.jobs=t},function(n){t.debug("error getting jobs!",n),e.jobs=[]}).finally(function(){e.isLoading=!1,e.lastSearch={type:"filters",filters:angular.copy(r)}})},this.searchById=function(){var e=this;l.path("/admin/patools/jobservicelisting/"+e.searchId)},this.sortBy=function(e){this.sortDirection=this.sortKey===e?"+"===this.sortDirection?"-":"+":"+",this.sortKey=e,this.sortListingBy=this.sortDirection+this.sortKey},this.getDownloadLogUrl=function(e){return n.getLogUrl(e)},this.getDownloadAllLogsUrl=function(){var e=[];return angular.forEach(this.jobs,function(t){t.isCompleted&&e.push(t.jobId)}),n.getLogUrl(e)},this.showErrorsModal=function(e){var t=c(e.jobType,this.jobTypeReplace),n=i("jobSelector.errorModal.title",[t])+" ("+e.jobId+")",r="<textarea>"+e.exception+"</textarea>";a.simpleDialog(n,r)},this.isJobCompleted=function(e){return e.isCompleted&&!e.hasErrors&&!u(e)},this.jobHasErrors=function(e){return e.isCompleted&&e.hasErrors},this.isJobAwaiting=function(e){return e.isCompleted&&u(e)};var u=function(e){return"pending scheduled refresh"===e.formattedJobStatus};this.isJobProcessing=function(e){return!e.isCompleted&&!e.progress&&!e.isNotStarted}}]),angular.module("Realize.admin.jobs.jobModel",[]).factory("Job",[function(){"use strict";var e=function(e,t){this._initializationData=angular.extend({completed:!1,jobStatus:""},t),this.completed=angular.isString(this._initializationData.completed)?"true"===(t.completed||"").split("||").pop().toLowerCase():this._initializationData.completed,this.formattedJobStatus=(this._initializationData.jobStatus||"").toLowerCase();var n=this.formattedJobStatus.split("||");this.formattedJobStatus="completed"===n[0]?n.pop():n[0],this.jobId=e};return Object.defineProperties(e.prototype,{jobType:{get:function(){return this._initializationData.jobName}},hasErrors:{get:function(){return"completed with exception"===this.formattedJobStatus||"terminated"===this.formattedJobStatus||!!this._initializationData.exception}},exception:{get:function(){return this._initializationData.exception}},errors:{get:function(){return this._initializationData.errors}},isCompleted:{get:function(){return this.completed}},isNotStarted:{get:function(){return"not started"===this.formattedJobStatus}},status:{get:function(){return this.formattedJobStatus}},submittedBy:{get:function(){return this._initializationData.jobSubmittedBy}},dateStarted:{get:function(){return moment(this._initializationData.startTime)}},dateCompleted:{get:function(){return moment(this._initializationData.completionTime)}},programs:{get:function(){return"library"===this._initializationData.importType?this.taxonomyName:this._initializationData.libraries}},progress:{get:function(){return this._initializationData.itemsProcessed&&this._initializationData.itemsToProcess?this._initializationData.itemsProcessed+"/"+this._initializationData.itemsToProcess:this._initializationData.itemPublished?this._initializationData.itemPublished:!1}},fileName:{get:function(){return this._initializationData.fileName}},duration:{get:function(){return this.dateCompleted?moment.duration(this.dateCompleted.diff(this.dateStarted)).humanize():null}},importType:{get:function(){return this._initializationData.importType}},taxonomyName:{get:function(){return this._initializationData.taxonomyName}}}),e}]),angular.module("admin.jobs.programMetadataFilter",["rlzComponents.components.i18n"]).filter("adminProgramMetadata",["lwcI18nFilter",function(e){"use strict";return function(t){return t?t.split(",").length>1?e("jobSelector.listing.metadata.sharedProgram"):t.replace(/(\[|\])/g,""):t}}]),angular.module("Realize.admin.landing.adminLandingController",["rlzComponents.components.i18n","Realize.common.alerts","components.realize.user","rlzComponents.adminToolsTelemetryModule"]).controller("AdminLandingController",["$scope","$log","$route","$filter","$window","AlertService","LwcRumbaDataService","adminToolsTelemetryService",function(e,t,n,r,s,a,i,o){"use strict";e.back=function(t){t.stopPropagation(),e.goBack("/program",!0)},e.alertDetails=a.alerts[0],e.alertIsSet=a.alertIsSet(),e.openLTIWebAdminUrl=function(){e.isLoading=!0,o.sendTelemetryEvent(),s.ltiServiceWebAdminUrl?i.getSAMLTicket(s.ltiServiceWebAdminUrl).then(function(t){e.isLoading=!1;var n=s.ltiServiceWebAdminUrl+"?ticket="+t;s.open(n,"_blank")},function(n){e.isLoading=!1,t.error("Failed to get saml ticket",n)}):t.error("ltiServiceWebAdminUrl is not defined")}}]),angular.module("Realize.admin.ltiConsumer.configController",["Realize.paths"]).controller("AdminLTIConsumerConfigController",["$scope","$routeParams","$location","$timeout","PATH",function(e,t,n,r,s){"use strict";var a,i=[s.TEMPLATE_CACHE,"admin","ltiConsumer"].join("/"),o={manage:[i,"manage","ltiConsumerManagement.html"].join("/"),create:[i,"create","ltiConsumerCreateSetting.html"].join("/")},l=this;l.back=function(t){t.preventDefault(),e.goBack("/admin/patools",!0)},l.uiState={showAlert:!1},l.activeTab=t.activeTab||"manage",a=r(function(){l.tabTemplate=o[l.activeTab]},20),l.showTab=function(e){o.hasOwnProperty(e)&&n.path("/admin/patools/ltiConsumer/"+e).replace()},e.$on("ltiConsumerAdmin.showAlert",function(e,t){e.preventDefault(),l.uiState.showAlert=!0,l.alertDetails=t}),e.$on("$destroy",function(){r.cancel(a)})}]),angular.module("Realize.admin.ltiConsumer",["Realize.admin.ltiConsumer.configController","Realize.admin.ltiConsumer.managementController","Realize.admin.ltiConsumer.createSettingController"]),angular.module("Realize.admin.messages.adminMessagesEditorController",["rlzComponents.components.i18n","realize-lib.core.services.filesystem","ModalServices"]).controller("AdminMessagesEditorController",["$scope","$q","Messages","fileSystem","$log","$window","Modal",function(e,t,n,r,s,a,i){"use strict";e.selectedLanguage="English",e.getMessage=n.getMessage,e.messages={};var o=e.currentUser.getAttribute("profile.locale"),l=e.currentUser.getAttribute("admin.localeOverride");t.when(n.load(o,l,!1)).then(function(t){e.messages=angular.copy(t)}),e.$watch("selectedLanguage",function(r){var s="Spanish"===r?"es":"en";t.when(n.load(s,e.currentUser.getAttribute("admin.localeOverride"),!1)).then(function(t){e.messages=angular.copy(t)})}),e.save=function(){var t="Spanish"===e.selectedLanguage?"es":"en";return r.writeJSON("messages_"+t+".json",angular.toJson(e.messages)).then(function(t){return s.log("successfully saved",t),e.fileUrl=t,e.currentUser.setAttribute("admin.localeOverride",t),t})},e.togglePreview=function(){var t=e.currentUser.getAttribute("admin.previewMode");t=!t,e.currentUser.setAttribute("admin.previewMode",t),t?e.save().then(function(t){var r="Spanish"===e.selectedLanguage?"es":"en";e.currentUser.setAttribute("admin.localeOverride",t).then(function(){n.load(r,t)})}):n.load(e.currentUser.getAttribute("profile.locale"))},e.clearLocal=function(){var t={};t[i.BUTTONS.OK]={title:n.getMessage("adminTools.messages.deleteAction.modal.buttons.ok"),isDefault:!1,handler:function(){e.currentUser.setAttribute("admin.previewMode",!1),e.currentUser.setAttribute("admin.localeOverride",!1),n.load(e.currentUser.getAttribute("profile.locale"),!1,!1).then(function(t){e.messages=angular.copy(t)}),r.deleteFile("/messages_en.json").then(function(e){s.log("delete english success",e)},function(e){s.log("delete error",e)}),r.deleteFile("/messages_es.json").then(function(e){s.log("delete spanish success",e)},function(e){s.log("delete error",e)})}},t[i.BUTTONS.CANCEL]={title:n.getMessage("adminTools.messages.deleteAction.modal.buttons.cancel"),isDefault:!0,handler:angular.noop},i.simpleDialog(n.getMessage("adminTools.messages.deleteAction.modal.header"),n.getMessage("adminTools.messages.deleteAction.modal.body"),t,{id:"deleteConfirmationModal"})}}]),angular.module("Realize.admin.programs.addProgramController",["Realize.paths","rlzComponents.components.i18n","Realize.admin.programs.programTaxonomyService"]).controller("AdminAddProgramController",["$scope","$log","$location","ProgramTaxonomyService","MEDIA_PATH","THUMBNAIL_PATH","$window","REST_PATH","$cacheFactory",function(e,t,n,r,s,a,i,o,l){"use strict";e.back=function(t){t.stopPropagation(),e.goBack("/admin/patools",!0)};var c=function(){var e=[o,"programs"].join("/");l.get("$http").remove(e)},u=function(){var t={};t.successReply=e.successReply,t.errorReply=e.errorReply,t.errorMessage=e.errorMessage,t.subscriptionType=e.uploadType,r.setSubscriptionStatus(t),e.successReply.newProgram&&c();var s="admin/patools/existingprograms";n.path(s),e.$apply()},d=function(t){e.$apply(function(){e.errorReply=!0,t.responseText?(t=JSON.parse(t.responseText),e.errorMessage=t.errorCode+": "+t.errorMessage):e.errorMessage=t})},m=function(){e.successReply={newProgram:!1,newEtext:!1},e.errorReply=!1,e.errorMessage=""};e.resetForm=function(){var t;if("COURSE"===e.uploadType)t=angular.element("#uploadProgramForm"),t.each(function(){this.reset()}),t.scope().uploadProgramForm.$setPristine(),angular.element("#saveProgram").addClass("disabled").attr("disabled",!0);else{e.previewImgSrc="",t=angular.element("#uploadEtextForm");var n=t.scope();e.$apply(function(){n.form={}}),n.uploadEtextForm.$setPristine()}},e.uploadType=e.uploadType||"COURSE",e.inlineCourseTemplate="templates/partials/upload_course_form.html",e.inlineEtextTemplate="templates/partials/upload_etext_form.html",e.previewImgSrc="",m(),e.uploadProgram=function(){""!==angular.element("#file").val()&&(m(),r.uploadProgram(angular.element("#uploadProgramForm"),function(t){t===!0?(e.successReply.newProgram=!0,e.resetForm(),u()):d(t)},function(e){d(e)}))},e.uploadEtext=function(){""!==angular.element("#studentThumbnail").val()&&""!==angular.element("#subTitle").val()&&(m(),r.uploadEtext(angular.element("#uploadEtextForm"),function(t){t===!0?(e.successReply.newEtext=!0,e.resetForm(),u()):d(t)},function(e){d(e)}))},e.previewThumbnail=function(t){""!==$.trim(angular.element(t).val())&&(e.previewImgSrc=a+"/"+$.trim($(t).val()))},e.downloadTemplate=function(){i.open(s+"/downloads/course_subscription.csv")},e.setFile=function(e){e.files.length>0?angular.element("#saveProgram").removeClass("disabled").attr("disabled",null):angular.element("#saveProgram").addClass("disabled").attr("disabled",!0)}}]),angular.module("Realize.admin.programs.existingProgramsController",["Realize.paths","rlzComponents.components.i18n","Realize.admin.programs.programTaxonomyService"]).controller("ExistingProgramsController",["$scope","$log","$location","ProgramTaxonomyService","ProgramData","$window","PATH",function(e,t,n,r,s,a,i){"use strict";e.existingPrograms=s,e.thumbnailPath=i.THUMBNAILS;var o=function(){e.viewLoading=!0,e.successReply={newProgram:!1,newEtext:!1,editProgram:!1,publishProgram:!1,deleteProgram:!1},e.errorReply=!1,e.errorMessage=""};o(),e.viewLoading=!1,e.subStatus=r.getSubscriptionStatus(),e.subStatus?(e.subscriptionType=e.subStatus.subscriptionType,e.successReply.newProgram=e.subStatus.successReply.newProgram,e.successReply.newEtext=e.subStatus.successReply.newEtext,e.errorReply=e.subStatus.errorReply,e.errorMessage=e.subStatus.errorMessage):e.subscriptionType=e.subscriptionType||"COURSE",e.back=function(t){t.stopPropagation(),r.setSubscriptionStatus(),e.goBack("/admin/patools",!0)};var l=function(){r.getAllPrograms().then(function(t){e.existingPrograms=t,e.viewLoading=!1})},c=function(t){e.$apply(function(){e.errorReply=!0,t.responseText?(t=JSON.parse(t.responseText),e.errorMessage=t.errorCode+": "+t.errorMessage):e.errorMessage=t})};e.exportProgram=function(e,t){e&&(e.preventDefault(),e.stopPropagation());var n=encodeURIComponent(t.replace(/\\/g,"\\"));a.open(i.REST+"/taxonomies/subscription?termFullPath="+n)},e.saveEdit=function(t){""!==angular.element("#newName-"+t).val()&&(o(),r.editProgram(angular.element("#editProgram-"+t),function(t){t.success===!0?(e.editProgramTitle=t.title,e.successReply.editProgram=!0,l()):c(t)}))},e.publishProgram=function(){o();var t=this.prog.title;r.publishProgram(t,function(){e.publishProgramTitle=t,e.successReply.publishProgram=!0,l()})},e.removeProgram=function(){var t=r.getPublishMigrationCount(this.prog.title);if(t>0)c("This item cannot be removed as there are items to migrate");else{o();var n=this.prog.title,s="The selected program can't be removed since it is being referenced by content.";r.removeProgramSubscription(n,function(t){t===!0?(e.deleteProgramTitle=n,e.successReply.deleteProgram=!0):c(s),l()})}}}]),angular.module("Realize.admin.programs.programTaxonomyService",["Realize.paths"]).service("ProgramTaxonomyService",["$q","$http","REST_PATH",function(e,t,n){"use strict";var r=this;r.getAllPrograms=function(){return t.get(n+"/libraries").then(function(e){var t=e.data,n=/\.(gif|jpg|jpeg|tiff|png)$/i;return angular.forEach(t,function(e){-1===e.thumb.search(n)&&(e.thumb="shared/"+e.thumb+"_course.png")}),t},function(t){return e.reject(t.data)})},r.uploadProgram=function(e,t,r){e.ajaxSubmit({url:n+"/taxonomies/subscription",type:"POST",iframe:!0,dataType:"json",success:function(e){t(e)},error:function(e){r(e)}})},r.uploadEtext=function(e,t,r){e.ajaxSubmit({url:n+"/taxonomy/upsert/subscription/node",type:"POST",dataType:"json",data:{parentFullPath:"",subscriptiontype:"eText"},success:function(e){t(e)},error:function(e){r(e)}})},r.editProgram=function(e,t){var r;e.ajaxSubmit({url:n+"/taxonomy/rename/subscription/node",type:"POST",dataType:"json",data:{termFullPath:e.scope().prog.title},success:function(n){r={success:n,title:e.scope().prog.title},t(r)}})},r.getPublishMigrationCount=function(e,t,r){var s=0;return $.ajax({url:n+"/taxonomies/subscription/published",type:"PUT",async:t||!1,data:{termFullPath:e,execute:!1},success:function(e){s=e,$.isFunction(r)&&r(s)}}),s},r.removeProgramSubscription=function(e,t){var r={termFullPath:e};$.ajax({url:n+"/taxonomies/subscription/terms?"+$.param(r),type:"DELETE",async:!1,success:function(e){t(e)},error:function(e){t(e)}})},r.publishProgram=function(e,t){var r={termFullPath:e,execute:!0};$.ajax({url:n+"/taxonomies/subscription/published?"+$.param(r),type:"PUT",async:!1,success:function(e){$.isFunction(t)&&t(e)}})};var s;r.setSubscriptionStatus=function(e){s=e},r.getSubscriptionStatus=function(){return s}}]),angular.module("Realize.admin.publish.publishClick",["Realize.content.model.contentItem","rlzComponents.components.i18n"]).directive("publishClick",["$log","Content","$rootScope","Modal","lwcI18nFilter",function(e,t,n,r,s){"use strict";return{link:function(a,i,o){var l=function(i){i.preventDefault(),i.stopPropagation();var l=a.$eval(o.publishClick),c={};c[r.BUTTONS.OK]={title:s("global.adminUser.publishModal.action.submit"),isDefault:!0,handler:function(){angular.element("html, body").animate({scrollTop:0},1600),t.publish(l,function(){o.publishAlertTrigger?(e.debug("published",o.publishAlertTrigger),n.$broadcast(o.publishAlertTrigger)):e.debug("[WARN]: publish-alert-trigger not specified.")})}},c[r.BUTTONS.CANCEL]={title:s("global.adminUser.publishModal.action.cancel"),handler:angular.noop},r.simpleDialog(s("global.adminUser.publishModal.message.title"),s("global.adminUser.publishModal.message.text"),c)};i.on("click",l)}}}]),angular.module("Realize.admin.publish.publishTipFilter",[]).filter("publishTip",[function(){"use strict";return function(e){if(e){var t="This item is in the "+e+" state.";return"PUBLISHED"===e&&(t="This item is LIVE. If it has draft children, clicking publish here will change them to the live state."),"PRIVATE"===e&&(t="This item is in the DRAFT state."),"SUBMITTED"===e&&(t="This item is in the MODERATING state."),t}}}]),angular.module("RealizeApp").controller("CenterCtrl",["$scope","$routeParams","$location","$log","CenterContent","webStorage","$timeout","TEACHER_RESOURCES_DRAWER",function(e,t,n,r,s,a,i,o){"use strict";e.content=s;var l,c=o+e.currentUser.userId;l=i(function(){var t=a.get(c),n=e.content,r=n&&!_.isEmpty(n.contentItems),s=n&&!_.isEmpty(n.associatedTeacherSupport)&&!_.isEmpty(n.associatedTeacherSupport.contentItems);t&&r&&s&&(e.sidebarOpen=t)}),e.$watch("sidebarOpen",function(e){angular.isDefined(e)&&a.add(c,e)}),e.open=function(e,t){e.preventDefault(),e.stopPropagation();var r=n.path();r=t.$isNbcItem()?["/nbclearn/video",t.id,t.version].join("/"):[r,"content",t.id,t.version].join("/"),n.path(r)},e.back=function(r){r.stopPropagation();var s,a=n.path();s=t.keywords?a.split("/search")[0]+"/search":a.split("/center/")[0],e.goBack(s,!0)},e.$on("$destroy",function(){i.cancel(l)})}]),angular.module("RealizeApp").controller("CentersLandingCtrl",["$scope","$location","CentersProgramListInfo","$log","$rootScope","lwcI18nFilter","$route","PATH",function(e,t,n,r,s,a,i,o){"use strict";e.programs=n.programs,e.totalMatches=n.totalMatches,e.favoriteAttr="programsWithCenters.favorites",e.sortByAttr="programsWithCenters.defaultSort",e.$route=i,e.open=function(e,n){if(r.debug(e,n),e.preventDefault(),e.stopPropagation(),n.centersProperties){var a=n.centersProperties.itemUuid;a&&t.path(["/centers",n.id,n.version,a,0].join("/")),s.currentProgram=n}else r.log("No associatedCenterId id")},e.firstVisit={showAlert:!e.currentUser.getAttribute("centers.info.seen"),title:a("centers.firstVisitInfo.title"),description:a("centers.firstVisitInfo.description"),closeFn:function(){e.currentUser.setAttribute("centers.info.seen",!0),e.firstVisit.showAlert=!1}},s.currentUser.isReviewer?(e.reviewTemplate="templates/partials/reviewer_zero_centers.html",e.imagePath=o.IMAGES,e.showReviewZero=!e.currentUser.getAttribute("reviewer.centers.visited"),e.currentUser.setAttribute("reviewer.centers.visited",!0)):e.showReviewZero=!1}]),angular.module("RealizeApp").controller("CentersTierCtrl",["$scope","$location","$log","TierContent","MediaQuery",function(e,t,n,r,s){"use strict";e.content=r,e.isMixedMode=function(t){return"list"===t&&e.sidebarOpen&&!s.breakpoint.isDesktop},e.back=function(n){n.stopPropagation(),e.goBack(function(){var e,n=t.path();e=n.search("/tier2/")>=0?n.split("tier2")[0]:n.search("/tier")>=0?n.split("tier")[0]:"/centers",t.path(e)},!0)}}]),angular.module("Realize.classRosterThemes.constants",[]).constant("CLASS_ROSTER_THEMES",[{name:"Standard",label:"earlyLearner.chooseExperienceSteps.option1",image_class:"experience-standard"},{name:"EarlyLearner",label:"earlyLearner.chooseExperienceSteps.option2",image_class:"experience-early-learner"}]).constant("EARLY_LEARNER_CONSTANTS",{THEME_EARLY_LEARNER:"EarlyLearner",THEME_STANDARD:"Standard",PROFILE_KEY:"profile.learningExperience"}),angular.module("Realize.constants.contentUploadTypes",[]).constant("CONTENT_UPLOAD_TYPES",{NBC_LEARN:"nbclearn",LINK:"link",FILE:"file",URL:"URL",GOOGLE_DOC:"Google Doc",GOOGLE_DRIVE:"googleDrive",ONE_DRIVE:"oneDrive",ASSESSMENT:"assessment",BUILD_TEST:"buildTest",ESSAY_PROMPT:"essayPrompt",ETEXT:"eText",EDIT_LESSON:"Edit Lesson",CREATE_CONTENT_SUBNAV:"Create Content"}),angular.module("Realize.constants.contribSource",[]).constant("CONTRIBUTOR_SOURCE",{PEARSON:"Pearson",MY_UPLOADS:"My Uploads"}),angular.module("Realize.constants.draTelemetry",[]).constant("DRA_TELEMETRY",{LEVELED_READERS:"Leveled Readers",DRA:"DRA",DRA_SCALE:"DRA Code",DRA_SCALE_SEARCH:"Search",DESCRIPTION:"DRA Code Search",EMPTY_STRING:"",DRA_PRODUCT_NOT_AVAILABLE:"Program Not Available",DRA_SEARCH_RESULTS:"DRA Search Results",REFINE_DRA_SCALE:"Refine DRA Scale"}),angular.module("Realize.constants.fileUploadErrorResponse",[]).constant("FILE_UPLOAD_ERROR_RESPONSE",{AV_SCAN_RESPONSE_TEXT:"common.avs.scan.virus.detected"}),angular.module("Realize.constants.fileValidatorType",[]).constant("FILE_VALIDATOR_TYPE",{FILE_SIZE_VALIDATOR:{MIN_FILE_SIZE:1024,MAX_FILE_SIZE:10485760},FILE_TYPE_VALIDATOR:{DOC_TYPE:"doc",DOCX_TYPE:"docx",PPT_TYPE:"ppt",PPTX_TYPE:"PPTX",JPG_TYPE:"jpg",PNG_TYPE:"PNG",MP3_TYPE:"mp3",MP4_TYPE:"mp4",PDF_TYPE:"pdf"}}),angular.module("Realize.constants.googleClassroom",[]).constant("GOOGLE_CLASSROOM",{SIZE:"18",THEME:"light",SHOW_GOOGLE_CLASSROOM_INTEGRATION:"show.google.classroom.integration",ROSTER_SOURCE:{GOOGLE_CLASSROOM:"google"},SYNC_SUCCESS_TIMEOUT:1e4,SYNC_SUCCESS:"success",SYNC_IN_PROGRESS:"inProgress",SYNC_COMPLETED:"Completed",ASSIGNMENT_LIST:"Assignment List",ASSIGNMENT_DETAIL:"Assignment Detail",GET_STARTED:"Get Started",SETTINGS:"Settings",ACCOUNT_LINKING:"Account Linking",GOOGLE_GET_STARTED:"Google - Get Started",CONNECT_CLASS:"Connect Class",GOOGLE_CONNECT:"Google - Connect",EDIT_CLASS_SETTINGS:"Edit Class Settings",GOOGLE_EDIT_CLASS:"Google - Edit Class",DATA:"Data",OPEN:"Open",DISCONNECT:"Disconnect",DISCONNECT_ACCOUNT:"Disconnect Account",GOOGLE_DISCONNECT_ACCOUNT:"Google - Disconnect Account",HOME:"Home",DELETED:"DELETED",ARCHIVED:"ARCHIVED",DELETED_LOWERCASE:"deleted",ARCHIVED_LOWERCASE:"archived",ACTIVE:"ACTIVE",HIDDEN:"hidden",UNARCHIVE:"Unarchive",UNARCHIVE_CLASS:"Unarchive Class",GOOGLE_UNARCHIVE:"Google - Unarchive",ACCOUNT_REVOKED_STATUS_CODE:412,EXTERNAL_ERROR:"External"}),angular.module("Realize.constants.lexileTelemetry",[]).constant("LEXILE_TELEMETRY",{LEVELED_READERS:"Leveled Readers",LEXILE_SCALE:"Lexile Scale",LEXILE_SEARCH:"Lexile Search",DESCRIPTION_WITHOUT_FILTER:"Lexile search - no filter",LEXILE_FACET:"Lexile Facet",DESCRIPTION_WITH_FILTER:"Lexile search - with filter",LEXILE:"Lexile",LEXILE_SCALE_SEARCH:"lexileScaleSearch",FACET_CHANGE_EVENT:"facetChangeEvent",EMPTY_STRING:""}),angular.module("Realize.constants.mediaType",[]).constant("MEDIA_TYPE",{DISCUSSION_PROMPT:"Discussion Prompt",ADAPTIVE_HOMEWORK:"Adaptive Homework",SELECTED_READING:"Selected Reading",LEVELED_READER:"Leveled Reader",PARTNER_LINK:"Partner Link",LEARNING_MODEL:"Learning Model",STUDENT_VOICE:"Student Voice",INTERACTIVE_MEDIA:"Interactive Media",LINK:"Link",TEST:"Test",AUDIO:"Audio",VIDEO:"Video",ETEXT:"eText",REALIZE_READER_SELECTION:"Realize Reader Selection",QUESTION_BANK:"Question Bank",DOCUMENT:"Document",NOT_AVAILABLE:"notavailable",ACTIVITY_SUPPORT:"Activity Support",LESSON:"Lesson",TIER:"Tier",CONTENT:"content",REMEDIATION:"Remediation",PLAYLIST:"Playlist",DESMOS:"Desmos",NOTATION:"Notation",CENTER_CONTAINER:"Center Container",LEARNING_RESOURCE:"Learning Resource",GOOGLE_DOC:"Google Doc"}),angular.module("Realize.constants.partialsPaths",[]).constant("PARTIALS_PATHS",{studentsAndGroupOptions:"templates/partials/studentsAndGroupOptions.html"}),angular.module("Realize.constants.profileTeacherConstants",[]).constant("PROFILE_TEACHER",{TELEMETRY:{LETS_GO_BUTTON_CLICK_EVENT:"Let's Go Button",WELCOME:"Welcome"}}),angular.module("Realize.constants.questionType",[]).constant("QUESTION_TYPE",{MULTIPLE_CHOICE:"multiple-choice",GRIDDED_RESPONSE:"gridded-response"}),angular.module("Realize.constants.stateCode",[]).constant("STATE_CODE",[{stateCode:"AL",stateName:"Alabama"},{stateCode:"AK",stateName:"Alaska"},{stateCode:"AZ",stateName:"Arizona"},{stateCode:"AR",stateName:"Arkansas"},{stateCode:"CA",stateName:"California"},{stateCode:"CO",stateName:"Colorado"},{stateCode:"CT",stateName:"Connecticut"},{stateCode:"DE",stateName:"Delaware"},{stateCode:"DC",stateName:"District of Columbia"},{stateCode:"FL",stateName:"Florida"},{stateCode:"GA",stateName:"Georgia"},{stateCode:"HI",stateName:"Hawaii"},{stateCode:"ID",stateName:"Idaho"},{stateCode:"IL",stateName:"Illinois"},{stateCode:"IN",stateName:"Indiana"},{stateCode:"IA",stateName:"Iowa"},{stateCode:"KS",stateName:"Kansas"},{stateCode:"KY",stateName:"Kentucky"},{stateCode:"LA",stateName:"Louisiana"},{stateCode:"ME",stateName:"Maine"},{stateCode:"MD",stateName:"Maryland"},{stateCode:"MA",stateName:"Massachusetts"},{stateCode:"MI",stateName:"Michigan"},{stateCode:"MN",stateName:"Minnesota"},{stateCode:"MS",stateName:"Mississippi"},{stateCode:"MO",stateName:"Missouri"},{stateCode:"MT",stateName:"Montana"},{stateCode:"NE",stateName:"Nebraska"},{stateCode:"NV",stateName:"Nevada"},{stateCode:"NH",stateName:"New Hampshire"},{stateCode:"NJ",stateName:"New Jersey"},{stateCode:"NM",stateName:"New Mexico"},{stateCode:"NY",stateName:"New York"},{stateCode:"NC",stateName:"North Carolina"},{stateCode:"ND",stateName:"North Dakota"},{stateCode:"OH",stateName:"Ohio"},{stateCode:"OK",stateName:"Oklahoma"},{stateCode:"OR",stateName:"Oregon"},{stateCode:"PA",stateName:"Pennsylvania"},{stateCode:"RI",stateName:"Rhode Island"},{stateCode:"SC",stateName:"South Carolina"},{stateCode:"SD",stateName:"South Dakota"},{stateCode:"TN",stateName:"Tennessee"},{stateCode:"TX",stateName:"Texas"},{stateCode:"UT",stateName:"Utah"},{stateCode:"VT",stateName:"Vermont"},{stateCode:"VA",stateName:"Virginia"},{stateCode:"WA",stateName:"Washington"},{stateCode:"WV",stateName:"West Virginia"},{stateCode:"WI",stateName:"Wisconsin"},{stateCode:"WY",stateName:"Wyoming"},{stateCode:"AS",stateName:"American Samoa"},{stateCode:"FM",stateName:"Federated States of Micronesia"},{stateCode:"GU",stateName:"Guam"},{stateCode:"MH",stateName:"Marshall Islands"},{stateCode:"MP",stateName:"Northern Mariana Islands"},{stateCode:"PW",stateName:"Palau"},{stateCode:"PR",stateName:"Puerto Rico"},{stateCode:"UM",stateName:"U.S. Minor Outlying Islands"},{stateCode:"VI",stateName:"Virgin Islands"},{stateCode:"AB",stateName:"Alberta"},{stateCode:"BC",stateName:"British Columbia"},{stateCode:"MB",stateName:"Manitoba"},{stateCode:"NB",stateName:"New Brunswick"},{stateCode:"NL",stateName:"Newfoundland and Labrador"},{stateCode:"NS",stateName:"Nova Scotia"},{stateCode:"NT",stateName:"Northwest Territories"},{stateCode:"NU",stateName:"Nunavut"},{stateCode:"ON",stateName:"Ontario"},{stateCode:"PE",stateName:"Prince Edward Island"},{stateCode:"QC",stateName:"Quebec"},{stateCode:"SK",stateName:"Saskatchewan"},{stateCode:"YT",stateName:"Yukon"}]),angular.module("Realize.constants.truncationLength",[]).constant("TRUNCATION_LENGTH",{LARGE_TABLET:{CLASS_TITLE:32},SMALL_TABLET:{CLASS_TITLE:24}}),angular.module("RealizeApp").controller("ErrorCtrl",["$scope","$route","CONTINEO_CAT_URL","lwcI18nFilter","$window","$location",function(e,t,n,r,s,a){"use strict";
e.errorType=t.current.params.errorType,e.isStudent=e.currentUser.hasRole("ROLE_STUDENT"),e.CONTINEO_CAT_URL=n,e.zeroStateDataTabDetails={headingText:r("classList.autoPlus.zeroStateClass.heading"),contentText:r("classList.autoPlus.zeroStateClass.messageContent"),createClassButtonText:r("classList.autoPlus.zeroStateClass.addProgram"),createClassButtonLink:e.CONTINEO_CAT_URL,connectClassButtonText:r("classList.autoPlus.zeroStateClass.connectClass"),connectClassButtonLink:a.absUrl(),isFederatedUser:!0,isClassesTab:!1}}]),angular.module("Realize.header",["Realize.header.mainNav","Realize.header.subNav"]),angular.module("RealizeApp").constant("HOME_STATES",{loading:"LOADING",notStarted:"NOT_STARTED",inProgress:"IN_PROGRESS",complete:"COMPLETE",noAssignment:"NO_ASSIGNMENT",noClass:"NO_CLASS",oneClass:"ONE_CLASS",manyClasses:"MANY_CLASSES",existingClass:"EXISTING_CLASS",allHidden:"ALL_HIDDEN",noAssociatedPrograms:"NO_ASSOCIATED_PROGRAMS",firstVisit:"FIRST_VISIT",oneProgram:"ONE_PROGRAM",manyPrograms:"MANY_PROGRAMS",create:"CREATE",none:"NONE",findItems:"FIND_ITEMS",mustAddStudentInSIS:"MUST_ADD_STUDENT_IN_SIS"}).controller("HomeCtrl",["Permissions","$scope","PATH","SHARED_THUMBNAIL_PATH","AssignmentFacadeService","$log","$filter","CONTINEO_SERVER_URL","CONTINEO_CAT_URL","CONTINEO_SERVER_HELP_URL","$rootScope","Modal","$location","$currentUser","BrowserInfo","lwcI18nFilter",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f){"use strict";var h=t.currentUser.getAttribute("home.background")||"teacher1",v=p.isHDDisplay?"@2x.jpg":".jpg",S=t.currentUser,T=n.TEMPLATES+"/templates/partials/simpleDialog.html";t.firstVisit=!S.getAttribute("home.visited"),t.wizardComplete="complete"===S.getAttribute("profile.wizard"),t.programsVisited=S.getAttribute("programs.visited"),t.classesCreated=S.getAttribute("classes.created"),t.classesVisited=S.getAttribute("classes.visited"),t.assignmentsCreated=S.getAttribute("assignments.created"),t.hasNBCLearnCourse=S.isNbcLearnUser(),t.intercomTemplate=n.TEMPLATE_ROOT+"/app/home/teacher/intercom.html",t.classes=[],t.classesWithoutProduct=S.getAttribute("classes.withoutPrograms")||[],t.background=r+"/homepage/"+h+v,t.CONTINEO_SERVER_URL=o,t.CONTINEO_CAT_URL=l,t.isFederatedUserNoClassesCreated=g.isFederatedUser&&!t.classesCreated,t.hasPermission=e.hasPermission,t.homeLoaded=!1,t.intercomEnabled=function(){if("true"===window.intercomEnabled&&g.hasRole("ROLE_TEACHER")){var e=angular.element("#intercom-container");if(null!==e){if(m.path().search("/home")>=0)return e.show(),!0;e.hide()}}return!1};var A=function(){S.showNoProgramModal()&&!g.isFederatedUser&&d.simpleDialog("noPrograms.modal.assignments.heading","noPrograms.modal.assignments.message",{OK:{title:"noPrograms.modal.action.ok",handler:function(){var e=S.getAttribute("classes.withoutPrograms");S.setAttribute("hideNoProgramModal",!0),e.length>1?m.path("classes"):m.path(["classes",e[0],"manage"].join("/"))},isDefault:!0},CANCEL:{title:"noPrograms.modal.action.cancel",handler:function(){S.setAttribute("hideNoProgramModal",!0)}}},{id:"assignModalNoPrograms"})};if(t.wizardComplete)if(t.currentUser.setAttribute("home.visited",!0),t.firstVisit)if(t.currentUser.setAttribute("home.visited",!0),t.currentUser.getAttribute("isSelfRegUser")){var I=t.$new(!0);I.close=d.hideDialog,d.showDialog("templates/partials/demo_first_visit_modal.html",I)}else A();else A();t.phase={programs:{loaded:!1},classes:{loaded:!1},assignments:{loaded:!1}};var E=function(){var e=u.$new();e.title=f("federatedUser.teacherHome.modal.noAssociatedPrograms.header"),e.body=[f("federatedUser.teacherHome.modal.noAssociatedPrograms.body")," ",'<a class="underline" href="'+l+'">',f("federatedUser.teacherHome.modal.noAssociatedPrograms.url"),"</a>."].join(""),e.closeBtnClickHandler=function(){t.currentUser.setAttribute("federatedUser.noAssociatedPrograms.info.seen",!0),d.hideDialog()},e.buttons=[{title:f("federatedUser.teacherHome.modal.noAssociatedPrograms.buttons.ok"),isDefault:!0,clickHandler:e.closeBtnClickHandler}],d.showDialog(T,e)};if(!t.currentUser.getAttribute("federatedUser.noAssociatedPrograms.info.seen")&&t.isFederatedUserNoClassesCreated&&0!==m.path().search("/welcome")&&E(),t.showModalFederatedUserNoStudentAndAllClassesWithoutProduct=function(){var e=u.$new();e.title=f("federatedUser.teacherHome.modal.noAssociatedProgramsAndnoStudents.header"),e.body=[f("federatedUser.teacherHome.modal.noAssociatedProgramsAndnoStudents.bodyPart1")," ",'<a class="underline" href="'+l+'">',f("federatedUser.teacherHome.modal.noAssociatedProgramsAndnoStudents.url1"),"</a>",f("federatedUser.teacherHome.modal.noAssociatedProgramsAndnoStudents.bodyPart2")," ",'<a class="underline" target="_blank" href="'+c+'">',f("federatedUser.teacherHome.modal.noAssociatedProgramsAndnoStudents.url2"),"</a>",f("federatedUser.teacherHome.modal.noAssociatedProgramsAndnoStudents.bodyPart3")].join(""),e.closeBtnClickHandler=function(){t.currentUser.setAttribute("federatedUser.noStudents.info.seen",!0),t.currentUser.setAttribute("federatedUser.noAssociatedPrograms.info.seen",!0),d.hideDialog()},e.buttons=[{title:f("federatedUser.teacherHome.modal.noAssociatedProgramsAndnoStudents.buttons.ok"),isDefault:!0,clickHandler:e.closeBtnClickHandler}],d.showDialog(T,e)},t.showModalFederatedUserHasClassesWithoutStudent=function(){var e=u.$new();e.title=f("federatedUser.teacherHome.modal.HasClassesWithoutStudent.header"),e.body=[f("federatedUser.teacherHome.modal.HasClassesWithoutStudent.bodyPart1")," ",'<a class="underline" href="'+l+'">',f("federatedUser.teacherHome.modal.HasClassesWithoutStudent.url1"),"</a>",f("federatedUser.teacherHome.modal.HasClassesWithoutStudent.bodyPart2")," ",'<a class="underline" target="_blank" href="'+c+'">',f("federatedUser.teacherHome.modal.HasClassesWithoutStudent.url2"),"</a>",f("federatedUser.teacherHome.modal.HasClassesWithoutStudent.bodyPart3")].join(""),e.closeBtnClickHandler=function(){t.currentUser.setAttribute("federatedUser.noStudents.info.seen",!0),d.hideDialog()},e.buttons=[{title:f("federatedUser.teacherHome.modal.HasClassesWithoutStudent.buttons.ok"),isDefault:!0,clickHandler:e.closeBtnClickHandler}],d.showDialog(T,e)},t.showModalFederatedUserALLClassesWithoutProduct=function(){var e=u.$new();e.title=f("federatedUser.teacherHome.modal.aLLClassesWithoutProduct.header"),e.body=[f("federatedUser.teacherHome.modal.aLLClassesWithoutProduct.bodyPart1")," ",'<a class="underline" href="'+l+'">',f("federatedUser.teacherHome.modal.aLLClassesWithoutProduct.url1"),"</a>",f("federatedUser.teacherHome.modal.aLLClassesWithoutProduct.bodyPart2")," ",'<a class="underline" target="_blank" href="'+c+'">',f("federatedUser.teacherHome.modal.aLLClassesWithoutProduct.url2"),"</a>",f("federatedUser.teacherHome.modal.aLLClassesWithoutProduct.bodyPart3")].join(""),e.closeBtnClickHandler=function(){t.currentUser.setAttribute("federatedUser.noAssociatedPrograms.info.seen",!0),d.hideDialog()},e.buttons=[{title:f("federatedUser.teacherHome.modal.aLLClassesWithoutProduct.buttons.ok"),isDefault:!0,clickHandler:e.closeBtnClickHandler}],d.showDialog(T,e)},t.classesCreated===!0){t.rostersLoading=!0;var y=s.getClassesReportingData(g.isTeacher);y.then(function(e){g.isTeacher?(t.classes=e.rosters,t.teacherStat=e.teacherStat):t.classes=e,t.numClasses=t.classes.length>1?" "+t.classes.length+" ":" ",t.phase.classes.loaded=t.phase.assignments.loaded=!0,t.$broadcast("homeTeacherCtrl.rosters.load.complete")})}else t.classes=[];t.$watch("phase",function(e){var n=e.programs.loaded,r=e.classes.loaded,s=e.assignments.loaded;n&&r&&s&&(t.homeLoaded=!0)},!0)}]),angular.module("RealizeApp.logoutCtrl",["Realize.paths","webStorageModule"]).controller("LogoutCtrl",["$window","webStorage","PATH",function(e,t,n){"use strict";t.clear(),e.location.href=n.ROOT+"/j_spring_security_logout"}]),angular.module("RealizeApp.logout",["ngRoute","RealizeApp.logoutCtrl"]).config(["$routeProvider",function(e){"use strict";e.when("/logout",{controller:"LogoutCtrl",template:"<div></div>"})}]),function(){"use strict";function e(e){return{bindToController:!0,controller:"ItemBoxesController",controllerAs:"itemBoxes",link:{post:function(e,t,n,r){r.adjustHeight()}},restrict:"EA",scope:{items:"="},templateUrl:e.TEMPLATE_ROOT+"/app/profile/itemBoxes.html"}}function t(e,n,r){this.element=n[0],this.scope=e,this.watchItems(),t.STATE_INFO_LIMIT=r.STATE_INFO_LIMIT}e.$inject=["PATH"],t.$inject=["$scope","$element","STANDARDS_STATE_INFO"],t.prototype.watchItems=function(){var e=this.scope.$watch(function(){return this.items}.bind(this),function(){this.filteredItems=this.filterItems(this.items),this.scope.$applyAsync(this.adjustHeight.bind(this)),e()}.bind(this))},t.prototype.filterItems=function(e){var n={};return t.forOwn(e,function(e,r){n[r]=t.shortenItems(e)},this),n},t.shortenItems=function(e){var n=[];return e.forEach(function(e){null!==e&&n.push(e.substring(0,t.STATE_INFO_LIMIT))}),n},t.prototype.getChildren=function(){var e=this.element.children[0];return t.toArray(e.children)},t.prototype.adjustHeight=function(){var e,n,r=this.getChildren();r.forEach(function(r,s){var a=t.isEven(s),i=r.clientHeight;a?(n=i,e=r):t.setElementHeights([r,e],[i,n])})},t.setElementHeights=function(e,t){var n=Math.max.apply(Math,t);e.forEach(function(e){e.style.height=n+"px"})},t.isEven=function(e){return e%2===0},t.toArray=function(e){return Array.from?Array.from(e):Array.prototype.slice.call(e)},t.forOwn=function(e,t,n){Object.keys(e).forEach(function(r){var s=e[r];return n?t.call(n,s,r):t(s,r)})},angular.module("Realize.profile.itemBoxes",[]).constant("STANDARDS_STATE_INFO",{STATE_INFO_LIMIT:50}).controller("ItemBoxesController",t).directive("itemBoxes",e)}(),angular.module("Realize.student.profile",["Realize.classRosterThemes.constants"]).controller("StudentProfileCtrl",["$sce","$q","$scope","$location","$anchorScroll","$filter","PATH","$http","Modal","$log","$rootScope","User","lwcI18nFilter","RealizeHelpers","UnsavedChangesModal","BrowserInfo","$window","EARLY_LEARNER_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v){"use strict";n.isActiveStep=function(e){if(!n.stepSpy||e>=n.stepSpy.length)return 0===e;var t=n.stepSpy[e].top,r=g.isElementScrolledToBottom($("#steps"),10);if(e===n.stepSpy.length-1)return 57>=t||r;if(!r){var s=n.stepSpy[e+1].top-t;return(0===e?0:57)>=t&&t>=-1*(s-57)}return!1},n.firstName=n.currentUser.firstName,n.middleName=n.currentUser.getAttribute("profile.middleName"),n.lastName=n.currentUser.lastName,n.email=n.currentUser.rumbaEmail,n.facingName=n.currentUser.getAttribute("profile.displayName"),n.username=n.currentUser.userName,n.selectedBG=n.currentUser.getAttribute("home.background")||"teacher1",n.profileIcons=[],n.selectedProfileIcon=n.currentUser.getAttribute("profile.avatar")||"01_student";var S=i.IMAGES+"/profile_icons/",T=i.SHARED_THUMBNAILS+"/homepage/settings/",A=function(e,t,n,r){this.name=e,this.basePath=t,this.filename=n,this.fileExt=r};A.prototype.getPath=function(){return[this.basePath,this.filename,f.isHDDisplay?"@2x":"",this.fileExt].join("")},A.prototype.getName=function(){return this.name};var I,E;for(I=1;19>I;I++)E=I.toString(),E.length<2&&(E="0"+E),n.profileIcons.push(new A(E+"_student",S,E+"_student",".png"));n.bgImages=[];var y;for(y=1;13>y;y++)n.bgImages.push(new A("teacher"+y,T,"teacher"+y,".png"));n.chooseProfileIcon=function(e,t){e&&(e.preventDefault(),e.stopPropagation()),n.selectedProfileIcon=t.name},n.scrollTo=function(e){r.hash(e),s(),f.browser.isIE&&8===f.browser.version&&$("#steps").scroll()},n.setBackground=function(e,t){e&&(e.preventDefault(),e.stopPropagation(),n.selectedBG=t)},n.finish=function(){if(n.wizardForm.$valid){var e=n.editUser,t="Spanish"===n.selectedLanguage?"es":"en",s={"profile.avatar":n.selectedProfileIcon,"home.background":n.selectedBG,"profile.locale":t,"profile.wizard":"complete"},a=e.userAttributes["profile.learningExperience"]||v.THEME_STANDARD,o=!1;n.assignmentUrl=e.userAttributes.googleAssignmentRedirectURL,d.updateCurrentUserAttributes(s).then(function(){var e=!1;if(a===v.THEME_EARLY_LEARNER)n.assignmentUrl?h.location=n.assignmentUrl:h.location.reload(!0);else{if(n.currentUser.$setAvatar(n.selectedProfileIcon,o),n.wizardForm.languageDropdownInput.$dirty)return e=!0,n.currentUser.$setLocale(t,o,e),h.location=n.assignmentUrl?n.assignmentUrl:i.ROOT,void 0;r.hash(""),n.assignmentUrl?(n.assignmentUrl=n.assignmentUrl.split("/community")[1],r.path(n.assignmentUrl)):r.path("/")}})}},n.editUser=angular.copy(n.currentUser),n.selectedLanguage="English";var R=n.editUser.getAttribute("profile.locale");"es"===R&&(n.selectedLanguage="Spanish"),n.showPreviewBG=function(){var t;t="es"===R?'<img src="'+i.IMAGES+'/homepage/preview/home_preview_student_spanish.png" class="previewBG" />':'<img src="'+i.IMAGES+'/homepage/preview/home_preview_student.png" class="previewBG" />';var r='<img src="'+i.SHARED_THUMBNAILS+"/homepage/preview/"+n.selectedBG+(f.isHDDisplay?"@2x.jpg":".jpg")+'" class="previewSM" />',s=n.$new(!0);s.dialogId="homeBGPreview",s.title=m("teacherProfile.step5.preview.title"),s.body=e.trustAsHtml(r+t),s.closeBtnClickHandler=function(){l.hideDialog(),s.$destroy()},s.buttons=[{title:"OK",isDefault:!0,clickHandler:function(){l.hideDialog(),s.$destroy()}}],l.showDialog("templates/partials/simpleDialog.html",s)};var C=new p(function(){return n.save()});n.$on("$locationChangeStart",function(e){n.studentSettingsForm&&n.studentSettingsForm.$dirty&&C.showDialog(e).then(null,function(){n.pageLoaded()})}),n.save=function(e,t){return e=e||angular.noop,t=t||angular.noop,n.settingsError=!1,n.studentSettingsForm&&n.studentSettingsForm.$valid?n.editUser.$save().then(function(){var t="Spanish"===n.selectedLanguage?"es":"en";return d.updateCurrentUserAttributes({"home.background":n.selectedBG}).then(function(){return n.currentUser.$setAvatar(n.selectedProfileIcon)}).then(function(){n.editUser.$setLocale(t),angular.extend(u.currentUser,n.editUser)}).then(function(){n.cancel(),n.settingsSuccess=!0,e()})},function(){}):(n.settingsError=!0,n.isInProgress=!1,t(),void 0)},n.cancel=function(){n.studentSettingsForm.$setPristine(),n.editUser=angular.copy(n.currentUser),n.selectedLanguage="English";var e=n.editUser.getAttribute("profile.locale");"es"===e&&(n.selectedLanguage="Spanish"),n.selectedProfileIcon=n.editUser.getAttribute("profile.avatar")||"01_teacher",n.selectedBG=n.editUser.getAttribute("home.background")||"teacher1",n.isInProgress=!1,n.settingsError=!1},n.isEarlyLearnerTheme=function(){return n.editUser.userAttributes["profile.learningExperience"]===v.THEME_EARLY_LEARNER},n.$on("$viewContentLoaded",function(){angular.element("#step1 .scrollDivider a").focus()})}]),angular.module("Realize.teacher.profile",["Realize.constants.stateCode","Realize.user.currentUser","Realize.common.optionalFeaturesService","Realize.constants.googleClassroom","Realize.constants.profileTeacherConstants","rlzComponents.components.googleClassroom.constants","rlzComponents.components.telemetryService","rlzComponents.components.telemetry.constants"]).controller("TeacherProfileCtrl",["$scope","Permissions","$location","OptionalFeatures","$anchorScroll","$filter","PATH","$http","Modal","$log","$rootScope","User","lwcI18nFilter","RealizeHelpers","ROOT_PATH","FormService","$cacheFactory","REST_PATH","UnsavedChangesModal","$currentUser","BrowserInfo","Standard","STATE_CODE","GOOGLE_CLASSROOM","googleClassroomService","googleClassroomUtils","GoogleClassroomConstants","featureManagementService","ProfileUserMapping","PROFILE_TEACHER","telemetryService","baseTelemetryEvents","TELEMETRY_CONSTANTS","standardModal",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R,C,D,b,P,w,L,O,N,M){"use strict";e.stepsVisited={},e.availableStates=E,e.googleClassroomHelpUrlInstructor=window.googleClassroomHelpUrlInstructor,e.showGoogleClassroomIntegration=b.isGoogleClassroomEnabled(),e.googleClassroomText={yourGoogleClassroomAccount:m("teacherHome.yourGoogleClassroomAccount"),connectedToRealize:m("teacherHome.connectedToRealize"),googleClassroomConnect1:m("teacherHome.googleClassroomConnect1"),googleClassroomConnect2:m("teacherHome.googleClassroomConnect2"),connectMoreGoogleClasses:m("teacherHome.connectMoreGoogleClasses"),getStarted:m("teacherHome.getStarted")},e.getUserLinkedStatus=function(){if(P&&P.data){var t=P.data.userMapping;e.showGoogleClassroomIntegration&&t&&(e.isUserLinked=t.linked,e.googleClassroomEmailAddress=t.email||"",e.showDisconnect=t.linked)}},e.getUserLinkedStatus(),e.isActiveStep=function(t){if(!e.stepSpy||t>=e.stepSpy.length)return 0===t;var n,r=e.stepSpy[t].top,s=g.isElementScrolledToBottom($("#steps"),20);if(t===e.stepSpy.length-1)n=57>=r||s;else if(!s){var a=e.stepSpy[t+1].top-r;n=(0===t?0:57)>=r&&r>=-1*(a-57)}return n&&!_.has(e.stepsVisited,t)&&(e.stepsVisited[t]=!0,e.stepsVisited.last=t),n},e.availablePrograms=[];var k,z=e.currentUser.subscribedCourses;for(k=0;k<e.currentUser.availableCourses.length;k++){var U=e.currentUser.availableCourses[k];e.availablePrograms.push({name:U,checked:$.inArray(U,z)>=0,disabled:$.inArray(U,z)>=0})}var F=function(){var t=a("filter")(e.availablePrograms,{checked:!0});return t=$.Enumerable.From(t).Select("$.name").ToArray(),e.programDirty===!1&&t.length>0&&(e.programDirty=!0),t},x=function(){u.viewLoading=!0,I.getStandardsStateDetails(F()).then(function(t){e.standardsData=t,u.viewLoading=!1})},B={},V={};e.$watch("availablePrograms",function(){e.wizardForm&&e.wizardForm.$setValidity("programs",F().length>0)},!0),e.firstName=T.firstName,e.middleName=T.getAttribute("profile.middleName"),e.lastName=T.lastName,e.email=T.rumbaEmail,e.facingName=T.getAttribute("profile.displayName"),e.username=T.userName,e.selectedBG=T.getAttribute("home.background")||"teacher1",e.announcements=T.getAttribute("profile.announcements"),e.hasPermission=t.hasPermission,e.federatedSettingAlert={showAlert:!0,getTitle:function(){return m("federatedUser.teacherSettings.alert.title")},getDescription:function(){return m("federatedUser.teacherSettings.alert.description")},closeFn:function(){e.federatedSettingAlert.showAlert=!1}},e.profileIcons=[],e.selectedProfileIcon=T.getAttribute("profile.avatar")||"01_teacher";var H=i.IMAGES+"/profile_icons/",G=i.SHARED_THUMBNAILS+"/homepage/settings/",j=function(e,t,n,r){this.name=e,this.basePath=t,this.filename=n,this.fileExt=r};j.prototype.getPath=function(){return[this.basePath,this.filename,A.isHDDisplay?"@2x":"",this.fileExt].join("")};var q,Y;for(q=1;19>q;q++)Y=q.toString(),Y.length<2&&(Y="0"+Y),e.profileIcons.push(new j(Y+"_teacher",H,Y+"_teacher",".png"));e.editUser=angular.copy(T),e.editUser.middleName&&(e.editUser.middleName=e.editUser.middleName.toString()),e.selectedLanguage="English";var W=e.editUser.getAttribute("profile.locale");"es"===W&&(e.selectedLanguage="Spanish");var K=T.getStateCode();if(K){e.curState=K;var Q=_.find(E,function(e){return e.stateCode===K});e.selectedStateCode=Q.stateName}e.setStateCodeValues=function(t,n){e.curState=t,e.selectedStateCode=n},e.isAdminStateSpecificContentEnabled=function(){return T.hasRole("ROLE_LIBRARY_ADMIN")},e.bgImages=[];var X;for(X=1;13>X;X++)e.bgImages.push(new j("teacher"+X,G,"teacher"+X,".png"));e.chooseProfileIcon=function(t,n){t&&(t.preventDefault(),t.stopPropagation()),e.selectedProfileIcon=n.name},e.grades=[];var Z=function(t){var n=[],r=["Pre-K","Kindergarten","Grade 1","Grade 2","Grade 3","Grade 4","Grade 5","Grade 6","Grade 7","Grade 8","Grade 9","Grade 10","Grade 11","Grade 12"];_.each(r,function(e){n.push({name:e,checked:$.inArray(e,t)>=0})}),e.grades=n};Z(T.getAttribute("profile.grades")),e.gradesDirty=!1;var J=function(){var t=a("filter")(e.grades,{checked:!0});return t=_.pluck(t,"name"),e.gradesDirty===!1&&t.length>0&&(e.gradesDirty=!0),t};e.$watch("grades",function(){e.wizardForm&&e.wizardForm.$setValidity("grades",J().length>0),e.aboutMeForm&&e.aboutMeForm.$setValidity("grades",J().length>0)},!0),e.scrollTo=function(e){n.hash(e)},e.setBackground=function(t,n){t&&(t.preventDefault(),t.stopPropagation(),e.selectedBG=n)},e.goButton={isClicked:!1,isErrored:!1},e.closeAlertMsg=function(){e.goButton.isClicked=!1,angular.element("#finishButton").focus()};var et,tt,nt=function(e,t){var n;n=e.description?O.createEventDataWithDescription(e.id,e.description,t):O.createEventData(e.id,t),L.sendTelemetryEvent(n)};e.finish=function(){if(e.wizardForm.$dirty=!0,e.gradesDirty=!0,e.wizardForm.$setValidity("grades",J().length>0),e.programsDirty=!0,e.wizardForm.$setValidity("programs",F().length>0),e.wizardForm.facingName.$dirty=!0,e.wizardForm.agreement.$dirty=!0,e.wizardForm.$error.grades)return e.scrollTo("step1"),void 0;if(e.wizardForm.$error.programs)return e.scrollTo("step2"),void 0;if(e.wizardForm.facingName.$invalid)return e.scrollTo("step3"),void 0;if(e.wizardForm.$valid){var t={"profile.avatar":e.selectedProfileIcon,"home.background":e.selectedBG,"profile.grades":angular.toJson(J()),"profile.displayName":e.facingName,"profile.termsOfUse":e.agreement,"profile.announcements":e.announcements,"profile.wizard":"complete"},r=!1;e.goButton.isClicked=!0,d.updateCurrentUserAttributes(t).then(function(){return T.$setAvatar(e.selectedProfileIcon,r),et=F(),tt=et.length,T.updateProductSubscriptions(et)}).then(function(){return T.getAttribute("hasCenter",!0)}).then(function(){B={id:N.EVENT_TYPE.OPEN},V={extensions:{page:w.TELEMETRY.WELCOME,value:tt},definition:{name:w.TELEMETRY.LETS_GO_BUTTON_CLICK_EVENT}},nt(B,V),n.hash(""),n.path("/")}).catch(function(t){B={id:N.EVENT_TYPE.ERROR,description:t.errorMessage},V={extensions:{page:w.TELEMETRY.WELCOME},definition:{name:w.TELEMETRY.LETS_GO_BUTTON_CLICK_EVENT}},nt(B,V),e.goButton.isClicked=!1,e.goButton.isErrored=!0,c.error("error",t)})}},e.showLicenseAgreement=function(t){t&&(t.preventDefault(),t.stopPropagation()),o.get(p+"/prelogin/userAgreement.html",{cache:!0}).success(function(t){var n=angular.element(t);angular.forEach(n.find("a"),function(e){var t=angular.element(e).attr("href"),n="knewton.com";-1===t.indexOf(n)&&angular.element(e).attr("href",p+"/prelogin/"+t)}),n.find("a").attr("target","_blank");var r=n.find("#content").html(),s=e.$new(!0);s.title="End User License Agreement",s.body=r,s.closeBtnClickHandler=function(){l.hideDialog(),s.$destroy()},s.buttons=[{title:"Close",isDefault:!0,clickHandler:function(){l.hideDialog(),s.$destroy()}}],l.showDialog("templates/partials/simpleDialog.html",s)})},e.showPreviewBG=function(){var t;t="es"===W?'<img src="'+i.IMAGES+'/homepage/preview/home_preview_teacher_spanish.png" class="previewBG" />':'<img src="'+i.IMAGES+'/homepage/preview/home_preview_teacher.png" class="previewBG" />';var n='<img src="'+i.SHARED_THUMBNAILS+"/homepage/preview/"+e.selectedBG+(A.isHDDisplay?"@2x.jpg":".jpg")+'" class="previewSM" />',r=e.$new(!0);r.dialogId="homeBGPreview",r.title=m("teacherProfile.step5.preview.title"),r.body=n+t,r.closeBtnClickHandler=function(){l.hideDialog(),r.$destroy()},r.buttons=[{title:"OK",isDefault:!0,clickHandler:function(){l.hideDialog(),r.$destroy()}}],l.showDialog("templates/partials/simpleDialog.html",r)};var rt=new S(function(){return e.save()});e.$on("$locationChangeStart",function(t){var n=e[e.activeTab+"Form"];n&&n.$dirty&&rt.showDialog(t).catch(function(){u.viewLoading=!1})}),e.showTab=function(t){"myPrograms"===t&&x();var n=e[e.activeTab+"Form"];n&&n.$dirty?rt.showDialog().then(function(){e.reset(),e.activeTab=t,rt.reset()}):e.activeTab=t,e.isAttemptSave=!1},e.activeTab="account",e.redirectToRealizeSyncWebApp=function(){var t=e.isUserLinked?y.CONNECT_CLASS:y.GET_STARTED,r=e.isUserLinked?y.GOOGLE_CONNECT:y.GOOGLE_GET_STARTED,s={extensions:{area:y.SETTINGS,page:y.ACCOUNT_LINKING,product:D.EVENT_TYPE.PROGRAM_NOT_AVAILABLE,description:r},definition:{name:t}};R.redirectToRealizeSyncWebApp(n.absUrl(),D.LAUNCH,s)},e.save=function(t,n){var r=e[e.activeTab+"Form"];if(t=t||angular.noop,n=n||angular.noop,e.settingsError=!1,r&&r.$valid){if("account"===e.activeTab){var s,a=T.getLocale(),i="Spanish"===e.selectedLanguage?"es":"en";return angular.extend(T,e.editUser),e.isAdminStateSpecificContentEnabled()&&(s=T.getStateCode(),T.setStateCode(e.curState)),T.$updateNames(),T.$save().then(function(){if(e.settingsSuccess=!0,a!==i&&T.$setLocale(i),e.reset(),t(),e.isAdminStateSpecificContentEnabled()&&s!==T.getStateCode()){var n=[v,"programs"].join("/"),r=[v,"centers"].join("/");h.get("$http").remove(n),h.get("$http").remove(r)}},function(){})}if("myPrograms"===e.activeTab)return x(),T.updateProductSubscriptions(F()).then(function(){e.settingsSuccess=!0,e.reset(),t()},function(e){c.error("failed to subscribe!",e)});if("aboutMe"===e.activeTab)return T.$setAvatar(e.selectedProfileIcon),d.updateCurrentUserAttributes({"home.background":e.selectedBG,"profile.grades":angular.toJson(J()),"profile.displayName":e.facingName}).then(function(){e.settingsSuccess=!0,e.reset(),t()})}else e.settingsError=!0,e.isInProgress=!1,n()},e.reset=function(){var t,n,r;e[e.activeTab+"Form"].$setPristine(),e.editUser=angular.copy(T),e.editUser.middleName||(e.editUser.middleName=null),e.selectedLanguage="English";var s=e.editUser.getAttribute("profile.locale");"es"===s&&(e.selectedLanguage="Spanish");var a=T.subscribedCourses;for(t=0;t<T.availableCourses.length;t++)n=T.availableCourses[t],r=_.findWhere(e.availablePrograms,{name:n}),r&&(r.checked=r.disabled=_.contains(a,n));e.selectedProfileIcon=e.editUser.getAttribute("profile.avatar")||"01_teacher",e.selectedBG=e.editUser.getAttribute("home.background")||"teacher1",e.facingName=e.editUser.getAttribute("profile.displayName"),Z(e.editUser.getAttribute("profile.grades")),e.isInProgress=!1,e.settingsError=!1},e.resetPasswordSuccess=function(){e.settingsSuccess=!0},e.$on("$locationChangeStart",function(){e.editUser.password=null,T.password=null}),e.getGoogleClassroomBannerText=function(){var t=e.googleClassroomText.yourGoogleClassroomAccount+"("+e.googleClassroomEmailAddress+") "+e.googleClassroomText.connectedToRealize;return t},e.getGoogleClassroomBannerButtonText=function(){return e.isUserLinked?e.googleClassroomText.connectMoreGoogleClasses:e.googleClassroomText.getStarted},e.disconnectGoogleClassroom=function(){var t=C.buildTelemetryEventObject(y.SETTINGS,y.ACCOUNT_LINKING,"",y.PROGRAM_NOT_AVAILABLE,y.DISCONNECT_ACCOUNT,y.GOOGLE_DISCONNECT_ACCOUNT,"");C.sendTelemetryEvent(y.DISCONNECT,t);var n="mutation {unlinkUserMapping {success,}}";R.classSyncServiceMutate(n).then(function(){e.isUserLinked=!1,e.showDisconnect=!1}).catch(function(e){c.error("error",e)})};var st={label:m("googleClassroom.disconnectModal.cancel"),ariaLabel:m("googleClassroom.disconnectModal.cancel"),action:function(){M.deactivate()},className:"disconnect-cancel-button",disabled:!1},at={label:m("googleClassroom.disconnectModal.yes"),ariaLabel:m("googleClassroom.disconnectModal.yes"),action:function(){M.deactivate(),e.disconnectGoogleClassroom()},className:[],disabled:!1};e.disconnectConfirmationModal=function(){M.activate({heading:m("googleClassroom.disconnectModal.header"),description:m("googleClassroom.disconnectModal.message"),buttons:[st,at],closeButton:!0,overlayActive:!0,cssClass:"disconnect-confirmation-modal",closeAction:function(){M.deactivate()}})}}]),angular.module("RealizeApp").controller("EditProgramCtrl",["$scope","$log","$location","Content","ProgramContent","MyContent","Modal","AlertService","lwcI18nFilter","$q","TEMPLATE_PATH","UnsavedChangesModal",function(e,t,n,r,s,a,i,o,l,c,u,d){"use strict";var m=function(e,t){var r=n.path(),s=r.split("/program")[0]+"/program/"+e+"/"+t;n.path(s)},g=function(e){delete e.version,delete e.externalReference,delete e.externalId,delete e.externalSource},p=function(){var t=c.defer();return e.isCustomized?a.getOriginalIdFromCustomized(s.id).then(function(n){e.programForSubmit.originalItemId=n.originalItemId,t.resolve()},function(){t.reject()}):(s.customizedItem?e.programForSubmit.id=s.customizedItem.id:delete e.programForSubmit.id,e.programForSubmit.originalItemId=s.id,g(e.programForSubmit),t.resolve()),t.promise},f=function(e){return{id:e.id,associativeProps:e.associativeProps}},h=function(t){var n=[];return $.each(t,function(t,r){e.hiddenItem[r.id]?r.associativeProps.externalSource="Teacher, HideFromStudent":angular.isDefined(e.hiddenItem[r.id])&&!e.hiddenItem[r.id]&&r.associativeProps.externalSource&&"Teacher, HideFromStudent"===r.associativeProps.externalSource&&(delete r.associativeProps.externalSource,e.undoIsOn[r.id]=!1);var s=f(r);n.push(s)}),n},v=function(){return{isDefaultView:!0,originalItemId:e.programForSubmit.originalItemId,json:JSON.stringify(e.programForSubmit)}},S=function(e){delete e.attachments},T=function(e){var t=["associatedTeacherSupport","associatedTools","associatedRemediation","customizedItem"];$.each(t,function(t,n){e[n]&&(e[n]=f(e[n]))})},A=function(){var t=p();s.contentItems&&s.contentItems.length>0&&(e.programForSubmit.contentItems=h(e.contentItemsListForEdit)),T(e.programForSubmit),S(e.programForSubmit),e.programForSubmit.defaultView=!0;var n=c.defer();return t.then(function(){n.resolve(v())},function(){n.reject()}),n.promise},I=function(){var e=["<strong>",l("editProgram.successNotification.programUpdated.title"),"</strong>",l("editProgram.successNotification.programUpdated.message")].join(" ");o.addAlert("success","ok-sign",e,2)};e.programForSubmit=angular.copy(s),e.contentItemsListForEdit=angular.copy(s.contentItems),e.isCustomized=s.inMyLibrary;var E=!1,y=!1;e.hasHidden=function(t){return angular.isDefined(e.undoIsOn[t.id])?e.undoIsOn[t.id]:t.associativeProps&&"Teacher, HideFromStudent"===t.associativeProps.externalSource},e.navigationFallback=function(){m(s.id,s.version)},e.cancel=function(){E=!0,m(s.id,s.version)},e.removeCustomized=function(t){E=!0,t.preventDefault(),t.stopPropagation();var n=function(){i.hideDialog()},r=function(){var t=!1;e.isCustomized&&($.each(s.contentItems,function(e,t){t.associativeProps&&"Teacher, HideFromStudent"===t.associativeProps.externalSource&&delete t.associativeProps.externalSource}),a.makeDefaultView(s.id,t).then(function(e){i.hideDialog(),m(e.originalItemId,0)}))},o=function(){r()},c=e.$new();c.dialogId="removeCustomizedWarningModal",c.title=l("editProgram.removeCustomizedTOC.title"),c.body=l("editProgram.removeCustomizedTOC.message"),c.isDismissible=!1,c.buttons=[{title:l("editProgram.action.cancel"),clickHandler:n},{title:l("editProgram.action.ok"),clickHandler:o,isDefault:!0}],c.closeBtnClickHandler=function(){i.hideDialog()},c.dismissed=!1,i.showDialog("templates/partials/simpleDialog.html",c)},e.save=function(){E=!0;var t=i.progressDialog(e.$new(),{progressHeader:l("editProgram.updateProgress.title"),progressMessage:l("editProgram.updateProgress.message")}).then(function(){t.fakeProgress()}),n=A(),r=function(e){return a.addContentItemToMyLibrary(e,e.originalItemId)},o=function(e){var n=c.defer(),r=angular.isArray(e.item)?e.item[0]:e.item;return t.then(function(){t.progressComplete().then(function(){i.hideDialog(),n.resolve(r)})}),n.promise},u=function(e){I(),delete s.id,y||m(e.id,e.version)},d=function(){t.close(),e.serverError=!0};return n.then(r,d).then(o,d).then(u)},e.hiddenItem={},e.undoIsOn={},e.unhiddenItem={},e.hideItem=function(t){e.hiddenItem[t]=!0,e.undoIsOn[t]=!0},e.unhideItem=function(t){e.hiddenItem[t]=!1,e.undoIsOn[t]=!1},e.toggleHideUnHide=function(t){var n=e.contentItemsListForEdit[t],r=n.id;e.hiddenItem[r]=e.undoIsOn[r]=e.hiddenItem[r]&&e.undoIsOn[r]?!1:!0},e.dragDropOpts={keyCode:72,keyAction:e.toggleHideUnHide,placeholder:"item sortable sortable-placeholder",thumbnailModeFix:!0,opacity:.6},e.showKeyboardInstDialog=function(t){t.preventDefault(),t.stopPropagation();var n=function(){i.hideDialog()},r=e.$new();r.dialogId="programReorderKeyboardInstDialog",r.title=l("global.accessibility.reorder.title"),r.body=l("global.accessibility.reorder.message.toc"),r.isDismissible=!1,r.closeBtnClickHandler=function(){n()},r.buttons=[{title:l("editProgram.action.ok"),clickHandler:n,isDefault:!0}],r.dismissed=!1,i.showDialog("templates/partials/simpleDialog.html",r)};var R=new d(function(){return y=!0,e.save()});e.$on("$locationChangeStart",function(t){var n=angular.copy(e.contentItemsListForEdit);
h(n),angular.equals(s.contentItems,n)||E||R.showDialog(t)})}]),angular.module("RealizeApp").controller("ProgramCtrl",["$scope","$location","$log","Content","RootTierContent","MyContent","BrowserInfo","MediaQuery","OptionalFeatures",function(e,t,n,r,s,a,i,o,l){"use strict";e.isIOS5=i.OS.isIOS5,e.currentUser.setAttribute("programs.visited",!0),e.content=e.program=s,e.isCentersContent=t.path().indexOf("/center/")>=0,e.openEditView=function(){var e=t.path()+"/edit";t.path(e).search("forceOriginalView",null)},e.openOriginalView=function(){var n=e.content;a.getOriginalIdFromCustomized(n.id).then(function(e){var n=t.path(),r=n.split("/program")[0]+"/program/"+e.originalItemId+"/0";t.path(r).search("forceOriginalView","true")})},e.openCustomizedView=function(){var n=e.content.customizedItem,r=t.path(),s=r.split("/program")[0]+"/program/"+n.id+"/"+n.version;t.path(s).search("forceOriginalView",null)},e.isCustomized="My Uploads"===e.content.contribSource,e.isOriginal=!e.isCustomized,e.showOriginal=!e.content.customizedItemDefaultView,e.isMixedMode=function(t){return"list"===t&&e.sidebarOpen&&!o.breakpoint.isDesktop},e.back=function(t){t.preventDefault(),t.stopPropagation(),e.content.root?e.isOriginal&&!e.showOriginal?e.goBack("/program/"+e.content.customizedItem.id+"/"+e.content.customizedItem.version,!0):e.goBack("/program",!0):e.goBack("/program",!0)},e.hasBuildETextFeature=l.isAvailable("buildEText.feature.enabled")}]),angular.module("RealizeApp").controller("ProgramListController",["$scope","$rootScope","$location","$route","$log","ProgramsListInfo","Analytics","PATH","browseAllEventTracking","browseAllService",function(e,t,n,r,s,a,i,o,l,c){"use strict";e.currentUser.setAttribute("programs.visited",!0),e.programs=a.programs,e.totalMatches=a.totalMatches,e.favoriteAttr="programs.favorites",e.location=n,e.sortByAttr="programs.defaultSort",e.$route=r,e.open=function(e,t){e.preventDefault(),e.stopPropagation();var r=t.$getDefaultVersion();"NBC Learn"===r.externalSource?n.path("/nbclearn/browse"):n.path("/program/"+r.id+"/"+r.version)},e.openBrowseAllPrograms=function(){c.setCurrentPageIndex(1),c.setSelectedFacets({}),c.setSelectedPrograms([]),c.setSearchKeyword(""),l.onBrowseAllContent(),n.path("/browseAll")},e.isTeacher=function(){return e.currentUser.isTeacher},e.titleSort=function(e){return e.title},e.shouldShowBrowseAll=function(){return e.programs.length>0},t.currentUser.isReviewer?(e.reviewTemplate="templates/partials/reviewer_zero_programs.html",e.imagePath=o.IMAGES,e.showReviewZero=!e.currentUser.getAttribute("reviewer.programs.visited"),e.currentUser.setAttribute("reviewer.programs.visited",!0)):e.showReviewZero=!1}]),angular.module("RealizeApp").controller("ReviewerProgramListCtrl",["$scope","$rootScope","$location","$route","$log","ProgramsListInfo","PATH","$anchorScroll","lwcI18nFilter",function(e,t,n,r,s,a,i,o,l){"use strict";e.currentUser.setAttribute("programs.visited",!0),e.programs=a.programs,e.totalMatches=a.totalMatches,e.favoriteAttr="programs.favorites",e.location=n,e.sortByAttr="programs.defaultSort",e.$route=r,e.firstVisit={showAlert:!e.currentUser.getAttribute("review.info.seen"),title:l("review.firstVisitInfo.title"),description:l("review.firstVisitInfo.description"),closeFn:function(){e.currentUser.setAttribute("review.info.seen",!0),e.firstVisit.showAlert=!1}},e.open=function(e,t){e.preventDefault(),e.stopPropagation();var r=t.$getDefaultVersion();n.path("/review/program/"+r.id+"/"+r.version+"/standards")},e.titleSort=function(e){return e.title}}]),angular.module("Realize.comments",["Realize.comment.Token","Realize.comment.commentsWidget","Realize.comment.writeCommentForm","Realize.comment.listComment","Realize.comment.commentsApiService","Realize.comment.commentsUtilService","Realize.common.tokenInterceptor","Realize.Comment.DisplayTime","Realize.common.tokenRecovery"]).config(["SessionTimeoutServiceProvider","CommonTokenInterceptorProvider","CommonTokenRecoveryProvider",function(e,t,n){"use strict";t.registerTokenProvider("CommentsTokenSvc"),n.registerTokenProvider("CommentsTokenSvc")}]),angular.module("Realize.comment.commentsApiService",["Realize.paths","rlzComponents.components.i18n","Realize.Discussions"]).constant("COMMENT_ENTITIES",{CLASS:"class",STUDENT:"student"}).service("commentsApiService",["$rootScope","$q","$http","$window","$log","PATH","DiscussModelCustomizations",function(e,t,n,r,s,a,i){"use strict";function o(e){var r=angular.extend({},g);return r.params={externalIds:e.join(",")},n.get(m,r).then(function(e){return e.data.data.boardsSummary},function(e){return t.reject(e)})}var l=this,c=r.discussionApiUrl+"/discussions/boards",u=":boardId",d=[c,u,"boardAccessInfos"].join("/"),m=[c,"summary"].join("/"),g={headers:{"Content-Type":"application/json"},service:"comments"};l.createNewBoard=function(e){return n.post(a.REST+"/comments/boards",{userAssignmentId:e}).then(function(e){return e.data},function(n){return 409===n.status?l.getBoardId(e):t.reject(n)})},Object.defineProperty(l,"NON_EXISTANT_BOARD_ERROR",{get:function(){return-1}}),l.getBoardId=function(e){var r=angular.extend({},g),s=[];s.push("comment","userassign:"+e),r.params={externalIds:s.join(",")};var a=n.get(c,r).then(function(e){return 0===e.data.data.boards.length?t.reject(l.NON_EXISTANT_BOARD_ERROR):e.data.data.boards[0].id.replace(/['"']+/g,"")});return a},l.createPost=function(e,r){var s={title:"",body:e},a=c+"/"+r+"/posts";return n.post(a,JSON.stringify(s),g).then(function(e){return i.transformPostsIn(e.data.data)}).catch(function(e){return t.reject(e)})},l.getPosts=function(e){var r=[c,e,"posts"].join("/"),a=d.replace(u,e),o=[],l=t.defer();return o.push(n.get(r,g)),o.push(n.post(a,JSON.stringify({}),g)),t.all(o).then(function(e){var t=e[0],n=e[1],r=t.data.data.posts,a=n.data.data;return i.transformPostsIn(r).then(function(e){l.resolve({posts:e,boardAccessInfo:a})},function(e){s.error("Could not transforms the posts list due to: ",e),l.reject(e)})}).catch(function(e){l.reject(e)}),l.promise},l.getBoardsSummaryByAssignmentId=function(e,t){var n=[];return n.push("comment","assign:"+e),t&&n.push("userassign:"+t),o(n)},l.getBoardsSummaryByClassId=function(e,t){var n=[];return n.push("comment","class:"+e),t&&n.push("userassign:"+t),o(n)},l.updatePost=function(e,t,r){var a=JSON.stringify({title:"",body:r}),o=[c,e,"posts",t].join("/");return n.post(o,a,g).then(function(e){return i.transformPostsIn(e.data.data)},function(e){s.error(e)})},l.deletePost=function(e,t){var r=JSON.stringify({archived:!0}),s=[c,e,"posts",t].join("/");return n.post(s,r,g)},l.unDeletePost=function(e,t){var r=JSON.stringify({archived:!1}),s=[c,e,"posts",t].join("/");return n.post(s,r,g)},l.getBoardAccessInfo=function(e){var r=d.replace(u,e);return n.get(r,g).then(function(e){return e.data.data},function(e){return 404===e.status?{}:t.reject(e)})}}]),angular.module("Realize.comment.commentsUtilService",["Realize.analytics"]).service("commentsUtilService",["$log","lwcI18nFilter","Analytics","commentsApiService",function(e,t,n,r){"use strict";function s(e){return e.reduce(function(e,t){var n=t.externalIds.filter(function(e){return-1!==e.indexOf("userassign")})[0].split(":").reverse()[0];return e[n]={boardId:t.id,lastAccessDate:t.lastAccessDate?t.lastAccessDate:"",lastModifiedDate:t.lastModifiedDate?t.lastModifiedDate:"",postsCount:t.postsCount},e},{})}var a=this;a.getStudentAssignmentIdsWithPostsByAssignmentId=function(e,t){return r.getBoardsSummaryByAssignmentId(e,t).then(function(e){return s(e)})},a.getStudentAssignmentIdsWithPostsByClassId=function(e,t){return r.getBoardsSummaryByClassId(e,t).then(function(e){return s(e)})},a.getLastAccessDateForStudentAssignmentId=function(e,t){return e in t?t[e].lastAccessDate:void 0},a.getBoardIdForStudentAssignmentId=function(e,t){return e in t?t[e].boardId:void 0},a.getCommentLinkText=function(e,n){var r="";if(e.userAssignmentId in n){var s=n[e.userAssignmentId];e.hasCommentRowExpanded?r=t("comment.action.closeComment"):s.postsCount>0&&(r=t("comment.action.viewComments"))}return""===r&&(r=e.hasCommentRowExpanded?t("comment.action.closeComment"):t("comment.action.makeComment")),r},a.getCommentBadgeText=function(e,n){var r="";if(e.userAssignmentId in n){var s=n[e.userAssignmentId];s.postsCount>0&&(r=e.hasCommentRowExpanded||s.lastAccessDate>s.lastModifiedDate?s.postsCount:t("comment.action.newMessageNotification"))}return r},a.analyticsForCommentPost=function(e){n.track("track.action",{category:"Classes",action:"Assignments",label:e})},a.createNewBoard=function(e,t){return{boardId:e,lastAccessDate:t,lastModifiedDate:t,postsCount:0}}}]),angular.module("Realize.assignment.common.landingCtrl",["Realize.analytics","Realize.user.currentUser","Realize.recommendation.facadeService","rlzComponents.components.i18n","Realize.common.alerts","Realize.common.optionalFeaturesService","Realize.paths","Realize.constants.fileUploadErrorResponse","Realize.constants.mediaType","Realize.assignment.constants","rlzComponents.routedComponents.assignments.constants","rlzComponents.components.assignmentViewer","components.alert","rlzComponents.components.assignment.services","rlzComponents.components.services.oneDrive","rlzComponents.components.uploadContent.constants","rlzComponents.components.assignmentViewer.modal","rlzComponents.turnInAllTelemetryModule"]).controller("AssignmentLandingCtrl",["$rootScope","$scope","$route","$routeParams","$location","$log","$currentUser","resolveAssignmentData","PATH","Modal","AssignmentFacadeService","FormService","lwcI18nFilter","RecommendationFacadeService","FILE_UPLOAD_ERROR_RESPONSE","MEDIA_TYPE","$filter","OptionalFeatures","ASSIGNMENT_CONSTANTS","AssignmentUtil","ATTACH_FILE_CONSTANTS","assignmentCompletedAlertHelperService","turnInStateService","Toast","Analytics","LWC_ANALYTICS_CONSTANTS","assignmentScoreHelperService","assignmentHelperService","analyticsHelpersService","oneDriveService","UPLOAD_CONTENT_CONSTANTS","breadcrumbTelemetryService","BREADCRUMB_TELEMETRY_CONSTANTS","assignmentTelemetryService","ASSIGNMENT_TELEMETRY_CONSTANTS","assignmentViewerModal","turnInAllTelemetryService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R,C,D,b,P,w,L,O,N,M,k,z,U){"use strict";var F,x=o.discussionPostsSummaries,B=!1,V={},H="discussionPastDue",G="nextItem",j=!0,q=function(e){return V[e.id]&&V[e.id]>0},Y=function(){F=c.progressDialog(t.$new(!0),{progressHeader:m("myContent.uploadProgress.title"),progressMessage:m("myContent.uploadProgress.message")}).then(function(){F.fakeProgress(500)})},W=function(){F&&F.then(function(){return F.progressComplete()}).then(function(){c.hideDialog(),F.$destroy()})},K=function(e,n,r){"not_started"===t.assignmentStatus&&u.setInProgress(t.assignment.$getPrimaryMetadata().userAssignmentId).then(function(e){a.log("Marking assignment to in progress",e)},function(e){a.error("Failed to update assignment status",e)}),t.showAlert.attachmentEdited=e,t.showAlert.attachmentUploaded=!e;var s=t.assignment.$getPrimaryMetadata();s.attachmentUrl=n,s.attachmentTitle=r,t.userAttachmentObj=t.assignment.$getUserAttachment(),t.removedAttachment=void 0},Q=function(e,n){var r=t.assignment.$getPrimaryMetadata().userAssignmentId,s=t.assignment.assignmentId;Y(),u.attachLink(s,r,e,n).then(function(e){K(t.assignment.$hasAttachment(),e,n),W()})},X=function(){i.isPreviewingAssignment&&(i.isPreviewingAssignment=!1,i.previewItemsStatusList=null)},Z={},J=m("assignmentStatus.action.showActivities"),et=m("assignmentStatus.action.hideActivities"),tt={IN_PROGRESS:m("assignmentViewer.status.inProgress"),NOT_STARTED:m("assignmentViewer.status.notStarted"),KEEP_GOING:m("assignmentViewer.turnInModal.actions.keepGoing"),GET_STARTED:m("assignmentViewer.turnInModal.actions.getStarted")},nt={number:.8,title:5.3,status:2.8,action:3.1},rt="multiAsset__assignmentViewerModal assignmentLanding__page",st=500,at={msg:["<strong>",m("assignmentViewer.turnInModal.alertMessages.success.message1"),"</strong> ",m("assignmentViewer.turnInModal.alertMessages.success.message2")].join("")},it={showCloseIcon:!0,autoClose:!1,msg:["<strong>",m("assignmentViewer.turnInModal.alertMessages.error.message1"),"</strong> ",m("assignmentViewer.turnInModal.alertMessages.error.message2")].join("")},ot={msg:["<strong>",m("assignmentPreview.successNotification.attachmentUpdated.title"),"</strong> ",m("assignmentPreview.addAttachment.attachmentRemoved")].join(""),autoClose:!1,showCloseIcon:!0,action:{actionId:"attachFileDeleteUndo",actionIconClass:"icon-undo",actionClass:"attachFile__undoDelete",actionLabel:m("assignmentPreview.attachment.action.undo"),onCustomAction:function(){t.reattachAttachment()}}},lt={showCloseIcon:!0,autoClose:!1,msg:m("myContent.contentUploadForm.oneDrive.oneDriveErrorMessage")},ct={showCloseIcon:!0,autoClose:!1,msg:m("myContent.contentUploadForm.oneDrive.genericError")},ut=function(e){for(var t=0;t<e.participants.length;t++)if(e.participants[t].author===i.userId)return e.participants[t].posts;return 0},dt=function(e){e&&(e.stopPropagation(),e.preventDefault()),u.removeAttachment(t.assignment).then(function(e){y.success(ot),t.removedAttachment=e,t.userAttachmentObj=void 0},function(e){a.error("Failed to remove attachment",e)})},mt=function(e){return!(e.mediaType===f.STUDENT_VOICE||e.mediaType===f.LEARNING_MODEL)},gt=function(e){var t={},n=1;return e.forEach(function(e){mt(e)&&(t[e.id]=n,n+=1)}),t},pt=function(e){var t=[];if(e.$isSingleItemAssignment()||e.isAdaptiveAssignment())t=[e.contentItem];else{var n=[];_.each(e.contentItem.contentItems,function(e){n.push(e),e.mediaType===f.LEARNING_MODEL&&e.contentItems&&e.contentItems.length&&(n=n.concat(e.contentItems))}),t=n}return i.isTeacher&&i.isPreviewingAssignment&&(t=_.filter(t,function(e){return"Yes"!==e.teacherOnly})),angular.forEach(t,function(e){Rt(e),ht(e),ft(e)}),t},ft=function(e){e.isRRSWithActivities=i.isStudent&&(T.isNotebookEnabled(t.assignment,e)||T.showRRSActivities(t.assignment,e))},ht=function(e){t.allCompleteInProgress&&e.$isScoOrTest()&&e.completionStatus!==S.STATUS.COMPLETED&&(t.allCompleteInProgress=!1)},vt=function(){return!(t.assignment.isSingleDiscussion()||t.showAlert.success||i.isTeacher||!t.assignment.$isPastDue()||t.assignment.$isCompleted()||u.isPastDueWarningDismissed(t.assignment.assignmentId)||t.assignment.$isRemediationAssignment())},St=function(){t.showAlert.pastDueDate=t.showAlert.success||t.showAlert.attachmentUploaded||t.showAlert.attachmentEdited?!1:vt()},Tt=function(e){e.length&&Q(e[0].url,e[0].name)},At=function(e){e.message===L.ONE_DRIVE_ERROR_CODE&&y.error(lt);var t=e.value[0].permissions[0].link.webUrl,n=e.value[0].name;Q(t,n)},It=function(){a.error("OneDrive launch failed"),y.error(ct)},Et=function(){a.info("OneDrive launch cancelled")};t.onAttachFromOneDrive=function(){w.launchOneDriveFilePicker(At,Et,It)};var yt=function(e){var t=[e.id,e.version].join(" "),n=i.previewItemsStatusList[t];n?(e.completionStatus=S.STATUS.COMPLETED,e.selectedLanguage=n):e.completionStatus=S.STATUS.NOT_STARTED},Rt=function(e){var n=e.isExternalResource()?e.originalEquellaItemId:e.id,r=t.assignment.$findItemMetadata(n);if(r){i.isPreviewingAssignment&&(r.status=S.STATUS.NOT_STARTED),e.studentMetadata=r;var s=r.status===S.STATUS.IN_PROGRESS||r.status===S.STATUS.COMPLETED;(!t.showLanguageOptions(r)||s)&&(e.selectedLanguage=_.findWhere(r.userAssignmentLanguageList,{isSelected:!0}).languageLocale,e._selectedLanguage=e.selectedLanguage)}else e.mediaType!==f.LEARNING_MODEL&&(a.error("Did not find studentMetadata for",e),e.missingMetadata=!0,t.allCompleteInProgress=!1);i.isPreviewingAssignment?yt(e):r&&r.status===S.STATUS.SUBMITTED?e.completionStatus=S.STATUS.COMPLETED:r&&(e.completionStatus=r.status),$t||e.mediaType===f.LEARNING_MODEL||e.mediaType===f.STUDENT_VOICE||e.completionStatus!==S.STATUS.NOT_STARTED||(e.completionStatus=G,t.allCompleteInProgress=!1,$t=!0)},Ct=function(){var e=t.assignment,n=e.getTaskList().length,r=e.getCompletedTasksCount();return[r,"of",n,"Complete"].join(" ")},Dt=function(e){try{R.track("assignment.action",{status:S.STATUS.COMPLETED,assignment:t.assignment,action:C.ACTION.TURN_IN,category:e,label:Ct()})}catch(n){a.error("Error in sending GA after turnin",e,t.assignment,n)}},bt=function(){B=!0,E.setTurnedInAssignmentId(t.assignment.assignmentId),E.setTurnInMsg(!0),n.reload()},Pt=function(e){var n=t.assignment.$getChildAdaptiveUserAssignment();n&&!n.markCompleted?g.submitAssignment(n.classUuid,n.assignmentId,n.userAssignmentId).then(function(t){a.log("Submitting child adaptive assignment for complete",t),bt(e)},function(e){a.error("Failed to mark adaptive assignment as complete",e)}):bt(e)},wt=function(e){var n=t.assignment.$getPrimaryMetadata();u.setCompleted(n.userAssignmentId,!1,n.itemType).then(function(){Pt(e),M.trackOnAssignmentTurnIn(t.assignment,t.currentRoster,k.PAGE.ASSIGNMENT_LANDING),Dt(C.CATEGORY.ASSIGNMENT)}).catch(function(e){a.error("Failed to mark assignment as complete",e),t.isInProgress=!1,y.error(it)})};t.assignment=T.getAssignmentWithProgramHierarchy(o),t.hasEssayScore=t.assignment.hasEssayScoring,t.maxScore=t.assignment.maxScore,t.lastBoardAccessDate=o.lastBoardAccessDate,t.externalId=o.externalId,t.studentUuid=t.assignment.getPrimaryMetadata().studentUuid;var Lt=t.assignment.contentItem.fileType;x&&(j=!0,x.forEach(function(e){var t=ut(e);e.meta.item&&(V[e.meta.item]=t,0===t&&(j=!1))})),i.isTeacher&&(angular.isArray(i.previewItemsStatusList)||(i.previewItemsStatusList=[]),i.isPreviewingAssignment=!0),t.allCompleteInProgress=!0;var $t=!1;t.showLanguageOptions=function(e){return t.assignment.allowMultipleLanguage&&e.userAssignmentLanguageList.length>1},t.assets=pt(t.assignment);var Ot=gt(t.assets);t.assignmentStatus=t.assignment.$getAssignmentStatus(),t.showAlert={},t.showAlert.success=!(t.assignment.isSubmittedOrCompleted()||t.assignment.contentItem.$isScoOrTest()||t.assignment.isAdaptiveAssignment()||!t.allCompleteInProgress||t.assignment.isSingleDiscussion()||i.isPreviewingAssignment),t.showAlert.pastDueDate=vt(),t.showAlert.discussionPastDueDate=t.assignment.isSingleDiscussionPastDueDate()&&!u.isPastDueWarningDismissed(t.assignment.assignmentId)&&!j,t.$watch("showAlert.attachmentUploaded",St),t.$watch("showAlert.attachmentEdited",St),t.showAlertDiscussion=function(e){var n=moment(),r=n.isAfter(t.assignment.$getLegibleDateObj().dueDate);return e.mediaType===f.DISCUSSION_PROMPT&&r&&!q(e)},t.dismissPastDueAlert=function(){u.dismissPastDueWarning(t.assignment.assignmentId)},t.showInstructions=!_.isNull(t.assignment.instructions)&&(t.assignment.instructions.length>0||t.assignment.contentItem.instruction.length>0)||t.assignment.isAdaptiveAssignment()||t.assignment.isSingleDiscussion(),t.disableDoneButton=function(){return!i.isPreviewingAssignment&&(t.assignment.isSubmittedOrCompleted()||t.isInProgress||B)},t.assignment.contentItem&&(t.showDoneButton=!(t.assignment.contentItem.$isScoOrTest()||t.assignment.isAdaptiveAssignment()||t.assignment.isSingleDiscussion()),t.showScoreHeaderRow=t.assignment.$isSingleItemAssignment()||t.assignment.isAdaptiveAssignment()||"Sequence"===Lt&&t.assignment.contentItem.contentItems&&(t.assignment.contentItem.contentItems.length>0?"Sequence"!==t.assignment.contentItem.contentItems[0].fileType:!0)),t.getTurnInLabel=function(){var e=t.assignment.isSubmittedOrCompleted()?m("assignmentPreview.action.turnedIn"):m("assignmentPreview.action.imDone");return t.assets.length>1&&(e=t.assignment.isSubmittedOrCompleted()?m("assignmentPreview.action.turnedIn"):m("assignmentPreview.action.imDoneWithAll")),e},t.lockLanguage=function(e){return(e.completionStatus===S.STATUS.IN_PROGRESS||e.completionStatus===S.STATUS.COMPLETED||t.showScore(e))&&t.showLanguageOptions(e.studentMetadata)},t.switchLanguage=function(e,n,r){e&&e.stopPropagation(),t.showAlert.languageSelection=!1;var s=n.studentMetadata;if(!t.lockLanguage(n)&&!r.isSelected){var o=function(){angular.forEach(n.studentMetadata.userAssignmentLanguageList,function(e){e.isSelected=e.itemUuid===r.itemUuid}),n._selectedLanguage=r.selectedLanguage};i.isPreviewingAssignment?o():u.updateLanguagePreference(s.userAssignmentId,r.itemUuid).then(function(){o()},function(e){a.error("Failed to update language preference",e),n.selectedLanguage=n._selectedLanguage})}},t.showScore=function(e){var t=u.isManualScoreType(e.studentMetadata),n=t&&u.isScoreSent(e.studentMetadata),r=!t&&u.hasScore(e.studentMetadata);return!i.isPreviewingAssignment&&(n||r)},t.needScore=function(e){return!i.isPreviewingAssignment&&u.isManualScoreType(e.studentMetadata)&&!u.isScoreSent(e.studentMetadata)},t.showDash=function(e){var t=u.isManualScoreType(e.studentMetadata),n=!t&&!u.hasScore(e.studentMetadata);return i.isPreviewingAssignment||n},t.getScore=function(e){if(t.hasEssayScore){var n=u.getEssayScore(e.studentMetadata,t.maxScore);return[h("number")(n,0),t.maxScore].join("/")}return e.$isScoOrTest()&&!u.hasScore(e.studentMetadata)&&t.assignment.$getAssignmentStatus()===S.STATUS.COMPLETED?0:u.getScore(e.studentMetadata)};var _t=function(e){try{R.track("assignment.action",{status:t.assignment.getAssignmentStatus(),assignment:t.assignment,action:C.ACTION.OPEN,category:C.CATEGORY.ASSIGNMENT,label:P.getAssetType(e)})}catch(n){a.error("Error in sending GA after clicking the content",C.ACTION.OPEN,t.assignment,n)}};if(t.open=function(e,n){if(e&&(e.stopPropagation(),e.preventDefault()),_t(n),n.mediaType!==f.LEARNING_MODEL&&n.mediaType!==f.STUDENT_VOICE){if(!n.selectedLanguage)return t.showAlert.languageSelection=!0,void 0;if(n.missingMetadata)s.path("error/item-not-found");else{var o=_.findWhere(n.studentMetadata.userAssignmentLanguageList,{languageLocale:n.selectedLanguage}),l=function(e){var n,l,c,d=s.path();if(e.mediaType!==f.ADAPTIVE_HOMEWORK||t.assignment.$isLesson()||(i.isPreviewingAssignment?d=[d,"adaptivehomework"].join("/"):(c=d.split("/assignments/")[0],d=[c,"assignments",e.studentMetadata.assignmentId].join("/"))),e.$isNbcItem())l=e.studentMetadata.assignmentId,n=e.studentMetadata.classUuid,d=["/nbclearn/classes",n,"assignments",l,"video",e.id,e.version].join("/");else if(e.isDiscussionPrompt()){if(l=e.studentMetadata.assignmentId,n=e.studentMetadata.classUuid,"not_started"===t.assignmentStatus){var m=t.assignment.isAdaptiveAssignment();u.setInProgress(t.assignment.$getPrimaryMetadata().userAssignmentId,m,n,l).then(function(e){a.log("Marking assignment to in progress",e)},function(e){a.error("Failed to update assignment status",e)})}d=["/classes",n,"discussPrompt","assignments",l,"content",e.id].join("/"),s.path(d).search({studentId:r.studentNavigationBackId||r.studentId,activeTab:r.activeTab,status:r.status,userAssignmentId:e.studentMetadata.userAssignmentId,itemVersion:e.version,discuss:e.studentMetadata.markCompleted?null:"active"})}else{if(d=[d,"content",o.itemUuid,o.itemVersion].join("/"),!i.isPreviewingAssignment){if(e.$isScoOrTest()){if(("SCO"===e.fileType||"TinCanSCO"===e.fileType)&&e.attachments&&0===e.attachments.length&&!e.url)return;"completed"===t.assignmentStatus&&(i.attemptCompleted=!0)}var g=e.studentMetadata.userAssignmentId;d=[d,"assignmentUserId",g].join("/")}t.hasEssayScore&&"completed"===t.assignmentStatus&&(d=[d,"isReviewMode"].join("/"))}s.path(d)};i.isPreviewingAssignment&&u.previewItem(n),l(n)}}},E.checkIsFromTurnIn(t.assignment.assignmentId)){var Nt=I.getAndClearAssignmentCompleted();Nt&&Nt.success&&Dt(C.CATEGORY.ASSIGNMENT_VIEWER),y.success(at),E.setTurnedInAssignmentId(null),E.setTurnInMsg(!1),e.justCompletedAssignment=null}t.back=function(e){e.stopPropagation(),e.preventDefault(),X();var n,r=s.path(),a=s.search();n=r.match("/allstudents/preview")||r.match(/\/student|calendar\/.*\/preview/)?r.split("/preview")[0]:a&&a.studentNavigationBackId?["classes",t.currentRoster.classId,"student",a.studentNavigationBackId,"assignments"].join("/"):r.split("/assignments/")[0]+"/assignments/",t.goBack(n,!0)};var Mt=function(e){var t=_.filter(e,function(e){return e.mediaType!==f.LEARNING_MODEL&&e.mediaType!==f.STUDENT_VOICE});return t},kt=function(){var e=document.getElementById("studentHeaderTurnIn");e&&e.focus()},zt=function(e){var n=Mt(t.assets).length;return"CANCEL"===e&&U.sendTelemetryEvent(Kt(),n,!1,e),kt(),z.deactivate()},Ut=function(e){t.isInProgress=!0,zt();var n=Mt(t.assets).length;U.sendTelemetryEvent(Kt(),n,!1,"TURN_IN_MODAL"),i.isPreviewingAssignment?bt(e):wt(e)},Ft=function(){return i.isTeacher?r.studentId:i.userId},xt=function(){return{heading:"",subHeading:m("assignmentViewer.turnInModal.heading.message2"),assignmentCompleted:!1}},Bt=function(e,n){var r,s=t.assignment.getItemStatus(e.id,Ft());return r=n?s===S.STATUS.IN_PROGRESS?tt.KEEP_GOING:tt.GET_STARTED:s===S.STATUS.IN_PROGRESS?tt.IN_PROGRESS:tt.NOT_STARTED},Vt=function(){return Wt()?"completeAssignmentTurnInModal":"incompleteAssignmentWarningModal"},Ht=function(){return Wt()?m("assignmentViewer.turnInModal.assignmentCompleted.message1"):m("adminTools.messages.deleteAction.modal.header")},Gt=function(){return Wt()?m("assignmentViewer.turnInModal.assignmentCompleted.message2"):m("assignmentViewer.turnInModal.description")},jt=function(){return Wt()?m("assignmentViewer.action.turnInAll"):m("assignmentPreview.action.done")},qt=function(e){var n=t.assignment.getItemStatus(e.id,Ft());return n===S.STATUS.COMPLETED},Yt=function(e){var n=t.assignment.getItemStatus(e.id,Ft());return n===S.STATUS.IN_PROGRESS},Wt=function(){var e=!0;return t.assets.forEach(function(t){qt(t)||t.mediaType===f.STUDENT_VOICE||(e=!1)}),e},Kt=function(){var e=0;return Mt(t.assets).forEach(function(t){qt(t)&&(e+=1)}),e},Qt=function(){return!1};t.imDone=function(e){e.preventDefault(),e.stopPropagation();var n=Mt(t.assets).length;if(t.assignmentStatus!==S.STATUS.COMPLETED)if(i.isPreviewingAssignment)bt(e);else if(1===t.assets.length||Wt()){var r=function(){c.hideDialog(),Wt()&&U.sendTelemetryEvent(Kt(),n,!1,"CANCEL"),setTimeout(function(){kt()},st)};t.confirm=function(e){Wt()&&U.sendTelemetryEvent(Kt(),n,!1,"TURN_IN_MODAL"),t.isInProgress=!0,c.hideDialog(),i.isPreviewingAssignment?bt(e):wt(e)},Wt()&&U.sendTelemetryEvent(Kt(),n,!1,"TURN_IN_ALL");var s=t.$new();s.dialogId=Vt(),s.title=Ht(),s.body=Gt(),s.isDismissible=!1,s.buttons=[{title:m("assignmentPreview.action.cancel"),clickHandler:r},{title:jt(),clickHandler:t.confirm,isDefault:!0}],s.dismissed=!1,s.closeBtnClickHandler=r,c.showDialog("templates/partials/simpleDialog.html",s)}else{var a={label:m("assignmentViewer.turnInModal.actions.cancel"),action:function(){zt("CANCEL")},className:"button--cancel",disabled:!1},o={label:t.getTurnInLabel(),ariaLabel:m("assignmentViewer.turnInModal.ariaLabel.modalTurnIn"),action:function(e){Ut(e)},className:"button--turnIn",disabled:!1},l=[a,o];z.activate({cssClass:rt,heading:m("assignmentViewer.turnInModal.heading.message1"),description:xt(),buttons:l,assetsList:Mt(t.assets),assetSize:nt,closeAction:function(){zt("CANCEL")},getAssetStatus:function(e,t){return Bt(e,t)},isAssetCompleted:function(e){return qt(e)},isAssetInProgress:function(e){return Yt(e)},isAssignmentCompleted:function(){return Wt()},onNavigateToAsset:function(e){Zt(e)},isAssetsLoading:function(){return Qt()}}),U.sendTelemetryEvent(Kt(),n,!1,"TURN_IN_ALL")}};var Xt=function(e,n){var r,s=t.assignment.$getPrimaryMetadata().userAssignmentId;e&&(e.preventDefault(),e.stopPropagation()),r=t.$new(),r.editing=n,r.uploadAttachmentURL=u.getUploadAttachmentUrl(s),r.assignmentTitle=t.assignment.title,r.uploadInProgress=!1,r.setFile=function(e){var t=function(e){var t=["TXT","GIF","RTF"],n=d.getExtension(e);return d.isValidFileType(n)&&-1===$.inArray(n,t)};d.setFileValidity(r,e,r.uploadFileForm.file,t),r.fileName=e.value,r.fileType=d.getExtension(e.value),r.mediaType=d.getMediaType(r.fileType),r.restrictedDownloadContent="Download Only"},r.ajaxData={assignmentId:t.assignment.assignmentId},r.close=function(){c.hideDialog()},r.$on("onAjaxSubmit",function(e,t){var s,a;return r.uploadFileForm.file.$setValidity("isVirusFree",!0),r.fileName?(r.uploadError=!1,r.uploadInProgress=!0,s=function(e){K(n,e),r.uploadInProgress=!1,c.hideDialog()},a=function(e){"filetype"===e.errorCode?r.uploadFileForm.file.$setValidity("filetype",!1):"filesize"===e.errorCode?r.uploadFileForm.file.$setValidity("size",!1):e.responseText.trim()===p.AV_SCAN_RESPONSE_TEXT?r.uploadFileForm.file.$setValidity("isVirusFree",!1):r.uploadError=!0,r.uploadInProgress=!1},t.then(s,a),void 0):(r.uploadFileForm.file.$setValidity("required",!1),void 0)}),c.showDialog(l.TEMPLATE_ROOT+"/assignment/common/uploadAssignmentAttachment.html",r)};t.reattachAttachment=function(e){e&&(e.stopPropagation(),e.preventDefault()),u.reattachAttachment(t.assignment,t.removedAttachment).then(function(){t.removedAttachment=void 0,t.userAttachmentObj=t.assignment.$getUserAttachment()},function(e){a.error("Failed to reattach attachment",e)})};var Zt=function(e){var n,r=Mt(t.assets),s=r[e];zt(),U.sendTelemetryEvent(Kt(),r.length,!1,Bt(s,!0)),t.open(n,s)};t.showCommentSection=function(){return v.isAvailable(S.OPTIONAL_FEATURES.COMMENTS)&&!i.isPreviewingAssignment&&(t.assignment.$isCompleted()||i.isStudent)},t.onAttachFileAction=function(e,n,r){n===A.ATTACH?Xt(e,!1):n===A.REMOVE_FILE_ACTION?dt():n===A.ATTACH_FROM_GOOGLE_DRIVE?Tt(r):n===A.ATTACH_FROM_ONE_DRIVE&&t.onAttachFromOneDrive()},t.toggleRRSActivities=function(e,t){t&&t.stopPropagation(),Z[e.id]=!Z[e.id]},t.getActivitiesLabel=function(e){return Z[e.id]?et:J},t.showRRSActivities=function(e){return e.isRRSWithActivities&&Z[e.id]},t.getAssetInfo=function(e){var n=e.completionStatus;!n&&t.showAlertDiscussion(e)&&(n=H);var r=n===G?S.STATUS.NOT_STARTED:n;return{assetNumber:Ot[e.id]||"",assetNumberStatus:D.getFormattedStatusText(n),displayStatus:D.getStatusText(r)}},t.getPostCommentMessageKey=function(){return t.assignmentStatus===S.STATUS.COMPLETED?"assignmentPreview.comments.newCommentAlert.completed":"assignmentPreview.comments.newCommentAlert.notCompleted"},t.showHideMinFileSizeError=function(e){return e&&!e.$error.required&&!e.$error.filetype&&!e.$error.size&&!e.$error.isVirusFree&&e.$error.minFileSize},t.disableAttachButton=function(e){return e&&(e.$pristine||e.$error.size||e.$error.required||e.$error.filetype||e.$error.isVirusFree||e.$error.minFileSize)},t.breadcrumbHandler=function(e,t,n){e.stopPropagation();var r=e.currentTarget.text,s=i.isStudent?N.SUBPAGE.INDIVIDUAL_ASSIGNMENT_DETAIL:N.SUBPAGE.PREVIEW,a={page:N.PAGE.ASSIGNMENT,subpage:s,area:N.AREA.CLASSES};O.sendTelemetryEvents(r,n,a),T.navigateToSourceProgram(t)},t.$on("$destroy",function(){y.close()})}]),angular.module("Realize.assignment.model.assignment",["Realize.assignment.utilService","Realize.assignment.constants","Realize.user.currentUser","rlzComponents.components.i18n","Realize.content.constants","Realize.content.model.contentItem","Realize.constants.mediaType"]).factory("Assignment",["$log","Content","$filter","ASSIGNMENT_CONSTANTS","$currentUser","$q","AssignmentUtil","CONTENT_CONSTANTS","MEDIA_TYPE",function(e,t,n,r,s,a,i,o,l){"use strict";var c,u=n("lwcI18n"),d=n("number"),m=function(e){return e&&e.userAssignmentDataList&&e.userAssignmentDataList.length>0},g=function(e){var t=_.groupBy(e,function(e){return e.studentUuid});return _.size(t)},p=r.DATE_FORMAT.MM_DD_YY_TIME;c=function(n){var s=this;if(angular.copy(n||{},s),s.contentItem?s.contentItem=new t(_.clone(s.contentItem)):(e.error("Missing contentItem!"),s.missingContentItem=!0,s.contentItem=new t),s.startDate&&(s.parsedStart=moment(s.startDate),s.startDateLegible=s.parsedStart.format(p)),s.dueDate&&(s.parsedEnd=moment(s.dueDate),s.dueDateLegible=s.parsedEnd.format(p)),s.remediationDueDate?(s.parsedRemediationEnd=moment(s.remediationDueDate),s.remediationDueDateLegible=s.parsedRemediationEnd.format(p)):s.allowRemediation&&!s.remediationDueDate&&(s.parsedRemediationEnd=c.getDefaultRemediationDate(s.dueDate)),angular.isDefined(s.averageScore)&&(s.roundedClassAverage=d(s.averageScore,0)),s.classUuids=[],s.groupUuids=[],s.studentUuids=[],angular.forEach(s.assignedTo,function(e){!e.classUuid||_.contains(s.classUuids,e.classUuid)||e.groupUuid||e.studentUuid?e.groupUuid&&!_.contains(s.groupUuids,e.groupUuid)?s.groupUuids.push(e.groupUuid):e.studentUuid&&!_.contains(s.studentUuids,e.studentUuid)&&s.studentUuids.push(e.studentUuid):s.classUuids.push(e.classUuid)
}),s.studentMetadata){var a=s.$isLesson(),i=s.isRRS(),o=function(e){var t=s.assignmentId!==e.assignmentId;return!a&&!i||a&&"Sequence"===e.itemType&&!t||i&&"Realize Reader Selection"===e.itemType&&!t};s.studentsCompleted=0,s.studentsInProgress=0,s.studentsNotStarted=0,angular.forEach(s.studentMetadata,function(e){e.userAssignmentStatus&&e.userAssignmentStatus.toLowerCase()===r.STATUS.SUBMITTED?(e.status=r.STATUS.SUBMITTED,o(e)&&s.studentsCompleted++):e.markCompleted?(e.status=r.STATUS.COMPLETED,o(e)&&s.studentsCompleted++):e.lastOpenDate||e.attachmentUrl?(e.status=r.STATUS.IN_PROGRESS,o(e)&&s.studentsInProgress++):(e.status=r.STATUS.NOT_STARTED,o(e)&&s.studentsNotStarted++)})}if(s.studentMetadata){s.studentsTotal=s.$isLesson()?_.where(s.studentMetadata,{itemType:"Sequence",assignmentId:s.assignmentId}).length:s.isRRS()?_.where(s.studentMetadata,{itemType:"Realize Reader Selection",assignmentId:s.assignmentId}).length:s.studentMetadata.length;var l=s.$getMetadataWithScore(),u=s.getMetadataWithFilteredRRSSCOScore();s.hasManualScore=s.$requireManualScoreCount()>0,s.hasNotSentScore=s.$notSentScoreCount()>0,s.hasNotScored=s.$notScoredCount()>0,s.allNotScored=s.$notScoredCount()>0&&s.$notScoredCount()===s.$requireManualScoreCount(),s.hasScoredMetadata=l.length>0,s.hasScoredMetadataWithFilteredRRSSCO=u.length>0,s.completedScorableTest=!s.hasNotScored&&!s.hasNotSentScore,s.hasNotSentManualScore=s.hasManualScore&&s.hasNotSentScore,s.hasNotScoredManualScore=s.hasManualScore&&s.hasNotScored,s.hasOnlyNotScored=s.hasNotScored&&!s.hasNotSentScore}},c.getDefaultRemediationDate=function(e){return moment(e).add(r.DEFAULT_REMEDIATION_DAYS,r.TIMES.DAYS)},c.getDefaultRemediationDateString=function(e){return c.getDefaultRemediationDate(e).format(r.DATE_FORMAT.MM_DD_YYYY)},c.prototype.$getTitle=function(){var e="";return this.type===r.ASSIGNMENT_TYPE.REMEDIATION?e=u("global.assignment.remediationPrefix")+" ":this.type===r.ASSIGNMENT_TYPE.ENRICHMENT&&(e=u("global.assignment.enrichmentPrefix")+" "),e+this.title},c.prototype.$save=function(){throw new Error("You should use AssignmentFacadeService.saveAssignment")},c.prototype.$getUploadAttachmentUrl=function(){throw new Error("You should use AssignmentFacadeService.getUploadAttachmentUrl")},c.prototype.$getAttachmentUrl=function(){var e=this.$getPrimaryMetadata();return angular.isDefined(e)?e.attachmentUrl:null},c.prototype.$getAttachmentTitle=function(){var e=this.$getPrimaryMetadata();return angular.isDefined(e)?e.attachmentTitle||"":null},c.prototype.$getUserAttachment=function(e){var t=e||this.$getAttachmentUrl(),n=this.$getAttachmentTitle();if(t){var r=t.split("/");return{filename:n||r[r.length-1],path:t,uuid:r[r.length-3],downloadLink:t.replace("equella/items","equella/force-download/items")}}return null},c.prototype.$hasAttachment=function(){var e=this.$getUserAttachment();return!(!e||!e.filename)},c.prototype.$removeAttachment=function(){throw new Error("You should use AssignmentFacadeService.removeAttachment")},c.prototype.$reattachAttachment=function(){throw new Error("You should use AssignmentFacadeService.reattachAttachment")},c.prototype.$getLegibleDateObj=function(){return{startDate:this.parsedStart.clone(),dueDate:this.parsedEnd.clone(),remediationDueDate:this.parsedRemediationEnd?this.parsedRemediationEnd.clone():0}},c.prototype.$findItemMetadata=function(e,t){var n=this;return _.find(n.studentMetadata,function(n){return t?n.studentUuid===t&&void 0!==_.find(n.userAssignmentLanguageList,function(t){return t.itemUuid===e}):void 0!==_.find(n.userAssignmentLanguageList,function(t){return t.itemUuid===e})})},c.prototype.$getItemStatus=function(e,t){var n=this,s=n.$findItemMetadata(e,t);return s&&"TXT"!==s.itemType&&s.status?s.status:r.STATUS.UNKNOWN},c.prototype.$isScoOrTest=function(){return this.contentItem&&("SCO"===this.contentItem.fileType||this.contentItem.fileType===o.FILE_TYPE.TIN_CAN_SCO||"TEST"===this.contentItem.fileType)},c.prototype.$isLesson=function(){return this.contentItem&&"Lesson"===this.contentItem.mediaType},c.prototype.isRRS=function(){return this.contentItem.isRRS()},c.prototype.isSingleDiscussion=function(){return this.contentItem&&this.contentItem.mediaType===l.DISCUSSION_PROMPT},c.prototype.isSingleDiscussionPastDueDate=function(){var e=moment().isAfter(this.$getLegibleDateObj().dueDate);return this.dueDate?this.isSingleDiscussion()&&e:!1},c.prototype.isLessonWithDisucssionAssignment=function(){return this.$isLesson()&&this.contentItem&&this.contentItem.contentItems&&_.find(this.contentItem.contentItems,function(e){return e.mediaType===l.DISCUSSION_PROMPT})},c.prototype.isAssignmentPastDueDate=function(){return moment().isAfter(this.$getLegibleDateObj().dueDate)},c.prototype.$isLessonWithoutScorableItems=function(){return this.$isLesson()?!this.$hasScorableItems():!1},c.prototype.$getPrimaryMetadata=function(e){return this.$findItemMetadata(this.itemUuid,e)},c.prototype.$getChildAdaptiveUserAssignment=function(){var e=this,t=e.studentMetadata,n=null;return e.$isLesson()&&(n=_.filter(t,function(t){return t.assignmentId!==e.assignmentId})),n?n[0]:null},c.prototype.$isSingleItemAssignment=function(){return"Sequence"!==this.contentItem.fileType},c.prototype.isAdaptiveAssignment=function(){return"ADAPTIVE"===this.type||"Adaptive Homework"===this.contentItem.mediaType},c.prototype.$getAssignmentStatus=function(e){if(s.isPreviewingAssignment)return r.STATUS.NOT_STARTED;var t=this.$getPrimaryMetadata(e);return t.attachmentUrl&&t.status===r.STATUS.NOT_STARTED?r.STATUS.IN_PROGRESS:t.status},c.prototype.$hasScorableItems=function(){var e=this;return void 0!==_.find(e.studentMetadata,function(e){return"TEST"===e.itemType||"SCO"===e.itemType||e.itemType===o.FILE_TYPE.TIN_CAN_SCO})};var f=function(e){return e&&"TEST"===e.itemType&&m(e)&&e.userAssignmentDataList[0]&&"COMPLETED"===e.userAssignmentDataList[0].completionStatus&&e.userAssignmentDataList[0].manualScore},h=function(e){return e&&"TEST"===e.itemType&&m(e)&&e.userAssignmentDataList[0]&&"COMPLETED"===e.userAssignmentDataList[0].completionStatus&&e.userAssignmentDataList[0].needsManualScoring},v=function(e){return e&&"TEST"===e.itemType&&m(e)&&e.userAssignmentDataList[0]&&"COMPLETED"===e.userAssignmentDataList[0].completionStatus&&e.userAssignmentDataList[0].scoreSent},S=function(e){return m(e)?e.userAssignmentDataList[0].score:void 0},T=function(e){return{isManualScore:f(e),isNotScored:h(e),isScoreSent:v(e),score:S(e)}};return c.prototype.$getItemScoreForStudent=function(e,t){var n=this.$findItemMetadata(e,t);return S(n)},c.prototype.$requireManualScoreCount=function(){var e,t=this,n=t.studentMetadata;return t.$isLesson()&&(n=t.$getCompleteLessonMetadata()),e=_.filter(n,function(e){return m(e)&&f(e)}),g(e)},c.prototype.$notScoredCount=function(){var e,t=this,n=t.studentMetadata;return t.$isLesson()&&(n=t.$getCompleteLessonMetadata()),e=_.filter(n,function(e){return m(e)&&h(e)}),g(e)},c.prototype.$notSentScoreCount=function(){var e,t=this,n=t.studentMetadata;return t.$isLesson()&&(n=t.$getCompleteLessonMetadata()),e=_.filter(n,function(e){return m(e)&&"TEST"===e.itemType&&!v(e)&&!h(e)}),g(e)},c.prototype.$isRemediationAssignment=function(){return angular.isString(this.remediationOriginalItemUuid)},c.prototype.$isNotStarted=function(){return this.$getAssignmentStatus()===r.STATUS.NOT_STARTED},c.prototype.$isCompleted=function(){return this.$getAssignmentStatus()===r.STATUS.COMPLETED},c.prototype.$isInProgress=function(){return this.$getAssignmentStatus()===r.STATUS.IN_PROGRESS},c.prototype.$isPastDue=function(e){var t=moment(),n=t.isAfter(this.$getLegibleDateObj().dueDate);return this.dueDate?e?n:!this.$isCompleted()&&n:!1},c.prototype.$isLate=function(e){if(!this.dueDate)return!1;var t,n=this,s=n.$getLegibleDateObj().dueDate;return e?(t=moment(e.lastOpenDate),e.status===r.STATUS.COMPLETED&&t.isAfter(s)):(t=moment(n.$getPrimaryMetadata().lastOpenDate),n.$isCompleted()&&t.isAfter(s))},c.prototype.$hide=function(){throw new Error("You should use AssignmentFacadeService.hideAssignment")},c.prototype.$unhide=function(){throw new Error("You should use AssignmentFacadeService.unhideAssignment")},c.prototype.$getLessonItems=function(){return this.contentItem.$getLessonItems()},c.prototype.getRRSActivities=function(e){var t=this,n=[],r=function(e){return e.getRRSActivities().then(function(t){e.RRSActivities=t})},s=function(e){angular.forEach(e,function(e){e.isRRS()&&n.push(r(e))})};if(t.isRRS())n.push(r(t.contentItem));else if(t.$isLesson())if(e)angular.forEach(t.contentItem.contentItems,function(e){e.isRRS()?n.push(r(e)):e.mediaType===l.LEARNING_MODEL&&s(e.contentItems)});else{var a=t.childContents?t.childContents:t.$getLessonItems();s(a)}return n},c.prototype.$getCompletedStudentMetadata=function(){var e=this,t=_.where(e.studentMetadata,{status:"completed"});return t},c.prototype.$getCompleteLessonMetadata=function(){var e=this,t=e.$getStudentWithCompletedLesson();return _.filter(e.studentMetadata,function(e){return _.contains(t,e.studentUuid)})},c.prototype.$getStudentWithCompletedLesson=function(){var t,n,s=this;return s.$isLesson()?(t=_.filter(s.studentMetadata,function(e){return"Sequence"===e.itemType&&e.status===r.STATUS.COMPLETED}),n=_.pluck(t,"studentUuid")):(e.warn("Not lesson assignment!",s),[])},c.prototype.$getCompletedManualTestMetadataFromLesson=function(){var e=this,t=e.$getStudentWithCompletedLesson(),n=_.chain(e.studentMetadata).filter(function(e){return _.contains(t,e.studentUuid)&&f(e)}).map(function(e){return angular.extend(e,T(e)),e}).groupBy(function(e){var t=_.findWhere(e.userAssignmentLanguageList,{isSelected:!0});return t.itemUuid}).value();return n},c.prototype.$getMetadataWithScore=function(){var e=this;return _.filter(e.studentMetadata,function(e){return m(e)})},c.prototype.getMetadataWithFilteredRRSSCOScore=function(){var e=this;return _.filter(e.studentMetadata,function(e){return e.itemType!==o.ITEM_TYPE.RRSSCO&&m(e)})},c.prototype.$isMetaDataForAdaptiveItem=function(e){var t,n,r=this;return angular.isArray(e.userAssignmentLanguageList)?(t=e.userAssignmentLanguageList[0].itemUuid,n=r.$getLessonItemsCompletedByStudent(t),n.mediaType===l.ADAPTIVE_HOMEWORK):!1},c.prototype.$getLessonItemsCompletedByStudent=function(t){var n=this,r=[],s=n.$getLessonItems();return angular.forEach(t,function(t){var n=_.findWhere(s,{id:t});n?r.push(n):e.error("Content item referenced by metadata is missing",t)}),r},c.prototype.$getCompletedManualScoreTestsByStudentId=function(e){var t=this,n=_.filter(t.studentMetadata,function(t){return t.studentUuid===e&&t.status===r.STATUS.COMPLETED&&f(t)});return n},c.prototype.$publishScores=function(){throw new Error("You should use AssignmentFacadeService.publishScores")},c.prototype.$getAssigneesName=function(e,t){var n=this;return i.getAssigneesName(n.classUuids,n.groupUuids,n.studentUuids,n.studentMetadata,e,t)},c.prototype.$getStudentUserAssignmentId=function(t){var n,r=this,s=r.$getPrimaryMetadata(t);return s?n=s.userAssignmentId:(e.error("Unable to find matching student metadata",r,t),void 0)},c.prototype.getFilteredStudentList=function(e){var t={},n=_.filter(e,function(e){return e.studentInfo});return t.notStarted=_.where(n,{status:"not_started"}),t.inProgress=_.where(n,{status:"in_progress"}),t.completed=_.filter(n,function(e){return"completed"===e.status||"submitted"===e.status}),t},c.prototype.getFilteredCompletedStudentList=function(e,t){return e?angular.forEach(t,function(e,n){t[n]=_.filter(e,function(e){return e.studentInfo})}):t=_.filter(t,function(e){return e.studentInfo}),t},c.prototype.getSortedCompletedStudentList=function(e,t){return e?angular.forEach(t,function(e,n){t[n]=_.sortBy(e,function(e){return e.studentInfo.lastFirst})}):t=_.sortBy(t,function(e){return e.studentInfo.lastFirst}),t},c.prototype.isSubmitted=function(){return this.$getAssignmentStatus()===r.STATUS.SUBMITTED},c.prototype.isSubmittedOrCompleted=function(){return this.isSubmitted()||this.$isCompleted()},c.prototype.getPrimaryMetadata=c.prototype.$getPrimaryMetadata,c.prototype.findItemMetadata=c.prototype.$findItemMetadata,c.prototype.getAssignmentStatus=c.prototype.$getAssignmentStatus,c.prototype.getItemStatus=c.prototype.$getItemStatus,c.prototype.isLesson=c.prototype.$isLesson,c.prototype.getLessonItems=c.prototype.$getLessonItems,c.prototype.getUserAttachment=c.prototype.$getUserAttachment,c.prototype.getAssigneesName=c.prototype.$getAssigneesName,c.prototype.notScoredCount=c.prototype.$notScoredCount,c.prototype.notSentScoreCount=c.prototype.$notSentScoreCount,c.prototype.isCompleted=c.prototype.$isCompleted,c.prototype.isPastDue=c.prototype.$isPastDue,c.prototype.getTitle=c.prototype.$getTitle,c.prototype.isLate=c.prototype.$isLate,c}]),angular.module("Realize.assignment.student.levelOneCtrl",["Realize.analytics","Realize.common.mediaQueryService","Realize.content"]).controller("StudentAssignmentLevelOneCtrl",["$scope","$rootScope","$location","AssignmentFacadeService","CountClasses","RosterData","AssignmentData","$routeParams","$log","Content","$timeout","ASSIGNMENT_CONSTANTS","webStorage","MediaQuery",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g){"use strict";var p=d.STATUS.NOT_STARTED;e.isDesktop=g.breakpoint.isDesktop,e.classesCount=s,e.currentRoster=a,e.notStartedData=i,e.zeroState=!i.notStartedCount&&!i.inProgressCount&&!i.completedCount,e.displayMode={},e.activeTab=o.status||p,e.completionStatus=d.STATUS,e.$watch("activeTab",function(e){n.search("status",e).replace()}),r.getAssignmentsWithExternalProviderData(i).then(function(t){i=t,e.pageLoaded()}),e.etexts=[],e.tools=[],e.useSidebar=!1,e.sidebarOpen=!1,e.sidebarData={},e.sidebarData.tools=[];var f=[],h="studentEtextToolsClosed",v=m.session;if(angular.forEach(e.currentRoster.productIds,function(t){e.currentUser.productIdMap&&e.currentUser.productIdMap[t]&&f.push(e.currentUser.productIdMap[t])}),f.length>0){var S=f;c.getETexts(S,!0).then(function(n){n&&n.length&&!v.get(h)&&t.$broadcast("sidebar:open"),e.sidebarData.etexts=n,e.useSidebar=!0,l.log("eTexts Loaded:",e.sidebarData.etexts)},function(e){l.error("Error loading eTexts!",e)}),c.getToolsByPrograms(S,!0).then(function(n){n&&n.length&&!v.get(h)&&t.$broadcast("sidebar:open"),e.sidebarData.tools=n,e.tools.sort(function(e,t){return e.$getTitle().toLowerCase().localeCompare(t.$getTitle().toLowerCase())}),e.useSidebar=!0,l.log("Tools Loaded:",e.sidebarData.tools)},function(e){l.error("Error loading tools:",e)})}t.justCompletedAssignment&&(e.showAlert=e.completedAssignmentId=t.justCompletedAssignment,t.justCompletedAssignment=void 0),e.$watch("sidebarData",function(t){(t.etexts&&t.etexts.length>=1||t.tools&&t.tools.length>=1)&&(e.useSidebar=!0)}),e.back=function(){var r;r=t.currentUser.isStudent?e.classesCount<2?"/":"/classes":n.path().split("/student")[0]+"/assignments",e.goBack(r,!0)},e.$on("sidebar:close",function(){v.add(h,!0),e.sidebarOpen=!1;var t=u(function(){e.hideSidebarOpenLink=!1},155);e.$on("$destroy",function(){u.cancel(t)})}),e.$on("sidebar:open",function(t,n){v.remove(h),e.indexFocus=n&&n.userTriggered,e.sidebarOpen=!0,e.hideSidebarOpenLink=!0}),e.openSideBarEtext=function(){t.$broadcast("sidebar:open",{userTriggered:!0})},e.getSideBarLinkText=function(){var t=e.sidebarData.tools&&e.sidebarData.tools.length>0,n=e.sidebarData.etexts&&e.sidebarData.etexts.length>0,r="";return r=n?t?"assignmentListStudent.action.showEtextTools":"assignmentListStudent.action.showTools":"assignmentListStudent.action.showEtext",e.getMessage(r)},e.$on("window.breakpoint.change",function(){e.isDesktop=g.breakpoint.isDesktop})}]),angular.module("Realize.assignment.zeroState",["Realize.analytics","Realize.assignment.zeroStateService","Realize.constants.googleClassroom","rlzComponents.components.googleClassroom"]).directive("assignmentsZeroState",["$log","$location","AssignmentZeroStateService","$rootScope","GOOGLE_CLASSROOM","googleClassroomService",function(e,t,n,r,s,a){"use strict";return{scope:{assignmentData:"=",currentRoster:"=classRosterData"},templateUrl:"templates/assignment/teacher/assignments_zero_state.html",link:function(s){s.location=t,s.hasZeroState=function(){return _.any(s.zeroState)};var i=function(){s.studentsList&&s.assignmentsCount&&(s.zeroState=n.calculateZeroState({classId:s.currentRoster.classId,studentsList:s.studentsList,classPrograms:s.currentRoster.productIds,assignmentsCount:s.assignmentsCount}),s.hasZeroState()&&r.pageLoaded())};s.$watch("currentRoster.students",function(t){e.log("studentsList updated",s.studentsList),s.studentsList=t,i()},!0),s.$watch("assignmentData.assignmentsCount",function(t){e.log("assignmentsCount changed",s.assignmentsCount),s.assignmentsCount=t,i()},!0),s.viewHiddenAssignments=function(){s.$emit("assignment:zeroState:viewHidden")},s.redirectToGoogleClassroom=function(){a.redirectToGoogleClass(s.currentRoster.classId,s.currentRoster.rosterSource)},s.isGoogleClass=function(){return s.currentRoster.isGoogleClass()}}}}]),angular.module("Realize.assignment.teacher.manualScoreReviewCtrl",["Realize.analytics","Realize.common.alerts"]).controller("AssignmentManualScoreReviewCtrl",["$scope","$rootScope","$location","AssignmentFacadeService","ClassAndAssignmentData","$routeParams","GroupData","$log","AlertService","InlineAlertService","TEMPLATE_PATH","Modal","lwcI18nFilter",function(e,t,n,r,s,a,i,o,l,c,u,d,m){"use strict";e.singleAssessmentTemplate="templates/assignment/teacher/manual_score_review_single.html",e.multipleAssessmentTemplate="templates/assignment/teacher/manual_score_review_multiple.html",e.currentRoster=s.roster,e.assignment=s.assignment,e.scoringReviewStatus={};var g=e.assignment.$getAssigneesName(e.currentRoster,i),p=[].concat(g.classes,g.groups,g.students);if(e.assigneeCSV=p.join(" | "),e.assignment.$isLesson())if(1===_.size(s.completedStudentMetadata))e.singleAssessment=!0,e.completedStudentList=_.values(s.completedStudentsByContent)[0];else{e.singleAssessment=!1,e.completedStudentsByContent=s.completedStudentsByContent;var f=_.keys(e.completedStudentsByContent);e.contentItems=e.assignment.$getLessonItemsCompletedByStudent(f)}else e.singleAssessment=!0,e.completedStudentList=s.completedStudentList;if(e.singleAssessment)e.scoringReviewStatus=r.getScoreStatusCounts(e.completedStudentList);else{var h=_.flatten(_.values(e.completedStudentsByContent),!0);e.scoringReviewStatus=r.getScoreStatusCounts(h)}e.sentScoreSuccess=function(){var t="<strong>"+m("assignmentList.sentScore.successNotification.message")+"</strong> ",r=n.search().activeTab;"assignmentsByStudent"===r?l.addAlert("success","ok-sign",t,3):c.addAlert(e.assignment.assignmentId,{type:"success",msg:t}),n.path("/classes/"+a.classId+"/assignments/")},e.openStudentManualScore=function(t,r){var s=["/classes",a.classId,"assignments",e.assignment.assignmentId,"manualScore","content",r.id,r.version,"student",t.studentUuid,"userAssignmentId",t.userAssignmentId].join("/");n.path(s)},e.back=function(){e.goBack()};var v=function(){r.publishScores(e.assignment.assignmentId,e.currentRoster.classId).then(function(){o.log("Publish Assignment Scores: SUCCESS"),e.loading=!1,e.sentScoreSuccess()})};e.sendScore=function(t){t.preventDefault(),t.stopPropagation(),e.loading=!0;var n=e.scoringReviewStatus.isPartiallyScored,r=e.scoringReviewStatus.isPartiallySent,s=function(){d.hideDialog(),e.loading=!1},a=function(){v()};if(n||r){var i,o,l=m("reviewManualScore.sendScoreModal.title");n&&!r?(i=m("reviewManualScore.sendScoreModal.message.notAllScored"),o=m("reviewManualScore.sendScoreModal.action.sendScoreSubmissions")):r&&!n?(i=m("reviewManualScore.sendScoreModal.message.partiallySent"),o=m("reviewManualScore.sendScoreModal.action.sendScoreRemaining")):n&&r&&(i=m("reviewManualScore.sendScoreModal.message.notAllScoredAndPartiallySent"),o=m("reviewManualScore.sendScoreModal.action.sendScoreRemaining"));var c={id:"sendScoreReviewWarningModal"},u={OK:{title:o,handler:a,isDefault:!0},CANCEL:{title:m("reviewManualScore.sendScoreModal.action.cancelBtn"),handler:s}};d.simpleDialog(l,i,u,c)}else v()}}]),angular.module("Realize.assignment.teacher.manualScoreTestCtrl",["Realize.analytics","Realize.common.alerts","Realize.assessment.assessmentDataService"]).constant("MANUAL_SCORE",{MIN_VALUE:-999.99,MAX_VALUE:999.99,MAX_LENGTH:6}).controller("AssignmentManualScoreTestCtrl",["$scope","$rootScope","$location","$log","Assessment","lwcI18nFilter","ClassAndAssignmentData","$routeParams","AssessmentData","InlineAlertService","MANUAL_SCORE","KEY_CODES","UnsavedChangesModal","$window","$timeout","rubricEventTracking","telemetryUtilitiesService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h){"use strict";e.assessmentSummary=l.summaryResponse,e.assessmentSessionId=l.sessionId,e.assessmentResult=l.resultResponse,e.assignment=i.assignment,e.completedStudentList=[],e.MIN_VALUE=u.MIN_VALUE,e.MAX_VALUE=u.MAX_VALUE,e.MAX_LENGTH=u.MAX_LENGTH,e.openRubricPanel=!1,e.focusOnQuestion=function(t,n,r){e.focusOnTextboxEvent={type:r.type,textBoxToQuestionMappingId:t.responseIdentifiers[0]},this.manualScores[n].forEach(function(e){e.onFocus&&(e.onFocus=!1)}),t.onFocus=!0},e.showingQuestionReview=function(t){return e.isMultipartScoringQuestionView(t)?e.focusOnTextboxEvent:!0},e.isMultipartScoringQuestionView=function(t){return(e.manualScores.length>1||e.manualScores[0]&&e.manualScores[0].length)&&t.manualScore&&null!==t.multipartScores};var v=function(){return e.openQuestion?angular.element("#manualScoreForm"+e.openQuestion.index).scope().manualScoreForm:null},S=function(){v()&&!v().$pristine&&(e.openQuestion.points=e.openQuestion._points,v().$setPristine())},T=new m(function(){return e.openQuestion.multipartScores&&null!==e.openQuestion.multipartScores?e.submitMultipartForm(e.openQuestion,!0):e.submitForm(e.openQuestion,!0)}),A=function(t,n){var s=!v()||v().$pristine;return s?(R(),angular.isFunction(t)?t():(r.error("AssignmentManualScoreTestCtrl: checkUnsavedChanges has invalid argument"),void 0)):(T.showDialog(n).then(t,e.pageLoaded),void 0)},I=function(e){e.pointsValue=null===e.points||0===e.points?e.autoScore&&null!==e.autoScore?e.autoScore:0:e.points},E=function(t){e.questions=t.questionScores,e.displayScore=t.totalScore.percentScore;var n,r,s;for(e.manualScores=[],e.isManualScoreFormStartSaving=[],e.isMultipartScoringQuestion=!1,r=e.questions.length-1;r>=0;r--)s=e.questions[r],s.index=r,s.previouslyScored=null!==s.points,s._points=s.points,s.multipartScores&&null!==s.multipartScores&&(e.isMultipartScoringQuestion=!0,s.multipartScores=s.multipartScores,I(s),s.maxPointsValue=s.maxPoints,e.manualScores[r]=s.multipartScores.map(function(e){return{onFocus:!1,points:s.previouslyScored||e.score.points?e.score.points:null,maxPoints:e.score.maxPoints,responseIdentifiers:e.responseIdentifiers}}),e.isManualScoreFormStartSaving[r]=!1),s.manualScore&&(s.nextManual=n,n=r)},y=function(e){e.data.init&&(e.source.isManualScore=!0)};E(e.assessmentResult),g.addEventListener("message",y),e.$on("$destroy",function(){g.removeEventListener("message",y)}),e.questionCounts=e.questions.length,e.manualQuestionCounts=_.filter(e.questions,function(e){return e.manualScore}).length,e.isAllManualScoreQuestions=e.questionCounts===e.manualQuestionCounts,e.expand=function(t,n){var r=function(){S();var r=t.index;e.openQuestion=e.openQuestion&&e.openQuestion.index===r?null:e.questions[r],T.reset(),e.openQuestion&&e.isMultipartScoringQuestionView(t)&&p(function(){var e=".expanderRow:nth-child("+(n+1)+") .multi-manual-score-large:nth-child(1) input:nth-child(1)";$(e)[0].focus()})};A(r)};var R=function(){e.rubricGuid=void 0,e.isRubricAvailable=!1,e.openRubricPanel=!1};e.rubricManualScore=function(t){e.openQuestion.points=t;var n=angular.element("#manualScoreForm"+e.openQuestion.index).scope().manualScoreForm;n.$pristine=!1},e.$on("assessment-player.questionReview.rubricGuid",function(t,n){n.rubricGuid?(e.rubricGuid=n.rubricGuid,e.isRubricAvailable=!0):(e.rubricGuid=void 0,e.isRubricAvailable=!1)}),e.closeSidebar=function(){e.openRubricPanel=!1,setTimeout(function(){var e=document.getElementById("rubric-test-nav-button");e&&e.focus()},100)},e.isRubricAvailableForAssignment=function(){return e.isRubricAvailable&&e.assignment.useRubric},e.toggleRubricPanel=function(){e.openRubricPanel=!e.openRubricPanel,e.openRubricPanel&&setTimeout(function(){var e=document.getElementById("rubricCloseButton"),t=document.getElementById("noRubricCloseButton");e?e.focus():t.focus()},100),e.programTitle=h.getProgramTitle(e.assignment.programHierarchy),f.clickOnRubricInManualScoreTestViewer(e.programTitle,e.assignment.contentItem.externalId,e.assignment.contentItem.title)},e.activeTab="manual",e.tabFilter={manualScore:!0},e.showTab=function(t){if(e.activeTab!==t){var n=function(){S(),e.activeTab=t,e.openQuestion=null,e.tabFilter="manual"===e.activeTab?{manualScore:!0}:{},T.reset()};A(n)}},e.allScored=function(){return!e.assessmentResult.needsManualScoring},e.assignment.$isLesson()?_.each(i.completedList,function(t){var n=e.assignment.$findItemMetadata(o.itemId,t.studentUuid);n&&"completed"===n.status&&(n.studentInfo=t.studentInfo,e.completedStudentList.push(n))}):e.completedStudentList=i.completedList,e.completedStudentList=_.sortBy(e.completedStudentList,function(e){return e.studentInfo.lastFirst}),_.each(e.completedStudentList,function(t,n){t.userAssignmentId===o.userAssignmentId&&(e.student=t,e.studentIndex=n)}),e.student||r.error("Cannot find matching student with userAssignmentId",o.userAssignmentId),e.back=function(){var t=n.path().split("/manualScore")[0]+"/allstudents";e.goBack(t)},e.changeStudent=function(t,r){r.preventDefault();var s=e.completedStudentList[e.studentIndex+t],a=[n.path().split("/student")[0],"student",s.studentUuid,"userAssignmentId",s.userAssignmentId].join("/");n.path(a)},e.reviewManualScore=function(e){e.preventDefault();var t=[n.path().split("/manualScore")[0],"manualScoreReview"].join("/");n.path(t)},e.openNextQuestion=function(t){if(e.openQuestion=null,"all"===e.activeTab){var n=t.index+1;n<=e.questionCounts-1&&e.expand(e.questions[n])}else t.nextManual&&e.expand(e.questions[t.nextManual])},e.reloadResult=function(){return s.getResult(e.assessmentSessionId).then(function(t){e.assessmentResult=t,E(t)})},e.isInvalid=function(t){var n=angular.element("#manualScoreForm"+e.openQuestion.index).scope().manualScoreForm,r=n["input"+t];return r.$dirty&&r.$invalid},e.disableMultiScoreSubmitButton=function(e,t){for(var n=!1,r=0;t>r;r++){var s=e["input"+r];s&&(n=n||s.$dirty&&(s.$invalid||null===s.$modelValue))}return n&&e.$dirty||e.$pristine},e.submitForm=function(t,n){return s.saveManualScore(e.assessmentSessionId,t.questionId,t.points).then(function(){return e.reloadResult().then(function(){c.addAlert(t.questionId,{type:"success",msg:a("manualScoreTest.saveSuccess")}),v().$setPristine(),n?e.openQuestion=null:e.openNextQuestion(t)})})},e.submitMultipartForm=function(t,n){var r=[];return r=e.manualScores[t.index].map(function(e){var t=e.points;return null===t?{score:null}:{score:{points:t,maxPoints:e.maxPoints},responseIdentifiers:e.responseIdentifiers}}),e.isManualScoreFormStartSaving[t.index]=!0,s.saveManualMultipartScore(e.assessmentSessionId,t.questionId,r).then(function(){return e.reloadResult().then(function(){c.addAlert(t.questionId,{type:"success",msg:a("manualScoreTest.saveSuccess")}),n?e.openQuestion=null:e.openNextQuestion(t),e.isManualScoreFormStartSaving[t.index]=!1})})},e.submitOnEnter=function(t,n){n.stopPropagation();var r=angular.element("#manualScoreForm"+e.openQuestion.index).scope().manualScoreForm;r.input.$dirty=!0;var s=!r.$pristine&&!r.$invalid;n.which===d.ENTER&&s&&e.submitForm(t)},e.$on("$locationChangeStart",function(e){A(null,e)}),e.updateScores=function(t){var n=0,r=e.questions[t].autoScore;e.manualScores[t].forEach(function(e){n+=e.points||0,e.onFocus=!1}),e.questions[t].pointsValue=r&&null!==r?r+Math.round(100*n)/100:Math.round(100*n)/100,e.focusOnTextboxEvent={type:"unfocus",textBoxToQuestionMappingId:""}}}]),angular.module("Realize.assignment.zeroStateService",[]).service("AssignmentZeroStateService",["$log",function(e){"use strict";var t={};this.calculateZeroState=function(t){var n=this.getZeroState(t.classId),r=t.studentsList.length,s=t.classPrograms.length,a=t.assignmentsCount.totalActive,i=t.assignmentsCount.totalHidden;return n.noPrograms=0===s,n.noStudents=0===r&&s>0,n.noAssignments=s>0&&r>0&&0===a&&0===i,n.allHidden=s>0&&r>0&&0===a&&i>0,e.log("Zero state updated for",t.classId,n),n},this.getZeroState=function(e){return t[e]||(t[e]={}),t[e]}}]),angular.module("Realize.classLanding.studentClassesCtrl",[]).controller("StudentClassesCtrl",["$scope","RosterData","$location","lwcI18nFilter",function(e,t,n,r){"use strict";e.rosters=t,e.openRoster=function(e,t){e&&(e.preventDefault(),e.stopPropagation()),n.path("/classes/"+t.classId+"/assignments")},e.messageFormat=r("classListStudent.status.nextAssignmentDue"),e.openDiscussions=function(e,t){e.preventDefault(),e.stopPropagation(),n.path("/classes/"+t.classId+"/discussPrompt")}}]),angular.module("Realize.classLanding.teacherClassesCtrl",["RealizeDataServices","ModalServices","Realize.assignment.facadeService","Realize.core.security.permissions","Realize.paths","Realize.filters.pipes","Realize.filters.excludeCurrentUser","Realize.filters.displayFullName","Realize.common.alerts","Realize.common.mediaQueryService","rlzComponents.components.googleClassroom","Realize.constants.googleClassroom","Realize.analytics","rlzComponents.components.featureManagement","rlzComponents.components.googleClassroom.constants"]).controller("TeacherClassesCtrl",["$scope","Permissions","ClassRoster","$location","$log","$currentUser","ActiveRosters","Modal","$timeout","lwcI18nFilter","AssignmentFacadeService","PATH","AlertService","MediaQuery","googleClassroomService","GOOGLE_CLASSROOM","Analytics","$q","GoogleClassroomConstants","featureManagementService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T){"use strict";e.collapseQuickList=!g.breakpoint.isDesktop,e.rosters=i,e.zeroRostersState=0===i.length,e.location=r,e.hasPermission=t.hasPermission,e.nowShowing="current",e.showGoogleClassroomIntegration=T.isGoogleClassroomEnabled(),e.createClassesOptionsTemplate="templates/partials/googleClassroom/createClassesOptions.html",a.setAttribute("classes.visited",!0),e.filterByStatus=function(t){return"hidden"===e.nowShowing&&"ACTIVE"===t.status?!1:!0},e.extractClassIDs=function(e){return e.classId};var A=function(e){return e.rosterSource===f.ROSTER_SOURCE.GOOGLE_CLASSROOM};e.hasHidden=a.$getInactiveRosterCount()>0,a.showNoProgramModal()||(e.alertDetails=m.alerts[0],e.alertIsSet=m.alertIsSet()),e.retrieveHiddenGoogleClasses=function(t){var n=v.defer(),r=_.filter(t,A);if(r&&r.length>0&&e.showGoogleClassroomIntegration){var a=JSON.stringify(_.map(r,e.extractClassIDs)),i="query {getClassStatus(classIds:"+a+") {classStatus{classId courseState}}}";p.classSyncServiceQuery(i).then(function(e){var r=e.data.getClassStatus;if(void 0!==r&&r.classStatus.length>0){var s=r.classStatus;s.forEach(function(e){var n=_.findWhere(t,{classId:e.classId});n.courseState=e.courseState})}n.resolve(t)},function(e){s.error("error getting roster course states",e),n.reject(e)})}else n.resolve(t);return n.promise},e.$watch("nowShowing",function(t,r){t!==r&&(e.pageLoading(),"hidden"===t&&(e.rosters=null,n.get({statusFilter:"Inactive",noCachedData:!0}).then(function(t){e.retrieveHiddenGoogleClasses(t).then(function(t){e.rosters=_.filter(t,e.filterByStatus),e.zeroRostersState=0===e.rosters.length,e.pageLoaded()}).catch(function(e){s.error("error getting rosters",e)})},function(e){s.error("error getting rosters",e)})),"current"===t&&u.getClassesReportingData().then(function(t){e.rosters=t,e.zeroRostersState=0===e.rosters.length,e.pageLoaded()},function(){s.error("error getting rosters with reporting data")}))}),e.openRoster=function(e,t){e.preventDefault(),e.stopPropagation(),s.log("manage quicklink clicked",t),r.path("/classes/"+t.classId+"/manage")},e.hideRoster=function(t,n){t.preventDefault(),t.stopPropagation();var r=o.progressDialog(e.$new(),{progressHeader:c("classList.hideProgress.title"),progressMessage:c("classList.hideProgress.message")}).then(function(){r.fakeProgress()
});n.$hide(function(){n.$clearCache(),r.then(function(){r.progressComplete(),a.$setInactiveRosterCount(a.$getInactiveRosterCount()+1),e.hasHidden=!0;var t=l(o.hideDialog,750);e.$on("$destroy",function(){l.cancel(t)})})})},e.unhideRoster=function(t,n){t.preventDefault(),t.stopPropagation();var r=e.rosters,s=o.progressDialog(e.$new(),{progressHeader:c("classList.unhideProgress.title"),progressMessage:c("classList.unhideProgress.message")}).then(function(){s.fakeProgress()});n.$unhide(function(){n.$clearCache(),s.then(function(){"hidden"===e.nowShowing&&(e.rosters=_.filter(r,e.filterByStatus)),s.progressComplete();var t=a.$getInactiveRosterCount()-1;a.$setInactiveRosterCount(t),e.hasHidden=t>0,e.hasHidden||(e.nowShowing="current");var n=l(o.hideDialog,750);e.$on("$destroy",function(){l.cancel(n)})})})},e.deleteRoster=function(t,n){t.preventDefault(),t.stopPropagation();var r,s=a.getAttribute("classRoster.suppressDeleteWarning"),i=function(){o.hideDialog()},l=function(){r.dismissed&&a.$toggleAttribute("classRoster.suppressDeleteWarning"),n.$delete(function(){var t=e.rosters.indexOf(n);e.rosters.splice(t,1),o.hideDialog()})};s?n.$delete(function(){var t=e.rosters.indexOf(n);e.rosters.splice(t,1)}):(r=e.$new(),r.dialogId="deleteRosterWarningModal",r.title="Delete Class Roster",r.body="Are you sure you want to delete this class roster? This cannot be undone.",r.isDismissible=!0,r.buttons=[{title:"Cancel",clickHandler:i},{title:"Ok",clickHandler:l,isDefault:!0}],r.dismissed=!1,r.closeBtnClickHandler=i,o.showDialog("templates/partials/simpleDialog.html",r))},e.deleteAllRosters=function(t){t.preventDefault(),t.stopPropagation(),n.deleteAll(function(){e.rosters=[]})},e.openAssignments=function(t,n){t.preventDefault(),t.stopPropagation(),"hidden"!==e.nowShowing&&"INACTIVE"!==n.status&&r.path("/classes/"+n.classId+"/assignments")},e.openCalendar=function(t,n){t.preventDefault(),t.stopPropagation(),"hidden"!==e.nowShowing&&r.path("/classes/"+n.classId+"/calendar")},e.openPrompt=function(e,t){e.preventDefault(),e.stopPropagation(),r.path("/classes/"+t.classId+"/discussPrompt")},e.showHiddenClasses=function(t){t.preventDefault(),t.stopPropagation(),e.nowShowing="hidden"},e.openStudents=function(e,t){e.preventDefault(),e.stopPropagation(),r.path("/classes/"+t.classId+"/students")},a.isReviewer?(e.reviewTemplate="templates/partials/reviewer_zero_classes.html",e.imagePath=d.IMAGES,e.showReviewZero=!a.getAttribute("classes.created")):e.showReviewZero=!1,e.$on("window.breakpoint.change",function(){e.collapseQuickList=!g.breakpoint.isDesktop}),e.redirectToRealizeSyncWebApp=function(){var e={extensions:{area:S.CLASSES,page:S.SELECT_A_CLASS,product:S.EVENT_TYPE.PROGRAM_NOT_AVAILABLE,description:f.GOOGLE_CONNECT},definition:{name:f.CONNECT_CLASS}};p.redirectToRealizeSyncWebApp(r.absUrl(),S.LAUNCH,e)},e.redirectToCreateClasses=function(){h.track("track.action",{category:"Classes",action:"Create classes"}),r.path("/classes/create"),r.search({})},e.isClassDeletedArchived=function(e){return e.googleStatus===f.ARCHIVED_LOWERCASE||e.googleStatus===f.DELETED_LOWERCASE},e.isRosterActive=function(t){return"ACTIVE"===t.status&&"hidden"!==e.nowShowing&&!e.isClassDeletedArchived(t)},e.redirectToGoogleClassroom=function(e,t){var n={extensions:{area:S.CLASSES,page:S.SELECT_A_CLASS,product:S.EVENT_TYPE.PROGRAM_NOT_AVAILABLE,description:f.GOOGLE_UNARCHIVE},definition:{name:f.UNARCHIVE_CLASS}};p.redirectToGoogleClass(e,t,f.UNARCHIVE,n)},e.checkHiddenGoogleClass=function(e){return e.isGoogleClass()&&(e.courseState===f.DELETED||e.courseState===f.ARCHIVED)},e.isInactiveHiddenClass=function(t){return t.status!==f.ACTIVE&&e.nowShowing===f.HIDDEN}}]),angular.module("Realize.classRoster.resolves.getAll",["RealizeDataServices"]).factory("ClassRosterResolveGetAll",["ClassRoster",function(e){"use strict";return function(){return e.get()}}]),angular.module("Realize.classRoster.resolves.getCurrent",["RealizeDataServices"]).factory("ClassRosterResolveGetCurrent",["ClassRoster","$route","$rootScope","$q",function(e,t,n,r){"use strict";return function(){return e.get(t.current.params.classId).then(function(e){return n.currentRoster=e,e},function(){return r.reject("error getting roster! "+t.current.params.classId)})}}]),angular.module("RealizeDirectives").directive("a11yDateRange",[function(){"use strict";return{replace:!0,scope:!0,templateUrl:"templates/common/a11yDaterange/a11yDaterange.dir.html",link:function(e){e.a11yDateRangeOption="last30Days",e.updateDateRange=function(){switch(e.a11yDateRangeOption){case"today":e.filters={startDate:Date.today().toString("MM/dd/yyyy"),endDate:Date.today().toString("MM/dd/yyyy")};break;case"week":e.filters={startDate:Date.today().addDays(-6).toString("MM/dd/yyyy"),endDate:Date.today().toString("MM/dd/yyyy")};break;case"month":e.filters={startDate:Date.today().moveToFirstDayOfMonth().toString("MM/dd/yyyy"),endDate:Date.today().moveToLastDayOfMonth().toString("MM/dd/yyyy")};break;case"year":e.filters={startDate:Date.today().moveToMonth(0,-1).moveToFirstDayOfMonth().toString("MM/dd/yyyy"),endDate:Date.today().moveToMonth(11).moveToLastDayOfMonth().toString("MM/dd/yyyy")};break;case"last30Days":e.filters={startDate:Date.today().addMonths(-1).toString("MM/dd/yyyy"),endDate:Date.today().toString("MM/dd/yyyy")};break;default:e.filters={startDate:Date.today().addMonths(-1).toString("MM/dd/yyyy"),endDate:Date.today().toString("MM/dd/yyyy")}}e.$emit("a11yDateRange.date.selected",e.filters)}}}}]),angular.module("Realize.common.adaptiveIconDirective",["Realize.paths","Realize.constants.mediaType"]).directive("adaptiveIcon",["PATH","MEDIA_TYPE",function(e,t){"use strict";return{scope:{item:"=adaptiveIcon"},templateUrl:e.TEMPLATE_ROOT+"/common/adaptiveIcon/adaptiveIcon.dir.html",link:function(e){e.ADAPTIVE_HOMEWORK=t.ADAPTIVE_HOMEWORK}}}]),angular.module("Realize.common.alerts",["Realize.alerts.alertService","Realize.alerts.inlineAlertService","Realize.alerts.alertDirective","Realize.alerts.firstVisitAlertDirective","Realize.alerts.inlineNotificationDirective","Realize.alerts.messageBasedAlertDirective"]),angular.module("Realize.Attach.attachmentModalUtilService",["Realize.paths"]).service("attachmentModalUtilService",["$q","$http","$log","REST_PATH",function(e,t,n,r){"use strict";var s=this,a={headers:{"Content-Type":"application/json"}},i=function(e,t){return[r,"discussions","classes",e,"assignments",t,"attachments"].join("/")},o=function(e,n,r){var s=new FormData,a={headers:{"Content-Type":void 0},transformRequest:angular.identity},o=angular.extend({},a);return s.append("file",r),t.post(i(e,n),s,o)},l=function(e,n,r){return t.post(i(e,n)+"?url="+r)},c=function(t){return t.then(function(e){return e.data},function(t){return e.reject(t)})};return s.saveAttachment=function(e,t,n){var r=o(e,t,n);return c(r)},s.saveLinkAttachment=function(e,t,n){var r=l(e,t,n);return c(r)},s.downloadAttachment=function(n,s,i,o,l){var c=angular.extend({},a),u=[r,"discussions/classes",n,"assignments",s,"attachments",i].join("/");return c.params={fileName:o,attachmentType:l},t.get(u,c).then(function(e){return e},function(t){return e.reject(t)})},s}]),angular.module("Realize.common.browserInfoService",[]).service("BrowserInfo",["$window",function(e){"use strict";function t(){return e.navigator?angular.lowercase(e.navigator.userAgent):""}this.browser={},this.OS={},this.isHDDisplay=e.devicePixelRatio>=2;try{this.isIDevice="iPad"===e.navigator.platform||"iPhone"===e.navigator.platform||"iPad Simulator"===e.navigator.platform}catch(n){this.isIDevice=!1}Object.defineProperties(this.OS,{isIOS:{get:function(){return/(ipod|iphone|ipad)/i.test(t())}},isIOS5:{get:function(){return/(ipod|iphone|ipad)/i.test(t())&&/OS 5_[0-9_]+ like Mac OS X/i.test(t())}},isIOS10:{get:function(){return/OS 10_[0-9_]+ like Mac OS X/i.test(t())}},isAndroid:{get:function(){return/(android)/i.test(t())}},isMobileDevice:{get:function(){return/(ipod|iphone|ipad)/i.test(t())||/(android)/i.test(t())}}}),Object.defineProperties(this.browser,{isFirefox:{get:function(){return/firefox|iceweasel/i.test(t())}},isMSIE:{get:function(){return/msie|trident/i.test(t())}},isAndroidStock:{get:function(){return/(android)/i.test(t())&&/(Version\/\d+\.\d+)/i.test(t())}},msieVersion:{get:function(){var e=t().toLowerCase().match(/(?:msie |trident\/.*; rv:)(\d+)/);return e?parseInt(e[1],10):void 0}},isSafari:{get:function(){return/^((?!chrome).)*safari/i.test(t())}},isChrome:{get:function(){return/chrome/i.test(t())}}}),this.OS.getAndroidVersion=function(){var e=t().match(/android\s([0-9\.]*)/i);return e?e[1]:!1},this.isMobileDevice=this.OS.isMobileDevice}]),angular.module("Realize.common.coTeachersAlert",["rlzComponents.components.i18n"]).directive("coTeachersAlert",["$rootScope",function(e){"use strict";return{restrict:"EA",templateUrl:"templates/common/coTeachersAlert/coTeachersAlert.dir.html",scope:{},link:function(t){if(t.isCoTeachersAlertVisible=!e.currentUser.getAttribute("dialog.coteachers.info.seen")&&e.currentUser.getAttribute("hasCoTeachers"),t.isCoTeachersAlertVisible){var n=!0;e.currentUser.setAttribute("dialog.coteachers.info.seen",!0,n)}}}}]),angular.module("Realize.common.dateFilterDecorator",[]).config(["$provide",function(e){"use strict";e.decorator("dateFilter",[function(){var e={"short":"L LT",shortDate:"L",medium:"lll",mediumDate:"ll",fullDate:"LL",longDate:"LLLL","MM/dd/yy h:mma":"MM/DD/YY h:mma"},t=function(t,n){var r=moment(t);return n=n||"mediumDate",n=e[n]||n,r.format(n)};return t}])}]),angular.module("Realize.common.DateRangeSelector",["Realize.common.DateRangeSelectorService","RealizeDataServices","rlzComponents.components.i18n","Realize.common.mediaQueryService"]).directive("dateRangeSelector",["$log","$rootScope","RangeDatepickerOptions","DateRangeSelectorService","lwcI18nFilter","MediaQuery",function(e,t,n,r,s,a){"use strict";var i=r.getDefaultDateRangeOptions();return{require:"ngModel",scope:{dateRangeSelectorLabel:"=?",dateRangeSaveAttribute:"@?",customDateRangeOptions:"=?",setStartDatepickerOptions:"=?",setEndDatepickerOptions:"=?",notifyInit:"=?"},templateUrl:"templates/common/dateRangeSelector/dateRangeSelector.dir.html",link:function(o,l,c,u){function d(e){return _.find(o.dateRangeOptions,function(t){return e===t.id})}function m(e){return moment(e,R)}var g,p,f=s("dateRangeSelector.filter.label.dateWhen"),h=o.dateRangeSaveAttribute,v=h+"_start",S=h+"_end",T=t.currentUser,A=T.getAttribute(h),I=T.getAttribute(S),E=T.getAttribute(v),y=!angular.isDefined(o.notifyInit),R="MM/DD/YYYY";o.useShortLabels=!a.breakpoint.isDesktop,o.dateRangeSelectorLabel=o.dateRangeSelectorLabel||f,o.select=function(e){o.selectedValue=e},o.$watchCollection("range",function(e,t){var n,r;e.endDate!==t.endDate&&(r=m(o.range.endDate),T.setAttribute(S,r.format(R),!0),e.endDate&&(o.startDateOptions.maxDate=r.toDate())),e.startDate!==t.startDate&&(n=m(o.range.startDate),T.setAttribute(v,n.format(R),!0),e.startDate&&(o.dueDateOptions.minDate=n.toDate())),u.$setViewValue(e)}),o.$watch("selectedValue",function(e,t){if(e&&(e!==t||"customRange"!==e.id&&!y)){var n=r.getDateRangeFromIdentifier(e.id);o.range.id=e.id,o.range.startDate=n.startDate,o.range.endDate=n.endDate,h&&T&&T.setAttribute(h,e.id,!0),u.$setViewValue(o.range),o.$emit("dateRangeSelector.selection.change",e,o.range),y=!0}},!0),p=new n("#filterDateStart","#filterDateEnd"),o.startDateOptions=p.start,o.dueDateOptions=p.end,angular.isFunction(o.setStartDatepickerOptions)&&o.setStartDatepickerOptions(o.startDateOptions),angular.isFunction(o.setEndDatepickerOptions)&&o.setEndDatepickerOptions(o.dueDateOptions),o.dateRangeOptions=angular.isDefined(o.customDateRangeOptions)?o.customDateRangeOptions:i,g=_.findWhere(o.dateRangeOptions,{"default":!0}).id,o.selectedValue=d(angular.isDefined(A)?A:g),o.range={id:null,startDate:null,endDate:null},"customRange"===A&&(r.validateDate(I)&&r.validateDate(E)?(o.range.id=A,o.range.endDate=I,o.range.startDate=E):o.select(d(g))),o.$on("dateRangeSelector.selection.requested",function(t,n){e.log("DateRange selector update to",n),o.selectedValue=d(n)}),o.$on("window.breakpoint.change",function(){o.useShortLables=!a.breakpoint.isDesktop})}}}]),angular.module("Realize.common.DateRangeSelectorService",[]).service("DateRangeSelectorService",[function(){"use strict";var e=[{id:"last7Days",analyticLabel:"Last 7 days",label:"dateRangeSelector.filter.rangeOption.last7Days",order:1},{id:"last14Days",analyticLabel:"Last 14 days",label:"dateRangeSelector.filter.rangeOption.last14Days",order:2},{id:"last30Days",analyticLabel:"Last 30 days",label:"dateRangeSelector.filter.rangeOption.last30Days",order:3,"default":!0},{id:"last60Days",analyticLabel:"Last 60 days",label:"dateRangeSelector.filter.rangeOption.last60Days",order:4},{id:"customRange",analyticLabel:"Custom dates",label:"dateRangeSelector.filter.rangeOption.customRange",order:5}];this.validateDate=function(e){return moment(e).isValid()},this.getDefaultDateRangeOptions=function(){return e},this.getSavedOption=function(e,t,n){var r=e.getAttribute(t);if(n&&"customRange"===r){var s=e.getAttribute(t+"_start"),a=e.getAttribute(t+"_end");return this.validateDate(s)&&this.validateDate(a)?r:!1}return r},this.getSavedDateRange=function(e,t){var n=e.getAttribute(t),r=e.getAttribute(t+"_start"),s=e.getAttribute(t+"_end");return this.getDateRangeFromIdentifier(n,r,s)},this.getDateRangeFromIdentifier=function(e,t,n){var r,s=this.validateDate(t)&&this.validateDate(n);if(!e||"entireClassDuration"===e||"customRange"===e&&!s)r={startDate:null,endDate:null};else if("customRange"===e&&s)r={startDate:t,endDate:n};else if("today"===e)r={startDate:moment(),endDate:moment()};else if("yesterday"===e)r={startDate:moment().subtract(1,"days"),endDate:moment().subtract(1,"days")};else{var a,i=e.indexOf("next")>=0,o=/(\d+)/.exec(e),l=moment();o&&angular.isDefined(o[0])?(a=parseInt(o[0],10),a-=1,r=i?{startDate:l,endDate:moment().add(a,"days")}:{startDate:moment().subtract(a,"days"),endDate:l}):r={startDate:null,endDate:null}}return r}}]),angular.module("Realize.common.expandableTreeDirective",["Realize.common.expandableTreeItemDirective","Realize.paths"]).directive("expandableTree",["PATH",function(e){"use strict";return{scope:{levels:"=",level:"=",template:"=",list:"=",childProperty:"@",visible:"=?",showCheckBox:"=?",container:"=?"},replace:!0,templateUrl:e.TEMPLATE_ROOT+"/common/expandableTree/expandableTree.dir.html",link:function(e){e.showCheckBoxTreeControl=function(t){return!angular.isDefined(e.showCheckBox)||angular.isDefined(t.isEmptyChildList)&&t.isEmptyChildList||angular.isDefined(t.count)&&0===t.count?!1:e.showCheckBox}}}}]),angular.module("Realize.common.expandableTreeItemDirective",[]).directive("expandableTreeItem",["$log","$compile",function(e,t){"use strict";return{scope:!1,restrict:"A",controller:["$log","$scope",function(e,t){t.obj.expanded=!1,t.click=function(e){t.obj.expanded=t.hasChildren?!t.obj.expanded:t.obj.expanded,t.$emit("expandableTreeItem.leftTreeControl.clicked",e)}}],link:function(e,n){var r=e.level+1,s=!1;if(e.obj[e.childProperty]&&(s=e.obj[e.childProperty].length>0&&r<e.levels),e.hasChildren=s,s){var a=t('<ul expandable-tree visible="obj.expanded" levels="levels" level="level + 1" list="obj[childProperty]" child-property="children" template="template" open="open" show-check-box="showCheckBox" container="container"></ul>')(e);n.append(a)}e.selectCheckboxWrapper=function(){e.obj.selected=!e.obj.selected,e.$emit("expandableTreeItem.selectCheckbox.select",e.obj)},e.selectCheckbox=function(t,n){e.obj.selected=n,e.$emit("expandableTreeItem.selectCheckbox.select",e.obj,t)},e.showNoToggleTreeControl=function(t){return angular.isDefined(t.showNoToggleControl)?t.showNoToggleControl:!e.hasChildren}}}}]),angular.module("Realize.common.gradedStarDirective",["Realize.paths"]).directive("gradedStar",["PATH",function(e){"use strict";return{restrict:"E",templateUrl:e.TEMPLATE_ROOT+"/common/gradedStar/gradedStar.dir.html"}}]),angular.module("RealizeApp").controller("InfoModalCtrl",["$scope","InfoModalService","searchTelemetryUtilitiesService",function(e,t,n){"use strict";e.showBreadcrumbEllipsis=!1,e.hideInfoItem=function(e){return t.hideInfoItem(e)},e.hideInfoItemFromStudent=function(e){return t.hideInfoItemFromStudent(e)},e.hideInfoItemOnLevels=function(){return t.hideInfoItemFromStudent(e.levelsArray)},e.levelsArray=t.createLevelsArray(e.item),e.breadcrumbHandler=function(e,r,s){e&&e.stopPropagation(),n.sendTelemetryEventsFromSearch(e,s,"infoModal"),t.navigateToSourceProgram(r)}}]),angular.module("Realize.common.itemListDirective",["Realize.paths"]).directive("itemList",["PATH",function(e){"use strict";return{scope:{items:"=",showRemoveIcon:"=?"},restrict:"EA",templateUrl:e.TEMPLATE_ROOT+"/common/itemList/itemList.dir.html",link:function(e){angular.isUndefined(e.showRemoveIcon)&&(e.showRemoveIcon=!0),e.removeItem=function(t){e.$emit("itemListDirective.removeItem",t)}}}}]),angular.module("Realize.common.keyboardSupport.keyCodes",[]).constant("KEY_CODES",{TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,CMD_LEFT:91,CMD_RIGHT:92}),angular.module("Realize.common.libs.moment",[]).provider("moment",function(){"use strict";var e=window.moment;if(!e)throw new Error("Third party lib moment.js is required!");this.$get=["$log",function(t){return t.debug("Including momentjs v",e.version),e}]}),angular.module("Realize.common.ltiContentViewerDirective",["Realize.paths"]).directive("rlzLtiContentViewer",["PATH","$timeout","$sce",function(e,t,n){"use strict";return{restrict:"EA",scope:{launchUrl:"@",launchParams:"=",launchInNewWindow:"@?",launchLabel:"@?",launchThumbUrl:"@?",launchThumbAlt:"@?"},templateUrl:[e.TEMPLATE_ROOT,"common","ltiContentViewer","ltiContentViewer.dir.html"].join("/"),link:function(e,r){var s,a=r.find("form.lti-launch-form")[0];e.formFields=Array.isArray(e.launchParams)?e.launchParams:Object.keys(e.launchParams).map(function(t){return{key:t,value:e.launchParams[t]}}),e.$watch("launchUrl",function(t){e.trustedLaunchUrl=n.trustAsResourceUrl(t)}),e.hasThumbnail=""!==(e.launchThumbUrl||""),e.isNewWindowLaunch="true"===(e.launchInNewWindow||"").toLowerCase(),e.isNewWindowLaunch?(a.target="_blank",e.launchLti=function(){a.submit()}):s=t(function(){a.submit()},10),e.$on("$destroy",function(){t.cancel(s)})}}}]),angular.module("Realize.common.mediaQueryService",[]).provider("MediaQuery",function(){"use strict";var e,t={xl:{maxWidth:1200},lg:{maxWidth:979},md:{maxWidth:767},sm:{maxWidth:480},xs:{maxWidth:320}};this.setBreakpoints=function(t){angular.isObject(t)&&!angular.isArray(t)&&(e=angular.copy(t))},this.$get=["$window","$rootScope","$timeout","$log",function(n,r,s,a){function i(e,t){return["(",e.toLowerCase(),"-width: ",t,"px)"].join("")}function o(e){var t,n,r;return angular.isNumber(e.minWidth)&&(t=i("min",e.minWidth)),angular.isNumber(e.maxWidth)&&(n=i("max",e.maxWidth)),r=t||"",angular.isDefined(n)&&(r+=[r.length>0?" and ":"",n].join("")),r}function l(){angular.isDefined(u)&&s.cancel(u),u=s(function(){r.$broadcast("window.breakpoint.change"),u=void 0},20)}function c(t,r){var s,a=t?"min":"max";return angular.isString(r)&&angular.isDefined(e[r])?s=t?e[r].maxWidth:e[r].minWidth:angular.isNumber(r)&&(s=r),s+=t?1:-1,n.matchMedia(i(a,s)).matches}var u,d,m={};return angular.isDefined(e)||(a.warn(["Breakpoints are not defined.","Use the MediaQueryProvider at config time and call setBreakpoints() with your breakpoints.","(i.e. {bigScreen: {minWidth: 1024, maxWidth: 1400} })","Using breakpoints from twitter bootstrap 2.3.2 as default."].join("\n")),e=t),d=Object.keys(e),m.breakpoint={},Object.defineProperties(m,{breakpointNames:{get:function(){return d.reduce(function(e,t){return e[t]=t,e},{})}},currentBreakpoint:{get:function(){for(var t,n=0,r=d.length;r>n;n++){var s=e[d[n]];if(s.mediaQuery.matches){t=angular.copy(s);break}}return t}}}),Object.keys(e).forEach(function(t){var r=e[t];r.mediaQuery=n.matchMedia(o(r)),r.mediaQuery.addListener(l),r.name=t;var s=["is",t[0].toUpperCase(),t.substr(1)].join("");Object.defineProperty(m.breakpoint,s,{get:function(){return e[t].mediaQuery.matches}})}),m.breakpoint.isGreaterThan=c.bind(null,!0),m.breakpoint.isLessThan=c.bind(null,!1),m}]}),angular.module("Realize.common.paginator",["Realize.paths"]).directive("paginator",["$log","RealizeHelpers","PATH",function(e,t,n){"use strict";return{scope:{page:"=",total:"@",limit:"@",range:"@",onPageChange:"&?"},replace:!1,templateUrl:n.TEMPLATE_ROOT+"/common/paginator/paginator.dir.html",controller:["$scope","$element","$attrs",function(e,n,r){function s(e,t,n){var r=1;return t>n&&(r=e-Math.floor(n/2),(n>e||e>t-n)&&(e>t-Math.ceil(n/2)?r=t-n:e<Math.ceil(n/2)&&(r=1))),_.range(r||1,Math.min(r+n,t)+1)}e.setPage=function(n){e.onPageChange?e.onPageChange({page:n}):t.updateParentScopeValue(e,r.page,n),$("html, body").animate({scrollTop:0},0)},e.goFirst=function(){e.setPage(1)},e.goLast=function(){e.setPage(e.totalPages)},e.goNext=function(){e.setPage(e.page+1)},e.goPrevious=function(){e.setPage(e.page-1)},e.$on("paginator.page.changed",function(t,n){e.setPage(n)}),e.$watch("total + page",function(){e.totalPages=parseInt(Math.ceil(e.total/e.limit),10),e.visibleRange=s(e.page,e.totalPages,10)})}]}}]),angular.module("Realize.common.popOverComponent",["Realize.paths"]).directive("realizePopOver",["PATH",function(e){"use strict";return{restrict:"A",templateUrl:e.TEMPLATE_ROOT+"/common/popOverComponent/popOverComponent.dir.html",link:function(e,t,n){function r(e){e.stopPropagation()}function s(){$(u).find(".popover").hide()}function a(){l.hide()}function i(){l.show()}function o(e){var t;e.stopPropagation(),s(),t="0"===n.totalTasks?72:92,i(),l.css("top",c.position().top-t+"px")}var l=t.find(".popover").first(),c=t.prev(),u=n.wrapperDom,d=angular.element(document),m=angular.element(":focusable:not(.target):not(#pageWrap)");"false"===n.recommendation?(e.popOverContent=e.$eval(n.popOverContent),d.on("click touchstart",a),m.on("focus",a),c.on("click focus",o)):(e.recommendation=n.recommendation,e.popOverContent=e.$eval(n.popOverText),i()),l.on("click focus",r),e.close=function(){a()},e.$on("popOverComponent.close",function(){a()}),e.$on("popOverComponent.show",function(){e.popOverContent=e.$eval(n.popOverText),i()}),e.$on("$destroy",function(){d.off("click touchstart",a),m.off("focus",a),c.off("click focus",o),l.off("click focus",r)})}}}]),angular.module("Realize.common.popOverUtils",["Realize.content.constants"]).service("PopOverUtilService",["CONTENT_CONSTANTS","lwcI18nFilter",function(e,t){"use strict";var n=this;n.getPopOverContentForScore=function(n){var r=n.userAssignmentDataList[0].score,s=n.totalTasks;return r===e.FIXED_VALUE_MAX_SCORE?t("assignmentList.popOverMessage.success.message",[s]):t("assignmentList.popOverMessage.failure.message",[s])}}]),angular.module("Realize.quicklinks.qlClick",[]).directive("qlClick",["$parse",function(e){"use strict";return{link:function(t,n,r){var s=e(r.qlClick);n.on("click",function(e){s(t.$parent,{$event:e}),t.$$phase||t.$root.$$phase||t.$apply()})}}}]),angular.module("Realize.quicklinks.quickLink",[]).directive("quickLink",[function(){"use strict";return{template:['<li class="quick-link">','<a aria-label="{{ arialabel }}" aria-relevant="additions" href="javascript://">','<i class="{{ iconClass }}"></i>',"{{ text }}",'<span class="badge" ng-if="hasBadge">{{badgeText}}</span>',"</a>","</li>"].join(""),replace:!0,scope:!0,link:function(e,t,n){var r,s=t.find("a"),a=n.icon||"",i=n.image||"";e.iconClass=a?"icon-"+a:"quicklink-image-"+i,"menu"===t.parent().attr("role")&&s.attr("role","menuitem"),e.badgeText=n.badgeText,e.hasBadge=angular.isDefined(n.badgeText)&&n.badgeText.length>0,n.$observe("badgeText",function(){var t=angular.isDefined(n.badgeText)?n.badgeText.toString():"";e.hasBadge=t.length>0,e.badgeText=t}),n.$observe("href",function(){""!==n.href&&(s.attr("href",n.href),n.target&&s.attr("target",n.target))}),e.hidden=e.$eval(n.ngHide)||angular.isDefined(n.ngShow)?!e.$eval(n.ngShow):!1,e.$watch(n.arialabel,function(t){angular.isDefined(n.arialabel)&&""!==n.arialabel?e.arialabel=t:s.removeAttr("aria-label")}),r=["download"],angular.forEach(r,function(e){t[0].hasAttribute(e)&&n.$observe(e,function(){s.attr(e,n[e])})}),e.$watch(n.text,function(t){e.text=t,n.icon&&a!==n.icon&&(e.iconClass="icon-"+n.icon,a=n.icon)}),e.$watch(n.ngHide,function(n,r){angular.isDefined(n)&&n!==r&&(e.hidden=!!n,t.parent().trigger("quicklinkDisplayChange"))}),e.$watch(n.ngShow,function(n,r){angular.isDefined(n)&&n!==r&&(e.hidden=!n,t.parent().trigger("quicklinkDisplayChange"))}),e.$watch(n.ngIf,function(n,r){angular.isDefined(n)&&n!==r&&(e.hidden=!n,t.parent().trigger("quicklinkDisplayChange"))})}}}]),angular.module("Realize.quicklinks.quickLinkMenu",[]).directive("quickLinkMenu",[function(){"use strict";var e=['<li ng-class="{open: open, dropup: isdropup}">','<a ng-click="toggleClick($event);" class="dropdown-toggle" role="button" dropdown-a11y ','href="javascript://" aria-label="{{ ariaLabelText }}" aria-haspopup="true">','<i class="icon-{{ toggleIcon }}"></i>',"{{ toggleText }}",'<i class="icon-caret-{{ toggleDirection }}"></i>',"</a>",'<ul class="dropdown-menu quick-link-menu-items" role="menu" ','ng-class="{ \'pull-right\': !hasAutoAlign }" ng-style="autoAlignStyle" ng-transclude></ul>',"</li>"].join("");return{template:e,replace:!0,scope:!0,transclude:!0,link:function(e,t,n){var r=e.$eval(n.quickLinkMenu);e.hasAutoAlign=n.hasOwnProperty("autoAlign"),e.toggleIcon=r.icon,e.toggleText=r.text,e.isdropup=e.$eval(n.isdropup),e.toggleDirection=e.isdropup?"up":r.direction,e.ariaLabelText=r.ariaLabelText;var s=function(){var r=$("body").width();if(e.hasAutoAlign)if("right"===n.autoAlign){var s=$(t).offset().left+$(t).innerWidth();e.autoAlignStyle={right:r-s,left:"inherit"}}else e.autoAlignStyle={left:$(t).offset().left,right:"inherit"}};setTimeout(s,100),e.toggleClick=function(e){r.toggleClick&&angular.isFunction(r.toggleClick)&&r.toggleClick.call(null,e)},e.toggleIcon||t.find("> a i:first").remove();var a=t.find(".quick-link-menu-items").children();e.$on("Realize.quicklinks.quickList.collapse",function(){t.after(a),t.hide()}),e.$on("Realize.quicklinks.quickList.expand",function(){t.find(".quick-link-menu-items").append(a),t.css("display","inline-block")}),e.$watch(n.isdropup,function(t,n){angular.isUndefined(t)||angular.isUndefined(n)||(e.isdropup=t,e.toggleDirection=t?"up":"down")})}}}]),angular.module("Realize.quicklinks.quickList",[]).directive("quickList",["$log","$parse","$compile","$timeout","$rootScope",function(e,t,n,r,s){"use strict";return{restrict:"AE",template:'<ul class="quicklinks" ng-transclude></ul>',replace:!0,transclude:!0,scope:!0,controller:["$scope","$element",function(e,t){var n=this;n.$visibleChildCount=0,n.$calcVisibleChildren=function(){n.$visibleChildCount=0,angular.forEach(t.children(".quick-link"),function(e){var t=angular.element(e),r=t.scope();r.hidden===!1&&n.$visibleChildCount++})}}],link:function(e,a,i,o){function l(e){e.stopPropagation()}function c(){var t=$(A);n(t)(e),a.after(t).removeClass("quicklinks").addClass("dropdown-menu").appendTo(t.find("li")),E=!0,e.$broadcast("Realize.quicklinks.quickList.collapse"),t.find(".dropdown-toggle").on("click",l),e.$on("$destroy",function(){t.find(".dropdown-toggle").off("click",l)})}function u(){var e=1.3;return 0===a.children().length||a.innerHeight()<=e*angular.element(a.children()[0]).outerHeight()}function d(){var t,r,s,i;if(!u()){t=angular.element(n(I)(e)),r=t.find(".dropdown-menu"),s=a[0],a.append(t);for(var o=s.children.length-2;o>=0;o--){var c=angular.element(s.children[o]),d=angular.element(c).scope();if(!d.hidden&&(r.prepend(s.children[o]),u()))break}i=t.find(".dropdown-toggle"),i.on("click",l),e.$on("$destroy",function(){i.off("click",l)}),E=!0,e.$broadcast("Realize.quicklinks.quickList.collapse")}}function m(){var e=a.find(".dropdown-menu"),t=a[0],n=t.children[t.children.length-1];"UL"===n.children[0].tagName&&(t.removeChild(n),a.append(e.children())),E=!1}function g(){var t=a.parents("ul.quick-list-dropdown");t.length>0&&(t.after(a),t.remove(),a.removeClass("dropdown-menu").addClass("quicklinks")),E=!1,e.$broadcast("Realize.quicklinks.quickList.expand")}e.menuDirection=e.$eval(i.isdropup)?"dropup":"dropdown";var p,f,h=angular.isDefined(i.e2eId)?' data-e2e-id="'+i.e2eId+'"':"",v=angular.isDefined(i.ngShow)?' ng-show="'+i.ngShow+'"':"",S=angular.isDefined(i.ngHide)?' ng-hide="'+i.ngHide+'"':"",T=angular.isDefined(i.ngIf)?' ng-if="'+i.ngIf+'"':"",A=['<ul class="quick-list-dropdown quicklinks"'+v+S+T+">",'<li dropdown  class="quick-list-dropdown-trigger {{ menuDirection }}"'+h+">",'<a href="javascript://" class="dropdown-toggle" role="button">','<i class="icon-',i.collapsedIcon,'"></i>',i.collapsedLabel,'<i class="{{ caretDirection }}"></i>',"</a>","</li>","</ul>"].join(""),I=['<li class="nested-quicklinks">','<ul class="quick-list-dropdown quicklinks"'+v+S+T+">",'<li dropdown  class="quick-list-dropdown-trigger {{ menuDirection }}"'+h+">",'<a href="javascript://" class="dropdown-toggle" role="button">','<i class="icon-',i.collapsedIcon,'"></i>',i.collapsedLabel,'<i class="{{ caretDirection }}"></i>',"</a>",'<ul class="dropdown-menu"></ul>',"</li>","</ul>","</li>"].join(""),E=!1,y=a.parent().closest("ul"),R=e.$eval(i.dependencyWatch),C=R?50:0;angular.isDefined(i.isMixedMode)&&"thumbnail"!==e.tocView&&(f=r(d,C),e.$on("window.breakpoint.change",function(){E&&m(),d()}),angular.isArray(R)&&angular.forEach(R,function(t){e.$on("quickList."+t+".change",function(){E&&m(),d()})})),angular.isDefined(i.isMixedMode)&&"thumbnail"!==e.tocView&&angular.isUndefined(y.attr("hasQuickListListner"))&&(angular.isArray(R)&&angular.forEach(R,function(t){e.$watch(t,function(n,a){if(n!==a){var i=r(function(){s.$broadcast("quickList."+t+".change",n)},1e3);e.$on("$destroy",function(){r.cancel(i)})}})}),y.attr("hasQuickListListner","")),e.$watch(i.isdropup,function(t,n){angular.isUndefined(t)||angular.isUndefined(n)||(e.menuDirection=t?"dropup":"dropdown",e.caretDirection=t?"icon-caret-up":"icon-caret-down")});var D=function(){var e=t(i.collapsed);o.$calcVisibleChildren(),o.$visibleChildCount<=1?g():e()&&c()};a.on("quicklinkDisplayChange",D),o.$calcVisibleChildren(),"thumbnail"===e.tocView&&(p=r(D,0)),e.$watch(i.collapsed,function(e,t){angular.isUndefined(e)||angular.isUndefined(t)||(o.$calcVisibleChildren(),!E&&e&&o.$visibleChildCount>1?c():E&&g())}),e.$on("$destroy",function(){r.cancel(p),r.cancel(f)})}}}]),angular.module("Realize.quicklinks",["Realize.quicklinks.quickList","Realize.quicklinks.quickLink","Realize.quicklinks.qlClick","Realize.quicklinks.quickLinkMenu"]),angular.module("Realize.common.realizeReaderSelectionIconDirective",["Realize.paths","Realize.constants.mediaType"]).directive("realizeReaderSelectionIcon",["PATH","MEDIA_TYPE",function(e,t){"use strict";return{scope:{item:"=realizeReaderSelectionIcon"},templateUrl:e.TEMPLATE_ROOT+"/common/realizeReaderSelectionIcon/realizeReaderSelectionIcon.dir.html",link:function(e){e.REALIZE_READER_SELECTION=t.REALIZE_READER_SELECTION}}}]),angular.module("Realize.common.resources",["Realize.paths","realize-lib.ui.fallback-strategy"]).directive("resourcesGridView",["PATH",function(e){"use strict";return{restrict:"A",scope:{resources:"=resources",basePath:"@",fallback:"="},templateUrl:e.TEMPLATE_ROOT+"/common/resources/resourcesGridView.dir.html",link:function(e){e.fallbackImageUrl=[e.fallback],e.getImage=function(t){return e.basePath+"/"+e.format(t)+"@2x.png"},e.format=function(e){return e.replace(/\s/g,"_")},e.$on("fallbackStrategy.fallback.applied",function(e,t){t[0].src&&t[0].src.indexOf(e.targetScope.fallback)>-1&&t.parent().addClass("mediaIcon with-tab fallback-applied")}),e.showSelectedResource=function(t,n){t.preventDefault(),t.stopPropagation(),e.$emit("resourcesGridView.facet.filter.triggered",n)}}}}]),angular.module("Realize.slider.sliderDir",[]).directive("slider",["$log","$timeout",function(e,t){"use strict";var n="BR",r="Lexile";
return{replace:!0,templateUrl:"templates/common/slider/slider.dir.html",scope:{scale:"=slider",showTooltip:"=sliderShowTooltip",labelCount:"=?sliderLabelCount",isRange:"=rangeSlider"},link:function(e,s){var a=function(){e.scale.title===r&&(e.selected.start=e.selected.start===n?" "+e.selected.start:e.selected.start,e.selected.end=e.selected.end===n?" "+e.selected.end:e.selected.end)};e.selected=e.scale.selected,e.range=e.scale.values,a(),t(function(){var t,n,r=s.find("select.start"),a=s.find("select.end"),i=e.isRange?r.add(a):r;i.selectToUISlider({labels:e.labelCount||0,tooltip:e.showTooltip,sliderOptions:{change:function(r,s){e.isRange?(t=e.range[s.values[0]],n=e.range[s.values[1]],e.selected.end=n):t=e.range[s.value],e.selected.start=t,e.$apply(),e.$emit("slider.change",e.scale)}}}).hide();var o=e.scale.ticLabelsToDisplay,l=function(){return angular.isDefined(o)&&!_.isEmpty(o)},c=function(){s.find(".ui-slider-label-show").removeClass("ui-slider-label-show")};l()&&(c(),angular.forEach(o,function(e){s.find(".ui-slider-label:contains("+e+"):first").addClass("ui-slider-label-show")}))},0,!1),e.resetSlider=function(){e.selected.start=e.range[0],e.isRange&&(e.selected.end=e.range[e.range.length-1])},e.$on("slider.resetSliderValues",function(){e.resetSlider()})}}}]),angular.module("Realize.slider",["Realize.slider.scale","Realize.slider.sliderDir"]),angular.module("Realize.slider.scale",[]).factory("Scale",[function(){"use strict";function e(){this.values=[],this.selected={start:"",end:""}}return e.prototype.$setScaleValues=function(e){var t=this;return this.values=e,this.selected={start:e[0],end:e[e.length-1]},t},e.prototype.$setSelectedValues=function(e,t){var n=this;return n.selected={start:e,end:t},n},e.prototype.$setTicLabelsToDisplay=function(e){var t=this,n=[];return angular.forEach(e,function(e){angular.isDefined(t.values[e])&&n.push(t.values[e])}),t.ticLabelsToDisplay=n,t},e.prototype.allSelectedValuesEqual=function(){return this.selected.start===this.selected.end},e}]),angular.module("Realize.common.studentNavigation",["Realize.paths"]).directive("studentNavigation",["PATH",function(e){"use strict";return{scope:{studentList:"=",currentStudent:"=?",onAction:"&",labelSelect:"@",hideNavigationButtons:"&?",labelPrev:"@?",labelNext:"@?"},templateUrl:e.TEMPLATE_ROOT+"/common/studentNavigation/studentNavigation.dir.html",controller:function(){var e=this,t=function(e,t){var n=e.indexOf(t);return n>0?n:0},n=function(){e.currentIndex=t(e.studentList,e.currentStudent),e.displayStudent=e.currentStudent?e.currentStudent:e.studentList[e.currentIndex]};e.doAction=function(t){e.displayStudent=t,e.onAction({student:t})},e.select=function(n){e.currentIndex=t(e.studentList,n),e.doAction(e.studentList[e.currentIndex])},e.next=function(){e.currentIndex<e.studentList.length&&(e.currentIndex++,e.doAction(e.studentList[e.currentIndex]))},e.prev=function(){e.currentIndex>0&&(e.currentIndex--,e.doAction(e.studentList[e.currentIndex]))},e.isFirst=function(){return 0===e.currentIndex},e.isLast=function(){return e.currentIndex===e.studentList.length-1},n()},bindToController:!0,controllerAs:"studentNavigationCtrl"}}]),angular.module("Realize.common.teacherIconDirective",["Realize.user.currentUser","rlzComponents.components.i18n","Realize.filters.standardNumber","Realize.paths"]).directive("teacherIcon",["$currentUser","PATH","lwcI18nFilter","standardNumberFilter",function(e,t,n,r){"use strict";return{scope:{item:"=teacherIcon"},templateUrl:t.TEMPLATE_ROOT+"/common/teacherIcon/teacherIcon.dir.html",link:function(t){function s(e){var t=angular.element(e.currentTarget);angular.forEach(angular.element("*[popover]"),function(e){var n=angular.element(e);n.is(t)||n.has(t).length>0||(n.siblings(".popover").remove(),n.scope().tt_isOpen=!1)})}var a=angular.element("body");t.toggle=function(e){s(e),e.stopPropagation()},a.on("click",s),t.isCountsTowardMastery=function(){return e.isTeacher&&t.item.countsTowardMastery},t.isHideFromStudent=function(){return t.item.hideFromStudent&&"Yes"!==t.item.teacherOnly},t.isTeacherOnly=function(){return"Yes"===t.item.teacherOnly},t.getCTMPopoverContent=function(){var e=t.item.standards&&t.item.standards.length>0;if(e){var s,a=[],i=6;return angular.forEach(t.item.standards,function(e){var t=r(e.id);-1===a.indexOf(t)&&a.push(t)}),s=a.sort().slice(0,i).join(", "),n("searchResults.teacherIcon.countsTowardMasteryWithStandards")+"<br>"+s}return n("searchResults.teacherIcon.countsTowardMastery")},t.$on("$destroy",function(){a.off("click",s)})}}}]),angular.module("Realize.common.timeDropdownDirective",["Realize.paths","Realize.common.keyboardSupport.keyCodes","Realize.assignment.constants"]).directive("timeDropdown",["PATH","KEY_CODES","ASSIGNMENT_CONSTANTS","$document",function(e,t,n,r){"use strict";return{require:"^ngModel",scope:!0,link:function(e,s,a,i){var o=s,l=o.attr("name"),c=e.$eval(a.timeDropdown),u=["(2[0-3]|1[0-9]|0[0-9]|[0-9])\\s?(AM|PM)?","([0-9]|0[0-9]|1[0-9]|2[0-3]):\\s?(AM|PM)?","([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-5])","([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-5][0-9])","([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]|[0-5])\\s?(AM|PM)"],d=[],m=function(){o.parent().removeClass("open")},g=function(){return o.parent().hasClass("open")},p=function(e){for(var t,n=!1,r=0;r<d.length;r++)if(t=d[r],t.test(e)){n=!0;break}return i.$setValidity("pattern",n),n},f=function(e){return new Date(e).toDateString()===(new Date).toDateString()},h=function(){for(var t,r,s,a,o,d,m=!1,g=function(e){/:/.test(e)?/:$/.test(e)?e+="00":e=e.replace(/:\d{1}$/,"$&0"):e+=":00";var t=parseInt(e.substring(0,e.indexOf(":")));return t>12?(t=(t-12).toString(),m=!0):0===t&&(t="12"),e=t+e.substring(e.indexOf(":"))},p=u.length-1;p>=0;p--)if(!e.autoCorrected&&(t=u[p],r=i.$viewValue.match(new RegExp(t,"i")),r&&r.length)){s=r[0],e.autoCorrected=!0;break}if(e.autoCorrected){if(new RegExp("\\s?(AM|PM)","i").test(s))a=s.match(new RegExp("\\s?(AM|PM)","i"))[0].trim(),o=s.substring(0,s.indexOf(a)).trim(),d=g(o),a=a.toLowerCase();else if(d=g(s),!c||c&&!f(c))a=m?n.TIMES.PM:n.TIMES.AM;else{var h,v,S,T,A=n.TIMES.AM;v=c+" "+d,h=new Date,S=new Date(v+" "+A),T=new Date(c+" "+n.TIMES.MID_DAY),a=h>S?n.TIMES.PM:S>=T?n.TIMES.PM:A}s=d+" "+a,i.$setViewValue(s),i.$render(),e.autoCorrected=!1,s="",e.isAutoCorrectionRequired=!1,m=!1,e.$emit("time.autocorrected",l)}};e.isValidationRequired=!1,e.autoCorrected=!1,e.isAutoCorrectionRequired=!1,e.$watch(a.timeDropdown,function(t,n){t!==n&&(c=t,p(e.$eval(a.ngModel)))}),angular.forEach(u,function(e){d.push(new RegExp("^[\\D]*"+e+"[\\D]*$","i"))}),o.on("input",function(){m(),e.isValidationRequired=!0}),o.on("keydown",function(n){var r=n.keyCode?n.keyCode:n.which;r===t.TAB&&(g()&&m(),e.isAutoCorrectionRequired&&h()),e.isValidationRequired=!0}),o.on("focusout",function(){!g()&&e.isAutoCorrectionRequired&&h()}),e.$on("time.updated.in.controller",function(t,n){l===n&&(e.isValidationRequired=!1,e.isAutoCorrectionRequired=!1,i.$setValidity("pattern",!0))}),e.$watch(a.ngModel,function(t,n){if(t!==n&&e.isValidationRequired&&!e.autoCorrected){var r=p(t);e.isAutoCorrectionRequired=r,e.isValidationRequired=!1}}),r.on("click",function(){!g()&&e.isAutoCorrectionRequired&&h()})}}}]),angular.module("Realize.common.toolTipSupport.keyboardAccess",[]).directive("keyboardAccess",[function(){"use strict";return function(e,t){t.on("focusin",function(){t.trigger("mouseover")}),t.on("focusout",function(){t.trigger("mouseleave")})}}]),angular.module("Realize.common.tourGuide",["Realize.common.tourGuideStop","Realize.common.tourGuidePopover","ModalServices"]).directive("rlzTourGuide",[function(){"use strict";return{controller:["$scope","Modal",function(e,t){var n,r=this,s="templates/common/tourGuide/tourGuidePopover.html";this.stops=[],this.activeStop=null,this.next=function(){var t=r.activeStop+1;t<=r.stops.length&&(r.activeStop=t,e.$emit("tour:change",{stop:r.activeStop})),e.$emit("tour:next",{stop:r.activeStop})},this.previous=function(){var t=r.activeStop-1;t>0&&(r.activeStop=t,e.$emit("tour:change",{stop:r.activeStop})),e.$emit("tour:previous",{stop:r.activeStop})},this.reset=function(){r.activeStop=null,e.$emit("tour:close",{stop:r.activeStop})},this.start=function(t){r.activeStop=t||1,e.$emit("tour:start",{stop:r.activeStop})},this.addStep=function(e){return r.stops.push(e),e},this.show=function(a,i,o,l,c){n||(n=e.$new(),n.$on("modal:close",function(){n.close()}),n.close=function(){r.reset(),t.hideDialog().then(function(){n.$destroy(),n=null})},t.showDialog(s,n)),n.params={target:a,content:o,step:i,total:r.stops.length,toolTipPosition:l,arrowPosition:c},e.setHighlight(a)}}],controllerAs:"tourGuide",link:function(e,t){e.setHighlight=function(e){t.find(".tour-guide-stop").removeClass("tour-guide-stop"),e&&e.addClass("tour-guide-stop")},e.$watch("tourGuide.activeStop",function(t){t||e.setHighlight()})}}}]),angular.module("Realize.common.tourGuidePopover",[]).directive("rlzTourGuidePopover",[function(){"use strict";return{link:function(e){var t,n;e.position={},e.arrowPosition={},e.$watchCollection(function(){return t=e.params.target,n=t.offset(),e.arrowPosition=e.params.arrowPosition?e.params.arrowPosition:"",e.params.toolTipPosition&&(e.params.toolTipPosition.top&&(n.top=e.params.toolTipPosition.top),e.params.toolTipPosition.left&&(n.left=e.params.toolTipPosition.left)),{top:n.top,left:n.left,height:t.height(),width:t.width()}},function(t){e.position=t})}}}]),angular.module("Realize.common.tourGuideStop",["Realize.common.tourGuide","ModalServices"]).directive("rlzTourGuideStop",[function(){"use strict";return{require:"^rlzTourGuide",scope:{activeStop:"=rlzTourGuideStop",content:"=content",order:"=",target:"@?",toolTipPosition:"<?",arrowPosition:"<?"},link:function(e,t,n,r){r.addStep(e.order),e.$watch("activeStop",function(n){var s=n===e.order,a=e.target?t.find(e.target):t;s&&r.show(a,e.order,e.content,e.toolTipPosition,e.arrowPosition)})}}}]),angular.module("Realize.ui.modal.UnsavedChangesModal",["ModalServices"]).factory("UnsavedChangesModal",["$rootScope","Modal","$log","$location","$q",function(e,t,n,r,s){"use strict";function a(n){if(!n)throw"UnsavedChangesModal: Must define save function.";var a,i,o,l,c,u,d;a=!1,i=s.defer(),o=function(){return a=!0,t.hideDialog()},l=function(){i.resolve(),r.url()!==d&&r.url(d)},c=function(){a=!1,i=s.defer()},u=e.$new(),u.delegate={close:function(){t.hideDialog(),i.reject(),c()},discard:function(){o().then(l)},save:function(){o().then(function(){var e=s.when(n());e.then(l,c)})}},this.showDialog=function(e){return a||(d=r.url(),e&&e.preventDefault(),t.showDialog("templates/partials/unsaved_edit_dialog.html",u)),i.promise},this.reset=function(){c()}}return a}]),angular.module("Realize.recommendation",["Realize.recommendation.facadeService"]),angular.module("Realize.recommendation.facadeService",["Realize.paths"]).factory("RecommendationFacadeService",["$http","$log","$q","PATH",function(e,t,n,r){"use strict";var s={};return s.getUserAssignmentId=function(s,a,i,o){var l=r.REST+"/v2/assignments/userAssignment",c={itemUuid:i.assessmentMapping.equellaItemId,itemVersion:i.assessmentMapping.equellaItemVersion,itemType:i.contentType,classUuid:s,assignmentId:a,languageLocale:o};return e.post(l,c).then(function(e){var n=e.data;return t.log("created userAssignmentId : "+n),n},function(e){return t.error("failed to create userAssignmentId",e),n.reject(e)})},s.sendRecommendationFollowedEvent=function(s,a,i){var o=r.REST+"/recommendations/events/followed",l={classUuid:s,recommendationId:a,recommendedContentId:i};return e.post(o,l).then(function(e){var n=e.data;return t.log("sent RecommendationFollowedEvent : "+n),n},function(e){return t.error("failed to send RecommendationFollowedEvent",e),n.reject(e)})},s.getRecommendation=function(s,a,i){var o=r.REST+"/recommendations",l={classUuid:s,assignmentId:a,isFirstRecommendation:i},c={params:l};return e.get(o,c).then(function(e){var n=e.data;return t.log("getrecommendation success",e),n},function(e){return t.log("getrecommendation failed",e),n.reject(e)})},s.submitRecommendation=function(s,a,i,o,l,c,u){var d=s?"assessment":"instructional",m=r.REST+"/recommendations/"+d+"/complete",g={classUuid:a,assignmentId:i,userAssignmentId:o,recommendedContentId:l},p={params:g};return s&&c&&u&&(g.assessmentSessionId=c,p.headers={"Hub-Session":u}),e.put(m,g,p).then(function(e){var n=e.data;return t.log("submitRecommendation success",n),n},function(e){return t.log("submitRecommendation failed",e),n.reject(e)})},s.submitAssignment=function(s,a,i){var o=r.REST+"/recommendations/assignments/"+a+"/complete",l={classUuid:s,primaryUserAssignmentId:i},c={params:l};return e.put(o,l,c).then(function(e){var n=e.data;return t.log("submitAssignment success",n),n},function(e){return t.log("submitAssignment failed",e),n.reject(e)})},s}]),angular.module("Realize.Discussions.Helpers",["Realize.Discussions.Navigation","Realize.Discussions.Resolve","Realize.Discussions.Token","Realize.Discussions.Participants"]),angular.module("Realize.Discussions.Navigation",[]).service("DiscussNavigation",["$location","$rootScope","$window","$currentUser",function(e,t,n,r){"use strict";var s=this;return s.clearParams=function(){e.search("boardId",null),e.search("postId",null),e.search("view",null),e.search("state",null)},s.goToCreate=function(t){s.clearParams(),e.search("view","create"),t&&e.search("boardId",t)},s.goToList=function(t){s.clearParams(),e.search("view","list"),e.search("boardId",t)},s.goToPost=function(t,n){s.clearParams(),e.search("view","thread"),e.search("boardId",t),e.search("postId",n)},s.back=function(){s.clearParams();var n,r;e.search().discuss?(n=e.path().split("/assignments"),e.path(n[0])):(r="/classes",t.back(r))},s.getWindowLocationOrigin=function(){var e=n.location.port;return n.location.origin?n.location.origin:n.location.protocol+"//"+n.location.hostname+(e?":"+e:"")},s.goToThreadView=function(t,n,r){var s=["/classes",t,"discuss/assignments",n,"content",r].join("/");e.path(s)},s.goToStudentStatusView=function(t,n){var s=["/classes",t,"assignments",n].join("/");r.isTeacher&&(s+="/allstudents"),e.path(s)},s.goToStudentAssignmentList=function(t,n,r,s){e.path("/classes/"+t+"/student/"+n+"/assignments").search({status:r,activeTab:s})},s}]),angular.module("Realize.Discussions.Resolve",["Realize.paths"]).factory("GetMomentLib",["DISCUSSION_UI_DIST_PATH","$q",function(e,t){"use strict";var n=function(){var n=e+"/lib/moment/2.8.3",r=t.defer();return $.ajax({url:n+"/moment.min.js",dataType:"script",cache:!0,success:function(){r.resolve()},error:function(){r.reject()}}),r.promise};return n}]).factory("GetBoardId",["$route","DiscussRestAPIEndpoints","$location","$q","$rootScope",function(e,t,n,r,s){"use strict";var a=function(){var n,r;return n=e.current.params.classId,t.getBoards(n).then(function(e){if(0===e.data.boards.length&&s.currentUser.isTeacher){var a={context:n};return t.createBoard(a).then(function(e){return e.data.id})}return r=e.data.boards[0]&&e.data.boards[0].id?e.data.boards[0].id:null})};return a}]).factory("GetPostForAssignment",["$route","DiscussRestAPIEndpoints",function(e,t){"use strict";var n=function(){var n,r,s,a=[];return n=e.current.params.classId,r=e.current.params.assignmentId,s=e.current.params.itemId,a.push("assign:"+r),a.push("class:"+n),a.push("prompt"),t.getBoardsByExternalIds(a,!0).then(function(e){var t=null;if(e.data.boards.length>0){var n=e.data.boards[0];t=_.find(n.posts,function(e){return e.meta&&e.meta.item&&e.meta.item===s?e:void 0})}return t})};return n}]).factory("GetClassMembers",["$http","$route","REST_PATH",function(e,t,n){"use strict";return function(r){var s=r||t.current.params.classId;return e.get(n+"/class_roster/"+s+"/members").then(function(e){return e.data})}}]).factory("GetPostItem",["Content",function(e){"use strict";return function(t){var n={},r=!0,s=!1,a=!0;return n.contentId=t.meta.item,n.version=t.meta.itemVersion,n.version||(n.version=0),e.get(n,r,s,a)}}]),angular.module("Realize.Discussions.Participants",[]).constant("AVATAR_PATH",window.mediaPath+"/skins/default/images/profile_icons/").service("ParticipantSvc",["rlzMessages","$rootScope","AVATAR_PATH","DISCUSS_INTEGRATION_MESSAGE_LOCATION","BrowserInfo",function(e,t,n,r,s){"use strict";var a=this;return a.getAuthorDisplayName=function(e,t){var n=_.findWhere(t,{userId:e});return angular.isUndefined(n)?"":n.displayName||n.lastName+", "+n.firstName},a.getReplyDisplayName=function(t,n){var s=_.findWhere(n,{userId:t});return angular.isUndefined(s)?e.getMessage(r+"|discussion.thread.postInfo.unknownAuthor"):s.displayName||s.firstName+" "+s.lastName},a.getAuthorAvatarImage=function(e,t){var r=_.findWhere(t,{userId:e}),a=s.isHDDisplay?"@2x.png":".png",i="";return i=angular.isUndefined(r)?"default_student":r.avatar,n+i+a},a}]),angular.module("Realize.Discussions.templates",[]),angular.module("Realize.Discussions.StateManager",["Realize.Discussions.templates","Realize.Discussions.Helpers","Realize.Discussions.States","Realize.classRoster.resolves.getCurrent","Realize.paths","Realize.assignment.facadeService"]).config(["$routeProvider",function(e){"use strict";e.when("/classes/:classId/discussPrompt/assignments/:assignmentId/content/:itemId",{resolve:{Post:["GetPostForAssignment",function(e){return e()}],CurrentRoster:["ClassRosterResolveGetCurrent",function(e){return e()}],LocaleSettings:["DiscussLocale","$rootScope","$window",function(e,t,n){var r=t.currentUser?t.currentUser.getAttribute("profile.locale"):n.currentUser.userAttributes["profile.locale"];return e.loadMessages(r).then(function(){e.updateLocale(r)})}],Assignment:["AssignmentFacadeService","$route",function(e,t){return e.get(t.current.params.classId,t.current.params.assignmentId)}]},template:'<div ng-include="getTemplateUrl()"></div>',controller:"DiscussAppCtrl",reloadOnSearch:!1})}]).controller("DiscussAppCtrl",["$scope","$location","DiscussNavigation","Post","$window","$route","PATH","DISCUSS_INTEGRATION_MESSAGE_LOCATION","DiscussPost","Assignment",function(e,t,n,r,s,a,i,o,l,c){"use strict";var u=this,d=a.current.params.userAssignmentId;if(l.prototype.$isQuickLinksEnabledForModerator=!e.currentUser.isStudent,u.initViewParam=function(e){e?t.search("view",e):t.search("view","list")},u.initBoardIdParam=function(){t.search("boardId",r.boardId)},u.initViewParam("thread"),n.goToPost(r.boardId,r.id),e.post=r,e.isDiscussAssignment=!1,c&&(e.isDiscussAssignment=!0,e.isDiscussAssignmentReviewMode=c.isAssignmentPastDueDate(),e.participantId=e.currentUser.userId,e.currentUser.isStudent&&!d)){var m=c.$findItemMetadata(r.meta.item,e.currentUser.userId);m&&t.search("userAssignmentId",m.userAssignmentId)}t.search("itemVersion",r.meta.itemVersion),e.$on("$locationChangeStart",function(e,t){var r=[n.getWindowLocationOrigin()+i.ROOT,"classes",a.current.params.classId,"discuss","assignments",a.current.params.assignmentId,"content",a.current.params.itemId].join("/"),s=t===r;s&&a.reload()}),e.$on("$destroy",function(){n.clearParams(),t.search("userAssignmentId",null),t.search("itemVersion",null),t.search("discuss",null)}),e.sanitizeCode=function(e){return o+"|"+e},e.getTemplateUrl=function(){var e="";switch(t.search().view){case"create":e=i.TEMPLATE_ROOT+"/discuss/view-states/create/create.html";break;case"list":e=i.TEMPLATE_ROOT+"/discuss/view-states/list/list.html";break;case"thread":e=i.TEMPLATE_ROOT+"/discuss/view-states/thread/thread.html";break;default:e=""}return e}}]),angular.module("Realize.Discussions.States",["Realize.Discussions.Create","Realize.Discussions.List","Realize.Discussions.Thread"]),angular.module("realize-lib.ui.fallback-strategy",[]).directive("fallbackStrategy",["$log",function(e){"use strict";return{restrict:"A",link:function(t,n,r){function s(){var r,s;s=n.attr("src"),a&&a.length>0&&(r=a instanceof Array?a.shift():a),r&&r!==s&&(n.attr("src",r),e.debug("fallbackStrategy: replaced src",s,r)),t.$emit("fallbackStrategy.fallback.applied",n)}var a=[];t.$watch(r.fallbackStrategy,function(e){e&&(a=angular.copy(e)),r.alternate&&a.push(r.alternate)}),r.alternate&&a.push(r.alternate),n.on("error",s),n.one("load",function(){}).each(function(){!this.complete||this.height&&this.width||s()})}}}]),angular.module("Realize.NbcLearn.article",["Realize.paths","Realize.navigationService"]).controller("nbcLearnArticleCtrl",["$scope","$rootScope","$log","NavigationService","NBCArticleData",function(e,t,n,r,s){"use strict";t.hidePlatform=!0,e.showBack=!0,e.embedUrl=s.embedUrl,e.article=s.article,e.back=function(){r.back("/home")}}]),angular.module("Realize.NbcLearn.browse",["Realize.paths","Realize.alerts.alertDirective","RealizeDataServices.ProgramService","Realize.myContent.myContentDataService","ModalServices","rlzComponents.components.i18n","Realize.content.fullscreenPlayer","Realize.navigationService"]).controller("NBCLearnBrowseCtrl",["$scope","$rootScope","$q","$log","$location","$window","ProgramService","MyContent","Modal","NavigationService","REST_PATH",function(e,t,n,r,s,a,i,o,l,c,u){"use strict";function d(e,t){var n={contribSource:"NBC Learn",title:t.title,text:[t.description,"<strong>General Information</strong>","Source: "+t.generalInfo.source,"Creator: "+t.generalInfo.creator,"Air/Publish Date: "+t.generalInfo.airDate,"Event Date: "+t.generalInfo.eventDate,"Resource Type: "+t.generalInfo.resourceType,"Copyright: "+t.generalInfo.copyright,"Copyright Date: "+t.generalInfo.copyrightDate,"Clip Length: "+t.generalInfo.clipLength].join("<br/>"),keywords:t.keywords,fileType:"URL",mediaType:"Video"};o.addContentItemToMyLibrary({url:"http://video?cuecard="+t.cueCardId,json:angular.toJson(n)},e.id).then(function(){g.rlzMyContentUrl=["program",e.id,e.version,"myContent"].join("/"),g.alertDetails={autoClose:!0,type:"success",icon:"ok-sign"},o.setSuccessMsgFlag("link",!0)}).catch(function(n){r.warn("Error persisting NBC Learn item to MyContent",n,t,e.id),g.alertDetails={type:"danger",icon:"exclamation-sign",autoClose:!1}}).finally(function(){g.alertIsSet=!0})}function m(t){var r=e.$new(!0),s=n.defer();return r.close=function(){l.hideDialog().then(function(){s.resolve(),r.$destroy()})},r.programs=t,r.selectedProgram=void 0,r.selectProgram=function(e){r.selectedProgram=e},r.save=function(){l.hideDialog().then(function(){s.resolve(r.selectedProgram),r.$destroy()})},l.showDialog("templates/nbclearn/browse/programSelectModal.html",r),s.promise}t.hidePlatform=!0,e.showBack=!0;var g=this,p=c.previousRoute;g.sourceUrl=u+"/nbc/learn/",g.back=function(){c.back("/home")},g.alertIsSet=!1,g.alertDetails={},g.rlzMyContentProgram=void 0,p&&p.params&&"programId"in p.params&&(g.rlzMyContentProgram={id:p.params.programId,version:p.params.programVersion}),g.rlzMyContentUrl=void 0,g.saveNbcLearnToMyContent=function(e){e.data&&e.data.cueCardId&&(g.rlzMyContentProgram?d(g.rlzMyContentProgram,e.data):i.getAllPrograms().then(function(t){m(t.results).then(function(t){t&&d(t,e.data)})}).catch(function(e){r.warn("Error retrieving all programs for NBC Learn to MyContent integration",e),g.alertDetails={type:"danger",icon:"exclamation-sign",autoClose:!1},g.alertIsSet=!0}))},g.navigateToMyContent=function(){g.rlzMyContentUrl&&s.path(g.rlzMyContentUrl)},a.addEventListener("message",g.saveNbcLearnToMyContent,!1),e.$on("$destroy",function(){a.removeEventListener("message",g.saveNbcLearnToMyContent)})}]),angular.module("Realize.NbcLearn.content.content",["RealizeDataServices","Realize.content.model.contentItem"]).config(["$provide",function(e){"use strict";e.decorator("Content",["$delegate",function(e){function t(e){return angular.isString(e)?e.replace(/ /g,""):e}return e.prototype.$isNbcItem=function(){var e=t(angular.lowercase(this.fileType)),n=t(angular.lowercase(this.contribSource)),r=t(angular.lowercase(this.externalSource));return"nbclearn"===e||"nbclearn"===n||"nbclearn"===r},e}])}]),angular.module("Realize.NbcLearn.content.viewer",["Realize.content.fullscreenPlayer","Realize.reporting.data.TrackingService"]).constant("NOT_APPLICABLE","na").controller("NbcLearnVideoPlayerCtrl",["$scope","$rootScope","content","lwcI18nFilter","$window","TrackingService","$routeParams","NOT_APPLICABLE",function(e,t,n,r,s,a,i,o){"use strict";function l(){a.trackContent(i.classUuid||o,n.id,n.version,i.assignmentId||o,"stops")}function c(){a.trackContent(i.classUuid||o,n.id,n.version,i.assignmentId||o,"starts"),e.$on("$locationChangeStart",l),s.onbeforeunload=function(){e.$apply(l)},e.$on("$destroy",function(){s.onbeforeunload=null})}if(t.hidePlatform=!0,e.showBack=!0,e.back=function(){e.goBack("/home")},e.video={title:n.$getTitle(),url:n.url},c(),!t.isNbcLearnUser()){var u=t.currentUser.isStudent?"student":"teacher";e.$on("fullscreenplayer.loaded",function(){e.$broadcast("fullscreenplayer.notification","info",r("nbc.learn.alert.videoPreview."+u+".title"),r("nbc.learn.alert.videoPreview."+u+".message"))})}}]),angular.module("Realize.NbcLearn.FeedView",["Realize.rss.RssSvc","Realize.paths","Realize.NbcLearn.Constants"]).directive("nbcLearnFeedView",["$log","$location","NBCLEARN_ID","RssSvc",function(e,t,n,r){"use strict";return{scope:{},templateUrl:"templates/nbclearn/home/nbclearn.feedView.dir.html",link:function(e){e.loading=!0,e.more=function(){t.path("/nbclearn/browse")},e.open=function(e,n){t.url("/nbclearn/article/"+n.id)},r.query(n,{start:0,count:4}).then(function(t){e.loading=!1,e.rssItems=t.items})}}}]),angular.module("Realize.reporting.data.DataCtrl",["Realize.reporting.ReportService","Realize.core.security.permissions","Realize.analytics","Realize.filters.pipes","Realize.filters.excludeCurrentUser","Realize.filters.displayFullName","rlzComponents.components.googleClassroom","rlzComponents.components.featureManagement","rlzComponents.components.googleClassroom.constants","Realize.constants.googleClassroom"]).controller("DataCtrl",["$scope","$location","RosterData","AssignmentsCount","ReportService","$log","$rootScope","PATH","Permissions","googleClassroomService","GoogleClassroomConstants","GOOGLE_CLASSROOM","featureManagementService",function(e,t,n,r,s,a,i,o,l,c,u,d,m){"use strict";e.location=t,e.rosters=n,e.assignmentsCount=r;var g=e.currentUser.$getInactiveRosterCount();e.hasHidden=g&&g>0,e.hasVisited=e.currentUser.getAttribute("data.visited"),e.hasPermissionToCreateClass=l.hasPermission("create_class"),e.areAllClassesHidden=e.hasHidden&&e.hasVisited&&0===e.rosters.length,e.showGoogleClassroomIntegration=m.isGoogleClassroomEnabled(),0===e.assignmentsCount&&(i.subnavState="hidden"),s.resetReportFilters(),e.openRoster=function(e,n,r){e&&(e.preventDefault(),e.stopPropagation());var s="/data/"+n.classId;s+="byStandard"===r?"/standards":"/overview",t.path(s)},e.imagePath=o.IMAGES,e.currentUser.setAttribute("data.visited",!0),i.currentUser.isReviewer&&(e.reviewTemplate="templates/partials/reviewer_zero_data.html",e.imagePath=o.IMAGES,e.isReviewer=!0),e.redirectToRealizeSyncWebApp=function(){var e={extensions:{area:d.DATA,page:d.GET_STARTED,product:u.EVENT_TYPE.PROGRAM_NOT_AVAILABLE,description:u.GOOGLE_CONNECT},definition:{name:u.CONNECT_CLASS}};c.redirectToRealizeSyncWebApp(t.absUrl(),u.IMPORT,e)},e.createClass=function(n){n&&(n.preventDefault(),n.stopPropagation()),e.pageLoading(),t.path("/classes/create")},e.isFederatedUserHiddenClassesMessageVisible=e.areAllClassesHidden&&!e.hasPermissionToCreateClass,e.isBasicUserHiddenClassesMessageVisible=e.areAllClassesHidden&&e.hasPermissionToCreateClass}]),angular.module("Realize.reporting.data.DataClassOverviewCtrl",["RealizeDataServices","Realize.common.DateRangeSelector","Realize.reporting.ReportService"]).controller("DataClassOverviewCtrl",["$scope","RosterData","Modal","User","lwcI18nFilter","$routeParams","$rootScope","$log","ReportService","ProgramService","$q","RealizeHelpers","Analytics","ISODateService","REST_PATH","$window","BrowserInfo",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h){"use strict";e.currentRoster=t,e.dateRange={},e.pageLoading(),e.isIDevice=h.isIDevice,e.exportScores=function(){var t=function(t){var n=[p,"classes",e.currentRoster.classId,"grades"].join("/"),s=new Date(e.filters.startDate),a=new Date(e.filters.endDate);n=d.buildUrl(n,{dateRangeFrom:g.toStartOfDayStringWithZone(s),dateRangeTo:g.toStartOfNextDayStringWithZone(a),utcOffset:g.getOffsetFromUTC(),programName:t||""}),r.getCurrentUser().then(function(){f.open(n,"_blank")})};n.simpleDialog(s("resultsByAssignment.exportScores.modalTitle"),s("resultsByAssignment.exportScores.message"),{OK:{title:s("resultsByAssignment.exportScores.action.export"),handler:function(){t(l.currentProgram)},isDefault:!0},CANCEL:{title:s("resultsByAssignment.exportScores.action.cancel")}},{id:"export_scores_modal"})},e.filters=l.getReportFilters()||{program:null},e.$watchCollection("dateRange",function(t){if(o.debug("dateRange: ",t),t.startDate&&t.endDate){var n="MM/DD/YYYY";e.filters.startDate=moment(t.startDate).format(n),e.filters.endDate=moment(t.endDate).format(n)}}),e.reportData={mastery:null,progress:null,usage:null};var v=function(){o.debug("filterUpdate",e.filters),e.filters.endDate&&e.filters.startDate&&(e.pageLoading(),l.setReportFilters(e.filters),u.all([l.getMasteryReport(e.currentRoster.classId,e.filters.startDate,e.filters.endDate),l.getProgressReport(e.currentRoster.classId,e.filters.startDate,e.filters.endDate),l.getUsageReport(e.currentRoster.classId,e.filters.startDate,e.filters.endDate)]).then(function(t){var n=t[0],r=t[1],s=t[2],a=n.programList.concat(r.programList);_.map(a,function(e){return"NO_PROGRAM"===e?null:e}),e.programList=_.uniq(a);var i=$.inArray(e.filters.program,e.programList);-1===i?(e.progIndex=-1,e.reportData.mastery=n,e.reportData.progress=r,e.reportData.usage=s):(e.progIndex=i,e.reportData.mastery=_.filter(n,function(t){return 1===t.programs.length&&t.programs[0]===e.filters.program}),e.reportData.progress=_.filter(r,function(t){return 1===t.programs.length&&t.programs[0]===e.filters.program}),e.reportData.usage=_.filter(s,function(t){return 1===t.programs.length&&t.programs[0]===e.filters.program})),o.log("Report data set to",e.reportData),e.pageLoaded()}))};e.$watch("filters.startDate + filters.endDate",function(e,t){e!==t&&(o.log("Date filter watch",e,t),m.track("track.action",{category:"Data",action:"Change Calendar Range"}),v())}),e.$watch("filters.program",function(e,t){o.log("selectedProgram watch",e,t),l.currentProgram=e,v()}),e.hasReportData=function(){return!(_.isEmpty(e.reportData.mastery)&&_.isEmpty(e.reportData.progress)&&_.isEmpty(e.reportData.usage))},e.back=function(){i.back("/data",!0)}}]),angular.module("Realize.reporting.data.ItemAnalysisCtrl",["ModalServices"]).controller("ItemAnalysisCtrl",["$scope","$routeParams","ReportData","$location","$log","Modal","$window",function(e,t,n,r,s,a,i){"use strict";s.log("ItemAnalysisCtrl Constructor Fired!"),e.scoresMap=[],e.scoresMap=n,i.itemAnalysisV2Enabled||t.itemAnalysisV2?e.isV2Enabled=!0:e.analysisTemplate=e.scoresMap.isPAF?"templates/partials/paf_item_analysis.html":"templates/partials/nativeItemAnalysis.html",e.openDialog=function(t,n,r){if(r.stopPropagation(),r.preventDefault(),0!==n.count){var s=e.$new(!0);s.question=t,s.response=n,s.close=a.hideDialog,a.showDialog("templates/partials/studentInfoDialog.html",s)}},e.back=function(){e.goBack(["/data/",t.classId,"/overview/assignment/",t.assignmentId,"/recap/",t.assessmentId].join(""))},e.showStudentsDialog=function(t,n,r){if(r.stopPropagation(),r.preventDefault(),n.length>0){var s=e.$new(!0);s.status=t,s.students=n,s.close=a.hideDialog,a.showDialog("templates/partials/student_paf_analysis_dialog.html",s)}},e.showCorrectStudents=function(t,n){e.showStudentsDialog("correct",t.studentsCorrect,n)},e.showIncorrectStudents=function(t,n){e.showStudentsDialog("incorrect",t.studentsIncorrect,n)},e.showPartialStudents=function(t,n){e.showStudentsDialog("partial",t.studentsPartial,n)}}]),angular.module("Realize.reporting.data.MasteryCtrl",["RealizeDataServices","Realize.reporting.MasteryByAssignmentService","Realize.reporting.ReportService","Realize.analytics","Realize.common.mediaQueryService","ModalServices","Realize.navigationService","Realize.assignment.constants","Realize.standard.constants","rlzComponents.components.myLibrary.constants","rlzComponents.components.tabs","rlzComponents.routedComponents.itemAnalysis","components.filters","rlzComponents.routedComponents.itemAnalysis.constants","rlzComponents.components.itemAnalysis.itemAnalysisState","rlzComponents.components.itemAnalysis.utilities","rlzComponents.components.sortArrow"]).config(["AnalyticsProvider",function(e){"use strict";
e.addTracker("track.masteryByAssignment",["GoogleAnalytics","AnalyticsEvent",function(e,t){e.trackEvent("Data","Mastery by Assignment",t.label)}])}]).controller("MasteryCtrl",["$scope","$window","$routeParams","TeacherAssignmentData","ClassRosterData","MasteryByAssignmentService","GroupData","$location","$log","Standard","$filter","Analytics","ReportService","MASTERY_THRESHOLD","$rootScope","NavigationService","ReportData","Modal","MediaQuery","cachedTableData","lwcI18nFilter","ITEM_ANALYSIS_CONSTANTS","$timeout","itemAnalysisStateService","itemAnalysisUtilities","AssignmentUtil","breadcrumbTelemetryService","BREADCRUMB_TELEMETRY_CONSTANTS","ASSIGNMENT_CONSTANTS","webStorage","STANDARD_CONSTANTS","MY_LIBRARY_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R,C,D,b,P,w,L,$){"use strict";var O=200;e.locationFallback=["/data/",n.classId,"/overview"].join(""),e.pageLoading(),e.selectedStandardColumn=null,e.locale=e.currentUser.getAttribute("profile.locale")?e.currentUser.getAttribute("profile.locale"):t.systemLang,e.view=n.view,e.standardsList=null,e.tabsConfiguration=[],e.currentTab=0,e.standardTruncationSettings={characterLimit:I.STANDARD_TAB.STANDARD_TRUNCATION.CHARACTER_LIMIT,ellipsisAtBeginning:I.STANDARD_TAB.STANDARD_TRUNCATION.ELLIPSIS_AT_BEGINING},e.isDeepLinked=!1,e.isZeroState=!1,e.lwcI18nFilter=A,e.sortedScoreByDesc=!0,e.sortByScoreLabel=A("masteryRecap.columnHeader.sortScoreLowToHigh"),e.$on("$destroy",function(){l.log("cachedTableData: ",T),T.questions=T.studentsTableData=null});var N={label:"name"},M={label:"score"},k={label:"percentage"};e.HEADER_IDENTIFIER={name:N.label,score:M.label,proficiency:k.label};var z=function(){e.scoresMap=h,t.itemAnalysisV2Enabled||n.itemAnalysisV2?e.isV2Enabled=!0:e.analysisTemplate=e.scoresMap.isPAF?"templates/partials/paf_item_analysis.html":"templates/partials/nativeItemAnalysis.html",e.openDialog=function(t,n,r){if(r.stopPropagation(),r.preventDefault(),0!==n.count){var s=e.$new(!0);s.question=t,s.response=n,s.close=v.hideDialog,v.showDialog("templates/partials/studentInfoDialog.html",s)}},e.showStudentsDialog=function(t,n,r){if(r.stopPropagation(),r.preventDefault(),n.length>0){var s=e.$new(!0);s.status=t,s.students=n,s.close=v.hideDialog,v.showDialog("templates/partials/student_paf_analysis_dialog.html",s)}},e.showCorrectStudents=function(t,n){e.showStudentsDialog("correct",t.studentsCorrect,n)},e.showIncorrectStudents=function(t,n){e.showStudentsDialog("incorrect",t.studentsIncorrect,n)},e.showPartialStudents=function(t,n){e.showStudentsDialog("partial",t.studentsPartial,n)}};z(),e.masteryRecapView=function(e){var t=o.path().split("/").slice(0,-4);t.push(e),t.push(n.filterStartDate),t.push(n.filterEndDate),t.push(n.assignmentIndex),f.replaceLocationWith(t.join("/"))},e.reportParameters={pageNumber:a.getSavedStandardPageNumber(n.classId),pageSize:S.breakpoint.isDesktop?5:3},e.$on("window.breakpoint.change",function(){e.reportParameters.pageSize=S.breakpoint.isDesktop?5:3,S.breakpoint.isDesktop&&e.standardsList.length<=5&&(e.reportParameters.pageNumber=1),e.selectedStandardColumn=null});var U=function(t){e.sortedStandards=[];var n=a.sortStandardsByPercentScore(e.standardsByStudents,t);angular.forEach(n,function(t){angular.forEach(e.standardsList,function(n){n.standardId===t.standardId&&e.sortedStandards.push(n)})})};e.sortByPercentage=function(){e.sortedScoreByDesc=!e.sortedScoreByDesc,e.reportParameters.pageNumber=1,at(),U(e.sortedScoreByDesc),e.standardAssignmentReportPage=a.getReportPage(e.reportParameters.pageNumber,e.reportParameters.pageSize,e.sortedStandards),e.sortByScoreLabel=e.sortedScoreByDesc?A("masteryRecap.columnHeader.sortScoreLowToHigh"):A("masteryRecap.columnHeader.sortScoreHighToLow"),e.selectedStandardColumn=null};var F=function(){var t;q(),e.standardAssignmentReportPage=a.getReportPage(e.reportParameters.pageNumber,e.reportParameters.pageSize,e.standardsList),angular.forEach(e.standardsList,function(n){var r,s={},a=0,i=0;angular.forEach(e.studentsList,function(e){for(t=e.standardsAverageReportList.length-1;t>=0;t--){var r=e.standardsAverageReportList[t];r.standardId===n.standardId&&(s[e.studentId]={standardScore:[r.score.points,r.score.maxPoints].join("/"),standardPercent:V(r.score.points,r.score.maxPoints)},r.score.percentScore>=70&&a++,i++)}}),r=V(a,i),this[n.standardId]={students:s,displayName:n.number,percentScore:r,standardId:n.standardId}},e.standardsByStudents),U(e.sortedScoreByDesc),e.standardAssignmentReportPage=a.getReportPage(e.reportParameters.pageNumber,e.reportParameters.pageSize,e.sortedStandards)};e.isStandardScoredByStudent=function(t,n){var r=e.standardsByStudents[t.standardId];return Boolean(n.score&&r&&r.students[n.studentId]&&r.students[n.studentId].standardScore)};var x=function(){e.sortField.ascending=!1;var t=w.get(L.STANDARD_MASTERY_BY_ASSIGNMENT+"."+e.currentUser.userId+"."+n.classId+"."+e.assessment.assessmentId);e.assignmentFieldPreference=angular.extend(e.assignmentFieldPreference,t),e.assignmentFieldPreference&&(e.assignmentFieldPreference.sortType===L.SORT_TYPE.DESC&&(e.sortField.ascending=!0),e.assignmentFieldPreference.sortField===L.SORT_FIELD.NAME?e.sortField.identifier=L.HEADER_COLUMN_IDENTIFIER.NAME:e.assignmentFieldPreference.sortField===L.SORT_FIELD.SCORE&&(e.sortField.identifier=L.HEADER_COLUMN_IDENTIFIER.SCORE),e.assignmentFieldPreference.standardProficiencySortType===L.SORT_TYPE.ASC&&(e.sortedScoreByDesc=!1)),e.sortByScoreLabel=e.sortedScoreByDesc?A("masteryRecap.columnHeader.sortScoreLowToHigh"):A("masteryRecap.columnHeader.sortScoreHighToLow")},B=function(){var t=m.CONSTANTS.MASTERY_NAME_MAXLENGTH;m.studentMastery(n.classId,e.assessment.assignmentId,e.assessment.assessmentId).then(function(n){e.studentsList=n.data,angular.forEach(e.studentsList,function(n){n.fullName=[n.studentLastName,n.studentFirstName].join(", "),n.fullName.length>t&&(n.ellipsesName=u("ellipses")(n.fullName,t));var r=n.standardsAverageReportList;return r&&r.length?(e.standardsList=e.standardsList?e.getConcatenatedStandardsList(e.standardsList,r):r,void 0):void 0}),e.standardAssignmentReportPage=a.getReportPage(e.reportParameters.pageNumber,e.reportParameters.pageSize,e.standardsList),e.showSorting=e.studentsList.length>1,x();var r=!0;e.sortBy(e.sortField.identifier,r),F()}).finally(function(){e.selectedStandardColumn=null,e.setupTabsConfig();var t=o.search().selectedTab?o.search().selectedTab:0;t=e.tabsConfiguration[0].id!==I.EVENT_TYPE.STANDARD_ANALYSIS&&t>0?t-1:t,e.tabsConfiguration[t].onClick(),e.pageLoaded()})};e.$watchCollection("reportParameters",function(t){e.standardAssignmentReportPage=a.getReportPage(e.reportParameters.pageNumber,e.reportParameters.pageSize,e.sortedStandards);var r=e.standardAssignmentReportPage.endIndex-e.standardAssignmentReportPage.startIndex;e.standardsList&&e.standardAssignmentReportPage&&r===e.reportParameters.pageSize&&(e.standardAssignmentReportPage.pageNumber!==t.pageNumber||e.standardAssignmentReportPage.pageSize!==t.pageSize)&&(a.saveStandardPageNumber(n.classId,e.reportParameters.pageNumber),e.standardAssignmentReportPage=a.getReportPage(t.pageNumber,t.pageSize,e.sortedStandards),e.setSelectedStandardColumn(null))}),e.standardsByStudents={},e.getConcatenatedStandardsList=function(e,t){return _.uniq(t.concat(e),function(e){return e.standardId})};var V=function(e,t){if(0===t)return 0;var n=100*e/t;return Math.round(n)},H={onStandardAnalysisTabClick:function(){R.onStandardAnalysis(e.studentsList.length,e.standardsList.length)},onQuestionTabClick:function(){return y.isQuestionTableInitialized?(e.$broadcast(I.BROADCAST_EVENTS.QUESTION_TAB_CLICKED),void 0):(E(H.onQuestionTabClick,O),void 0)},onStudentTabClick:function(){return y.isStudentTableInitialized?(e.$broadcast(I.BROADCAST_EVENTS.STUDENT_TAB_CLICKED),void 0):(E(H.onStudentTabClick,O),void 0)},onPerformanceTabClick:function(){}};e.setupTabsConfig=function(){e.tabsConfiguration=[];var t='<div ng-if="!isV2Enabled" class="sectionContent scores" ng-include="analysisTemplate"></div>',n={label:A("masteryRecap.itemTabs.mastery"),id:"Standard Analysis",templateUrl:"templates/partials/masteryByAssignmentTab.html",scope:e,onClick:H.onStandardAnalysisTabClick},r={label:A("masteryRecap.itemTabs.question"),id:"Question Analysis",template:t+'<item-analysis view="question"></item-analysis>',scope:e,onClick:H.onQuestionTabClick},s={label:A("masteryRecap.itemTabs.student"),id:"Student Analysis",template:t+'<item-analysis view="student"></item-analysis>',scope:e,onClick:H.onStudentTabClick},a={label:A("masteryRecap.itemTabs.performance"),id:"Performance Analysis",template:t+'<item-analysis students-list="studentsList"" view="performance"></item-analysis>',scope:e,onClick:H.onPerformanceTabClick};e.standardsList&&e.standardsList.length&&e.tabsConfiguration.push(n),e.tabsConfiguration.push(r),e.tabsConfiguration.push(s),e.tabsConfiguration.push(a)},e.setSelectedStandardColumn=function(t){e.selectedStandardColumn!==t?(e.selectedStandardColumn=t,d.track("track.masteryByStandard",{label:"View Standard Details"})):e.selectedStandardColumn=null};var G=function(t){return _.find(e.standardReportPage.list,function(e){return e.standardId===t})};e.studentScoreCssClass=function(e){var t,n,r,s=5,a=e.standardsAverageReportList;return t=_.find(a,function(e){return n=e.score.points.toString().length,r=e.score.maxPoints.toString().length,(n>s||r>s)&&G(e.standardId)}),t?"smallerScores":""},e.pageChange=function(t){e.reportParameters.pageNumber=e.reportParameters.pageNumber+t,e.selectedStandardColumn=null},e.standardScoreCssClass=function(e){var t=e?e.percentScore/100:0;return"color"+(e?g>t?"Fail":"Pass":"Skip")};var j=function(){var t="/data/"+n.classId+"/overview/assignment/"+e.assessment.assignmentId+"/recap/"+e.assessment.assessmentId+"/"+e.view+"/"+n.filterStartDate+"/"+n.filterEndDate+"/"+e.assessmentIndex;f.replaceLocationWith(t)};e.prevAssessment=function(){var t="Previous Assessment",n=e.tabsConfiguration[e.currentTab].id;R.onAssessmentNavigation(e.assessment.programHierarchy,t,n),e.assessment=e.assessments[--e.assessmentIndex],j()},e.nextAssessment=function(){var t="Next Assessment",n=e.tabsConfiguration[e.currentTab].id;R.onAssessmentNavigation(e.assessment.programHierarchy,t,n),e.assessment=e.assessments[++e.assessmentIndex],j()},e.backNavigation=function(){if(!e.isZeroState){var t=e.tabsConfiguration[e.currentTab].id;R.onBackNavigation(e.assessment.programHierarchy,t)}e.isDeepLinked?e.back(w.get(P.DEEP_LINKED_URL),!0):e.back(e.locationFallback,!0)};var q=function(){m.averageMastery(n.classId,e.assessment.assignmentId,e.assessment.assessmentId).then(function(t){e.standardsListForResource=t.data})};e.loadItemAnalysis=function(){o.path(["/data/",n.classId,"/overview/assignment/",n.assignmentId,"/assessment/",e.assessment.assessmentId,"/scoreSummary"].join(""))},e.search=function(t){l.log("searching now",m),p.searchResultsTitle=m.currentProgram,e.keyStore.set("assessmentLanguage",e.selectedAssignment.contentItem.language),o.path("/search/standard/"+c.urlEncode(t.fullTerm))},e.percentScore=function(e){if(0===e.totalQuestions)return 0;var t=100*e.score.points/e.score.maxPoints;return Math.round(t)},e.averageScore=function(){if(!e.studentsList)return Math.round(e.scoresMap.classAverageScore);for(var t=0,n=0,r=0;r<e.studentsList.length;r++)null!==e.studentsList[r].score&&(n+=e.studentsList[r].score.percentScore,t++);var s=0===t?"-":n/t;return isNaN(s)?Math.round(e.scoresMap.classAverageScore):Math.round(s)},e.selectedAssignment=r;var Y=e.selectedAssignment.$getAssigneesName(s,i);e.selectedAssignment.assigneeList=[].concat(Y.classes,Y.groups,Y.students);var W=function(e){var t=C.getAssignmentWithProgramHierarchy(e);return t.breadcrumb||[]},K=function(t,n){var r=!1;n&&n.contentItems&&_.each(n.contentItems,function(n){if(n.id===t)e.requiredItem=n,r=!0;else if(!r&&n.mediaType===$.LEARNING_MODEL)return K(t,n)})},Q=function(t,n){return K(t,n),e.requiredItem};e.programHierarchy=W(e.selectedAssignment),e.assigneeCommaSeparatedList=e.selectedAssignment.assigneeList.join(" | "),e.assignmentFieldPreference={sortField:L.HEADER_COLUMN_IDENTIFIER.NAME,sortType:L.SORT_TYPE.ASC,standardProficiencySortType:L.SORT_TYPE.DESC};var X=function(){if(e.assessments=m.masteryReportList,angular.isDefined(n.assignmentIndex))e.assessmentIndex=n.assignmentIndex;else{for(var t=0;t<e.assessments.length;t++)if(e.assessments[t].assessmentId===n.assessmentId&&e.assessments[t].assignmentId===n.assignmentId){e.assessmentIndex=t;break}p.subnavState="hidden",e.isDeepLinked=!0}if(e.assessment=e.assessments[e.assessmentIndex],e.assessmentIndexlength=e.assessments.length-1,e.getSearchTitle=function(){var t,r;return e.assessment?(t=e.assessment.assignmentDueDate,r=e.assessment.assessmentTitle):(t=Date.parse(e.selectedAssignment.dueDateLegible).toString("MM/dd/yy"),r=e.selectedAssignment.hasManualScore&&0===e.selectedAssignment.contentItem.contentItems.length?e.selectedAssignment.contentItem.title:Q(n.itemUuid,e.selectedAssignment.contentItem).title),[t,r].join(": ")},!e.assessment&&e.assessmentIndex)return e.back(e.locationFallback);if(!e.assessment&&!e.assessmentIndex)return e.isZeroState=!0,e.pageLoaded(),void 0;var r=Date.parse(e.assessment.assignmentDueDate),s=Date.today().isBefore(r)&&e.assessment.beforeDueDate!==!1;e.assessment.beforeDueDate=s,e.assessment.assignmentDueDate=r.toString("MM/dd/yy"),e.$watch("view",function(){"student"===e.view&&B()})},Z=function(){for(var e=!1,t=0;t<m.masteryReportList.length;t++)if(m.masteryReportList[t].assessmentId===n.assessmentId&&m.masteryReportList[t].assignmentId===n.assignmentId){e=!0;break}return e};if(m.masteryReportList.length&&Z())X();else{var J,et;n.filterStartDate&&n.filterEndDate?(J=n.filterStartDate.replace(/-/g,"/"),et=n.filterEndDate.replace(/-/g,"/")):(J=Date.today().addMonths(-1).toString("MM/dd/yyyy"),et=Date.today().addMonths(1).toString("MM/dd/yyyy")),m.getMasteryReport(n.classId,J,et).then(function(){X()})}e.breadcrumbHandler=function(t,n){t.stopPropagation();var r=t.currentTarget.text,s=e.tabsConfiguration[e.currentTab].id,a=s.replace(/ /g,"_").toUpperCase(),i={page:b.PAGE.CLASS_RESULTS_BY_ASSIGNMENT,subpage:I.EVENT_TYPE[a],area:b.AREA.DATA};D.sendTelemetryEvents(r,e.programHierarchy,i),C.navigateToSourceProgram(n)},e.shouldDisplay={standardsPaginationArrow:{left:function(){return e.standardAssignmentReportPage.pageNumber>1},right:function(){return e.standardAssignmentReportPage.pageNumber<e.standardAssignmentReportPage.totalPages}}},e.sortField={identifier:e.HEADER_IDENTIFIER.name,ascending:!1,standardIndex:-1},e.sortBy=function(t,n){return t===e.sortField.identifier?e.sortField.ascending=!e.sortField.ascending:(e.sortField.identifier=t,e.sortField.ascending=!0),n||at(e.sortField.identifier),e.sortData(e.studentsList)},e.sortData=function(t){e.studentsList=t.sort(function(t,n){var r;switch(e.sortField.identifier){case e.HEADER_IDENTIFIER.name:r=a.nameComparator(t,n);break;case e.HEADER_IDENTIFIER.score:r=a.scoreComparator(t,n,e.sortField.ascending);break;default:r=0}return r}),e.sortField.ascending||e.studentsList.reverse()};var tt=function(t){return Number(t)===e.sortField.standardIndex},nt=function(t,n){return angular.isDefined(n)?tt(+n):e.sortField.identifier===t},rt=function(t,n){return e.sortField.ascending&&nt(t,n)},st=function(t,n){return!e.sortField.ascending&&nt(t,n)};e.getDirection=function(e){return st(e)?L.DIRECTION.UP:rt(e)?L.DIRECTION.DOWN:L.DIRECTION.DEFAULT},e.indexForNonStandardColumn=-1,e.getAriaSortTitle=function(t,n){var r=[];return t===e.HEADER_IDENTIFIER.name?r.push(A("masteryRecap.columnHeader.name")):t===e.HEADER_IDENTIFIER.score?r.push(A("masteryRecap.columnHeader.score")):t===e.HEADER_IDENTIFIER.proficiency&&r.push(e.sortByScoreLabel),r.push(A("teacherItemAnalysis.sorting.sortableColumn")),t===e.sortField.identifier&&n===e.sortField.standardIndex?e.sortField.ascending?(r.push(A("masteryByStandard.sorting.sortedAscending")),r.push(A("masteryByStandard.sorting.activateDescending"))):(r.push(A("masteryByStandard.sorting.sortedDescending")),r.push(A("masteryByStandard.sorting.activateAscending"))):t===e.HEADER_IDENTIFIER.proficiency?e.sortedScoreByDesc?(r.push(A("masteryByStandard.sorting.sortedDescending")),r.push(A("masteryByStandard.sorting.activateAscending"))):(r.push(A("masteryByStandard.sorting.sortedAscending")),r.push(A("masteryByStandard.sorting.activateDescending"))):r.push(A("masteryByStandard.sorting.activateAscending")),r.join(", ")};var at=function(t){t?(e.assignmentFieldPreference.sortType=L.SORT_TYPE.DESC,e.sortField.ascending&&e.sortField.identifier===t&&(e.assignmentFieldPreference.sortType=L.SORT_TYPE.ASC),t===L.HEADER_COLUMN_IDENTIFIER.NAME?e.assignmentFieldPreference.sortField=L.SORT_FIELD.NAME:t===L.HEADER_COLUMN_IDENTIFIER.SCORE&&(e.assignmentFieldPreference.sortField=L.SORT_FIELD.SCORE)):(e.assignmentFieldPreference.standardProficiencySortType=L.SORT_TYPE.DESC,e.sortedScoreByDesc||(e.assignmentFieldPreference.standardProficiencySortType=L.SORT_TYPE.ASC)),w.add(L.STANDARD_MASTERY_BY_ASSIGNMENT+"."+e.currentUser.userId+"."+n.classId+"."+e.assessment.assessmentId,e.assignmentFieldPreference)}}]),angular.module("Realize.reporting.MasteryByAssignmentService",[]).service("MasteryByAssignmentService",function(){"use strict";var e,t,n=this;n.getReportPage=function(e,t,n){n=n||[];var r,s=(e-1)*t,a=s+t;a>n.length&&(a=n.length),r=n.slice(s,a);var i=a-s,o=t-i,l=a-(o+i);return 0>l&&(l=0),i!==t&&(s=l,r=n.slice(s,a)),{startIndex:s,endIndex:a,total:n.length,totalPages:Math.ceil(n.length/t),pageNumber:e,pageSize:t,list:r}},n.saveStandardPageNumber=function(n,r){t=r,e=n},n.getSavedStandardPageNumber=function(n){return e===n?t:(this.saveStandardPageNumber(n,1),1)},n.nameComparator=function(e,t){return angular.lowercase(e.fullName)<angular.lowercase(t.fullName)?-1:1},n.scoreComparator=function(e,t,n){var r,s=e.score?e.score.percentScore:-1,a=t.score?t.score.percentScore:-1;return r=n&&s===a?angular.lowercase(e.fullName)<angular.lowercase(t.fullName)?-1:1:n||s!==a?a>s?-1:1:angular.lowercase(e.fullName)>angular.lowercase(t.fullName)?-1:1},n.sortStandardsByPercentScore=function(e,t){var n=_.sortBy(e,"percentScore","standardId");return t?n.reverse():n}}),angular.module("Realize.reporting.data.masteryStandardPointer",[]).directive("masteryStandardPointer",[function(){"use strict";return{restrict:"A",scope:{standard:"=masteryStandardPointer",parentSelector:"@parentSelector",columnSelector:"@columnSelector"},link:function(e,t){var n,r,s,a={left:0},i=angular.element(e.parentSelector),o=i.outerWidth()+(i.offset()||a).left,l=t.outerWidth()/2+2;e.$watch("standard",function(i){setTimeout(function(){i&&(n=angular.element(e.columnSelector),r=(n.offset()||a).left,s=o-r,t.css("right",Math.floor(s-n.outerWidth()/2-l)))},0)})}}}]),angular.module("Realize.reporting.data.ProgressCtrl",["RealizeDataServices","Realize.reporting.ReportService","Realize.common.popOverUtils","Realize.common.popOverComponent"]).controller("ProgressCtrl",["$scope","$routeParams","TeacherAssignmentData","ClassRosterData","GroupData","$location","$log","$filter","ReportService","AssignmentFacadeService","PopOverUtilService","AssignmentUtil","breadcrumbTelemetryService","BREADCRUMB_TELEMETRY_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g){"use strict";e.back=function(){a.path(["/data/",t.classId,"/overview"].join(""))},e.pageLoading();var p=function(){var n=a.path().split("/assignment")[0],r=[n,"assignment",e.assignment.assignmentId,"progress/recap",t.filterStartDate,t.filterEndDate,e.assignmentIndex].join("/");a.path(r),i.log("here after location change")};e.prevAssignment=function(){e.assignmentIndex--,e.assignment=e.assignments[e.assignmentIndex],p()},e.nextAssignment=function(){e.assignmentIndex++,e.assignment=e.assignments[e.assignmentIndex],p()},e.selectedAssignment=n;var f=e.selectedAssignment.$getAssigneesName(r,s);e.selectedAssignment.assigneeList=[].concat(f.classes,f.groups,f.students);var h=function(e){var t=d.getAssignmentWithProgramHierarchy(e);return t.breadcrumb||[]};e.programHierarchy=h(n),e.assigneeCommaSeparatedList=e.selectedAssignment.assigneeList.join(" | ");var v=function(){var n=l.CONSTANTS.RECAP.ELLIPSES_NAME;l.getStudentProgress(t.classId,t.assignmentId).then(function(r){var s=new Date(r.data.assignmentDueDate);return e.progressData=r.data,e.progressData.assignmentDueDate=s,e.beforeDueDateWarningVisible=Date.today().isBefore(s),e.progressData.classUuids=[],e.progressData.groupUuids=[],e.progressData.studentUuids=[],angular.forEach(e.progressData.studentsProgress,function(e){if(e.isComplete="completed"===e.viewedStatus&&!!e.completedDate,e.isComplete)e.completedDate=new Date(e.completedDate),e.isPastDue=e.completedDate.isAfter(s);else{var t=new Date;e.isPastDue=t.isAfter(s)}e.fullName.length>n&&(e.ellipsesName=o("ellipses")(e.fullName,n))}),angular.forEach(e.progressData.assignedTo,function(t){t.classUuid&&$.inArray(t.classUuid,e.progressData.classUuids)<0&&!t.groupUuid&&!t.studentUuid?e.progressData.classUuids.push(t.classUuid):t.groupUuid&&$.inArray(t.groupUuid,e.progressData.groupUuids)<0?e.progressData.groupUuids.push(t.groupUuid):t.studentUuid&&$.inArray(t.studentUuid,e.progressData.studentUuids)<0&&e.progressData.studentUuids.push(t.studentUuid)}),e.assignments=l.progressReportList,e.assignmentIndex=t.assignmentIndex,e.assignment=e.assignments[e.assignmentIndex],e.assignments?void 0:e.back(e.locationFallback)}).finally(function(){e.pageLoaded()})};if(e.setStudentDataForAdaptive=function(t){var n=e.selectedAssignment.$getPrimaryMetadata(t.studentId);t.userAssignmentDataList=n.userAssignmentDataList,t.correctTasks=n.correctTasks,t.totalTasks=n.totalTasks},e.getPopOverContentForScore=function(e){return u.getPopOverContentForScore(e)},e.isPassed=function(e){return 5===e.userAssignmentDataList[0].score},l.progressReportList.length)v();else{var S,T;t.filterStartDate&&t.filterEndDate?(S=t.filterStartDate.replace(/-/g,"/"),T=t.filterEndDate.replace(/-/g,"/")):(S=Date.today().addMonths(-1).toString("MM/dd/yyyy"),T=Date.today().addMonths(1).toString("MM/dd/yyyy")),l.getProgressReport(t.classId,S,T).then(function(){v()})}var A=e.selectedAssignment.$isLesson();e.displayManualScoreMsg=function(t){if("completed"!==t.viewedStatus)return!1;if(A){var n=e.selectedAssignment.$getCompletedManualScoreTestsByStudentId(t.studentId);return 0===n.length?!1:(_.each(n,function(e){angular.extend(e,c.computeScoreStatus(e))}),_.findWhere(n,{isNotScored:!0})?"notScored":_.findWhere(n,{isScoreSent:!1})?"notSent":!1)}var r=e.selectedAssignment.contentItem,s=r.id;if(!s||!r.$isTest())return!1;var a=e.selectedAssignment.$findItemMetadata(s,t.studentId),i=c.computeScoreStatus(a);return!i.isManualScore||i.isScoreSent?!1:i.isNotScored?"notScored":i.isScoreSent?void 0:"notSent"},e.displayScore=function(t){var n=e.selectedAssignment.$getPrimaryMetadata(t.studentId),r=c.hasScoreSourceManual(n);return!e.displayManualScoreMsg(t)&&("completed"===t.viewedStatus||r)&&null!==t.score},e.displayDash=function(t){var n=e.selectedAssignment.$getPrimaryMetadata(t.studentId),r=c.hasScoreSourceManual(n);return"completed"!==t.viewedStatus&&!r||!e.displayManualScoreMsg(t)&&null===t.score},e.breadcrumbHandler=function(t,n){t.stopPropagation();var r=t.currentTarget.text,s={page:g.PAGE.CLASS_RESULTS_BY_ASSIGNMENT,subpage:g.SUBPAGE.PROGRESS,area:g.AREA.DATA};m.sendTelemetryEvents(r,e.programHierarchy,s),d.navigateToSourceProgram(n)}}]),angular.module("Realize.reporting.data.UsageRecapCtrl",["Realize.reporting.data.TrackingService","Realize.reporting.ReportService","Realize.reporting.friendlyTime","Realize.reporting.friendlyTimeFilter","RealizeDataServices"]).controller("UsageRecapCtrl",["$scope","$q","$log","$routeParams","$location","RealizeHelpers","ReportService","TeacherAssignmentData","ClassRosterData","GroupData","AssignmentUtil","breadcrumbTelemetryService","BREADCRUMB_TELEMETRY_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d,m){"use strict";e.back=function(){s.path(["/data/",r.classId,"/overview"].join(""))},e.pageLoading();var g=function(t){e.assignment=e.assignments[t],e.assignmentIndex=t;var n=s.path().split("/assignment")[0],i=[n,"assignment",e.assignment.assignmentId,"usage/recap",r.filterStartDate,r.filterEndDate,e.assignmentIndex].join("/"),o=s.search();o=_.isEmpty(o)?null:o,s.path(a.buildUrl(i),o)};e.prevAssignment=function(){g(Number(e.assignmentIndex)-1)},e.nextAssignment=function(){g(Number(e.assignmentIndex)+1)},e.selectedAssignment=o;var p=e.selectedAssignment.$getAssigneesName(l,c);e.selectedAssignment.assigneeList=[].concat(p.classes,p.groups,p.students);var f=function(e){var t=u.getAssignmentWithProgramHierarchy(e);return t.breadcrumb||[]};e.programHierarchy=f(e.selectedAssignment),e.assigneeCommaSeparatedList=e.selectedAssignment.assigneeList.join(" | ");var h=function(e){if(!e)return null;var t=new Date(e);return angular.isDate(t)?t:(t=Date.parse(e),angular.isDate(t)?t:null)},v=function(){i.getStudentUsage(r.classId,r.assignmentId).then(function(t){var n=t.data;return n.assignmentDueDate=h(n.assignmentDueDate),e.usageData=n,e.usageData.classUuids=[],e.usageData.groupUuids=[],e.usageData.studentUuids=[],e.assignments=i.usageReportList,e.assignmentIndex=r.assignmentIndex,e.assignment=e.assignments[e.assignmentIndex],e.assignments?void 0:e.back(e.locationFallback)}).finally(function(){e.pageLoaded()})};if(i.usageReportList.length)v();else{var S,T;r.filterStartDate&&r.filterEndDate?(S=r.filterStartDate.replace(/-/g,"/"),T=r.filterEndDate.replace(/-/g,"/")):(S=Date.today().addMonths(-1).toString("MM/dd/yyyy"),T=Date.today().addMonths(1).toString("MM/dd/yyyy")),i.getUsageReport(r.classId,S,T).then(function(){v()})}e.breadcrumbHandler=function(t,n){t.stopPropagation();var r=t.currentTarget.text,s={page:m.PAGE.CLASS_RESULTS_BY_ASSIGNMENT,subpage:m.SUBPAGE.USAGE,area:m.AREA.DATA};d.sendTelemetryEvents(r,e.programHierarchy,s),u.navigateToSourceProgram(n)},n.log("progress control scope",e)}]),angular.module("Realize.reporting.data.TrackingService",["Realize.paths","Realize.heartbeat.contentViewerTrackingService"]).factory("TrackingService",["$log","$http","REST_PATH","heartbeatContentViewerService",function(e,t,n,r){"use strict";var s={};return s.trackContent=function(s,a,i,o,l,c){var u,d;return s&&o?(d=c||{},u=t({method:"POST",url:[n,"classes",s,"assignment",o,"contents",a,i,"tracking",l].join("/"),data:{},params:d,cache:!1}),u.success(function(t){return window.isEarlyLearner&&"stops"===l?(e.info("Heartbeat content close call delegated to early learner"),t):(r.sendHeartbeatTrackingEvent(s,a,i,o,l,d.userAssignmentId,d.lmsName),void 0)}),u):(e.warn("cannot track content usage"),void 0)},s}]),angular.module("Realize.reporting.grades.GradesHomeCtrl",["Realize.reporting.ReportService"]).controller("GradesHomeCtrl",["$q","$scope","RosterData","ReportService","$log","$location",function(e,t,n,r,s,a){"use strict";t.rosters=n,r.resetReportFilters(),t.openRoster=function(e,t){e&&(e.preventDefault(),e.stopPropagation()),a.path([a.path(),t.classId,"overview"].join("/"))}}]),angular.module("Realize.reporting.grades.GradesOverviewCtrl",["RealizeDataServices","Realize.analytics","Realize.reporting.ReportService","Realize.content.constants"]).controller("GradesOverviewCtrl",["$q","$scope","RosterData","$log","$location","CountClasses","ReportService","lwcI18nFilter","CODE_ASSIGNMENT_HAS_NO_PROGRAM","$timeout","Analytics","CONTENT_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d){"use strict";t.currentRoster=n,t.classesCount=a,t.startDateOptions=i.startDateOptions,t.dueDateOptions=i.dueDateOptions,t.$watch("filters.endDate",function(e){t.startDateOptions.maxDate=new Date(e)}),t.$watch("filters.startDate",function(e){t.dueDateOptions.minDate=new Date(e)});var m={};t.noAssignmentInSelectedClass=function(){return angular.isString(t.zeroStateCode)&&"noAssignmentsInSelectedClass"===t.zeroStateCode},t.noAssessmentInSelectedClass=function(){return angular.isString(t.zeroStateCode)&&"noCompletedAssessmentsInSelectedClass"===t.zeroStateCode},t.gotoPrograms=function(){s.path("/program")},t.filters=i.getReportFilters()?i.getReportFilters():{startDate:Date.today().addMonths(-1).toString("MM/dd/yyyy"),endDate:Date.today().toString("MM/dd/yyyy"),program:null},t.reportData={studentAssessment:null,studentProgress:null},t.zeroStateCode=null,angular.element("#filterDateStart").focus(function(){$(this).attr("aria-expanded",!0)}).focusout(function(){$(this).attr("aria-expanded",!1)}),angular.element("#filterDateEnd").focus(function(){$(this).attr("aria-expanded",!0)}).focusout(function(){$(this).attr("aria-expanded",!1)});var g=function(){return i.getStudentTestReport(t.currentRoster.classId,t.currentUser.userId,t.filters.startDate,t.filters.endDate).then(function(e){var n=e.data;if(angular.isArray(n.programList)){angular.isArray(t.programList)||(t.programList=n.programList);var s=_.indexOf(t.programList,t.filters.program),a=[];angular.forEach(n,function(e){e.assignmentType!==d.MEDIA_TYPE.ADAPTIVE&&a.push(e)}),t.reportData.studentAssessment=-1===s?a:_.filter(a,function(e){return 1===e.programs.length&&e.programs[0]===t.filters.program})}else t.reportData.studentAssessment=[];r.log("grade test report data set "+t.reportData.studentAssessment)},function(e){return t.reportData.studentAssessment=[],e})},p=function(){return i.getStudentProgressReportForStudent(t.currentRoster.classId,t.filters.startDate,t.filters.endDate).then(function(e){t.programList=e.data.programList,t.progIndex=e.data.programFilterIndex,t.reportData.studentProgress=e.data.studentProgress,r.log("grade progress report data set "+t.reportData.studentProgress)},function(e){return t.reportData.studentProgress=[],e})},f=function(){c(function(){t.pageLoaded()},500)},h=function(){if(!angular.equals(t.filters,m)){t.pageLoading(),angular.copy(t.filters,m),t.zeroStateCode=null,i.setReportFilters(t.filters);var n=e.all({test:g(),progress:p()});n.then(function(e){e.progress&&200!==e.progress.status&&(t.zeroStateCode=e.progress.data.errorCode),f()},function(e){r.error("failed to extract progress and test report "),angular.isDefined(e.status)?(t.zeroStateCode=e.data.errorCode,r.error("zeroStateCode: ",t.zeroStateCode)):r.error("progress report error code not found..."),f()})}};t.$watch("filters.startDate + filters.endDate",function(e,t){e!==t&&(r.log("Date filter watch",e,t),u.track("track.action",{category:"Grades",action:"Change Calendar Range"}),h())}),t.$watch("filters.program",function(e,t){r.log("filter program watch",e,t),i.currentProgram=e,h()}),t.getCurrentProgramName=function(){if(angular.isArray(t.programList)){if(-1===t.progIndex)return o("grades.overview.filter.options.allPrograms");var e=t.programList[t.progIndex];return e}return""},t.getProgramName=function(e){return e===l?o("grades.overview.filter.options.emptyProgramName"):e},t.$on("a11yDateRange.date.selected",function(e,n){t.filters=n,h()}),t.back=function(){var e=t.classesCount<2?"/":"/grades";t.goBack(e,!0)}}]),angular.module("Realize.reporting.grades.StudentItemAnalysisCtrl",["Realize.reporting.grades.StudentItemAnalysisSvc"]).controller("StudentItemAnalysisCtrl",["$log","$scope","$rootScope","$routeParams","$location","ItemAnalysis","Summary","RosterData","UserAssignmentData","StudentItemAnalysisSvc",function(e,t,n,r,s,a,i,o,l,c){"use strict";var u;t.itemAnalysis=a,t.summary=i,t.scoreSent=!!l.scoreSent,t.currentRoster=o,t.sessionId=r.sessionId,t.navigationFallback=s.path().split("/assignment")[0],t.itemAnalysis.assessments&&0!==t.itemAnalysis.assessments.length||(e.error("No assessments found",t.itemAnalysis),t.goBack(t.navigationFallback)),u=0,angular.forEach(t.itemAnalysis.assessments,function(e){e.assessmentSessionId===r.sessionId&&(t.assessmentIndex=u),u++}),t.score=c.calculateScore(t.itemAnalysis.current.score),t.assessmentTitle=t.itemAnalysis.current.assessment.assetTitle,t.isPAF=c.isPaf(t.itemAnalysis),t.questionData=c.getFormattedQuestionData(t.itemAnalysis),t.prevAssessment=function(){var e=Math.max(0,t.assessmentIndex-1);c.switchAssessment(t.itemAnalysis,e)
},t.nextAssessment=function(){var e=Math.min(t.itemAnalysis.assessments.length,t.assessmentIndex+1);c.switchAssessment(t.itemAnalysis,e)},t.back=function(){var e,n=s.path().split("/assignment");n.pop(),e=n.join("/assignment"),t.goBack(e,!0)}}]),angular.module("Realize.reporting.grades.StudentItemAnalysisSvc",["Realize.constants.questionType"]).service("StudentItemAnalysisSvc",["$location","$routeParams","QUESTION_TYPE",function(e,t,n){"use strict";this.positionToLabel=function(e){var t="A".charCodeAt()+e;return String.fromCharCode(t)},this.calculateScore=function(e){return 0===e.maxPoints?100:Math.round(100*e.points/e.maxPoints)},this.switchAssessment=function(n,r){var s,a,i,o;s=n.assessments[r],s&&s.assessmentSessionId&&(a=s.assessmentSessionId,i=e.path().split("/assessments")[0],o=[i,"assessments",a,t.filterStartDate,t.filterEndDate,r].join("/"),e.path(o))},this.isPaf=function(e){var t=e.current.questionResponseDefinitions,r=_.filter(t,function(e){return e.question.questionType!==n.MULTIPLE_CHOICE&&e.question.questionType!==n.GRIDDED_RESPONSE});return r.length>0},this.getFormattedQuestionData=function(e){var t=this,r=[];return angular.forEach(e.current.assessment.questions,function(s,a){var i,o,l,c=s.id,u={questionNumber:a,questionText:s.text},d=s.questionType===n.GRIDDED_RESPONSE;i=_.find(e.current.questionResponseDefinitions,function(e){return e.question.id===c}),i&&(o=_.last(i.userResponses),o&&(d?(u.responseText=o.responseValue,u.responseLabel=""):(u.responseText=o.text,u.responseLabel=t.positionToLabel(o.position)),u.isCorrect=o.score.correct,u.isAnswered=o.answered),l=i.correctAnswer,l&&(d?(u.correctText=l.responseValue,u.correctLabel=""):(u.correctText=l.text,u.correctLabel=t.positionToLabel(l.position)))),r.push(u)}),r}}]),angular.module("Realize.reporting.grades.StudentProgressRecapCtrl",["Realize.analytics","Realize.reporting.ReportService"]).controller("StudentProgressRecapCtrl",["$log","$scope","$rootScope","$routeParams","$location","ProgressRecap","ReportService","Analytics",function(e,t,n,r,s,a,i,o){"use strict";var l=["assignmentsCompletedOnTime","assignmentsCompletedPastDue","assignmentsInProgress","assignmentsNotStarted"];t.testProgram=function(e){var n=t.currentProgram,r=e.programs;return n?"NO_PROGRAM"!==n||r&&0!==r.length?1===r.length&&r[0]===n:!0:!0},t.back=function(){var e=s.path().split("/overview")[0],n=[e,"overview"].join("/");t.goBack(n,!0)},a.filters&&a.counts?(t.assignments=a.assignments,t.counts=a.counts,t.statusList=_.filter(l,function(e){return t.counts[e]>0}),t.currentStatus=r.status,t.selectStatus=function(e){var t,n,a={assignmentsCompletedOnTime:"Completed On Time",assignmentsCompletedPastDue:"Completed Past Due",assignmentsInProgress:"In Progress",assignmentsNotStarted:"Not Started"};o.track("track.action",{category:"Grades",action:"Progress Status dropdown",label:a[e]}),t=s.path().split("/status")[0],n=[t,"status",e,r.filterStartDate,r.filterEndDate].join("/"),s.path(n)}):t.back(),t.currentProgram=i.currentProgram,t.isAssignmentNeedManualScore=function(e){return(e.hasNotSentManualScore||e.hasNotScoredManualScore)&&!e.isAdaptiveAssignment()},t.isAssignmentScored=function(e){return!t.isAssignmentNeedManualScore(e)&&null!==e.averageScore&&!e.isAdaptiveAssignment()},t.isAssignmentNoScore=function(e){return e.isAdaptiveAssignment()&&!e.$isCompleted()||!t.isAssignmentNeedManualScore(e)&&null===e.averageScore&&!e.isAdaptiveAssignment()},t.showStars=function(e){return e.isAdaptiveAssignment()&&e.$isCompleted()},t.getSubmitDate=function(e){return e.isSingleDiscussion()?e.$getLegibleDateObj().dueDate:e.$getPrimaryMetadata().lastOpenDate}}]),angular.module("RealizeDirectives").directive("facinator",["$log","$filter","Messages","rubricEventTracking","lwcI18nFilter","playlistTelemetryService","playlistUtilService","PLAYLIST_CONSTANTS","searchTelemetryUtilitiesService","TELEMETRY_FACETS_CONSTANTS","LeveledReadersSvc",function(e,t,n,r,s,a,i,o,l,c,u){"use strict";return{scope:{facets:"=facinator",selected:"=",singleSelect:"=?"},templateUrl:"templates/search/facinator/facinator.dir.html",controller:["$scope",function(e){e.more={},e.limit={},e.selectOrder=0,e.getMessage=n.getMessage,e.$root.$on("$locationChangeStart",function(){e.$emit("facinator.exiting",{selectOrder:e.selectOrder})}),e.$on("facinator.selectOrder.changed",function(t,n){e.selectOrder=n}),e.$on("searchResults.facet.filter.toggled",function(t,n){e.toggle("FEATURED_RESOURCES",n)}),e.$watch("facets",function(t){t&&angular.forEach(t,function(t){angular.isUndefined(e.limit[t.fieldName])&&(e.limit[t.fieldName]=t.noLimit?1e3:6),e.limit[t.fieldName]>6&&(e.limit[t.fieldName]=6,e.more[t.fieldName]=!1),angular.forEach(t.values,function(e){e.ariaLabel=e.displayName+" "+s("keywordSearch.facetSelection.with")+" "+e.count+" "+s("keywordSearch.facetSelection.items")})})}),e.hasSelectedTags=function(t){return angular.isDefined(e.selected[t])?e.selected[t].length>0:!1},e.clearSelectedTags=function(t){e.selected[t]=[]},e.isTagSelected=function(t,n){var r=!1;return angular.forEach(e.selected[t],function(e){n===e.value&&(r=!0)}),r},e.facetHasTag=function(t,n){var r=!1;return angular.forEach(e.selected[t],function(e){n===e.value&&(r=!0)}),r},e.isNotBrowsePage=function(){var e=i.isResourceListPage(),t=i.isBrowseAllPage(),n=i.isResourcePage(),r=i.isStandardPage();return!(e||t||n||r)},e.toggle=function(n,s){var d=i.getOriginPageInfo(),m=i.isResourcePage(),g=i.isStandardPage(),p=i.isSearchPage(),f=!1;if(angular.isUndefined(e.selectOrder)?e.selectOrder=0:e.selectOrder+=1,s.selectOrder=e.selectOrder,angular.isUndefined(e.selected)&&(e.selected={}),angular.isUndefined(e.selected[n])?(e.selected[n]=[s],f=!0):e.facetHasTag(n,s.value)?e.selected[n]=t("filter")(e.selected[n],function(e){return s.value!==e.value}):(e.selected[n].push(s),f=!0),"RUBRIC"===n&&f&&e.isNotBrowsePage()&&d.originArea!==c.PAGE.SEARCH&&r.clickOnRubricFacetSearch(s.value,s.count),"MEDIA_TYPE"===s.facet&&f&&e.isNotBrowsePage()&&d.originPage!==o.TELEMETRY.PAGE.BROWSE_ALL&&d.originArea!==c.PAGE.SEARCH&&a.onFacetSelected(s.value,s.count,d.originArea),m&&f){var h=c.PAGE.RESOURCES,v=c.PAGE.BROWSE,S=t("facetField")(n);l.sendTelemetryEventForBrowse(h,s.displayName,S,s.count,v)}else if(g&&f){var T=c.PAGE.STANDARDS,A=c.PAGE.BROWSE,I=t("facetField")(n);l.sendTelemetryEventForBrowse(T,s.displayName,I,s.count,A)}else if(d.originArea===c.PAGE.SEARCH&&p&&f){var E=c.PAGE.SEARCH_RESULTS,y=c.PAGE.SEARCH,R=t("facetField")(n);l.sendTelemetryEventForBrowse(E,s.displayName,R,s.count,y)}else if(d.originSubpage===c.SCALE.DRA&&f){var C=t("facetField")(n),D=u.getScaleStartFromRoute(),b=u.getScaleEndFromRoute(),P=u.getProgramTitle();l.sendTelemetryEventForDra(s.displayName,C,s.count,P,D,b)}e.more[n]=!1}}]}}]).filter("facetField",function(){"use strict";return function(e){var t,n;if(angular.isDefined(e)){var r=e.split(/_/g),s="";for(t=0,n=r.length;n>t;t++)s=r[t].toLowerCase(),r[t]=s[0].toUpperCase()+s.substr(1);return r=r.join(" "),"Content Type"===r&&(r="Content Category"),"Library Title"===r&&(r="Program"),"Custom Facet Library"===r&&(r="Library"),"Custom Facet Themes"===r&&(r="Theme"),"Custom Facet Skills Teaching Opportunities"===r&&(r="Skills Teaching Opportunities"),"Custom Facet Cross Curricular Connections"===r&&(r="Cross Curricular Connections"),r}}}).directive("selectedFacetList",["$log","$compile","Messages",function(e,t,n){"use strict";return{scope:{facets:"=selectedFacetList",hasTagsSelected:"="},template:['<ul class="value-list inline">','<li class="clear-all">','<a ng-click="clearAll();" data-e2e-id="clear" href="javascript://">','{{ "keywordSearch.action.clearAll" | lwcI18n }}',"</a>","</li>","<li ng-repeat=\"tag in tagPool | orderBy:'selectOrder'\"",' ng-click="clearTag(tag.value, tag.facet)" class="value selected">','<a ng-show="tag.count !== null" href="javascript://" data-e2e-id="{{!!tag.count}}toggle">',"{{ tag.displayName }} ({{ tag.count }})",'<i class="icon-remove"></i>','<span class="a11yOffScreen">','{{ "keywordSearch.facetSelection.removeFilter" | lwcI18n }}',"</span>","</a>",'<a ng-show="tag.count === null" href="javascript://" data-e2e-id="{{!tag.count}}toggle">','{{ tag.displayName }}<i class="icon-remove"></i>',"</a>","</li>","</ul>"].join(""),controller:["$scope","$filter",function(e,t){e.clearTag=function(n,r){e.facets[r]=t("filter")(e.facets[r],function(e){return n!==e.value})},e.clearAll=function(){e.$emit("selectedFacetList.clearAll")}}],link:function(e){e.getMessage=n.getMessage,e.$watch("facets",function(){e.hasTagsSelected=!1,e.tagPool=[],angular.forEach(e.facets,function(t){e.hasTagsSelected=!0,e.tagPool=e.tagPool.concat(t)}),0===e.tagPool.length&&(e.hasTagsSelected=!1)},!0)}}}]),angular.module("RealizeApp").controller("KeywordSearchCtrl",["$scope","$log","$location","$filter","$rootScope","ContentSource","USER_ATTRIBUTE_KEY","lwcI18nFilter","$routeParams","ExternalItemStrategy",function(e,t,n,r,s,a,i,o,l,c){"use strict";function u(t){e.hideExternalProviderSearchTip=t}e.pageLoading(),e.searchInitialized=!1;var d=n.search();e.keywords=e.zeroStateMsgCriteria=d.keywords,e.sortBy="relevance",e.searchInputFocused=!1,e.searchParams={},e.selectedFacets={};var m={keywords:e.keywords,sortField:"relevance",sortOrder:"asc"},g=n.path(),p=a.getByPath(),f=!1,h=c.getInstance(g);if(angular.isDefined(h)?(e.externalSearchProviderName=h.getProviderName(),e.searchProvider=e.externalSearchProviderName):e.searchProvider=a.PROVIDER.REALIZE,s.currentUser.isStudent&&(m.NOT_HIDE_FROM_STUDENT="Yes"),e.searchProvider!==a.PROVIDER.REALIZE){var v=h.getDismissTipsUserAttribute();u(e.currentUser.getAttribute(v))}e.hideExternalProviderSearchTips=function(){var n=h.getDismissTipsUserAttribute();e.currentUser.setAttribute(n,!0),t.debug("external provider search tips dismissed forever..."),u(!0)},e.firstVisit={showAlert:function(){return e.searchProvider!==a.PROVIDER.REALIZE&&!e.hideExternalProviderSearchTip},title:o("keywordSearch.tipsForSearchingWithOpenEd.title"),description:o("keywordSearch.tipsForSearchingWithOpenEd.message"),closeFn:e.hideExternalProviderSearchTips};var S=function(){return p.filterData.get("search.keyword")},T=function(n){n&&(t.debug("searchProvider "+p.name+" save",n),p=new a(e.searchProvider),p.filterData.set("search.keyword",n))},A=function(){t.debug("initSearch: Reset Search Data"),angular.forEach(a.PROVIDER,function(e){e=new a(e),e.filterData.remove("search.keyword")})};e.setSortField=function(t,n){n&&(n.stopPropagation(),n.preventDefault()),e.sortBy=t};var I=function(){var n=S();n&&n.searchOptions&&l.keywords!==n.searchOptions.keywords&&(A(),n=S()),n?(e.selectedFacets=n.selectedFacets,e.searchParams=n.searchOptions,e.setSortField(n.searchOptions.sortField)):e.searchParams=m,t.debug("initSearch",e.selectedFacets,e.searchParams)};e.$on("searchResults.queryCompleted",function(t,n){e.noMatchFound=0===n.resultCount}),e.$on("searchResults.searchProvider.toggled",function(t,r){f=!0;var s=a.PROVIDER.PATH,i=s[r];n.path(i).search({keywords:e.searchParams.keywords})}),e.$on("$locationChangeStart",function(e,t,n){t.split("?").shift()!==n.split("?").shift()&&(f=!0)}),e.$on("searchResults.exiting",function(e,t){f?T(t):A()}),e.isExternalSearchProviderMode=function(){return angular.isDefined(e.externalSearchProviderName)&&e.searchProvider===e.externalSearchProviderName},I()}]),angular.module("RealizeDirectives").controller("SearchResultsCtrl",["$scope","$element","$attrs","$log","$location","ContentSource","$rootScope","Messages","RealizeHelpers","BrowserInfo","$timeout","SearchSvc","$routeParams","QL_MAX_LINKS","OPEN_ED_LINKS","PATH","ProgramService","lwcI18nFilter","LeveledReadersSvc","telemetryService","baseTelemetryEvents","TELEMETRY_CONSTANTS","LEXILE_TELEMETRY","DRA_TELEMETRY",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y){"use strict";var R=E.EMPTY_STRING;if(angular.isDefined(e.active)&&!e.active)return t.remove(),void 0;e.$on("resourcesGridView.facet.filter.triggered",function(t,n){e.$broadcast("searchResults.facet.filter.toggled",n)}),e.location=s,e.isStudent=i.currentUser.isStudent,e.getMessage=o.getMessage,e.QL_MAX_LINKS=g,e.OPEN_ED_LINKS=p;var C="realizeit/skins/default/images/featuredResources/",D="featured_resources_default_icon",b=".png",P="";P=c.isHDDisplay?"@2x":"@1x",e.fallback=C+D+P+b,e.basePath=[f.SHARED_THUMBNAILS,"featured_resources"].join("/"),e.resources=[];var w,L=this,O=new a(e.searchProvider),N={},M={},k=["Teacher Support","Tier","Remediation","Learning Model","Student Voice","Center Container","Tools"];L.searchOptions=e.searchOptions,angular.isUndefined(e.searchOptions)?e.searchOptions={facets:{},page:1}:angular.isUndefined(e.searchOptions.facets)&&(e.searchOptions.facets={}),angular.isUndefined(e.selectedFacets)&&(e.selectedFacets={}),angular.isUndefined(e.selectedSearchItems)&&(e.selectedSearchItems={ids:{},objects:[]});var z=function(){e.delayingSearch=!1,e.queryDone=!1,e.results=[],e.startIndex=1,e.endIndex=10,e.pageSize=10,e.totalMatches=10,e.currentPage=e.searchOptions.page||1,e.facets=[],e.externalSearchProviderDown=!1};e.readerType=!1,L.setReaderType=function(t){e.readerType=t},L.isInitialSearch=function(){return angular.isUndefined(N[e.searchProvider])&&(N[e.searchProvider]=!0),N[e.searchProvider]};var U=function(){N[e.searchProvider]=!1};e.showMultiSelectItem=angular.isDefined(n.showmultiselectitem),e.showPrimaryLinks=angular.isDefined(n.showprimarylinks),e.showAddItemLinks=angular.isDefined(n.showadditemlinks),e.isStandardSearch=angular.isDefined(n.standardssearch),z(),e.pageLoaded=!1;var F=e.$watch("queryDone",function(t){var n=s.path();(t||n.search("/reorder")>=0)&&(i.pageLoaded(),e.pageLoaded=!0,F())});L.updateResultCountIndexes=function(){var t=d.calculateResultCountIndexes(e.pageSize,e.currentPage,e.totalMatches);e.startIndex=t.start,e.endIndex=t.end};var x=function(){e.$emit("searchResults.queryCompleted",{resultCount:e.totalMatches}),e.queryDone=!0},B=function(t,n){n=n||angular.noop,e.facets=d.sortFacets(t.facets),e.inResourcePage()&&s.path().search("/lesson")<0&&e.modifyFacetList();var r=d.getFacetMap(e.facets);angular.forEach(e.selectedFacets,function(e){angular.forEach(e,function(e){r[e.facet]&&r[e.facet][e.value]&&(e.count=r[e.facet][e.value].count)})}),e.results=d.groupResults(t.results,"searchGroupNum"),h.getAllPrograms().then(function(t){var n=t.results?t.results:[];angular.forEach(e.results,function(e){e.breadcrumbList=e.fromDetailsTrees&&e.fromDetailsTrees.length>0?d.getBreadcrumbHierarchy(e.fromDetailsTrees,n):[]})}),e.results=d.addMyContent(e.results),e.totalMatches=t.totalMatches,e.noMatchFound=0===e.totalMatches,e.noMatchFound&&e.isExternalSearchProviderMode()&&e.$broadcast("searchInput.clear"),L.updateResultCountIndexes(),x(),n(),i.viewLoading&&i.pageLoaded()},V=function(t,n,r){var s={extensions:{area:I.EVENT_TYPE.PROGRAMS,page:E.LEVELED_READERS,product:E.EMPTY_STRING,description:t,value:e.searchOptions[E.LEXILE.toUpperCase()]},definition:{name:n}};return s.extensions["sub-page"]=r,s},H=function(e){var t,n,r,s;R===E.LEXILE_SCALE_SEARCH?(t=e,n=E.DESCRIPTION_WITHOUT_FILTER,r=E.LEXILE_SEARCH,s=E.LEXILE_SCALE):R===E.FACET_CHANGE_EVENT&&(t=I.EVENT_TYPE.FILTER,n=E.DESCRIPTION_WITH_FILTER,r=E.LEXILE_FACET,s=I.EVENT_TYPE.FACET_PANEL),R=E.EMPTY_STRING;var a=A.createEventData(t,V(n,r,s));T.sendTelemetryEvent(a)},G=function(t){var n=L.isInitialSearch();if(n&&(i.pageLoading(),U()),S.getScaleTypeFromRoute()===E.LEXILE){R=0===R.length?E.LEXILE_SCALE_SEARCH:R;var r=n&&R===E.LEXILE_SCALE_SEARCH?I.EVENT_TYPE.SEARCH:I.EVENT_TYPE.FILTER;H(r)}else if(S.getScaleTypeFromRoute()===y.DRA){R=0===R.length?y.DRA_SCALE_SEARCH:R;var s=n&&R===y.DRA_SCALE_SEARCH?I.EVENT_TYPE.SEARCH:I.EVENT_TYPE.FILTER;Y(s)}w&&(u.cancel(w),w=!1),e.queryDone=!1,e.externalSearchProviderDown=!1;var a=angular.copy(e.searchOptions);delete a.facets,angular.extend(a,e.searchOptions.facets),O.updateMultiValueFacets(a);var o={pageSize:e.pageSize,levels:0,NOT_ITEM_STATUS:["deleted","archived"],NOT_MEDIA_TYPE:k,"includedFacets[]":d.INCLUDED_FACETS,realizeSearch:!0};e.isStudent&&o.NOT_MEDIA_TYPE.push("Center");var l=angular.extend({},o,a);O.query(l).then(function(e){B(e,t)},function(){e.isExternalSearchProviderMode()?(e.externalSearchProviderDown=!0,e.totalMatches=0,e.noMatchFound=!0,x(),i.viewLoading&&i.pageLoaded()):i.goToDefaultErrorPage()})},j=function(){w=u(G,500)},q=function(t,n){var r={extensions:{area:I.EVENT_TYPE.PROGRAMS,page:y.LEVELED_READERS,"sub-page":n,product:S.getProgramTitle(),description:y.DESCRIPTION,LeveledReaderType:y.DRA,LeveledReaderScale:e.searchOptions[y.DRA.toUpperCase()]},definition:{name:t}};return r},Y=function(e){var t,n,r;if(R===y.DRA_SCALE_SEARCH){t=e,e===I.EVENT_TYPE.SEARCH?(n=y.DRA_SCALE_SEARCH,r=y.DRA_SCALE):e===I.EVENT_TYPE.FILTER&&(r=y.DRA_SEARCH_RESULTS,n=y.REFINE_DRA_SCALE);var s=A.createEventData(t,q(n,r));T.sendTelemetryEvent(s)}R=E.EMPTY_STRING};L.inferSelectedFacets=function(){var t=e.facets,n=angular.copy(e.searchOptions.facets),r={};angular.forEach(t,function(e){var t=n[e.fieldName];t&&(r[e.fieldName]||(r[e.fieldName]=[]),angular.forEach(t,function(t){var n=_.findWhere(e.values,{value:t});n&&r[e.fieldName].push(n)}))}),angular.extend(e.selectedFacets,r)},e.loadingResults=function(){return e.results.length&&!e.queryDone},e.removeSelectedItems=function(t,n){l.killEvent(t),e.selectedSearchItems.ids[n]=!1,e.selectedSearchItems.objects=_.reject(e.selectedSearchItems.objects,function(e){return e.id===n})},e.updateSelectedResults=function(t,n){if(n){var r=_.find(e.results,function(e){return e.id===t});e.selectedSearchItems.objects.push(r)}else e.selectedSearchItems.objects=_.reject(e.selectedSearchItems.objects,function(e){return e.id===t})},e.skipFacets=function(e){e.stopPropagation(),$("#resultsSkipTarget").next("div").find(":focusable").first().focus()},e.openFrom=function(e){l.killEvent(e)},e.showSearchProvidersInZeroState=function(){return e.addItemSearchResults&&(e.noMatchFound||e.delayingSearch)},e.showExternalProviderSearchForm=function(){return e.addItemSearchResults&&e.searchProvider!==a.PROVIDER.REALIZE},e.inExternalProviderZeroState=function(){return e.delayingSearch&&e.showExternalProviderSearchForm()},e.inResourcePage=function(){return e.location.path().search("/resources")>=0},e.isSearchResultPage=function(){return e.inResourcePage()&&""!==e.searchOptions.keywords},e.hasFacetSelected=function(){return void 0!==_.find(e.selectedFacets,function(e){return e.length>0})},e.showResourceSearchList=function(){return""!==e.searchOptions.keywords||e.hasFacetSelected()||0===e.resources.length},e.noMatchToggle=function(t){s.path(t).search({keywords:e.searchOptions.keywords})},e.goToPrograms=function(){s.path("/program")};var W=e.searchProvider;e.toggleSearchProvider=function(t,n){l.killEvent(t),W=e.searchProvider,e.$emit("searchResults.searchProvider.toggled",n)},e.showSearchResults=function(){return!e.noMatchFound&&!e.delayingSearch||e.inResourcePage()},e.showSearchResultsList=function(){return!e.inResourcePage()||e.showResourceSearchList()},e.showResourcesThumbnails=function(){return e.inResourcePage()&&!e.showResourceSearchList()},e.modifyFacetList=function(){angular.forEach(e.facets,function(t){"FEATURED_RESOURCES"===t.fieldName&&e.setResources(t.values),"LIBRARY_TITLE"===t.fieldName&&e.facets.splice(e.facets.indexOf(t),1)})},e.setResources=function(t){e.resources.length=0,angular.forEach(t,function(t){t&&e.resources.push(t)})},e.setKeywords=function(t){e.isExternalSearchProviderMode()&&(e.delayingSearch=!1,angular.copy({},e.selectedFacets),e.noMatchFound&&(N[e.searchProvider]=!0)),e.searchOptions.page=1,e.searchOptions.keywords===t?G(angular.noop):e.searchOptions.keywords=t},i.$on("selectedFacetList.clearAll",function(){e.isStudent&&k.push("Center"),e.searchOptions.LIBRARY_TITLE&&(e.searchOptions.NOT_MEDIA_TYPE||(e.searchOptions.NOT_MEDIA_TYPE=[]),angular.copy(k,e.searchOptions.NOT_MEDIA_TYPE)),angular.copy({},e.selectedFacets)}),i.$on("facinator.exiting",function(e,t){M.facets=t}),e.$on("$locationChangeStart",function(){e.$emit("searchResults.exiting",{selectedFacets:angular.copy(e.selectedFacets),searchOptions:angular.copy(e.searchOptions),page:e.currentPage,additionalData:M})}),e.$watch("currentPage",function(t,n){t!==n&&t!==e.searchOptions.page&&(L.updateResultCountIndexes(),e.searchOptions.page=t)}),e.$watch("selectedFacets",function(t,n){var r=n&&!angular.equals(t,n);if(r){var s=l.convertFacetsToParams(t);L.isInitialSearch()?$.extend(e.searchOptions.facets,s):(angular.copy(s,e.searchOptions.facets),W===e.searchProvider&&(e.searchOptions.page=1),R=E.FACET_CHANGE_EVENT)}},!0),e.$watch("sortField",function(t,n){t&&t!==n&&(e.searchOptions.sortField=t,e.searchOptions.sortOrder="asc")}),e.$watch("searchProvider",function(t,n){t&&t!==n&&(W=t,O=new a(e.searchProvider),z(),e.addItemSearchResults&&L.isInitialSearch()&&e.isExternalSearchProviderMode()?e.delayingSearch=!0:(i.pageLoading(),j()))},!0),e.$watch("searchOptions",function(t,n){if(_.size(t)&&!e.delayingSearch){var r=angular.noop;L.isInitialSearch()&&e.addItemSearchResults&&e.searchProvider===a.PROVIDER.REALIZE&&(e.zeroStateMsgCriteria=t.facets.LIBRARY_TITLE[0],r=L.inferSelectedFacets),t.LEXILE!==n.LEXILE?R=E.LEXILE_SCALE_SEARCH:t.DRA!==n.DRA&&(R=y.DRA_SCALE_SEARCH),e.currentPage=t.page||1,G(r)}},!0),e.tmplUrls={externalProviderSearchForm:"templates/partials/openEdSearchForm.html",providerToggle:"templates/partials/searchProviderToggle.html"},e.getKeywordsIfSearchIsNotEmpty=function(){return e.showSearchResults()?e.searchOptions.keywords:void 0},e.redirectToLeveledReader=function(){var e=["/program",m.programId,m.programVersion,"leveledreaders"].join("/");s.path(e).replace()},e.resourcesSearch=function(t){e.searchOptions.keywords=t,e.$emit("searchResults.searchButton.triggered")},e.clearSearch=function(){e.searchOptions.keywords=""},e.searchTitle=v("resources.searchTitle"),e.searchButtonName=v("resources.searchBtnText"),e.inResourcePage()&&e.searchOptions.keywords&&(e.initialSearchKeyword=e.searchOptions.keywords),e.isExternalSearchProviderMode=function(){return angular.isDefined(e.externalSearchProviderName)&&e.searchProvider===e.externalSearchProviderName}}]).directive("searchResults",[function(){"use strict";return{replace:!0,scope:{sortField:"=",addItemSearchResults:"=?addItemSearch",selectedSearchItems:"=?",searchProvider:"=",searchOptions:"=",selectedFacets:"=",externalSearchProviderName:"="},templateUrl:function(e,t){return t.template||"templates/search/searchResults/searchResults.dir.html"},controller:"SearchResultsCtrl"}}]),angular.module("RealizeDirectives").controller("SearchResultsListCtrl",["$scope","$location","ContentSource","$rootScope","RealizeHelpers","$window","InfoModalService","MediaQuery","MEDIA_TYPE","CONTRIBUTOR_SOURCE","SearchSvc","$timeout","searchTelemetryUtilitiesService","rubricEventTracking","telemetryUtilitiesService","AssignmentUtil","addToPlaylistService","playlistUtilService","playlistTelemetryService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S){"use strict";var T,A,I=new n(e.searchProvider);e.alertIsSet=!1,e.$on("assignmentModal.alert.toggle",function(t,n){e.alertDetails={info:n.alertDetails},n.show&&(e.alertIsSet=!0)}),e.treeTitleEllipses=o.breakpoint.isDesktop?60:40,e.hasCustomizePrivilege=r.currentUser.$canCustomizeItems(),e.showBreadcrumbEllipsis=!1,e.isMixedMode=function(){return!o.breakpoint.isDesktop},e.showInfoLink=function(t){return angular.isDefined(e.selectedSearchItems.ids[t.id])?!e.selectedSearchItems.ids[t.id]:t.$hasInfo()&&"Tier"!==t.mediaType&&!t.essayPrompt&&t.mediaType!==l.PLAYLIST},e.showAssignLink=function(t){return e.isExternalSearchProviderMode()||e.showPrimaryLinks&&t.$isAssignable()},e.showCustomizeLink=function(t){return!e.isStudent&&e.showPrimaryLinks&&e.hasCustomizePrivilege&&"Lesson"===t.mediaType&&!t.$isReviewerContainer()},e.showTeacherResourceLink=function(t){return!e.isStudent&&"Tier"!==t.mediaType&&e.showPrimaryLinks},e.getCustomizeLabel=function(e){return e.$isCustomizedTest()?"content.action.edit":e.essayPrompt?"myContent.action.edit":"program.action.customize"},e.isEssayPrompt=function(e){return!!e.essayPrompt},e.viewRemediation=function(e,n){s.killEvent(n);var r=t.path().split("/edit").shift(),a="Lesson"===e.mediaType?"lesson":"content",i=[r,a,e.id,e.version,"remediation"].join("/");u.storeContentFromDetails(e),t.path(i)},e.showRubric=function(n,r){r&&r.stopPropagation(),e.productName?g.clickOnRubricQuickLink(!0,e.productName,n.externalId,n.title):f.getProgramHierarchy(n,n.id).then(function(t){e.productName=p.getProgramTitle(t),g.clickOnRubricQuickLink(!0,e.productName,n.externalId,n.title)});var s=t.path(),a=s.split("/edit").shift(),i=t.search().keywords;t.path([a,"content",n.id,n.version].join("/")),s.indexOf("edit")>-1?t.search({editing:"true",rubric:"true",keywords:i}):t.search({rubric:"true",keywords:i})},e.showLeveledReadersLevelInfo=function(e){return i.createLevelsArray(e)},e.hideInfoItemOnLevels=function(){return i.hideInfoItemOnLevels()},e.open=function(r,a){if(A=!0,s.killEvent(r),a=a.$getDefaultVersion(),e.searchProvider!==n.PROVIDER.Open_ED&&a.$isNbcItem())t.path(["/nbclearn/video",a.id,a.version].join("/"));else{var i=t.path(),o=i.split("/edit").shift(),c="content";if(a.fileType===n.PROVIDER.FILE_TYPE.OpenEd)a.version=n.PROVIDER.VERSION.OpenEd;else if("Lesson"===a.mediaType)c="lesson";else if("Center"===a.mediaType)c="center";else if(a.mediaType===l.DISCUSSION_PROMPT)c="discussionprompt";else if(a.mediaType===l.ADAPTIVE_HOMEWORK)c="adaptivehomework";else if(a.mediaType===l.PLAYLIST){var d=v.getOriginPageInfo();c="playlist",A=!1,S.onNavigateToPlaylistPage(d.originArea,d.originPage)}u.storeContentFromDetails(a),T=[o,c,a.id].join("/"),A&&(T=[T,a.version].join("/")),t.path(T),i.indexOf("edit")>-1&&t.search({editing:"true"})}},e.customizeLesson=function(e,n){s.killEvent(n);var r=t.path();e=e.$getDefaultVersion(),t.path(r+I.getRoute(e))},e.isExternalSearchProviderMode=function(){return angular.isDefined(e.externalSearchProviderName)&&e.searchProvider===e.externalSearchProviderName},e.isTeacherPrompt=function(e){return e.contribSource===c.MY_UPLOADS&&e.mediaType===l.DISCUSSION_PROMPT},e.editPrompt=function(n,r){n&&n.stopPropagation(),t.search("view","edit"),e.open(n,r)},e.hasTierAndLesson=function(e){return e.$isLesson()||e.isTier()||e.isPlaylist()},e.breadcrumbHandler=function(e,t,n){e&&e.stopPropagation(),m.sendTelemetryEventsFromSearch(e,n,"searchPage"),u.navigateToSourceProgram(t)},e.moreOrLessToggle=function(e,t,n){var r=e.currentTarget.text;t&&d(function(){e||(e=window.event);for(var t=e.target||e.srcElement;t&&(t=t.parentNode,!(t.className.indexOf("breadcrumbSection")>-1)););var n=angular.element(t).find("nav>ol")[1],r=angular.element(n).find("a")[0];r.focus(),r.classList.add("kb-mode")}),m.sendTelemetryEventsFromMoreOrLess(r,n)},e.activateAddToPlaylistModal=function(t,n){var r=v.getOriginPageInfo();t.stopPropagation();var s={contentIdList:[n.id],cssClass:"search__result",origin:"browseAll",contentTitle:n.title,closeAction:function(){t.currentTarget.querySelector("a").focus()}};h.invokeDefaultFlow(s),S.onAddToPlaylistBrowseSearch(r.originPage,r.originSubpage,r.originArea,e.productName)}}]).directive("searchResultsList",[function(){"use strict";return{templateUrl:"templates/search/searchResultsList/searchResultsList.dir.html",transclude:!0,controller:"SearchResultsListCtrl"}}]),angular.module("Realize.ExternalItem.DataGenerator",[]).factory("ExternalAssignmentDataGenerator",["Content","ASSIGNMENT_CONSTANTS","$q",function(e,t,n){"use strict";var r=function(e,r,s,a){var i=angular.extend(this,a);return i.itemToBeAssigned=r,i.createNewAssignment=s,i.getContent=function(){var e=n.defer();return e.resolve(i.itemToBeAssigned),e.promise},i.getAssignmentData=function(){var n;if(i.createNewAssignment){i.itemToBeAssigned=i.itemToBeAssigned.$getDefaultVersion();var r=i.itemToBeAssigned.title,s=r.length;n=i.createAssignmentObjectInCreateMode(i.itemToBeAssigned),n.title=s>t.TITLE_MAX_LENGTH?r.substring(0,t.TITLE_MAX_LENGTH):r,n.externalSourceId=i.itemToBeAssigned.id,n.assignmentSource=e,i.itemToBeAssigned.assignmentAttachment=i.createAssignmentAttachment(i.itemToBeAssigned)}return n},i};return r}]),angular.module("Realize.ExternalItem",["Realize.ExternalItem.DataGenerator","Realize.externalItem.Strategy","Realize.externalItem.OpenEd.Service"]),angular.module("Realize.externalItem.Strategy",[]).service("ExternalItemStrategy",["$log","ContentSource","OpenEdItemService","$location",function(e,t,n,r){"use strict";var s=this;s.getExternalProviderName=function(e){return e=e||r.path(),t.PROVIDER.PATH.Realize!==e?_.invert(t.PROVIDER.PATH)[e]:void 0},s.getInstance=function(t){var r=this,a=s.getExternalProviderName(t);return angular.isDefined(a)?new n(r):(e.info("Unable to determine external search provider",t),void 0)}}]),angular.module("Realize.externalItem.OpenEd.Service",[]).factory("OpenEdItemService",["USER_ATTRIBUTE_KEY","ContentSource",function(e,t){"use strict";var n=function(n){var r=angular.extend(this,n);return r.getDismissTipsUserAttribute=function(){return e.DISMISS_OPEN_ED_SEARCH_TIPS_FOREVER},r.getProviderName=function(){return t.PROVIDER.Open_ED},r};return n}]),angular.module("Realize.admin.commonCartridge.editKeysetDirective",["ModalServices","RealizeDataServices","Realize.admin.commonCartridge.keysetService"]).directive("editKeysetModal",["Modal","lwcI18nFilter","keysetService",function(e,t,n){"use strict";return{restrict:"EA",scope:{keysetToEdit:"=",onUpdate:"&"},link:function(r){function s(){m=!1,r.keysetToEdit=void 0,g.$destroy()}function a(){return g.fullProgramList.filter(function(e){return e.selected===!0})}function i(){return a().map(function(e){return e.id})}function o(){var e=i();if(0===e.length)return g.uiState.isDeleteEquivalent=g.uiState.canUpdateKeyset=!0,void 0;g.uiState.isDeleteEquivalent=!1;var t=g.keyset.products.some(function(t){return-1===e.indexOf(t)}),n=e.some(function(e){return-1===g.keyset.products.indexOf(e)});g.uiState.canUpdateKeyset=t||n}function l(){angular.isFunction(r.onUpdate)&&r.onUpdate()(g.keyset),g.close()}function c(){g.uiState.hasPopupAlert=!0,g.uiState.isUpdatingKeyset=!1,g.popupAlertDetails={type:"danger",icon:"exclamation-sign",msg:t("commonCartridgeAdmin.manageKeys.editKeyset.errorUpdating")}}function u(){m=!0,g=r.$new(!0),g.uiState={canUpdateKeyset:!1,hasPopupAlert:!1,isDeleteEquivalent:!1,isUpdatingKeyset:!1},g.keyset=angular.copy(r.keysetToEdit),g.typeAndSelectConfig={results:g.fullProgramList,preSelectedItems:g.preSelectedItems,formText:{mainLabel:t("commonCartridgeAdmin.manageKeys.editKeyset.programsSelect.mainLabel"),help:t("commonCartridgeAdmin.manageKeys.editKeyset.programsSelect.help"),noMatch:t("commonCartridgeAdmin.manageKeys.editKeyset.programsSelect.alert.noMatch"),submitError:t("commonCartridgeAdmin.manageKeys.editKeyset.programsSelect.alert.submitError"),addAllLabel:t("commonCartridgeAdmin.manageKeys.editKeyset.programsSelect.addAllLabel"),offScreenRemove:t("commonCartridgeAdmin.manageKeys.editKeyset.programsSelect.offScreenRemove.a11y"),placeholder:t("commonCartridgeAdmin.manageKeys.editKeyset.programsSelect.placeholder")},isAddAllEnabled:!1,isFormSubmitted:function(){return!1},customFilter:function(e){return{title:e}},popoverPlacement:"left",popupMatchTmplUrl:"templates/admin/commonCartridge/createKeys_programTypeaheadMatch.html",searchBufferMS:300,selectedItemTmplUrl:"templates/admin/commonCartridge/createKeys_programTypeaheadSelectedItem.html"},g.$on("typeAndSelect.itemAdded",o),g.$on("typeAndSelect.itemRemoved",o),g.save=function(e){e.preventDefault(),g.uiState.isUpdatingKeyset=!0,g.uiState.isDeleteEquivalent?n.deleteKeyset(g.keyset.consumerKey).then(function(){g.keyset.isDeleted=!0,l()}).catch(c):(g.keyset.products=i(),delete g.keyset.programs,n.updateKeyset(g.keyset).then(function(){l()}).catch(c))},g.close=function(){e.hideDialog().finally(s)},d.then(function(t){g.fullProgramList=g.typeAndSelectConfig.results=angular.copy(t),g.preSelectedItems=g.typeAndSelectConfig.preSelectedItems=g.fullProgramList.filter(function(e){return-1!==g.keyset.products.indexOf(e.id)
}),e.showDialog("templates/admin/commonCartridge/editKeysetModal/editKeysetModal.html",g),g.preSelectedItems.length>0&&g.$broadcast("typeAndSelect.selectPrePopulatedItems",g.preSelectedItems)})}var d,m=!1,g=null;r.$watch("keysetToEdit",function(){angular.isDefined(r.keysetToEdit)&&!m&&(d=n.getProgramsForOrg(r.keysetToEdit.orgId),u())})}}}]),angular.module("Realize.admin.ltiConsumer.common.LTIConsumerSettingModel",[]).constant("ReservedKeywords",["lti_message_type","lti_version","user_id","roles","launch_presentation_locale","launch_presentation_document_target","launch_presentation_css_url","launch_presentation_width","launch_presentation_height","context_id","context_type","launch_presentation_return_url","resource_link_id","role_scope_mentor","tool_consumer_instance_guid","user_image","context_title","context_label","resource_link_title","resource_link_description","lis_person_name_given","lis_person_name_family","lis_person_name_full","lis_person_contact_email_primary","user_image","lis_person_sourcedid","lis_course_offering_sourcedid","lis_course_section_sourcedid","tool_consumer_info_product_family_code","tool_consumer_info_product_family_version","tool_consumer_instance_name","tool_consumer_instance_description","tool_consumer_instance_url","tool_consumer_instance_contact_email","lti_message_type","reg_key","reg_password","tc_profile_url"]).constant("LTIMaxLengths",{maxCustomFieldLength:300}).factory("LTIConsumerSettingModel",["ReservedKeywords","LTIMaxLengths",function(e,t){"use strict";function n(e){this.name=this.description=this.partner=this.key=this.secret=this.domain="",this.openNewWindow=!1,this.configureClassId=!0,this.customFields=[],angular.isDefined(e)&&(e.customFields=e.customFields||[],angular.extend(this,e))}return n.prototype.addCustomField=function(e,t){this.customFields.push({key:e||"",value:t||""})},n.prototype.setCustomField=function(e,t,n,r){this.customFields.push({key:n||"",value:r||""})},n.prototype.removeCustomFieldAt=function(e){this.customFields.splice(e,1)},n.prototype.hasAllRequiredFields=function(){return["name","key","secret","domain"].every(function(e){return this[e]&&this[e].toString().length>0},this)},n.prototype.hasValidKey=function(){var e=(this.key||"").length;return 0===e||e>0&&256>=e},n.prototype.hasValidSecret=function(){var e=(this.secret||"").length;return 0===e||e>0&&256>=e},n.prototype.hasIncompleteCustomFields=function(){return!(this.customFields||[]).every(function(e){return e.key=e.key||"",e.value=e.value||"",e.key.length+e.value.length===0||e.key.length>0&&e.value.length>0&&e.key.length<=t.maxCustomFieldLength&&e.value.length<=t.maxCustomFieldLength})},n.prototype.hasDuplicateCustomFields=function(){var e=(this.customFields||[]).filter(function(e){return e.key&&e.key.length>0});return e.length>0&&e.length!==_.uniq(_.pluck(e,"key"),function(e){return e.toLowerCase()}).length},n.prototype.isDuplicateCustomField=function(e){var t=this.customFields[e].key?this.customFields[e].key.toLowerCase():"";return 0!==t.length&&this.customFields.some(function(n,r){return(n.key?n.key.toLowerCase():"")===t&&e>r})},n.prototype.isCustomFieldReservedKeyword=function(t){var n=this.customFields[t].key?this.customFields[t].key.toLowerCase():"";return-1!==e.indexOf(n)},n.prototype.hasCustomFieldWithReservedKeyword=function(){var e=this;return this.customFields.filter(function(t,n){return e.isCustomFieldReservedKeyword(n)}).length>0},n.prototype.hasValidDomain=function(){var e=/^((?:(?:(?:\w[\.\-\+]?)*)\w)+)((?:(?:(?:\w[\.\-\+]?){0,62})\w)+)\.(\w{2,6})$/;return!angular.isDefined(this.domain)||0===this.domain.length||e.test(this.domain)},n}]),angular.module("Realize.admin.ltiConsumer.common.LTIConsumerSettingsSvc",["rlzComponents.components.i18n","Realize.paths","Realize.admin.ltiConsumer.common.LTIConsumerSettingModel"]).service("LTIConsumerSettingsSvc",["$http","PATH","lwcI18nFilter","LTIConsumerSettingModel",function(e,t,n,r){"use strict";function s(e){return(e.customFields||[]).filter(function(e){return e.key&&e.key.length>0&&e.value&&e.value.length>0}).map(function(e){return{key:e.key,value:e.value}})}var a=[t.REST,"externaltool"].join("/"),i={},o=[t.REST,"custom","fields"].join("/");this.custom=function(){return e.get(o).then(function(e){var t=e.data;return t})},this.list=function(){var t=this;return i={},e.get(a).then(function(e){return e.data.map(function(e){e.lastUpdated=moment(e.lastUpdated);var n=t.privacySettings.filter(function(t){return t.value===e.privacyLevel})[0];return angular.isDefined(n)&&(e.privacyLevelLabel=n.label),i[e.configurationUuid]=e,new r(e)})})},this.add=function(t){return e.post(a,angular.copy(t),{transformRequest:function(e){return e={name:e.name,description:e.description||"",ltiPartner:e.partner||"",key:e.key,secret:e.secret,domain:e.domain,openNewWindow:e.openNewWindow,configureClassId:e.configureClassId,privacyLevel:e.privacyLevel,customFields:e.customFields||[]},e.customFields=JSON.stringify(s(e)),$.param(e,!0)}})},this.update=function(t){var n=[a,t.configurationUuid].join("/");return e.put(n,angular.copy(t),{headers:{"Content-type":"application/json"},transformRequest:function(e){return e.customFields=s(e),e.ltiPartner=e.partner||"",e.description=e.description||"",JSON.stringify(e)}}).then(function(){i[t.configurationUuid]=t})},this.delete=function(t){var n=[a,t].join("/");return e.delete(n)},this.undelete=function(t){var n=[a,t,"undelete"].join("/");return e.post(n)},this.hasSettingForDomain=function(e,t){return!Object.keys(i).every(function(n){return t===n||i[n].domain.toLowerCase()!==e.toLowerCase()})},this.hasSettingNamedSame=function(e,t){return!Object.keys(i).every(function(n){return t===n||i[n].name.toLowerCase()!==e.toLowerCase()})},Object.defineProperty(this,"privacySettings",{get:function(){return[{value:"NONE",label:n("ltiConsumerAdmin.create.labels.privacyLevelOpts.none")},{value:"NAME_ONLY",label:n("ltiConsumerAdmin.create.labels.privacyLevelOpts.nameOnly")},{value:"EMAIL_ONLY",label:n("ltiConsumerAdmin.create.labels.privacyLevelOpts.emailOnly")},{value:"FULL",label:n("ltiConsumerAdmin.create.labels.privacyLevelOpts.full")}]}})}]),angular.module("Realize.admin.ltiConsumer.createSettingController",["Realize.admin.ltiConsumer.common.LTIConsumerSettingsSvc","Realize.admin.ltiConsumer.common.LTIConsumerSettingForm"]).controller("LTIConsumerSettingCreateController",["$scope","LTIConsumerSettingsSvc",function(e,t){"use strict";var n=this;t.list(),n.uiState={isSubmitting:!1,canSubmit:!1},n.triggerSave=function(){n.uiState.isSubmitting=!0,e.$broadcast("ltiConsumerSettingForm.submit")},n.onSettingSaveError=function(){n.uiState.isSubmitting=!1},n.onSettingSaved=function(){e.ltiConfigCtrl.showTab("manage")},e.$on("ltiConsumerSettingForm.dirtied",function(){n.uiState.canSubmit=!0})}]),angular.module("Realize.admin.ltiConsumer.managementController",["Realize.admin.ltiConsumer.common.LTIConsumerSettingsSvc","Realize.admin.ltiConsumer.common.LTIConsumerSettingForm"]).controller("LTIConsumerMgmtController",["$scope","$timeout","LTIConsumerSettingsSvc",function(e,t,n){"use strict";function r(){a.ltiSettingsList&&a.ltiSettingsList.length>0&&a.ltiSettingsList.forEach(function(e){e.expanded=!1})}var s,a=this;n.list().then(function(e){a.ltiSettingsList=e,a.pagerData.totalItems=e.length,a.pagerData.endIndex=a.pagerData.pageSize-1,a.uiState.isLoadingSettings=!1,s=t(function(){a.uiState.zeroState=0===e.length},0)}),a.uiState={editMode:!1,hasEditedSetting:!1,isLoadingSettings:!0,zeroState:!1},a.showTab=function(t){e.ltiConfigCtrl.showTab(t)},a.sortField="-lastUpdated",a.sortBy=function(e){if(a.uiState.editMode)return!1;r();var t="+";a.sortField.substr(1)===e&&(t="+"===a.sortField[0]?"-":"+"),a.sortField=t+e},a.expandRow=function(e,t){return a.uiState.editMode||e.isDefaultPrevented()?!1:t.expanded?(t.expanded=!1,void 0):(r(),t.expanded=!0,void 0)},a.enterEditMode=function(e,t){return e.preventDefault(),a.uiState.editMode?!1:(r(),t.expanded=!1,a.uiState.editMode=!0,a.settingToEdit=t,void 0)},a.cancelEditMode=function(){a.uiState.hasEditedSetting=!1,a.uiState.editMode=!1,a.settingToEdit=void 0},a.saveEditedSetting=function(){a.uiState.hasEditedSetting?e.$broadcast("ltiConsumerSettingForm.submit"):a.cancelEditMode()},a.onSettingSaved=function(e){var t=a.ltiSettingsList.filter(function(t){return t.configurationUuid===e.configurationUuid})[0],n=a.ltiSettingsList.indexOf(t);e.customFields=e.customFields.filter(function(e){return(e.key||"").length>0&&(e.value||"").length>0}),a.ltiSettingsList.splice(n,1,e),a.cancelEditMode()},a.deleteSetting=function(e,t){return e.preventDefault(),a.uiState.editMode?!1:(n.delete(t.configurationUuid).then(function(){t.deleted=!0,t.expanded=!1}),void 0)},a.undeleteSetting=function(e){return a.uiState.editMode?!1:(n.undelete(e.configurationUuid).then(function(){e.deleted=!1}),void 0)},e.currentPage=1,a.pagerData=e.pagerData={startIndex:0,endIndex:9,pageSize:10,get currentPage(){return e.currentPage},set currentPage(t){e.currentPage=t},totalItems:0},e.$watch("currentPage",function(){r(),a.pagerData.startIndex=(a.pagerData.currentPage-1)*a.pagerData.pageSize,a.pagerData.endIndex=a.pagerData.currentPage*a.pagerData.pageSize-1,a.pagerData.totalItems<a.pagerData.endIndex+1&&(a.pagerData.endIndex=a.pagerData.totalItems-1)},!0),e.$on("ltiConsumerSettingForm.dirtied",function(){a.uiState.hasEditedSetting=!0}),e.$on("$destroy",function(){t.cancel(s)})}]),angular.module("Realize.calendar.classCalendarCtrl",["rlzComponents.components.i18n","RealizeDataServices","Realize.common.alerts","Realize.common.keyboardSupport.keyCodes","Realize.calendar.calendarService","Realize.calendar.calendarEvent","Realize.calendar.eventSource"]).controller("ClassCalendarCtrl",["$scope","CalendarService","CalendarEvents","lwcI18nFilter","Messages","$routeParams","ClassRosters","AlertService","$location","EventSource","KEY_CODES","$timeout","DatepickerOptions",function(e,t,n,r,s,a,i,o,l,c,u,d,m){"use strict";var g=new Date,p=g.getFullYear(),f=g.getMonth(),h=function(e,t){var n=l.path()+"/"+t.id;l.path(n)};e.calendarConfig={defaultView:e.currentUser.getAttribute("classCalendar.view")||"month",weekends:!!e.currentUser.getAttribute("classCalendar.showWeekends"),header:!1,weekMode:"variable",titleFormat:{month:"MMMM yyyy",basicWeek:"MMMM d{ &#8212; MMMM d}"},monthNames:s.getMessagesAsArray("calendar.monthNames"),dayNames:s.getMessagesAsArray("calendar.dayNames"),columnFormat:{month:"dddd",basicWeek:"dddd d"},ignoreTimezone:!1,viewDisplay:function(t){e.calendarTitle=t.title.replace(/&#8212;/g,"-")},eventClick:function(t,n){h(n,t),e.$applyAsync()},eventRender:function(t,n){var r=angular.element(n);r.on("keydown",function(n){n.which===u.ENTER&&(h(n,t),e.$applyAsync())}),e.$on("$destroy",function(){r.off()})}},e.currentUser.getAttribute("classCalendar.view")||e.currentUser.setAttribute("classCalendar.view",e.calendarConfig.defaultView);var v;if(e.currentUser.getAttribute("classCalendar.currentRefDate")){var S=e.currentUser.getAttribute("classCalendar.currentRefDate");v=new c(n,S),e.calendarConfig.month=S.getMonth(),e.calendarConfig.date=S.getDate(),e.calendarConfig.year=S.getFullYear()}else v=new c(n);e.eventSources=[v];var T=function(t){e.calendarConfig.eventSources=e.eventSources,e.classCalendar.fullCalendar("destroy"),e.classCalendar.fullCalendar(e.calendarConfig),e.classCalendar.fullCalendar("gotoDate",t)},A=function(n){var r=e.currentUser.getAttribute("classCalendar.view"),s=t.getDateRange(n,r);return e.currentUser.setAttribute("classCalendar.currentRefDate",n,!1),t.getEvents(a.classId,{start:s.startDate,end:s.endDate}).then(function(t){v=new c(t,n),e.eventSources=[v],T(n)})},I=function(t){var n=e.classCalendar.fullCalendar("getDate"),r=e.currentUser.getAttribute("classCalendar.view"),s="next"===t?1:-1;return"month"===r?n.addMonths(s).moveToFirstDayOfMonth():n.addWeeks(s),n};e.changeCalendarView=function(t){e.calendarConfig.defaultView=t,e.currentUser.setAttribute("classCalendar.view",t);var n=e.classCalendar.fullCalendar("getDate");if("month"===t)A(n).then(function(){e.classCalendar.fullCalendar("changeView",t)});else{e.classCalendar.fullCalendar("changeView",t),v.updateVisibleEvents(n),v.truncateEventTitles(),e.classCalendar.fullCalendar("refetchEvents");var r=e.classCalendar.fullCalendar("getDate"),s=r.getFullYear(),a=r.getMonth();s===p&&a===f&&(e.classCalendar.fullCalendar("gotoDate",g),n=e.classCalendar.fullCalendar("getDate")),e.currentUser.setAttribute("classCalendar.currentRefDate",n,!1)}},e.toggleWeekends=function(){e.calendarConfig.weekends=!e.calendarConfig.weekends,e.currentUser.setAttribute("classCalendar.showWeekends",e.calendarConfig.weekends),v.truncateEventTitles();var t=e.classCalendar.fullCalendar("getDate");T(t)},e.goToPrevious=function(){A(I("prev"))},e.goToNext=function(){A(I("next"))},e.filters={showDate:Date.today().toString("MM/dd/yyyy")},e.dateOptions=new m("#weekSelection"),e.dateOptions.$setBeforeShow(function(t,n){var r=$("#ui-datepicker-div");r.addClass("rlz-weekpicker"),r.on("mousemove",".ui-datepicker-calendar tbody tr",function(){$(this).addClass("ui-state-hover")}),r.on("mouseleave",".ui-datepicker-calendar tbody tr",function(){$(this).removeClass("ui-state-hover")}),n.input.datepicker("setDate",e.classCalendar.fullCalendar("getDate"))}),e.dateOptions.$setOnClose(function(t){t&&e.$applyAsync(function(){e.filters.showDate=new Date(t).toString("MM/dd/yyyy");var n=new Date(t);A(n)});var n=$("#ui-datepicker-div");n.removeClass("rlz-weekpicker"),n.off("mousemove",".ui-datepicker-calendar tbody tr"),n.off("mouseleave",".ui-datepicker-calendar tbody tr")}),e.dateOptions.$setOnSelect(function(){var e=$("a.ui-state-active");e.removeClass("ui-state-active")});var E={gotoCurrent:!0,showAnim:"",onChangeMonthYear:function(){var t=d(function(){e.$broadcast("datepicker.showWeeklyHighlight")},1,!1);e.$on("$destroy",function(){d.cancel(t)})}};angular.extend(e.dateOptions,E),e.createEventModal={preSelectedClassIds:[a.classId],classRosters:_.map(i,function(e){return _.pick(e,"className","classId")})},e.$on("calendar.createSuccess",function(){var t=e.classCalendar.fullCalendar("getDate");return A(t).then(function(){var t=["<strong>",r("calendar.createEvent.successNotification.title"),"</strong>",r("calendar.createEvent.successNotification.message")].join(" ");o.addAlert("success","ok-sign",t),e.alertDetails=o.alerts[0],e.alertIsSet=o.alertIsSet()})}),e.$on("calendar.createFailed",function(){var t="calendar.createEvent.errorNotification.generic.message",n=r(t);o.addAlert("error","exclamation-sign",n),e.alertDetails=o.alerts[0],e.alertIsSet=o.alertIsSet()}),e.navigationFallback="/classes"}]),angular.module("Realize.calendar.uiCalendarDirective",[]).config(["$provide",function(e){"use strict";e.decorator("uiCalendarDirective",["$delegate",function(e){var t=e[0],n=t.link;return t.compile=function(){var e=function(e){n.apply(this,arguments),e.$eval(angular.element("#calendar table").attr("aria-labelledby","calendarTitle"))};return e},e}])}]),angular.module("Realize.calendar",["Realize.calendar.classCalendarCtrl","Realize.calendar.uiCalendarDirective","Realize.calendar.calendarService","Realize.calendar.calendarEventCtrl","Realize.calendar.calendarEvent","Realize.calendar.calendarEventModal","Realize.calendar.eventSource","Realize.calendar.routes"]),angular.module("Realize.calendar.routes",["Realize.assignment.facadeService","Realize.content","Realize.paths"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n=["$q","$currentUser",function(e,t){var n=t.hasRole("ROLE_TEACHER");return n?e.when(1):e.reject("Insufficient Privileges!")}],r={controller:"ContentCtrl",templateUrl:t.TEMPLATE_ROOT+"/views/contentViewer.html",resolve:{_security:n,ContentViewerData:["ContentResolver",function(e){return e()}]}},s={controller:"AssignmentLandingCtrl",templateUrl:t.TEMPLATE_ROOT+"/assignment/common/landing.html",resolve:{_security:n,RosterData:["Resolve",function(e){return e.ClassRoster()}],resolveAssignmentData:["Resolve",function(e){return e.SingleLWCAssignment()}]}};e.when("/classes/:classId/calendar",{controller:"ClassCalendarCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/classes/calendar/classesCalendar.html",resolve:{_security:n,ClassRosters:["Resolve",function(e){return e.ClassRosters()}],CurrentRoster:["Resolve",function(e){return e.ClassRoster()}],CalendarEvents:["Resolve",function(e){return e.CalendarEvents()}]}}).when("/classes/:classId/calendar/:itemId",{controller:"CalendarEventCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/classes/calendar/calendarEvent/calendarEvent.html",resolve:{_security:n,ClassRosters:["Resolve",function(e){return e.ClassRosters()}],CurrentRoster:["Resolve",function(e){return e.ClassRoster()}],myCalendarEvent:["Resolve","$route","AssignmentFacadeService","CalendarService",function(e,t,n,r){return r.getEventDetails(t.current.params.itemId,t.current.params.eventType).then(function(e){if(e&&"ASSIGNMENT"===e.eventType){var r=e.id;return n.getAllAssignedTos(r).then(function(n){return n=_.filter(n,function(e){return e.classUuid===t.current.params.classId}),e.assignedTo=n,e})}return e})}],GroupData:["Resolve",function(e){return e.GroupList()}]}}).when("/classes/:classId/calendar/:assignmentId/content/:itemId/:itemVersion",r).when("/classes/:classId/calendar/:assignmentId/preview",s).when("/classes/:classId/calendar/:assignmentId/preview/content/:itemId/:itemVersion",r).when("/classes/:classId/students",{controller:"StudentListCtrl",templateUrl:t.TEMPLATE_ROOT+"/views/studentsList.html",resolve:{_security:n,ClassRosterData:["Resolve",function(e){return e.ClassRoster()}]}})}]),angular.module("Realize.calendar.calendarService",["Realize.assignment.facadeService","Realize.paths","realize.core.isoDateService","Realize.calendar.calendarEvent","rlzComponents.components.i18n"]).service("CalendarService",["$log","$http","AssignmentFacadeService","$routeParams","CalendarEvent","REST_PATH","Messages","$q","ISODateService",function(e,t,n,r,s,a,i,o,l){"use strict";this.openTeacherPreview=function(e){var t=["/classes",r.classId,"calendar",e.id,"preview"].join("/");n.preview(t)},this.getEventDetails=function(e){var n,r;return n=a+"/events/"+e,r=t.get(n,{params:{includeItem:!0}}).then(function(e){return new s(e.data)},function(e){return o.reject("Failed to get event details: ",e)})},this.getMonthViewRange=function(e){var t=e.clone(),n=t.moveToFirstDayOfMonth().clone(),r=t.moveToLastDayOfMonth().clone();return n.is().sunday()||n.prev().sunday(),r.is().saturday()||r.saturday(),{firstSunday:n,lastSaturday:r}},this.getWeekViewRange=function(e){var t=e.clone();return t.is().sunday()||t.prev().sunday(),{sunday:t,saturday:t.clone().saturday()}},this.getDateRange=function(e,t){var n,r=e.clone();if("basicWeek"===t){var s=this.getWeekViewRange(r);n={startDate:l.toDateStringWithZone(s.sunday),endDate:l.toDateStringWithZone(s.saturday.add(1).days())}}else{var a=this.getMonthViewRange(r);n={startDate:l.toDateStringWithZone(a.firstSunday),endDate:l.toDateStringWithZone(a.lastSaturday.add(1).days())}}return n},this.isSameDate=function(e,t){return e.toString("MM/dd/yyyy")===t.toString("MM/dd/yyyy")},this.getDayName=function(e){var t=i.getMessagesAsArray("calendar.dayNames");return t[e.getDay()]},this.getMonthName=function(e){var t=i.getMessagesAsArray("calendar.monthNames");return t[e.getMonth()]},this.formatDate=function(e,t){var n=[this.getDayName(e)+",",this.getMonthName(e),e.toString("dd")].join(" ");return t&&(n+=[" |",e.toString("h:mm tt")].join(" ")),n},this.formatEventTimes=function(e){var t=e.parsedStart.clone(),n=e.parsedEnd.clone(),r=e.isTimed();return e.isAssignment()?this.formatDate(n):this.isSameDate(t,n)?r?this.formatDate(t,!0)+" - "+n.toString("h:mm tt"):this.formatDate(t):this.formatDate(t,r)+" - "+this.formatDate(n,r)},this.getSelectedClassIds=function(e){var t=_.filter(e,function(e){return e.selected===!0});return _.pluck(t,"classId")},this.getEvents=function(n,r){var i=[a,"classes",n,"events"].join("/"),l=t.get(i,{params:r}).then(function(e){var t=[];return _.each(e.data,function(e){t.push(new s(e))}),t},function(t){return e.error(t),o.reject("Failed to get events: ",t)});return l},this.getHours=function(){var e,t=[],n=function(e){return 12>e?"am":"pm"};for(e=0;24>e;e++){var r=e%12,s="";s=(0===r?"12":r)+":00 "+n(e),t.push(s)}return t}}]),angular.module("Realize.classes.edit",["rlzComponents.components.googleClassroom","Realize.core.security.permissions","RealizeDataServices","Realize.analytics","Realize.constants.googleClassroom","rlzComponents.components.googleClassroom.constants"]).controller("ClassEditCtrl",["$q","Permissions","$scope","$rootScope","ClassRosterData","ClassRoster","$location","Modal","$log","lwcI18nFilter","TEMPLATE_PATH","CONTINEO_SERVER_URL","CONTINEO_CAT_URL","Analytics","GOOGLE_CLASSROOM","googleClassroomService","GoogleClassroomConstants",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h){"use strict";var v,S=!0;n.CONTINEO_SERVER_URL=d,n.CONTINEO_CAT_URL=m,n.hasPermission=function(e){return n.isGoogleClass?!1:t.hasPermission(e)},n.roster=s,n.undoRoster=angular.copy(n.roster),n.rosterSuccess=!1,n.rosterError=!1,n.productCount=n.roster.productIds.length,n.rosterAffiliation=_.findWhere(n.currentUser.oleAffiliations,{organizationId:n.roster.organizationId}),n.hasInstitution=n.rosterAffiliation&&n.rosterAffiliation.orgDetails&&n.rosterAffiliation.orgDetails.displayName,n.isGoogleClass=s.rosterSource===p.ROSTER_SOURCE.GOOGLE_CLASSROOM,v=n.rosterAffiliation?n.rosterAffiliation.products:{},n.subscribedPrograms=_.where(v,{subscribed:!0}),n.$watch("subscribedPrograms",function(){angular.forEach(n.subscribedPrograms,function(e){e.checked=n.undoRoster.$hasProductId(e.productId)})}),n.rosterThumbs=$.Enumerable.From(a.thumbnailBank).Select("a => {caption: a.caption, image: a.image, url: '"+a.thumbnailRoot+"' + a.image}").ToArray(),n.federatedClassSettingAlert={showAlert:!0,title:c("federatedUser.editClass.alert.title"),description:c("federatedUser.editClass.alert.description1")+'<a class="underline" target="_self" href="'+m+'">'+c("federatedUser.editClass.alert.description2")+"</a>",closeFn:function(){n.federatedClassSettingAlert.showAlert=!1}},n.selectThumb=function(e){n.undoRoster.classImageUrl=e.url,n.selectedThumb=e,n.step1Form.$setDirty()},n.isSelectedThumbnail=function(e){var t=n.undoRoster.classImageUrl.replace("@2x","");return e.url===t},n.saveRoster=function(t){if(n.undoRoster.productIds.length<1)return l.warn("detailsForm is invalid, no programs"),n.programError=!0,e.reject("form is invalid!");if(n.step1Form.$valid){var r=o.progressDialog(n.$new(),{progressHeader:c("editClass.savingProgress.title"),progressMessage:c("editClass.savingProgress.message")}).then(function(){r.fakeProgress()});n.undoRoster.updateTheme=n.undoRoster.learningExperience!==n.roster.learningExperience,n.undoRoster.updateTheme&&g.track("track.action",{category:"Classes",action:"Change Theme",label:n.undoRoster.learningExperience}),n.undoRoster.$save(function(e){n.currentUser.removeClassWithoutPrograms(e.classId),r.then(function(){r.progressComplete().then(function(){o.hideDialog()})}),n.rosterSuccess=!0,angular.copy(n.undoRoster,n.roster),n.step1Form.$setPristine(),n.currentUser.getAttribute("classes.created")||n.currentUser.setAttribute("classes.created",!0);var s=n.currentUser.getAttribute("classes.withoutPrograms")||[];0===e.productIds.length?_.contains(s,e.classId)||s.push(e.classId):s=_.without(s,e.classId),n.currentUser.setAttribute("classes.withoutPrograms",s),angular.isDefined(t)&&t()})}},n.setProductId=function(e){l.log("setProductId",e,n.undoRoster.productIds),n.roster.$hasProductId(e)||(n.undoRoster.$hasProductId(e)?(n.undoRoster.productIds=_.without(n.undoRoster.productIds,e),n.productCount=n.undoRoster.productIds.length):(n.undoRoster.productIds.push(e),n.productCount=n.undoRoster.productIds.length),n.step1Form.$setDirty())},n.openStudents=function(e,t){e.preventDefault(),e.stopPropagation(),i.path("/classes/"+t.classId+"/students")},n.navigationFallback="/classes",r.$on("$locationChangeStart",function(e,t,s){var a;S&&n.step1Form&&n.step1Form.$dirty&&(e.preventDefault(),a=n.$new(),a.delegate={close:function(){o.hideDialog(),S=!0,r.viewLoading=!1},discard:function(){o.hideDialog(),S=!1,i.url(t.replace(s.replace(i.url(),""),""))},save:function(){o.hideDialog(),S=!1,n.saveRoster(function(){i.url(t.replace(s.replace(i.url(),""),""))})}},o.showDialog("templates/partials/unsaved_edit_dialog.html",a))}),n.redirectToGoogleClassroom=function(){var e={extensions:{area:h.CLASSES,page:p.EDIT_CLASS_SETTINGS,product:h.EVENT_TYPE.PROGRAM_NOT_AVAILABLE,description:p.GOOGLE_EDIT_CLASS},definition:{name:p.CONNECT_CLASS}};f.redirectToGoogleClass(n.roster.classId,n.roster.rosterSource,p.OPEN,e)}}]),angular.module("RealizeApp").controller("StudentListCtrl",["$scope","$log","$timeout","$interval","Permissions","ClassRosterData","Modal","$q","User","lwcI18nFilter","InlineAlertService","$location","ClassRoster","contentRowModal","EarlyLearnerService","AlertService","Analytics","GOOGLE_CLASSROOM","PARTIALS_PATHS","googleClassroomService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T){"use strict";e.students=a.students;var A;if(_.each(e.students,function(e){e.canRemove=!0,e.removed=!1}),e.getTheme=function(e){return e.userAttributes["profile.learningExperience"]},e.stopInterval=function(){r.cancel(A)},e.hasPermission=s.hasPermission,e.federatedStudentAccountAlert={showAlert:!0,title:c("federatedUser.studentList.alert.title"),description:c("federatedUser.studentList.alert.description1")+"<br />"+c("federatedUser.studentList.alert.description2"),closeFn:function(){e.federatedStudentAccountAlert.showAlert=!1}},e.shouldDisplayResetPasswordLink=function(){return!e.currentUser.isFederatedUser&&!e.isGoogleClass||e.isGoogleClass},e.studentsAndGroupOptionsTemplate=S.studentsAndGroupOptions,e.isGoogleClass=a.rosterSource===v.ROSTER_SOURCE.GOOGLE_CLASSROOM,e.isGoogleClass){var I=function(){return e.showStudentDelayMsg=!0,g.deactivate()},E={label:c("studentList.modal.buttons.close"),action:function(){I()},className:"button-cancel",ariaLabel:c("studentList.modal.buttons.close"),disabled:!1},y=[E];e.stopInterval(),A=r(function(){T.getClassProcessingStatus(e.currentRoster.classId).then(function(t){t.data.getClassProgress[0].courseProgress===v.SYNC_COMPLETED?e.isSyncInProgress?m.get({noCachedData:!0,classId:e.currentRoster.classId}).then(function(t){e.students=t.students,e.isSyncInProgress=!1,e.showStudentDelayMsg=!1,I(),e.stopInterval()},function(){return o.reject("error getting roster! "+e.currentRoster.classId)}):e.stopInterval():(e.isSyncInProgress||e.showStudentDelayMsg||g.activate({cssClass:"modal__contentRowModal studentListDelay__modal",heading:c("studentList.modal.header"),description:c("studentList.modal.body"),buttons:y,closeButton:!0,overlayActive:!0,closeAction:function(){I()}}),e.isSyncInProgress=!0)})},5e3)}e.redirectToGoogleClassroom=function(){T.redirectToGoogleClass(e.currentRoster.classId,e.currentRoster.rosterSource)},e.getStudentConsent=function(e){return e.userAttributes.googleConsentProvided},e.edit=function(n,r){n&&(n.preventDefault(),n.stopPropagation());var s=e.$new(!0),a=function(){s.$destroy()};s.student=angular.copy(r),s.cancel=function(){i.hideDialog(),a()},s.save=function(){return s.editStudentForm.$invalid?(s.isInProgress=!1,void 0):(s.student.$update().success(function(){s.student.$updateNames(),angular.copy(s.student,r),i.hideDialog(),u.addAlert(r.userId,{type:"success",msg:["<strong>",c("studentList.successNotification.studentEdited.title"),"</strong> ",c("studentList.successNotification.studentEdited.message")].join("")}),e.studentEditedSuccess=!0,m.clearClassRosterCache(),a()}).error(function(e){t.error("Error updating student!",e),i.hideDialog(),a()}),void 0)},i.showDialog("templates/partials/student_edit.html",s)},e.resetPasswordSuccess=function(t){e.passwordResetSuccess=!0,u.addAlert(t,{type:"success",msg:["<strong>",c("studentList.successNotification.passwordReset.title"),"</strong> ",c("studentList.successNotification.passwordReset.message")].join("")})},e.$on("addStudentModal.studentAdded",function(t,n){e.studentAddedSuccess=!0,u.addAlert(n.userId,{type:"success",msg:["<strong>",c("studentList.successNotification.studentAdded.title"),"</strong> ",c("studentList.successNotification.studentAdded.message")].join("")})}),e.$on("$routeChangeStart",function(){a.students=$.Enumerable.From(a.students).Where("$.canUndoRemove !== true").ToArray(),a.studentIds=$.Enumerable.From(a.students).Select("$.userId").ToArray()}),e.remove=function(e,t){e&&(e.preventDefault(),e.stopPropagation()),t.beingRemoved=!0,a.$removeStudents(t.userId,function(){t.canUndoRemove=!0,t.removed=!0,t.beingRemoved=!1})},e.undoRemove=function(e,t){e&&(e.preventDefault(),e.stopPropagation()),t.canRemove=!1,a.$addStudents(t.userId,function(){t.canUndoRemove=!1,t.removed=!1,t.canRemove=!0})};var R,C,D;e.$on("manageStudentsMode",function(t,n){e.manageStudentsMode=!0,e.managedGroup=n,angular.forEach(e.students,function(e){e.checked=$.Enumerable.From(n.$getMembers(a.classId).studentIds).IndexOf(e.userId)>=0}),R=$.Enumerable.From(e.students).Where("$.checked").ToArray()}),e.checkboxChangedFor=function(e){e.isSelected=e.checked,e.beingRemoved=!e.checked},e.$watch("students",function(){_.each(e.students,function(e){angular.isUndefined(e.canRemove)&&(e.canRemove=!0)}),e.manageStudentsMode&&(C=$.Enumerable.From(e.students).Where("$.checked").ToArray(),D=$.Enumerable.From(e.students).Where("!($.checked)").ToArray(),C.length>0&&e.managedGroup.$addStudents(a.classId,C),D.length>0&&e.managedGroup.$removeStudents(a.classId,D))},!0),e.cancel=function(){var t=_.reject(C,function(e){return _.find(R,function(t){return t.userId===e.userId})}),n=_.filter(D,function(e){return _.find(R,function(t){return t.userId===e.userId})});e.managedGroup.$removeStudents(a.classId,t),e.managedGroup.$addStudents(a.classId,n),e.$broadcast("manageStudentsCanceled"),e.manageStudentsMode=!1,angular.forEach(e.students,function(e){e.isSelected=e.beingRemoved=!1,e.canRemove=!0})},e.save=function(){e.manageStudentsMode&&e.managedGroup.$saveMembers(a.classId).then(function(n){t.log("success saving group",n),e.groupSaveSuccess=!0,e.$broadcast("manageStudentsCompleted"),e.manageStudentsMode=!1,angular.forEach(e.students,function(e){e.isSelected&&u.addAlert(e.userId,{type:"success",msg:["<strong>",c("studentList.successNotification.studentAdded.title"),"</strong> ",c("studentList.successNotification.studentAdded.message")].join("")}),e.beingRemoved&&u.addAlert(e.userId,{type:"remove",msg:["<strong>",c("studentList.successNotification.studentRemoved.title"),"</strong> ",c("studentList.successNotification.studentRemoved.message")].join("")}),e.isSelected=e.beingRemoved=!1,e.canRemove=!0})},function(e){t.error("error saving group",e)})},e.actionFor=function(e){return e.checked?"selected":"remove"},e.navigationFallback="/classes",f.alertIsSet()&&(e.alertDetails=f.alerts[0],e.alertIsSet=f.alertIsSet()),e.goToChangeTheme=function(){p.gotoChangeThemePage()},e.displayShowGroups=function(){return!(0===e.students.length||e.manageStudentsMode||e.isGoogleClass)},e.displayAddStudent=function(){return e.hasPermission("add_student")&&!e.isGoogleClass},e.displayRemoveStudent=function(t){return t.canRemove&&!e.isGoogleClass},e.addAnalyticsShowGroups=function(){h.track("track.action",{category:"Classes",action:"Students & Groups",label:"Students & Groups - Show groups"})},e.addAnalyticsAddStudent=function(){h.track("track.action",{category:"Classes",action:"Students & Groups",label:"Students & Groups - Add student to class"})},e.isNoGoogleClassWithNoStudent=function(){return 0===e.students.length&&!e.isGoogleClass},e.isGoogleClassWithNoStudent=function(){return 0===e.students.length&&e.isGoogleClass},e.$on("$destroy",function(){e.stopInterval()})}]),angular.module("Realize.header.mainNav",["Realize.paths","Realize.analytics","Realize.content.model.contentItem","Realize.content.model.openEdItem","rlzComponents.components.i18n","Realize.filters.ellipses","Realize.user.currentUser","Realize.common.mediaQueryService","Realize.common.optionalFeaturesService","Realize.constants.googleClassroom","Realize.constants.partialsPaths","rlzComponents.components.googleClassroom.constants","rlzComponents.components.help.dialog"]).constant("EXTERNAL_URLS",{TEACHER_HELP_URL:window.teacherHelpUrl,STUDENT_HELP_URL:window.studentHelpUrl,NEW_FEATURES_URL:window.newFeaturesUrl,TRAINING_LINK_URL:window.trainingLinkUrl,TECHNICAL_SUPPORT_LINK_URL:window.technicalsupportLinkUrl,CONTACT_PROGRAM_LINK_URL:window.contactProgramSpecialistLinkUrl}).directive("realizeMainNav",[function(){"use strict";
return{restrict:"E",template:'<div ng-include src="mainNavCtrl.headerTmplUrl"></div>',scope:{},controller:["$rootScope","$location","$currentUser","$sce","$window","lwcI18nFilter","MediaQuery","PATH","EXTERNAL_URLS","Content","OpenEdItem","Analytics","$routeParams","ContentSource","$route","MEDIA_PATH","BrowserInfo","OptionalFeatures","GOOGLE_CLASSROOM","searchTelemetryUtilitiesService","googleClassroomService","GoogleClassroomConstants","featureManagementService","browseLinkTelemetryService","helpMenuService","helpDialog","KEY_CODES",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R,C,D){function b(){_.headerTmplUrl=i.breakpoint.isSmallTablet?w.smallTablet:w.desktop}function P(e){return"online_help"===e&&!i.breakpoint.isSmallTablet}var w={desktop:o.COMPONENT+"/app/header/mainNav/mainNav.html",smallTablet:o.COMPONENT+"/app/header/mainNav/mainNavSmallTablet.html"},L=f+"/skins/default/images/",$=L+"realize_logo.png",O=L+"realize_logo@2x.png",_=this;_.browse=function(e){this.location.path("/program"),this.location.search({}),e&&y.sendTelemetryEvents(e)},_.getHelpUrl=function(){var e=_.currentUser.hasRole("ROLE_STUDENT"),t=R.getCshId(e),n=_.externalUrls.STUDENT_HELP_URL+"#cshid="+t.codedCshId,s=_.externalUrls.TEACHER_HELP_URL+"#cshid="+t.codedCshId,a=e?n:s;return console.log("Generated cshid s ",t),r.trustAsResourceUrl(a)},_.callHelpMenuTelemetry=function(e){R.sendTelemetryEvents(e,!this.currentUser.isTeacher),P(e)&&setTimeout(function(){C.activate({cssClass:"helpFloating__dialog",description:"",heading:a("header.helpDialog.help"),iframeSrc:_.getHelpUrl(),path:t.path().replace("/community/",""),closeAction:function(){C.deactivate()}})},0)},_.onEnter=function(e,t){e.keyCode===D.ENTER&&("program_training"===t?(_.callHelpMenuTelemetry(t),s.open(_.externalUrls.TRAINING_LINK_URL)):"technical_support"===t?(_.callHelpMenuTelemetry(t),s.open(_.externalUrls.TECHNICAL_SUPPORT_LINK_URL)):"contact_program_specialist"===t&&(_.callHelpMenuTelemetry(t),s.open(_.externalUrls.CONTACT_PROGRAM_LINK_URL)))},_.search=function(e){var n,r,s;if(e){if(("."===e||"-"===e)&&(e=""),_.searchThisProgramChecked)return r=new g(g.getByPath()),r.filterData.set("resources.search.keyword",e),s=t.path().indexOf("/resources")>=0,s?p.reload():(n=["/program",m.programId,m.programVersion,"resources"].join("/"),t.path(n)),void 0;c.filterData.empty(),u.filterData.empty(),t.path("/search").search({keywords:e}),d.track("track.action",{category:"Search",action:"Keyword ("+e+")"}),T.sendTelemetryEventsFromSearchButton(e)}},_.inProgramsTab=function(){var e=t.path().split("/program")[1];return n.isTeacher&&e&&e.length>0?!0:(_.searchThisProgramChecked=!1,!1)},_.isGoogleClassroomFeatureEnabled=function(){return E.isGoogleClassroomEnabled()},_.close=function(e){"icon-remove-sign"!==e.target.getAttribute("class")&&e.stopPropagation()},_.externalUrls=l,_.currentUser=n,_.location=t,_.homePageImage=h.isHDDisplay?O:$,_.hasTeacherRole=_.currentUser.isTeacher,_.inMyLibraryTab=function(){return 0===_.location.path().search("/myLibrary")||0===_.location.path().search("/playlist")},_.launchMyLibrary=function(){_.location.path("/myLibrary")},b(),e.$on("window.breakpoint.change",function(){b()})}],controllerAs:"mainNavCtrl"}}]),angular.module("RealizeApp").controller("CentersSubNavCtrl",["$scope","$rootScope","$location","$log","SHARED_THUMBNAIL_PATH","Resolve","BrowserInfo","MediaQuery",function(e,t,n,r,s,a,i,o){"use strict";e.programs=[],e.shortenLabels=!o.breakpoint.isDesktop,a.CentersProgramListInfo().then(function(t){e.programs=t.programs}),t.$watch("currentProgram",function(t){t&&e.programs&&(e.currentProgram=t,e.ddList=$.Enumerable.From(e.programs).Where("$.id != '"+e.currentProgram.id+"'").ToArray())},!0),e.$watch("programs",function(n){n&&t.currentProgram&&(e.currentProgram=t.currentProgram,e.ddList=$.Enumerable.From(e.programs).Where("$.id != '"+e.currentProgram.id+"'").ToArray())},!0),e.sortBy=e.currentUser.getAttribute("programs.defaultSort")||"+gradeNumbers[0]",e.programThumb=function(e){if(!e.thumbnailLocation||""===e.thumbnailLocation)return"";var t=".png";return i.isHDDisplay&&(t="@2x"+t),s+"/"+e.thumbnailLocation+"_course"+t},e.open=function(t){if(t=t.$getDefaultVersion(),"blank"!==t.id&&t.centersProperties&&t.centersProperties.itemUuid){var s=n.path();s.search("/tier/")>=0&&(s=s.split("/tier/")[0]),s.search("/tier2/")>=0&&(s=s.split("/tier2/")[0]),s.search("/center/")>=0&&(s=s.split("/center/")[0]),s=s.replace(e.currentProgram.id+"/"+e.currentProgram.version,t.id+"/"+t.version),s=s.replace(e.currentProgram.centersProperties.itemUuid,t.centersProperties.itemUuid),n.path(s)}else r.log("invalid new path")},e.$on("window.breakpoint.change",function(){e.$apply(function(){e.shortenLabels=!o.breakpoint.isDesktop})})}]),angular.module("Realize.header.subNav.classes",["RealizeDataServices","Realize.common.mediaQueryService","Realize.constants.truncationLength"]).controller("ClassesSubNavCtrl",["$scope","$location","$log","ClassRoster","$routeParams","MediaQuery","$route","TRUNCATION_LENGTH",function(e,t,n,r,s,a,i,o){"use strict";e.rosters=[];var l=function(){var e;return e=a.breakpoint.isLargeTablet?o.LARGE_TABLET.CLASS_TITLE:a.breakpoint.isSmallTablet?o.SMALL_TABLET.CLASS_TITLE:null};e.truncateTo=l();var c=e.currentUser.hasRole("ROLE_STUDENT");r.get(c?{studentId:e.currentUser.userId}:null).then(function(t){e.rosters=t},function(e){n.error("error loading classes for subnav: ",e)}),e.withoutCurrent=function(e){return e.classId!==s.classId},e.open=function(e){var n=t.path();n.search("/overview/assignment")>=0?n=n.split("assignment")[0]:n.search("/assignments")>=0?n=n.search("student")>=0||n.search("discussPrompt")>=0?"/classes/"+e.classId+"/assignments":n.split("assignments")[0]+"assignments":n.search("/calendar")>=0?n=n.split("calendar")[0]+"calendar":n.search("/discussPrompt")>=0?n=n.split("discussPrompt")[0]+"discussPrompt":n.search("/standards/students/")>=0&&(n=n.split("standards/students/")[0]+"standards"),t.path(n.replace(s.classId,e.classId))},e.$on("$routeChangeSuccess",function(){s.classId&&r.get(s.classId).then(function(t){e.currentRoster=t})}),e.$on("window.breakpoint.change",function(){e.$apply(function(){e.truncateTo=l()})}),e.activeAssignmentTab=function(){return t.path().search("/assignments")>=0&&!t.search().discuss},e.activeDiscussTab=function(){return t.path().search("/discussPrompt")>=0&&(t.path().search("/assignments")<0||!!t.search().discuss&&"active"===t.search().discuss)},e.clickDiscussTab=function(){t.search("activeTab",null),t.search("promptView",null);var n=t.path(),r="/classes/"+e.currentRoster.classId+"/discussPrompt";r===n?"create"===i.current.scope.currentView||"edit"===i.current.scope.currentView?i.current.scope.$emit("discuss.prompt.createView.change","active"):"list"===i.current.scope.currentView&&i.current.scope.$emit("prompt.view.change","active"):t.path(r).search({})}}]),angular.module("RealizeApp").controller("ProgramSubNavCtrl",["$scope","$rootScope","$location","$log","Resolve","$route","ProgramService","Modal","MediaQuery","ContentSource","browseAllEventTracking","browseAllService",function(e,t,n,r,s,a,i,o,l,c,u,d){"use strict";t.subNavLoading=!0,e.programs=[],e.shortenLabels=!l.breakpoint.isDesktop,e.sortBy=t.currentUser.getAttribute("programs.defaultSort")||"+gradeNumbers[0]",s.ProgramListInfo().then(function(n){var r=t.currentUser.getAttribute("programs.favorites")||[],s=n.programs;_.each(s,function(e){e.isFavorite=!_.contains(r,e.id)}),e.programs=s,e.$route=a,t.currentProgram||(t.currentProgram=_.findWhere(e.programs,{id:a.current.params.programId})),t.subNavLoading=!1},function(e){r.error("error getting programs for subnav!",e)}),e.withoutCurrent=function(e){return e.id!==a.current.params.programId},e.open=function(e){var t=e.$getDefaultVersion(),r=t.id,s=t.version,i=n.path(),o=i.search("/review")>=0;"NBC Learn"===e.externalSource?n.path("nbclearn/browse"):i.search("/eText")>=0?n.path("/program/"+r+"/"+s+"/eText"):i.search("/leveledreaders")>=0?n.path("/program/"+r+"/"+s+"/leveledreaders"):o?(n.search("lastSelectedGrade",null),n.path("/review/program/"+r+"/"+s+"/standards")):i.search("/standards")>=0&&!o?(n.search("lastSelectedGrade",null),n.path("/program/"+r+"/"+s+"/standards")):i.search("/resources")>=0?n.path("/program/"+r+"/"+s+"/resources"):(a.current.params.lastSelectedGrade&&n.search("lastSelectedGrade",null),n.path("/program/"+r+"/"+s))},e.toolPreview=function(t){o.toolDialog(e,t,"Solution")},e.openBrowseAllPrograms=function(){d.setCurrentPageIndex(1),d.setSelectedFacets({}),d.setSelectedPrograms([]),d.setSearchKeyword(""),u.onBrowseAllContent(),n.path("/browseAll")},e.isTeacher=function(){return e.currentUser.isTeacher},e.loadTools=function(){e.loadingTools=!0,i.loadAssociatedTools(e.currentProgram).then(function(){e.loadingTools=!1},function(){e.loadingTools=!1})},e.$on("window.breakpoint.change",function(){e.$apply(function(){e.shortenLabels=!l.breakpoint.isDesktop})}),e.isTOCActive=function(){return-1===n.path().search("/standards")&&-1===n.path().search("/leveledreaders")&&-1===n.path().search("/eText")&&-1===n.path().search("/resources")||n.path().search("/eText2")>=0},e.isStandardsActive=function(){return n.path().search("/standards")>=0},e.isLeveledreadersActive=function(){return n.path().search("/leveledreaders")>=0},e.isResourcesActive=function(){return n.path().search("/resources")>=0},e.isETextActive=function(){return-1===n.path().search("/eText2")&&n.path().search("/eText")>=0},e.goToResources=function(){angular.forEach(c.PROVIDER,function(e){e=new c(e),e.filterData.remove("resources.search.keyword")});var t=n.path().split("/resources")[1]&&n.path().split("/resources")[1].length>1;if(e.isResourcesActive()&&!t)a.reload();else{var r=["/program",a.current.params.programId,a.current.params.programVersion,"resources"].join("/");n.path(r)}n.search({})}}]),angular.module("Realize.header.subNav",["Realize.header.subNav.classes","rlzComponents.components.myLibrary.myLibrarySubnav"]),angular.module("RealizeApp").controller("ReviewerHomeCtrl",["$scope","$log","SHARED_THUMBNAIL_PATH","$location","BrowserInfo",function(e,t,n,r,s){"use strict";e.background=n+"/homepage/"+(e.currentUser.getAttribute("home.background")||"teacher6")+(s.isHDDisplay?"@2x.jpg":".jpg"),e.getStarted=function(){r.path("/review/program")},e.step1More=function(e){e.preventDefault(),e.stopPropagation(),r.path("/program")},e.step2More=function(e){e.preventDefault(),e.stopPropagation(),r.path("/classes")},e.step3More=function(e){e.preventDefault(),e.stopPropagation(),r.path("/data")},e.step4More=function(e){e.preventDefault(),e.stopPropagation(),r.path("/centers")}}]),angular.module("RealizeApp").controller("StudentHomeCtrl",["$scope","$log","SHARED_THUMBNAIL_PATH","$location","$q","ClassRoster","AssignmentFacadeService","DISTANT_FUTURE_DATE","ProgramService","BrowserInfo","browseLinkTelemetryService",function(e,t,n,r,s,a,i,o,l,c,u){"use strict";e.background=n+"/homepage/"+(e.currentUser.getAttribute("home.background")||"teacher6")+(c.isHDDisplay?"@2x.jpg":".jpg"),e.DISTANT_FUTURE_DATE=o,e.totalPrograms=0,e.rosters=[],e.programs=[],e.rosterAssignments=0;var d=function(){var t=[],n=i.getClassesReportingData();return n.then(function(n){var r,s;r=n,$.Enumerable.From(r).OrderBy("$.reportingData.nextAssignmentDueDate").ForEach(function(t){t.reportingData.nextAssignmentDueDate?(e.rosterAssignments++,t.minAssignment=t.reportingData.nextAssignmentDueDate):t.minAssignment=o,t.numCompletedAssignments=t.reportingData.assignmentCompletionCount}),s=r,s=$.Enumerable.From(s).OrderBy("$.minAssignment").ToArray(),angular.copy(s,t)}),t};e.rosters=d(),e.numClasses=" ",e.$watch("rosters.length",function(t){e.numClasses=t>1?" "+t+" ":" ",e.gradedRosters=$.Enumerable.From(e.rosters).Where(function(e){return e.numCompletedAssignments>0}).OrderByDescending("$.numCompletedAssignments").ToArray()}),l.getAllPrograms().then(function(t){e.programs=_.first(t.results,2),e.totalPrograms=t.totalMatches}),e.thumbnailStyle=function(e){return{visibility:""===e.thumbnailLocation?"hidden":"visible"}},e.open=function(e,t){e.preventDefault(),e.stopPropagation(),t=t.$getDefaultVersion(),r.path("/program/"+t.id+"/"+t.version)},e.viewGrades=function(e,t){e.preventDefault(),e.stopPropagation(),r.path("/grades/"+t.classId+"/overview")},e.step1More=function(t,n){t.preventDefault(),t.stopPropagation(),n&&u.sendTelemetryEvents(n),1===e.programs.length?r.path("/program/"+e.programs[0].id+"/"+e.programs[0].version):r.path("/program")},e.step2More=function(e,t){e.preventDefault(),e.stopPropagation(),t&&u.sendTelemetryEvents(t),r.path("/classes")},e.openRoster=function(e,t){e.preventDefault(),e.stopPropagation(),r.path("/classes/"+t.classId+"/assignments")},e.step3More=function(e){e.preventDefault(),e.stopPropagation(),r.path("/grades")}}]),angular.module("RealizeApp").controller("TeacherHomeAssignmentsCtrl",["Permissions","$scope","$location","$log","HOME_STATES","ClassUtil",function(e,t,n,r,s,a){"use strict";var i,o;t.phase.assignments.header=t.assignmentsCreated?s.completed:s.notStarted,t.classesCreated?t.assignmentsCreated?t.assignmentsCreated&&t.classesCreated&&(t.classes.length>0||t.rostersLoading)&&(t.phase.assignments.content=s.loading):t.phase.assignments.content=s.noAssignment:e.hasPermission("create_class")?(t.phase.assignments.content=s.noAssignment,t.phase.assignments.quickLink=s.create):e.hasPermission("edit_class_in_SIS")&&(t.phase.assignments.content=s.noAssociatedPrograms,t.phase.assignments.quickLink=s.none),t.$on("homeTeacherCtrl.rosters.load.complete",function(){switch(i=a.hasAtLeastOneStudentInRosters(t.classes),o=a.hasAtLeastOneClassWithProduct(t.classes,t.classesWithoutProduct),0===t.classes.length?t.phase.assignments.content=s.allHidden:!i&&e.hasPermission("add_student_in_SIS")?(t.phase.assignments.content=s.mustAddStudentInSIS,t.currentUser.getAttribute("federatedUser.noStudents.info.seen")||0===n.path().search("/welcome")||(o?t.showModalFederatedUserHasClassesWithoutStudent():t.showModalFederatedUserNoStudentAndAllClassesWithoutProduct())):t.assignmentsCreated&&t.classes.length>0?t.phase.assignments.content=s.complete:o||0===n.path().search("/welcome")||t.currentUser.getAttribute("federatedUser.noAssociatedPrograms.info.seen")||!t.currentUser.isFederatedUser||t.showModalFederatedUserALLClassesWithoutProduct(),t.phase.assignments.content){case s.allHidden:e.hasPermission("create_class")&&(t.phase.assignments.quickLink=s.create);break;case s.noAssignment:t.phase.assignments.quickLink=s.findItems;break;case s.mustAddStudentInSIS:t.phase.assignments.quicklink=s.none;break;case s.complete:1===t.classes.length?t.phase.assignments.quickLink=s.oneClass:t.classes.length>1?t.phase.assignments.quickLink=s.manyClasses:r.error("home.teacher.data.ctrl: should not have negative classes length")}}),t.more=function(e){switch(e.preventDefault(),e.stopPropagation(),t.phase.assignments.quickLink){case s.create:n.path("/classes/create");break;case s.oneClass:n.path(["/data",t.classes[0].classId,"overview"].join("/"));break;case s.findItems:n.path("/program");break;default:n.path("/data")}},t.open=function(e,t){e.preventDefault(),e.stopPropagation(),n.path(["/data",t.classId,"overview"].join("/"))}}]),angular.module("RealizeApp").controller("TeacherHomeClassesCtrl",["Permissions","$scope","$location","HOME_STATES",function(e,t,n,r){"use strict";t.classesCreated?t.classesVisited||t.assignmentsCreated?(t.classes.length>0||t.rostersLoading)&&(t.phase.classes.header=t.assignmentsCreated?r.complete:r.inProgress,t.phase.classes.content=r.loading):(t.phase.classes.header=r.notStarted,t.phase.classes.content=r.existingClass):(t.phase.classes.header=r.notStarted,e.hasPermission("create_class")?(t.phase.classes.content=r.noClass,t.phase.classes.quickLink=r.create):e.hasPermission("edit_class_in_SIS")&&(t.phase.classes.content=r.noAssociatedPrograms,t.phase.classes.quickLink=r.none)),t.$on("homeTeacherCtrl.rosters.load.complete",function(){t.phase.classes.content===r.loading&&(0===t.classes.length?t.phase.classes.content=r.allHidden:t.classes.length>0&&(t.phase.classes.content=r.complete)),0===t.classes.length&&e.hasPermission("create_class")?t.phase.classes.quickLink=r.create:1===t.classes.length?t.phase.classes.quickLink=r.oneClass:t.classes.length>1&&(t.phase.classes.quickLink=r.manyClasses)}),t.more=function(s){switch(s.preventDefault(),s.stopPropagation(),t.phase.classes.quickLink){case r.create:e.hasPermission("create_class")&&n.path("/classes/create");break;case r.oneClass:n.path("/classes/"+t.classes[0].classId+"/assignments");break;default:n.path("/classes")}t.currentUser.setAttribute("classes.visited",!0)},t.open=function(e,t){e.preventDefault(),e.stopPropagation(),n.path(["/classes",t.classId,"assignments"].join("/"))}}]),angular.module("RealizeApp").controller("TeacherHomeProgramsCtrl",["$scope","Content","$location","$log","SHARED_THUMBNAIL_PATH","ProgramService","HOME_STATES","BrowserInfo","browseLinkTelemetryService",function(e,t,n,r,s,a,i,o,l){"use strict";e.phase.programs.content=i.loading,e.totalPrograms=0,e.programs=[],a.getAllPrograms().then(function(t){e.programs=t.results,e.totalPrograms=t.totalMatches,e.phase.programs.content=i.loading,1===e.totalPrograms?(e.phase.programs.quickLink=i.oneProgram,e.phase.programs.content=i.complete):e.totalPrograms>1&&(e.phase.programs.quickLink=i.manyPrograms,e.phase.programs.content=i.complete),e.phase.programs.loaded=!0,e.firstVisit&&(e.phase.programs.content=i.firstVisit)}),e.firstVisit?e.phase.programs.header=i.firstVisit:e.programsVisited&&!e.assignmentsCreated?e.phase.programs.header=i.inProgress:e.assignmentsCreated&&(e.phase.programs.header=i.complete),e.programThumb=function(t){if(""===t.thumbnailLocation)return"";var n=".png";return o.isHDDisplay&&(n="@2x"+n),1!==e.programs.length||e.firstVisit?s+"/"+t.thumbnailLocation+"_homesmall"+n:s+"/"+t.thumbnailLocation+"_homelarge"+n},e.more=function(t,r){t.preventDefault(),t.stopPropagation(),r&&l.sendTelemetryEvents(r),e.isNbcLearnUser()&&1===_.without(e.currentUser.subscribedCourses,"public").length?n.path("/nbclearn/browse"):1===e.programs.length?n.path("/program/"+e.programs[0].id+"/"+e.programs[0].version):n.path("/program")},e.open=function(e,t){e.preventDefault(),e.stopPropagation(),t=t.$getDefaultVersion(),"NBC Learn"===t.externalSource?n.path("/nbclearn/browse"):n.path("/program/"+t.id+"/"+t.version)}}]),angular.module("Realize.eText.eTextCtrl",[]).controller("ETextCtrl",["$log","$scope","$location","eTextData",function(e,t,n,r){"use strict";t.etexts=r,t.open=function(e,t){e.stopPropagation();var r=n.path();n.path([r.replace("eText","content"),t.id,t.version].join("/"))},t.back=function(){n.path("/program",!0)}}]),angular.module("Realize.eText",["Realize.eText.routes","Realize.eText.eTextCtrl"]),angular.module("Realize.eText.routes",["RealizeApp","Realize.paths","Realize.user.currentUser"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n=["$q","$currentUser",function(e,t){var n=t.hasRole("ROLE_TEACHER");return n?e.when(1):e.reject("Insufficient Privileges!")}];e.when("/program/:programId/:programVersion/eText",{controller:"ETextCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/eText/eText.ctrl.html",resolve:{_security:n,eTextData:["Resolve",function(e){return e.eText()}]}})}]),angular.module("Realize.leveledReaders.leveledReadersCtrl",["ngRoute","rlzComponents.components.i18n","Realize.leveledReaders.leveledReadersSvc","Realize.leveledReaders.leveledReadersScale","Realize.slider"]).controller("LeveledReadersCtrl",["$scope","$log","Messages","$location","$routeParams","Scales","LeveledReadersSvc","LeveledReadersScale",function(e,t,n,r,s,a,i,o){"use strict";e.firstVisit={showAlert:!e.currentUser.getAttribute("leveledReaders.info.seen"),title:n.getMessage("leveledReaders.firstVisit.title"),description:n.getMessage("leveledReaders.firstVisit.description"),closeFn:function(){e.currentUser.setAttribute("leveledReaders.info.seen",!0),e.firstVisit.showAlert=!1}},e.scales=a,e.expand=function(t){e.openScale=e.openScale!==t?t:null,e.$broadcast("slider.resetSliderValues")},e.getSearchResult=function(e){i.redirectToSearchPage(e)},e.back=function(){r.path("/program",!0)},e.isSelectedDraValuesEqual=function(e){return e.isDraScale()&&e.allSelectedValuesEqual()},e.$on("slider.change",function(){e.safeApply(function(){var t=o.shouldOffcenter(e.openScale);e.startOffcenter=t.startOffcenter,e.endOffcenter=t.endOffcenter})})}]),angular.module("Realize.leveledReaders",["Realize.leveledReaders.leveledReadersCtrl","Realize.leveledReaders.leveledReadersSvc","Realize.leveledReaders.leveledReadersScale","Realize.leveledReaders.leveledReadersSearchCtrl","Realize.leveledReaders.leveledReadersSearch","Realize.leveledReaders.routes"]),angular.module("Realize.leveledReaders.routes",["RealizeApp","Realize.content","Realize.paths"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n=["$q","$currentUser",function(e,t){var n=t.hasRole("ROLE_TEACHER");return n?e.when(1):e.reject("Insufficient Privileges!")}],r={controller:"ContentCtrl",templateUrl:t.TEMPLATE_ROOT+"/views/contentViewer.html",resolve:{_security:n,ContentViewerData:["ContentResolver",function(e){return e()}]}},s={controller:"LeveledReadersSearchCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/leveledReaders/leveledReadersSearch.ctrl.html",resolve:{_security:n,CurrentProgramLoaded:["Resolve",function(e){return e.CurrentProgramLoaded()}],CurrentScale:["LeveledReadersSvc",function(e){var t=e.getScaleTypeFromRoute();return e.getScale(t)}]},reloadOnSearch:!1};e.when("/program/:programId/:programVersion/leveledreaders",{controller:"LeveledReadersCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/leveledReaders/leveledReaders.ctrl.html",resolve:{_security:n,ZeroState:["$q","$rootScope",function(e,t){var n=e.defer();return t.currentUser.$hasLeveledReader()?n.resolve():n.reject({type:"redirect",path:"/program"}),n.promise}],CurrentProgramLoaded:["Resolve",function(e){return e.CurrentProgramLoaded()}],Scales:["LeveledReadersSvc",function(e){return e.getScales()}]}}).when("/program/:programId/:programVersion/leveledreaders/search",s).when("/program/:programId/:programVersion/leveledreaders/search/content/:itemId/:itemVersion",r)}]),angular.module("Realize.leveledReaders.leveledReadersSvc",["rlzComponents.components.i18n","Realize.leveledReaders.leveledReadersScale","Realize.paths","Realize.constants.draTelemetry"]).service("LeveledReadersSvc",["$log","LeveledReadersScale","Messages","$http","REST_PATH","$location","$route","$rootScope","DRA_TELEMETRY",function(e,t,n,r,s,a,i,o,l){"use strict";var c=t.TYPES,u=t.TYPE_LIST,d=t.TIC_INDEXES_BY_TYPE,m=this.ROUTE_PARAM={SCALE_TYPE:"scaleType",START:"scaleStart",END:"scaleEnd"},g="Lexile",p="BR",f=function(e){return _.object(u,e)},h=function(e){var r=f(["lexile","guided","dra","maturity"]);return new t(e).$setTitle(n.getMessage("leveledReaders.scales."+r[e]+".title")).$setDescription(n.getMessage("leveledReaders.scales."+r[e]+".description"))};this.getScale=function(e){var t=f(["Lexiles","GuidedReadings","DevelopmentalReadingAssessments","ReadingMaturityMetrics"]);return r.get(s+"/metadata/values/"+t[e],{cache:!0}).then(function(t){if(e===g){var n=t.data.indexOf(p);t.data[n]=" "+t.data[n]}return h(e).$setScaleValues(t.data).$setTicLabelsToDisplay(d[e])},o.goToDefaultErrorPage)},this.getScales=function(){return r.get(s+"/metadata/scales",{cache:!0}).then(function(e){var t=e.data,n=t.Lexiles.indexOf(p);t.Lexiles[n]=" "+t.Lexiles[n];var r=h(c.LEXILE).$setScaleValues(t.Lexiles).$setTicLabelsToDisplay(d[c.LEXILE]),s=h(c.GUIDED).$setScaleValues(t.GuidedReadings).$setTicLabelsToDisplay(d[c.GUIDED]),a=h(c.DRA).$setScaleValues(t.DevelopmentalReadingAssessments).$setTicLabelsToDisplay(d[c.DRA]),i=h(c.RMM).$setScaleValues(t.ReadingMaturityMetrics).$setTicLabelsToDisplay(d[c.RMM]);return[r,s,a,i]},o.goToDefaultErrorPage)},this.redirectToSearchPage=function(e){var t=["/program",i.current.params.programId,i.current.params.programVersion,"leveledreaders","search"].join("/");a.path(t),this.updateRouteParams(e)},this.updateRouteParams=function(e){var t={};t[m.SCALE_TYPE]=e.type,t[m.START]=e.selected.start.trim(),t[m.END]=e.selected.end.trim(),a.search(t)},this.getScaleTypeFromRoute=function(){return i.current.params[m.SCALE_TYPE]},this.getScaleStartFromRoute=function(){return i.current.params[m.START]},this.getScaleEndFromRoute=function(){return i.current.params[m.END]},this.getQueryParam=function(t){var n=t.selected.start||this.getScaleStartFromRoute(),r=t.selected.end||this.getScaleEndFromRoute(),s=t.type||this.getScaleTypeFromRoute();s&&n&&r||e.error("LeveledReadersSvc: Cannot build query without scaleType, start, end");var a,i,o,l;return n=n.trim(),r=r.trim(),a=f(["LEXILE","GUIDED_READING","DRA","READING_MATURITY_METRIC"]),i=a[s],o=n===r?n:n+"-"+r,l={},l[i]=o,l},this.getProgramTitle=function(){return o.currentProgram&&o.currentProgram.programs&&o.currentProgram.programs[0]?o.currentProgram.programs[0]:l.DRA_PRODUCT_NOT_AVAILABLE}}]),angular.module("Realize.leveledReaders.leveledReadersScale",["Realize.slider.scale"]).factory("LeveledReadersScale",["Scale",function(e){"use strict";function t(t){if(!_.contains(s,t))throw"Invalid Leveled Reader Scale"+t;e.call(this),this.type=t,this.title="",this.description=""}var n={LEXILE:"Lexile",GUIDED:"Guided Reading",DRA:"DRA",RMM:"Maturity"},r={BR:"BR",START_VALUE:0,MAX_VALUE:50,DIFF:200},s=_.values(n),a=[0,6,18,30,43],i=[0,8,17,25],o=[0,2,4,6,8,10,12,14,16],l=[0,5,11,16],c=[n.DRA,n.LEXILE];return t.prototype.$setTitle=function(e){var t=this;return this.title=e,t},t.prototype.$setDescription=function(e){var t=this;return this.description=e,t},t.prototype.isLevelReaderShowsRange=function(){return-1!==c.indexOf(this.type)},t.prototype.isDraScale=function(){return this.type===n.DRA},t.shouldOffcenter=function(e){var t=!1,s=!1;if(e&&e.type===n.LEXILE){var a=e.selected.start===r.BR?0:e.selected.start,i=e.selected.end===r.BR?0:e.selected.end,o=i-a;t=a>r.START_VALUE&&o!==r.START_VALUE&&o<=r.MAX_VALUE,s=o!==r.START_VALUE&&(o<=r.MAX_VALUE||a===r.START_VALUE&&o<=r.DIFF)}return{startOffcenter:t,endOffcenter:s}},angular.extend(t.prototype,e.prototype),t.TYPES=n,t.TYPE_LIST=s,t.TIC_INDEXES_BY_TYPE=_.object(s,[a,i,o,l]),t}]),angular.module("Realize.leveledReaders.leveledReadersSearchCtrl",["ngRoute","Realize.leveledReaders.leveledReadersScale","Realize.leveledReaders.leveledReadersSvc","Realize.content.model.contentItem","Realize.slider"]).controller("LeveledReadersSearchCtrl",["$scope","$log","$location","$routeParams","LeveledReadersSvc","CurrentScale","Content","LeveledReadersScale",function(e,t,n,r,s,a,i,o){"use strict";var l=["/program",r.programId,r.programVersion,"leveledreaders"].join("/"),c=function(){var e=n.path();e.search("leveledreaders/search/content")<0&&(n.search(s.ROUTE_PARAM.SCALE_TYPE,null),n.search(s.ROUTE_PARAM.START,null),n.search(s.ROUTE_PARAM.END,null))},u=function(t){var n=o.shouldOffcenter(t);e.startOffcenter=n.startOffcenter,e.endOffcenter=n.endOffcenter};e.navigationFallback=l,e.leveledReadersDefaultSearchParams={"includedFacets[]":["GRADE","COMPREHENSION_SKILLS","TEXT_FEATURES","GENRES","CONTENT_AREAS","LANGUAGE","RUBRIC"],MEDIA_TYPE:"Leveled Reader",sortField:"name",sortOrder:"asc"},e.scale=a.$setSelectedValues(s.getScaleStartFromRoute(),s.getScaleEndFromRoute()),e.searchParams=angular.extend(e.leveledReadersDefaultSearchParams,s.getQueryParam(e.scale)),e.$on("$routeChangeStart",c),e.$on("slider.change",function(t,n){e.$broadcast("leveledReadersSearch.update",n),e.safeApply(function(){u(n)})}),e.pageLoading(),e.$on("searchResults.queryCompleted",function(t,n){e.noMatchFound=0===n.resultCount}),e.selectedFacets={};var d=!1,m=function(){var n=i.filterData.get("search.leveledReader");n&&(e.selectedFacets=n.selectedFacets,e.searchParams=n.searchOptions),t.debug("initSearch",e.selectedFacets,e.searchParams)};e.$on("$locationChangeStart",function(e,t,n){t.split("?").shift()!==n.split("?").shift()&&t.search("leveledreaders/search/content")>=0&&(d=!0)}),e.$on("searchResults.exiting",function(e,t){d?i.filterData.set("search.leveledReader",t):i.filterData.remove("search.leveledReader")}),e.isSelectedDraValuesEqual=function(e){return e.isDraScale()&&e.allSelectedValuesEqual()},u(e.scale),m()}]),angular.module("Realize.leveledReaders.leveledReadersSearch",["Realize.leveledReaders.leveledReadersSvc","RealizeDirectives"]).directive("leveledReadersSearch",["$log","$routeParams","$location","LeveledReadersSvc",function(e,t,n,r){"use strict";return{require:"searchResults",controller:["$scope",function(e){var t=function(t){r.updateRouteParams(t),e.searchOptions=angular.extend(e.searchOptions,r.getQueryParam(t)),e.searchOptions.page=1,e.$apply()};e.scaleType=r.getScaleTypeFromRoute(),e.scaleStart=r.getScaleStartFromRoute(),e.scaleEnd=r.getScaleEndFromRoute();var n,s=0,a=function(e){s++,s>10&&(t(e),l())},i=function(e){n=setInterval(a(e),100)},o=function(){clearInterval(n)},l=function(){o(),s=0};e.$on("leveledReadersSearch.update",function(n,r){e.$root.isKeyboardInUse?(l(),i(r)):t(r)})}],link:function(e,t,n,r){e.searchOptions=r.searchOptions,r.setReaderType("Leveled Readers")}}}]),angular.module("Realize.resources.resourcesCtrl",["lst.search.widget","Realize.content.model.contentItem","Realize.common.resources","Realize.content.contentSourceService","ngRoute"]).controller("ResourcesCtrl",["$scope","$rootScope","$location","$log","Content","ContentSource","$route",function(e,t,n,r,s,a,i){"use strict";e.back=function(){e.noMatchFound?(m(),i.reload()):n.path("/program")},e.$on("searchResults.queryCompleted",function(t,n){e.noMatchFound=0===n.resultCount});var o=t.currentProgram.library;r.debug("library context name:"+o),e.resourcesDefaultSearchParams={"includedFacets[]":["FEATURED_RESOURCES","GRADE","TEACHER_ONLY","RUBRIC","MEDIA_TYPE","CONTENT_TYPE","SOURCE","COMPREHENSION_SKILLS","TEXT_FEATURES","GENRES","CONTENT_AREAS","LANGUAGE"],LIBRARY_TITLE:o,sortField:"relevance",sortOrder:"asc",keywords:""},e.searchParams=e.resourcesDefaultSearchParams,e.sortField=e.resourcesDefaultSearchParams.sortField,e.selectedFacets={};var l=!1,c=a.getByPath(),u=function(){return c.filterData.get("resources.search.keyword")},d=function(t){t&&(c=new a(e.searchProvider),c.filterData.set("resources.search.keyword",t))},m=function(){angular.forEach(a.PROVIDER,function(e){e=new a(e),e.filterData.remove("resources.search.keyword")})},g=function(){var t=u();r.debug("currentSelectedData",t),t&&(t.selectedFacets&&t.searchOptions?(e.selectedFacets=t.selectedFacets,e.searchParams=t.searchOptions):e.searchParams.keywords=t)};e.$on("$locationChangeStart",function(e,t){var n=t.split("/resources")[1];n&&(l=!0)}),e.$on("searchResults.exiting",function(e,t){l?d(t):m()}),g()}]),angular.module("Realize.resources",["Realize.resources.routes","Realize.resources.resourcesCtrl"]),angular.module("Realize.resources.routes",["RealizeApp","Realize.paths","Realize.user.currentUser","Realize.content.contentResolver"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n=["$q","$currentUser",function(e,t){return t.hasRole("ROLE_TEACHER")?e.when({}):e.reject("Insufficient Privileges!")}],r={controller:"ResourcesCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/resources/resources.ctrl.html",resolve:{_security:n,featureResourcesData:["ContentResolver","$rootScope","$location",function(e,t,n){var r=n.path().split("/")[2],s=t.currentProgram&&t.currentProgram.id===r;return s?t.currentProgram:e()}]}};e.when("/program/:programId/:programVersion/resources",r)}]),angular.module("Realize.standards.reviewerStandardsContentCtrl",["RealizeDataServices","Realize.content.model.contentItem","Realize.standards.standardDataService","Realize.common.expandableTreeDirective"]).controller("ReviewerStandardsContentCtrl",["$log","$scope","$rootScope","$routeParams","$location","LessonData","StandardData","Content","Standard",function(e,t,n,r,s,a,i,o,l){"use strict";var c=l.urlDecode(r.lastSelectedGrade),u=function(e){if(!e||!e.contentItems)return e;
var t=0;return angular.forEach(e.contentItems,function(e){"Learning Model"===e.mediaType&&(e.lmKey=t++%3)}),e};t.program=n.currentProgram,t.content=u(a.results[0]),t.standard=i,t.back=function(){var e=t.program;s.path("/review/program/"+e.id+"/"+e.version+"/standards"),s.search("lastSelectedGrade",l.urlEncode(c))},t.open=function(e,t){var n,r;"Student Voice"!==t.mediaType&&"Learning Model"!==t.mediaType&&(e.preventDefault(),e.stopPropagation(),n=t.$getDefaultVersion(),r=s.path(),t.isExternalResource()&&(n.version=1,n.id=n.originalEquellaItemId),r=t.$isNbcItem()?["/nbclearn/video",t.id,t.version].join("/"):[r,"content",n.id,n.version].join("/"),s.path(r))}}]),angular.module("Realize.standards.standardsSearchCtrl",["rlzComponents.components.i18n","Realize.content.model.contentItem","Realize.standards.standardDataService"]).controller("StandardsSearchCtrl",["$scope","$rootScope","$log","$location","$routeParams","lwcI18nFilter","Content","Standard",function(e,t,n,r,s,a,i,o){"use strict";function l(t){var n=e.currentProgram&&e.currentProgram.language?e.currentProgram.language:e.keyStore.get("assessmentLanguage");return o.localeDescription(t,n)}e.pageLoading(),e.stateStandard=e.zeroStateMsgCriteria=o.urlDecode(s.stateStandard),e.nationalLibrary=o.urlDecode(s.nationalLibrary),o.getSelectedStandard(e.stateStandard).then(function(t){e.selectedStandard=t,l(e.selectedStandard)});var c={STATE_STANDARD:e.stateStandard,NATIONAL_LIBRARY:e.nationalLibrary},u=!1;e.goBackToStandards=function(){var t=s.programId,n=s.programVersion,r=o.getStandardRoute(t,n);e.back(r)};var d=function(){var t=i.filterData.get("search.standard");t?(e.selectedFacets=t.selectedFacets,e.searchParams=t.searchOptions):e.searchParams=c};t.searchResultsTitle||(t.searchResultsTitle=a("standards.search.searchByStandard")),e.$on("$routeChangeStart",function(){t.searchResultsTitle=null}),e.$on("searchResults.queryCompleted",function(t,n){e.noMatchFound=0===n.resultCount,e.queryDone=!0}),e.$on("$locationChangeStart",function(e,t,n){n=n.split("?").shift(),t.indexOf(n)>=0&&(u=!0)}),e.$on("searchResults.exiting",function(e,t){u?i.filterData.set("search.standard",t):i.filterData.remove("search.standard")}),d()}]),angular.module("Realize.standards.standardsTreeCtrl",["RealizeDataServices","Realize.content.model.contentItem","Realize.standards.standardDataService","Realize.common.expandableTreeDirective","Realize.paths"]).controller("StandardsTreeCtrl",["$log","$scope","$rootScope","$routeParams","Content","Standard","$location","StandardsTreeData","PATH",function(e,t,n,r,s,a,i,o,l){"use strict";var c,u={},d=a.urlDecode(r.lastSelectedGrade);t.back=function(){i.path("/program",!0)},t.grades=$.Enumerable.From(o.standards.grades).Distinct().OrderBy().ToArray(),t.standardsMap=o.standards.map,t.program=n.currentProgram=o.program,t.options=[],t.update=function(e){i.search("lastSelectedGrade",a.urlEncode(e.grade)),t.current=u[e.grade]},angular.forEach(t.grades,function(e){var n={grade:e,standards:t.standardsMap[e]};t.options=t.options.concat(n),u[e]=n}),t.grades&&t.grades.length&&(c=u[d||t.grades[0]],t.update(c)),t.standardTemplate=l.TEMPLATE_CACHE+"/app/programs/standards/standardTreeItem.dir.html"}]),angular.module("Realize.standards.standardTreeItemDirective",["Realize.standards.standardDataService","Realize.analytics"]).directive("standardTreeItem",[function(){"use strict";return{restrict:"A",controller:["$log","$scope","$location","$routeParams","$rootScope","$window","Standard","Analytics",function(e,t,n,r,s,a,i,o){function l(){var e=s.currentUser.isReviewer,t=n.path().split("/"),r=t.indexOf("review")>-1;return e&&r}function c(e){e.children&&e.children.length?e.expanded=!e.expanded:(n.path("/review/program/"+d+"/"+m+"/standards/"+i.urlEncode(e.id)),n.search("grade",i.urlEncode(e.grade)))}function u(e){(s.currentUser.isLibraryAdmin||s.currentUser.isContentReviewer||e.count>0)&&n.path(i.getSearchRoute(e,d,m,e.grade))}var d=r.programId,m=r.programVersion,g=t.obj;t.open=l()?c:u,t.$watch("obj.expanded",function(e){i[e?"setOpen":"setClosed"](g.id),!e&&g.children&&_.each(g.children,function(e){e.expanded=!1}),e&&o.track("programs.action",{program:s.currentProgram,label:"Standards expand ("+g.number+(g.title?" / "+g.title:"")+")"})}),g.expanded=i.isOpen(g.id)}]}}]),angular.module("Realize.standards",["Realize.standards.standardDataService","Realize.standards.reviewerStandardsContentCtrl","Realize.standards.standardsSearchCtrl","Realize.standards.standardsTreeCtrl","Realize.standards.standardTreeItemDirective","Realize.standards.routes"]),angular.module("Realize.standards.routes",["Realize.content.model.contentItem","RealizeApp","Realize.paths"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n=["$q","$currentUser",function(e,t){var n=t.hasRole("ROLE_TEACHER");return n?e.when(1):e.reject("Insufficient Privileges!")}],r={controller:"StandardsTreeCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/standards/standardsTree.html",reloadOnSearch:!1,resolve:{_security:n,StandardsTreeData:["$route","Content",function(e,t){return t.getContentStandards(e.current.params.programId,e.current.params.programVersion)}]}},s={controller:"StandardsSearchCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/standards/standardsSearch.html",resolve:{_security:n,ProgramContent:["Resolve",function(e){return e.Program()}]}};e.when("/program/:programId/:programVersion/standards",r).when("/program/:programId/:programVersion/standards/lastSelectedGrade/:lastSelectedGrade",r).when("/program/:programId/:programVersion/standards/lastSelectedGrade/:lastSelectedGrade/search/:stateStandard/:nationalLibrary",s).when("/program/:programId/:programVersion/standards/lastSelectedGrade/:lastSelectedGrade/search/:stateStandard",s).when("/search/standard/:stateStandard",s)}]),angular.module("Realize.standards.standardDataService",["Realize.paths"]).service("Standard",["$q","$rootScope","$log","$http","PATH",function(e,t,n,r,s){"use strict";var a={},i={};return a.get=function(e){return r.get(s.REST+"/standards/libraries",{params:e}).then(function(e){return e.data})},a.isOpen=function(e){return i.hasOwnProperty(e)},a.setOpen=function(e){i[e]=e},a.setClosed=function(e){delete i[e]},a.clearOpenStandards=function(){i={}},a.getChildrenStandards=function(e,t){var n=s.REST+"/standards/children?id="+encodeURIComponent(e.replace(/\\/g,"\\"));return t&&(n=n+"&programNames="+encodeURIComponent(t.replace(/\\/g,"\\"))),r.get(n).then(function(e){return e.data})},a.processStandards=function(e,t){a.localeDescription(e,t),angular.forEach(e.children,function(n){n.grade&&"null"!==n.grade||(n.grade=e.grade),a.processStandards(n,t)})},a.getStandardTree=function(t,n){var r=e.defer();return a.get({programNames:t}).then(function(s){var i={},o=[],l=[],c=s;c=_.toArray(c),c=_.flatten(c),angular.forEach(c,function(e){l.push(a.getChildrenStandards(e.id,t).then(function(t){angular.forEach(t,function(t){t.grade&&"null"!==t.grade||(t.grade=e.grade),angular.isDefined(i[e.grade])||(i[e.grade]=[]),o=o.concat(e.grade),i[e.grade]=t.number?i[e.grade].concat(t):i[e.grade].concat(t.children),a.processStandards(t,n.language)})}))}),e.all(l).then(function(){r.resolve({map:i,grades:o})},r.reject)}),r.promise},a.getQuestionBankStandardTree=function(t,n){var i=e.defer(),o={programNames:t};return r.get(s.REST+"/standards/questionbanks",{params:o}).then(function(e){var t={},r=[],s=e.data;angular.forEach(s,function(e){angular.isDefined(t[e.grade])||(t[e.grade]=[]),r=r.concat(e.grade),t[e.grade]=e.number?t[e.grade].concat(e):t[e.grade].concat(e.children),a.processStandards(e,n.language)}),i.resolve({map:t,grades:r})},i.reject),i.promise},a.getSelectedStandard=function(e){var t=r({url:s.REST+"/standard?path="+encodeURIComponent(e.replace(/\\/g,"\\")),method:"GET"}).then(function(e){return e.data});return t},a.getStandardRoute=function(e,t){return["/program",e,t,"standards"].join("/")},a.getSearchRoute=function(e,t,n,r){var s=a.urlEncode(e.id);if(r=a.urlEncode(r),!e.library)return["/program",t,n,"standards","lastSelectedGrade",r,"search",s].join("/");var i=a.urlEncode(e.library);return["/program",t,n,"standards","lastSelectedGrade",r,"search",s,i].join("/")},a.urlEncode=function(e){return e&&(e=e.replace(/\\/g,"!5C"),e=e.replace(/\s/g,"!20"),e=e.replace(/\//g,"!2F")),e},a.urlDecode=function(e){return e&&(e=e.replace(/!5C/g,"\\"),e=e.replace(/!20/g," "),e=e.replace(/!2F/g,"/")),e},a.localeDescription=function(e,n){return"Spanish"!==n&&"es"!==t.currentUser.getAttribute("profile.locale")||""===e.spanishDescription||null===e.spanishDescription||(e.description=e.spanishDescription),e},a.getStandardsStateDetails=function(t){return r({method:"POST",url:s.REST+"/standards/libraries/state/info",data:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(function(e){return _.isEmpty(e.data)?!1:e.data},function(t){return n.error("Failed to getStandardsStateDetails",t),e.reject(t)})},a}]),angular.module("Realize.Comment.DisplayTime",["rlzComponents.components.i18n","Realize.filters.capitalizeFirstWord"]).filter("commentDisplayTime",["lwcI18nFilter","capitalizeFirstWordFilter",function(e,t){"use strict";return function(n){n=moment.isMoment(n)?n:moment(n);var r,s,a,i=moment(),o=i.diff(n,"days");return o>=13?n.format("MM/DD/YYYY"):o>=7?(r=n.format("dddd"),s=e("comment.times.last"),a=t(r.toLowerCase()),s+" "+a):o>=2&&6>=o?(r=n.format("dddd"),t(r.toLowerCase())):1===o||0===o&&i.day()!==n.day()?e("comment.times.yesterday"):e("comment.times.today")}}]),angular.module("Realize.comment.commentsWidget",["Realize.paths","rlzComponents.components.i18n","Realize.comment.commentsApiService","Realize.common.alerts","ngSanitize","Realize.Comment.DisplayTime","Realize.user.currentUser"]).directive("commentsWidget",["$log","PATH",function(e,t){"use strict";return{templateUrl:t.TEMPLATE_CACHE+"/assignment/comment/commentsWidget/commentsWidget.dir.html",scope:{userAssignmentId:"@",commentsList:"=?",boardId:"@",lastAccessDate:"@",showComments:"="},controller:"CommentsWidgetCtrl",controllerAs:"commentsWidgetCtrl"}}]).controller("CommentsWidgetCtrl",["$scope","$log","$q","commentsApiService","InlineAlertService","lwcI18nFilter","$currentUser",function(e,t,n,r,s,a,i){"use strict";function o(e){e.forEach(function(e){e.isNewPost=i.userId!==e.author&&e.modifiedDate>l.lastAccessDate})}var l=this;this.userAssignmentId=e.userAssignmentId,this.isEditorVisible=!1,this.boardId=e.boardId,this.lastAccessDate=e.lastAccessDate,this.isListVisible=e.showComments,e.commentsList=e.commentsList||[],this.updateCommentList=function(t){var s=e.commentsList.some(function(e){return e.isDeleted});return t&&s?(e.commentsList.unshift(t),l.isListVisible=!0,n.when(!0)):r.getPosts(this.boardId).then(function(t){var n=t.posts;o(n),e.commentsList=n,e.$emit("CommentsWidgetCtrl.updateCommentList.listComment",l.userAssignmentId,e.commentsList.length,t.boardAccessInfo.lastAccessDate),l.isListVisible=!0})},this.toggleEditorVisible=function(){this.isEditorVisible=!this.isEditorVisible,this.isEditorVisible&&e.commentsList.forEach(function(e){e.isInEditMode=!1})},e.$on("listcomment.post.editmode",function(){l.isEditorVisible=!1}),e.$on("writecomment.post.comment",function(t,n){l.isEditorVisible=!1;var r=["<strong>",a("comment.successNotification.postComment.title"),"</strong> ",a("comment.successNotification.postComment.message")].join("");l.boardId=l.boardId||n.boardId,l.updateCommentList(n).then(function(){s.addAlert(e.commentsList[0].id,{type:"success",msg:r})})}),e.$on("writecomment.post.cancel",function(){l.isEditorVisible=!1}),e.$watch("showComments",function(){e.showComments?l.boardId?l.updateCommentList():r.getBoardId(l.userAssignmentId).then(function(e){l.boardId=e,l.updateCommentList()}):l.isListVisible=!1})}]),angular.module("Realize.comment.Token",["Realize.comment.TokenSvc"]),angular.module("Realize.comment.TokenSvc",["Realize.common.tokenInterceptor","Realize.user.currentUser"]).service("CommentsTokenSvc",["$http","$route","$q","$log","CommonTokenInterceptor","$currentUser","REST_PATH",function(e,t,n,r,s,a,i){"use strict";var o,l=this,c=function(){return a.isStudent},u=[i,"comments","tokens"].join("/"),d=function(e){return[u,"classes",e].join("/")},m={},g=function(e){return m[e]},p=function(){return c()?a.userId:t.current.params.classId},f=function(e){var t;for(t in m)if(m[t]===e)return t;return""},h=function(e,t){return m[e]=t.headers("Authorization"),r.log("Updated Token"),m[e]};return l.setTokenForTestingOnly=function(e,t){m[e]=t},l.shouldIntercept=function(e){return e.service&&"comments"===e.service},l.createToken=function(t){return c()?e.post(u):(o=d(t),e.post(o))},l.getToken=function(){var e=p();return g(e)?(r.log("Unchanged token"),n.when(m[e])):l.createToken(e).then(function(t){return h(e,t)})},l.makeRelevantUpdateToken=function(t,n){return c()?e.put(u,{},{headers:{Authorization:n}}):(o=d(t),e.put(o,{},{headers:{Authorization:n}}))},l.updateToken=function(e){var t=f(e);return delete m[t],l.makeRelevantUpdateToken(t,e).then(function(e){return h(t,e)})},l.recoverToken=function(e){return l.updateToken(e.headers.Authorization).then(function(t){return s.updateHeaderAndReturn(t,e)})},l}]),angular.module("Realize.assignment.common.RRSSCOReviewCtrl",["rlzComponents.components.i18n","Realize.navigationService","Realize.tinCanConfigService","Realize.assignment.constants","Realize.common.handlePostMessage","Realize.user.currentUser","rlzComponents.routedComponents.assignments"]).controller("RRSSCOReviewCtrl",["$scope","$window","$log","AssignmentData","ContentData","GroupData","$location","$routeParams","NavigationService","TinCanConfigService","ASSIGNMENT_CONSTANTS","sendPostMessage","$currentUser","assignmentHelperService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g){"use strict";function p(){return i.path().split("/assignments")[0]+"/assignments/"+h.assignment.assignmentId}function f(){var e,t=-1!==i.absUrl().indexOf("gradeInput");return h.isFromAssignmentByStudentFlow?(e=i.path().split("/assignments")[0]+"/assignments",i.search({status:o.status,activeTab:o.activeTab})):e=t?i.path().split("/gradeInput")[0]+"/gradeInput":i.path().split("/allstudents")[0]+"/allstudents",e}var h=this;h.assignment=r.assignment,h.content=s,h.scoLoading=!0,h.scoNotAvailable=!1,h.studentList=r.studentList,h.currentStudent=_.findWhere(h.studentList,{studentUuid:o.studentId}),h.assignedTo=g.getAssignedToList(h.assignment,r.roster,a),h.userAssignmentId=o.userAssignmentId,h.isFromAssignmentByStudentFlow=i.search().activeTab&&i.search().activeTab===u.TABS.ASSIGNMENTSBYSTUDENT?!0:!1,h.back=function(){var e=m.isStudent,t=e?p():f();l.back(t,!0)},h.isSCOUnavailable=function(){return h.scoLoading||h.scoNotAvailable};var v=function(){h.scoLoading=!1,h.scoNotAvailable=!0},S=function(e){var t=e.data.action;if("getTCConfig"===t){var r=h.userAssignmentId;void 0===r&&(r=""),c.getTinCanSCOSettings(r).then(function(t){d(t,e.source,e.origin)},function(){v()})}else"getAuthorization"===t?c.getTinCanAuthToken().then(function(t){d(t,e.source,e.origin)},function(){v()}):n.log("Not supported call for TCConfig listener.")},T=function(t){var r=t.data;r.action?S(t):r.type&&"parmManagerReady"===r.type?(h.scoLoading=!1,e.$apply()):n.log("Not supported call for TCConfig listener.")};e.$on("postMessageEvent",function(e,t){T(t)}),h.loadRRSSCOForStudent=function(e){if(e.studentUuid!==h.currentStudent.studentUuid){var t=h.assignment.$findItemMetadata(o.itemId,e.studentUuid),n=i.path().replace(o.studentId,e.studentUuid).replace(o.userAssignmentId,t.userAssignmentId);l.replaceLocationWith(n)}}}]),angular.module("Realize.assignment.common.RRSSCOReview",["Realize.assignment.common.RRSSCOReviewCtrl","Realize.assignment.common.RRSSCOReview.routes","Realize.common.studentNavigation"]),angular.module("Realize.assignment.common.RRSSCOReview.routes",["Realize.paths"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n={controller:"RRSSCOReviewCtrl",controllerAs:"RRSSCOReviewCtrl",templateUrl:t.TEMPLATE_ROOT+"/assignment/common/RRSSCO/RRSSCOReview.ctrl.html",resolve:{AssignmentData:["Resolve",function(e){return e.TeacherSingleAssignment().then(function(e){return e.studentList=_.sortBy(e.completedList,function(e){return e.studentInfo.lastFirst}),e})}],ContentData:["ContentResolver",function(e){return e()}],GroupData:["Resolve",function(e){return e.GroupList()}]}};e.when("/classes/:classId/assignments/:assignmentId/allstudents/:studentId/RRSSCOReview/:itemId/:itemVersion/userAssignmentId/:userAssignmentId",n).when("/classes/:classId/student/:studentId/assignments/:assignmentId/RRSSCOReview/:itemId/:itemVersion/userAssignmentId/:userAssignmentId",n).when("/classes/:classId/assignments/:assignmentId/allstudents/gradeInput/:studentId/RRSSCOReview/:itemId/:itemVersion/userAssignmentId/:userAssignmentId",n).when("/classes/:classId/assignments/:assignmentId/RRSSCOReview/:itemId/:itemVersion/userAssignmentId/:userAssignmentId",n)}]),angular.module("Realize.assignment.teacher.assignmentsByStudent",[]).controller("AssignmentsByStudentCtrl",["$scope","$routeParams","$location","RosterData","ClassComments",function(e,t,n,r,s){"use strict";e.classComments=s,e.currentRoster=r,e.selectedStudent=_.findWhere(e.currentRoster.students,{userId:t.userId}),e.back=function(){e.goBack(n.path().split("/student")[0]+"/assignments",!0)},e.viewStudent=function(t){n.path("classes/"+e.currentRoster.classId+"/student/"+t.userId+"/assignments")}}]),angular.module("Realize.assignment.listByClass",["components.alert","Realize.analytics","Realize.user.currentUser","Realize.assignment.facadeService","Realize.common.mediaQueryService","Realize.ui.modal.UnsavedChangesModal","rlzComponents.routedComponents.assignments","Realize.common.alerts","Realize.assignment.utilService","rlzComponents.components.googleClassroom.constants","rlzComponents.components.googleClassroom","webStorageModule","rlzComponents.assignmentTelemetryModule","rlzComponents.routedComponents.assignments.constants","Realize.standard.constants"]).directive("assignmentsListByClass",["$log","$rootScope","$timeout","$location","$routeParams","$currentUser","User","AssignmentFacadeService","AssignmentUtil","lwcI18nFilter","MediaQuery","numberFilter","ASSIGNMENT_CONSTANTS","STANDARD_CONSTANTS","UnsavedChangesModal","assignmentHelperService","googleClassroomService","GOOGLE_CLASSROOM","GoogleClassroomConstants","Toast","standardModal","webStorage","assignmentTelemetryService","ASSIGNMENT_TELEMETRY_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y){"use strict";return{scope:{assignmentData:"=",groupData:"=",classRosterData:"=",requestFilter:"=",componentLoading:"=",showTab:"=",assignmentErrorData:"=",page:"<",editedAssignments:"="},templateUrl:"templates/assignment/teacher/assignmentsListByClass/assignmentsListByClass.html",controller:["$scope",function(e){var t=e.assignmentData.assignmentsCount.hiddenAssignmentIds,n=function(e){return _.filter(e,function(e){return"IN_PROGRESS"!==e.status})},r=function(){if(e.assignmentErrorData&&e.assignmentErrorData.length&&t&&t.length){var r=_.filter(e.assignmentErrorData,function(e){return-1===t.indexOf(e.assignmentId)});return n(r)}return n(e.assignmentErrorData)};e.assignmentErrors=r(),e.showErrorModal=function(t,n){var r,s=e.assignmentErrors.length;t?(r=c("googleClassroom.googleFailedAssignmentName").replace("...",t),r+=1===s?c("googleClassroom.googleFailedAssignmentSingle"):c("googleClassroom.googleFailedAssignmentMultiple").replace("...",s-1)):r=c("googleClassroom.unableToAccessGoogleClassAccount");var a="";a="reconnect"===n?c("googleClassroom.reconnect"):c("content.modal.ok");var i={label:a,ariaLabel:a,action:function(){A.deactivate(),"reconnect"===n&&l.redirectToRealizeSyncWebApp()},className:[],disabled:!1};A.activate({heading:c("googleClassroom.googleClassSyncFailed"),description:r,buttons:[i],closeButton:!0,overlayActive:!0,cssClass:"customized-items-popup",closeAction:function(){A.deactivate()}})},e.displayGoogleAssignmentSyncError=function(){var t,n=e.assignmentData.assignments.find(function(t){return t.assignmentId===e.assignmentErrors[0].assignmentId});n?(t='"'+n.title+'"',e.showErrorModal(t)):o.get(s.classId,e.assignmentErrors[0].assignmentId).then(function(n){t='"'+n.title+'"',e.showErrorModal(t)})};var a=function(e,t){var n=I.get("FailedAssignmentClassID");return n?(n=n.filter(function(n){return n.classID===e&&n.errorType===t}),n.length):!1};if(e.showTab===m.CURRENT&&e.assignmentErrors&&e.assignmentErrors.length){e.revokeError=h.getRevokeError();var i=I.get("FailedAssignmentClassID");i||(i=[]),e.revokeError?i&&a(s.classId,"revoke")||(i.push({classID:s.classId,errorType:"revoke"}),I.add("FailedAssignmentClassID",i),e.showErrorModal("","reconnect")):i&&a(s.classId,"failedAssignment")||(i.push({classID:s.classId,errorType:"failedAssignment"}),I.add("FailedAssignmentClassID",i),1===e.page&&e.displayGoogleAssignmentSyncError())}}],link:function(d){var A=d.classRosterData.isGoogleClass(),R=function(e){return o.getAssignmentsWithExternalProviderData(e).then(function(e){return e.assignments})},C=function(e){d.bulkShowHideInProgress&&$(),d.$emit("assignmentListByClass.assignment.sortUpdate",e)},D=function(e){d.$emit("assignmentListByClass.assignment.hidden",e)},b=[],P=function(){if(!d.closingDrawer&&d.drawerOpen&&d.useSideDrawer)d.hideColumns=!0;else if(d.useSideDrawer&&d.drawerOpen&&d.closingDrawer){d.hideColumns=!1;var e=n(function(){d.drawerOpen=d.closingDrawer=!1},200);b.push(e)}else d.hideColumns=!1},w=function(e,t){for(var n=0;n<e.length;n++)if(e[n]&&e[n].assignmentId===t)return n;return-1},L=function(){var e=I.get(g.STANDARD_MASTERY_BY_CLASS+"."+a.userId+"."+s.classId);if(e&&e.assignmentIds){var t=k.some(function(t){return e.assignmentIds.indexOf(t)>-1});t&&o.resetlocalStorageData(e,a.userId,s.classId)}},$=function(){d.assignmentListForm.$setPristine(),L(),k=[],angular.forEach(d.assignmentData.assignments,function(e){delete e.selected})},O=function(){d.bulkShowHideInProgress=!1,z=!1,U=!1,$(),d.$emit("assignments.bulkShowHide.finished")},N=new p(function(e){var t=!0;return d.save(e,!1,t)}),M=function(e,n){var r=z?d.isSaveDisabled():!1;r||N.showDialog(n).then(function(){e&&(e(),O()),z||N.reset()},function(){t.pageLoaded()})},k=[],z=!1,U=!1,F={PLAYLIST:"PLAYLIST"};t.pageLoaded(),R(d.assignmentData),d.useSideDrawer=u.breakpoint.isDesktop,d.bulkShowHideInProgress=!1,d.syncObject=h.getAssignmentDefaultStatus(),d.isBulkShowHidePossible=function(){return!d.componentLoading&&!d.bulkShowHideInProgress&&d.assignmentData.assignments.length>0},d.isBulkShowHideFormAvailable=function(){return!d.componentLoading&&d.bulkShowHideInProgress},d.initiateBulkShowHide=function(){d.drawerOpen&&d.$broadcast("assignmentListByClass.drawer.close"),d.bulkShowHideInProgress=!0,k=[]},d.prepareDataForBulkShowHide=function(e){e.selected?k.push(e.assignmentId):k.splice(k.indexOf(e.assignmentId),1)},d.selectAssignment=function(e,t,n){if(d.bulkShowHideInProgress)t.selected=!t.selected,d.prepareDataForBulkShowHide(t),d.assignmentListForm.$pristine&&d.assignmentListForm.$setDirty();else{if(t.status===m.INACTIVE)return;d.toggleAssignmentDrawer(t,n)}},d.isSaveDisabled=function(){return d.assignmentListForm&&d.assignmentListForm.$pristine||k.length<=0},d.isActiveTab=function(){return d.showTab===m.CURRENT},d.isHiddenTab=function(){return!d.isActiveTab()},d.cancel=function(e){e&&(e.preventDefault(),e.stopPropagation()),O()},d.save=function(t,n,r){var a=d.isHiddenTab()?m.AVAILABLE:m.INACTIVE,i=!r||r&&!z||r&&z&&U;return o.bulkShowHide(s.classId,k,a,A).then(function(){i&&(d.$emit("assignments.bulkShowHide.succeeded",{currentTab:d.showTab,assignmentCount:k.length,saveButtonClicked:n}),O())},function(t){var n=d.isHiddenTab()?"show":"hide";e.error("Failed to "+n+" assignments",t),i&&(d.$emit("assignments.bulkShowHide.failed"),O())})},d.isClickable=function(e){return!e.hidden&&"INACTIVE"!==e.status},d.isNotClickable=function(e){return e.hidden||"INACTIVE"===e.status&&!d.bulkShowHideInProgress||angular.isDefined(d.assignmentSelected)&&e.assignmentId===d.assignmentSelected.assignmentId},d.isHiddenWithBulkShowHideModeOn=function(e){return e.hidden&&d.bulkShowHideInProgress},d.isInActiveWithBulkShowHideModeOn=function(e){return"INACTIVE"===e.status&&!d.bulkShowHideInProgress},d.displayDash=function(e){return f.displayDash(e)},d.displayScore=function(e){return f.displayScore(e)},d.getAverageScore=function(e){return f.getAverageScore(e)},d.getNotSentScoreMsg=function(e){return f.getNotSentScoreMsg(e)},d.getNotSentScoreDrawerMsg=function(){return d.assignmentSelected?f.getNotSentScoreDrawerMsg(d.assignmentSelected):""},d.getNotScoredCountMsg=function(e){return f.getNotScoredCountMsg(e)},d.getNotScoredCountDrawerMsg=function(){return d.assignmentSelected?f.getNotScoredCountDrawerMsg(d.assignmentSelected):""},d.viewReportScreen=function(e){l.redirectToReportScreen(e),E.sendQuickLinkTelemetryEvent(e,y.DATA_LINK,y.PAGE.ASSIGNMENTS_BY_CLASS,y.EMPTY_STRING)},d.reviewManualScore=function(e,t){t&&t.stopPropagation(),r.path("/classes/"+s.classId+"/assignments/"+e.assignmentId+"/manualScoreReview")},d.toggleAssignmentDrawer=function(e,t){if(angular.isDefined(d.assignmentSelected)&&d.assignmentSelected.assignmentId===e.assignmentId&&!d.useSideDrawer&&d.$broadcast("assignmentListByClass.drawer.close"),!e.hidden){var n=d.classRosterData.isGoogleClass(),r=e,a=s.classId;d.setUpAssignmentForDrawer(r),r.index=t,d.assignmentSelected=r,h.setFailedAssignmentSyncDetails(d.assignmentErrorData,r,n,a,d.editedAssignments),d.syncObject=h.getAssignmentSyncStatus(d.assignmentSelected.assignmentId,s.classId),(d.syncObject&&d.syncObject.status===v.SYNC_SUCCESS||!d.syncObject)&&(d.syncObject=h.getAssignmentDefaultStatus()),l.setDataLinkDetails(e)}},d.shouldShowBottomDrawer=function(e){return d.drawerOpen&&!d.useSideDrawer&&d.assignmentData.assignments.length&&angular.isDefined(d.assignmentSelected)&&d.assignmentSelected.assignmentId===e.assignmentId},d.shouldShowSideDrawer=function(){return d.drawerOpen&&d.useSideDrawer&&d.assignmentData.assignments.length&&angular.isDefined(d.assignmentSelected)},d.open=function(e,t){t&&t.preventDefault(),r.path("/classes/"+s.classId+"/assignments/"+e.assignmentId+"/allstudents"),E.sendStudentStatusTelemetryEvent(e,y.VIEW_STUDENT_STATUS,y.PAGE.ASSIGNMENTS_BY_CLASS,y.EMPTY_STRING)},d.teacherPreview=function(e){var t=["/classes",s.classId,"assignments",e.assignmentId,"preview"].join("/");o.preview(t)},d.viewDiscussion=function(e){var t=["/classes",s.classId,"discussPrompt/assignments",e.assignmentId,"content",e.contentItem.id].join("/");r.path(t).search({discuss:e.isAssignmentPastDueDate()?null:"active"})},d.showGradeInputView=function(e,t){r.path("/classes/"+s.classId+"/assignments/"+t.assignmentId+"/allstudents/gradeInput")},d.hide=function(e){o.hideAssignment(e,s.classId,A,a.userId).then(function(){e.hidden=!0,D(e),angular.isDefined(d.assignmentSelected)&&e.assignmentId===d.assignmentSelected.assignmentId&&d.$broadcast("assignmentListByClass.drawer.close")})},d.unhide=function(e,t){o.unhideAssignment(t,s.classId,A).then(function(){t.hidden=!1,d.$emit("hiddenAssignmentsList.assignment.restored",t)})},d.getOverrideMediaType=function(e){var t=e.type===F.PLAYLIST?F.PLAYLIST.toLowerCase():void 0;return t},d.updateSortOrder=function(e){var t=e===d.requestFilter.sortField?d.requestFilter.sortOrder===m.ASC?m.DESC:m.ASC:d.requestFilter.sortOrder;C({sortField:e,sortOrder:t}),!d.useSideDrawer&&angular.isDefined(d.assignmentSelected)&&d.$broadcast("assignmentListByClass.drawer.close")},d.getSortSelectors=function(e){var t=["sortBy"];return d.requestFilter.sortField===e?t.push(d.requestFilter.sortOrder===m.ASC?"icon-sort-down":"icon-sort-up"):t.push("icon-sort"),t},d.getSortAriaLabel=function(e){var t=[];switch(e){case"TITLE":t.push(c("assignmentList.columnHeader.assignmentTitle.label"));break;case"DUE_DATE":t.push(c("assignmentList.columnHeader.dueDate.label"));break;case"SCORE":t.push(c("assignmentList.columnHeader.average.label"));break;default:console.warn("unexpected sort type received. Ignoring.")}return t.push(c("teacherItemAnalysis.sorting.sortableColumn")),d.requestFilter.sortField===e&&t.push(d.requestFilter.sortOrder===m.ASC?c("masteryByStandard.sorting.sortedAscending"):c("masteryByStandard.sorting.sortedDescending")),t.join(", ")},d.updateAssigneeList=function(e){var t,n=function(){e.assigneeList=[].concat(t.classes,t.groups,t.students)};e&&(t=e.$getAssigneesName(d.classRosterData,d.groupData),t.missingStudentIds.length>0?i.getUsersByIds(t.missingStudentIds).then(function(e){var r=_.filter(e,function(e){return null!==e});t.students=t.students.concat(_.pluck(r,"lastFirst")),t.students=_.sortBy(t.students,function(e){return e.toLowerCase()}),n()}):n())},d.updateDisplayFlags=function(e){e&&(d.averageGradeMsg=f.getAverageScoreDisplayOptions(e))},d.setUpAssignmentForDrawer=function(e){e.assignedSingleStudent=1===e.assignedTo.length&&null!==e.assignedTo[0].studentUuid,e.assignedSingleStudent&&(e.studentsCompleted?(e.singleStatus="completed",e.singleStatusMsg=c("assignmentStatus.status.completed")):e.studentsInProgress?(e.singleStatus="in progress",e.singleStatusMsg=c("assignmentStatus.status.inProgress")):(e.singleStatus="not started",e.singleStatusMsg=c("assignmentStatus.status.notStarted"))),d.updateAssigneeList(e),d.updateDisplayFlags(e)},d.$watch("assignmentSelected",function(e){if(angular.isDefined(e)&&!d.drawerOpen){d.drawerOpen=!0;var t=n(P,200);b.push(t)}else!angular.isDefined(e)&&d.drawerOpen&&(d.closingDrawer=!0,P())}),d.$on("assignmentListByClass.drawer.close",function(){var e=n(function(){delete d.assignmentSelected},0);b.push(e)}),d.$on("window.breakpoint.change",function(){var e=n(function(){d.useSideDrawer=u.breakpoint.isDesktop,P()},0);b.push(e)}),d.$on("$destroy",function(){b.forEach(function(e){n.cancel(e)}),b=null}),d.$on("assignment:edit:success",function(e,t){var n=t.assignment;if(n){var r=w(d.assignmentData.assignments,n.assignmentId);if(-1!==r){d.assignmentData.assignments[r]=n;var a=s.classId,i=n.assignmentId,o=a+" - "+i,l=c("googleClassroom.syncInProgress"),u=S.SYNC_IN_PROGRESS;h.setAssignmentSyncDetails(o,!0,l,u),d.editedAssignments.push(i),d.syncObject=h.getAssignmentSyncStatus(i,a)}}}),d.$on("assignments.bulkShowHide.confirm",function(e,t){var n,r;t&&(d.bulkShowHideInProgress=!0,d.showTab=t.currentState.currentTab||d.showTab,k=t.currentState.assignmentList||k,k.length>0&&d.assignmentListForm.$setDirty(),n=t.nextAction?t.nextAction:null,r=t.nextAssignmentTab?t.nextAssignmentTab:null,U=r?!0:!1),M(function(){r&&0===d.assignmentData.assignmentsCount.totalActive&&(n=null),n&&(r?n(r):n())},e)}),d.$on("assignments.bulkShowHide.finish",function(){d.bulkShowHideInProgress&&O()}),d.$watch("isSaveDisabled()",function(e,t){e===t||e?d.$emit("assignments.bulkShowHide.finished"):d.$emit("assignments.bulkShowHide.initiated",{currentTab:d.showTab,assignmentList:k})}),d.$on("$locationChangeStart",function(e){z=!0,M(null,e)}),d.syncWithGoogle=function(e){if(e!==v.SYNC_SUCCESS&&e!==v.SYNC_IN_PROGRESS)if(e===S.TOKEN_REVOKED)h.redirectToRealizeSyncWebApp(r.absUrl().toString(),"","");else{var t=d.assignmentSelected.assignmentId,n=s.classId,a=v.ASSIGNMENT_LIST;h.syncAssignment(t,n,a,d.assignmentSelected).then(function(){d.syncObject=h.getAssignmentSyncStatus(t,n)}).catch(function(){T.error(l.showAssignmentSyncGenericExternalError()),d.syncObject=h.getAssignmentSyncStatus(t,n)}),d.syncObject=h.getAssignmentSyncStatus(t,n)}},d.isAssignmentSyncFailed=function(e){var t=_.findWhere(d.assignmentErrorData,{assignmentId:e.assignmentId});return t&&t.status===S.ERROR_UPPERCASE&&!e.hidden&&d.classRosterData.isGoogleClass()?t.isRevokeError||t.isSyncError:!1}}}}]),angular.module("Realize.assignment.listByStudent",["Realize.analytics","Realize.assignment.assignmentsListByStudentService","Realize.assignment.facadeService","Realize.common.mediaQueryService","rlzComponents.components.googleClassroom.constants","rlzComponents.components.needsToConnect","components.realize.user","rlzComponents.assignmentTelemetryModule","rlzComponents.routedComponents.assignments.constants"]).directive("assignmentsListByStudent",["$log","$rootScope","$routeParams","AssignmentFacadeService","ASSIGNMENT_CONSTANTS","$location","AssignmentListByStudentService","MediaQuery","lwcI18nFilter","currentUser","assignmentTelemetryService","ASSIGNMENT_TELEMETRY_CONSTANTS","GOOGLE_CLASSROOM","needsToConnectService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g){"use strict";
return{scope:{classRosterData:"="},templateUrl:"templates/assignment/teacher/assignmentsListByStudent/assignmentsListByStudent.html",link:function(e){e.componentLoading=!0,e.useShortLables=!o.breakpoint.isDesktop,e.$on("window.breakpoint.change",function(){e.useShortLables=!o.breakpoint.isDesktop}),r.getAssignmentsByStudent(n.classId).then(function(r){function o(e){return e.totalAssignmentsCount>0?-1*e.incompleteAssignmentsCount:null}var p=t.currentUser.isStudent?s.STATUS.NOT_STARTED:s.STATUS.COMPLETED;e.activeTab=n.status||p,e.studentsList=e.classRosterData.students,e.studentResultList=[],_.each(r,function(t,n){var r=_.find(e.studentsList,function(e){return n===e.userId});r&&(t.name=r.lastFirst,t.avatarUrl=r.avatarUrl,t.googleConsentProvided=r.userAttributes.googleConsentProvided,t.assignmentsCompleted=t.totalAssignmentsCount-t.incompleteAssignmentsCount),e.studentResultList.push(t)}),e.getStudentConsent=function(e){return e.googleConsentProvided},e.preventClickPropagation=function(t,n){e.getStudentConsent(n)||(t.stopPropagation(),g.closeAll(t))},e.isGoogleClass=function(){return e.classRosterData.rosterSource===m.ROSTER_SOURCE.GOOGLE_CLASSROOM};var f={NAME:"name",STATUS:"assignmentStatus",AVERAGE:"studentAverageScore"};e.assignmentCompleted=function(e){return e.totalAssignmentsCount>0&&e.totalAssignmentsCount===e.assignmentsCompleted},e.assignmentNotCompleted=function(e){return e.totalAssignmentsCount>0&&e.totalAssignmentsCount!==e.assignmentsCompleted},e.assignmentNotScored=function(e){return 0===e.totalAssignmentsCount},e.showNotScored=function(e){return e.totalAssignmentsCount>0&&e.notScoredAssignmentsCount>0&&0===e.notSentAssignmentsCount},e.showNotSent=function(e){return e.totalAssignmentsCount>0&&e.notSentAssignmentsCount>0},e.showAverage=function(e){return e.totalAssignmentsCount>0&&0===e.notScoredAssignmentsCount&&0===e.notSentAssignmentsCount&&e.studentAverageScore&&e.studentAverageScore.isValid},e.showDash=function(e){return 0===e.totalAssignmentsCount||0===e.notSentAssignmentsCount&&0===e.notScoredAssignmentsCount&&(!e.studentAverageScore||!e.studentAverageScore.isValid)},e.componentLoading=!1,t.pageLoaded(),e.openStudentStatus=function(t,r){t.preventDefault(),t.stopPropagation();var s="/classes/"+e.classRosterData.classId+"/student/"+r.id+"/assignments";a.path(s).search({activeTab:n.activeTab})},e.openStudentCompleteStatus=function(t,r){t.preventDefault(),t.stopPropagation();var i="/classes/"+e.classRosterData.classId+"/student/"+r.id+"/assignments";a.path(i).search({status:s.STATUS.COMPLETED,activeTab:n.activeTab})};var h=function(e){var t={sortField:"name",isReverseOrdered:!1};return angular.isDefined(e)&&angular.isDefined(e.sortOrder)&&angular.isDefined(e.sortField)?angular.extend({},t,{sortField:e.sortField,isReverseOrdered:"DESC"===e.sortOrder}):t},v=i.getSortByScore(),S=c.getAttribute(s.SORT_ASSIGNMENT_STUDENT_KEY),T=h(S);e.sortingOrder=T.sortField,"name"===T.sortField?e.sortAssignmentByStudent="name":"assignmentStatus"===T.sortField?e.sortAssignmentByStudent=[o,"name"]:"studentAverageScore"===T.sortField&&(e.sortAssignmentByStudent=v),e.reverse=T.isReverseOrdered,e.sortBy=function(t){e.sortingOrder===t?e.reverse=!e.reverse:("name"===t?e.sortAssignmentByStudent="name":"assignmentStatus"===t?e.sortAssignmentByStudent=[o,"name"]:"studentAverageScore"===t&&(e.sortAssignmentByStudent=v),e.reverse=!1,e.sortingOrder=t);var n=e.reverse?s.DESC:s.ASC;c.setAttribute(s.SORT_ASSIGNMENT_STUDENT_KEY,{sortField:t,sortOrder:n},!0),A()};var A=function(){var t=e.reverse?d.DESCRIPTION.DESC:d.DESCRIPTION.ASC;u.sendAssignmentSortTelemetryEvent(I(e.sortingOrder),t,d.PAGE.ASSIGNMENTS_BY_STUDENT)},I=function(e){return e===f.NAME?l("assignmentList.columnHeader.studentName"):e===f.STATUS?l("assignmentList.columnHeader.assignmentStatus"):e===f.AVERAGE?l("assignmentList.columnHeader.average.label"):d.EMPTY_STRING};e.isSortingBy=function(t){var n=["sortBy"];return e.sortingOrder===t?n.push(e.reverse?"icon-sort-up":"icon-sort-down"):n.push("icon-sort"),n},e.getSortAriaLabel=function(t){var n=[];switch(t){case"name":n.push(l("assignmentList.columnHeader.studentName"));break;case"assignmentStatus":n.push(e.useShortLabels?l("assignmentList.columnHeaderShort.assignmentStatus"):l("assignmentList.columnHeader.assignmentStatus"));break;case"studentAverageScore":n.push(l("assignmentList.columnHeader.average.label"));break;default:console.warn("unexpected sort type received. Ignoring.")}return n.push(l("teacherItemAnalysis.sorting.sortableColumn")),e.sortingOrder===t&&n.push(e.reverse?l("masteryByStandard.sorting.sortedDescending"):l("masteryByStandard.sorting.sortedAscending")),n.join(", ")}})}}}]),angular.module("Realize.assignment.assignmentsListByStudentService",[]).service("AssignmentListByStudentService",[function(){"use strict";var e=this;e.studentDash=function(e){return 0!==e.totalAssignmentsCount&&(0!==e.notSentAssignmentsCount||0!==e.notScoredAssignmentsCount||e.studentAverageScore&&e.studentAverageScore.isValid)?void 0:e.name},e.studentAverage=function(e){return 0===e.notScoredAssignmentsCount&&0===e.notSentAssignmentsCount&&e.totalAssignmentsCount>0&&e.studentAverageScore.isValid?e.studentAverageScore.average:void 0},e.studentAverageSecondary=function(t){var n=e.studentAverage(t);return void 0!==n?t.name:void 0},e.studentNotSentAverage=function(e){return e.notSentAssignmentsCount>0&&e.studentAverageScore.isValid?e.studentAverageScore.average:void 0},e.studentNotSentAverageSecondary=function(t){var n=e.studentNotSentAverage(t);return void 0!==n?t.name:void 0},e.studentNotSent=function(e){return e.notSentAssignmentsCount>0?e.notSentAssignmentsCount:void 0},e.studentNotScoredAverage=function(e){return e.notScoredAssignmentsCount>0&&0===e.notSentAssignmentsCount&&e.studentAverageScore.isValid?e.studentAverageScore.average:void 0},e.studentNotScoredAverageSecondary=function(t){var n=e.studentNotScoredAverage(t);return void 0!==n?t.name:void 0},e.studentNotScored=function(e){return e.notScoredAssignmentsCount>0&&0===e.notSentAssignmentsCount?e.notScoredAssignmentsCount:void 0};var t=[e.studentDash,e.studentNotScored,e.studentNotScoredAverage,e.studentNotScoredAverageSecondary,e.studentNotSent,e.studentNotSentAverage,e.studentNotSentAverageSecondary,e.studentAverage,e.studentAverageSecondary];this.getSortByScore=function(){return t}}]),angular.module("Realize.assignment.teacher.levelOneCtrl",["Realize.analytics","Realize.assignment.facadeService","Realize.common.alerts","Realize.assignment.zeroStateService","rlzComponents.components.i18n","Realize.core.security.permissions","Realize.constants.googleClassroom","rlzComponents.assignmentTelemetryModule","rlzComponents.routedComponents.assignments.constants","rlzComponents.components.googleClassroom","Realize.user.currentUser"]).controller("TeacherAssignmentLevelOneCtrl",["$scope","$http","$q","Permissions","$routeParams","ClassRosterData","AssignmentData","GroupData","AssignmentFacadeService","AssignmentViewOptions","AssignmentZeroStateService","$log","AlertService","$rootScope","$location","DateRangeSelectorService","BrowserInfo","ASSIGNMENT_CONSTANTS","AssignmentUtil","lwcI18nFilter","$timeout","GOOGLE_CLASSROOM","assignmentTelemetryService","ASSIGNMENT_TELEMETRY_CONSTANTS","AssignmentErrorData","googleClassroomService","$currentUser","featureManagementService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R,C,D,b){"use strict";var P=!0,w=g.currentUser,L=f.getSavedOption(g.currentUser,"classDateRange",P)||"entireClassDuration",$=!1,O={},N=!1,M=!1,k=[],z=function(){if(e.isGoogleClass&&b.isGoogleClassroomEnabled()){var t=C.getClassSyncQueryForClassAssignment(s.classId);return C.classSyncServiceQuery(t).then(function(e){return e}).catch(function(e){return e})}},U=function(){return l.getAssignmentsByClass(e.currentRoster.classId,e.requestFilter).then(function(e){return l.getAssignmentsWithExternalProviderData(e)})},F=function(){e.isCustomDatepickerShown="assignmentsByClass"===e.activeTab&&e.searchFilters&&"hidden"!==e.activeFilterTab&&L&&"customRange"===L},x=function(t){t?e.pageLoading():e.componentLoading=!0,M&&(e.requestFilter.page=1,q()),e.$broadcast("assignmentListByClass.drawer.close");var r=n.all({assignmentData:U(),assignmentErrorData:z()});return r.then(function(t){e.editedAssignments=[],e.assignmentErrorData=C.getAssignmentErrorData(t.assignmentErrorData,D.userId),t=tt(t.assignmentData),e.currentPage=e.requestFilter.page,e.assignmentData.assignments=t.assignments,e.assignmentData.totalMatched=t.numberOfAssignments,e.assignmentData.rowCount=e.pageSize,e.assignmentData.viewTypes=t.viewTypes,e.assignmentData.gradeTypes=t.gradeTypes,e.componentLoading=!1,F(),e.pageLoaded(),M=!1},function(t){e.pageLoaded(),e.componentLoading=!1,M=!1,d.error("Failed to get assignments for request:",JSON.stringify(e.requestFilter)," Error:",JSON.stringify(t))})},B=function(){return e.activeFilterTab===v.CURRENT},V=function(){return!B()},H=function(){return e.requestFilter.page>1&&!B()&&1===e.assignmentData.assignments.length&&e.assignmentData.assignments[0].hidden===!1},G=function(){var t=e.searchFilters.dateRange.id===v.CUSTOM_DATE_RANGE&&!(e.searchFilters.dateRange.startDate&&e.searchFilters.dateRange.endDate);return t&&e.$broadcast("dateRangeSelector.selection.requested","entireClassDuration"),B()?(e.requestFilter=c.getUpdatedFilter(s.classId,e.searchFilters),c.saveFilterOptions(s.classId,e.requestFilter)):e.requestFilter=c.getDefaultFilterForHidden(s.classId),x(!0)},j=function(){e.assignmentData.assignmentsCount.totalActive++,e.assignmentData.assignmentsCount.totalHidden--,0!==e.assignmentData.assignmentsCount.totalHidden||B()?H()&&(e.requestFilter.page-=1):e.activeFilterTab=e.searchFilters.show=v.CURRENT,B()||x(!1)},q=function(){c.saveSortOptions(s.classId,e.requestFilter,V())},Y=function(){var t;return t=e.requestFilter.sortOrder===v.ASC?y.DESCRIPTION.ASC:y.DESCRIPTION.DESC},W=function(){var t;switch(e.requestFilter.sortField){case"TITLE":t=T("assignmentList.columnHeader.assignmentTitle.label");break;case"DUE_DATE":t=T("assignmentList.columnHeader.dueDate.label");break;case"SCORE":t=T("assignmentList.columnHeader.average.label");break;default:t=y.EMPTY_STRING}return t},K=function(t){e.requestFilter.sortField=t.sortField,e.requestFilter.sortOrder=t.sortOrder;var n={sortField:e.requestFilter.sortField,sortOrder:e.requestFilter.sortOrder};w.setAttribute(v.ASSIGNMENT_BYCLASS_KEY,n,!0)},Q=function(t){e.requestFilter.page=1,(e.requestFilter.sortField!==t.sortField||e.requestFilter.sortOrder!==t.sortOrder)&&K(t),x(!1),E.sendAssignmentSortTelemetryEvent(W(),Y(),y.PAGE.ASSIGNMENTS_BY_CLASS,y.EMPTY_STRING)},X=function(){N&&(e.componentLoading=!0,e.activeFilterTab=e.searchFilters.show,G(),N=!1,e.$broadcast("assignmentListByClass.drawer.close"))},Z=function(t){p.search("activeTab",t).replace(),p.search().studentNavigationBackId&&p.search("studentNavigationBackId",null),e.activeTab=t,F()},J=function(t,n){var r,s,a,i={success:{message1:T("assignmentList.bulkShowHide.successNotification.message1"),message2:T("assignmentList.bulkShowHide.successNotification.message2"),title:T("assignmentList.bulkShowHide.successNotification.title"),sign:"ok-sign"},error:{message:T("assignmentList.bulkShowHide.errorNotification.message"),sign:"exclamation-sign"}};"success"===t?(r="<strong>"+i[t].title+"</strong>",s=n?i[t].message1:i[t].message2):(r="",s=i[t].message),a=[r,s].join(" "),m.addAlert(t,i[t].sign,a,1),e.alertDetails=m.alerts[0],e.alertIsSet=m.alertIsSet()},et=function(){e.$broadcast("assignments.bulkShowHide.finish"),x(!1)},tt=function(e){return _.forEach(e.assignments,function(e){e=S.getAssignmentWithProgramHierarchy(e)}),e};e.assignmentData=tt(i),e.classRosterData=a,e.groupData=o,e.zeroState=u.getZeroState(e.classRosterData.classId),e.searchFilters={show:v.CURRENT},e.activeFilterTab=e.searchFilters.show,e.requestFilter=c.getDefaultFilter(s.classId),e.assignmentData.rowCount=e.pageSize=e.requestFilter.pageSize,e.requestFilter.page!==i.page&&(e.requestFilter.page=i.page,q()),e.currentPage=e.requestFilter.page,e.editedAssignments=[],e.assignmentErrorData=C.getAssignmentErrorData(R,D.userId),e.activeTab=s.activeTab||"assignmentsByClass",e.navigationFallback="/classes",e.pageLoading(),F(),e.hasPermission=r.hasPermission,e.isGoogleClass=a.rosterSource===I.ROSTER_SOURCE.GOOGLE_CLASSROOM,e.alertDetails=m.alerts[0],e.alertIsSet=m.alertIsSet(),e.showTab=function(t){if($){var n=A(function(){e.$broadcast("assignments.bulkShowHide.confirm",{currentState:O,nextAction:Z,nextAssignmentTab:t})});k.push(n)}else e.$broadcast("assignments.bulkShowHide.finish"),Z(t)},e.hasZeroState=function(){return _.any(e.zeroState)},e.hasZeroStateNotHiddenView=function(){return e.hasZeroState()&&"hidden"!==e.activeFilterTab},e.isAssignmentsByClassView=function(){var t=!e.hasZeroState()&&"assignmentsByClass"===e.activeTab,n=e.zeroState.allHidden&&"hidden"===e.activeFilterTab&&"assignmentsByClass"===e.activeTab;return t||n},e.needsPagination=function(){return e.isAssignmentsByClassView()&&!e.componentLoading&&e.assignmentData.totalMatched>e.pageSize},e.$on("assignmentListByClass.assignment.sortUpdate",function(e,t){d.log("Sorting by ",t),Q(t)}),e.$on("assignmentListByClass.assignment.hidden",function(t,n){d.log("Hidden:",n),e.assignmentData.assignmentsCount.totalHidden++,e.assignmentData.assignmentsCount.totalActive--}),e.$on("hiddenAssignmentsList.assignment.restored",j),e.$on("assignment:searchFilterUpdated",function(t,n){if(d.log("Filter updated:",n,n.dateRange),N=!0,$){var r=A(function(){e.$broadcast("assignments.bulkShowHide.confirm",{currentState:O,nextAction:X})});k.push(r)}else e.$broadcast("assignments.bulkShowHide.finish"),X()}),e.$on("assignment:edit:success",function(t,n){e.$broadcast("assignmentListByClass.drawer.close"),angular.isFunction(n.callback)&&n.callback()}),e.$on("dateRangeSelector.selection.change",function(e,t){L=t.id,F()}),e.$on("assignment:zeroState:viewHidden",function(){e.$broadcast("assignment:filter:viewHidden")}),e.$on("assignments.bulkShowHide.succeeded",function(t,n){var r=n.currentTab===v.CURRENT;r?(e.assignmentData.assignmentsCount.totalActive=e.assignmentData.assignmentsCount.totalActive-n.assignmentCount,e.assignmentData.assignmentsCount.totalHidden=e.assignmentData.assignmentsCount.totalHidden+n.assignmentCount):(e.assignmentData.assignmentsCount.totalActive=e.assignmentData.assignmentsCount.totalActive+n.assignmentCount,e.assignmentData.assignmentsCount.totalHidden=e.assignmentData.assignmentsCount.totalHidden-n.assignmentCount),M=!0,N?X():0===e.assignmentData.assignmentsCount.totalHidden?e.activeFilterTab=e.searchFilters.show=v.CURRENT:x(!0),J("success",r)}),e.$on("assignments.bulkShowHide.failed",function(){J("error")}),e.$on("assignments.bulkShowHide.initiated",function(e,t){$=!0,O=t}),e.$on("assignments.bulkShowHide.finished",function(){$=!1}),e.$watch("zeroState",function(t){e.zeroState=t},!0),e.$watch("currentPage",function(t,n){if(t!==n){var r=e.requestFilter.page!==t;e.requestFilter.page=t,q(),r&&($?e.$broadcast("assignments.bulkShowHide.confirm",{currentState:O,nextAction:et}):et())}}),e.$on("$destroy",function(){k.forEach(function(e){A.cancel(e)}),k=null})}]),angular.module("Realize.assignment.teacher.levelTwoCtrl",["components.alert","Realize.common.alerts","Realize.content.constants","Realize.assignment.utilService","rlzComponents.routedComponents.assignments","rlzComponents.components.googleClassroom","rlzComponents.components.googleClassroom.constants","Realize.user.currentUser","rlzComponents.assignmentTelemetryModule","rlzComponents.routedComponents.assignments.constants"]).controller("TeacherAssignmentLevelTwoCtrl",["$scope","$rootScope","$location","AssignmentUtil","AssignmentFacadeService","ClassAndAssignmentData","GroupData","$log","AlertService","Modal","$filter","Messages","CONTENT_CONSTANTS","UnsavedChangesModal","rubricEventTracking","telemetryUtilitiesService","googleClassroomService","$timeout","GOOGLE_CLASSROOM","Toast","AssignmentErrorData","$currentUser","GoogleClassroomConstants","assignmentTelemetryService","ASSIGNMENT_TELEMETRY_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R){"use strict";e.assignmentErrorData=h.getAssignmentErrorData(A,I.userId),e.classAndAssignmentData=a,e.currentRoster=a.roster,e.assignment=a.assignment,e.groupList=i,e.gradeInput=n.path().search("/allstudents/gradeInput")>0,e.actionLinksTemplate="templates/assignment/teacher/levelTwo/levelTwoActionLinks.html";var C=e.currentRoster.isGoogleClass();h.setFailedAssignmentSyncDetails(e.assignmentErrorData,e.assignment,C,e.currentRoster.classId),e.syncObject=h.getAssignmentSyncStatus(e.assignment.assignmentId,e.currentRoster.classId),(e.syncObject&&e.syncObject.status===S.SYNC_SUCCESS||!e.syncObject)&&(e.syncObject=h.getAssignmentDefaultStatus()),e.$on("$locationChangeStart",function(e){b||k(null,e)}),e.getScore=function(t,n){if(n){var r=n.$getEquellaItemId(),s=e.assignment.$findItemMetadata(r,t.studentUuid);if(s&&s.userAssignmentDataList&&s.userAssignmentDataList.length>0){var a=s.userAssignmentDataList[0];return e.hasEssayScorer?(e.essayScoreData=a.correctAnswers/a.totalQuestions*6,u("number")(e.essayScoreData,0)+"/6"):u("number")(a.score,0)}if("SCO"===n.fileType||n.fileType===m.FILE_TYPE.TIN_CAN_SCO||"TEST"===n.fileType)return 0}},e.isSaveDisabled=function(){return e.gradeInputForm.$pristine},e.isAdaptive=function(){return e.assignment.type===m.MEDIA_TYPE.ADAPTIVE},e.cancel=e.closeGradeInputView=function(e){var t=n.path().split("/assignments")[0]+"/assignments";e&&(e.preventDefault(),e.stopPropagation()),n.path(t)},e.back=function(e){if(n.search().masteryByStandard){var t=n.path().split("/"),r="/data/"+t[2]+"/standards";n.search("masteryByStandard",null),n.path(r)}else{var s=n.path().split("/assignments")[0]+"/assignments";e&&(e.preventDefault(),e.stopPropagation()),n.path(s)}},e.preview=function(){s.preview([n.path().split("/gradeInput")[0],"preview"].join("/"))},e.viewReportScreen=function(){r.redirectToReportScreen(e.assignment),y.sendQuickLinkTelemetryEvent(e.assignment,R.DATA_LINK,R.PAGE.STUDENT_STATUS,R.EMPTY_STRING)},e.viewDiscussion=function(t,r,s){var a=["/classes",n.path().split("/")[2],"discussPrompt/assignments",e.assignment.assignmentId,"content",r.id].join("/");n.path(a).search({studentId:angular.isDefined(s)&&s.studentUuid,discuss:e.assignment.isAssignmentPastDueDate()?null:"active"})},e.hideAssignment=function(){s.hideAssignment(e.assignment,e.currentRoster.classId,C)},e.unhideAssignment=function(){s.unhideAssignment(e.assignment,e.currentRoster.classId,C)},e.alertDetails=l.alerts[0],e.alertIsSet=l.alertIsSet(),e.showGradeInputView=function(){var e=n.path();-1===e.search("/gradeInput")&&(e+="/gradeInput",n.path(e))},e.showDataLink=function(){return r.setDataLinkDetails(e.assignment),e.assignment.showDataLink};var D=function(){var e;e=C?d.getMessage("assignmentStatus.successNotification.gradeInput.googleMessage"):["<strong>",d.getMessage("assignmentStatus.successNotification.gradeInput.title"),"</strong>",d.getMessage("assignmentStatus.successNotification.gradeInput.message")].join(" "),l.addAlert("success","ok-sign",e,2)};e.reviewManualScore=function(){var e=[n.path().split("/allstudents")[0],"manualScoreReview"].join("/");n.path(e)};var b=!1,P={},w=[].concat(a.notStartedList,a.inProgressList,a.completedList),L={userAssignmentDataList:[]},$=function(t){D(),e.closeGradeInputView(t)},O=function(){return angular.element(".gradeInputForm").scope().gradeInputForm},_=new g(function(t){var n=!0;return e.save(t,n)}),N=function(){return!angular.equals(P,e.gradeInfo)},M=function(){return e.gradeInputForm.$valid?!0:e.gradeInputForm.$error.required?!0:e.gradeInputForm.$error.pattern?!1:void 0},k=function(t,n){var r=!O()||O().$pristine;!r&&N()&&_.showDialog(n).then(t,function(){e.pageLoaded()})},z=function(e,t){return L.userAssignmentDataList.push({userAssignmentId:e.userAssignmentId,score:angular.isDefined(t)?t:0,scoreSent:!0}),L.studentUuid=e.studentUuid,L};angular.forEach(w,function(t){P[t.userAssignmentId]=u("number")(e.getScore(t,e.assignment.contentItem),0)}),e.gradeInfo=angular.copy(P),e.save=function(t,n){b=!0,M()&&(N()?(angular.forEach(w,function(t){P[t.userAssignmentId]!==e.gradeInfo[t.userAssignmentId]&&(z(t,e.gradeInfo[t.userAssignmentId]),U(e.gradeInfo[t.userAssignmentId]))}),s.saveManuallyEnteredScore(L).then(function(){n||$(t)})):$(t))};var U=function(t){e.productName&&e.assetsCount?p.onAssignmentScoreUpdate(t,e.productName,e.assetsCount):(e.assetsCount=e.assignment.childContents?e.assignment.childContents.length:1,e.productName=f.getProgramTitle(e.assignment.programHierarchy),p.onAssignmentScoreUpdate(t,e.productName,e.assetsCount))};e.syncWithGoogle=function(t){if(t!==S.SYNC_SUCCESS&&t!==S.SYNC_IN_PROGRESS)if(t===E.TOKEN_REVOKED)h.redirectToRealizeSyncWebApp(n.absUrl().toString(),"","");else{var s=e.assignment.assignmentId,a=e.currentRoster.classId,i=S.ASSIGNMENT_DETAIL;h.syncAssignment(s,a,i,e.assignment).then(function(){e.syncObject=h.getAssignmentSyncStatus(s,a)}).catch(function(){T.error(r.showAssignmentSyncGenericExternalError()),e.syncObject=h.getAssignmentSyncStatus(s,a)}),e.syncObject=h.getAssignmentSyncStatus(s,a)}}}]),angular.module("Realize.assignment.teacher.notebook.notebookConfig",["Realize.assignment.teacher.notebook.constants","NotebookApp","ngRoute","Realize.common.tokenRecovery"]).factory("NotebookInterceptor",["$injector","$log","$q","NOTEBOOK_CONSTANTS","$window","$rootScope",function(e,t,n,r,s,a){"use strict";return{request:function(t){if(t.url.indexOf(s.notebookServiceUrl)>-1){var n=e.get("NotebookTokenService");return t.service=r.APP_NAME,n.getToken().then(function(e){return t.headers.Authorization="Bearer "+e,r.CONFIG.POST===t.method&&(t.headers["Content-Type"]=r.CONFIG.CONTENT_TYPE,t.transformRequest=function(e){return JSON.stringify(e)}),t})}return t},responseError:function(e){return e.config.url.indexOf(s.notebookServiceUrl)>-1&&e.status!==r.HTTP_UNAUTHORISED&&e.status!==r.HTTP_PAGE_NOT_FOUND&&a.$emit("notebook.server.error"),n.reject(e)}}}]).config(["NotebookConfigProvider","$httpProvider","NOTEBOOK_CONSTANTS","$windowProvider","$routeProvider","CommonTokenRecoveryProvider",function(e,t,n,r,s,a){"use strict";var i=r.$get(),o="templates";e.set("domainPath",i.notebookServiceUrl),e.set("maxPromptsPerPageForPagination",n.ENTRIES_PER_PAGE),e.set(n.CONFIG.ENABLE_MULTI_SORT_PROMPTS,!0),e.set(n.CONFIG.DEFAULT_SORT_PROMPTS_BY,"questionOrder"),t.interceptors.push("NotebookInterceptor"),a.registerTokenProvider("NotebookTokenService"),s.when("/classes/:classId/assignments/:assignmentId/allstudents/:userAssignmentId/review",{controller:"NotebookCtrl",controllerAs:"nbCtrl",templateUrl:o+"/assignment/teacher/notebook/notebook.ctrl.html",resolve:{resolveClassAndAssignmentData:["Resolve",function(e){return e.TeacherSingleAssignment()}],resolveGroupData:["Resolve",function(e){return e.GroupList()}]}})}]),angular.module("Realize.assignment.teacher.notebook.constants",[]).constant("NOTEBOOK_CONSTANTS",{MAX_HIT_COUNT:3,HTTP_UNAUTHORISED:401,HTTP_PAGE_NOT_FOUND:404,PREFIX:{NOTEBOOK_ID:"NotebookID",NOTEBOOK_TOC:"NotebookTOC",NOTEBOOK_TOKEN:"NotebookToken"},CONFIG:{POST:"POST",CONTENT_TYPE:"application/json; charset=utf-8",ENABLE_MULTI_SORT_PROMPTS:"enableMultiSortPrompts",DEFAULT_SORT_PROMPTS_BY:"defaultSortPromptsBy"},DISPLAY_TYPE:"date",ENTRIES_PER_PAGE:20,APP_NAME:"notebook"}),angular.module("Realize.assignment.teacher.notebook.notebookCtrl",["Realize.assignment.teacher.notebook.notebookConfig","Realize.assignment.teacher.notebook.apiService","Realize.common.studentNavigation","Realize.assignment.utilService","rlzComponents.routedComponents.assignments"]).controller("NotebookCtrl",["$rootScope","NotebookApiService","resolveClassAndAssignmentData","NOTEBOOK_CONSTANTS","$location","NavigationService","$routeParams","AssignmentUtil","resolveGroupData","assignmentHelperService",function(e,t,n,r,s,a,i,o,l,c){"use strict";var u=this;t.assignmentData=n;var d=n.roster,m=n.assignment;u.assignedTo=c.getAssignedToList(m,d,l),u.assignmentTitle=t.getPageTitle(),u.showAllNotes=!1,u.completedStudents=t.getCompletedStudentList(),u.currentStudent=_.findWhere(u.completedStudents,{userAssignmentId:i.userAssignmentId}),e.viewLoading=!0,u.isError=!1,u.showStudentReview=function(e){var t=s.path().replace(i.userAssignmentId,e.userAssignmentId);a.replaceLocationWith(t)},t.resolveNotebookToc().then(function(t){u.toc=t,u.showAllNotes=!0,e.viewLoading=!1}),u.back=function(){var e=o.generateNotebookBackLink(u.currentStudent.studentInfo.userId);a.replaceLocationWith(e)},e.$on("notebook.server.error",function(){u.isError=!0,e.viewLoading=!1})}]),angular.module("Realize.assignment.teacher.notebook.apiService",["Realize.assignment.teacher.notebook.constants","Realize.constants.mediaType","Realize.paths","NotebookApp"]).factory("NotebookApiService",["$q","REST_PATH","$http","webStorage","NotebookService","NotebookUIConfigService","NOTEBOOK_CONSTANTS","$window","$location","$route","MEDIA_TYPE","AssignmentUtil",function(e,t,n,r,s,a,i,o,l,c,u,d){"use strict";a.setShowAllNotesHeader(!1),a.setShowAllNotesDisplayOptions(!1),a.setShowAllNotesHeader(!1),a.setEditEnabled(!1),a.setShowUnansweredPrompts(!0),a.setShowZeroStateMessages(!0),a.setUseSnapshot(!0);var m={},g=function(e){return r.get(e)},p=function(e,t){r.add(e,t)},f=function(t){var n=t.bookId,r=g(i.PREFIX.NOTEBOOK_ID.concat(n));return r?e.when(r):s.createBook(o.realizeReaderAppName,n).then(function(e){return p(i.PREFIX.NOTEBOOK_ID.concat(n),e),e},function(t){e.reject(t)})},h=function(r){var s=g(i.PREFIX.NOTEBOOK_TOC.concat(r.tocKey));return s?e.when(JSON.parse(s)):n({url:t+"/toc/"+r.bookId,method:"GET",params:{pageNumbers:r.pages}}).then(function(e){return angular.forEach(e.data.units,function(e){e.pages=e.pages||[]}),p(i.PREFIX.NOTEBOOK_TOC.concat(r.tocKey),JSON.stringify(e.data)),e.data},function(t){return e.reject("error getting toc",t)})},v=function(){var e=m.assignmentData.assignment.contentItem.contentItems,t={id:l.search().contentId},n=_.findWhere(e,t);if(!n)for(var r=0;r<e.length;++r)if(e[r].mediaType===u.LEARNING_MODEL&&e[r].contentItems.length&&(n=_.findWhere(e[r].contentItems,t)))return n;return n},S=function(){var e,t,n,r=m.assignmentData.assignment.contentItem.bookId;return r?(e=m.assignmentData.assignment.contentItem.pages,n=m.assignmentData.assignment.assignmentId):l.search().contentId&&(t=v(),r=t.bookId,e=t.pages,n=l.search().contentId),{bookId:r,pages:e,tocKey:n}};return m.resolveNotebookToc=function(){var e=S();return a.setSnapshotId(c.current.params.userAssignmentId),f(e).then(function(t){return s.currentBookId=t,h(e).then(function(e){return s.resolveToc(e).then(function(e){return e})})})},m.getPageTitle=function(){var e=l.search();return e&&e.contentId?v().$getTitle():m.assignmentData.assignment.$getTitle()},m.getCompletedStudentList=function(){var e=l.search(),t=[].concat(m.assignmentData.completedList);return e&&e.contentId&&t.map(function(t){t.userAssignmentId=m.assignmentData.assignment.$findItemMetadata(e.contentId,t.studentInfo.userId).userAssignmentId}),d.sortByStudentName(t)},m}]),angular.module("Realize.assignment.teacher.notebook.notebookTokenService",["Realize.paths","Realize.assignment.teacher.notebook.constants","Realize.user.currentUser"]).factory("NotebookTokenService",["REST_PATH","$http","$log","$q","$rootScope","$route","webStorage","NOTEBOOK_CONSTANTS","$currentUser",function(e,t,n,r,s,a,i,o,l){"use strict";var c={},u=function(){var e=a.current.params.userAssignmentId;return o.PREFIX.NOTEBOOK_TOKEN+l.userId+e},d=0;return c.getToken=function(){var s=c.getTokenFromCache(),i=a.current.params.userAssignmentId;if(s)return r.when(s);var o=e+"/notebooks/tokens/classes/"+a.current.params.classId+"/userAssignments/"+i;return t({url:o,method:"POST"}).then(function(e){return c.tokenStore(e.data.id),d=0,e.data.id},function(e){return n.error("error getting notebook token",e),r.reject("error getting notebook token",e)})},c.getTokenFromCache=function(){return i.session.get(u())},c.tokenStore=function(e){i.session.add(u(),e)},c.deleteToken=function(){i.session.remove(u())},c.shouldIntercept=function(e){return e.service&&e.service===o.APP_NAME},c.recoverToken=function(e){return c.deleteToken(),d<o.MAX_HIT_COUNT?(d++,n.info("[NotebookToken]: token failure, retry attempt:"+d),c.getToken()):(n.error("[NotebookToken]: max hit count exceeded"),r.reject("notebook token max hit count exceeded",e))},c}]),angular.module("Realize.alerts.alertService",[]).factory("AlertService",["$rootScope",function(e){"use strict";var t={};t.alerts=[],t.addAlert=function(e,n,r,s){t.alerts.push({type:e,icon:n,msg:r,lifespan:s})},t.alertIsSet=function(){return t.alerts[0]&&""!==t.alerts[0].msg};var n=function(){t.alerts.splice(0,1)};return e.$on("$routeChangeStart",function(){t.alerts[0]&&t.alerts[0].lifespan&&(t.alerts[0].lifespan--,t.alerts[0].lifespan<=0&&n())}),t}]),angular.module("Realize.alerts.inlineAlertService",[]).factory("InlineAlertService",["$log",function(e){"use strict";var t={};return t.alerts=[],t.addAlert=function(n,r){e.debug("addAlert: ",n,r),t.getAlert(n,!0);var s={id:n,alert:r};t.alerts.push(s)},t.getAlert=function(e,n){var r;return r=_.find(t.alerts,function(t){return t.id===e}),n&&r&&t.removeAlert(r),r},t.removeAlert=function(e){t.alerts.splice(t.alerts.indexOf(e),1)},t}]),angular.module("Realize.content.model.contentItem",["Realize.content.constants","Realize.common.browserInfoService","Realize.common.mediaQueryService","Realize.common.helpers","Realize.common.keyStore","Realize.standards.standardDataService","Realize.paths","Realize.constants.mediaType","Realize.content.model.gooruItem","Realize.content.model.openEdItem","Realize.constants.contribSource","Realize.user.currentUser","Realize.constants.contentUploadTypes"]).factory("Content",["$http","$log","$rootScope","$q","PATH","$filter","KeyStore","CONTENT_CONSTANTS","OpenEdItem","Standard","RealizeHelpers","$cacheFactory","BrowserInfo","MediaQuery","MEDIA_TYPE","CONTRIBUTOR_SOURCE","$location","User","$currentUser",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S){"use strict";function T(e){angular.forEach(e.standards,function(t){c.localeDescription(t,e.language)}),e.contentItems&&angular.forEach(e.contentItems,function(e){T(e)})}function A(e){var t=this;angular.extend(t,e||{}),t.contentItems=(t.contentItems||[]).map(function(e){return new A(e)}),angular.forEach(t.contentItems,function(e){T(e)}),t.associatedTools&&t.associatedTools.contentItems&&(t.associatedTools.contentItems=t.associatedTools.contentItems.map(function(e){return new A(e)})),t.associatedTeacherSupport&&t.associatedTeacherSupport.contentItems&&(t.associatedTeacherSupport.contentItems=t.associatedTeacherSupport.contentItems.map(function(e){return new A(e)})),t.metrics||(t.metrics={uuid:null,version:1,visitCount:0,commentCount:0}),t.$buildFromDetailsTree()}function I(e,t){if(!t.fileType)return!1;var n=angular.lowercase(e),r=angular.lowercase(t.contribSource),s=angular.lowercase(t.externalSource);return r===n||s===n}var E=function(e){angular.forEach(e.results,function(e){T(e)})},y=function(e){"Spanish"!==n.currentProgram.language&&"es"!==n.currentUser.getAttribute("profile.locale")||""===e.spanishDescription||null===e.spanishDescription||(e.description=e.spanishDescription)},R=function(e){var t=[];return angular.forEach(e.data.questions,function(e){angular.forEach(e.skillDetails,function(e){y(e)}),t.push(e)}),angular.extend({},e.data,{results:t})},C=function(e){t.log("content query success handler",arguments);var n=[];return angular.forEach(e.data.results,function(e){n.push(new A(e))}),l.retrieveItemsInList(n,function(e){return"OpenEd"===e.externalSource}).then(function(t){var n=angular.copy(e.data);return n.results=t,n})},D=function(e){var n,r=$.Enumerable.From(e.results).Where('$.mediaType == "Lesson" && $.teacherOnly == "UNKNOWN"').Select("$.id").ToArray();if(r.length>0)return n=A.getTeacherOnlyValues(r).then(function(t){var n,r,s;for(n in t.data)if(t.data.hasOwnProperty(n))for(r=0,s=e.results.length;s>r;r++)if(e.results[r].id===n){e.results[r].teacherOnly=t.data[n]?"Yes":"No";
break}var a=angular.copy(e);return a});t.log("content.query : no unknowns to test");var s=angular.copy(e);return s};A.query=function(n,r,a){t.log("Content.query called",n);var i=s.REST+(r?"/items":"/content"),o=e.get(i,{params:n,cache:!!a}).then(function(e){return e.data.results=A.getListWithCustomizedTestInserted(e.data.results),e}).then(C).then(D);return n.STATE_STANDARD&&o.then(E),o},A.queryFast=function(t,n,r){var a=null,i=[];return a=e.get(s.REST+"/search_fast",{params:t}).then(function(e){var t=[];return angular.forEach(e.data,function(e){t.push(new A(e))}),i=angular.copy(t)}),angular.isDefined(n)&&angular.isFunction(n)&&a.then(n),angular.isDefined(r)&&angular.isFunction(r)&&a.then(null,r),i},A.getETexts=function(t,n){return e.get(s.REST+"/search_fast",{params:{OLE_PRODUCT_ID:t,pageSize:"20",MEDIA_TYPE:"eText",filterBySubscriptions:!0,NOT_ITEM_STATUS:["deleted","archived"]},cache:!!n}).then(function(e){var t=[];return _.each(e.data,function(e){t.push(new A(e))}),t},function(e){return r.reject(e)})},A.getToolsByPrograms=function(t,n){var a=e.get(s.REST+"/tools",{params:{programs:t},cache:!!n}).then(function(e){var t=[];return _.each(e.data,function(e){t.push(new A(e))}),t},function(e){return r.reject(e)});return a},A.setStudentCenterData=function(t){var n=null;return n=e.post(s.REST+"/studentcenters",t).then(function(e){return e.data})},A.get=function(n,r,a,i){t.log("Content.get async called",arguments);var o={},c=null,u=r?[s.REST,"items",n.contentId,"versions",n.version].join("/"):[s.REST,"content",n.contentId,n.version].join("/");return delete n.contentId,delete n.version,angular.isDefined(n.levels)||(n.levels=1),c=e.get(u,{params:n,cache:!!a}).then(function(e){return E(e.data),e}).then(function(e){if(!i){var t="Sequence"===e.data.fileType&&A.hasCustomizedItem(e.data);t&&(e.data.customizedItem.contentItems=A.getListWithCustomizedTestInserted(e.data.customizedItem.contentItems)),e.data.contentItems=A.getListWithCustomizedTestInserted(e.data.contentItems)}return e}).then(function(e){if(o=angular.copy(new A(e.data)),"Sequence"===o.fileType){var t=function(e){return"OpenEd"===e.externalSource};return l.retrieveItemsInList(o.contentItems,t).then(function(){return o.$updateTeacherOnly()})}if("OpenEd"===o.externalSource){var n=o.id;return l.getPromise(o.externalId).then(function(e){return o=new A(e),o.id=n,o.$updateTeacherOnly()})}return o.$updateTeacherOnly()})},A.getCustomContent=function(t){var n={},r=null,a=[s.REST,"content","updateassociateditems"].join("/");return r=e({method:"POST",url:a,data:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(function(e){return E(e.data),e}).then(function(e){if(n=angular.copy(new A(e.data)),"Sequence"===n.fileType){var t=function(e){return"OpenEd"===e.externalSource};return l.retrieveItemsInList(n.contentItems,t).then(function(){return n.$updateTeacherOnly()})}if("OpenEd"===n.externalSource){var r=n.id;return l.getPromise(n.externalId).then(function(e){return n=new A(e),n.id=r,n.$updateTeacherOnly()})}return n.$updateTeacherOnly()})},A.getWithoutInsertingCustomized=function(e,t,n){var r=!0;return A.get(e,t,n,r)},A.getCustomisedVersions=function(n,r){var a=s.REST+"/customizeditems/"+n.id,i=e.get(a,{cache:!!r}).then(function(e){var t=[];return e.data.customizedItems&&angular.forEach(e.data.customizedItems,function(e){e.isCustomizedVersion=!0,e.originalItem=n,e.originalItemId=n.id,t.push(new A(e))}),t},function(e){t.error("failed to retrieve customisedVersions",e.status,e.statusText)});return i};var b=function(e){switch(e){case"Teacher Support":return"associatedTeacherSupport";case"Tools":return"associatedTools"}};A.hasCustomizedItem=function(e){return e.mediaType===p.TEST?e.customizedItemDefaultView:e.customizedItem&&e.customizedItemDefaultView},A.isHiddenViaCustomize=function(e){return e.associativeProps&&"Teacher, HideFromStudent"===e.associativeProps.externalSource},A.prototype.$hasAssociatedItem=function(e){var t=this,n=b(e);return t[n]&&!u.isNullOrUndefined(t[n].id)&&!u.isNullOrUndefined(t[n].version)},A.prototype.$setAssociatedItem=function(e,t,n){var s=this,a=b(e),i=r.defer();return s.$hasAssociatedItem(e)?A.get({contentId:s[a].id,version:s[a].version},t,n).then(function(e){s[a]=e,i.resolve()},function(){r.reject()}):i.resolve(),i.promise},A.getRoute=function(e,t,n,r){if(t&&n&&r)return["/program",t.id,t.version,"tier",n.id,n.version,"lesson",r.id,r.version,"content",e.id,e.version].join("/");if(t&&n)return e.editAssessment?["/program",t.id,t.version,n.mediaType.toLowerCase(),n.id,n.version,"assessment",e.id,e.version,"edit"].join("/"):"Lesson"===e.mediaType?["/program",t.id,t.version,n.mediaType.toLowerCase(),n.id,n.version,"lesson",e.id,e.version].join("/"):["/program",t.id,t.version,n.mediaType.toLowerCase(),n.id,n.version,"content",e.id,e.version].join("/");if(t){if(e.editAssessment)return["/program",t.id,t.version,"assessment",e.id,e.version,"edit"].join("/");var s="Lesson"===e.mediaType||"Tier"===e.mediaType?e.mediaType.toLowerCase():"content";return["/program",t.id,t.version,s,e.id,e.version].join("/")}return e.essayPrompt?["/assessment/essay",e.id,e.version,"edit"].join("/"):"Test"===e.mediaType?["/assessment",e.id,e.version,"edit"].join("/"):"Tier"===e.mediaType&&e.root?["/program",e.id,e.version].join("/"):"Lesson"===e.mediaType?["/lesson",e.id,e.version,"edit"].join("/"):["/content",e.id,e.version].join("/")},A.publish=function(t,n){e({url:s.REST+"/jobs/items/published/"+t.id+"/"+t.version,method:"PUT"}).success(function(e){var t=[s.REST,"programs"].join("/"),r=[s.REST,"centers"].join("/"),a=d.get("$http");a.remove(t),a.remove(r),e&&n()})},A.getAssessment=function(n,r){n+=".json";var a=e({url:[s.REST,"assessment/load",n].join("/"),method:"GET"}).error(function(e){t.error("failed to retrieve assessment",e.errorCode,e.errorMessage)});return a.then(R),r&&a.success(r),a},A.getSkillsById=function(n,r){var a=e({url:s.REST+"/skills",params:{"ids[]":n},method:"GET"}).error(function(e){t.error("failed to fetch skill details",e.errorCode,e.errorMessage)});return r&&a.success(r),a},A.updateMultiValueFacets=function(e){var t=["FEATURED_RESOURCES","GRADE","LEARNING_MODEL","LIBRARY_TITLE","SUBTOPIC","COMPREHENSION_SKILLS","TEXT_FEATURES","GENRES","CONTENT_AREAS","CUSTOM_FACET_LIBRARY","CUSTOM_FACET_THEMES","CUSTOM_FACET_SKILLS_TEACHING_OPPORTUNITIES","CUSTOM_FACET_CROSS_CURRICULAR_CONNECTIONS"];angular.forEach(t,function(t){if(e[t]&&0!==e[t].length){var n=e[t].join(",");e[t]="ALL("+n+")"}})},A.updateMultiValueFacetsForBrowseAll=function(e){var t=["FEATURED_RESOURCES","GRADE","LEARNING_MODEL","LIBRARY_TITLE","SUBTOPIC","COMPREHENSION_SKILLS","TEXT_FEATURES","GENRES","CONTENT_AREAS","CUSTOM_FACET_LIBRARY","CUSTOM_FACET_THEMES","CUSTOM_FACET_SKILLS_TEACHING_OPPORTUNITIES","CUSTOM_FACET_CROSS_CURRICULAR_CONNECTIONS"];angular.forEach(t,function(t){if(e[t]&&0!==e[t].length){var n=e[t].join(",");e[t]="LIBRARY_TITLE"===t?"ANY("+n+")":"ALL("+n+")"}})},A.getLessonTOCRoute=function(e,t,n){return["/program",e,t,"tier",n,"0"].join("/")},A.getTeacherOnlyValues=function(n,r){t.log("getTeacherOnlyValues called",n);var a=e({url:s.REST+"/content/teacher_only",data:{itemUuids:n},method:"POST",cache:!0});return a.success(function(e){t.log("getTeacherOnlyValues success",e)}).error(function(e){t.error("failed to fetch teacherOnly values",e.errorCode,e.errorMessage)}),angular.isDefined(r)&&angular.isFunction(r)&&a.success(r),a},A.getContentStandards=function(e,t){var n=r.defer();return A.get({contentId:e,version:t},!1,!0).then(function(e){var t=e;t.libraryDelimited=t.stateSpecificContent&&t.parentProgramNames?t.parentProgramNames.join("|"):t.library.join("|"),c.getStandardTree(t.libraryDelimited,t).then(function(e){n.resolve({program:t,standards:e})},n.reject)},n.reject),n.promise},A.getQuestionBankStandards=function(e,t){var n=r.defer();return A.get({contentId:e,version:t},!1,!0).then(function(e){var t=e;t.libraryDelimited=t.library.join("|"),c.getQuestionBankStandardTree(t.libraryDelimited,t).then(function(e){n.resolve({program:t,standards:e})},n.reject)},n.reject),n.promise},A.filterData=new i,A.hasRemediation=function(e){return e.$hasRemediation()},A.getListWithCustomizedTestInserted=function(e){var t=[];return angular.forEach(e,function(e){if("Test"===e.mediaType&&A.hasCustomizedItem(e)&&!e.hasCustomizedVersion)e.hasCustomizedVersion=!0,t.push(e);else if("Sequence"===e.fileType&&e.contentItems&&e.contentItems.length>0){var n=e.contentItems;e.contentItems=A.getListWithCustomizedTestInserted(n),t.push(e)}else t.push(e)}),t};var P=function(e){var t;return t=e&&!g.breakpoint.isDesktop?2:e||!g.breakpoint.isDesktop?3:4};A.prototype.isLastRow=function(e,t,n,r){var s,a;return s=r?r:P(n),a=t%s,0===a?e+1>t-s:e+1>t-a},A.prototype.isLastColumn=function(e,t){var n=P(t);return(e+1)%n===0},A.prototype.$updateTeacherOnly=function(){var e,t,n=this,s=[],a=0,i=r.defer();if(n.contentItems&&n.contentItems.length>0){for(e=0,t=n.contentItems.length;t>e;e++){var o=n.contentItems[e];o.contentItems||"No"!==o.teacherOnly||"Yes"!==n.teacherOnly&&(n.teacherOnly="No"),"UNKNOWN"===o.teacherOnly.toUpperCase()&&s.push(o.id),"YES"===o.teacherOnly.toUpperCase()&&a++}a===n.contentItems.length&&(n.teacherOnly="Yes"),s.length>0?A.getTeacherOnlyValues(s).success(function(e){var t;for(t in e)if(e.hasOwnProperty(t)){var r=$.Enumerable.From(n.contentItems).Where('$.id == "'+t+'"').FirstOrDefault(null);null!==r&&(r.teacherOnly=e[t]?"Yes":"No")}i.resolve(n)}):i.resolve(n)}else"UNKNOWN"===n.teacherOnly?A.getTeacherOnlyValues([n.id]).success(function(e){n.teacherOnly=e[n.id]?"Yes":"No",i.resolve(n)}):i.resolve(n);return i.promise},A.prototype.$getTitle=function(e){var t,n,r="original"===e,s="latest"===e;return t=s?this.$getDefaultVersion(s):r?this:this.$getDefaultVersion(),n=t.associativeProps&&t.associativeProps.titleInSequence?t.associativeProps.titleInSequence:t.title},A.prototype.$getDescription=function(){var e=this.$getDefaultVersion();return e.text},A.prototype.$getEquellaItemId=function(){return this.id},A.prototype.$getDefaultVersion=function(e){var t=this,n=A.hasCustomizedItem(t);return e||!this.$isTest()||this.myContent?n?new A(t.customizedItem):t:t},A.prototype.isExternalResource=function(){var e=this;return e.isOpenEdItem()||e.$isGooruItem()},A.prototype.$getUrl=function(){var e=this.url;return/^(http|https):\/\//.test(e)||(e="http://"+e),this.mediaType===p.PARTNER_LINK&&(e="rest/externaltool/content/view/"+this.id+"/"+this.version+"?launchUrl="+e,n.currentProgram&&(e=e+"&programId="+n.currentProgram.id+"&programVersion="+n.currentProgram.version)),e},A.prototype.$hasRemediation=function(){var e=this;return!!e.$getDefaultVersion().remediationProperties&&("TEST"===e.fileType||"SCO"===e.fileType||e.fileType===o.FILE_TYPE.TIN_CAN_SCO)},A.prototype.$hasRemediationActivities=function(){var e=this;return e.remediationSkills&&!$.isEmptyObject(e.remediationSkills)},A.prototype.$hasInfo=function(){var e=[];if(angular.forEach(this.tags,function(t){$.trim(t).length>0&&e.push(t)}),this.tags=e,"etext"===this.fileType)return $.trim(this.text).length>0;var t=function(e){var t=_.isArray(e)&&_.isEmpty(e.join("").trim()),n=_.isString(e)&&0===e.trim().length;return t||n||!e?!1:!0},r=this,s=t(r.text),a=t(r.tags),i=t(r.materials),o=t(r.standards),l=t(r.pacing),c=t(r.author),u=t(r.isbn),d=t(r.lexile),m=t(r.guidedReading),g=t(r.readingMaturityMetric),p=t(r.developmentalReadingAssessment),f=t(r.quantile),h=t(r.comprehensionSkills),v=t(r.textFeatures),S=t(r.genres),T=t(r.contentAreas),A=n.currentUser.isStudent;return s||a||o||i&&!A||l&&!A||c&&!A||u&&!A||d&&!A||m&&!A||g&&!A||p&&!A||f&&!A||h&&!A||v&&!A||S&&!A||T&&!A},A.prototype.$isCustomized=function(){var e=this;return e.customizedItem&&e.customizedItemDefaultView},A.prototype.$getCustomizeContribDate=function(){var e=this;return e.$getDefaultVersion().contribDate},A.prototype.$isPearsonItem=function(){var e=this;return e.contribSource===f.PEARSON},A.prototype.$isAssignable=function(e){var r=this;return"UNKNOWN"===r.teacherOnly&&t.log("Unresolved unknown teacherOnly",r),n.currentUser.hasRole("ROLE_TEACHER")&&"No"===r.teacherOnly&&"Tier"!==r.mediaType&&"Center"!==r.mediaType&&"Playlist"!==r.mediaType&&r.mediaType!==p.LESSON||r.mediaType===p.LESSON&&e},A.prototype.isAssignableToPlaylist=function(){var e=this;"UNKNOWN"===e.teacherOnly&&t.log("Unresolved unknown teacherOnly",e);var n=S.isTeacher,r=[p.TIER,p.CENTER,p.REMEDIATION,p.STUDENT_VOICE,p.LEARNING_MODEL,p.PLAYLIST,p.LESSON,p.DESMOS,p.NOTATION,p.CENTER_CONTAINER,p.QUESTION_BANK],s=r.indexOf(e.mediaType)>-1;return n&&!s},A.prototype.$isPublishable=function(){var e=this;return n.currentUser.isContentPromoter&&!e.$isCustomized()};var w=function(e){var t=/tier/g,n=null,r=0,s=0,a=e;for(n=t.exec(e);n;)s++,s>1&&(r=n.index+4+(s-2),a=a.slice(0,r)+s+a.slice(r)),n=t.exec(e);return a};A.prototype.$getValidFromDetails=function(){var e=this;return e.fromDetailsTrees?_.filter(e.fromDetailsTrees,function(e){return 1===e.distanceFrom&&("Program"===e.containerMediaType||"Tier"===e.containerMediaType||"Lesson"===e.containerMediaType||"Learning Model"===e.containerMediaType)}):[]},A.prototype.$buildFromDetailsTree=function(){var e=this,t=[],n=null,r=null,s=100;$.Enumerable.From(e.fromDetails).ForEach(function(e){"Tier"===e.containerMediaType&&e.root&&(e.containerMediaType="Program"),e.distanceFrom<=s?(100!==s&&(n.path=w(n.path),t.push(n)),n=angular.copy(e),r=n,"Learning Model"!==n.containerMediaType?(n.treeTitle=n.containerTitle,n.path=[n.containerMediaType.toLowerCase(),n.parentItemUuid,0].join("/")):(n.treeTitle="",n.path="")):(r.parent=angular.copy(e),r=r.parent,"Learning Model"!==r.containerMediaType&&(""===n.treeTitle?(n.treeTitle=r.containerTitle,n.path=[r.containerMediaType.toLowerCase(),r.parentItemUuid,0].join("/")):(n.treeTitle=n.treeTitle+" : "+r.containerTitle,n.path=[r.containerMediaType.toLowerCase(),r.parentItemUuid,0,n.path].join("/")))),s=e.distanceFrom}),n&&(n.path=w(n.path),t.push(n)),e.fromDetailsTrees=t,e.fromDetailsForSearch=e.$getValidFromDetails()},A.prototype.$getThumbnailUrl=function(e,t){var n=this;if(n.isOpenEdItem())return n.thumbnailUrls.length?n.thumbnailUrls[0]:void 0;if((n.thumbnailLocation||!n.root)&&(n.thumbnailUrls||n.root)){var r,i="",o="",l="",c="",u="",d="",g="",p="",f="",h="@2x",v="",S=".png";return m.isHDDisplay&&(f="@2x"),n.root?(r=0===n.thumbnailLocation.search(/^http(s)?|\//),r||(n.thumbnailLocation=s.SHARED_THUMBNAILS+"/"+n.thumbnailLocation),i=a("removeExtension")(n.thumbnailLocation),p="HOME"===e?t?"_homelarge":"_homesmall":"PROGRAM_SUBNAV"===e?"_dropdown":"_course",v=a("getExtension")(n.thumbnailLocation,S),i+p+f+v):n.isGroupedContent&&"PROGRAM"===e?(r=angular.isDefined(n.programThumbnailLocation)&&0===n.programThumbnailLocation.search(/^http(s)?|\//),r||(n.programThumbnailLocation=s.SHARED_THUMBNAILS+"/"+n.programThumbnailLocation),i=a("removeExtension")(n.programThumbnailLocation),p="HOME"===e?t?"_homelarge":"_homesmall":"PROGRAM_SUBNAV"===e?"_dropdown":"_course",v=a("getExtension")(n.programThumbnailLocation,S),i+p+f+v):("TIER"===e&&t&&(p="_grid"),o=a("getFileName")(n.thumbnailUrls[0]),v=a("getExtension")(n.thumbnailUrls[0],S),c=o+p+f+v,u=o+p+h+v,d=o+p+v,l=_.find(n.thumbnailUrls,function(e){return e.search(c)>-1}),l||(g=m.isHDDisplay?d:u,l=_.find(n.thumbnailUrls,function(e){return e.search(g)>-1})),l)}},A.prototype.$propagateAssociativeProps=function(e){var t=this,s=r.defer();return n.openedItem&&n.openedItem.id===t.id?(t.associativeProps=n.openedItem.associativeProps,s.resolve()):e.id&&e.version?A.get({contentId:e.id,version:e.version,levels:1},!0).then(function(e){var n=$.Enumerable.From(e.contentItems).Where("$.id == '"+t.id+"'").FirstOrDefault(null);t.associativeProps=n?n.associativeProps:null,s.resolve()}):s.resolve(),s.promise},A.prototype.$isScoOrTest=function(){return"SCO"===this.fileType||"TEST"===this.fileType||this.fileType===o.FILE_TYPE.TIN_CAN_SCO},A.prototype.$isScorable=function(){return this.$isScoOrTest()},A.prototype.$isReviewerContainer=function(){return this.externalSource?"STANDARD"===this.externalSource.toUpperCase():!1},A.prototype.$isLesson=function(){return this.mediaType===p.LESSON},A.prototype.isPlaylist=function(){return this.mediaType===p.PLAYLIST},A.prototype.isTier=function(){return this.mediaType===p.TIER},A.prototype.isRRS=function(){return this.mediaType===p.REALIZE_READER_SELECTION},A.prototype.$hasCustomizedLesson=function(){return this.$isLesson()&&this.contribSource===f.PEARSON&&this.customizedItemDefaultView},A.prototype.$isTest=function(){return"Test"===this.mediaType},A.prototype.$hasCustomizedTest=function(){return!!(this.$isTest()&&this.customizedItem&&this.hasCustomizedVersion)},A.prototype.$isCustomizedTest=function(){return!(!this.$isTest()||!this.isCustomizedVersion&&!this.originalItemId)},A.prototype.$isStudentVoice=function(){return"Student Voice"===this.mediaType},A.prototype.$isTestNavTest=function(){return this.$isTest()&&"testnav"===this.playerTarget},A.prototype.$isNativeTest=function(){return this.$isTest()&&("realize"===this.playerTarget||""===this.playerTarget)},A.prototype.isDiscussionPrompt=function(){return this.mediaType===p.DISCUSSION_PROMPT},A.prototype.$getAssignedStatus=function(){var t=s.REST+"/items/"+this.id+"/assignmentStatus",n=e.get(t).then(function(e){return e.data.replace(/"/g,"")},function(e){return r.reject("error getting item assigned status",e)});return n},A.prototype.$isAssigned=function(){var e=this.$getAssignedStatus().then(function(e){return"ASSIGNED"===e});return e},A.prototype.$isCenterProgram=function(){var e=this;return!(!e.root||!e.centersProperties||null===e.centersProperties.itemUuid)},A.prototype.$isGooruItem=function(){return!!this.gooruOid||I(o.FILE_TYPE.GOORU,this)},A.prototype.isOpenEdItem=function(){return I(o.FILE_TYPE.OPEN_ED,this)},A.prototype.getExternalResourceDefaultImage=function(){return I(o.FILE_TYPE.OPEN_ED,this)?"/opened_thumbnail_default.png":I(o.FILE_TYPE.GOORU,this)?"/gooru_icon.png":void 0},A.prototype.$getLessonItems=function(){var e=this,t=[];return angular.forEach(e.contentItems,function(e){"Learning Model"!==e.mediaType?t.push(e):angular.forEach(e.contentItems,function(e){e.fromLearningModel=!0,t.push(e)})}),t},A.prototype.getRRSActivities=function(){var e=[];return this.getItemContainer(p.ACTIVITY_SUPPORT).then(function(t){var n=t.data;return n&&n.contentItems&&n.contentItems.length>0&&(e=n.contentItems),e},function(e){return t.error("Failed to get activity support container:",e),e})},A.prototype.getItemContainer=function(t){var n=[s.REST,"items",this.id,"container"].join("/");return e.get(n,{params:{mediaType:t}})},A.prototype.isLtiItem=function(){return"Partner Link"===this.mediaType},A.getLtiLaunchInfo=function(t,n,r){var a=[s.REST,"externaltool","content",t,n].join("/");return e.get(a,{params:r}).then(function(e){return e.data.settings.openNewWindow=JSON.parse(e.data.settings.openNewWindow),e.data})};var L=function(){return S.getAttribute("rumba.ssourldetails")};return A.prototype.getClassroomShareUrl=function(){var e,t=r.defer(),n=this.$getDefaultVersion(),s=h.absUrl().split("?"),a=s[0],i=s.length>1?s[1]:"",o=n.$isLesson()?"lesson":"content",l=[a,o,n.id,n.version].join("/"),c=function(e){var t=e.rumbaLoginUrl+"?service="+l;return e.idpDataUrl&&(t=t+"&idpmetadata="+e.idpDataUrl),e.EBTenant&&(t=t+"&EBTenant="+e.EBTenant),i&&(t+="&"+i),t};return L()?(e=S.getAttribute("rumba.ssourldetails"),t.resolve(c(e))):v.getSSOUrlDetails().then(function(e){if(e){var n={rumbaLoginUrl:e.rumbaLoginUrl,idpDataUrl:e.idpDataUrl};return e.EBTenant&&angular.extend(n,{EBTenant:e.EBTenant}),S.setAttribute("rumba.ssourldetails",n,!1),t.resolve(c(e))}},function(e){t.reject(e)}),t.promise},A.prototype.requiresGoogleHeadsupAlert=function(){return this.fileType===o.FILE_TYPE.SEQUENCE&&this.$isLesson()},A.prototype.isLesson=A.prototype.$isLesson,A.prototype.isScorable=A.prototype.$isScorable,A.prototype.getTitle=A.prototype.$getTitle,A.prototype.getLessonItems=A.prototype.$getLessonItems,A.prototype.hasInfo=A.prototype.$hasInfo,A.prototype.isCustomizedTest=A.prototype.$isCustomizedTest,A.prototype.isModeratingNonCustomizedItem=function(){var e=this;return"SUBMITTED"!==e.status||e.$isCustomizedTest()||e.$hasCustomizedLesson()||e.contribSource===f.MY_UPLOADS||"OpenEd"===e.contribSource||"NBC Learn"===e.contribSource?"":"isModeratingNonCustomizedItem"},A}]),angular.module("Realize.content.model.openEdItem",["Realize.paths","Realize.common.keyStore","Realize.assignment.constants"]).factory("OpenEdItem",["$log","$http","$q","PATH","KeyStore","ASSIGNMENT_CONSTANTS",function(e,t,n,r,s,a){"use strict";function i(e){var t=_.find(d,function(t){return t.value===e});return t.displayName}function o(e){return-1===e.indexOf("https")?e.replace(/^http:\/\//i,"https://"):e}function l(e){e.id=String(e.id),angular.extend(this,e),this.$setMediaType(),this.$getThumbnailUrl(),this.text=this.description,this.tags=void 0,this.externalItemId=this.id,this.version=1,this.attachments=[!0],this.fileType=u}var c,u=a.FILE_TYPE.OPENED,d=[{value:"video",count:null,displayName:"Video"},{value:"game",count:null,displayName:"Game"},{value:"assessment",count:null,displayName:"Assessment/Worksheet"},{value:"lesson_plan",count:null,displayName:"Lesson Plan"},{value:"homework",count:null,displayName:"Homework"},{value:"audio",count:null,displayName:"Audio"},{value:"question",count:null,displayName:"Question"},{value:"other",count:null,displayName:"Other"}],m=l,g=r.REST;m.prototype.$hasCustomizedTest=angular.noop,m.prototype.$isCustomizedTest=angular.noop,m.prototype.$hasCustomizedLesson=angular.noop,m.prototype.$isLesson=angular.noop,m.prototype.$hasRemediation=angular.noop,m.prototype.$isTest=angular.noop,m.prototype.isDiscussionPrompt=angular.noop,m.prototype.isTier=angular.noop,m.prototype.isPlaylist=angular.noop,m.prototype.$hasInfo=function(){return $.trim(this.description).length>0},m.prototype.$setMediaType=function(){var e="Other";switch(this.resource_type&&(e=this.resource_type),e.toLowerCase()){case"video":case"audio":case"game":e="Document";break;case"assessment":case"question":case"lesson_plan":case"homework":e="Activity";break;default:e="Activity"}this.mediaType=e},m.prototype.$getThumbnailUrl=function(){var e="";return this.thumbnails&&this.thumbnails.large&&(e=o(this.thumbnails.large)),this.thumbnailLocation=e,this.thumbnailUrls=[e],this.thumbnailUrls[0]},m.prototype.getExternalResourceDefaultImage=function(){return"/opened_thumbnail_default.png"},m.prototype.$getSource=function(){return this.publisher},m.prototype.$getTitle=function(){return this.title},m.prototype.$getPlayerUrl=function(){var e=n.defer(),t=this;return t.url=o(t.student_url),e.resolve(t.url),e.promise},m.prototype.$getDefaultVersion=function(){return this},m.getDefaultItemVersion=function(e){return e},m.prototype.$getEquellaItemId=function(){return this.originalEquellaItemId||this.id},m.prototype.isOpenEdItem=function(){return!0},m.getSearchUrl=function(){var e=n.defer();return m.searchUrl?e.resolve(m.searchUrl):t.get(g+"/opened/searchUrl").then(function(t){var n=t.data;m.searchUrl=n,e.resolve(m.searchUrl)}),e.promise},m.filterData=new s,m.updateMultiValueFacets=function(e){if(e.MEDIA_TYPE){var t=e.MEDIA_TYPE[0].toLowerCase();e.resource_type=t,c=[{fieldName:"MEDIA_TYPE",values:[{value:t,count:null,displayName:i(t)}],noLimit:!0}]}else c=void 0},m.getSessionToken=function(r){var s=n.defer();return angular.isUndefined(r)&&(r=!0),r&&m.liveSessionToken?s.resolve(m.liveSessionToken):t.get(g+"/opened/token").then(function(e){var t=e.data;m.liveSessionToken=t.access_token,s.resolve(m.liveSessionToken)},function(t){e.error("Fail to retrieve session token",t),s.resolve("")}),s.promise};var p=function(e){var t=10,n={resource_type:null,limit:t,offset:0};return e.keywords&&(n.descriptive=e.keywords),e.page&&(n.offset=(e.page-1)*t),e.contentId&&(n.query=e.contentId),angular.forEach(n,function(t,r){angular.isDefined(e[r])&&(n[r]=e[r])}),n};m.getFacets=function(){return[{fieldName:"MEDIA_TYPE",values:angular.copy(d),noLimit:!0}]},m.cache={},m.convertSearchResult=function(e){var t,n=1e3;e.facets=c||m.getFacets(),t=e.meta.pagination.total_entries,e.totalMatches=Math.min(t,n),e.results=(e.resources||[]).map(function(e){return m.cache[e.id]=new l(e),m.cache[e.id]}),delete e.resources,delete e.meta,delete e.standards},m.query=function(r){r=p(r);var s=n.defer();return m.getSearchUrl().then(function(n){m.getSessionToken().then(function(a){t.get(n,{params:r,headers:{Authorization:"Bearer "+a}}).success(function(e){m.convertSearchResult(e),s.resolve(e)}).error(function(t,n){e.error("OpenEd Search failed",t,n),s.reject(t)})})}),s.promise};var f=function(n,r,s,a){var i,o=function(){m.cache[s.query]?(i=m.cache[s.query],delete i.attachments,i.itemNotFound=!0,a.resolve(i)):a.resolve({$getTitle:function(){return"OpenEd"},itemNotFound:!0})};t.get(n,{headers:r}).success(function(e){e.resource?(i=new l(e.resource),i.$getPlayerUrl().then(function(){a.resolve(i)})):o()}).error(function(t,n){e.error("Get OpenEd item failed",t,n),o()})};return m.get=function(e){var t,r=n.defer();return angular.isDefined(e.useCachedSession)&&(t=!!e.useCachedSession),e=p(e),m.getSearchUrl().then(function(n){n=n+"/"+e.query,m.getSessionToken(t).then(function(t){var s={Authorization:"Bearer "+t};f(n,s,e,r)})}),r.promise},m.getPromise=function(e){var t=m.get({contentId:e});return t.then(function(e){return e})},m.prototype.isExternalResource=function(){return!0},m.retrieveItemsInList=function(e,t,r,s){angular.isUndefined(t)&&(t=function(e){return e.fileType===u}),angular.isUndefined(r)&&(r=function(e){return e.externalId}),angular.isUndefined(s)&&(s=function(e,t){var n=_.findWhere(e,{externalId:t.id});n.originalEquellaItemId=n.id,_.extend(n,new l(t))});var a=n.defer(),i=_.filter(e,t),o=[];return i.length?m.getSessionToken().then(function(){m.getSearchUrl().then(function(){angular.forEach(i,function(e){o.push(m.get({contentId:r(e),useCachedSession:!0}))}),n.all(o).then(function(t){angular.forEach(t,function(t){s(e,t)}),a.resolve(e)})})}):a.resolve(e),a.promise},m}]),angular.module("Realize.content.model.gooruItem",["Realize.paths","Realize.common.keyStore"]).factory("GooruItem",["$log","$http","$q","PATH","KeyStore",function(e,t,n,r,s){"use strict";function a(e){angular.extend(this,e),this.$setMediaType(),this.$getThumbnailUrl(),this.text=this.description,this.tags=void 0,this.id=this.gooruOid,this.version=1,this.attachments=[!0],this.fileType="GOORU"}var i,o=a,l=r.REST;o.prototype.$hasCustomizedTest=angular.noop,o.prototype.$isCustomizedTest=angular.noop,o.prototype.$hasCustomizedLesson=angular.noop,o.prototype.$isLesson=angular.noop,o.prototype.$hasRemediation=angular.noop,o.prototype.$isTest=angular.noop,o.prototype.isDiscussionPrompt=angular.noop,o.prototype.isTier=angular.noop,o.prototype.isPlaylist=angular.noop,o.prototype.$hasInfo=function(){return $.trim(this.description).length>0},o.prototype.$setMediaType=function(){var e="Link";switch(this.category?e=this.category:this.mediaType&&this.mediaType.length&&(e=this.mediaType[0]),e.toLowerCase()){case"slide":e="Document";break;case"textbook":e="eText";break;case"exam":case"handout":case"interactive":case"challenge":e="Activity";break;case"website":e="Link";break;default:e="Activity"}this.mediaType=e},o.prototype.$getThumbnailUrl=function(){if(this.thumbnails)this.thumbnailLocation=this.thumbnails.url,this.thumbnailUrls=[this.thumbnails.url];else{var e=[this.assetURI,this.folder,this.gooruOid].join("");this.thumbnailLocation=e,this.thumbnailUrls=[e]}return this.thumbnailUrls[0]},o.prototype.$getSource=function(){return this.resourceSource.sourceName||this.resourceSource.domainName},o.prototype.$getTitle=function(){return this.title},o.prototype.$getPlayerUrl=function(){var e=n.defer(),r=this;return r.playerUrl?e.resolve(r.playerUrl):t.get(l+"/gooruSearch/previewUrl/"+this.gooruOid).then(function(t){r.playerUrl=t.data,e.resolve(r.playerUrl)}),e.promise},o.prototype.$getDefaultVersion=function(){return this},o.getDefaultItemVersion=function(e){return e},o.prototype.$getEquellaItemId=function(){return this.originalEquellaItemId||this.id},o.prototype.$isGooruItem=function(){return!0},o.getSearchUrl=function(){var e=n.defer();return o.searchUrl?e.resolve(o.searchUrl):t.get(l+"/gooruSearch/searchUrl").then(function(t){var n=t.data;o.searchUrl=n.replace("/gooru-search/","/gooruapi/"),e.resolve(o.searchUrl)}),e.promise},o.filterData=new s,o.updateMultiValueFacets=function(e){e.MEDIA_TYPE?(e.category=e.MEDIA_TYPE[0].toLowerCase(),i=[{fieldName:"MEDIA_TYPE",values:[{value:e.MEDIA_TYPE[0],count:null}],noLimit:!0}]):i=void 0},o.getSessionToken=function(r){var s=n.defer();return angular.isUndefined(r)&&(r=!0),r&&o.liveSessionToken?s.resolve(o.liveSessionToken):t.get(l+"/gooruSearch/sessionToken").then(function(e){o.liveSessionToken=e.data.token,s.resolve(o.liveSessionToken)},function(t){e.error("Fail to retrieve session token",t),s.resolve("")}),s.promise};var c=function(e){var t={query:null,queryType:"single",category:null,pageNum:1,pageSize:10,sessionToken:null,excludeAttributes:!1,format:"json",callback:"JSON_CALLBACK"};return e.keywords&&(t.query=e.keywords),e.page&&(t.pageNum=e.page),e.contentId&&(t.query=e.contentId),angular.forEach(t,function(n,r){angular.isDefined(e[r])&&(t[r]=e[r])}),t};o.getFacets=function(){return[{fieldName:"MEDIA_TYPE",values:[{value:"Exam",count:null},{value:"Handout",count:null},{value:"Interactive",count:null},{value:"Lesson",count:null},{value:"Slide",count:null},{value:"Textbook",count:null},{value:"Video",count:null},{value:"Website",count:null}],noLimit:!0}]},o.cache={},o.convertSearchResult=function(e){e.facets=i||o.getFacets(),e.totalMatches=e.totalHitCount,e.results=(e.searchResults||[]).map(function(e){return o.cache[e.id]=new a(e),o.cache[e.id]}),delete e.executionTime,delete e.searchInfo,delete e.searchResults,delete e.searchType,delete e.totalHitCount,delete e.userInput},o.query=function(r){r=c(r);var s=n.defer();return o.getSearchUrl().then(function(n){o.getSessionToken().then(function(a){r.sessionToken=a,t.jsonp(n,{params:r}).success(function(e){o.convertSearchResult(e),s.resolve(e)}).error(function(t,n){e.error("Gooru Search failed",t,n),s.reject(t)})})}),s.promise};var u=function(n,r,s){var i,l=function(){o.cache[r.query]?(i=o.cache[r.query],delete i.attachments,i.itemNotFound=!0,s.resolve(i)):s.resolve({$getTitle:function(){return"Gooru"},itemNotFound:!0})};t.jsonp(n,{params:r}).success(function(e){e.resource?(i=new a(e.resource),i.$getPlayerUrl().then(function(){s.resolve(i)})):l()}).error(function(t,n){e.error("Get Gooru item failed",t,n),l()})};return o.get=function(e){var t,r=n.defer();return angular.isDefined(e.useCachedGooruSession)&&(t=!!e.useCachedGooruSession),e=c(e),o.getSearchUrl().then(function(n){n=n.replace("/search/resource","/v2/resource/"),n+=e.query,o.getSessionToken(t).then(function(t){var s={sessionToken:t,callback:e.callback};u(n,s,r)})}),r.promise},o.getPromise=function(e){var t=o.get({contentId:e});return t.then(function(e){return e})},o.retrieveItemsInList=function(e,t,r,s){angular.isUndefined(t)&&(t=function(e){return"GOORU"===e.fileType}),angular.isUndefined(r)&&(r=function(e){return e.externalId}),angular.isUndefined(s)&&(s=function(e,t){var n=_.findWhere(e,{externalId:t.gooruOid});n.originalEquellaItemId=n.id,_.extend(n,new a(t))});var i=n.defer(),l=_.filter(e,t),c=[];return l.length?(angular.forEach(l,function(e){c.push(o.get({contentId:r(e),useCachedGooruSession:!0}))}),n.all(c).then(function(t){angular.forEach(t,function(t){s(e,t)}),i.resolve(e)})):i.resolve(e),i.promise},o}]),angular.module("Realize.content.model.questionBank",["Realize.content.model.questionBankItem"]).factory("QuestionBank",["QuestionBankItem",function(e){"use strict";var t=function(t){var n=this,r=[];angular.copy(t||{},n),n.selected=n.selected||!1,n.selectedCount=n.selectedCount||0,_.each(n.questions,function(t){r.push(new e(t,n.questionBankId))}),n.questions=r,Object.defineProperties(n,{questionCount:{get:function(){return n.questions.length
}},isEmptyChildList:{get:function(){return 0===this.questionCount}},selectedAllQuestions:{get:function(){return this.questionCount===this.selectedQuestionCount}},selectedQuestion:{get:function(){return _.filter(n.questions,function(e){return e.selected})}},selectedQuestionCount:{get:function(){return this.selectedQuestion.length}},selectedSummary:{get:function(){return{questionBankId:this.questionBankId,questionIds:_.pluck(this.selectedQuestion,"id"),allQuestions:this.selectedAllQuestions}}}})};return t}]),angular.module("Realize.content.model.questionBankItem",[]).factory("QuestionBankItem",[function(){"use strict";var e=function(e,t){var n=this;angular.copy(e||{},n),n.selected=n.selected||!1,t&&(n.parentBankId=t)};return e}]),angular.module("Realize.Discussions.Token",["Realize.Discussions.TokenSvc"]),angular.module("Realize.Discussions.TokenSvc",["Realize.common.tokenInterceptor","Realize.user.currentUser"]).service("DiscussTokenSvc",["$http","$route","$q","$log","CommonTokenInterceptor","$currentUser","REST_PATH",function(e,t,n,r,s,a,i){"use strict";var o=this,l="Authorization",c={},u=function(e){return c[e]},d=function(){return t.current.params.classId},m=function(){return t.current.params.assignmentId},g=function(){var e,t=d(),n=m();return e=a.isTeacher?i+"/discussions/tokens/classes/"+t:i+"/discussions/tokens/classes/"+t+"/assignments/"+n},p=function(e){var t;return _.each(c,function(n,r){n===e&&(t=r)}),t},f=function(e,t){return c[e]=t.headers(l),r.log("Updated Token: ",e),c[e]};return o.shouldIntercept=function(e){return e.url.indexOf(window.discussionApiUrl)>-1&&!e.service},o.createToken=function(t){return e.post(t)},o.getToken=function(){var e=g();return u(e)?(r.log("Same Token: ","Path "+e),n.when(c[e])):o.createToken(e).then(function(t){return f(e,t)})},o.updateToken=function(t){var n=p(t),r={};return delete c[n],r[l]=t,e.put(n,{},r).then(function(e){return f(n,e)})},o.recoverToken=function(e){return o.updateToken(e.headers[l]).then(function(t){return s.updateHeaderAndReturn(t,e)})},o}]),angular.module("Realize.Discussions.Create",["Discuss.CreateView","Realize.common.alerts"]).controller("DiscussCreateCtrl",["$scope","$routeParams","$log","InlineAlertService","Messages","$location","DiscussNavigation","$filter","Analytics","$timeout","$window","BrowserInfo","lwcI18nFilter",function(e,t,n,r,s,a,i,o,l,c,u,d,m){"use strict";var g=this;e.boardId=a.search().boardId,e.classId=t.classId,e.isSaveErrorMessageVisible=!1,e.isLoading=!1,d.OS.isIOS&&c(function(){u.scrollTo(0,240)},1e3),e.$on("discussion.create-view.saveButtonClicked",function(){e.createPostForm&&e.createPostForm.$valid&&e.savePressed&&(e.isLoading=!0)}),e.$on("discussion.create-view.saveSuccessful",function(t,n){var s={type:"success",msg:[m(e.sanitizeCode("discussion.list.successNotification.title")),m(e.sanitizeCode("discussion.list.successNotification.message"))].join(" ")};l.track("track.action",{category:"Classes",action:"Discuss",label:"Start"}),r.addAlert(n.id,s),i.goToList(n.boardId),e.isLoading=!1}),e.$on("discussion.create-view.saveFailed",function(t,r){e.isLoading=!1,e.isSaveErrorMessageVisible=!0,n.error("Error saving!",r)}),g.back=function(){n.log("GO BACK"),"zeroPost"===a.search().state?i.back():i.goToList(e.boardId)},e.$on("discussion.create-view.goBack",g.back),e.$on("discussion.create-view.cancelButtonClicked",g.back)}]),angular.module("Realize.Discussions.CustomPostSummary",["Discuss.PostSummary"]).config(["$provide",function(e){"use strict";e.decorator("postSummaryDirective",["$delegate",function(e){var t,n,r=e[0];return t=r.templateUrl,n=r.link,delete r.templateUrl,r.template=function(){return['<div inline-notification-row-target=".post"','inline-notification="post.id"','inline-notification-target=".post-main"','ng-include="templateUrlOriginal"',"></div>"].join("")},r.compile=function(){var e=function(e){e.templateUrlOriginal=t,angular.isDefined(n)&&n.apply(this,arguments)};return e},e}])}]),angular.module("Realize.Discussions.List",["Discuss.ListView","Realize.Discussions.CustomPostSummary"]).controller("DiscussListCtrl",["$rootScope","$scope","$routeParams","$location","$log","DiscussNavigation","Analytics",function(e,t,n,r,s,a,i){"use strict";t.classId=n.classId,t.boardId=r.search().boardId,t.zeroStateForStudent=!1,t.isLoading=!0,t.$on("discussion.list-view.zeroState",function(){t.isLoading=!1,e.currentUser.isStudent?t.zeroStateForStudent=!0:(a.goToCreate(t.boardId),r.search("state","zeroPost"))}),t.$on("discussion.list-view.notFound",function(){t.isLoading=!1,e.currentUser.isStudent?t.zeroStateForStudent=!0:a.goToCreate(t.boardId)}),t.$on("discussion.list-view.postClick",function(e,n){i.track("track.action",{category:"Classes",action:"Discuss",label:"Open "+n.title}),a.goToPost(t.boardId,n.id)}),t.$on("discussion.list-view.createClick",function(){a.goToCreate(t.boardId)}),t.$on("discussion.list-view.goBack",function(){a.back()}),t.$on("discussion.list-view.success",function(){t.isLoading=!1}),t.$on("discussion.create-view.saveSuccessful",function(){t.isLoading=!0})}]),angular.module("Realize.Discussions.Thread",["components.alert","Discuss.ThreadView","Realize.common.alerts","Realize.paths","Realize.analytics","ModalServices","Realize.discuss.constants","Realize.reporting.data.TrackingService","Realize.constants.fileValidatorType","rlzComponents.components.services.oneDrive","rlzComponents.components.uploadContent.constants","Realize.Discussions.ThreadUtilsSvc"]).constant("AVATAR_PATH",window.mediaPath+"/skins/default/images/profile_icons/").controller("DiscussThreadCtrl",["$scope","$log","$routeParams","DiscussNavigation","InlineAlertService","Messages","$filter","Analytics","$currentUser","TrackingService","$window","Modal","PATH","FILE_VALIDATOR_TYPE","lwcI18nFilter","BrowserInfo","FILE_UPLOAD_ERROR_RESPONSE","attachmentModalUtilService","DISCUSS_CONSTANTS","oneDriveService","Toast","UPLOAD_CONTENT_CONSTANTS","threadUtilsSvc",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E){"use strict";function y(e){var t=e?"stops":"starts";c.trackContent(n.classId||"na",n.itemId,n.itemVersion,n.assignmentId||"na",t,{userAssignmentId:n.userAssignmentId})}var R,C,D=i("rlzLocalize"),b="Authored",P={},w={},L=e.isDiscussAssignmentReviewMode?"review":"normal",O=function(e,t,n){o.track("track.action",{category:e,action:t,label:n})},N=900,M=function(){C=d.progressDialog(e.$new(!0),{progressHeader:p("myContent.uploadProgress.title"),progressMessage:p("myContent.uploadProgress.message")}).then(function(){C.fakeProgress(500)})},k=function(t){t||(e.uploadInProgress=t),C&&t?C.then(function(){return C.progressComplete()}).then(function(){d.hideDialog()}):C&&!t&&(d.hideDialog(),C.$destroy())},z=function(e,t){var n,r=e.data,s=document.createElement("a");if(s.style.display="none",s.href=r,s.download=t.name,document.createEvent){var a="click",i=!0,o=!0,l=window,c=0,u=0,d=0,m=0,g=0,p=!1,f=!1,h=!1,v=!1,S=0,T=null;n=document.createEvent("MouseEvent"),n.initMouseEvent(a,i,o,l,c,u,d,m,g,p,f,h,v,S,T)}else n=new MouseEvent("click");document.body.appendChild(s),s.dispatchEvent(n),document.body.removeChild(s)},U=function(t,n,r){e.$broadcast("attach.file.success",{id:t,name:n,type:r}),e.showAttachSaveReplySuccessful=!0},F="",x=function(e,r){O(S.ANALYTICS.DISCUSS,S.ANALYTICS.POST_COMMENT,r),M(),v.saveLinkAttachment(n.classId,n.assignmentId,e.url).then(function(t){F=r,k(!0),U(t,e.name,S.TYPE_LINK)},function(e){t.error("attachDriveLink:",e),k(!1)})},B={showCloseIcon:!0,autoClose:!1,msg:p("myContent.contentUploadForm.oneDrive.oneDriveErrorMessage")},V={showCloseIcon:!0,autoClose:!1,msg:p("myContent.contentUploadForm.oneDrive.genericError")};if("Authored"===b&&(P={isEditCommentEnabled:!1}),t.info("threadPageMode = ",L),e.configs={},"review"===L&&(w.isRemoveCommentEnabled=l.isTeacher,e.configs.replyConfigs=w),e.configs.mode=L,e.configs.attachmentsEnabled=!0,e.configs.promptConfig=P,e.configs.isHideCommentToggle=!0,e.boardId=n.boardId,e.postId=n.postId,e.isDiscussionLandingPage=n.isDiscussionLandingPage,e.isLoading=!0,e.participantsNumber=0,e.isTracking=!1,e.isVisible=!0,l.isStudent)e.selectedStudent=l;else{var H=_.findWhere(e.currentRoster.students,{userId:n.studentId});e.selectedStudent=e.currentRoster.students&&(n.studentId&&H||e.currentRoster.students[0])}e.isShowCommentToggle=!1,e.$on("discussion.editComment.updateSuccessful",function(){O(S.ANALYTICS.CLASSES,S.ANALYTICS.DISCUSS,S.ANALYTICS.EDIT_COMMENT)}),e.$on("discussion.postDetail.removeSuccessful",function(){O(S.ANALYTICS.CLASSES,S.ANALYTICS.DISCUSS,S.ANALYTICS.REMOVE_COMMENT)}),e.$on("discussion.postDetail.hideSuccessful",function(){O(S.ANALYTICS.CLASSES,S.ANALYTICS.DISCUSS,S.ANALYTICS.HIDE_COMMENT)}),e.$on("discussion.thread-view.goBack",function(){r.back()}),e.scrollToBottom=function(){return $("html, body").animate({scrollTop:$(document).height()},"slow"),!1},e.$on("discussion.thread-view.postReplySuccessful",function(t,n){e.isDiscussionLandingPage?O(S.ANALYTICS.ASSIGNMENT,S.ANALYTICS.POST_DISCUSSION_COMMENT):O(S.ANALYTICS.CLASSES,S.ANALYTICS.DISCUSS,S.ANALYTICS.POST_COMMENT),"top"===n.replyPosition&&e.numOfComments>=1&&(e.showTopPageSaveReplySuccessful=!0),(n.post.meta.attachment.type===S.TYPE_LINK||n.post.meta.attachment.type===S.TYPE_ONEDRIVE)&&(E.sendTelemetryDataFromDiscussionPost(F,n.post.meta.attachment.name,S.EVENT_TYPE.POST_MY_COMMENT,S.ANALYTICS.POST_COMMENT),F=""),e.postSuccessAlertTargetId=n.post.id;var r={type:"success",msg:[D(e.sanitizeCode("discussion.thread.saveReply.inline.successNotification.title")),D(e.sanitizeCode("discussion.thread.saveReply.inline.successNotification.message"))].join(" ")};s.addAlert(e.postSuccessAlertTargetId,r)}),e.$on("discussion.thread-view.updateSuccessful",function(t,n){!F||n.meta.attachment.type!==S.TYPE_LINK&&n.meta.attachment.type!==S.TYPE_ONEDRIVE||(E.sendTelemetryDataFromDiscussionPost(F,n.meta.attachment.name,S.EVENT_TYPE.UPDATE_MY_COMMENT,S.EVENT_TYPE.UPDATE_COMMENT),F=""),e.postSuccessAlertTargetId=n.id;var r={type:"success",msg:[D(e.sanitizeCode("discussion.thread.editComment.inline.successNotification.title")),D(e.sanitizeCode("discussion.thread.editComment.inline.successNotification.message"))].join(" ")};s.addAlert(e.postSuccessAlertTargetId,r)}),e.$on("discussion.thread-view.getPostCall.success.emit",function(t,n){e.configs.attachmentsEnabled&&(e.postsWithAttachment=[],_.each(n.posts,function(t){t.meta&&t.meta.attachment&&t.meta.attachment.id&&(e.postsWithAttachment[t.id]={id:t.meta.attachment.id,name:t.meta.attachment.name,type:t.meta.attachment.type||S.TYPE_FILE})}),e.$broadcast("discussion.thread-view.postAttachmentsLoaded",e.postsWithAttachment)),e.numOfComments=n.postCount,e.isLoading=!1}),e.$on("discussion.comment.updatePost",function(t,n){n.meta=n.meta||{},n.meta.attachment=_.extend({},n.attachment),delete n.attachment,e.$broadcast("discussion.comment.postUpdated",n)}),e.$on("discussion.thread-view.postReplyFailed",function(){e.showSaveReplyError=!0}),e.viewAssignment=function(){e.isTracking&&(y(e.isTracking),e.isTracking=!1),n.status&&l.isTeacher?r.goToStudentAssignmentList(n.classId,n.studentId,n.status,n.activeTab):r.goToStudentStatusView(n.classId,n.assignmentId)},e.highlightStudentComments=function(t){e.selectedStudent.userId!==t.userId&&O(S.ANALYTICS.CLASSES,S.ANALYTICS.ASSIGNMENTS,S.ANALYTICS.REVIEW_DISCUSSION),e.selectedStudent=t,e.$broadcast("discussion.thread-view.highlightParticipantComments",t.userId),e.$broadcast("discussion.thread-view.highlightParticipantComments.post",t.userId),N=300},e.showFilter=function(){return e.isLoading?!1:(e.$broadcast("discussion.thread-view.highlightParticipantComments",e.selectedStudent.userId,e.participantId),l.isTeacher)},e.$watch("selectedStudent.userId",function(){setTimeout(function(){var e=angular.element(".selected-post .post-author");e&&e.length>0&&(e.attr("tabindex",0),e[0].focus())},N)}),e.$on("discussion.thread-view.highlightParticipantComments.success",function(t,n){var r=e.selectedStudent.userId;e.participantsNumber=n,0===n.length&&(r=!1),e.$broadcast("discussion.thread-view.highlightParticipantComments.post",r)}),u.onbeforeunload=function(){e.$apply(y(!0))},e.$on("$destroy",function(){u.onbeforeunload=null,e.isTracking&&(y(e.isTracking),e.isTracking=!1),R&&R.$destroy(),A.close()}),y(e.isTracking),e.isTracking=!0,e.showVisibleComments=function(){e.isVisible=!0,e.$broadcast("discussion.discussHeader.showVisibleComments")},e.showHiddenComments=function(){e.isVisible=!1,e.$broadcast("discussion.discussHeader.showHiddenComments")},e.$on("discussion.thread-view.showCommentToggle",function(t,n){n&&!e.isShowCommentToggle&&(e.isVisible=!0),e.isShowCommentToggle=n}),e.$on("discussion.postDetail.showHiddenComments",function(){e.showHiddenComments()}),e.currentCommentText=f.isMobileDevice?p("discuss.comment.deviceTextVisible"):p("discuss.comment.visible"),e.hiddenCommentText=f.isMobileDevice?p("discuss.comment.deviceTextHidden"):p("discuss.comment.hidden"),e.configs.attachConfigs={fileTypeArray:[g.FILE_TYPE_VALIDATOR.DOC_TYPE,g.FILE_TYPE_VALIDATOR.DOCX_TYPE,g.FILE_TYPE_VALIDATOR.PPT_TYPE,g.FILE_TYPE_VALIDATOR.PPTX_TYPE,g.FILE_TYPE_VALIDATOR.JPG_TYPE,g.FILE_TYPE_VALIDATOR.PNG_TYPE,g.FILE_TYPE_VALIDATOR.MP3_TYPE,g.FILE_TYPE_VALIDATOR.MP4_TYPE,g.FILE_TYPE_VALIDATOR.PDF_TYPE],maxFileSizeBytes:g.FILE_SIZE_VALIDATOR.MAX_FILE_SIZE,minFileSizeBytes:g.FILE_SIZE_VALIDATOR.MIN_FILE_SIZE},e.$on("fileupload.validate.file",function(t,n,r,s){e.disabledAttachButton=!0,e.isVirusFree=e.selectedFile!==s||e.isVirusFree,e.selectedFile=s,e.isFileTypeValid=r,e.isFileMinSizeValid=n.minFileSizeValid,e.isFileMaxSizeValid=n.maxFileSizeValid,e.attachFileSelected=e.isFileMinSizeValid&&e.isFileMaxSizeValid&&e.isFileTypeValid?e.selectedFile.name:p("attachmentModal.action.noFileChosen"),e.isFileMinSizeValid&&e.isFileMaxSizeValid&&e.isFileTypeValid&&e.isVirusFree&&(e.disabledAttachButton=!1),e.$digest()}),e.$on("discussion.attach.file",function(){O(S.ANALYTICS.DISCUSS,S.ANALYTICS.POST_COMMENT,S.ANALYTICS.ATTACH_FILE),e.attachFileSelected=p("attachmentModal.action.noFileChosen"),R=e.$new(),e.disabledAttachButton=!0,e.isFileTypeValid=!0,e.isFileMinSizeValid=!0,e.isFileMaxSizeValid=!0,e.isVirusFree=!0,R.postTitle=e.post.title,R.uploadInProgress=!1,R.close=function(){d.hideDialog(),R.$destroy()},R.attachFile=function(t){t&&t.preventDefault(),e.disabledAttachButton=R.uploadInProgress=!0,v.saveAttachment(n.classId,n.assignmentId,e.selectedFile).then(function(t){e.selectedFile.id=t,R.uploadInProgress=!1,R.close(),U(t,e.selectedFile.name,S.TYPE_FILE)},function(t){t.data.trim()===h.AV_SCAN_RESPONSE_TEXT&&(R.uploadInProgress=!1,e.isVirusFree=!1,e.disabledAttachButton=!0)})},d.showDialog(m.TEMPLATE_ROOT+"/common/attachmentModal/attachmentModal.html",R)}),e.$on("discussion.attachment.file.download",function(e,t){var r=t,s=t.type===S.TYPE_FILE,a=s?0:u.open("","_blank"),i=s?S.ANALYTICS.DOWNLOAD_ATTACHED_FILE:S.ANALYTICS.DOWNLOAD_ATTACHED_GOOGLE_LINK;O(S.ANALYTICS.DISCUSS,S.ANALYTICS.DISCUSS_THREAD,i),v.downloadAttachment(n.classId,n.assignmentId,r.id,r.name,t.type).then(function(e){s?z(e,r):a.location=e.data})}),e.$on("discussion.attach.link",function(){angular.element(".googleFilePicker").trigger("click")}),e.onAttachDriveLink=function(e){e.length&&x(e[0],S.ANALYTICS.ATTACH_GOOGLE_DRIVE_LINK)},e.$on("discussion.attach.oneDrive",function(){e.launchOneDrivePicker()});var G=function(e){t.log("OneDrive launch success",e),e.message===I.ONE_DRIVE_ERROR_CODE&&A.error(B);var n=e.value[0].permissions[0].link.webUrl,r=e.value[0].name,s={url:n,name:r};x(s,S.ANALYTICS.ATTACH_ONE_DRIVE_LINK)},j=function(){t.error("OneDrive launch failed"),A.error(V),k(!1)},q=function(){t.info("OneDrive launch cancelled"),k(!1)};e.launchOneDrivePicker=function(){T.launchOneDriveFilePicker(G,q,j)}}]),angular.module("Realize.Discussions.ThreadUtilsSvc",["rlzComponents.components.telemetryService","Realize.discuss.constants"]).service("threadUtilsSvc",["telemetryService","baseTelemetryEvents","DISCUSS_CONSTANTS",function(e,t,n){"use strict";var r=function(e,t,r,a){var i={extensions:{area:n.ANALYTICS.CLASSES,page:n.ANALYTICS.DISCUSS,product:n.EVENT_TYPE.PROGRAM_NOT_AVAILABLE,description:s(e),value:t},definition:{name:r}};return i.extensions["sub-page"]=a,i},s=function(e){var t=n.EVENT_TYPE.ATTACHMENT.concat(": ");return t=e===n.ANALYTICS.ATTACH_GOOGLE_DRIVE_LINK?t.concat(n.EVENT_TYPE.GOOGLE_DRIVE_FILE):t.concat(n.EVENT_TYPE.ONE_DRIVE_FILE)};this.sendTelemetryDataFromDiscussionPost=function(s,a,i,o){var l=t.createEventData(n.EVENT_TYPE.ATTACH,r(s,a,i,o));e.sendTelemetryEvent(l)}}]),angular.module("Realize.Active.Discussion",["Realize.paths","rlzComponents.components.i18n","Realize.navigationService","Realize.analytics","Realize.Discussions.Navigation","Realize.Prompt.promptApiUtilService","Realize.prompt.constants","Realize.user.currentUser","Realize.assignment.facadeService"]).directive("activeDiscuss",["PATH","NavigationService","$location","DiscussNavigation","$routeParams","promptApiUtilService","PROMPT_CONSTANTS","$currentUser","AssignmentFacadeService",function(e,t,n,r,s,a,i,o,l){"use strict";return{templateUrl:e.TEMPLATE_CACHE+"/prompt/view-states/active/activeDiscussList.dir.html",controller:"ActiveDiscussCtrl",controllerAs:"activeDiscussCtrl",link:function(c){c.isTeacher=o.isTeacher,c.thumbnailPath=function(t){var n=e.IMAGES+"/mediatype/icon/discussion_prompt@2x.png";return angular.isDefined(t.meta.thumbnail)?t.meta.thumbnail:n},c.goToPromptPage=function(){var e=n.path();n.path(e).search({activeTab:"myPrompts"})},c.createPrompt=function(){n.search("promptView","create"),c.$emit("prompt.view.change","create"),a.analyticsForPrompt(i.ANALYTICS.CREATE_PROMPT)},c.back=function(e){e&&e.stopPropagation(),t.back("/classes",!0)},c.myPromptList=function(e){e&&e.preventDefault(),c.goToPromptPage(),c.$emit("prompt.view.change","list"),a.analyticsForPrompt(i.ANALYTICS.MY_PROMPT_LIST)},c.viewAssignment=function(e,t){e&&(e.preventDefault(),e.stopPropagation()),r.goToStudentStatusView(s.classId,t.assignmentSummary.assignmentId)},c.open=function(e,t){e&&e.stopPropagation();var r=["/classes",s.classId,"discussPrompt/assignments",t.assignmentSummary.assignmentId,"content",t.post.meta.item].join("/"),o=t.assignmentSummary.assignmentId,u=s.classId;a.analyticsForPrompt(i.ANALYTICS.OPEN_DISCUSSION),c.isTeacher||l.get(u,o).then(function(e){var t=e.isAdaptiveAssignment(),n=e.$getPrimaryMetadata().userAssignmentId;l.setInProgress(n,t,u,o)}),n.path(r).search({discuss:"active"})}}}}]).controller("ActiveDiscussCtrl",[function(){}]),angular.module("Realize.Prompt.Setting",["Realize.common.alerts","Realize.paths","Realize.ui.modal.UnsavedChangesModal","Realize.Prompt.promptApiUtilService","Realize.user.currentUser","Realize.ui.scrollTopOnLoad","Realize.navigationService","Realize.analytics","Realize.content.model.contentItem","Realize.prompt.constants"]).controller("settingPromptFormCtrl",[function(){}]).directive("settingPromptForm",["$log","PATH","lwcI18nFilter","$currentUser","UnsavedChangesModal","$rootScope","promptApiUtilService","MEDIA_PATH","NavigationService","$routeParams","$templateCache","$location","$q","InlineAlertService","Content","PROMPT_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f){"use strict";return{templateUrl:t.TEMPLATE_CACHE+"/prompt/view-states/create/settingPromptForm.dir.html",controller:"settingPromptFormCtrl",controllerAs:"settingPromptFormCtrl",link:function(h){var v=["brick","green","teal","blue","black"],S=o+"/skins/default/images/prompt/",T=".svg",A="discuss_prompt_icon_",I=function(){h.isSaveInProgress=!1,h.createPromptForm.$setPristine(),d.search().view&&(d.search("view",null),l.back("/search",!0)),h.isRoutingListView||(h.config?h.$emit("prompt.view.change",h.config):h.$emit("prompt.view.change","list"))};h.currentUser=r,h.thumbnails=[],h.isSaveInProgress=!1,h.isSaveErrorMessageVisible=!1,h.showErrorAlert=!1,h.prompt||(h.prompt={}),h.thumbnails=v.map(function(e){var t={caption:n("prompt.createForm.promptImageCaption")+n("global.color."+e),image:A+e+T};return t.url=S+t.image,t}),h.discussPromptBubbleUrl=angular.isDefined(h.prompt.thumbnails)?h.prompt.thumbnails:h.thumbnails[0].url,h.chooseDiscussPromptBubble=function(e){h.discussPromptBubbleUrl=e.url,h.selectedThumbnail=e},h.isCreateView=function(){return"create"===h.currentView},h.firstVisit={showAlert:function(){return!h.currentUser.getAttribute("prompt.info.seen")&&h.isCreateView()},title:n("prompt.firstVisitInfo.title"),description:n("prompt.firstVisitInfo.description"),closeFn:function(){h.currentUser.setAttribute("prompt.info.seen",!0)}},h.$on("prompt.createView.change",function(e,t){h.isSavePromptDisabled()?h.$emit("prompt.view.change",t):h.unsavedChangesModal.showDialog().then(function(){h.$emit("prompt.view.change",t)})}),h.back=function(e){var t=l.stack[l.stack.length-1].split("/classes"),n="myPrompts"===d.search().activeTab?"list":"active";e&&e.stopPropagation(),(_.isEmpty(l.stack)||h.promptList&&h.activeList&&t.length>1&&!h.activeList.length)&&h.isSavePromptDisabled()?(a.viewLoading=!1,d.search("promptView",null),h.$emit("prompt.view.change",n)):t.length>0&&t[0].indexOf("search")&&d.search().view?(a.viewLoading=!1,d.search("view",null),l.back("/search",!0)):h.isSavePromptDisabled()?h.config?h.$emit("prompt.view.change",h.config):h.$emit("prompt.view.change",n):h.unsavedChangesModal.showDialog().then(function(){h.savePressed||(h.config?h.$emit("prompt.view.change",h.config):h.promptList&&h.promptList.length?h.$emit("prompt.view.change","list"):h.$emit("prompt.view.change.zeroState"))})},h.savePrompt=function(){if(h.savePressed=!0,h.showErrorAlert=!1,h.createPromptForm.$invalid)return h.showErrorAlert=!0,m.reject("form is invalid!");var e={title:h.prompt.title,body:h.prompt.body,thumbnailUrl:h.discussPromptBubbleUrl};return h.isSaveInProgress=!0,h.isCreateView()?i.savePromptData(e,c.classId).then(h.saveSuccessfulEvent,h.saveFailedEvent).finally(function(){I()}):i.updatePrompt(h.prompt.id,e).then(h.editSuccessfulEvent,h.saveFailedEvent).finally(function(){I()})},h.$on("prompt.create-view.saveFailed",function(t,n){h.isLoading=!1,h.isSaveErrorMessageVisible=!0,e.error("Error saving!",n)}),h.saveSuccessfulEvent=function(e){i.analyticsForPrompt(f.ANALYTICS.CREATE_SAVE_PROMPT),h.promptList.unshift(new p(e)),g.addAlert(e.id,{type:"success",msg:["<strong>",n("prompt.successNotification.createdPrompt.success.title"),"</strong>",n("prompt.successNotification.createdPrompt.success.message")].join("")})},h.editSuccessfulEvent=function(e){i.analyticsForPrompt(f.ANALYTICS.EDIT_SAVE_PROMPT);var t=["<strong>",n("prompt.successNotification.editedPrompt.title"),"</strong>",n("prompt.successNotification.editedPrompt.message")].join(""),r=new p(e);if(h.promptList&&h.promptList.length||d.search().view){if(h.promptList&&h.promptList.length)for(var s=0;s<h.promptList.length;s++)h.promptList[s].id===h.prompt.id&&(h.promptList[s]=r);g.addAlert(e.id,{type:"success",msg:t})}else h.$emit("prompt.detail.update",r),h.$emit("editedPrompt.alert.toggle",{show:!0,alertDetails:{msg:t,type:"success",icon:"ok-sign"},assignedItem:r})},h.saveFailedEvent=function(t){h.isLoading=!1,h.isSaveErrorMessageVisible=!0,e.error("Error saving!",t)},h.unsavedChangesModal=new s(h.savePrompt.bind(h,!0)),h.$parent.$on("$locationChangeStart",function(e){var t=h.isCreateView()&&h.selectedThumbnail?h.thumbnails[0].url!==h.selectedThumbnail.url:!1;t=t||h.selectedThumbnail&&angular.isDefined(h.prompt.thumbnails)&&h.prompt.thumbnails!==h.selectedThumbnail.url,h.createPromptForm&&(h.createPromptForm.$dirty||t&&h.isSaveInProgress)&&(a.viewLoading=!1,h.isRoutingListView=!0,h.unsavedChangesModal.showDialog(e).then(function(){a.viewLoading||(a.viewLoading=!0)}))}),h.$on("$destroy",function(){u.remove(t.TEMPLATE_CACHE+"/prompt/view-states/create/settingPromptForm.dir.html")}),h.isSavePromptDisabled=function(){return h.createPromptForm.$pristine&&(_.isUndefined(h.selectedThumbnail)||h.isCreateView()&&h.thumbnails[0].url===h.selectedThumbnail.url||angular.isDefined(h.prompt.thumbnails)&&h.prompt.thumbnails===h.selectedThumbnail.url)||h.isSaveInProgress},setTimeout(function(){$("#prompt-title").focus()},2e3)}}}]),angular.module("Realize.Prompt.List",["Realize.paths","rlzComponents.components.i18n","Realize.navigationService","Realize.analytics","Realize.Prompt.promptApiUtilService","Realize.prompt.constants","Realize.content.model.contentItem"]).directive("listPrompt",["PATH","NavigationService","$location","promptApiUtilService","$log","$routeParams","PROMPT_CONSTANTS","$route","Content",function(e,t,n,r,s,a,i,o,l){"use strict";return{templateUrl:e.TEMPLATE_CACHE+"/prompt/view-states/list/listPrompt.dir.html",controller:"ListPromptCtrl",controllerAs:"listPromptCtrl",link:function(e){e.thumnailPath=function(e){return e.thumbnailUrls?e.thumbnailUrls[0]:""},e.editPrompt=function(t,n){e.$emit("prompt.mode.editing",n,"edit")},e.createPrompt=function(){r.getPromptList(o.current.params.classId).then(function(t){e.$parent.promptList=t&&t.length?_.map(t,function(e){return new l(e)}):[],n.search("promptView","create"),e.$emit("prompt.view.change","create")}),r.analyticsForPrompt(i.ANALYTICS.CREATE_PROMPT)},e.back=function(t){t&&t.stopPropagation(),n.search("activeTab",null),e.$emit("prompt.view.change","active")},e.open=function(e,t){e&&e.stopPropagation();var s=[n.path(),t.id,t.version].join("/");n.path(s),r.analyticsForPrompt(i.ANALYTICS.OPEN_PROMPT)},e.$on("prompt.list.delete",function(e,t){r.deletePrompt(t.id).then(function(){t.isDeleted=!0},function(e){s.error("Error %s in deleting the post: %s",e,t.id)})}),e.$on("prompt.list.unDelete",function(e,t){r.unDeletePrompt(t.id,a.classId).then(function(){t.isDeleted=!1},function(e){s.error("Error %s in deleting the post: %s",e,t.id)})}),e.removePrompt=function(t,n){t&&t.stopPropagation(),e.$emit("prompt.list.delete",n),r.analyticsForPrompt(i.ANALYTICS.REMOVE_PROMPT)},e.unDeletePrompt=function(t,n){t&&t.stopPropagation(),e.$emit("prompt.list.unDelete",n)},e.zeroStatePage=function(){return e.$parent.showZeroState&&!e.$parent.promptList.length?!0:!1}}}}]).controller("ListPromptCtrl",[function(){}]),angular.module("Realize.reporting.data.IndividualStudentReportCtrl",["RealizeDataServices","Realize.reporting.MasteryByStandardReport","Realize.reporting.ReportService","Realize.common.tourGuide","rlzComponents.components.i18n","Realize.standards.standardDataService","Realize.common.mediaQueryService","Realize.navigationService","rlzComponents.components.masteryByStandardTelemetryWorker"]).config(["AnalyticsProvider",function(e){"use strict";e.addTracker("track.scoresByStandard",["GoogleAnalytics","AnalyticsEvent",function(e,t){e.trackEvent("Data","Scores by Standard",t.label)}])}]).controller("IndividualStudentReportCtrl",["$log","RosterData","$routeParams","$scope","IndividualStudentReport","$location","$route","ReportService","MasteryByStandardReport","Standard","$interpolate","Analytics","Modal","lwcI18nFilter","BrowserInfo","MediaQuery","masteryByStandardTelemetryWorker","NavigationService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v){"use strict";if(r.secondarySort="+standardCode",r.sortOption="+studentRecord.percentAsDecimal",r.sortPredicate=[r.sortOption,r.secondarySort],r.masteryStandardData=s,r.hasStudentRecord=s.hasStudentRecord,r.studentId=n.studentId,r.studentList=r.currentRoster.students,r.selectedStudent=_.findWhere(r.studentList,{userId:r.studentId}),r.programName=s.selectedProgramName,r.standardsLibraryFullPath=s.selectedStandardLibraryId,r.isIDevice=p.isIDevice,r.isDesktop=f.breakpoint.isDesktop,r.isMobileDevice=p.isMobileDevice,!r.selectedStudent){var S=r.currentRoster.classId,T=l.getRemovedStudent(S);T&&T.userId===n.studentId||(T=_.findWhere(r.masteryStandardData.studentInfoList,{studentId:r.studentId})||r.masteryStandardData.studentInfoList[0]),r.selectedStudent=l.mockStudentUserFromReportData(T,S),e.warn("Selected student not found in class, mocked using report data",r.selectedStudent)}r.studentName=r.selectedStudent.firstAndLast,r.locationFallback="/data/"+r.currentRoster.classId+"/standards",r.standardInfo=s.standardInfoMapByStandardId,r.$on("masteryByStandard.filters.updated",function(t,n){if(e.log("Filters updated",n),r.studentId!==n.selectedStudent.userId){var s=a.path(),o=s.split("/students/")[0]+"/students/"+n.selectedStudent.userId+"/individualStudentReport";a.path(o).replace()}else i.reload()}),r.openResource=function(e){r.$root.searchResultsTitle=o.currentProgram,a.path("/search/standard/"+c.urlEncode(e.standardFullTerm))},r.exportScores=function(){var e=function(){var e={programName:r.programName,standardsLibraryFullPath:r.standardsLibraryFullPath};l.exportIndividualReport(r.currentRoster.classId,r.studentId,e)};m.simpleDialog(g("individualStudentReport.export.modal.title"),g("individualStudentReport.export.modal.message"),{OK:{title:g("individualStudentReport.export.modal.action.export"),handler:function(){e()},isDefault:!0},CANCEL:{title:g("individualStudentReport.export.modal.action.cancel")}},{id:"export_scores_modal"})},r.sortBy=function(e){var t=r.sortOption.split(".")[1],n=r.sortOption.charAt(0),s="+";e===t&&"+"===n&&(s="-"),r.sortOption=s+"studentRecord."+e,r.sortPredicate=[r.sortOption,r.secondarySort]},r.isSortingBy=function(e){return r.sortOption.split(".")[1]===e},r.goBack=function(e,t){h.onGoBackToMasteryReportClick(),v.back(r.locationFallback,t)},r.getSortOrderClass=function(){return"+"===r.sortOption.charAt(0)?"down":"up"},r.$on("tour:close",function(e,t){var n=_.toArray(r.tourOptions).length,s="Individual Student: Tips Completed",a="Individual Student: Tip"+t.stop+" Display",i=t.stop===n?s:a;d.track("track.masteryByStandard",{label:i})}),r.$on("tour:change",function(e,t){d.track("track.scoresByStandard",{label:"Individual Student: Tip"+t.stop+" Exit"})});var A=u("<h3>{{ heading | lwcI18n }}</h3>{{ message | lwcI18n }}");r.tourOptions={step1:A({heading:"individualStudentReport.helpme.msg.step1.header",message:"individualStudentReport.helpme.msg.step1.msg"}),step2:A({heading:"individualStudentReport.helpme.msg.step2.header",message:"individualStudentReport.helpme.msg.step2.msg"})},r.$on("window.breakpoint.change",function(){r.isDesktop=f.breakpoint.isDesktop})}]),angular.module("Realize.standard.constants",[]).constant("STANDARD_CONSTANTS",{STANDARD_TRUNCATION:{CHARACTER_LIMIT:9,ELLIPSIS_AT_BEGINING:!0},TYPE:"Mastery by Standard",DIRECTION:{UP:"up",DOWN:"down",DEFAULT:"default"},HEADER_COLUMN_IDENTIFIER:{NAME:"name",PERCENT:"percent",STANDARD:"standard",SCORE:"score"},STANDARD_SCORE_COLOR:{SKIP:"Skip",FAIL:"Fail",PASS:"Pass"},SORT_TYPE:{ASC:"ASC",DESC:"DESC"},SORT_FIELD:{NAME:"Name",MASTERED:"Mastered",STANDARD_PROFICIENCY:"standardProficiencySortType",SCORE:"Score"},STANDARD_MASTERY_BY_CLASS:"standardMasteryByClass",STANDARD_MASTERY_BY_ASSIGNMENT:"standardMasteryByAssignment",MASTERY_CUTOFF:70,STANDARD_ERROR_MESSAGE:"FILTERED_ASSIGNMENTS_NOT_PART_OF_CLASS"}),angular.module("Realize.reporting.data.MasteryStandardCtrl",["RealizeDataServices","Realize.reporting.MasteryByStandardReport","Realize.reporting.ReportService","Realize.analytics","Realize.common.mediaQueryService","Realize.common.tourGuide","Realize.standards.standardDataService","Realize.standard.constants","Realize.paths","components.filters","rlzComponents.components.sortArrow","rlzComponents.components.standardsListModal","rlzComponents.utilities.a11yElementLabel","rlzComponents.routedComponents.itemAnalysis.table.stickyTop","rlzComponents.components.masteryByStandardAccordion","rlzComponents.components.masteryByStandardsFilter","rlzComponents.components.masteryByStandardTelemetryWorker","webStorageModule"]).config(["AnalyticsProvider",function(e){"use strict";e.addTracker("track.masteryByStandard",["GoogleAnalytics","AnalyticsEvent",function(e,t){e.trackEvent("Data","Mastery by Standard",t.label)}])}]).controller("MasteryStandardCtrl",["$scope","$window","lwcI18nFilter","$interpolate","$location","$log","$timeout","RosterData","MasteryByStandardReport","ReportService","Analytics","Standard","MASTERY_THRESHOLD","Modal","BrowserInfo","MediaQuery","STANDARD_CONSTANTS","standardsListModal","masteryByStandardTelemetryWorker","PATH","webStorage",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A){"use strict";
var I=e.currentUser.getAttribute("masteryByStandard.hideInitialIntro");e.classId=e.currentRoster.classId,e.isHelpMeInterpretIsVisible=!1,e.locationFallback="/data",e.navigationFallback="/data",e.currentRoster=o,e.progIndex=-1,e.selectedStandardColumn=null,e.locale=e.currentUser.getAttribute("profile.locale")?e.currentUser.getAttribute("profile.locale"):t.systemLang,e.fixedHeaderHeight=p.isIDevice?0:138,e.isIDevice=p.isIDevice,e.isReload=!0,e.assignmentIds=[];var E=function(){e.stickyTopMaxWidth=f.breakpoint.isDesktop?958:768};E(),e.allCategories=n("masteryByStandard.filter.allCategories"),e.allAssignments=n("masteryByStandard.filter.allAssignments"),e.allStandards=n("masteryByStandard.filter.allStandards"),e.assessedStandards=n("masteryByStandard.filter.assessedStandards"),e.helpMeInterpret={smallScreenConfig:{landscapePosition:{left:"48%"},potraitPosition:{left:"31%"},arrow:{left:"14%"},arrowStepFour:{left:"13%"},arrowStepFive:{left:"65%"}},normalScreenConfig:{position:{left:"13%"},arrow:{left:"14%"},arrowStepFour:{left:"13%"},arrowStepFive:{left:"42%"},positionStepFive:{left:"48%"}}},e.accordionProperties={expandedStudentId:null,selectedStandardId:null,isExpanded:function(){return!!e.accordionProperties.expandedStudentId}},e.clickOrigin={expandRow:"expandRow",studentName:"studentName",standardCell:"standardCell"},e.popOverPosition=p.isMobileDevice?f.breakpoint.isDesktop?e.helpMeInterpret.smallScreenConfig.landscapePosition:e.helpMeInterpret.smallScreenConfig.potraitPosition:e.helpMeInterpret.normalScreenConfig.position,e.popOverPositionStepFive=p.isMobileDevice?f.breakpoint.isDesktop?e.helpMeInterpret.smallScreenConfig.landscapePosition:e.helpMeInterpret.smallScreenConfig.potraitPosition:e.helpMeInterpret.normalScreenConfig.positionStepFive,e.arrowPosition=p.isMobileDevice?e.helpMeInterpret.smallScreenConfig.arrow:e.helpMeInterpret.normalScreenConfig.arrow,e.arrowPositionStepFive=p.isMobileDevice?e.helpMeInterpret.smallScreenConfig.arrowStepFive:e.helpMeInterpret.normalScreenConfig.arrowStepFive,e.arrowPositionStepFour=p.isMobileDevice?e.helpMeInterpret.smallScreenConfig.arrowStepFour:e.helpMeInterpret.normalScreenConfig.arrowStepFour,e.standardTruncationSettings={characterLimit:h.STANDARD_TRUNCATION.CHARACTER_LIMIT,ellipsisAtBeginning:h.STANDARD_TRUNCATION.ELLIPSIS_AT_BEGINING},e.$on("tour:close",function(t,n){e.currentUser.setAttribute("masteryByStandard.hideInitialIntro",!0),I=!0;var r=_.toArray(e.tourOptions).length,s=n.stop===r?"Tips Completed":"Tip"+n.stop+" Exit";u.track("track.masteryByStandard",{label:s}),y.helpMeInterpretDataLink()});var y={element:function(e){var t=document.querySelector(e);t.focus()},helpMeInterpretDataLink:function(){var t="#helpMeInterpretLink a";y.element(t),e.isHelpMeInterpretIsVisible=!1},firstStandardNameOnNextPageSet:function(){var e=".masteryByStandard__header__standardCode a";y.element(e)}};e.$on("tour:change",function(e,t){u.track("track.masteryByStandard",{label:"Tip"+t.stop+" Display"})});var R=r("<h3>{{ heading | lwcI18n }}</h3>{{ message | lwcI18n }}"),C=r('<h3>{{ heading | lwcI18n }}</h3>{{ message | lwcI18n }} <img src={{ accordionImage }} alt="{{ ::altText | lwcI18n }}" class="masteryByStandard__helpMeInterpretTipFive"/>');e.tourOptions={step1:R({heading:"masteryByStandard.help.msg.step1.header",message:"masteryByStandard.help.msg.step1.msg"}),step2:R({heading:"masteryByStandard.help.msg.step2.header",message:"masteryByStandard.help.msg.step2.msg"}),step3:R({heading:"masteryByStandard.help.msg.step3.header",message:"masteryByStandard.help.msg.step3.msg"}),step4:R({heading:"masteryByStandard.help.msg.step4.header",message:"masteryByStandard.help.msg.step4.msg"}),step5:C({heading:"masteryByStandard.help.msg.step5.header",message:"masteryByStandard.help.msg.step5.msg",accordionImage:T.IMAGES+"/masteryByStandard/image_tip.png",altText:"masteryByStandard.help.altText"})},e.reportParameters={pageNumber:l.getSavedStandardPageNumber(e.classId),pageSize:f.breakpoint.isDesktop?5:3},e.$on("window.breakpoint.change",function(){e.reportParameters.pageSize=f.breakpoint.isDesktop?5:3,E(),D()});var D=function(){var t=b(e.standardReportPage.endIndex,e.reportParameters.pageSize);if(!(e.reportParameters.pageNumber*e.reportParameters.pageSize<=t))for(;e.reportParameters.pageNumber>0&&e.reportParameters.pageNumber*e.reportParameters.pageSize>t;)e.previousPage()},b=function(e,t){for(a.debug("inside roundToUpperMultiplier");t>0&&e%t!==0;)e+=1;return e},P=function(){_.debounce(function(){var t=e.tourGuide.activeStop;e.tourGuide.reset(),e.$apply(),e.tourGuide.start(t)},{leading:!1,trailing:!0})()};e.$on("window.breakpoint.change",function(){e.popOverPosition=f.breakpoint.isDesktop?e.helpMeInterpret.smallScreenConfig.landscapePosition:e.helpMeInterpret.smallScreenConfig.potraitPosition;var t=angular.element(".popover-tour-guide").length;t&&P()}),e.standardFieldPrefernece={sortField:h.HEADER_COLUMN_IDENTIFIER.NAME,sortType:h.SORT_TYPE.ASC,standardProficiencySortType:h.SORT_TYPE.DESC};var w=function(){e.sortField.ascending=!1;var t=A.get(h.STANDARD_MASTERY_BY_CLASS+"."+e.currentUser.userId+"."+e.classId);e.standardFieldPrefernece=angular.extend(e.standardFieldPrefernece,t),e.standardFieldPrefernece&&(e.standardFieldPrefernece.sortType===h.SORT_TYPE.DESC&&(e.sortField.ascending=!0),e.standardFieldPrefernece.sortField===h.SORT_FIELD.NAME?e.sortField.identifier=h.HEADER_COLUMN_IDENTIFIER.NAME:e.standardFieldPrefernece.sortField===h.SORT_FIELD.MASTERED&&(e.sortField.identifier=h.HEADER_COLUMN_IDENTIFIER.PERCENT),e.standardFieldPrefernece.standardProficiencySortType===h.SORT_TYPE.ASC&&(e.scoreSortedByDesc=!1)),e.scoreSortLabel=e.scoreSortedByDesc?n("masteryByStandard.columnHeader.scoreLowToHigh"):n("masteryByStandard.columnHeader.scoreHighToLow")},L=function(e,t){return e.standardId===t.standardId},$=function(t){e.pageLoading();var n=e.masterStandardsList,r=angular.copy(e.masterStandardInfoMap);e.isStandardAssessed=t.isAssessedStandard,t.isAssessedStandard&&(n=n.filter(function(e){return e.assessed})),e.standardList=n,angular.forEach(r,function(e,t){n.some(function(t){return L(t,e)})||delete r[t]}),e.standardInfoMapByStandardId=r,Q(),H();var s=e.standardFieldPrefernece.sortField===h.SORT_FIELD.MASTERED?h.HEADER_COLUMN_IDENTIFIER.PERCENT:h.HEADER_COLUMN_IDENTIFIER.NAME;w(),e.standardList=l.sortStandardInfoMapByPercentageOrder(e.standardInfoMapByStandardId,e.scoreSortedByDesc),e.sortBy(s,!1),e.reportParameters.standardList=e.standardList,e.standardReportPage=l.getReportPage(1,e.standardList.length,e.standardList),e.pageLoaded()},O=function(t){e.pageLoading(),l.getReport(e.classId,t,e.currentUser.userId).then(function(n){e.hasData=!0,e.statusCode=n.statusCode,e.studentList=n.studentInfoList,e.programName=n.selectedProgramName,e.programList=_.uniq(n.programNames),e.standardLibraries=n.standardLibraries,e.standardInfoMapByStandardId=n.standardInfoMapByStandardId,w(),e.standardList=l.sortStandardInfoMapByPercentageOrder(n.standardInfoMapByStandardId,e.scoreSortedByDesc),e.standardsLibraryFullPath=n.selectedStandardLibraryId,e.masterStandardsList=angular.copy(e.standardList),e.masterStandardInfoMap=angular.copy(e.standardInfoMapByStandardId),e.standardReportPage=l.getReportPage(t.pageNumber,t.pageSize,e.standardList),e.selectedLibrary=_.find(e.standardLibraries,function(t){return t.standardFullTerm===e.standardsLibraryFullPath}),!I&&e.hasData&&e.studentList.length&&i(function(){e.tourGuide.start()},100),e.masteryStandardData=n,e.showSorting=e.studentList.length>1;var r=!1;e.sortBy(e.sortField.identifier,r);var s=angular.copy(t)||{};e.assignmentIds=angular.isDefined(t.assignmentIds)&&t.assignmentIds.length>0?t.assignmentIds:[],e.isStandardAssessed=s.isAssessedStandard=angular.isDefined(t.isAllStandards)&&!t.isAllStandards,e.contentCategory=!angular.isDefined(t.isAllContentCategory)||t.isAllContentCategory?e.allCategories:t.contentCategory,e.assignmentTitle=!angular.isDefined(t.isAllAssignment)||t.isAllAssignment?e.allAssignments:e.masteryStandardData.assignmentIdAndTitleMap[t.assignmentId],e.isAllAssignment=s.isAllAssignment,s.isAssessedStandard&&$(s),S.setProgramName(e.programName)},function(t){e.hasData=!1,a.debug("MasteryByStandardReport.then error",t),t.data=t.data||{},e.statusCode=t.data.errorCode,e.standardLibraries=[]}).finally(function(t){a.debug("MasteryByStandardReport.finally",t),e.selectedStandardColumn=null,H(),e.pageLoaded()})};e.$on("masteryByStandard.filters.updated",function(t,n){a.log("Filter updated:",n),e.assignmentIds=[];var r={programName:n.programName,standardsLibraryFullPath:n.selectedLibrary?n.selectedLibrary.standardFullTerm:null,pageNumber:1,pageSize:e.reportParameters.pageSize,isAssessedStandard:n.isAssessedStandard,contentCategory:n.selectedContentCategory,assignmentId:n.selectedAssignmentId,assignmentTitle:n.selectedAssignmentTitle,isAllStandards:!n.isAssessedStandard,isAllContentCategory:n.selectedContentCategory===e.allCategories,isAllAssignment:n.selectedAssignmentTitle===e.allAssignments};e.reportParameters.pageNumber=1,e.isReload=n.isReload,N(r),e.isReload?O(r):$(r)});var N=function(t){switch(!0){case!t.isAllContentCategory&&!t.isAllAssignment:e.contentCategory=t.contentCategory,e.assignmentIds=t.assignmentId;break;case!t.isAllContentCategory&&t.isAllAssignment:e.contentCategory=t.contentCategory;break;case t.isAllContentCategory&&!t.isAllAssignment:e.assignmentIds=t.assignmentId;break;case t.isAllAssignment&&t.isAllContentCategory:e.contentCategory=t.contentCategory}angular.isDefined(e.assignmentIds)&&e.assignmentIds.length>0&&(t.assignmentIds=e.assignmentIds),angular.isDefined(t.contentCategory)&&(t.contentCategory=e.contentCategory)};e.$watchCollection("reportParameters",function(t,n){a.log("params watch",t,n),e.standardList&&e.standardReportPage&&(e.standardReportPage.pageNumber!==t.pageNumber||e.standardReportPage.pageSize!==t.pageSize)&&(l.saveStandardPageNumber(e.classId,e.reportParameters.pageNumber),e.standardReportPage=l.getReportPage(t.pageNumber,t.pageSize,e.standardList),e.setSelectedStandardColumn(null),e.updateStandardReportPageListToFitDisplayPageSize())});var M=l.getSavedFilterOptions(e.currentUser,e.classId);angular.extend(M,e.reportParameters),e.scoreSortedByDesc=!0,e.scoreSortLabel=n("masteryByStandard.columnHeader.scoreLowToHigh"),O(M),e.setSelectedStandardColumn=function(t){e.selectedStandardColumn!==t?(e.selectedStandardColumn=t,u.track("track.masteryByStandard",{label:"View Standard Details"})):e.selectedStandardColumn=null},e.showStandardsListModal=function(e,t){var r=n("teacherItemAnalysis.columnHeader.standard")+" "+t.standardTerm;v.activate({headerText:r,standardsList:[t],beforeViewResoucesRedirect:function(e){S.onViewResources(e.standardTerm)},closeAction:function(){k(e.currentTarget)}}),S.onStandardInfoButton()};var k=function(e){e.focus()};e.searchByStandard=function(t){e.$root.searchResultsTitle=c.currentProgram,s.path("/search/standard/"+d.urlEncode(t))},e.showAssignmentsByStudentStandard=function(e,t){a.debug("selectStudentStandard",e,t),u.track("track.masteryByStandard",{label:"Standard to Assessment Drilldown"})};var z=function(t){return _.find(e.standardReportPage.list,function(e){return e.standardId===t})};e.studentScoreCssClass=function(e){var t,n,r,s=5,a=e.standardInfoMapByStandardId;return t=_.find(a,function(e){return n=e.pointsAchieved.toString().length,r=e.pointsPossible.toString().length,(n>s||r>s)&&z(e.standardId)}),t?"smallerScores":""},e.standardScoreCssClass=function(e){var t=e?e.pointsAchieved/e.pointsPossible:0;return"masteryByStandard__standard--color"+(e?m>t?h.STANDARD_SCORE_COLOR.FAIL:h.STANDARD_SCORE_COLOR.PASS:h.STANDARD_SCORE_COLOR.SKIP)},e.gotoPrograms=function(){s.path("/program")},e.retryDataCall=function(){O(M)},e.goToIndividualReport=function(t){S.onMasteryScoreClick(t.percentageMasteredForStandardsLibrary);var n="/data/"+e.classId+"/standards/students/"+t.studentId+"/individualStudentReport";s.path(n)},e.helpMeInterpretStart=function(){S.onHelpMeInterpretClick(),e.tourGuide.start(),e.isHelpMeInterpretIsVisible=!0},e.$on("tour:next",function(){S.onNextOrPrevTipClick("next")}),e.$on("tour:previous",function(){S.onNextOrPrevTipClick("previous")});var U=function(){return e.studentList.length>1&&e.sortField.ascending===!0?h.SORT_TYPE.ASC:h.SORT_TYPE.DESC},F=function(){return e.studentList.length>1&&e.sortField.identifier===h.HEADER_COLUMN_IDENTIFIER.STANDARD?e.sortAppliedStandardId:e.sortField.identifier},x=function(){return e.isAllAssignment?void 0:e.assignmentIds};e.openExportModal=function(){S.onExportButton({numberOfStudents:B.getNumberOfStudents(),numberOfStandards:B.getNumberOfStandards()});var t=function(){var t={programName:e.programName,standardsLibraryFullPath:e.standardsLibraryFullPath,isStandardAssessed:e.isStandardAssessed?e.isStandardAssessed:!1,contentCategory:e.contentCategory?e.contentCategory:e.allCategories,assignmentTitle:e.assignmentTitle?e.assignmentTitle:e.allAssignments,assignmentIds:x(),sortField:F(),sortType:U(),standardProficiencySortType:e.standardFieldPrefernece.standardProficiencySortType};l.exportClassReport(e.currentRoster.classId,t)};g.simpleDialog(n("masteryByStandard.export.modal.title"),n("masteryByStandard.export.modal.message"),{OK:{title:n("masteryByStandard.export.modal.action.export"),handler:function(){t()},isDefault:!0},CANCEL:{title:n("masteryByStandard.export.modal.action.cancel")}},{id:"export_scores_modal"})},e.getAriaLabelForMasteryHeaderCell=function(e){var t=n("masteryByStandard.heading.classScore"),r="";return r=e.mastered?n("masteryByStandard.heading.status.mastered"):n("masteryByStandard.heading.status.notMastered"),[e.standardTerm,t,e.percentageOfStudentsMastered,"%",r].join(" ")};var B={getNumberOfStandards:function(){return e.standardList.length},getNumberOfStudents:function(){return e.studentList.length}},V=function(){e.startStandard=(e.reportParameters.pageNumber-1)*e.reportParameters.pageSize,isNaN(e.startStandard)&&(e.startStandard=0)};V();var H=function(){setTimeout(function(){e.$broadcast("updateStickyTop","masteryByStandardTableHeader")},50)};e.nextPage=function(){e.reportParameters.pageNumber=e.reportParameters.pageNumber+1,e.startStandard=e.startStandard+e.reportParameters.pageSize,H(),Q(),i(function(){y.firstStandardNameOnNextPageSet()},100)},e.previousPage=function(){e.reportParameters.pageNumber=e.reportParameters.pageNumber-1,e.startStandard=e.startStandard-e.reportParameters.pageSize,H(),Q()},e.HEADER_IDENTIFIER={name:h.HEADER_COLUMN_IDENTIFIER.NAME,percent:h.HEADER_COLUMN_IDENTIFIER.PERCENT,standard:h.HEADER_COLUMN_IDENTIFIER.STANDARD,score:h.HEADER_COLUMN_IDENTIFIER.SCORE},e.sortField={identifier:e.HEADER_IDENTIFIER.name,ascending:!1,standardIndex:-1};var G=function(t,n){return Number(n)===e.sortField.standardIndex},j=function(t,n){return angular.isDefined(n)?G(t,+n):e.sortField.identifier===t},q=function(t,n){return j(t,n)&&e.sortField.ascending},Y=function(t,n){return j(t,n)&&!e.sortField.ascending},W=function(t,n){var r=Number(n);return t===e.HEADER_IDENTIFIER.standard?r===e.sortField.standardIndex?e.sortField.ascending=!e.sortField.ascending:(e.sortField.standardIndex=r,e.sortField.ascending=!0):(e.sortField.standardIndex=-1,e.sortField.ascending=!e.sortField.ascending),t!==e.sortField.identifier?(e.sortField.identifier=t,e.sortField.ascending=!0,e.sortField.standardIndex=isNaN(r)?-1:r,void 0):void 0},K=function(t){t?(e.standardFieldPrefernece.sortType=h.SORT_TYPE.DESC,e.sortField.ascending&&e.sortField.identifier===t&&(e.standardFieldPrefernece.sortType=h.SORT_TYPE.ASC),t===h.HEADER_COLUMN_IDENTIFIER.NAME?e.standardFieldPrefernece.sortField=h.SORT_FIELD.NAME:t===h.HEADER_COLUMN_IDENTIFIER.PERCENT&&(e.standardFieldPrefernece.sortField=h.SORT_FIELD.MASTERED)):(e.standardFieldPrefernece.standardProficiencySortType=h.SORT_TYPE.DESC,e.scoreSortedByDesc||(e.standardFieldPrefernece.standardProficiencySortType=h.SORT_TYPE.ASC)),A.add(h.STANDARD_MASTERY_BY_CLASS+"."+e.currentUser.userId+"."+e.classId,e.standardFieldPrefernece)};e.sortBy=function(t,n,r,s){var a=void 0!==s?s.standardId:void 0;e.sortAppliedStandardId=a,W(t,r),t!==e.HEADER_IDENTIFIER.name&&t!==e.HEADER_IDENTIFIER.percent||!n||K(t),Q(),e.studentList=e.studentList.sort(function(t,n){var r;switch(e.sortField.identifier){case e.HEADER_IDENTIFIER.name:r=l.nameComparator(t,n);break;case e.HEADER_IDENTIFIER.percent:r=l.percentComparator(t,n,e.sortField.ascending);break;case e.HEADER_IDENTIFIER.standard:var s=t.standardInfoMapByStandardId[a],i=n.standardInfoMapByStandardId[a],o=void 0!==s?s.pointsAchieved/s.pointsPossible:Number.NEGATIVE_INFINITY,c=void 0!==i?i.pointsAchieved/i.pointsPossible:Number.NEGATIVE_INFINITY;r=o===c&&e.sortField.ascending?angular.lowercase(t.lastFirst)<angular.lowercase(n.lastFirst)?-1:1:o!==c||e.sortField.ascending?l.standardComparator(t,n,a):angular.lowercase(t.lastFirst)>angular.lowercase(n.lastFirst)?-1:1}return r}),e.sortField.ascending||e.studentList.reverse(),n&&S.onSortColumn(t,e.sortField.ascending,s)},e.getDirection=function(e,t){return Y(e,t)?h.DIRECTION.UP:q(e,t)?h.DIRECTION.DOWN:h.DIRECTION.DEFAULT},e.indexForNonStandardColumn=-1,e.getAriaSortTitle=function(t,r,s){var a=[];return t===e.HEADER_IDENTIFIER.standard?a.push(s):t===e.HEADER_IDENTIFIER.name?a.push(n("masteryByStandard.columnHeader.name")):t===e.HEADER_IDENTIFIER.percent?a.push(n("masteryByStandard.columnHeader.percent")):t===e.HEADER_IDENTIFIER.score&&a.push(e.scoreSortLabel),a.push(n("teacherItemAnalysis.sorting.sortableColumn")),t===e.sortField.identifier&&r===e.sortField.standardIndex?e.sortField.ascending?(a.push(n("masteryByStandard.sorting.sortedAscending")),a.push(n("masteryByStandard.sorting.activateDescending"))):(a.push(n("masteryByStandard.sorting.sortedDescending")),a.push(n("masteryByStandard.sorting.activateAscending"))):t===e.HEADER_IDENTIFIER.score?e.scoreSortedByDesc?(a.push(n("masteryByStandard.sorting.sortedDescending")),a.push(n("masteryByStandard.sorting.activateAscending"))):(a.push(n("masteryByStandard.sorting.sortedAscending")),a.push(n("masteryByStandard.sorting.activateDescending"))):a.push(n("masteryByStandard.sorting.activateAscending")),a.join(", ")},e.getAriaLabelScore=function(t,r){var s="";return s=e.shouldDisplay.scoreForStandard(t,r)?n("masteryByStandard.heading.modal")+" "+r.standardTerm+" "+n("infoSidePanel.score")+" "+t.standardInfoMapByStandardId[r.standardId].pointsAchieved+" "+n("masteryByStandard.ariaLabelText.of")+" "+t.standardInfoMapByStandardId[r.standardId].pointsPossible:n("masteryByStandard.columnHeader.noData")},e.shouldDisplay={errorMessageForEmptyStudentList:function(){var t=!e.studentList||!e.studentList.length,n=e.standardLibraries&&Boolean(e.standardLibraries.length);return e.hasData&&t&&n},errorMessageForEmptyStandardLibrary:function(){var t=!e.standardLibraries||!e.standardLibraries.length;return e.hasData&&t},accordionForStudent:function(t){return t===e.accordionProperties.expandedStudentId},expandedStandardIndicator:function(t,n){return t===e.accordionProperties.expandedStudentId&&n===e.accordionProperties.selectedStandardId},scoreForStandard:function(e,t){return e.standardInfoMapByStandardId[t.standardId]},standardDetails:function(e){return-1!==e.displayOrder}},e.toggleAccordion=function(t,n,r,s){if(X(t,n)){var i=s?s.score:void 0;return S.onCloseAccordion(r,i),Q(),void 0}if(e.accordionProperties.expandedStudentId=t,n)S.onOpenAccordion(r,s.score);else{var o=Z(e.accordionProperties.expandedStudentId),l=J(o);l?(n=l.standardId,S.onOpenAccordion(r)):(a.error("Cant find a standard with score for the selected student from standards available in current standards page and beyond"),n=null)}e.accordionProperties.selectedStandardId=n};var Q=function(){e.accordionProperties.expandedStudentId=null,e.accordionProperties.selectedStandardId=null},X=function(t,n){var r=!1,s=e.accordionProperties.isExpanded(),a=n===e.accordionProperties.selectedStandardId,i=t===e.accordionProperties.expandedStudentId,o=i&&!n;return s&&o?r=!0:s&&i&&a&&(r=!0),r},Z=function(t){return e.studentList.find(function(e){return e.studentId===t})},J=function(t){if(e.standardReportPage&&e.standardReportPage.list){var n=e.standardReportPage.list;return n.find(function(e){return t.standardInfoMapByStandardId[e.standardId]})}};e.getStandardsObjectFromStandardId=function(t){return e.standardList.find(function(e){return e.standardId===t})},e.updateSortFieldStandardIndex=function(){var t=!1;if(e.sortAppliedStandardId)for(var n=0;n<e.standardReportPage.list.length;n++)e.standardReportPage.list[n].standardId===e.sortAppliedStandardId&&(t=!0,e.sortField.standardIndex=(e.reportParameters.pageNumber-1)*e.reportParameters.pageSize+n);t||(e.sortField.standardIndex=-1)},e.updateStandardReportPageListToFitDisplayPageSize=function(){var t=e.standardReportPage.list.length,n=t%e.reportParameters.pageSize===0;if(e.updateSortFieldStandardIndex(),0!==t&&n)return e.standardReportPage.list;var r=e.reportParameters.pageSize-t,s=et(r);s.forEach(function(t){e.standardReportPage.list.push(t)})},e.sortByScore=function(){e.startStandard=0,e.scoreSortedByDesc=!e.scoreSortedByDesc,e.reportParameters.pageNumber=1,K(),e.standardList=l.sortStandardInfoMapByPercentageOrder(e.standardInfoMapByStandardId,e.scoreSortedByDesc),e.standardReportPage=l.getReportPage(e.reportParameters.pageNumber,e.reportParameters.pageSize,e.standardList),e.scoreSortLabel=e.scoreSortedByDesc?n("masteryByStandard.columnHeader.scoreLowToHigh"):n("masteryByStandard.columnHeader.scoreHighToLow"),e.updateSortFieldStandardIndex(),Q(),H()};var et=function(e){var t=[];return _.times(e,function(){var e=tt();t.push(e)}),t},tt=function(){var e="dummy-standandard-id-"+_.random(100,1e3),t={standardId:e,standardFullTerm:null,standardCode:null,description:null,spanishDescription:null,title:null,stateCode:null,standardTerm:null,percentageOfStudentsMastered:null,studentsMasteredCount:null,totalStudentsCount:null,displayOrder:-1,mastered:!1,assessed:!1};return t}}]),angular.module("Realize.reporting.MasteryByStandardReport",["Realize.paths","Realize.user.currentUser","Realize.assignment.facadeService","Realize.standard.constants","webStorageModule"]).service("MasteryByStandardReport",["$http","$log","$q","$filter","REST_PATH","MASTERY_THRESHOLD","User","$window","RealizeHelpers","AssignmentFacadeService","STANDARD_CONSTANTS","webStorage",function(e,t,n,r,s,a,i,o,l,c,u,d){"use strict";var m,g,p={},f="masteryStandardFilters",h="standardMasteryByClass";p.getReport=function(t,n,r){var a,i=[s,"/classes/",t,"/mastery/standards"].join("");a=n||{};var o;return o=n.isAllAssignment?n.isAllContentCategory?_.pick(a,["programName","standardsLibraryFullPath"]):_.pick(a,["programName","standardsLibraryFullPath","contentCategory"]):_.pick(a,["programName","standardsLibraryFullPath","assignmentIds"]),e.get(i,{params:o}).then(function(e){var t=e.data;return t.statusCode=e.status,v(t),t},function(n){if(n.data.errorMessage===u.STANDARD_ERROR_MESSAGE){var s=d.get(u.STANDARD_MASTERY_BY_CLASS+"."+r+"."+t);return c.resetlocalStorageData(s,r,t),e.get(i,{params:_.pick(a,["programName","standardsLibraryFullPath"])}).then(function(e){var t=e.data;return t.statusCode=e.status,v(t),t})}throw n})};var v=function(e){var t=p.ELLIPSES_NAME;e&&e.studentInfoList&&_.each(e.studentInfoList,function(e){e.lastFirst=e.lastName+(e.firstName?", "+e.firstName:""),e.ellipsesName=r("ellipses")(e.lastFirst,t)})};return p.getIndividualStudentReport=function(r,i,o){var l=[s,"/classes/",r,"/mastery/standards/students/",i].join(""),c=o||{},u={},d={};return e.get(l,{params:_.pick(c,["programName","standardsLibraryFullPath"])}).then(function(e){if(u=e.data,d=_.findWhere(u.studentInfoList,{studentId:i})){u.hasStudentRecord=!0;var t=d.standardInfoMapByStandardId;_.each(u.standardInfoMapByStandardId,function(e){var n=t[e.standardId];n?(n.isTested=!0,n.percentAsDecimal=n.pointsAchieved/n.pointsPossible,n.isStandardMastered=n.percentAsDecimal>=a,n.studentSubmittedDate=moment(n.lastTestedDate).format("MM/DD/YY"),e.studentRecord=n):e.studentRecord={isTested:!1}})}else u.hasStudentRecord=!1;return u},function(e){return 404===e.status?(u.hasStudentRecord=!1,u):(t.error("error getting student report",e),n.reject("error getting student report",e))})},p.getReportPage=function(e,t,n){var r,s=(e-1)*t,a=s+t;return a>n.length&&(a=n.length),r=n.slice(s,a),{startIndex:s,endIndex:a,total:n.length,totalPages:Math.ceil(n.length/t),pageNumber:e,pageSize:t,list:r}},p.saveFilterOptions=function(e,t,n){var r=e.getAttribute(f)||{};r[t]=n,e.setAttribute(f,r)},p.getSavedFilterOptions=function(e,t){var n={},r=d.get(h+"."+e.userId+"."+t)||{};if(r.programName)n.programName=r.programName,n.standardsLibraryFullPath=r.standardsLibraryFullPath,n.standards=r.standards,n.contentCategory=r.contentCategory,n.assignmentId=r.assignmentId,n.assignmentTitle=r.assignmentTitle,n.isAllStandards=r.isAllStandards,n.isAllContentCategory=r.isAllContentCategory,n.isAllAssignment=r.isAllAssignment,this.saveAssignmentIds(n,r);else{var s=e.getAttribute(f);s&&(n=s[t]||{})}return n},p.saveAssignmentIds=function(e,t){angular.isDefined(t.assignmentIds)&&t.assignmentIds.length>0&&(e.assignmentIds=Object.values(t.assignmentIds).join(","))},p.saveStandardPageNumber=function(e,t){g=t,m=e},p.getSavedStandardPageNumber=function(e){return m===e?g:(this.saveStandardPageNumber(e,1),1)},p.mockStudentUserFromReportData=function(e,t){var n=angular.extend({},e);return n.firstAndLast=n.firstName+" "+n.lastName,n.lastFirst=n.lastName+", "+n.firstName,n.userId=n.studentId,n.removed=!0,p.removedStudent=n,p.removedStudentClassId=t,n},p.getRemovedStudent=function(e){return e!==p.removedStudentClassId&&(delete p.removedStudentClassId,delete p.removedStudent),p.removedStudent},p.exportClassReport=function(e,t){return p.export(e,"mastery/standards/export",t)},p.exportIndividualReport=function(e,t,n){var r=["mastery/standards/students/",t,"/export"].join("");return p.export(e,r,n)},p.export=function(e,t,n){var r=[s,"classes",e,t].join("/");r=l.buildUrl(r,n),i.getCurrentUser().then(function(){o.open(r,"_blank")})},p.sortStandardInfoMapByPercentageOrder=function(e,t){var n=_.chain(e).toArray().sortBy(function(e){return e.displayOrder}).sortBy(function(e){return e.percentageOfStudentsMastered}).value();return t&&n.reverse(),_.chain(n).toArray().sortBy(function(e){return!e.assessed}).value()},p.nameComparator=function(e,t){var n;return n=angular.lowercase(e.lastFirst)<angular.lowercase(t.lastFirst)?-1:1},p.percentComparator=function(e,t,n){var r;return r=e.percentageMasteredForStandardsLibrary===t.percentageMasteredForStandardsLibrary&&n?angular.lowercase(e.lastFirst)<angular.lowercase(t.lastFirst)?-1:1:e.percentageMasteredForStandardsLibrary!==t.percentageMasteredForStandardsLibrary||n?e.percentageMasteredForStandardsLibrary<t.percentageMasteredForStandardsLibrary?-1:1:angular.lowercase(e.lastFirst)>angular.lowercase(t.lastFirst)?-1:1},p.standardComparator=function(e,t,n){if(!p.hasRequiredDataToSort(e)||!p.hasRequiredDataToSort(t))return 0;var r=e.standardInfoMapByStandardId[n],s=t.standardInfoMapByStandardId[n],a=void 0!==r?r.pointsAchieved/r.pointsPossible:Number.NEGATIVE_INFINITY,i=void 0!==s?s.pointsAchieved/s.pointsPossible:Number.NEGATIVE_INFINITY;return i>a?-1:1},p.hasRequiredDataToSort=function(e){var t=!e||!e.standardInfoMapByStandardId;return!t},p.ELLIPSES_NAME=18,p}]),angular.module("Realize.reporting.data.masteryByStandardsFilters",["Realize.reporting.MasteryByStandardReport"]).directive("masteryByStandardsFilters",["$log","$rootScope","MasteryByStandardReport",function(e,t,n){"use strict";return{templateUrl:"templates/reporting/data/masteryByStandardsFilters/masteryByStandardsFilters.html",restrict:"A",scope:{isFilterByStudent:"=?displayStudentFilter",studentId:"=?",classRosterData:"=",masteryStandardData:"="},link:function(e){var r=e.classRosterData.classId,s=n.getSavedFilterOptions(t.currentUser,r),a=function(){if(e.isFilterByStudent){var t=n.getRemovedStudent(r);e.studentList=angular.isDefined(t)?[t].concat(e.classRosterData.students):e.classRosterData.students,e.selectedStudent=_.findWhere(e.studentList,{userId:e.studentId})}e.programList=e.masteryStandardData.programNames,e.standardLibraries=e.masteryStandardData.standardLibraries,e.programName=e.masteryStandardData.selectedProgramName,e.selectedLibrary=_.findWhere(e.standardLibraries,{standardFullTerm:e.masteryStandardData.selectedStandardLibraryId})},i=function(){o();var t={selectedStudent:e.selectedStudent,programName:e.programName,selectedLibrary:e.selectedLibrary};e.$emit("masteryStandard.filters.updated",t)},o=function(){s.programName=e.programName,s.standardsLibraryFullPath=e.selectedLibrary&&e.selectedLibrary.standardFullTerm?e.selectedLibrary.standardFullTerm:null,n.saveFilterOptions(t.currentUser,r,s)};e.selectStudent=function(t){e.selectedStudent!==t&&(e.selectedStudent=t,i())},e.selectProgram=function(t){e.programName!==t&&(e.programName=t,e.selectedLibrary=null,i())},e.selectStandard=function(t){e.selectedLibrary!==t&&(e.selectedLibrary=t,i())},e.$watch("masteryStandardData",function(){a()},!0)}}}]),angular.module("Realize.admin.ltiConsumer.common.LTIConsumerSettingForm",["Realize.paths","Realize.admin.ltiConsumer.common.LTIConsumerSettingsSvc","Realize.admin.ltiConsumer.common.LTIConsumerSettingModel","Realize.ui.modal.UnsavedChangesModal","RealizeDirectives"]).directive("ltiConsumerSettingForm",["PATH",function(e){"use strict";return{restrict:"EA",templateUrl:[e.TEMPLATE_CACHE,"admin","ltiConsumer","common","ltiConsumerSettingForm","ltiConsumerSettingForm.dir.html"].join("/"),controller:"LTIConsumerSettingFormCtrl",controllerAs:"ltiSettingFormCtrl",scope:{onSave:"&",onSaveError:"&",consumerSetting:"=",formDelegate:"="}}}]).controller("LTIConsumerSettingFormCtrl",["$rootScope","$scope","$q","lwcI18nFilter","LTIConsumerSettingsSvc","LTIConsumerSettingModel","UnsavedChangesModal","$location","LTIMaxLengths",function(e,t,n,r,s,a,i,o,l){"use strict";function c(){t.settingForm&&t.settingForm.$setDirty()}var u=this,d={INVALID_DOMAIN:{formField:"settingDomain",error:"pattern"},DUPLICATE_DOMAIN:{formField:"settingDomain",error:"duplicate"},DUPLICATE_CONFIGURATION_NAME:{formField:"settingName",error:"duplicate"},INVALID_CONFIGURATION_KEY:{formField:"settingKey",error:"pattern"},INVALID_CONFIGURATION_SECRET:{formField:"settingSecret",error:"pattern"}};u.maxCustomFieldChars=l.maxCustomFieldLength,u.editMode="/admin/patools/ltiConsumer/manage"===o.path(),u.soCloseAlert={autoClose:!1,type:"error",icon:"exclamation-sign",msg:r("ltiConsumerAdmin.validations.soCloseAlert")},u.setting=angular.isDefined(t.consumerSetting)?angular.copy(t.consumerSetting):new a,u.uiState={isCreate:!angular.isDefined(t.consumerSetting),isSubmitting:!1,showAlert:!1,get shouldShowFormErrors(){return t.settingForm.$dirty&&!u.uiState.canSubmit&&!u.uiState.isSubmitting},get canSubmit(){return u.setting.hasAllRequiredFields()&&u.setting.hasValidKey()&&u.setting.hasValidSecret()&&u.setting.hasValidDomain()&&!(s.hasSettingForDomain(u.setting.domain,u.setting.configurationUuid)||s.hasSettingNamedSame(u.setting.name,u.setting.configurationUuid)||u.setting.hasDuplicateCustomFields()||u.setting.hasIncompleteCustomFields()||u.setting.hasCustomFieldWithReservedKeyword())}},angular.isDefined(t.formDelegate)&&Object.defineProperty(t.formDelegate,"isDirty",{get:function(){return t.settingForm.$dirty}}),u.privacyLevelOpts=s.privacySettings,u.setPrivacyLevel=function(e){u.setting.privacyLevel=e.value,u.setting.privacyLevelLabel=e.label,c()},u.addCustomField=function(){u.setting.addCustomField();var e=u.setting.customFields.length-1;u.setCustomField(u.setting.customFields[e],"PROGRAM_NAME","",e)},u.customFieldOpts=s.custom().then(function(e){if(u.customFieldOpts=e,u.customFieldOptskeys=Object.keys(u.customFieldOpts),u.editMode){var t=u.setting.customFields;u.setting&&t&&angular.forEach(t,function(e,t){if(e.showInput="PROGRAM_NAME"!==e.value,!e.showInput){var n=u.customFieldOpts[e.value];u.setting.customFieldLabel[t]=n}})}}),u.setting.customFieldLabel={},u.setCustomField=function(e,t,n,r){e.showInput="PROGRAM_NAME"!==t,e.showInput?e.value="":(e.value=t,u.setting.customFieldLabel[r]=u.customFieldOpts[t]),c()
},u.clearDropdown=function(e,t){t&&(t.showInput=!1),delete u.setting.customFieldLabel[e],u.setting.customFields&&u.setting.customFields[e]&&u.setCustomField(u.setting.customFields[e],"PROGRAM_NAME","",e)},u.removeCustomFieldAt=function(e){u.setting.removeCustomFieldAt(e),c()},u.uiState.isCreate&&u.setPrivacyLevel(u.privacyLevelOpts.filter(function(e){return"NONE"===e.value})[0]),u.saveSetting=function(e){if(!t.settingForm.$dirty)return!1;if(u.uiState.canSubmit){u.uiState.isSubmitting=!0;var r=u.uiState.isCreate?s.add(u.setting):s.update(u.setting);if(r.catch(function(e){t.onSaveError&&angular.isFunction(t.onSaveError)&&t.onSaveError({error:e.data});var n=d[e.data.errorMessage];angular.isDefined(n)?t.settingForm[n.formField].$setValidity(n.error,!1):(u.alertDetails={autoClose:!1,type:"error",icon:"exclamation-sign",msg:u.soCloseAlert.msg},u.uiState.showAlert=!0,u.uiState.isSubmitting=!1)}),e){var a=n.defer();return r.then(function(){a.resolve()}),r.catch(function(){a.reject("Error saving")}),a.promise}r.then(function(){t.onSave&&angular.isFunction(t.onSave)&&t.onSave({setting:u.setting})})}else{if(e)return n.reject("Invalid Form Data");u.alertDetails=u.soCloseAlert,u.uiState.showAlert=!0,t.onSaveError&&angular.isFunction(t.onSaveError)&&t.onSaveError()}};var m=t.$watch(function(){return t.settingForm.$dirty},function(){t.settingForm.$dirty&&(t.$emit("ltiConsumerSettingForm.dirtied"),m())});t.$watch(function(){return u.setting},function(e,n){angular.isDefined(n)&&t.settingForm.$dirty&&e!==n&&(t.settingForm.settingKey.$setValidity("pattern",u.setting.hasValidKey()),t.settingForm.settingSecret.$setValidity("pattern",u.setting.hasValidSecret()),t.settingForm.settingDomain.$setValidity("pattern",u.setting.hasValidDomain()),t.settingForm.settingDomain.$setValidity("duplicate",!s.hasSettingForDomain(u.setting.domain,u.setting.configurationUuid)),t.settingForm.settingName.$setValidity("duplicate",!s.hasSettingNamedSame(u.setting.name,u.setting.configurationUuid)))},!0),t.$on("ltiConsumerSettingForm.submit",function(){u.saveSetting()}),u.unsavedChangesModal=new i(u.saveSetting.bind(u,!0));var g=e.$on("$locationChangeStart",function(n){t.settingForm.$dirty&&!u.uiState.isSubmitting&&(u.unsavedChangesModal.showDialog(n),e.viewLoading=!1)});t.$on("$destroy",g)}]),angular.module("Realize.calendar.calendarEventCtrl",["RealizeDataServices","Realize.common.alerts","rlzComponents.components.i18n","Realize.assignment.utilService","Realize.calendar.calendarService","Realize.calendar.calendarEvent"]).controller("CalendarEventCtrl",["$scope","$location","CalendarService","CurrentRoster","myCalendarEvent","$routeParams","ClassRosters","lwcI18nFilter","AlertService","GroupData","AssignmentUtil",function(e,t,n,r,s,a,i,o,l,c,u){"use strict";e.item=s,e.roster=r;var d=e.item.assignedTo,m=r.classId,g=u.getAssigneeIdsFromItemAssignedToCollection(d,m);e.assigneeList=u.getAssigneeList(g,r,c),e.isTimedOrAllDay=s.isTimed()||s.isAllDay(),e.timesForDisplay=n.formatEventTimes(s),e.openTeacherPreview=n.openTeacherPreview,e.open=function(e,n){e.preventDefault(),e.stopPropagation();var r=t.path();t.path([r,"content",n.id,n.version].join("/"))},e.back=function(e){e.stopPropagation(),e.preventDefault();var n=t.path(),r=n.split("/calendar/")[0]+"/calendar";t.path(r)};var p=function(){e.serverError=!0};e.remove=function(){e.item.remove(a.classId).then(function(){e.item.isRemoved=!0},p)},e.undoRemove=function(){e.item.undoRemove(a.classId).then(function(){e.item.isRemoved=!1},p)};var f=function(){return _.pluck(e.item.assignedTo,"classUuid")};e.isTimedOrAllDay&&(e.editEventModal={preSelectedClassIds:f(),classRosters:_.map(i,function(e){return _.pick(e,"className","classId")})}),e.$on("calendar.editSuccess",function(){n.getEventDetails(a.itemId).then(function(t){var r=["<strong>",o("calendar.itemDetails.editEvent.successNotification.title"),"</strong>",o("calendar.itemDetails.editEvent.successNotification.message")].join(" ");l.addAlert("success","ok-sign",r),e.alertDetails=l.alerts[0],e.alertIsSet=l.alertIsSet(),e.item=t,e.timesForDisplay=n.formatEventTimes(t),e.editEventModal.preSelectedClassIds=f()})}),e.$on("calendar.editFailed",function(){var t="calendar.itemDetails.editEvent.errorNotification.generic.message",n=o(t);l.addAlert("error","exclamation-sign",n),e.alertDetails=l.alerts[0],e.alertIsSet=l.alertIsSet()})}]),angular.module("Realize.calendar.calendarEvent",["Realize.filters.ellipses","Realize.paths","Realize.content"]).factory("CalendarEvent",["$rootScope","$filter","Content","$log","$http","PATH","$q",function(e,t,n,r,s,a,i){"use strict";function o(e){var t={id:"",start:"",end:"",title:"",className:"",contentItem:"",url:" javascript://",fullTitle:e.title,parsedStart:$.fullCalendar.parseISO8601(e.start),parsedEnd:$.fullCalendar.parseISO8601(e.end)};if(angular.extend(t,e),t.title=l(e.title),e.eventType===c.ASSIGNMENT?(t.start=e.end,t.parsedStart=$.fullCalendar.parseISO8601(t.start),t.className="assignment-content"):t.className="event-content",t.contentItem){var r=new n(t.contentItem);angular.extend(r,t.contentItem),r.planningMaterialItems=Object.keys(r.planningMaterialItems||{}).map(function(e){var t=r.planningMaterialItems[e],s=new n(t);return angular.extend(s,t),s}),t.contentItem=r}angular.extend(this,t)}var l=function(n){var r=15,s=25;if("month"===e.currentUser.getAttribute("classCalendar.view")){var a=e.currentUser.getAttribute("classCalendar.showWeekends")?r:s;return t("ellipses")(n,a)}return n},c={ASSIGNMENT:"ASSIGNMENT",TIMED:"TIMED",ALL_DAY:"ALL_DAY"};return o.EVENT_TYPE=c,o.prototype.updateTruncatedTitle=function(){var e=this;e.title=l(e.fullTitle)},o.prototype.create=function(){var e=this,t=a.REST+"/events";return e.title=e.fullTitle,s.post(t,e).then(function(e){return e},function(e){return r.error(e),i.reject("Failed to create event: ",e)})},o.prototype.edit=function(e){var t=this,n=[a.REST,"events",e].join("/");return t.title=t.fullTitle,delete t.assignedTo,s.post(n,t).then(function(e){return e},function(e){return r.error(e),i.reject("Failed to edit event: ",e)})},o.prototype.remove=function(e){var t=this,n=[a.REST,"events",t.id,"assignees","classes",e].join("/");return s({method:"DELETE",url:n}).then(function(e){return e},function(e){return r.error(e),i.reject("Failed to remove event: ",e)})},o.prototype.undoRemove=function(e){var t=this,n=[a.REST,"events",t.id,"assignees","classes",e].join("/");return s.put(n).then(function(e){return e},function(e){return r.error(e),i.reject("Failed to undo remove event: ",e)})},o.prototype.isAssignment=function(){var e=this;return e.eventType===o.EVENT_TYPE.ASSIGNMENT},o.prototype.isTimed=function(){var e=this;return e.eventType===o.EVENT_TYPE.TIMED},o.prototype.isAllDay=function(){var e=this;return e.eventType===o.EVENT_TYPE.ALL_DAY},o}]),angular.module("Realize.calendar.calendarEventModal",["ModalServices","rlzComponents.components.i18n","realize.core.isoDateService","Realize.paths","RealizeDataServices","RealizeApp","Realize.calendar.calendarService","Realize.calendar.calendarEvent"]).directive("calendarEventModal",["$log","Modal","lwcI18nFilter","CalendarEvent","CalendarService","$routeParams","ISODateService","RangeDatepickerOptions","DatepickerUtil","PATH",function(e,t,n,r,s,a,i,o,l,c){"use strict";return{link:function(u,d,m){var g,p=null,f=[d];g=function(d){if(d.preventDefault(),d.stopPropagation(),p=u.$new(!0),!m.mode||!m.classRosters||!m.preSelectedClassIds)return e.error("calendarEventModal.dir - Missing Attribute!");p.mode=m.mode,p.hours=s.getHours(),p.startTime=p.endTime=p.hours[0];var g=function(){p.hourIsDisabled(p.hours.indexOf(p.endTime))&&(p.endTime=p.startTime)};p.hourIsDisabled=function(e){var t=p.event&&p.event.startDate===p.event.endDate,n=e<p.hours.indexOf(p.startTime);return t&&n},p.selectStartTime=function(e){p.startTime=e,g()},p.selectEndTime=function(e){p.endTime=e};var h=new o("#start-date","#end-date");p.startDatepickerOptions=h.start,p.endDatepickerOptions=h.end;var v=function(){p.$evalAsync(g)};p.startDatepickerOptions.$setOnSelect(v),p.endDatepickerOptions.$setOnSelect(v),p.startDatepickerOptions.$setBeforeShow(function(){var e=angular.element("#start-date").datepicker();e.on("keydown",function(e){l.customizedKeydownEventForDatepicker(e,"#start-date")}),f.push(e)}),p.endDatepickerOptions.$setBeforeShow(function(){var e=angular.element("#end-date").datepicker();e.on("keydown",function(e){l.customizedKeydownEventForDatepicker(e,"#end-date")}),f.push(e)}),p.classRosters=angular.copy(u.$eval(m.classRosters));var S=u.$eval(m.preSelectedClassIds);p.preSelectedClassRosters=_.filter(p.classRosters,function(e){return _.contains(S,e.classId)}),p.typeAndSelectConfig={results:p.classRosters,formText:{mainLabel:n("calendar.eventForm.chooseClasses.label"),help:n("calendar.eventForm.chooseClasses.help"),noMatch:n("calendar.eventForm.chooseClasses.alert.noMatch"),submitError:n("calendar.eventForm.chooseClasses.alert.missingClasses"),addAllLabel:n("calendar.eventForm.chooseClasses.addAllClasses"),offScreenRemove:n("calendar.eventForm.chooseClasses.removeClass.a11y"),placeholder:n("calendar.eventForm.chooseClasses.placeholder")},isAddAllEnabled:!0,isFormSubmitted:function(){return p.savePressed},customFilter:function(e){return{className:e}},preSelectedItems:p.preSelectedClassRosters,hideRemoveIcon:function(e){return"edit"===p.mode&&e.preSelected}},p.popupMatchTmplUrl=c.TEMPLATE_CACHE+"/app/classes/calendar/calendarEvent/calendarEventModalTypeaheadMatch.html",p.selectedItemTmplUrl=c.TEMPLATE_CACHE+"/app/classes/calendar/calendarEvent/calendarEventModalSelectedItem.html",p.close=function(){t.hideDialog(),p.$destroy()},p.saveEvent=function(){p.savePressed=!0;var e=s.getSelectedClassIds(p.classRosters);if(p.eventForm.$valid&&e.length>0){p.isInProgress=!0,p.event.selectedClasses=e;var t=p.event.startDate,n=p.event.endDate;p.event.allDay?(p.event.eventType="ALL_DAY",p.event.start=i.toDateString(new Date(t)),p.event.end=i.toDateString(new Date(n))):(t+=" "+p.startTime,n+=" "+p.endTime,p.event.eventType="TIMED",p.event.start=i.toDateTimeString(new Date(t)),p.event.end=i.toDateTimeString(new Date(n)));var o;if("create"===p.mode){var l=new r(p.event);o=l.create()}else"edit"===p.mode&&(o=p.event.edit(a.itemId));var c=function(e){p.$emit("calendar."+p.mode.toLowerCase()+e),p.inProgress=!1,p.close()};o.then(function(){c("Success")},function(){c("Failed")})}},t.showDialog(c.TEMPLATE_CACHE+"/app/classes/calendar/calendarEvent/calendarEventModal.html",p).then(function(){if("edit"===p.mode){p.event=angular.copy(u.$eval(m.existingEvent));var e=function(e){var t=e.getHours();return p.hours[t]};p.selectStartTime(e(p.event.parsedStart)),p.selectEndTime(e(p.event.parsedEnd)),p.event.allDay=p.event.isAllDay(),p.event.startDate=p.event.parsedStart.toString("MM/dd/yyyy"),p.event.endDate=p.event.parsedEnd.toString("MM/dd/yyyy")}}),u.$evalAsync()},d.on("click",g),u.$on("$destroy",function(){f.forEach(function(e){e.off()}),f=null})}}}]),angular.module("Realize.calendar.eventSource",["Realize.calendar.calendarService"]).factory("EventSource",["$rootScope","CalendarService",function(e,t){"use strict";function n(e,t){a(e);var n=i(e,[],t||new Date),r={events:n.visibleEvents,hiddenEvents:n.hiddenEvents};angular.copy(r,this)}var r=function(e,n){var r=e.parsedStart.clone(),s=e.parsedEnd.clone(),a=t.getMonthViewRange(n);r.getTime()<a.firstSunday.getTime()&&(r=a.firstSunday),s.getTime()>a.lastSaturday.getTime()&&(s=a.lastSaturday);var i=1;if(r.getMonth()===s.getMonth())i+=s.getDate()-r.getDate();else{var o=new Date(r.getFullYear(),r.getMonth()+1,0),l=o.getDate()-r.getDate(),c=s.getDate();i+=l+c}e.calendarCells=i},s=function(e,t){return _.each(e,function(e){r(e,t)}),_.sortBy(e,function(e){return-1*e.calendarCells})},a=function(e){var t=function(e){return"ASSIGNMENT"===e.eventType},n=_.filter(e,t);_.each(n,function(e){var t="T00:00:00",n="T23:59:59";e.start=e.start.replace(t,n),e.end=e.start.replace(t,n)})},i=function(n,r,a){if("month"===e.currentUser.getAttribute("classCalendar.view")){var i=[],o=[],l={},c=t.getMonthViewRange(a),u=s(n,a),d=15;return _.each(u,function(e){var t=e.parsedStart.clone();t.getTime()<c.firstSunday.getTime()&&(t=new Date(c.firstSunday));var n,r=!1;for(n=0;n<e.calendarCells;n++){var s=t.toString("yyyy-MM-dd");l[s]?l[s]++:l[s]=1,l[s]>d&&(r=!0,o.push(e)),t.add(1).days()}r||i.push(e)}),{visibleEvents:i,hiddenEvents:o}}return{visibleEvents:n.concat(r),hiddenEvents:[]}};return n.prototype.truncateEventTitles=function(){var e=this;angular.forEach(e.events,function(e){e.updateTruncatedTitle()})},n.prototype.updateVisibleEvents=function(e){var t=this,n=i(t.events,t.hiddenEvents,e);t.events=n.visibleEvents,t.hiddenEvents=n.hiddenEvents},n}]),angular.module("Realize.adaptiveHomework.adaptiveHomeworkCtrl",["rlzComponents.components.i18n","Realize.user.currentUser","Realize.common.alerts"]).controller("AdaptiveHomeworkCtrl",["$scope","lwcI18nFilter","$currentUser","$location","AdaptiveHomeworkData",function(e,t,n,r,s){"use strict";var a=this;a.currentUser=n,a.adaptiveHomeworkData=s,e.$on("assignmentModal.alert.toggle",function(t,n){e.$evalAsync(function(){a.alertDetails=n.alertDetails,a.alertIsSet=n.show})}),a.firstVisit={showAlert:!a.currentUser.getAttribute("adaptiveHomework.info.seen"),title:t("adaptiveHomework.firstVisit.title"),description:t("adaptiveHomework.firstVisit.description"),instruction:t("adaptiveHomework.firstVisit.instruction",void 0,!0),closeFn:function(){a.currentUser.setAttribute("adaptiveHomework.info.seen",!0),a.firstVisit.showAlert=!1}},a.showAssignLink=function(){return a.adaptiveHomeworkData.$isAssignable()&&!a.currentUser.isStudent&&-1===r.path().indexOf("classes")},a.back=function(t){t.stopPropagation();var n,s=r.path();n=s.split("/adaptivehomework/")[0],e.goBack(n,!0)},angular.element("html, body").animate({scrollTop:0},0)}]),angular.module("Realize.adaptiveHomework",["Realize.adaptiveHomework.adaptiveHomeworkCtrl","Realize.adaptiveHomework.routes"]),angular.module("Realize.adaptiveHomework.routes",["Realize.content.contentResolver","Realize.paths","Realize.user.currentUser"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n=["$q","$currentUser",function(e,t){var n=t.hasRole("ROLE_TEACHER");return n?e.when(1):e.reject("Insufficient Privileges!")}],r={controller:"AdaptiveHomeworkCtrl",controllerAs:"adaptiveHomeworkCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/adaptiveHomework/adaptiveHomework.ctrl.html",resolve:{_security:n,AdaptiveHomeworkData:["ContentResolver",function(e){return e()}]}};e.when("/program/:programId/:programVersion/adaptivehomework/:itemId/:itemVersion",r).when("/program/:programId/:programVersion/lesson/:lessonId/:lessonVersion/adaptivehomework/:itemId/:itemVersion",r).when("/program/:programId/:programVersion/tier/:itemId/:itemVersion/lesson/:lessonId/:lessonVersion/adaptivehomework/:itemId/:itemVersion",r).when("/program/:programId/:programVersion/tier/:tierId/:tierVersion/tier2/:itemId/:itemVersion/lesson/:lessonId/:lessonVersion/adaptivehomework/:itemId/:itemVersion",r).when("/program/:programId/:programVersion/tier/:itemId/:itemVersion/adaptivehomework/:itemId/:itemVersion",r).when("/program/:programId/:programVersion/tier/:tierId/:tierVersion/tier2/:itemId/:itemVersion/adaptivehomework/:itemId/:itemVersion",r).when("/search/adaptivehomework/:itemId/:itemVersion",r).when("/program/:programId/:programVersion/resources/adaptivehomework/:itemId/:itemVersion",r).when("/program/:programId/:programVersion/standards/lastSelectedGrade/:lastSelectedGrade/search/:stateStandard/:nationalLibrary/adaptivehomework/:itemId/:itemVersion",r).when("/classes/:classId/assignments/:assignmentId/preview/adaptivehomework/content/:itemId/:itemVersion",r).when("/classes/:classId/assignments/:assignmentId/allstudents/preview/adaptivehomework/content/:itemId/:itemVersion",r).when("/myLibrary/adaptivehomework/:itemId/:itemVersion",r).when("/myLibrary/lesson/:lessonId/:lessonVersion/adaptivehomework/:itemId/:itemVersion",r).when("/myLibrary/tier/:itemId/:itemVersion/lesson/:lessonId/:lessonVersion/adaptivehomework/:itemId/:itemVersion",r).when("/myLibrary/tier/:tierId/:tierVersion/tier2/:itemId/:itemVersion/lesson/:lessonId/:lessonVersion/adaptivehomework/:itemId/:itemVersion",r).when("/myLibrary/tier/:itemId/:itemVersion/adaptivehomework/:itemId/:itemVersion",r).when("/myLibrary/tier/:tierId/:tierVersion/tier2/:itemId/:itemVersion/adaptivehomework/:itemId/:itemVersion",r).when("/myLibrary/playlist/:playlistId/adaptivehomework/:itemId/:itemVersion",r).when("/search/playlist/:playlistId/adaptivehomework/:itemId/:itemVersion",r).when("/browseAll/playlist/:playlistId/adaptivehomework/:itemId/:itemVersion",r)}]),angular.module("Realize.assessment",["Realize.assessment.assessmentCreateCtrl","Realize.assessment.assessmentBuilderCtrl","Realize.assessment.assessmentBuilderServiceInterface","Realize.assessment.assessmentDataService","Realize.assessment.customizeAssessmentDirective","Realize.assessment.questionBank","Realize.assessment.routes","Realize.assessment.essayPromptCtrl","Realize.assessment.assessmentInterceptor"]),angular.module("Realize.assessment.routes",["Realize.content.model.contentItem","Realize.content.contentDataService","Realize.paths"]).config(["$routeProvider","PATH","$httpProvider",function(e,t,n){"use strict";n.interceptors.push("AssessmentInterceptor");var r=["$q","$currentUser",function(e,t){var n=t.hasRole("ROLE_TEACHER");return n?e.when(1):e.reject("Insufficient Privileges!")}],s={controller:"BuilderCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/assessment/assessmentEdit.html",resolve:{_security:r,CurrentProgramLoaded:["Resolve",function(e){return e.CurrentProgramLoaded()}],BuilderData:["Resolve",function(e){return e.AssessmentBuilder()}]}},a={controller:"BuilderCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/assessment/assessmentEdit.html",resolve:{_security:r,CurrentProgramLoaded:["Resolve",function(e){return e.CurrentProgramLoaded()}],BuilderData:["Resolve",function(e){return e.UserCreatedAssessment()}]}},i={controller:"AssessmentCreateCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/assessment/create/create.ctrl.html",resolve:{_security:r,BankPlayerTargetMap:["Resolve","$rootScope","ContentDataService",function(e,t,n){return e.CurrentProgramLoaded().then(function(){return n.getAvailableBankPlayerTargetMap(t.currentProgram.library)})}],ProgramListInfo:function(){}}},o={controller:"AssessmentCreateCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/assessment/create/create.ctrl.html",resolve:{_security:r,ProgramListInfo:["Resolve",function(e){return e.ProgramListInfo()}],BankPlayerTargetMap:function(){}}},l={controller:"EssayPromptCtrl",controllerAs:"essayPromptCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/assessment/essay/essayPrompt.ctrl.html",resolve:{_security:r,BankPlayerTargetMap:["Resolve","$rootScope","ContentDataService",function(e,t,n){return e.CurrentProgramLoaded().then(function(){return n.getAvailableBankPlayerTargetMap(t.currentProgram.library)})}],resolveEssayPromptBuilder:function(){return{isNewTest:!0}}}},c={controller:"EssayPromptCtrl",controllerAs:"essayPromptCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/assessment/essay/essayPrompt.ctrl.html",resolve:{_security:r,resolveEssayPromptBuilder:["Resolve",function(e){return e.EssayPromptAssessment()}]}},u={controller:"EssayPromptCtrl",controllerAs:"essayPromptCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/assessment/essay/essayPrompt.ctrl.html",resolve:{_security:r,resolveEssayPromptBuilder:["$q",function(e){return e.when({isNewTest:!0})}]}},d={controller:"AssessmentAddQuestionBankCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/assessment/questionBank/addQuestionBank/addQuestionBank.ctrl.html",resolve:{_security:r,CurrentProgramLoaded:["Resolve",function(e){return e.CurrentProgramLoaded()}],AssessmentInfo:["Assessment","$q","$route",function(e,t,n){var r=n.current.params.itemId,s=n.current.params.itemVersion;return e.getInfo(r,s).then(function(e){return e.nativeAssessment?t.reject("Cannot add non-native question bank to native test",e):(n.current.params.insertPosition&&(e.insertPosition=n.current.params.insertPosition),e.itemId=r,e)})}],StandardsTreeData:["$route","Content",function(e,t){return t.getQuestionBankStandards(e.current.params.programId,e.current.params.programVersion)}]}},m="/program/:programId/:programVersion",g="/tier/:tierId/:tierVersion",p=g+"/tier2/:tier2Id/:tier2Version",f="/myLibrary",h=[{route:m,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0},{route:m+g,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0},{route:m+p,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0},{route:m+"/standards/lastSelectedGrade/:lastSelectedGrade/search/:stateStandard",supportsMyContent:!1,supportsLessons:!0,supportsGeneralUrls:!0},{route:m+"/standards/lastSelectedGrade/:lastSelectedGrade/search/:stateStandard/:nationalLibrary",supportsMyContent:!1,supportsLessons:!0,supportsGeneralUrls:!0},{route:"/search",supportsMyContent:!1,supportsLessons:!0,supportsGeneralUrls:!0},{route:"/search/standard/:stateStandard",supportsMyContent:!1,supportsLessons:!0,supportsGeneralUrls:!0},{route:m+"/resources",supportsMyContent:!1,supportsLessons:!0,supportsGeneralUrls:!0},{route:f,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0},{route:f+g,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0},{route:f+p,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0}];angular.forEach(h,function(t){var n=t.route,r=n+"/lesson/:lessonId/:lessonVersion";t.supportsGeneralUrls&&e.when(n+"/assessment/:itemId/:itemVersion/edit",s).when(n+"/assessment/essay/:itemId/:itemVersion/edit",c).when(n+"/assessment/:itemId/:itemVersion/addQuestionBank/insert/:insertPosition",d),t.supportsMyContent&&e.when(n+"/assessment/create",i).when(n+"/assessment/essayPrompt",l).when(n+"/assessment/:itemId/:itemVersion/edit",a).when(n+"/assessment/:itemId/:itemVersion/addQuestionBank",d).when(n+"/assessment/:itemId/:itemVersion/addQuestionBank/insert/:insertPosition",d).when(n+"/myContent/assessment/create",i).when(n+"/myContent/assessment/:itemId/:itemVersion/edit",a).when(n+"/myContent/assessment/:itemId/:itemVersion/addQuestionBank",d).when(n+"/myContent/assessment/:itemId/:itemVersion/addQuestionBank/insert/:insertPosition",d).when(n+"/myContent/assessment/essay/:itemId/:itemVersion/edit",c).when(f+"/assessment/essay/:itemId/:itemVersion/edit",c).when(f+"/assessment/:itemId/:itemVersion/edit",s).when(f+"/essayPrompt",u).when(f+"/assessment/create",o).when(f+"/program/:programId/:programVersion/assessment/:itemId/:itemVersion/edit",a).when(f+"/program/:programId/:programVersion/assessment/:itemId/:itemVersion/addQuestionBank",d).when(f+"/program/:programId/:programVersion/assessment/:itemId/:itemVersion/addQuestionBank/insert/:insertPosition",d),t.supportsLessons&&e.when(r+"/assessment/:itemId/:itemVersion/edit",s).when(r+"/assessment/:itemId/:itemVersion/addQuestionBank",d).when(r+"/assessment/:itemId/:itemVersion/addQuestionBank/insert/:insertPosition",d)})}]),angular.module("Realize.assessment.assessmentBuilderCtrl",["Realize.common.alerts","Realize.content.model.contentItem","Realize.analytics","Realize.assessment.assessmentDataService","Realize.myContent.myContentDataService","ModalServices","rlzComponents.components.i18n","Realize.paths","Realize.assessment.assessmentBuilderServiceInterface","Realize.assessment.questionsInTestService","Realize.constants.questionType","rlzComponents.components.contentList.service.helper","rlzComponents.components.myLibrary.services.myContent","rlzComponents.components.myLibrary.myLibraryEventTracking"]).controller("BuilderCtrl",["$scope","BuilderData","$rootScope","$routeParams","$location","$window","$log","Analytics","Content","Assessment","MyContent","Modal","lwcI18nFilter","ROOT_PATH","REST_PATH","AssessmentBuilderServiceInterface","InlineAlertService","QuestionsInTestService","QUESTION_TYPE","$q","webStorage","contentListHelperService","myContentService","myLibraryEventTracking",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y){"use strict";function R(t){var n="assessmentBuilder.customizeAssessment."+t+".title",r="assessmentBuilder.customizeAssessment."+t+".message";h.addAlert(e.content.id,{type:"success",msg:["<strong>",m(n),"</strong>",m(r)].join(" ")})}function C(t){t||c.updateEquellaItemTimestamp(e.content.assessmentId),e.content.contribDate=new Date,n.currentProgram&&(n.currentProgram.programDirty=!0),i.debug("saveSuccessHandler"),e.messageSet||(c.isNewTest?(R("success"),e.messageSet=!0):(R("edit"),e.messageSet=!0))}var D,b,P,w,L=/\/search/,O=function(){var t=T.defer();return f.Services.Builder().finalAllChanges(),e.$on("assessmentBuilder.questionCollectionView.putSuccess",function(e,n){t.resolve(n)}),t.promise},N=function(t,n){return e.isEditing?(t&&t.preventDefault(),f.Services.Builder().execute("commitChanges").then(function(){s.path(n)})):"cancel"===e.eventName||e.isSaving?void 0:(t&&t.preventDefault(),e.isSaving=!0,O().then(function(){e.isVersionFromToc&&-1===s.path().indexOf("/myContent")&&A.add("originalItemId",e.content.originalItemId),s.path(n)}))},M=function(e){o.track("track.action",{category:"Programs",action:"Build a test",label:e})},k=function(){return e.isCustomizedVersion()&&e.content.active&&"User"!==e.content.externalSource};e.pageLoading(),e.content=t,e.savedProgram=n.currentProgram,e.assignedStatus=e.content.assignedStatus,e.originalItemId=e.content.originalItemId,e.isAssigned="ASSIGNED"===e.assignedStatus,e.messageType="error",e.isPearsonOriginal="My Uploads"!==e.content.contribSource,e.isAssessmentImmutable=e.isPearsonOriginal,e.isEditing=!1,e.attemptExit=!1,e.titleMax=50,e.printMenuBottom=!1,e.messageSet=!1,e.eventName="done",e.isSaving=!1,e.showPrintButton=!0,e.showReorder=!0,e.removingQuestionslist="",e.isVersionFromToc=!1,c.isNewTest&&(R("success"),e.messageSet=!0),e.getTitle=function(){return"create"===e.mode?m("global.navigation.goBack.a11y"):e.content.title},e.showQuicklinkBar=function(){return"edit"===e.mode},e.isCustomizedPearsonTest=function(){return!e.isPearsonOriginal&&!e.content.userCreated&&e.content.active},e.isCustomizedMyContentTest=function(){return e.content.userCreated&&e.originalItemId},e.isCustomizedVersion=function(){return e.isCustomizedPearsonTest()||e.isCustomizedMyContentTest()},e.isReorderVisible=function(){return e.questionCount>1&&"reorder"!==e.mode&&!e.isAssessmentImmutable&&e.showReorder},e.isPrintVisible=function(){return e.questionCount>0&&e.content.nativeAssessment===!0&&e.showPrintButton},e.showRemoveButton=function(){return k()},e.showViewOriginal=function(){return k()},e.showViewCustomized=function(){return e.content.customizedItem},e.$on("builder:immutable-assessment-loaded",function(){i.log("[builder:immutable-assessment-loaded]"),e.pageLoaded(),e.isAssessmentImmutable=!0}),w=function(t){var n=e.getNextURL();e.$$phase||e.$root&&e.$root.$$phase||e.$apply(),e.$broadcast("preNavigationChange"),!L.test(n)&&t?/\/myContent/.test(n)?s.path(n):s.path(n+"/myContent"):(L.test(n)||(e.isVersionFromToc=!0),e.goBack(n,!0))},e.$on("summary:save:success",function(t,n){e.isEditing=!1,M("Save"),i.debug("[assessment_builder : builder : summary:save:success]",arguments),c.updateEquellaTitleAndDescription(n.id,n.assetTitle,n.assetDescription).then(function(t){var n=!0;e.content.title=t.assetTitle,C(n)})}),e.$on("question:save:success",function(){e.questionSaved=!0,C()}),e.$on("question:remove:success",function(){M("Remove question"),C()}),e.$on("question:reorder:success",function(){C(),P=!1}),e.$on("question:reorder:error",function(){P=!1}),e.$on("question:reorder:before",function(){P=!0}),e.$on("assessment:questionbanks:success",function(){e.questionSaved=!0,C()}),e.$on("builder:assessment-loaded",function(){i.log("[builder:assessment-loaded]"),e.pageLoaded()}),e.$on("builder:assessment-modified",function(){i.info("Assessment modified..."),e.content.active||u.makeDefaultView(e.content.id,!0,!0).then(function(){e.content.active=!0}),D&&D.then(function(){D.progressComplete().then(function(){d.hideDialog()})})}),e.$on("builder:modifying-assessment",function(){i.info("MODIFYING ASSESSMENT"),P||(D=d.progressDialog(e.$new(),{progressHeader:m("assessmentBuilder.updateProgress.title"),progressMessage:m("assessmentBuilder.updateProgress.message")}).then(function(){D.fakeProgress(500)}))}),e.$on("builder:navigation",function(t,n){e.mode=n}),e.$on("builder:question:enterEdit",function(){e.isEditing=!0,M("Edit metadata")}),e.$on("builder:question:leaveEdit",function(){e.isEditing=!1}),n.$on("builder:unauthorized:access",function(){e.$emit("httpSessionTimedOut")}),e.$on("builder:create:cancelled",function(){e.back()}),e.$on("builder.navigate.addQuestionBank",function(t,n){var r=s.path().split("/edit")[0],a=r+"/addQuestionBank/insert/"+n;angular.isDefined(e.content)&&angular.isDefined(e.content.assessmentId)&&c.loadAssessment(e.content.assessmentId).then(function(e){v.setQuestionsInTestCollection(e)},function(e){i.error("Failed to load questions for an assessment",e)}),M("Add items from test bank"),s.path(a)}),e.$on("builder.navigate.exitBuilder",function(t,n){if(e.eventName=n,e.back(t),0===s.path().indexOf("/myLibrary")&&"edit"===n.options.currentMode){var a=r.programId,i=r.programVersion;if(a)return E.getContentTitle({id:a,version:i,level:1}).then(function(e){y.onCreatingTBAT(e)})}}),e.$on("$locationChangeStart",function(e){var t=e.targetScope.location.path();N(e,t)}),e.$on("assessmentBuilder.hidePrintButton.success",function(){e.showPrintButton=!1}),e.$on("assessmentBuilder.showPrintButton.success",function(){e.showPrintButton=!0}),e.$on("assessmentBuilder.get.printList",function(t,n){e.removingQuestionslist=n}),e.$on("assessmentBuilder.hideReorder.success",function(){e.showReorder=!1}),e.$on("assessmentBuilder.unhideReorder.success",function(){e.showReorder=!0}),e.print=function(t,n){f.Services.Builder().getRemovingQuestionsList();var r=f.Services.Builder().execute("commitChanges");r.then(function(){var t="hide=";e.removingQuestionslist.length&&(t+=e.removingQuestionslist),"key"===n?a.open(g+"/assessment/print/"+e.content.assessmentId+"?showAnswers=true&"+t):a.open(g+"/assessment/print/"+e.content.assessmentId+"?"+t)})},e.mode=void 0,e.navigation=function(t){e.mode=t},e.questionsMode=function(){e.mode="edit"},e.reorderMode=function(){e.mode="reorder",M("Rearrange")},e.preview=function(e){var t=f.Services.Builder().execute("commitChanges");t.then(function(){var t;e.stopPropagation(),t=s.path()+"/preview",s.path(t),i.log("preview click",t)}),M("Preview")},e.$on("question:count:changed",function(t,n){e.questionCountChanged(n)}),e.questionCountChanged=function(t){e.questionCount=t},e.showOriginalTest=function(){var t=f.Services.Builder().execute("commitChanges");t.then(function(){var t,n=e.content.id,a=s.path();u.getOriginalIdFromCustomized(n).then(function(e){t=r.keywords&&L.test(a)?a.split("/search")[0]+"/search/assessment/"+e.originalItemId+"/0/edit":a.split("/assessment")[0]+"/assessment/"+e.originalItemId+"/0/edit",s.path(t)})})},e.showCustomizedTest=function(){var t,n=s.path();t=r.keywords&&L.test(n)?n.split("/search")[0]+"/search/assessment/"+e.content.customizedItem.id+"/"+e.content.customizedItem.version+"/edit":n.split("/assessment")[0]+"/assessment/"+e.content.customizedItem.id+"/"+e.content.customizedItem.version+"/edit",s.path(t)};var z=function(){var t=!1;e.isCustomizedVersion()&&u.makeDefaultView(e.content.id,t).then(function(){var t=e.getNextURL(),r=s.path();!r.match(/\/search\/assessment\/[a-z0-9\-]+\/[0-9]+\/edit$/)&&n.currentProgram&&(n.currentProgram.programDirty=!0),s.path(t),d.hideDialog()})};e.removeCustomized=function(t){t.preventDefault(),t.stopPropagation();var n=function(){d.hideDialog()},r=function(){z()},s=e.$new();s.dialogId="removeCustomizedWarningModal",e.isAssigned?(s.title=m("assessmentBuilder.removeCustomizedTest.isAssigned.title"),s.body=m("assessmentBuilder.removeCustomizedTest.isAssigned.message"),s.isDismissible=!1,s.buttons=[{title:m("assessmentBuilder.action.cancel"),clickHandler:n},{title:m("assessmentBuilder.action.ok"),clickHandler:r,isDefault:!0}],s.dismissed=!1,s.closeBtnClickHandler=n):(s.title=m("assessmentBuilder.removeCustomizedTest.title"),s.body=m("assessmentBuilder.removeCustomizedTest.message"),s.isDismissible=!1,s.buttons=[{title:m("assessmentBuilder.action.cancel"),clickHandler:n},{title:m("assessmentBuilder.action.ok"),clickHandler:r,isDefault:!0}],s.dismissed=!1,s.closeBtnClickHandler=n),d.showDialog("templates/partials/simpleDialog.html",s)
};var U=function(){var t=function(){var t=e.getNextURL();e.$broadcast("preNavigationChange"),e.goBack(t,!0)},n="editAssessment.noQuestionAdded.title",r="editAssessment.noQuestionAdded.body",s={OK:{title:"editAssessment.noQuestionAdded.action.finish",handler:t,isDefault:!0},CANCEL:{title:"editAssessment.noQuestionAdded.action.continue"}};d.simpleDialog(n,r,s,{id:"noQuestionAddedWarningModal"})},F=function(){var t=e.questionCount;return!angular.isNumber(t)||0===t},x=function(){var e=1;I.setCurrentPageIndex(e)};e.getNextURL=function(){var e,t,n=s.path(),a=/\/myLibrary\/program/,i=/\/myLibrary\/assessment\/[a-z0-9\-]+\/[0-9]+\/edit$/,o="/myLibrary";return r.keywords&&L.test(n)?(t=s.path().split("/search")[0]+"/search",r.lessonId&&r.lessonVersion&&(t=[t,"lesson",r.lessonId,r.lessonVersion].join("/"))):a.test(n)?(I.setSelectedFacets(void 0),I.setSearchKeyWord(void 0),x(),t=o):i.test(n)?(x(),t=o):(e=s.path().split("/assessment/"),e.pop(),t=e.join("/assessment/")),t},e.back=function(t){if(t&&(t.stopPropagation(),t.preventDefault()),e.showViewCustomized())e.showCustomizedTest();else if(e.content.newlyCreated&&u.setSuccessMsgFlag("assessment",!0),"questionBanks"===e.mode)t.currentTarget.blur(),e.questionsMode();else if("create"===e.mode)w();else if(e.isEditing){e.attemptExit=!0;var n=f.Services.Builder().execute("commitChanges");n.then(w)}else F()?U():w();c.isNewTest=!1};var B=function(t,n){return function(){var r=arguments;return e.$$phase||e.$root&&e.$root.$$phase?n.apply(t,r):(e.$apply(function(){return n.apply(t,r)}),void 0)}};b={},b.showAlert=B(b,function(t,n,r){"ERROR"===t&&(e.attemptExit=!1),e.message=n,e.target=r,e.messageType=t.toLowerCase(),d.hideDialog()}),b.showDialog=B(b,function(t){var r,s,a,o,l=t.id,c=!0;i.log("dialogCallbackFn modalParams",t),n.viewLoading=!1,t.isDismissible&&(r=l+".dismiss.forever",s=e.currentUser.getAttribute(r),s&&(t.defaultClickHandler.apply(null),c=!1)),c&&(a=e.$new(),a.sentResponse=!1,o=function(t){return function(){t.isDefault&&a.dismissed&&e.currentUser.$toggleAttribute(r),d.hideDialog(),t.clickHandler.apply(null),a.sentResponse=!0}},a.dialogId=t.dialogId,a.title=t.title,a.body=t.body,a.isDismissible=t.isDismissible,a.buttons=$.Enumerable.From(t.buttons).Select(function(e){return{buttonType:e.isDefault?"ok":"cancel",title:e.title,isDefault:e.isDefault,clickHandler:o(e)}}).ToArray(),a.closeBtnClickHandler=function(){angular.isFunction(t.closeClickHandler)&&(t.closeClickHandler(),a.sentResponse=!0),e.attemptExit=!1,d.hideDialog()},a.$on("modal.hidden",function(){!a.sentResponse&&angular.isFunction(t.closeClickHandler)&&(t.closeClickHandler(),a.sentResponse=!0)}),d.showDialog("templates/partials/simpleDialog.html",a))}),b.createAssessment=function(e){var t;return this._trigger("assessment:create:before",e),t=this._ajax({url:this._buildPath("my_library",r.programId,"assessments"),type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify(e)}),this._fireEvents(t,"assessment:create:success","assessment:create:error"),t.then(function(e){return h.addAlert(e.id,{type:"success",msg:[m("assessmentBuilder.createAssessment.success.title"),m("assessmentBuilder.createAssessment.success.message")].join(" ")}),B(b,function(){D?D.progressComplete().then(function(){s.path([s.path(),e.id,e.version,"edit"].join("/"))}):s.path([s.path(),e.id,e.version,"edit"].join("/"))})(),e.details})},b.listQuestionBanks=function(e,t,n,r){var s=this._ajax({url:[p,"assessment/questionbanks"].join("/"),type:"GET",dataType:"json",data:{programs:e,page:t+1,pageSize:n,nativeBanks:r}});return s.then(function(e){e.total=e.totalQuestionBanks,e.page=t,e.nativeAssessment=r;for(var n=0;n<e.questionBanks.length;++n){var s=e.questionBanks[n];if(s.assessmentId=s.questionBankId,s.totalQuestions=s.questions.length,r){s.multipleChoiceCount=0,s.griddedResponseCount=0;for(var a=0;a<s.questions.length;++a){var i=s.questions[a];i.questionType===S.MULTIPLE_CHOICE?s.multipleChoiceCount++:i.questionType===S.GRIDDED_RESPONSE&&s.griddedResponseCount++}}}return delete e.totalQuestionBanks,e})},f.Services.Builder.setImplementation(_.extend(f.Services.Builder.getDefaultImplementation(),b)),e.builderConfigOptions={fixedHeaderHeight:$("#globalNav").outerHeight(!0),useDropdownForAddQuestion:!0,navigationFn:e.navigation,ckeditorSkin:"pete",isReadOnly:e.isPearsonOriginal||e.isAssigned,program:n&&n.currentProgram&&n.currentProgram.programs&&n.currentProgram.programs[0]?n.currentProgram.programs[0]:null,defaultThumbnailURL:g+"/realizeit/skins/default/images/mediatype/icon/question_bank@2x.png",questionCountChangedFn:e.questionCountChanged,includeQuestionBankSupport:!!n.currentProgram}}]),angular.module("Realize.assessment.assessmentBuilderServiceInterface",[]).service("AssessmentBuilderServiceInterface",function(){"use strict";return angular.copy(UXF.AssessmentBuilder)}),angular.module("Realize.assessment.assessmentDataService",["Realize.paths"]).service("Assessment",["$http","$log","$q","PATH",function(e,t,n,r){"use strict";var s={};return s.isNewTest=!1,s.getInfo=function(s,a){var i=e({url:r.REST+"/assessment/info",params:{equellaId:s,equellaVersion:a},method:"GET"}).then(function(e){return e.data},function(e){return t.error("Failed to retrieve assessment info",e),n.reject("Failed to retrieve assessment info")});return i},s.getTestSession=function(s,a){var i=e({url:r.REST+"/assessment/session",data:{equellaId:s,equellaVersion:a},method:"POST"}).then(function(e){return e.data},function(e){return t.error("test session error",e),n.reject(e)});return i},s.getStudentSession=function(e,t,n,r){return s.getStudentSessionBase(e,t,n,!1,r)},s.getStudentSessionFromTeacher=function(e,t,n){return s.getStudentSessionBase(e,t,!1,!1,n)},s.getAdaptiveStudentSession=function(e,t,n,r){return s.getStudentSessionBase(e,t,!1,!1,n,r)},s.getStudentSessionBase=function(s,a,i,o,l,c){var u=r.REST+"/assessment/session/assignmentApi",d={itemUUID:s,itemVersion:a,createNewSession:i,getCompletedSession:o,userAssignmentId:l};c&&(d.assessment_id=c);var m=e({url:u,method:"POST",data:d}).then(function(e){return e.data},function(e){return t.error("student session error",e),n.reject(e)});return m},s.getEssayScoresForTeacher=function(s){var a={method:"GET",url:r.REST+"/assessment/"+s+"/essayScoringSummary"};return e(a).then(function(e){return e},function(e){return t.error("Failed to load essay scores",e),n.reject(e)})},s.updateEquellaTitleAndDescription=function(s,a,i){var o=e({url:r.REST+"/assessment/equella/edit/"+s,method:"POST",data:{assetTitle:a,assetDescription:i}}).then(function(e){return e.data},function(e){return t.error("Failed to update title and description",e),n.reject(e)});return o},s.updateEquellaItemTimestamp=function(s){var a=e({url:r.REST+"/assessment/equella/edit/"+s,method:"POST"}).then(function(e){return e.data},function(e){return t.error("Failed to update equella item timestamp",e),n.reject(e)});return a},s.clone=function(s,a,i,o){var l={isDefault:!0,isActive:i};angular.isDefined(o)&&(l.customizedItemId=o);var c=e({url:r.REST+"/assessment/customize/"+s+"/"+a,data:l,method:"POST"}).then(function(e){return e.data},function(e){return t.error("failed to clone the assessment for editing",e),n.reject(e)});return c},s.createCustomizeVersion=function(s,a){var i=r.REST+"/assessment/v2/customize/"+s+"/"+a;return e.post(i).then(function(e){return e.data},function(e){return t.error("failed to create the assessment for customization",e),n.reject(e)})},s.getCustomizedVersionCount=function(s){var a=e({url:r.REST+"/assessment/item/"+s+"/customizeditemscount",method:"GET"}).then(function(e){return e.data},function(e){return t.error("failed to get the version count",e),n.reject(e)});return a},s.getSummary=function(s,a){var i=r.REST+"/assessment/"+s+"/summary";return angular.isDefined(a)&&(i=i+"?cacheSummary="+a),e.get(i).then(function(e){return e.data},function(e){return t.error("Failed to retrieve assessment summary",e),n.reject(e)})},s.getResult=function(s){var a=r.REST+"/assessment/"+s+"/results";return e.get(a).then(function(e){return e.data},function(e){return t.error("Failed to retrieve assessment result",e),n.reject(e)})},s.saveManualMultipartScore=function(s,a,i){var o=r.REST+"/assessments/"+s+"/questions/"+a+"/multiparts/scores";return e({url:o,dataType:"json",method:"PUT",data:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then(function(e){return e.data},function(e){return t.error("Failed to save score",e),n.reject(e)})},s.getSummaryAndResult=function(e,r,a){var i={};return s.getStudentSessionFromTeacher(e,r,a).then(function(e){return i.sessionId=e,n.all([s.getSummary(i.sessionId),s.getResult(i.sessionId)]).then(function(e){return i.summaryResponse=e[0],i.resultResponse=e[1],i},function(e){return t.error("Failed to get summary and result",e),n.reject({type:"back",errorMessage:"Unable to retrieve summary/result for test"})})},function(){return n.reject({type:"back",errorMessage:"Unable to retrieve student session"})})},s.saveManualScore=function(s,a,i){var o=r.REST+"/assessment/"+s+"/question/"+a,l={score:i};return e({url:o,params:l,method:"PUT"}).then(function(e){return e.data},function(e){return t.error("Failed to save score",e),n.reject(e)})},s.createAssessment=function(s,a){var i=r.REST+"/my_library/"+s+"/assessments.json",o={assetTitle:a.title,assetDescription:a.description,mastery:a.isMastery,type:a.testType,nativeAssessment:a.isNative};return e.post(i,o).then(function(e){return e.data},function(e){return t.error("Failed to create assessment",e),n.reject(e)})},s.loadAssessment=function(s,a){var i={method:"GET",url:r.REST+"/assessment/load/"+s+".json",params:{isEssayPrompt:!!a}};return e(i).then(function(e){return e.data},function(e){return t.error("Failed to load assessment",e),n.reject(e)})},s.addQuestionsFromBank=function(s,a,i,o){var l=r.REST+"/assessments/"+a+"/questions/questionbanks.json",c=angular.isNumber(o)?"?positionAtWhichToInsertQuestions="+o:"",u=l+c;return e.post(u,i).then(function(e){return e.data},function(e){return t.error("Failed to add questions from bank",e),n.reject(e)})},s.deleteQuestionsFromAssessment=function(s,a,i){var o,l;return o=i?r.REST+"/assessments/"+s+"/questionbanks/"+a:r.REST+"/assessments/"+s+"/questionbanks/"+a.parentBankId+"/questions/"+a.id,l={method:"DELETE",url:o},e(l).then(function(e){return e.data},function(e){return t.error("Failed to delete question from assessment",e),n.reject(e)})},s.putQuestionsInAssessment=function(s,a){var i=r.REST+"/assessments/"+s+"/questions.json";return e.put(i,a).then(function(e){return e.data},function(e){return t.error("Failed to putQuestionsInAssessment",e),n.reject(e)})},s.createEssayPrompt=function(s,a){var i=r.REST+"/my_library/"+s+"/essayPrompt.json";return e.post(i,a).then(function(e){return e.data},function(e){return t.error("Failed to create essay prompt",e),n.reject(e)})},s.editEssayPrompt=function(s,a){var i=r.REST+"/assessment/"+s+"/essayPrompt";return e.put(i,a).then(function(e){return e.data},function(e){return t.error("Failed to edit essay prompt",e),n.reject(e)})},s}]),angular.module("Realize.assessment.assessmentInterceptor",[]).factory("AssessmentInterceptor",function(){"use strict";var e={},t=["/essayPrompt","/questionbanks.json","/questions.json","/assessments.json"],n=function(e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>-1)return!0;return!1},r=function(e){return JSON.stringify(e)};return e.request=function(e){return n(e.url)&&(e.headers["Content-Type"]="application/json",e.transformRequest=r),e},e}),angular.module("Realize.assessment.customizeAssessmentDirective",["ModalServices","components.modal","Realize.content","Realize.content.constants","Realize.assessment.assessmentDataService"]).directive("customizeAssessment",["$log","Modal","$location","Content","CONTENT_CONSTANTS","Assessment","lwcI18nFilter","standardModal","assessmentEventTrackingService","ASSESSMENT_EVENT_TRACKING_CONSTANTS","TELEMETRY_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u){"use strict";return{link:function(d,m,g){m.on("click",function(m){function p(e,n,r){var s={OK:{handler:r,isDefault:!0},CANCEL:{}};t.simpleDialog(e,n,s,{id:"assessmentAssignedDialog"})}function f(){o.activate({heading:i("content.modal.title"),description:i("content.modal.message"),buttons:[b],closeButton:!0,overlayActive:!0,cssClass:"customized-items-popup",closeAction:function(){o.deactivate()}})}function h(e,t){var r={id:c.OPEN,area:-1!==n.path().indexOf("/program")?u.EVENT_TYPE.PROGRAMS:u.EVENT_TYPE.SEARCH,page:-1!==n.path().indexOf("/program")?d.tocView&&"list"!==d.tocView?u.EVENT_TYPE.TABLE_OF_CONTENTS_THUMBNAIL_VIEW:u.EVENT_TYPE.TABLE_OF_CONTENTS:u.EVENT_TYPE.SEARCH_RESULTS,product:d.program?d.program.title:u.NO_PROGRAM_AVAILABLE,name:c.NAME.CUSTOMIZE_ASSESSMENT_LINK,description:e.$getTitle(),value:t+1};l.sendTelemetryEvents(r)}m.preventDefault(),m.stopPropagation();var v,S=d.$eval(g.customizeAssessment),T=d.$eval(g.caProgram),A=d.$eval(g.caBeforeRedirect),I=S.id,E=S.version,y=!!d.$eval(g.isEssayPrompt),R=function(e){var t=angular.extend({},S,{id:e.equellaItemUuid,version:e.equellaItemVersion,editAssessment:!0});if(angular.isFunction(A)&&A(),T)n.path(r.getRoute(t,T));else{var s=n.path();n.path(s+r.getRoute(t))}},C=function(){if(S.$isCustomizedTest()){var n=0;I=angular.isDefined(S.originalItem)?S.originalItem.id:S.originalItemId,E=angular.isDefined(S.originalItem)?S.originalItem.version:n,v=S.id}a.clone(I,E,!1,v).then(function(e){R(e)},function(n){e.log(n),t.simpleDialog("program.customizeAssessment.notAvailable.title","program.customizeAssessment.notAvailable.message",null,{id:"assessment.customize.notAvailable"})})},D=function(){a.createCustomizeVersion(I,E).then(function(e){R(e)},function(n){e.log(n),t.simpleDialog("program.customizeAssessment.notAvailable.title","program.customizeAssessment.notAvailable.message",null,{id:"assessment.customize.notAvailable"})})},b={label:i("content.modal.ok"),ariaLabel:i("content.modal.ok"),action:function(){o.deactivate()},className:[],disabled:!1},P="My Uploads"===S.contribSource,w=S.$isCustomizedTest(),L=function(){S.$isAssigned().then(function(e){var t=(y?"essayPrompt.":"")+"customizeAssessment.assessmentAssignedDialog.title",n=(y?"essayPrompt.":"")+"customizeAssessment.assessmentAssignedDialog.body";!e||w||P?e||w||P?e&&(w||P)?p(t,n,C):C():D():p(t,n,D)})};w||P&&!S.originalItemId?L():a.getCustomizedVersionCount(I).then(function(e){return e>=s.MAX_ASSESSMENT_CUSTOMISE_VERSIONS?(f(),void 0):(h(S,e),L(),void 0)}),d.$apply()})}}}]).directive("showCustomizeTestLink",["$log","$rootScope","ngIfDirective",function(e,t,n){"use strict";var r=n[0];return{transclude:r.transclude,priority:r.priority,terminal:r.terminal,restrict:r.restrict,link:function(e,n,s){var a=e.$eval(s.customizeAssessment),i=s.caIf||"",o=a&&a.$isTest()&&t.currentUser.$canCustomizeItems();i=i?e.$eval(i):!0,s.ngIf=function(){return i&&o},r.link.apply(r,arguments)}}}]),angular.module("Realize.content.createOptions",["Realize.paths","Realize.quicklinks.quickLinkMenu","Realize.quicklinks.quickLink","Realize.content","rlzComponents.components.i18n","Realize.common.optionalFeaturesService"]).directive("contentCreateOptions",["$log","$location","Content","Assessment","$currentUser","OptionalFeatures","PATH","$rootScope",function(e,t,n,r,s,a,i,o){"use strict";return{templateUrl:i.TEMPLATE_CACHE+"/app/programs/toc/contentToolbar/contentCreateOptions.dir.html",scope:!0,link:function(e,i,l){e.menuDirection="bottom"===l.position?"up":"down",e.content=e.program=o.currentProgram,e.hasNBCLearnCourse=s.isNbcLearnUser(),e.hasBuildETextFeature=a.isAvailable("buildEText.feature.enabled"),e.hasEssayPromptAccess=e.currentProgram.hasEssayPromptAccess,e.showUploadDialog=function(r){t.path(n.getRoute(e.currentProgram)+"/myContent/"+r)},e.openCreateAssessment=function(){var e=t.path()+"/assessment/create";r.isNewTest=!0,t.path(e)},e.openEssayPrompt=function(){var r=n.getRoute(e.currentProgram)+"/assessment/essayPrompt";t.path(r)},e.openCreateETextSelection=function(){var e=t.path()+"/eText2/create";t.path(e)},e.openNbcLearnBrowseForMyContent=function(){t.path("/nbclearn/browse")}}}}]),angular.module("Realize.program.content.toolbar",["Realize.paths","Realize.quicklinks.quickLink","Realize.quicklinks.quickLinkMenu","Realize.content.createOptions","rlzComponents.components.createContentDropdown","components.buttons.customButton"]).directive("contentToolbar",["$location","$rootScope","PATH","Content","OptionalFeatures","Assessment","CONTENT_UPLOAD_TYPES","$currentUser",function(e,t,n,r,s,a,i,o){"use strict";return{templateUrl:n.TEMPLATE_CACHE+"/app/programs/toc/contentToolbar/contentToolbar.dir.html",scope:!0,controller:["$scope",function(n){n.program=t.currentProgram,n.hasBuildETextFeature=s.isAvailable("buildEText.feature.enabled");var l=o.isNbcLearnUser(),c=t.currentProgram.hasEssayPromptAccess,u=e.path().indexOf("centers")>=0,d=function(t){if(t===i.GOOGLE_DRIVE||t===i.FILE||t===i.LINK)e.path(r.getRoute(n.program)+"/myContent/"+t);else if(t===i.BUILD_TEST){var s=e.path()+"/assessment/create";a.isNewTest=!0,e.path(s)}else if(t===i.ESSAY_PROMPT){var o=r.getRoute(n.program)+"/assessment/essayPrompt";e.path(o)}else if(t===i.ETEXT){var l=e.path()+"/eText2/create";e.path(l)}else t===i.NBC_LEARN&&e.path("/nbclearn/browse")};n.onCreateContentOptions={onCreateContentOptionsUpdate:d,inCentersTab:u,hasEssayPromptAccess:c,program:n.program,content:n.program,hasBuildEtextFeature:n.hasBuildETextFeature,hasNbcLearnCourse:l}}],link:{pre:function(e,t,n){e.position=n.position||"",e.menuDirection="down","bottom"===e.position&&(e.menuDirection="up",e.dropup="dropup")}}}}]),angular.module("Realize.discussionPrompt.discussionPromptCtrl",["Realize.assignment.modal","Realize.user.currentUser","realize-lib.analytics.track-click","Realize.common.alerts","Realize.discussionPrompt.discussionPromptModel","Realize.content.media-icon","Realize.navigationService","Realize.Comment.DisplayTime","rlzComponents.components.i18n","Realize.Prompt.promptApiUtilService","Realize.constants.contribSource"]).controller("DiscussionPromptCtrl",["$scope","DiscussionPromptModel","$routeParams","$location","NavigationService","$currentUser","promptApiUtilService","$log","CONTRIBUTOR_SOURCE",function(e,t,n,r,s,a,i,o,l){"use strict";var c=this;if(c.removePromptAction=!1,e.currentView=r.search().view||"review",e.isReviewPage=function(){return"review"===e.currentView},e.config="review",e.discussionPrompt=t.getDisPrompt(),c.displayNameForPrompt=a.userAttributes["profile.displayName"],c.getTitle=function(){return e.discussionPrompt.title},c.getDescription=function(){return e.discussionPrompt.discussionPrompt},c.isTeacherPrompt=function(){return e.discussionPrompt.contribSource===l.MY_UPLOADS},c.isTeacherPrompt()&&"DELETED"===e.discussionPrompt.status){var u=r.path().split("discussPrompt/")[0]+"discussPrompt";r.path(u)}r.search().view&&(e.prompt={id:e.discussionPrompt.id,title:e.discussionPrompt.title,body:e.discussionPrompt.discussionPrompt,thumbnails:e.discussionPrompt.thumbnailUrls[0]}),c.back=function(e){e.stopPropagation();var t,n=r.path();n.indexOf("discussionprompt")>-1?(t=n.split("/discussionprompt/")[0],s.back(t,!0)):(t=n.split("/discussPrompt")[0]+"/discussPrompt",r.path(t).search({discuss:"list",activeTab:"myPrompts"}))},e.$on("promptdetails.action.remove",function(e){e&&e.stopPropagation();var t=r.path().split("/discussPrompt")[1],n=t.split("/")[1];i.deletePrompt(n).then(function(){c.removePromptAction=!0},function(e){o.error("Error %s in deleting the post: %s",e,prompt.id)})}),e.$on("promptdetails.action.undo",function(e){e&&e.stopPropagation();var t=r.path().split("/discussPrompt")[1],s=t.split("/")[1];i.unDeletePrompt(s,n.classId).then(function(){c.removePromptAction=!1},function(e){o.error("Error %s in deleting the post: %s",e,prompt.id)})}),e.undoPrompt=function(t){t&&t.stopPropagation(),e.$emit("promptdetails.action.undo")},e.$on("assignmentModal.alert.toggle",function(t,n){n.show?(c.alertDetails=n.alertDetails,c.alertIsSet=!0):e.alertIsSet=!1}),e.$on("editedPrompt.alert.toggle",function(t,n){n.show?(c.alertDetails=n.alertDetails,c.alertIsSet=!0):e.alertIsSet=!1}),e.$on("prompt.mode.editing",function(t,n){e.prompt={id:e.discussionPrompt.id,title:e.discussionPrompt.title,body:e.discussionPrompt.discussionPrompt,thumbnails:e.discussionPrompt.thumbnailUrls[0]},e.currentView=n}),e.$on("prompt.view.change",function(t,n){e.prompt={},e.currentView=n}),e.$on("prompt.detail.update",function(t,n){e.discussionPrompt=n}),e.getContent=function(){return e.discussionPrompt}}]),angular.module("Realize.discussionPrompt",["Realize.discussionPrompt.discussionPromptCtrl","Realize.discussionPrompt.discussionPromptResolver","Realize.discussionPrompt.discussionPromptRoutes","Realize.discussionPrompt.discussionPromptModel","Realize.Prompt.discussionPromptQuicklink"]),angular.module("Realize.discussionPrompt.discussionPromptRoutes",["Realize.discussionPrompt.discussionPromptResolver","Realize.paths"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n={controller:"DiscussionPromptCtrl",controllerAs:"discussionPromptCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/discussionPrompt/reviewDiscussionPrompt.html",resolve:{DiscussionPromptLoaded:["DiscussionPromptResolver",function(e){return e.discussionPromptload()}],CurrentProgramLoaded:["Resolve",function(e){return e.CurrentProgramLoaded()}]}},r="/program/:programId/:programVersion",s="/tier/:tierId/:tierVersion",a=s+"/tier2/:tier2Id/:tier2Version",i="/myLibrary",o=[{route:r,supportsLessons:!0,supportsDiscussionPrompt:!0},{route:r+s,supportsLessons:!0,supportsDiscussionPrompt:!0},{route:r+a,supportsLessons:!0,supportsDiscussionPrompt:!0},{route:"/search",supportsLessons:!0,supportsDiscussionPrompt:!0},{route:i,supportsLessons:!0,supportsDiscussionPrompt:!0},{route:i+s,supportsLessons:!0,supportsDiscussionPrompt:!0},{route:i+a,supportsLessons:!0,supportsDiscussionPrompt:!0}];angular.forEach(o,function(t){var r=t.route,s=r+"/lesson/:lessonId/:lessonVersion";t.supportsDiscussionPrompt&&e.when("/classes/:classId/discussPrompt/:itemId/:itemVersion/",n).when(r+"/discussionprompt/:itemId/:itemVersion/",n).when(s+"/discussionprompt/:itemId/:itemVersion/",n)})}]),angular.module("Realize.discussionPrompt.discussionPromptModel",[]).service("DiscussionPromptModel",[function(){"use strict";var e=this,t="";return e.initialDisPrompt=function(e){t=e},e.getDisPrompt=function(){return t},e}]),angular.module("Realize.Prompt.discussionPromptQuicklink",["Realize.paths","Realize.analytics","Realize.discussionPrompt.discussionPromptModel","Realize.constants.contribSource"]).controller("DiscussionPromptQuicklinkCtrl",["DiscussionPromptModel","$scope","$currentUser","CONTRIBUTOR_SOURCE","$location",function(e,t,n,r,s){"use strict";var a=this;t.discussionPrompt=e.getDisPrompt(),a.canAssign=t.discussionPrompt.$isAssignable()&&!n.isStudent,a.isTeacherPrompt=function(){return t.discussionPrompt.contribSource===r.MY_UPLOADS},a.showRemoveLink=function(){return a.isTeacherPrompt()&&s.path().indexOf("classes")>=0},t.editPrompt=function(){t.$emit("prompt.mode.editing","edit")}}]).directive("discussionPromptQuicklink",["PATH",function(e){"use strict";return{templateUrl:e.TEMPLATE_ROOT+"/app/programs/toc/discussionPrompt/discussionPromptQuicklink.dir.html",controller:"DiscussionPromptQuicklinkCtrl",controllerAs:"discussionPromptQuicklinkCtrl",link:function(e){e.removePrompt=function(t){t&&t.stopPropagation(),e.$emit("promptdetails.action.remove")}}}}]),angular.module("Realize.discussionPrompt.discussionPromptResolver",["Realize.content.model.contentItem","Realize.discussionPrompt.discussionPromptModel","Realize.constants.contribSource"]).factory("DiscussionPromptResolver",["Content","$q","$route","DiscussionPromptModel","CONTRIBUTOR_SOURCE","$currentUser",function(e,t,n,r,s,a){"use strict";return{discussionPromptload:function(){var i=t.defer();return e.get({contentId:n.current.params.itemId,version:n.current.params.itemVersion},!0).then(function(e){return r.initialDisPrompt(e),a.isTeacher||e.contribSource!==s.MY_UPLOADS?(i.resolve(),void 0):i.reject("Insufficient Privileges!")}),i.promise}}}]),angular.module("Realize.eText2Builder",["Realize.eText2Builder.routes","Realize.eText2Builder.eText2CreateCtrl","Realize.eText2Builder.eText2DataService","Realize.eText2Builder.eText2BuilderService"]),angular.module("Realize.eText2Builder.routes",["Realize.paths","Realize.content.contentDataService","Realize.user.currentUser","Realize.eText2Builder.eText2DataService","Realize.common.optionalFeaturesService"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n=["$q","$currentUser",function(e,t){var n=t.hasRole("ROLE_TEACHER");return n?e.when(1):e.reject("Insufficient Privileges!")}],r={controller:"EText2CreateCtrl",controllerAs:"eText2CreateCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/eText2/create/create.ctrl.html",resolve:{_security:n,ZeroState:["$q","OptionalFeatures",function(e,t){return t.isAvailable("buildEText.feature.enabled")?e.when():e.reject({type:"redirect",path:"/home"})}],eText2Data:["Resolve","$rootScope","EText2DataService",function(e,t,n){return e.CurrentProgramLoaded().then(function(){return n.getEText2StudentEdition(t.currentProgram)})}]}},s="/program/:programId/:programVersion",a="/tier/:tierId/:tierVersion",i=a+"/tier2/:tier2Id/:tier2Version",o="/myLibrary",l=[{route:s,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0},{route:s+a,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0},{route:s+i,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0},{route:s+"/standards/lastSelectedGrade/:lastSelectedGrade/search/:stateStandard",supportsMyContent:!1,supportsLessons:!0,supportsGeneralUrls:!0},{route:s+"/standards/lastSelectedGrade/:lastSelectedGrade/search/:stateStandard/:nationalLibrary",supportsMyContent:!1,supportsLessons:!0,supportsGeneralUrls:!0},{route:"/search",supportsMyContent:!1,supportsLessons:!0,supportsGeneralUrls:!0},{route:"/search/standard/:stateStandard",supportsMyContent:!1,supportsLessons:!0,supportsGeneralUrls:!0},{route:o,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0},{route:o+a,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0},{route:o+i,supportsMyContent:!0,supportsLessons:!0,supportsGeneralUrls:!0}];angular.forEach(l,function(t){var n=t.route;t.supportsMyContent&&e.when(n+"/eText2/create",r).when(n+"/myContent/eText2/create",r)})}]),angular.module("Realize.eText2Builder.eText2BuilderService",["Realize.myContent.myContentDataService"]).factory("EText2BuilderService",["$q","MyContent",function(e,t){"use strict";var n={};return n.createEText2Selection=function(e,n){var r=t.addContentItemToMyLibrary({json:angular.toJson(n)},e);return r},n}]),angular.module("Realize.eText2Builder.eText2DataService",["Realize.content.model.contentItem"]).factory("EText2DataService",["$q","Content",function(e,t){"use strict";var n={};return n.getEText2StudentEdition=function(n){var r=e.defer();return n.library&&n.library.length>0?t.queryFast({LIBRARY_TITLE:n.library[0],MEDIA_TYPE:"Selected Reading",NOT_ITEM_STATUS:["deleted","archived"]},function(e){r.resolve(e)},function(e){r.reject(e)}):r.resolve([]),r.promise},n}]),angular.module("RealizeApp").controller("EditLessonCtrl",["$scope","$rootScope","$routeParams","Content","MyContent","$log","$location","$window","Modal","EditLessonContent","lwcI18nFilter","UnsavedChangesModal","AlertService","InlineAlertService","$q","ContentSource","CONTENT_UPLOAD_TYPES",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h){"use strict";var v,S=!1;e.lesson=c,e.isSaveInProgress=!1,e.subPage=h.EDIT_LESSON;var T=function(e){var t=[];return angular.forEach(e,function(e){t.push(e),"Learning Model"===e.mediaType&&e.contentItems&&e.contentItems.length>0&&(t=t.concat(e.contentItems),e.contentItems=[])}),t},A=0,I=function(t){e.contentItemsListForEdit=T(t),angular.forEach(e.contentItemsListForEdit,function(e){e.tempId="tempId_"+A++})};e.reorderModeIsOn=i.path().indexOf("/reorder")>=0,e.dragDropOptions={enabled:e.reorderModeIsOn,opacity:.6},e.titleMax=50,e.isCustomized="My Uploads"===e.lesson.contribSource,e.searchProvider=f.PROVIDER.REALIZE;var E,y=e.lesson.id,R=angular.copy(e.lesson.customizedItem),C=function(e){var t,r=i.path();t=n.keywords?r.split("/search")[0]+"/search/lesson/"+e.id+"/"+e.version:r.split("/lesson")[0]+"/lesson/"+e.id+"/"+e.version,i.path(t)},D=function(){var e=["<strong>",u("editLesson.successNotification.lessonUpdated.title"),"</strong>",u("editLesson.successNotification.lessonUpdated.message")].join(" ");m.addAlert("success","ok-sign",e,2)},b=function(e){var t,n=[];return angular.forEach(e,function(e){var r;if(e.id){if("Learning Model"===e.mediaType&&"My Uploads"!==e.contribSource)r={mediaType:"Learning Model",fileType:"Sequence",title:e.title};else if(e.fileType===f.PROVIDER.Open_ED){var s=[];angular.isArray(e.thumbnailUrls)&&0!==e.thumbnailUrls.length&&(s[0]=e.thumbnailUrls[0]),r={externalId:e.id,externalSource:e.fileType,title:e.title,contribSource:e.fileType,fileType:"URL",mediaType:"Link",thumbnailUrls:s}}else r={id:e.id};r.associativeProps=e.associativeProps}else r=e;"Learning Model"===e.mediaType?(n.push(r),t=r,t.contentItems=[]):angular.isDefined(t)?t.contentItems.push(r):n.push(r)}),n},P=function(){delete t.currentProgram},w=function(){return{isDefaultView:!0,originalItemId:e.lesson.originalItemId,json:JSON.stringify(e.lesson)}},L=function(){var t=p.defer();return e.isCustomized?s.getOriginalIdFromCustomized(y).then(function(n){e.lesson.originalItemId=n.originalItemId,t.resolve()},function(){t.reject()}):(R?e.lesson.id=R.id:delete e.lesson.id,e.lesson.originalItemId=y,delete e.lesson.version,delete e.lesson.externalReference,delete e.lesson.externalId,delete e.lesson.externalSource,t.resolve()),t.promise},O=function(e){return"Learning Model"===e.mediaType&&!$.trim(e.title)||"Student Voice"===e.mediaType&&!$.trim(e.text)},N=function(t){return t.tempId&&e.removedItems[t.tempId]},M=function(e){return _.reject(e,function(e){return e&&N(e)||O(e)})},k=function(){var t=["associatedTeacherSupport","associatedTools","associatedRemediation"];$.each(t,function(t,n){e.lesson[n]&&(e.lesson[n]={id:e.lesson[n].id})})},z=function(){var t=L();e.contentItemsListForEdit=M(e.contentItemsListForEdit),k(),e.lesson.defaultView=!0,e.lesson.contentItems=b(e.contentItemsListForEdit),delete e.lesson.customizedItem;var n=p.defer();return t.then(function(){n.resolve(w())},function(){n.reject()}),n.promise};I(e.lesson.contentItems);var U=angular.copy(e.contentItemsListForEdit);e.removeCustomized=function(t){E=!0,t.preventDefault(),t.stopPropagation();var n=function(){l.hideDialog()},r=function(){var t=!1;e.isCustomized&&s.makeDefaultView(y,t).then(function(e){P();var t,n=e.originalItemId,r=i.path();t=r.match("/lesson/lesson/")?r.split("/lesson/lesson/")[0]+"/lesson/lesson/"+n+"/0":r.split("/lesson/")[0]+"/lesson/"+n+"/0",i.path(t),l.hideDialog()})},a=function(){r()},o=e.$new();o.dialogId="removeCustomizedWarningModal",o.title=u("editLesson.removeCustomizedLesson.title"),o.body=u("editLesson.removeCustomizedLesson.message"),o.isDismissible=!1,o.buttons=[{title:u("editLesson.action.cancel"),clickHandler:n},{title:u("editLesson.action.ok"),clickHandler:a,isDefault:!0}],o.closeBtnClickHandler=function(){n()},o.dismissed=!1,l.showDialog("templates/partials/simpleDialog.html",o)},e.save=function(){if(!e.isSaveInProgress){e.isSaveInProgress=!0,E=!0,S&&e.selectedSearchItems&&e.selectedSearchItems.objects&&e.selectedSearchItems.objects.length>0&&(e.done(),S=!1);var t=l.progressDialog(e.$new(),{progressHeader:u("editLesson.updateProgress.title"),progressMessage:u("editLesson.updateProgress.message")}).then(function(){t.fakeProgress()}),n=z(),r=function(e){return s.addContentItemToMyLibrary(e,e.originalItemId)},a=function(n){var r=p.defer();return t.then(function(){t.progressComplete().then(function(){l.hideDialog(),e.isSaveInProgress=!1,r.resolve(n.item[0])})}),r.promise},i=function(t){D(),P(),e.saveRequestFromModal?e.saveRequestFromModal=!1:C(t)
},o=function(){t.close(),e.serverError=!0};return n.then(r,o).then(a,o).then(i)}},e.back=function(){var r,s=i.path();if(e.reorderModeIsOn)r=s.split("/reorder")[0];else{if(t.addItemSearchResults)return e.cancelAddItemSearch(),void 0;if(!n.keywords)return e.goBack(),void 0;r=s.split("/search")[0]+"/search"}e.goBack(r,!0)},e.cancel=function(){E=!0,e.back()},e.undoIsOn={},e.removedItems={},e.removeItem=function(t){e.showUndo(t),e.removedItems[t]=!0},e.undoRemoveItem=function(t){e.removedItems[t]=!1,e.undoIsOn[t]=!1},e.showUndo=function(t){e.undoIsOn[t]=!0},e.Items={},e.updatedItems={},e.createAndAddItemToJson=function(t,n){e.newItem=n,n.tempId="tempId_"+A++,("Learning Model"===n.mediaType||"Student Voice"===n.mediaType)&&(e.updatedItems[n.tempId]=!0),e.contentItemsListForEdit.splice(t,0,e.newItem)},e.addEmptyNote=function(t){var n={mediaType:"Student Voice",fileType:"TXT",title:"Default Student Voice Title"};e.createAndAddItemToJson(t,n)},e.addEmptyHeader=function(t){var n={mediaType:"Learning Model",fileType:"Sequence",associativeProps:{}};e.createAndAddItemToJson(t,n)},e.saveRequestFromModal=!1,e.addItemFromSearch=function(n){var r,s,a,i,o,l,c=function(){return e.lesson.parentProgramNames?e.lesson.parentProgramNames:e.lesson.library},d=function(){e.selectedFacets={},s=c(),e.selectedSearchItems={ids:{},objects:[]},e.searchParams={NOT_MEDIA_TYPE:["Teacher Support","Tier","Remediation","Learning Model","Student Voice","Lesson","Center Container","Center"],facets:{LIBRARY_TITLE:s}}},m=function(){e.searchProvider=f.PROVIDER.REALIZE,r=new f(e.searchProvider),e.newContentItemPosition=n,d(),angular.forEach(f.PROVIDER,function(e){e=new f(e),e.filterData.remove("search.addItem")})};if(e.isExternalProvider=function(){return e.searchProvider!==f.PROVIDER.REALIZE},t.addItemSearchResults){var p=t.keyStore.get("addItemSearchResults.searchProvider");e.searchProvider=p||f.PROVIDER.REALIZE,e.isExternalProvider()&&(e.externalSearchProviderName=e.searchProvider),r=new f(e.searchProvider),l=r.filterData.get("search.addItem"),e.newContentItemPosition=l.addItemPosition,e.selectedFacets=l.selectedFacets,e.selectedSearchItems=l.selectedSearchItems,e.searchParams=l.searchOptions,e.contentItemsListForEdit=t.keyStore.get("lesson.contentItemsListForEdit")}else m();e.showSearchInstruction=function(t){var n=!1,r=e.queryDone&&!e.noMatchFound;return"top"===t?(e.searchProvider!==f.PROVIDER.REALIZE||r)&&(n=!0):"bottom"===t&&r&&(n=!0),n},e.showExtProviderZeroStateInstruction=function(){return e.isExternalProvider()&&(!e.queryDone||e.noMatchFound)},e.showExtProviderResultsFoundInstruction=function(){return e.isExternalProvider()&&e.queryDone&&!e.noMatchFound},a=e.$on("searchResults.queryCompleted",function(t,n){e.noMatchFound=0===n.resultCount,e.queryDone=!0}),i=e.$on("searchResults.searchProvider.toggled",function(n,r){var s,a=new f(e.searchProvider);a.filterData.set("search.addItem",{searchOptions:e.searchParams,selectedFacets:e.selectedFacets,selectedSearchItems:e.selectedSearchItems}),e.queryDone=!1,e.searchProvider=r,a=new f(e.searchProvider),e.isExternalProvider()&&(e.externalSearchProviderName=e.searchProvider,t.keyStore.add("addItemSearchResults.searchProvider",e.searchProvider)),s=a.filterData.get("search.addItem"),s?(e.selectedSearchItems=s.selectedSearchItems||{ids:{},objects:[]},e.searchParams=s.searchOptions,e.selectedFacets=s.selectedFacets):d()}),o=e.$on("searchResults.exiting",function(r,s){var a=new f(e.searchProvider);s.addItemPosition=n,s.selectedSearchItems=e.selectedSearchItems,a.filterData.set("search.addItem",s),t.keyStore.add("addItemSearchResults.searchProvider",e.searchProvider)}),e.cancelAddItemSearch=function(){a(),i(),o(),t.addItemSearchResults=!1,e.selectedFacets={},e.queryDone=!1,e.totalMatches=10},e.done=function(){e.cancelAddItemSearch();var t=e.selectedSearchItems.objects;angular.forEach(f.PROVIDER,function(n){var r,s;n!==e.searchProvider&&(r=new f(n).filterData.get("search.addItem"),r&&(s=r.selectedSearchItems,s&&(t=t.concat(s.objects))))}),t=_.uniq(t),angular.forEach(t,function(t){e.createAndAddItemToJson(e.newContentItemPosition,t),e.contentItemsListForEdit=_.uniq(e.contentItemsListForEdit),g.addAlert(t.id,{type:"success",msg:[u("editLesson.successNotification.addItem.title"),u("editLesson.successNotification.addItem.message")].join(" ")})})},t.addItemSearchResults=!0},t.addItemSearchResults&&e.addItemFromSearch();var F=new d(function(){return e.saveRequestFromModal=!0,S=!0,e.save()});e.$on("$locationChangeStart",function(n,r){if(e.pageLoaded(),!E){var s=angular.copy(e.contentItemsListForEdit);s=M(s);var a=e.selectedSearchItems&&e.selectedSearchItems.objects.length>0,i=!angular.equals(U,s),o=r.indexOf("/content/")>=0;o?t.keyStore.add("lesson.contentItemsListForEdit",e.contentItemsListForEdit):a||i?F.showDialog(n).catch(function(){t.viewLoading=!1}):t.addItemSearchResults&&(t.addItemSearchResults=!1)}}),e.closeUploadView=function(t){t&&t.preventDefault(),e.uploadView=!1,v=void 0},e.onUploadSuccess=function(t,n){e.createAndAddItemToJson(v,n.item),e.closeUploadView()},e.onUploadFailure=function(e,t){a.error("EditLesson: onUploadFailure type:",e,"error:",t)},e.addContentToLesson=function(t,n){e.uploadView=n,v=t},e.showKeyboardInstDialog=function(t){t.preventDefault(),t.stopPropagation();var n=function(){l.hideDialog()},r=e.$new();r.dialogId="lessonReorderKeyboardInstDialog",r.title=u("global.accessibility.reorder.title"),r.body=u("global.accessibility.reorder.message.lesson"),r.isDismissible=!1,r.closeBtnClickHandler=function(){n()},r.buttons=[{title:u("editLesson.action.ok"),clickHandler:n,isDefault:!0}],r.dismissed=!1,l.showDialog("templates/partials/simpleDialog.html",r)},e.getTitle=function(t){var n=new r(t);return e.lessonTitle=n.$getTitle("original"),e.lessonTitle}}]),angular.module("RealizeApp").controller("LessonCtrl",["$scope","$rootScope","$routeParams","$location","$log","MyContent","Content","LessonContent","AlertService","InlineAlertService","webStorage","$timeout","TEACHER_RESOURCES_DRAWER","MediaQuery","MEDIA_TYPE","lwcI18nFilter","ContentSource","rubricEventTracking","telemetryUtilitiesService","AssignmentUtil","ProgramService","assessmentEventTrackingService","ASSESSMENT_EVENT_TRACKING_CONSTANTS","Assessment","TELEMETRY_CONSTANTS","$filter","addToPlaylistService","playlistUtilService","playlistTelemetryService","PLAYLIST_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v,S,T,A,I,E,y,R,C,D,b,P,w){"use strict";var L=-1!==r.path().search(w.ROUTE.MY_LIBRARY),$=-1!==r.path().search(w.ROUTE.RESOURCE_LISTING);e.passCssClass=w.CSS_CLASS.BROWSE_ALL,e.stateLabels={deselectAll:f("lesson.action.deselectAll"),selectAll:f("lesson.action.selectAll"),assignAll:f("lesson.action.assignAll"),assignSelected:f("lesson.action.assignSelected"),addAllToPlaylist:f("lesson.action.addAllToPlaylist"),addSelectedToPlaylist:f("lesson.action.addSelectedToPlaylist")},e.assignMultiple=R.LESSON_ASSET_MULTI_SELECT.SINGLE,e.multiSelect={assignableItems:{},label:""},e.multiSelect.masterSelected=!1,e.multiSelect.previousMasterSelect=!1,e.isAllItemsTeacherOnly=!0,a.getMultiSelectStatus()?(e.selectDeselect=a.getMultiSelectStatus().label,e.assignLabelText=a.getMultiSelectStatus().assignLabel,e.assignPlaylistLabel=a.getMultiSelectStatus().assignPlaylistLabel):(e.selectDeselect=e.stateLabels.selectAll,e.assignLabelText=e.stateLabels.assignAll,e.assignPlaylistLabel=e.stateLabels.addAllToPlaylist),angular.isDefined(n.programId)&&(e.program=t.currentProgram),e.reuseThumbnails=function(){var t={};e.content.contentItems=e.content.contentItems.map(function(e){return e.contentItems=(e.contentItems||[]).map(function(e){return e.thumbnailUrls=(e.thumbnailUrls||[]).map(function(e){var n=e.split("/").pop(),r=t[n];return r?r:(t[n]=e,e)}),e}),e})},e.content=o;var O=function(e){if(!e)return!1;if(!e.contentItems||!e.contentItems.length)return e.$isAssignable();for(var t=0;t<e.contentItems.length;t++){var n=e.contentItems[t];if(O(n))return!0}return!1};e.isAllItemsTeacherOnly=!O(e.content);var N=u.get("originalItemId");if(u.remove("originalItemId"),N){var M;angular.forEach(e.content.contentItems,function(e){e.mediaType!==p.LEARNING_MODEL?e.id===N&&(M=e):M||(M=C("filter")(e.contentItems,function(e){return e.id===N})[0])});var k=!1;i.getCustomisedVersions(M,k).then(function(t){if(t&&t.length>0){var n=A.addCustomisedItemstoList(t,M.id,e.content.contentItems);e.content.contentItems=n,V(M,n)}})}e.reuseThumbnails();var z=m+e.currentUser.userId;d(function(){var t=u.get(z),n=e.content,r=n&&!_.isEmpty(n.contentItems),s=n&&!_.isEmpty(n.associatedTeacherSupport)&&!_.isEmpty(n.associatedTeacherSupport.contentItems);t&&r&&s&&(e.sidebarOpen=t)}),e.$watch("sidebarOpen",function(e){angular.isDefined(e)&&u.add(z,e)}),e.alertDetails=l.alerts[0],e.alertIsSet=l.alertIsSet(),e.$on("assignmentModal.alert.toggle",function(t,n){if(n.show){e.alertDetails=l.alerts[0],e.alertIsSet=l.alertIsSet();var r=function(){e.alertDetails=n.alertDetails,e.alertIsSet=!0,c.removeAlert()},s=n.assignedItem.id===o.id;s&&r()}else e.alertIsSet=!1}),e.isCustomized="My Uploads"===e.content.contribSource,e.isOriginal=!e.isCustomized,e.showOriginal=!e.content.customizedItemDefaultView,e.isMixedMode=function(){return e.sidebarOpen&&!g.breakpoint.isDesktop},e.isMixedModeSidebarNotOpen=function(){return!g.breakpoint.isDesktop},e.showCustomizedMessage=function(t){return!e.currentUser.isStudent&&!t.$isCustomizedTest()},e.open=function(t,n){var s,i,o="content";"Student Voice"!==n.mediaType&&"Learning Model"!==n.mediaType&&(t.preventDefault(),t.stopPropagation(),s=n.$getDefaultVersion(),i=r.path(),"Adaptive Homework"===n.mediaType&&(o="adaptivehomework"),n.mediaType===p.DISCUSSION_PROMPT&&(o="discussionprompt"),i=n.$isNbcItem()?["/nbclearn/video",n.id,n.version].join("/"):[i,o,s.$getEquellaItemId(),s.version].join("/"),e.multiSelect.assignLabel=e.assignLabelText,e.multiSelect.assignPlaylistLabel=e.assignPlaylistLabel,a.setMultiSelectStatus(e.multiSelect),r.path(i))},e.hasRemediation=function(e){return e&&e.$hasRemediation()},e.viewRemediation=function(e,t){var n;t.stopPropagation(),n=[r.path(),"content",e.id,e.version,"remediation"].join("/"),r.path(n)},e.showRubric=function(t,n){n&&n.stopPropagation(),e.productName?v.clickOnRubricQuickLink(!1,e.productName,t.externalId,t.title):T.getProgramHierarchy(t,t.id).then(function(n){e.productName=S.getProgramTitle(n),v.clickOnRubricQuickLink(!1,e.productName,t.externalId,t.title)}),r.path([r.path(),"content",t.id,t.version].join("/")).search("rubric","true")},e.hiddenContentFilter=function(t){return i.isHiddenViaCustomize(t)||t.originalItem&&i.isHiddenViaCustomize(t.originalItem)||e.currentUser.isStudent&&t.hideFromStudent?!1:!0},e.back=function(t){t.stopPropagation();var s,a=r.path();s=n.keywords?a.split("/search")[0]+"/search":e.isOriginal&&!e.showOriginal?a.split("/lesson/")[0]+"/lesson/"+e.content.customizedItem.id+"/"+e.content.customizedItem.version:a.split("/lesson/")[0],e.goBack(s,!0)},e.openLessonEdit=function(){t.addItemSearchResults=angular.isDefined(t.addItemSearchResults)?t.addItemSearchResults:!1;var e=r.path();r.path(e+"/edit")},e.canUserEditAssessment=e.currentUser.hasRole("ROLE_TEACHER"),e.showOriginalLesson=function(){var t,s=e.content.id,i=r.path();a.getOriginalIdFromCustomized(s).then(function(e){t=n.keywords?i.split("/search")[0]+"/search/lesson/"+e.originalItemId+"/0":i.split("/lesson/")[0]+"/lesson/"+e.originalItemId+"/0",r.path(t)})},e.showCustomizedLesson=function(){var t=e.content.customizedItem.id;s.log("showCustomizedLesson ID",t);var a,i=r.path();a=n.keywords?i.split("/search")[0]+"/search/lesson/"+t+"/"+e.content.customizedItem.version:i.split("/lesson/")[0]+"/lesson/"+t+"/"+e.content.customizedItem.version,r.path(a)},e.openReorderView=function(){var e=r.path();r.path(e+"/reorder")},angular.isDefined(t.addItemSearchResults)&&t.addItemSearchResults&&e.openLessonEdit(),e.isAssignable=function(e){return e.mediaType!==p.STUDENT_VOICE&&e.$isAssignable()},e.toggleSelect=function(){_.each(e.multiSelect.assignableItems,function(t){t.selected=e.multiSelect.masterSelected}),e.checkedItems=_.where(e.multiSelect.assignableItems,{selected:!0}),e.multiSelect.masterSelected===!1?e.setState(!1,e.stateLabels.selectAll):e.multiSelect.masterSelected=!0,e.assignLabelText=e.stateLabels.assignAll,e.assignPlaylistLabel=e.stateLabels.addAllToPlaylist},e.setState=function(t,n){e.multiSelect.masterSelected=t,e.selectDeselect=n,e.multiSelect.label=n},e.checkIfAllSelected=function(){var t=_.where(e.multiSelect.assignableItems,{selected:!1});e.checkedItems=_.where(e.multiSelect.assignableItems,{selected:!0}),e.assignMultiple=R.LESSON_ASSET_MULTI_SELECT.SINGLE,t.length<_.size(e.multiSelect.assignableItems)&&t.length>0?(e.assignMultiple=R.LESSON_ASSET_MULTI_SELECT.ASSIGN_SELECTED,e.setState("mixed",e.stateLabels.deselectAll),e.assignLabelText=e.stateLabels.assignSelected+" ("+e.checkedItems.length+")",e.assignPlaylistLabel=e.stateLabels.addSelectedToPlaylist+" ("+e.checkedItems.length+")"):(t.length===_.size(e.multiSelect.assignableItems)?e.setState(!1,e.stateLabels.selectAll):e.setState(!0,e.stateLabels.selectAll),e.assignMultiple=R.LESSON_ASSET_MULTI_SELECT.ASSIGN_ALL,e.assignLabelText=e.stateLabels.assignAll,e.assignPlaylistLabel=e.stateLabels.addAllToPlaylist)},e.verifyAssignType=function(){e.checkedItems=_.where(e.multiSelect.assignableItems,{selected:!0}),0===e.checkedItems.length?e.assignMultiple=R.LESSON_ASSET_MULTI_SELECT.SINGLE:e.assignMultiple!==R.LESSON_ASSET_MULTI_SELECT.ASSIGN_SELECTED&&e.checkedItems.length===_.size(e.multiSelect.assignableItems)&&(e.assignMultiple=R.LESSON_ASSET_MULTI_SELECT.ASSIGN_ALL)},e.showMultiselect=function(){return _.size(e.multiSelect.assignableItems)>0};var U=function(){var t=a.getMultiSelectStatus();if(t)e.multiSelect=t,a.setMultiSelectStatus(null);else if(!e.currentUser.isStudent){var n=function(t){e.multiSelect.label=e.stateLabels.selectAll,_.forEach(t,function(t){t.mediaType===p.LEARNING_MODEL?n(t.contentItems):e.isAssignable(t)&&(e.multiSelect.assignableItems[t.id]={selected:!1,id:t.id,item:t})})};n(e.content.contentItems)}};U(),e.showAssign=function(){return h.PROVIDER.GOORU===e.searchProvider||e.content.$isAssignable(!0)&&!e.currentUser.isStudent},e.showEditOrRearrange=function(){return!(e.isOriginal&&!e.showOriginal||e.currentUser.isStudent)},e.showCustomize=function(){return e.isOriginal&&!e.showOriginal&&!e.currentUser.isStudent};var F=function(){$?e.passCssClass=w.CSS_CLASS.RESOURCE_LISTING:L&&(e.passCssClass=w.CSS_CLASS.MY_LIBRARY)};F(),e.activateAddToPlaylistModal=function(t,n,r){t&&t.stopPropagation();var s=[];_.forEach(n,function(e){s.push(e.id)});var a={contentIdList:s,cssClass:e.passCssClass,closeAction:function(){e.persistMasterSelectOnCancel(),t.currentTarget.querySelector("a").focus()}},i=e.program?e.program.title:"",o=w.TELEMETRY.PAGE.RESOURCES,l=w.TELEMETRY.PAGE.LEVELED_READER,c=w.TELEMETRY.PAGE.STANDARD_RESULTS,u=w.TELEMETRY.PAGE.BROWSE_ALL,d=b.getOriginPageInfo();d.originPage===o||d.originPage===l||d.originPage===u||d.originPage===c?P.onAddToPlaylistBrowseSearch(d.originPage,d.originSubpage,d.originArea,i):r||P.onAddToPlaylistLessonQuicklink(i),1===n.length&&(a.contentTitle=n[0].title),D.invokeDefaultFlow(a)},e.checkMasterSelectOption=function(){e.verifyAssignType(),e.multiSelect.previousMasterSelect=e.multiSelect.masterSelected,e.multiSelect.masterSelected===!1&&(e.multiSelect.masterSelected=!0,e.toggleSelect());var t=L?"customLesson":"lesson",n=e.program?e.program.title:"";P.onAssignButtonInLessonOrCustomLessonPage({numberOfCheckedItems:e.dataForTelemetry.getNumberOfCheckedItems(),numberOfTotalItems:e.dataForTelemetry.getNumberOfTotalItems()},t,n)},e.checkMasterSelectForAddToPlaylistOption=function(t){e.multiSelect.previousMasterSelect=e.multiSelect.masterSelected,e.multiSelect.masterSelected===!1&&(e.multiSelect.masterSelected=!0,e.toggleSelect());var n=L?"customLesson":"lesson",r=e.program?e.program.title:"";P.onAddToPlaylistButtonInLessonOrCustomLessonPage({numberOfCheckedItems:e.dataForTelemetry.getNumberOfCheckedItems(),numberOfTotalItems:e.dataForTelemetry.getNumberOfTotalItems()},n,r),e.activateAddToPlaylistModal(t,x(e.checkedItems),!0)};var x=function(e){return _.map(e,function(e){return e.item})};e.updateMasterSelectOnSave=function(){e.multiSelect.masterSelected&&(e.multiSelect.masterSelected=!1,e.toggleSelect())},e.persistMasterSelectOnCancel=function(){if(e.multiSelect.previousMasterSelect===!0)e.multiSelect.masterSelected=!0,e.toggleSelect();else{if(e.multiSelect.previousMasterSelect!==!1)return;e.multiSelect.masterSelected=!1,e.toggleSelect()}},e.getAssignmentContent=function(){return e.checkedItems&&1===e.checkedItems.length?e.checkedItems[0].item:B()},e.dataForTelemetry={getNumberOfCheckedItems:function(){return e.checkedItems.length},getNumberOfTotalItems:function(){return _.size(e.multiSelect.assignableItems)}},e.updateTocModel=function(){return e.checkedItems&&1===e.checkedItems.length||e.multiSelect.masterSelected===!0?void 0:_.map(e.checkedItems,function(e){return{itemUuid:angular.isDefined(e.item.originalEquellaItemId)?e.item.originalEquellaItemId:e.item.id,itemVersion:e.item.version}})};var B=function(){var t=angular.copy(e.content);t.contentItems=[];var n=function(r){angular.forEach(r,function(r){if(r.mediaType===p.LEARNING_MODEL)n(r.contentItems);else{var s=_.findWhere(e.checkedItems,{id:r.id});s&&t.contentItems.push(s.item)}})};return n(e.content.contentItems),t};e.disableLessonMenu=!1,e.getVersionInProgress=!1;var V=function(t,n){_.forEach(n,function(n){n.mediaType!==p.LEARNING_MODEL?!e.multiSelect.assignableItems[n.id]&&e.isAssignable(n)&&(e.multiSelect.assignableItems[n.id]={selected:e.multiSelect.assignableItems[t.id].selected?!0:!1,id:n.id,item:n}):_.forEach(n.contentItems,function(n){!e.multiSelect.assignableItems[n.id]&&e.isAssignable(n)&&(e.multiSelect.assignableItems[n.id]={selected:e.multiSelect.assignableItems[t.id].selected?!0:!1,id:n.id,item:n})})}),e.checkIfAllSelected()},H=function(t){var n=[];_.filter(e.content.contentItems,function(e){e.mediaType!==p.LEARNING_MODEL?e.originalItemId===t.id&&n.push(e):e.contentItems&&e.contentItems.filter(function(e){e.originalItemId===t.id&&n.push(e)})}),_.isEmpty(n)||_.forEach(n,function(t){delete e.multiSelect.assignableItems[t.id],e.checkIfAllSelected()})},G=function(t,n){y.getCustomizedVersionCount(t.id).then(function(r){var s={id:n?E.CLOSE:E.OPEN,area:R.EVENT_TYPE.PROGRAMS,page:R.EVENT_TYPE.TABLE_OF_CONTENTS,product:e.program.title,name:E.NAME.ASSESSMENT_VERSIONS_BUTTON,description:t.$getTitle(),value:r};I.sendTelemetryEvents(s)})};e.viewCustomisedVersions=function(t,n){var r=angular.element(n.currentTarget.parentNode.parentNode);if(r.hasClass("quick-list-dropdown-trigger")&&r.find(".dropdown-toggle")[0].click(),n.stopPropagation(),!e.getVersionInProgress)if(t.showCustomisedVersions){e.getVersionInProgress=!0,H(t),e.content.contentItems=A.removeCustomisedItemsfromList(t,e.content.contentItems),e.getVersionInProgress=!1;var s=!0;G(t,s)}else e.getVersionInProgress=!0,i.getCustomisedVersions(t,!1).then(function(n){if(e.getVersionInProgress=!1,n&&n.length>0){var r=A.addCustomisedItemstoList(n,t.id,e.content.contentItems);e.content.contentItems=r,V(t,r);var s=!1;G(t,s)}})};var j=e.$watch("multiSelect.masterSelected",function(){e.disableLessonMenu=!!e.multiSelect.masterSelected});e.$on("$destroy",function(){j()})}]),angular.module("Realize.myContent.myContentCtrl",["ModalServices","Realize.assessment.assessmentDataService","rlzComponents.components.i18n","Realize.paths","Realize.common.alerts","Realize.content","Realize.common.browserInfoService","Realize.constants.fileUploadErrorResponse","Realize.navigationService","Realize.common.optionalFeaturesService","Realize.content.createOptions","Realize.content.upload","Realize.constants.contentUploadTypes"]).controller("MyContentCtrl",["$scope","$routeParams","Content","MyContent","$log","$location","$currentUser","MyContentData","lwcI18nFilter","PATH","AlertService","BrowserInfo","NavigationService","CONTENT_UPLOAD_TYPES",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g){"use strict";e.isIOS5=d.OS.isIOS5,e.myUploads=o,e.subPage=g.CREATE_CONTENT_SUBNAV,e.successReply={uploadFile:r.getSuccessMsgFlag("file"),addLink:r.getSuccessMsgFlag("link"),addTest:r.getSuccessMsgFlag("assessment")},r.clearSuccessMsgFlag(),e.alertDetails=u.alerts[0],e.alertIsSet=u.alertIsSet(),e.$on("assignmentModal.alert.toggle",function(t,n){n.show?(e.alertDetails=u.alerts[0],e.alertIsSet=u.alertIsSet()):e.alertIsSet=!1}),e.containerId=t.programId,e.uploadView=a.path().split("/").pop(),e.uploadView=[g.LINK,g.GOOGLE_DRIVE,g.FILE].indexOf(e.uploadView)>-1?e.uploadView:!1,e.removedItem={},e.undoIsOn={},e.itemRemovedMessage={},e.isEssayPrompt=function(e){return e.essayPrompt},e.showInfoLink=function(t){return!("Tier"===t.mediaType||!t.$hasInfo()||e.isEssayPrompt(t))};var p=function(){return!!(r.getSuccessMsgFlag(g.FILE)||r.getSuccessMsgFlag(g.LINK)||r.getSuccessMsgFlag(g.GOOGLE_DRIVE)||r.getSuccessMsgFlag(g.ASSESSMENT))};e.back=function(e){e&&(e.preventDefault(),e.stopPropagation());var t=a.path(),n="myContent"===t.split("/").reverse()[0],r=t.split("/myContent")[0],s=!0;(p()||!n)&&(r+="/myContent"),m.back(r,s)},e.removeItem=function(t,n){t&&(t.preventDefault(),t.stopPropagation()),e.showUndo(n.id),e.removedItem[n.id]=!0,e.removeMessage(n),r.removeMyUploadsItem(n.id)},e.undoRemoveItem=function(t,n){t&&(t.preventDefault(),t.stopPropagation()),r.undoRemoveMyUploadsItem(n,e.containerId).then(function(){e.removedItem[n]=!1,e.undoIsOn[n]=!1})},e.showUndo=function(t){e.undoIsOn[t]=!0},e.removeMessage=function(t){e.itemRemovedMessage[t.id]=e.isEssayPrompt(t)?l("myContent.essayPromptRemoved.message"):l("myContent.itemRemoved.message")},e.open=function(t,n){if(t.preventDefault(),t.stopPropagation(),!e.removedItem[n.id]){var r,s=a.path();n.$isNbcItem()?s=["/nbclearn/video",n.id,n.version].join("/"):(r=n&&n.customizedItem&&n.customizedItemDefaultView?n.customizedItem.id:n.id,s=[s,"content",r,n.version].join("/")),a.path(s)}},e.closeUploadView=function(t){t.preventDefault(),e.back()},e.onUploadSuccess=function(t,r){var s=new n(r.item);e.myUploads.unshift(s),e.back()},e.onUploadFailure=function(e,t){s.error("onUploadFailure type:",e,"error:",t)}}]),angular.module("Realize.myContent",["Realize.myContent.myContentCtrl","Realize.myContent.myContentDataService","Realize.myContent.routes"]),angular.module("Realize.myContent.routes",["Realize.paths"]).config(["$routeProvider","PATH",function(e,t){"use strict";var n=["$q","$currentUser",function(e,t){var n=t.hasRole("ROLE_TEACHER");return n?e.when(1):e.reject("Insufficient Privileges!")}],r={controller:"MyContentCtrl",templateUrl:t.TEMPLATE_ROOT+"/app/programs/toc/myContent/myContent.ctrl.html",resolve:{_security:n,MyContentData:["Resolve",function(e){return e.MyContent()}]}},s={template:"<my-library-upload></my-library-upload>",resolve:{_security:n}},a="/program/:programId/:programVersion",i="/tier/:tierId/:tierVersion",o=i+"/tier2/:tier2Id/:tier2Version",l=[{route:a,supportsMyContent:!0},{route:a+i,supportsMyContent:!0},{route:a+o,supportsMyContent:!0},{route:a+"/standards/lastSelectedGrade/:lastSelectedGrade/search/:stateStandard",supportsMyContent:!1},{route:a+"/standards/lastSelectedGrade/:lastSelectedGrade/search/:stateStandard/:nationalLibrary",supportsMyContent:!1},{route:"/search",supportsMyContent:!1},{route:"/search/standard/:stateStandard",supportsMyContent:!1}];angular.forEach(l,function(t){var n=t.route;t.supportsMyContent&&e.when(n+"/myContent",r).when(n+"/myContent/googleDrive",r).when(n+"/myContent/link",r).when(n+"/myContent/file",r)}),e.when("/myLibrary/file",s).when("/myLibrary/link",s)}]),angular.module("Realize.myContent.myContentDataService",["Realize.paths","Realize.api","rlzComponents.components.myLibrary.services.myContent"]).factory("MyContent",["$http","$q","$log","$rootScope","REST_PATH","myContentService",function(e,t,n,r,s,a){"use strict";var i=function(){};return i.get=function(e){return a.get(e)},i.removeMyUploadsItem=function(e){return a.removeMyUploadsItem(e)},i.undoRemoveMyUploadsItem=function(e,t){return a.undoRemoveMyUploadsItem(e,t)},i.addContentItemToMyLibrary=function(e,t){return a.addContentItemToMyLibrary(e,t)},i.makeDefaultView=function(e,t,n){return a.makeDefaultView(e,t,n)},i.getOriginalIdFromCustomized=function(e){return a.getOriginalIdFromCustomized(e)},i.buildStringOriginalIdCustomizedIdForItem=function(e){return a.buildStringOriginalIdCustomizedIdForItem(e)},i.getCustomToOriginalIdMap=function(){var t=s+"/item/originalItemId/list",n=e.get(t).then(function(e){return e.data});return n},i.setSuccessMsgFlag=function(e,t){i.updateNotifications||(i.updateNotifications={}),i.updateNotifications[e]=t},i.getSuccessMsgFlag=function(e){return i.updateNotifications||(i.updateNotifications={}),i.updateNotifications[e]},i.clearSuccessMsgFlag=function(){i.updateNotifications={}},i.getMultiSelectStatus=function(){return i.checkBoxList},i.setMultiSelectStatus=function(e){i.checkBoxList=e},i}]),angular.module("Realize.content.upload",["Realize.constants.contentUploadTypes","Realize.constants.fileUploadErrorResponse","Realize.paths","Realize.content","rlzComponents.components.i18n","Realize.alerts.inlineAlertService","Realize.myContent.myContentDataService"]).directive("uploadContent",["$log","$location","$routeParams","Modal","REST_PATH","PATH","InlineAlertService","lwcI18nFilter","MyContent","Content","FormService","FILE_UPLOAD_ERROR_RESPONSE","CONTENT_UPLOAD_TYPES",function(e,t,n,r,s,a,i,o,l,c,u,d,m){"use strict";return{scope:{uploadType:"@",closeUploadView:"&",containerId:"@",onUploadSuccess:"&",onUploadFailure:"&"},templateUrl:a.TEMPLATE_CACHE+"/app/programs/toc/myContent/uploadContent.dir.html",link:function(t){t.isFileUpload=t.uploadType===m.FILE,t.isLinkUpload=t.uploadType===m.LINK,t.isGoogleDrive=t.uploadType===m.GOOGLE_DRIVE,t.showTermsofUse=t.isFileUpload||t.isGoogleDrive,t.serverError=!1,t.googleDriveMessage=o("googleIntegrations.googleDrive.additionalMessage"),t.item={filename:o("attachmentModal.action.noFileChosen")},t.actionText=o(t.isFileUpload?"myContent.action.upload":"myContent.action.add");var n,a=!1,c=function(e){var n=[];return n=t.isFileUpload?["file","title","agreedToTerms"]:t.isLinkUpload?["url","title"]:["url","title","agreedToTerms"],e&&n.push("text"),n},g=c(),p=c(!0),f=function(){var e="myContent.successNotification.type.message",n="fileUploaded";return t.isGoogleDrive?n="driveFileAdded":t.isLinkUpload&&(n="linkAdded"),{type:"success",msg:["<strong>",o("myContent.successNotification.linkAdded.title"),"</strong> ",o(e.replace("type",n))]}},h=function(e){i.addAlert(e,f())},v=function(){n=r.progressDialog(t.$new(!0),{progressHeader:o("myContent.uploadProgress.title"),progressMessage:o("myContent.uploadProgress.message")}).then(function(){n.fakeProgress(500)})},S=function(e){e||(t.uploadInProgress=e),n&&e?n.then(function(){return n.progressComplete()}).then(function(){r.hideDialog()}):n&&!e&&(r.hideDialog(),n.$destroy())},T=function(e){l.setSuccessMsgFlag(t.uploadType,!0),h(e.item.id),S(!0),t.onUploadSuccess({type:t.uploadType,data:e})},A=function(e){S(!1),t.onUploadFailure({type:t.uploadType,error:e})},I=function(e){var n={title:e.title,text:e.text||"",fileType:"URL",mediaType:"Link",externalSource:t.isGoogleDrive?m.GOOGLE_DRIVE:""},r={url:e.url,json:angular.toJson(n)};v(),l.addContentItemToMyLibrary(r,t.containerId).then(T,A)},E=function(n){t.validateForm()&&(e.log("LINK SUBMITTED",n),I(n))},y=function(n){if(e.error("upload file error:",n),S(!1),t.uploadInProgress=!1,200===n.status)return t.serverError=!0,void 0;var r,s=t.uploadContentForm.file;n.responseText.trim()===d.AV_SCAN_RESPONSE_TEXT?(s.$setValidity("isVirusFree",!1),r=n):r=angular.fromJson(n.responseText)||n,"500"===r.errorCode||"aborted"===r.error?t.serverError=!0:"filesize"===r.errorCode&&s.$setValidity("size",!1),t.onUploadFailure({type:t.uploadType,error:n})},R=function(n,r){e.log("onAjaxSubmit",n,r),t.uploadContentForm.file.$setValidity("isVirusFree",!0),v(),r.then(T,y)},C=function(){return t.isFileUpload&&!u.isFormContainingAnyNonEmptyFields(t.uploadContentForm,["file"])},D=function(){return!u.isFormContainingAnyNonEmptyFields(t.uploadContentForm,p)},b=function(){return a||(a=g.every(function(e){return angular.isDefined(t.uploadContentForm[e])})),a};t.showHideChooseFileError=function(){var e=t.uploadContentForm.file;return t.isFileUpload&&(e.$error.required||e.$error.filetype||e.$error.fileName||e.$error.size||e.$error.isVirusFree||e.$error.minFileSize)},t.validateForm=function(){return u.setFormFieldsDirty(t.uploadContentForm,g),t.uploadInProgress=t.uploadContentForm.$valid,t.$applyAsync(),t.uploadInProgress},t.validateUploadFileForm=function(){return t.isFileUpload&&t.validateForm()},t.openUserAgreement=t.showTermsofUse?u.openUserAgreement:angular.noop,t.isFileUpload?(t.enctype="multipart/form-data",t.getUploadFileData=u.getUploadFileData,t.getFileUploadUrl=function(){return s+"/item/upsert/myLibraryContentItem/"+t.containerId+"?file="+t.uploadContentForm.file},t.$on("onAjaxSubmit",R),t.getFileUploadErrorMessage=function(){var e=t.uploadContentForm.file;return e.$error.required?o("myContent.uploadFileForm.file.error.required"):e.$error.filetype?o("myContent.uploadFileForm.file.error.fileTypeNotSupported"):e.$error.fileName?o("myContent.uploadFileForm.file.error.fileNameNotSupportedChar"):e.$error.size?o("myContent.uploadFileForm.file.error.fileOverSizeLimit"):e.$error.isVirusFree?o("myContent.uploadFileForm.file.error.isVirusFree"):e.$error.minFileSize?o("myContent.uploadFileForm.file.error.fileMinSizeLimit"):""}):t.submitLink=E,t.isUploadButtonDisabled=function(){return t.uploadInProgress||!b()||D()||!C()&&t.showHideChooseFileError()},t.onDrive=function(e){e.length&&(t.item.url=e[0].url,t.item.filename=t.item.title=e[0].name)}}}}]),angular.module("RealizeApp").controller("RemediationCtrl",["$scope","$location","$log","AlertService","AssignmentUtil","Modal","rubricEventTracking","RemediationViewerData","telemetryUtilitiesService","TEMPLATE_PATH",function(e,t,n,r,s,a,i,o,l){"use strict";e.content=o,s.setRemediationContainerDetails(e.content),e.excludeSV=function(e){return!e.$isStudentVoice()},e.open=function(e,n){var r;n&&(n.stopPropagation(),n.preventDefault()),r=[t.path(),e.id,e.version].join("/"),t.path(r)},e.back=function(r){r.stopPropagation();var s=t.path(),a=s.split("/content/")[0];n.log("BACK BUTTON!",s,a),e.goBack(a,!0)},e.showRubric=function(e,n){n&&n.stopPropagation(),c(e),t.path([t.path(),e.id,e.version].join("/")).search("rubric","true")};var c=function(t){var n=!1;e.productName?i.clickOnRubricQuickLink(n,e.productName,t.externalId,t.title):s.getProgramHierarchy(t,t.id).then(function(r){e.productName=l.getProgramTitle(r),i.clickOnRubricQuickLink(n,e.productName,t.externalId,t.title)})};e.viewAssociatedQuestions=function(t,r){t.stopPropagation(),n.log("view questions for skill ",r);var s=e.$new();s.questions=r.associatedQuestions,s.close=function(){a.hideDialog(),s.$destroy()},a.showDialog("templates/partials/questions_for_skill_modal.html",s)},e.alertDetails=r.alerts[0],e.alertIsSet=r.alertIsSet(),e.$on("assignmentModal.alert.toggle",function(t,n){n.show?(e.alertDetails=r.alerts[0],e.alertIsSet=r.alertIsSet()):e.alertIsSet=!1})}]),angular.module("RealizeApp").controller("TierCtrl",["$scope","$rootScope","$location","$log","Content","TierContent","$route","MediaQuery",function(e,t,n,r,s,a,i,o){"use strict";e.program=t.currentProgram,e.content=a,e.isMixedMode=function(t){return"list"===t&&e.sidebarOpen&&!o.breakpoint.isDesktop},e.back=function(){var t,r,s=!0;i.current.params.itemId?(/\/tier2/.test(n.path())?(r=n.path().split("/tier2"),r.pop(),t=r.join("/tier2")):/\/tier/.test(n.path())?(r=n.path().split("/tier"),r.pop(),t=r.join("/tier")):t=n.path(),e.goBack(t,s)):e.goBack()}}]),angular.module("Realize.comment.listComment",["Realize.paths","rlzComponents.components.i18n","Realize.comment.commentsApiService","Realize.comment.writeCommentForm","Realize.Comment.DisplayTime","Realize.common.alerts","Realize.user.currentUser","ngSanitize"]).directive("listComment",["$log","PATH",function(e,t){"use strict";
return{restrict:"EA",templateUrl:t.TEMPLATE_CACHE+"/assignment/comment/commentsWidget/listComment/listComment.dir.html",controller:"ListCommentsCtrl",controllerAs:"listCommentsCtrl"}}]).controller("ListCommentsCtrl",["$scope","$log","$currentUser","InlineAlertService","lwcI18nFilter","commentsApiService",function(e,t,n,r,s,a){"use strict";function i(){e.commentsList.forEach(function(e){e.isInEditMode=!1})}this.deletePost=function(n){a.deletePost(n.boardId,n.id).then(function(){n.isDeleted=!0,e.$emit("ListCommentsCtrl.deletePost")},function(e){t.error("Error %s in deleting the post: %s",e,n.id)})},this.unDeletePost=function(n){a.unDeletePost(n.boardId,n.id).then(function(){n.isDeleted=!1,e.$emit("ListCommentsCtrl.unDeletePost")},function(e){t.error("Error %s in undo deleting the post: %s",e,n.id)})},this.canDelete=function(e){return n.userId===e.author||n.isTeacher},this.editPost=function(t,n){t&&t.preventDefault(),i(),n.isInEditMode=!0,e.$emit("listcomment.post.editmode")},this.canEdit=function(e){return n.userId===e.author},e.$on("writecomment.post.update",function(t,n){var a=e.commentsList.filter(function(e){return e.isInEditMode})[0];angular.extend(a,n),a.isInEditMode=!1,r.addAlert(a.id,{type:"success",msg:["<strong>",s("comment.successNotification.postComment.title"),"</strong>",s("comment.successNotification.editComment.message")].join("")})}),e.$on("writecomment.post.cancel",function(e){e.preventDefault(),i()})}]),angular.module("Realize.comment.writeCommentForm",["Realize.paths","rlzComponents.components.i18n","Realize.comment.commentsApiService"]).directive("writeCommentForm",["$log","PATH",function(e,t){"use strict";return{restrict:"EA",templateUrl:t.TEMPLATE_CACHE+"/assignment/comment/commentsWidget/writeComment/writeCommentForm.dir.html",scope:{userAssignmentId:"@?",boardId:"@?",postId:"@?",postText:"@?"},controller:"WriteCommentsFormCtrl",controllerAs:"writeCommentsFormCtrl"}}]).controller("WriteCommentsFormCtrl",["$q","$scope","$log","commentsApiService",function(e,t,n,r){"use strict";function s(e){r.createPost(e,c).then(function(e){t.$emit("writecomment.post.comment",e)}).catch(function(e){t.$emit("writecomment.post.error",e)})}function a(){c?s(o.writtenComment):l&&r.createNewBoard(u).then(function(e){c=e,l=!1,s(o.writtenComment)}).catch(function(e){t.$emit("writecomment.boardcreate.error",e)})}function i(){r.updatePost(c,d,o.writtenComment).then(function(e){t.$emit("writecomment.post.update",e)}).catch(function(e){t.$emit("writecomment.post.error",e)})}var o=this,l=!1,c=t.boardId,u=t.userAssignmentId,d=t.postId,m=t.postText;this.isEditMode=angular.isDefined(d)&&angular.isDefined(m),this.postCancel=function(){t.$emit("writecomment.post.cancel")},c||(!u||this.isEditMode?(this.isEditMode?n.warn("WriteCommentForm requires boardId and postId when editing a comment"):n.warn("WriteCommentForm requires either boardId or userAssignmentId"),this.postCancel()):r.getBoardId(u).then(function(e){c=e}).catch(function(e){e===r.NON_EXISTANT_BOARD_ERROR&&(l=!0)})),this.isEditMode&&(this.writtenComment=m),this.saveComment=_.throttle(function(){this.isEditMode?i():a()}.bind(this),1e3,{trailing:!1})}]),angular.module("Realize.alerts.alertDirective",["Realize.paths"]).value("ALERT_TTL",5e3).directive("alert",["$log","PATH","ALERT_TTL",function(e,t,n){"use strict";return{transclude:!0,scope:{alertType:"@",alertOn:"=?",alertEvent:"@?"},templateUrl:t.TEMPLATE_ROOT+"/common/alerts/directives/alert/alert.dir.html",link:function(t,r,s){var a,i=function(){t.$applyAsync(function(){t.alertOn=!1})},o=[];t.alertClosable=angular.isDefined(s.alertClosable),t.alertNoFloat=angular.isDefined(s.alertNoFloat),t.alertEvent&&t.$on(t.alertEvent,function(n){e.debug(n),t.alertOn=!0}),t.$watch("alertOn",function(e){var l;e&&t.$eval(s.autoClose)&&(l=setTimeout(i,n),o.push(l)),e&&t.alertClosable&&(a=r.find(".close"),a.on("click",i))}),t.$on("$destroy",function(){a&&a.off("click",i),o.forEach(function(e){clearTimeout(e)})})}}}]),angular.module("Realize.alerts.firstVisitAlertDirective",["Realize.paths","rlzComponents.components.i18n"]).directive("firstVisitAlert",["$log","PATH",function(e,t){"use strict";return{replace:!0,scope:{title:"=firstVisitAlert",description:"=",instruction:"=?",closeFn:"="},templateUrl:t.TEMPLATE_ROOT+"/common/alerts/directives/firstVisitAlert/firstVisitAlert.dir.html"}}]),angular.module("Realize.alerts.inlineNotificationDirective",["Realize.alerts.inlineAlertService"]).directive("inlineNotification",["$log","$timeout","InlineAlertService",function(e,t,n){"use strict";return{link:function(r,s,a){function i(e){var n,i,o,u,d=angular.element(l).append(e.alert.msg),m=e.alert.type;o=t(function(){var e=!!a.inlineNotificationRowTarget,t=!!a.inlineNotificationTarget;i=e?s.find(a.inlineNotificationRowTarget):s,n=t?i.find(a.inlineNotificationTarget):i,i.addClass(m+"Row"),i.hasClass("itemRow")||i.parent().addClass(m+"Row"),n.prepend(d)},1),u=t(function(){var e=n.find(".success-message");e.fadeOut(function(){e.remove(),i.removeClass(m+"Row"),i.hasClass("itemRow")||i.parent().removeClass(m+"Row")})},c),r.$on("$destroy",function(){t.cancel(o),t.cancel(u)})}var o,l='<div class="success-message" role="alert" aria-live="assertive"></div>',c=4e3;r.$eval(a.isInlineNotificationInterpolated)?(o=a.inlineNotification,a.$observe("inlineNotification",function(e){o=e})):(o=r.$eval(a.inlineNotification),r.$watch(a.inlineNotification,function(e){o=e})),r.$watch(function(){return n.getAlert(o,!0)},function(t){t&&(e.debug("new alert",t),i(t))})}}}]),angular.module("Realize.alerts.messageBasedAlertDirective",["Realize.paths","Realize.alerts.alertService"]).directive("messageBasedAlert",["$timeout","$rootScope","PATH","AlertService",function(e,t,n,r){"use strict";return{replace:!0,scope:{autoClose:"=",alertMessageDetails:"=",alertOn:"="},templateUrl:n.TEMPLATE_ROOT+"/common/alerts/directives/messageBasedAlert/messageBasedAlert.dir.html",link:function(t,n){var s=function(){t.$apply(function(){t.alertOn=!1,t.alertMessageDetails=null,r.alerts.splice(0,1)})};t.$watch("alertMessageDetails",function(){if(t.alertMessageDetails&&t.autoClose){$(n).show();var r=e(function(){$(n).fadeOut("slow",s)},5e3);t.$on("$destroy",function(){e.cancel(r)})}})}}}]),angular.module("Realize.assessment.assessmentCreateCtrl",["Realize.assessment.assessmentDataService","Realize.assessment.questionsInTestService","Realize.analytics","Realize.content.contentDataService","Realize.content.model.contentItem","components.alert","rlzComponents.components.i18n","rlzComponents.components.myLibrary.myLibraryEventTracking","rlzComponents.components.myLibrary.constants"]).controller("AssessmentCreateCtrl",["$scope","$location","Analytics","Assessment","$log","BankPlayerTargetMap","Content","ContentDataService","ProgramListInfo","QuestionsInTestService","lwcI18nFilter","Toast","myLibraryEventTracking","MY_LIBRARY_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g){"use strict";a&&(e.hasNonNativeBank=a.hasNonNative,e.hasNativeBank=a.hasNative);var p={showCloseIcon:!0,autoClose:!1,msg:["<strong>",u("assignmentViewer.turnInModal.alertMessages.error.message1"),"</strong> ",u("assignmentViewer.turnInModal.alertMessages.error.message2")].join("")},f=0===t.path().search("/myLibrary"),h=!1,v=!1;e.shouldShowProgramSelection=f&&l.programs,e.programs=e.shouldShowProgramSelection&&l.programs,e.onProgramSelection=function(t,n){e.currentProgram={},e.hasNonNativeBank=void 0,e.hasNativeBank=void 0,S(),v=!0,h=!1,e.isInProgress=!0,e.programId=t,e.programVersion=n,i.get({contentId:t,version:n}).then(function(t){e.currentProgram=t,o.getAvailableBankPlayerTargetMap(e.currentProgram.library).then(function(t){h=!0,e.hasNonNativeBank=t.hasNonNative,e.hasNativeBank=t.hasNative,e.isInProgress=!1}).catch(function(){d.close(),d.error(p)})})};var S=function(){e.assessment&&(e.assessment.isMastery=null,e.assessment.useBank=null,e.assessment.testType=null,e.showFormError=!1)};e.shouldShowAssessmentMastery=function(){return f&&h||!f};var T=function(e){n.track("track.action",{category:"Programs",action:"Build a test",label:e})},A=function(){return e.hasNonNativeBank&&!e.hasNativeBank?(T("From a bank of questions (non-native)"),e.assessment.useBank||T("Write my own questions"),void 0):e.hasNativeBank&&!e.hasNonNativeBank?(T("From a bank of questions (native)"),void 0):(T("From a bank of questions (native or non-native)"),void 0)};e.next=function(){if(e.showErrorAlert=!1,e.showFormError=!0,e.createAssessmentForm.$invalid||f&&!v)e.showErrorAlert=!0;else{if(f){var n=e.assessment.isMastery?g.TELEMETRY_EVENT.YES:g.TELEMETRY_EVENT.NO;m.onClickNextTBAT(e.currentProgram.title,n)}e.isInProgress=!0;var a={title:e.assessment.title,description:e.assessment.description,isMastery:e.assessment.isMastery};a.isNative=!e.hasNativeBank&&e.hasNonNativeBank?!e.assessment.useBank:!0,a.testType=a.isNative?e.assessment.testType.toUpperCase():"TEST",r.createAssessment(e.currentProgram.id,a).then(function(n){var i,o=t.path().split("/assessment/")[0],l=a.isNative?"edit":"addQuestionBank";/\/myLibrary$/.test(o)?o=[o,"program",e.programId,e.programVersion,"assessment"].join("/"):o+=/\/myContent$/.test(o)?"/assessment":"/myContent/assessment",i=[o,n.id,n.version,l].join("/"),angular.isDefined(n.details)&&angular.isDefined(n.details.id)&&r.loadAssessment(n.details.id).then(function(e){c.setQuestionsInTestCollection(e)},function(e){s.error("Failed to load questions for an assessment",e)}),t.path(i)})}A()},e.shouldShowSelectAssessmentType=function(){return f&&h&&e.canSelectAssessmentType()||!f&&e.canSelectAssessmentType()},e.canSelectAssessmentType=function(){var t=!e.hasNonNativeBank&&!e.hasNativeBank;return t||e.hasNativeBank||e.hasNonNativeBank&&e.assessment&&e.assessment.useBank===!1},e.back=function(){var n=t.path().split("/assessment/")[0];e.goBack(n)},e.cancel=function(){e.back(),r.isNewTest=!1},e.shouldShowSpinner=function(){return f&&!h&&v},e.shouldShowAssessmentBank=function(){var t=!e.hasNativeBank&&e.hasNonNativeBank;return f&&h&&t||!f&&t},e.shouldShowProgramSelectionError=function(){return e.showFormError&&!v},e.$on("$destroy",function(){d.close()})}]),angular.module("Realize.assessment.essayPromptCtrl",["Realize.assessment.assessmentDataService","rlzComponents.components.contentList.service.helper","rlzComponents.components.myLibrary","rlzComponents.components.myLibrary.constants"]).controller("EssayPromptCtrl",["$scope","$location","Assessment","InlineAlertService","lwcI18nFilter","$log","resolveEssayPromptBuilder","myLibraryEventTracking","contentListHelperService","MY_LIBRARY_CONSTANTS",function(e,t,n,r,s,a,i,o,l,c){"use strict";function u(e,t){var n="essayPrompt.successNotification.createdPrompt.",a=n+e+".title",i=n+e+".message";r.addAlert(t,{type:"success",msg:["<strong>",s(a),"</strong>",s(i)].join(" ")})}function d(n,r,s){angular.isDefined(n.details)&&angular.isDefined(n.details.id)&&setTimeout(function(){e.$evalAsync(function(){u(r,n.id),t.path(s)})},g)}var m=this,g=1e3;m.essayPrompt={},m.essayPromptContent=i,m.showHeadsUpModal=m.essayPromptContent.isNewTest,m.initialpage=1,m.save=function(){if(0===t.path().search("/myLibrary")){var r=m.essayPrompt.grade===c.TELEMETRY_EVENT.LOW?c.TELEMETRY_EVENT.LOW_LEVEL:c.TELEMETRY_EVENT.HIGH_LEVEL;o.onWriteEssayPrompt(r)}var s;return m.showHeadsUpModal=!1,m.showFormError=!0,m.essayPromptForm.$invalid?(m.showErrorAlert=!0,void 0):(m.showErrorAlert=!1,m.isInProgress=!0,s={title:m.essayPrompt.promptTitle,prompt:m.essayPrompt.promptDescription,grade:m.essayPrompt.grade,essayPromptType:m.essayPrompt.promptType},m.isFromMyLibraryPage=t.path().search("myLibrary")>0,m.currentProgramId=m.isFromMyLibraryPage?e.currentUser.userId:e.currentProgram.id,m.redirectPath=m.isFromMyLibraryPage?"/myLibrary":"/myContent",m.replacePath=m.isFromMyLibraryPage?"/myLibrary/essayPrompt":"/assessment/essayPrompt",m.essayPromptContent.isNewTest?n.createEssayPrompt(m.currentProgramId,s).then(function(e){m.isFromMyLibraryPage&&(l.setSelectedFacets(void 0),l.setSearchKeyWord(void 0),l.setCurrentPageIndex(m.initialpage)),d(e,"success",t.path().replace(m.replacePath,m.redirectPath))},function(e){a.error("Failed to create essay prompt",e),m.isInProgress=!1}):n.editEssayPrompt(m.essayPromptContent.id,s).then(function(e){d(e,"edit",t.path().split("/assessment/essay")[0])},function(e){a.error("Failed to edit essay prompt",e),m.isInProgress=!1}),void 0)},m.essayPrompt.promptTitle=m.essayPromptContent.isNewTest?"":m.essayPromptContent.questions[0].essayPrompt.title,m.essayPrompt.promptDescription=m.essayPromptContent.isNewTest?"":m.essayPromptContent.questions[0].essayPrompt.prompt,m.essayPrompt.grade=m.essayPromptContent.isNewTest?"low":m.essayPromptContent.questions[0].essayPrompt.grade,m.essayPrompt.promptType=m.essayPromptContent.isNewTest?"argument":m.essayPromptContent.questions[0].essayPrompt.essayPromptType,m.back=function(){e.goBack(t.path().split("/assessment/")[0])},m.cancel=function(){m.back()}}]),angular.module("Realize.assessment.questionBank",["Realize.assessment.addQuestionBankCtrl","Realize.assessment.searchBanksByTopicDirective","Realize.assessment.questionBankDataService","Realize.assessment.questionBankResultDirective","Realize.assessment.questionBankResultService","Realize.assessment.questionBankItemDirective","Realize.assessment.searchBanksByStandard","Realize.assessment.questionsInTestService"]),angular.module("Realize.eText2Builder.eText2CreateCtrl",["rlzComponents.components.i18n","Realize.navigationService","Realize.eText2Builder.eText2BuilderService"]).controller("EText2CreateCtrl",["$scope","$log","$location","NavigationService","EText2BuilderService","eText2Data",function(e,t,n,r,s,a){"use strict";this.etexts=a,this.eText2Selection={},this.next=function(){if(this.serverError=!1,!this.createEText2SelectionForm.$invalid){this.isInProgress=!0;var n={title:this.eText2Selection.title,text:this.eText2Selection.instructions||"",fileType:"Sequence",mediaType:"Selected Reading",isbn:this.getETextIsbn(),programs:e.currentProgram.programs};s.createEText2Selection(e.currentProgram.id,n).then(function(){this.isInProgress=!1}.bind(this),function(e){this.serverError=!0,this.isInProgress=!1,t.error("Failed to create reading selection.",e)}.bind(this))}},this.back=function(){var e=n.path().split("/eText2/")[0];r.back(e)},this.cancel=function(){this.back()},this.getETextIsbn=function(){var e,t,n;return e=this.eText2Selection.etext,t=e.fileLocation,n=t.indexOf("/books/")>-1?t.substring(t.indexOf("/books/")).split("/")[2]:""},this.isOneETextAvailable=function(){return 1===this.etexts.length?(this.eText2Selection.etext=this.etexts[0],this.createEText2SelectionForm.$setDirty(),!0):!1},this.isNextDisabled=function(){return this.createEText2SelectionForm.$invalid||this.isInProgress},this.isETextTitleEmpty=function(){return this.createEText2SelectionForm.title.$invalid&&this.createEText2SelectionForm.title.$dirty},this.selectETextItem=function(e){this.eText2Selection.etext=e}}]),angular.module("Realize.assessment.addQuestionBankCtrl",["Realize.content.constants","rlzComponents.components.i18n","Realize.user.currentUser","Realize.paths","Realize.analytics","Realize.assessment.searchBanksByStandardDirective","Realize.assessment.searchBanksByTopicDirective","Realize.assessment.searchByStandardService","Realize.assessment.searchQuestionBankDataService","Realize.common.itemListDirective","Realize.myContent.myContentDataService","Realize.assessment.assessmentDataService","Realize.assessment.questionsInTestService"]).controller("AssessmentAddQuestionBankCtrl",["$scope","$rootScope","$location","lwcI18nFilter","$log","$routeParams","Analytics","CONTENT_CONSTANTS","QuestionBankDataService","$currentUser","AssessmentInfo","PATH","StandardsTreeData","SearchByStandardService","SearchQuestionBankDataService","MyContent","Assessment","QuestionsInTestService",function(e,t,n,r,s,a,i,o,l,c,u,d,m,g,p,f,h,v){"use strict";e.assessmentInfo=u,v.assessmentId=u.assessmentId;var S=function(t){var n=(e.currentPage-1)*e.pageSize;e.searchResult=t,e.startIndex=n+1,e.endIndex=n+t.questionBanks.length,e.totalBanks=t.totalQuestionBanks},T=function(t){e.totalQuestions=t},A=function(t){e.currentPage=1,e.currentSearch={standards:t.standards,programLibraries:t.programLibraries}},I=function(t){e.currentPage=1,e.currentSearch={keyword:t.keyword,programLibraries:t.programLibraries}},E=function(t){e.assessmentInfo.questionCount=t},y=function(t){"searchByStandard"===e.activeTab?R(t):C(t)},R=function(t){var n={programs:e.currentSearch.programLibraries,standards:e.currentSearch.standards,page:t,pageSize:e.pageSize,calculateTotalAvailableQuestions:!1};return p.getAvailableQuestionBanks(n).then(function(n){e.currentPage=t,S(n),l.restoreSelectedQuestionBank(n.questionBanks,v.doParseQuestionsInTestCollection()),e.pageLoaded()})},C=function(t){var n={programs:e.currentSearch.programLibraries,keyword:e.currentSearch.keyword,page:t,pageSize:e.pageSize,calculateTotalAvailableQuestions:!1};return l.getAvailableQuestionBanks(n).then(function(n){e.currentPage=t,S(n),l.restoreSelectedQuestionBank(n.questionBanks,v.doParseQuestionsInTestCollection()),e.pageLoaded()})},D=function(){var n=v.assessmentId,r=v.transformQuestionsInTestCollection(),a=v.isQuestionsInTestCollectionChanged();n&&r&&(t.pageLoading(),h.putQuestionsInAssessment(n,r).then(function(){t.pageLoaded(),e.$emit("questionBankResult.addQuestion.done"),h.updateEquellaItemTimestamp(e.assessmentInfo.assessmentId),a&&e.assessmentInfo&&e.assessmentInfo.active===!1&&e.assessmentInfo.originalId&&(f.makeDefaultView(e.assessmentInfo.itemId,!0,!0),e.assessmentInfo.active=!0)},function(e){t.pageLoaded(),s.error("Failed to load questions for an assessment",e)})),v.questionsInAssessment=r},b=function(){e.hasResult=!1,e.hasPerformedSearch=!1},P=function(t,n){s.log("New search result",n),e.hasPerformedSearch=!0,l.restoreSelectedQuestionBank(n.questionBanks,v.doParseQuestionsInTestCollection()),e.$broadcast("addQuestionBank.selectedQuestion.reset"),0!==n.totalQuestionBanks?(e.hasResult=!0,S(n),T(n.totalQuestionsAvailable)):(e.hasResult=!1,e.searchResult=null)},w=function(e){i.track("track.action",{category:"Programs",action:"Build a test",label:e})};e.standardsTreeData=m,e.activeTab="searchByStandard",e.hasPerformedSearch=!1,e.currentPage=1,e.pageSize=o.SEARCH_RESULT_PAGE_SIZE,e.searchCompleted=function(){return e.hasPerformedSearch&&e.hasResult},e.getSelectedStandards=function(){return g.getSelectedStandardList()},e.showTab=function(t){v.putQuestionsInAssessment(),e.activeTab=t,b()},e.back=function(){var t=/\/myLibrary\/program/,r=n.path().split("/assessment/")[0],s=n.path().indexOf("insert")>-1?!1:!0;t.test(r)&&(r="/myLibrary"),e.goBack(r,s)},e.getQuestionCount=function(){var e=v.getQuestionsInTestCollection();return(e.questions||[]).length},e.firstVisit={showAlert:!c.getAttribute("addQuestionBank.info.seen"),title:r("questionBank.firstVisitInfo.title"),description:r("questionBank.firstVisitInfo.description"),closeFn:function(){c.setAttribute("addQuestionBank.info.seen",!0),e.firstVisit.showAlert=!1}},e.$on("itemListDirective.removeItem",function(t,n){w("Remove standard"),g.removeStandard(n),e.$emit("AssessmentAddQuestionBankCtrl.removeStandard",t)}),e.newStandardSearch=function(){w("Start new search"),e.showTab("searchByStandard"),a.lastSelectedGrade=null},e.doneAdding=function(){w("I'm done adding questions"),D()},e.$on("questionBankResult.addQuestion.done",function(){n.url(n.path());var e=n.path().split("/addQuestionBank")[0],t=e+"/edit";n.path(t)}),e.$on("questionBankResult.page.change",function(t,n){e.pageLoading(),y(n)}),e.$on("questionBankResult.question.added",function(t,n){E(n),e.assessmentInfo.active===!1&&e.assessmentInfo.originalId&&(f.makeDefaultView(e.assessmentInfo.itemId,!0,!0),e.assessmentInfo.active=!0)}),e.$on("searchBanksByTopic.result.received",function(t,n,r){I({keyword:r,programLibraries:e.currentProgram.library}),P(t,n)}),g.selectedStandardListIdResult=[],e.$on("searchBanksByStandard.result.received",function(t,n,r){t.preventDefault(),_.isEqual(g.selectedStandardListIdResult,r)||(A({standards:r,programLibraries:e.currentProgram.library}),P(t,n)),g.selectedStandardListIdResult=r})}]),angular.module("Realize.assessment.questionsInTestService",["webStorageModule"]).service("QuestionsInTestService",["$rootScope","$log","Assessment","webStorage",function(e,t,n,r){"use strict";var s=this,a={},i={};s.assessmentId="",s.syncQuestionsInTestCollectionWithLocalStorage=function(){!angular.isUndefined(a)&&!_.isEmpty(a)||_.isEmpty(r.get("questionsInTestCollection"))?(r.remove("questionsInTestCollection"),r.add("questionsInTestCollection",JSON.stringify(a))):a=JSON.parse(r.get("questionsInTestCollection"))},s.getQuestionsInTestCollection=function(){return a},s.setOriginalQuestionsInTestCollectionToLocalStorage=function(e){var t=_.map(e.questions,function(e){return{originalQuestionId:e.id||"",sourceQuestionId:e.sourceQuestionId||""}});r.remove("originalQuestionsInTestCollection"),r.add("originalQuestionsInTestCollection",JSON.stringify(t))},s.isQuestionsInTestCollectionChanged=function(){var e=0,t=JSON.parse(r.get("originalQuestionsInTestCollection")),n=_.map(a.questions,function(e){return{id:e.id||e.sourceQuestionId}});if(t.length!==n.length)return!0;for(e;e<t.length;e++)if(t[e].originalQuestionId!==n[e].id&&t[e].sourceQuestionId!==n[e].id)return!0},s.setQuestionsInTestCollection=function(e){s.resetQuestionsInTestCollection(),e&&(a={questions:e.questions,sourceQuestionBankIds:e.sourceQuestionBankIds},s.syncQuestionsInTestCollectionWithLocalStorage(),s.setOriginalQuestionsInTestCollectionToLocalStorage(e))},s.resetQuestionsInTestCollection=function(){a={}},s.doParseQuestionsInTestCollection=function(){return s.syncQuestionsInTestCollectionWithLocalStorage(),i={},_.each(a.sourceQuestionBankIds,function(e){var t=_.filter(a.questions,function(t){return e===t.sourceQuestionBankId}),n=_.pluck(t,"sourceQuestionId");i[e]={questionBankId:e,questionIds:n,allQuestions:null}}),i};var o=function(){return _.groupBy(a.questions,"sourceQuestionBankId")};return s.addQuestionsToTest=function(e,t){var n,r=[];if(angular.isUndefined(e.id)){var i=o()[e.questionBankId];angular.isUndefined(i)?(r=_.map(e.questions,function(e){return{id:"",sourceQuestionId:e.id,sourceQuestionBankId:e.parentBankId}}),a.sourceQuestionBankIds.push(e.questionBankId)):_.each(e.questions,function(e){var t=_.pluck(i,"sourceQuestionId");t.indexOf(e.id)<0&&(n={id:"",sourceQuestionId:e.id,sourceQuestionBankId:e.parentBankId},r.push(n))}),angular.isUndefined(t)?a.questions=a.questions.concat(r):Array.prototype.splice.apply(a.questions,[t,0].concat(r))}else n={id:"",sourceQuestionId:e.id,sourceQuestionBankId:e.parentBankId},angular.isUndefined(t)?a.questions.push(n):a.questions.splice(t,0,n),a.sourceQuestionBankIds=_.union(a.sourceQuestionBankIds,e.parentBankId);return s.syncQuestionsInTestCollectionWithLocalStorage(),r.length||1},s.deleteQuestionsFromTest=function(e,t){if(angular.isUndefined(e.id)){if(angular.isDefined(t)){var n=t;_.each(e.questions,function(e){_.pluck(a.questions,"sourceQuestionId").indexOf(e.id)<n&&t--})}a.questions=_.filter(a.questions,function(t){return t.sourceQuestionBankId!==e.questionBankId}),a.sourceQuestionBankIds=_.filter(a.sourceQuestionBankIds,function(t){return t!==e.questionBankId})}else{angular.isDefined(t)&&_.pluck(a.questions,"sourceQuestionId").indexOf(e.id)<t&&t--,a.questions=_.filter(a.questions,function(t){return t.sourceQuestionId!==e.id});var r=o()[e.parentBankId];(angular.isUndefined(r)||r.length<=0)&&(a.sourceQuestionBankIds=_.filter(a.sourceQuestionBankIds,function(t){return t!==e.parentBankId}))}return s.syncQuestionsInTestCollectionWithLocalStorage(),t},s.questionsInAssessment=[],s.putQuestionsInAssessment=function(r){var a=s.assessmentId,i=s.transformQuestionsInTestCollection();a&&i&&!_.isEqual(s.questionsInAssessment,i)&&(r&&e.pageLoading(),n.putQuestionsInAssessment(a,i).then(function(){r&&e.pageLoaded()},function(n){r&&e.pageLoaded(),t.error("Failed to load questions for an assessment",n)})),s.questionsInAssessment=i},s.transformQuestionsInTestCollection=function(){return _.map(a.questions,function(e){return{originalQuestionId:e.id||"",sourceQuestionId:e.sourceQuestionId||"",sourceQuestionBankId:e.sourceQuestionBankId||""}})},s}]),angular.module("Realize.assessment.questionBankDataService",["Realize.paths","Realize.content.constants","Realize.content.model.questionBank","Realize.assessment.assessmentDataService","Realize.assessment.questionBankResultService"]).service("QuestionBankDataService",["$http","$log","$q","PATH","CONTENT_CONSTANTS","QuestionBank","Assessment","QuestionBankResultService",function(e,t,n,r,s,a,i,o){"use strict";var l={},c=function(e){var t=[];return e&&_.each(e,function(e){t.push(new a(e))}),t};return l.restoreSelectedQuestionBank=function(e,t){_.each(t,function(t){var n=_.find(e,function(e){return e.questionBankId===t.questionBankId});n&&(null===t.allQuestions&&(t.allQuestions=n.questions.length===t.questionIds.length),n.selected=t.allQuestions,_.each(t.questionIds,function(e){var t=_.findWhere(n.questions,{id:e});t&&(t.selected=!0)}))})},l.searchBanksByTopic=function(e,t){return l.getAvailableQuestionBanks({programs:e,keyword:t,page:1,pageSize:s.SEARCH_RESULT_PAGE_SIZE,calculateTotalAvailableQuestions:!0})},l.getAvailableQuestionBanks=function(s){return e({url:r.REST+"/assessment/questionbanks",method:"GET",params:{programs:s.programs,keyword:s.keyword,page:s.page,pageSize:s.pageSize,calculateTotalAvailableQuestions:s.calculateTotalAvailableQuestions,nativeBanks:!1}}).then(function(e){var t=e.data;return t.questionBanks=c(t.questionBanks),t},function(e){return t.error("Failed to retrieve question banks",e),n.reject("Failed to retrieve question banks",e)})},l.getQuestionsSummary=function(e){return o.summaryCallCompleted=!1,i.getSummary(e.assessmentSessionId,!0).then(function(t){t&&(o.questionBankSummaryCollection[e.questionBankId]={questionBankId:e.questionBankId,questions:e.questions,sessionId:e.assessmentSessionId,questionIds:t.questionIds,sequence:t.sequence},o.summaryCallCompleted=!0)},function(e){return t.error("Failed to retrieve questions summary",e),n.reject("Failed to retrieve questions summary",e)})},l}]),angular.module("Realize.assessment.questionBankItemDirective",["RealizeDirectives","rlzComponents.components.i18n","Realize.assessment.questionBankResultService"]).directive("questionBankItem",["QuestionBankResultService",function(e){"use strict";return{link:function(t){t.questionId="",t.qSummary={},t.toggle=function(n){angular.isDefined(t.obj.isEmptyChildList)&&!t.obj.isEmptyChildList?(t.obj.expanded=!t.obj.expanded,t.obj.expanded&&t.$emit("questionBankItem.toggleShowQuestion.questionBankExpanded",t.obj),e.resetSelectedQuestionInBank(t.obj)):t.toggleShowQuestion(n)},t.getSelectedQuestionIndex=function(){var e;return _.find(t.qSummary.questions,function(n,r){return n.id===t.obj.id?(e=r,t.qSummary.position=r+1,!0):void 0}),e},t.toggleShowQuestion=function(n){e.summaryCallCompleted&&(n.stopImmediatePropagation(),t.$emit("questionBankItem.toggleShowQuestion.clicked",t.obj.id),t.qSummary=e.questionBankSummaryCollection[t.obj.parentBankId],t.questionId=t.qSummary.questionIds[t.getSelectedQuestionIndex()])},t.isQuestion=function(){return angular.isDefined(t.obj.parentBankId)},t.shouldDisplayQuestion=function(){return t.isQuestion()&&e.getSelectedQuestionId()===t.obj.id},t.$on("expandableTreeItem.leftTreeControl.clicked",function(e){t.obj.expanded=!t.obj.expanded,t.toggle(e)}),t.displayShowLink=function(){return t.isQuestion()&&e.summaryCallCompleted}}}}]),angular.module("Realize.assessment.questionBankResultDirective",["Realize.assessment.questionBankItemDirective","Realize.paths","Realize.common.paginator","Realize.assessment.assessmentDataService","Realize.assessment.questionBankResultService","Realize.assessment.questionBankDataService","Realize.common.expandableTreeDirective","rlzComponents.components.i18n","Realize.assessment.questionsInTestService"]).directive("questionBankResult",["$log","$rootScope","PATH","$location","Assessment","QuestionBankResultService","QuestionBankDataService","lwcI18nFilter","QuestionsInTestService",function(e,t,n,r,s,a,i,o,l){"use strict";return{restrict:"EA",templateUrl:n.TEMPLATE_CACHE+"/app/programs/toc/assessment/questionBank/questionBankResult/questionBankResult.dir.html",link:function(t){var r=null,s=!1,o=function(e){t.$emit("questionBankResult.page.change",e)},c=function(e){return _.each(e,function(e){e.showNoToggleControl=e.isEmptyChildList,_.each(e.questions,function(e){e.showNoToggleControl=!1})}),e};t.selectedQuestionBankCollection={},t.selectedQuestionCount=0,t.questionBankItemTemplate=n.TEMPLATE_CACHE+"/app/programs/toc/assessment/questionBank/questionBankItem/questionBankItem.dir.html",t.questionViewTemplate=n.TEMPLATE_CACHE+"/app/programs/toc/assessment/questionBank/questionView/questionView.dir.html",t.selectedQId=null,t.$on("addQuestionBank.selectedQuestion.reset",function(){t.selectedQuestionBankCollection={},t.selectedQuestionCount=0}),t.questionBankResult={},t.$watch("searchResult",function(e){e&&e.questionBanks&&e.questionBanks.length>0&&(e.questionBanks=c(e.questionBanks),t.resultBanks=e.questionBanks,t.questionBankResult=e)},!0),t.addQuestions=function(e){var n,r;t.assessmentInfo.insertPosition&&(n=parseInt(t.assessmentInfo.insertPosition,10)-1),r=l.addQuestionsToTest(e,n),angular.isDefined(n)&&(t.assessmentInfo.insertPosition=n+r+1)},t.deleteQuestions=function(e){var n;t.assessmentInfo.insertPosition&&(n=parseInt(t.assessmentInfo.insertPosition,10)-1),n=l.deleteQuestionsFromTest(e,n),angular.isDefined(n)&&(t.assessmentInfo.insertPosition=n+1)},t.$on("expandableTreeItem.selectCheckbox.select",function(n,r){var s=r.questions;if(s)_.each(s,function(e){e.selected=r.selected});else{var a=_.find(t.resultBanks,function(e){return e.questionBankId===r.parentBankId});a?a.selected=a.selectedAllQuestions:e.error("Cannot find associated question bank for",r)}return r.selected?t.addQuestions(r):t.deleteQuestions(r)}),t.$on("questionBankItem.toggleShowQuestion.clicked",function(e,t){r=a.getSelectedQuestionId()===t?null:t,a.setSelectedQuestionId(r)}),t.$on("questionBankItem.toggleShowQuestion.questionBankExpanded",function(e,t){i.getQuestionsSummary(t)}),t.$watch("currentPage",function(t,n){t!==n&&(e.log("Request page",t),o(t))}),t.$on("$routeChangeStart",function(){l.putQuestionsInAssessment(s)})}}}]),angular.module("Realize.assessment.questionBankResultService",[]).service("QuestionBankResultService",[function(){"use strict";this.selectedQuestionId=null,this.summaryCallCompleted=!1,this.questionBankSummaryCollection=[],this.getSelectedQuestionId=function(){return this.selectedQuestionId},this.setSelectedQuestionId=function(e){this.selectedQuestionId=e},this.resetSelectedQuestionId=function(){this.setSelectedQuestionId(null)},this.resetSelectedQuestionInBank=function(e){var t=this;null!==t.getSelectedQuestionId()&&_.map(e.questions,function(e){return t.getSelectedQuestionId()===e.id?(t.resetSelectedQuestionId(),void 0):void 0})}}]),angular.module("Realize.assessment.searchBanksByStandardDirective",["Realize.paths","Realize.content.model.contentItem","Realize.analytics","Realize.standards.standardDataService","Realize.common.expandableTreeDirective","Realize.assessment.standardWithBankItemDirective","Realize.assessment.searchByStandardService","Realize.assessment.searchQuestionBankDataService"]).directive("searchBanksByStandard",["$log","$location","PATH","$rootScope","$routeParams","Analytics","Content","Standard","SearchByStandardService","SearchQuestionBankDataService",function(e,t,n,r,s,a,i,o,l,c){"use strict";return{scope:{standardsTreeData:"="},templateUrl:n.TEMPLATE_CACHE+"/app/programs/toc/assessment/questionBank/searchBanksByStandard/searchBanksByStandard.dir.html",link:function(i){var u,d,m,g,p,f,h,v,S,T,A={},I=o.urlDecode(s.lastSelectedGrade);i.grades=_.sortBy(_.uniq(i.standardsTreeData.standards.grades,"")),i.standardsMap=i.standardsTreeData.standards.map,i.program=r.currentProgram.library=i.standardsTreeData.program.library,i.options=[],i.update=function(e){t.search("lastSelectedGrade",o.urlEncode(e.grade)),i.current=A[e.grade],l.resetSelectedStandardList(),S(i.current.standards)
},S=function(e){_.map(e,function(e){e.selected=!1,e.children&&e.children.length>0&&S(e.children)})},angular.forEach(i.grades,function(e){var t={grade:e,standards:i.standardsMap[e]};i.options=i.options.concat(t),A[e]=t}),i.grades&&i.grades.length&&(u=A[I||i.grades[0]],i.update(u)),i.standardTemplate=n.TEMPLATE_CACHE+"/app/programs/toc/assessment/questionBank/searchBanksByStandard/standardWithBankItem.dir.html",i.selectedStandardList=l.selectedStandardList,d=function(e,t){_.map(e.children,function(e){e.selected=t,e.children&&e.children.length>0&&d(e,t)})},m=function(e){return _.filter(e.children,function(e){return e.count>0})},g=function(e,t,n,r){if(null===e)return r;if(e.id===t.id)return d(t,n),r=!0;var s,a,i=0,o=m(e).length;for(s=0;s<e.children.length;s++)a=e.children[s],a.id===t.id&&(a.selected=n,d(t,n),r=!0),a.count>0&&a.selected&&i++;if(r)return e.selected=o===i?!0:!1,r;for(s=0;s<e.children.length;s++)if(e.children[s].count>0&&(r=g(e.children[s],t,n,r))){n?(e.children[s].selected&&i++,e.selected=o===i?!0:!1):e.selected=!1;break}return r},p=function(e){if(e.count>0){if(e.selected)return l.addStandard(e),void 0;_.map(e.children,function(e){e.count>0&&p(e)})}},f=function(){return _.map(i.current.standards,function(e){p(e)}),l.selectedStandardList},i.$on("expandableTreeItem.selectCheckbox.select",function(e,t){var n;for(l.resetSelectedStandardList(),n=0;n<i.current.standards.length&&!(i.current.standards[n].count>0&&g(i.current.standards[n],t,t.selected,!1));n++);i.selectedStandardList=f()}),h=function(e,t){r.$broadcast("searchBanksByStandard.result.received",e,t)},v=function(){T=_.pluck(l.selectedStandardList,"id"),a.track("track.action",{category:"Programs",action:"Build a test",label:"Search selected standards"}),c.searchBanksByStandards(i.program,T).then(function(e){r.pageLoaded(),h(e,T)},function(t){r.pageLoaded(),e.error("Cannot retrieve question banks",t)})},i.searchQuestions=function(){r.pageLoading(),l.selectedStandardListIdResult=[],v()},r.$on("AssessmentAddQuestionBankCtrl.removeStandard",function(e){e.stopPropagation(),e.preventDefault(),i.searchQuestions()})}}}]),angular.module("Realize.assessment.searchBanksByStandard",["Realize.assessment.standardWithBankItemDirective","Realize.assessment.searchBanksByStandardDirective","Realize.assessment.searchByStandardService","Realize.assessment.searchQuestionBankDataService"]),angular.module("Realize.assessment.searchByStandardService",[]).service("SearchByStandardService",[function(){"use strict";this.selectedStandardList=[],this.selectedStandardListIdResult=[],this.addStandard=function(e){e&&this.selectedStandardList.push(e)},this.resetSelectedStandardList=function(){this.selectedStandardList=[]},this.getSelectedStandardList=function(){return this.selectedStandardList},this.removeStandard=function(e){this.selectedStandardList=_.reject(this.selectedStandardList,function(t){return t.id===e.id})}}]),angular.module("Realize.assessment.searchQuestionBankDataService",["Realize.paths","Realize.content.constants","Realize.content.model.questionBank"]).service("SearchQuestionBankDataService",["$http","$log","$q","PATH","CONTENT_CONSTANTS","QuestionBank",function(e,t,n,r,s,a){"use strict";var i={},o=function(e){var t=[];return e&&_.each(e,function(e){t.push(new a(e))}),t};return i.encodeStandards=function(e){var t=[];return e.length&&_.each(e,function(e){t.push(encodeURIComponent(e))}),t},i.searchBanksByStandards=function(e,t){var n=i.encodeStandards(t);return i.getAvailableQuestionBanks({programs:e,standards:n,page:1,pageSize:s.SEARCH_RESULT_PAGE_SIZE,calculateTotalAvailableQuestions:!0})},i.getAvailableQuestionBanks=function(s){return e({url:r.REST+"/assessment/questionbanks",method:"GET",params:{programs:s.programs,standards:s.standards,page:s.page,pageSize:s.pageSize,calculateTotalAvailableQuestions:s.calculateTotalAvailableQuestions,nativeBanks:!1}}).then(function(e){var t=e.data;return t.questionBanks=o(t.questionBanks),t},function(e){return t.error("Failed to retrieve question banks",e),n.reject("Failed to retrieve question banks",e)})},i}]),angular.module("Realize.assessment.standardWithBankItemDirective",["Realize.standards.standardDataService"]).directive("standardWithBankItem",["Standard",function(e){"use strict";return{link:function(t){var n=t.obj;t.toggle=function(){t.obj.children.length>0&&(t.obj.expanded=!t.obj.expanded)},t.$watch("obj.expanded",function(t){e[t?"setOpen":"setClosed"](n.id),!t&&n.children&&_.each(n.children,function(e){e.expanded=!1})}),0===t.level&&(n.expanded=!0)}}}]),angular.module("Realize.assessment.searchBanksByTopicDirective",["Realize.assessment.addQuestionBankCtrl","Realize.paths","Realize.analytics","Realize.assessment.questionBankDataService","Realize.assessment.assessmentDataService","Realize.assessment.questionsInTestService"]).directive("searchBanksByTopic",["$log","PATH","Analytics","QuestionBankDataService","QuestionsInTestService",function(e,t,n,r,s){"use strict";return{templateUrl:t.TEMPLATE_CACHE+"/app/programs/toc/assessment/questionBank/searchBanksByTopic/searchBanksByTopic.dir.html",link:function(t){var a=t.currentProgram.library,i=function(e){t.$emit("searchBanksByTopic.result.received",e,t.bankKeyword)},o=function(){n.track("track.action",{category:"Programs",action:"Build a test",label:"Search by topic ("+t.bankKeyword+")"}),r.searchBanksByTopic(a,t.bankKeyword).then(function(e){t.pageLoaded(),i(e)},function(n){e.error("Cannot retrieve question banks",n),t.pageLoaded()})};t.search=function(){t.pageLoading(),s.putQuestionsInAssessment(),o(),t.searchBanksByTopicForm.$setPristine()}}}}]);
//# sourceMappingURL=realize-app.min.js.map