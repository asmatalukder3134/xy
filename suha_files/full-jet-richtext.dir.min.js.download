var SelectionUtils=function(){};SelectionUtils.getSelection=function(){var t;return t=window.getSelection()?window.getSelection():document.getSelection()},SelectionUtils.getRange=function(){var t=this.getSelection(),e=null;return t.rangeCount>0&&(e=t.getRangeAt(0)),0==$(t.anchorNode).closest(".rte-editbox").length&&(e=null),e},SelectionUtils.markCaretPos=function(t){t.find("caret").remove();var e,i,n,o,s,a,r,l=SelectionUtils.getSelection();if(l.rangeCount>0){var h=l.getRangeAt(0).cloneRange();o=h.startContainer,a=h.startOffset,s=h.endContainer,r=h.endOffset,l.isCollapsed?(e=document.createElement("caret"),e.setAttribute("data-position","collapsed"),h=l.getRangeAt(0),h.collapse(!1),h.cloneRange().insertNode(e),l=this.getSelection(),l.removeAllRanges(),l.addRange(h)):(e=document.createElement("caret"),e.setAttribute("data-position","start"),i=document.createElement("caret"),i.setAttribute("data-position","end"),n=document.createRange(),n.setStart(s,r),n.setEnd(s,r),n.insertNode(i),n=document.createRange(),n.setStart(o,a),n.setEnd(o,a),n.insertNode(e),h=document.createRange(),h.setStart(e,0),h.setEnd(i,0),l=this.getSelection(),l.removeAllRanges(),l.addRange(h))}return h},SelectionUtils.restoreCaretPos=function(t){var e,i,n=t.find('caret[data-position="start"]'),o=t.find('caret[data-position="end"]'),s=t.find('caret[data-position="collapsed"]');n.length>0?(e=document.createRange(),e.setStartBefore(n[0]),e.setEndAfter(o[0]),i=SelectionUtils.getSelection(),i.removeAllRanges(),i.addRange(e),n[0].parentNode.removeChild(n[0]),o[0].parentNode.removeChild(o[0])):s.length>0&&(e=document.createRange(),e.setStartAfter(s[0]),e.setEndAfter(s[0]),i=SelectionUtils.getSelection(),i.removeAllRanges(),i.addRange(e),e.deleteContents(),t.find("caret").remove()),t[0].normalize(),t.trigger("caretRestored")};var JetUtils=function(){};JetUtils.isEmptyTextNode=function(t){return null!=t&&t.nodeType==Node.TEXT_NODE&&0==t.nodeValue.length},JetUtils.isIEEmptyTextNode=function(t){return null!=t&&t.nodeType==Node.TEXT_NODE&&1==t.nodeValue.length&&160==t.nodeValue.charCodeAt(0)},JetUtils.nodeIsElement=function(t,e){return null!=t&&t.nodeType==Node.ELEMENT_NODE&&t.nodeName==e.toUpperCase()},JetUtils.nodeIsText=function(t){return null!=t&&t.nodeType==Node.TEXT_NODE},JetUtils.removeEmptyElements=function(t){for(var e,i,n,o,s,a=t.childNodes.length-1;a>0;a--)e=t.childNodes[a],i=JetUtils.nodeIsText(e),n=JetUtils.nodeIsElement(e,"CARET"),o=JetUtils.nodeIsElement(e,"BR"),s=e.nodeType==Node.ELEMENT_NODE&&0==e.textContent.length&&0==$(e).find("br").length,i||n||o||!s||t.removeChild(e)},JetUtils.removeEmptyFormatTags=function(t){for(var e,i,n,o=["B","I","U","EM","STRONG"],s=t.childNodes.length-1;s>0;s--)e=t.childNodes[s],n=e.nodeType==Node.ELEMENT_NODE&&-1!=o.indexOf(e.nodeName),i=e.nodeType==Node.ELEMENT_NODE&&0==e.textContent.length&&0==$(e).find("br").length,n&&i&&t.removeChild(e)},JetUtils.getNodeValue=function(t){var e;return t?t.nodeType==Node.TEXT_NODE?e=t.nodeValue:t.nodeType==Node.ELEMENT_NODE&&(e=t.textContent):e=null,e},JetUtils.parentIsEditBox=function(t){return $(t.parentNode).hasClass("rte-editbox")},JetUtils.getTextNodes=function(t,e){var i,n=[];if(t.nodeType==Node.TEXT_NODE)n.push(t);else{e&&($(t).find("div, br, li, p").after("<lb />"),$(t).find("div, li").before("<lb />"));for(var o=document.createTreeWalker(t,NodeFilter.SHOW_ALL,null,!1);i=o.nextNode();)i.nodeType==Node.TEXT_NODE?(i.isLineBreak=!1,n.push(i)):i.nodeType==Node.ELEMENT_NODE&&"LB"==i.nodeName&&n.length>0&&(n[n.length-1].isLineBreak=!0);$(t).find("lb").remove()}return n},JetUtils.nodeIsBlockElement=function(t){return this.nodeIsElement(t,"DIV")||this.nodeIsElement(t,"UL")||this.nodeIsElement(t,"OL")};var CharacterMap=function(t,e){this.charMapContainer=t,this.characterSet=null,this.modal=null,this.buttonArea=null,this.displayArea=null,this.buttons=null,this._selectedSymbol="",this._isTouchEnabled=e,this._caller=null,this._selectionCallback=null};CharacterMap.prototype._render=function(){var t='<div class="charmap modal hide unselectable" tabindex="-1" role="dialog" aria-labelledby="charMapLabel" aria-hidden="true"><div class="modal-header"><button type="button" class="close firstTab" aria-hidden="true"><i class="icon-remove"></i></button><h3 id="charMapLabel">'+this.characterSet.label+'</h3></div><div class="modal-body charmap-body"><div class="charmap-button-area"></div><div class="charmap-display"></div></div><div class="modal-footer">';this._isTouchEnabled&&(t+='<button class="charMapInsert btn">'+($.i18n?$.i18n.t("extendedText:insertSymbol"):"Insert Symbol")+"</button>"),t+='<button tabindex="0" class="charMapClose btn lastTab">'+($.i18n?$.i18n.t("close"):"Close")+"</button></div></div>",this.charMapContainer.append(t),this.modal=this.charMapContainer.children(".charmap"),this.modal.modal({keyboard:!0,backdrop:!0,show:!1}),this.modal.on("shown",$.proxy(this._handleShown,this)),this.buttonArea=this.modal.find(".charmap-button-area"),this.displayArea=this.modal.find(".charmap-display"),this._buildButtons(),this.modal.find(".close, .charMapClose").on("click touchstart",$.proxy(this._handleHide,this)),this.modal.find(".charMapInsert").on("click touchstart",$.proxy(this._doInsert,this)),this.modal.find(".close, .charMapClose").on("keydown",$.proxy(this._doTabControl,this)),$(window).on("resize",$.proxy(this._recenter,this))},CharacterMap.prototype._handleShown=function(){this._recenter(),$("div.modal-backdrop.in").off("click").on("click touchstart",$.proxy(this._handleHide,this)),$(".modal-backdrop").css("z-index",1069)},CharacterMap.prototype._recenter=function(){this.modal.css({top:.15*$(window).height(),left:$(window).width()/2,position:"fixed"})},CharacterMap.prototype._handleKeyDown=function(t){if(13==t.which||32==t.which)if(t.preventDefault(),"BUTTON"==t.target.nodeName)$(t.target).trigger("click");else{var e=this.buttonArea.find(".active");e.trigger("click")}27!=t.charCode&&27!=t.which||this.hide()},CharacterMap.prototype._doMobileTab=function(t,e){t.preventDefault();var i=$.inArray(e[0],this.buttons),n=-1;n=t.shiftKey?0==i?this.buttons.length-1:i-1:i==this.buttons.length-1?0:i+1,this.buttons[n].focus()},CharacterMap.prototype._onSymbolSelect=function(t){this.buttons.removeClass("active");var e=$(t.target),i=e.attr("data-value"),n=String.fromCharCode(i);e.addClass("active"),this._showLargerSymbol(n),this._selectedSymbol=n,("click"==t.type&&!this._isTouchEnabled||"keydown"==t.type&&this._isTouchEnabled)&&this._close(this._selectedSymbol)},CharacterMap.prototype._showLargerSymbol=function(t){this.displayArea.text(t)},CharacterMap.prototype._buildButtons=function(){for(var t,e,i,n=this.characterSet.symbols,o=0;o<n.length;o++)e=n[o].code,i=n[o].label,t='<button tabindex="0" class="charmap-button" data-value="'+e+'">'+String.fromCharCode(e)+"</button>",this.buttonArea.append(t),i&&""!=i&&this.buttonArea.children("[data-value="+e+"]").tooltip({title:i,delay:0,animation:!1,placement:"bottom",container:this.modal});this.buttons=this.buttonArea.find("button"),this.buttons.on("click focus",$.proxy(this._onSymbolSelect,this)),this._isTouchEnabled?this.buttons.on("keydown",$.proxy(this._onMobileKeyDown,this)):(this.buttons.on("mouseover",$.proxy(this._onMouseOverButton,this)),this.buttons.on("mouseout",$.proxy(this._onMouseOutButton,this))),$(this.buttons[0]).add()},CharacterMap.prototype._onMobileKeyDown=function(t){13==t.keyCode||32==t.keyCode?(t.preventDefault(),this._onSymbolSelect(t)):9==t.keyCode&&this._doMobileTab(t,$(t.target))},CharacterMap.prototype._onMouseOverButton=function(t){var e=$(t.target);this.buttons.removeClass("hover");var i=!!(t.originalEvent&&t.originalEvent.sourceCapabilities&&t.originalEvent.sourceCapabilities.firesTouchEvents);i||e.addClass("hover");var n=String.fromCharCode(e.attr("data-value"));this._showLargerSymbol(n)},CharacterMap.prototype._onMouseOutButton=function(){this._showLargerSymbol(""),this.buttons.removeClass("hover");var t=this.buttonArea.find(".active");if(0!=t.length){var e=String.fromCharCode(t.attr("data-value"));this._showLargerSymbol(e)}else this._showLargerSymbol("")},CharacterMap.prototype._doInsert=function(t){t.preventDefault(),this._close(this._selectedSymbol)},CharacterMap.prototype._doTabControl=function(t){var e=$(t.target),i=e.hasClass("firstTab"),n=e.hasClass("lastTab"),o=this.modal.find(".firstTab"),s=this.modal.find(".lastTab");9==t.which&&(t.shiftKey&&i?(t.preventDefault(),s.focus()):!t.shiftKey&&n&&(t.preventDefault(),o.focus()))},CharacterMap.prototype._close=function(t,e){e=!!e,$(document).off("keydown",$.proxy(this._handleKeyDown,this)),this.buttons&&this.buttons.removeClass("active"),this.modal.modal("hide"),this._selectionCallback&&!e&&this._selectionCallback.call(this._caller,t)},CharacterMap.prototype.show=function(){this.buttons.removeClass("active"),this._selectedSymbol="",this.modal.modal("show"),$(document).off("keydown",$.proxy(this._handleKeyDown,this)).on("keydown",$.proxy(this._handleKeyDown,this)),window.setTimeout(function(t){return function(){$(t.buttons[0]).focus()}}(this),200)},CharacterMap.prototype._handleHide=function(){this.hide()},CharacterMap.prototype.hide=function(t){this._close("",t),$(document).off("keydown",$.proxy(this._handleKeyDown,this))},CharacterMap.prototype.setCharacterSet=function(t){var e={label:$.i18n?$.i18n.t("extendedText:spanishSymbols"):"Spanish Symbols",symbols:[{code:193,label:""},{code:225,label:""},{code:201,label:""},{code:233,label:""},{code:205,label:""},{code:237,label:""},{code:211,label:""},{code:243,label:""},{code:218,label:""},{code:250,label:""},{code:220,label:""},{code:252,label:""},{code:209,label:""},{code:241,label:""},{code:161,label:""},{code:191,label:""},{code:171,label:""},{code:187,label:""},{code:8249,label:""},{code:8250,label:""}]},i={label:$.i18n?$.i18n.t("extendedText:frenchSymbols"):"French Symbols",symbols:[{code:224,label:""},{code:226,label:""},{code:230,label:""},{code:231,label:""},{code:232,label:""},{code:233,label:""},{code:234,label:""},{code:235,label:""},{code:192,label:""},{code:194,label:""},{code:198,label:""},{code:199,label:""},{code:200,label:""},{code:201,label:""},{code:202,label:""},{code:203,label:""},{code:238,label:""},{code:239,label:""},{code:244,label:""},{code:339,label:""},{code:249,label:""},{code:251,label:""},{code:252,label:""},{code:187,label:""},{code:206,label:""},{code:207,label:""},{code:212,label:""},{code:338,label:""},{code:217,label:""},{code:219,label:""},{code:220,label:""},{code:171,label:""}]};t=t.toLowerCase(),"spanish"==t?this.characterSet=e:"french"==t&&(this.characterSet=i),this._render()},CharacterMap.prototype.setSelectionCallback=function(t,e){this._caller=t,this._selectionCallback=e},CharacterMap.prototype.getLabel=function(){var t="";return this.characterSet&&(t=this.characterSet.label),t},CharacterMap.prototype.destroy=function(){$(window).off("resize",$.proxy(this._recenter,this)),$(document).off("keydown",$.proxy(this._handleKeyDown,this)),this.modal.modal("hide"),this.charMapContainer.remove(),this.characterSet=null,this._selectedSymbol="",this._caller=null,this._selectionCallback=null};var EditManager=function(t){this._stack=[{text:""}],this._curPos=0,this._editor=t.element,this._maxLevels=21,this._editBox=$(this._editor).find(".rte-editbox"),this._editBox.on("rteSpellCheckMarkAsCorrect",$.proxy(this._onMarkAsCorrect,this))};EditManager.prototype.save=function(t){try{SelectionUtils.markCaretPos(this._editBox)}catch(t){}var e=t.html();SelectionUtils.restoreCaretPos(this._editBox);var i=t.html().replace(/(<\/?caret[^>]*>)/g,""),n=0==this._stack.length?"":this._stack[this._curPos].text.replace(/(<\/?caret[^>]*>)/g,"");for(0!=this._stack.length&&i==n||(this._stack.length>this._curPos+1&&(this._stack.length=this._curPos+1),this._stack.push({text:e}),this._curPos=this._stack.length-1,this._editor.trigger("EditManagerChange"));this._stack.length>this._maxLevels;)this._stack.shift(),this._curPos--;return this._stack.length},EditManager.prototype.undo=function(){var t=null;return this.canUndo()&&(this._curPos--,t=this._stack[this._curPos],this._editor.trigger("EditManagerChange")),t},EditManager.prototype.redo=function(){var t=null;return this.canRedo()&&(this._curPos++,t=this._stack[this._curPos],this._editor.trigger("EditManagerChange")),t},EditManager.prototype.canUndo=function(){return this._curPos>0},EditManager.prototype.canRedo=function(){return this._curPos<this._stack.length-1},EditManager.prototype.clear=function(){this._stack.length=0},EditManager.prototype._removeWordsMarkedAsCorrect=function(t){for(var e='<span[^>]*data-key="'+t+'"[^>]*>(.*?)</span>',i=new RegExp(e,"g"),n='<a[^>]*data-key="'+t+'"[^>]*>(.*?)</a>',o=new RegExp(n,"g"),s=0;s<this._stack.length;s++)this._stack[s].text=this._stack[s].text.replace(i,"$1"),this._stack[s].text=this._stack[s].text.replace(o,"$1")},EditManager.prototype._onMarkAsCorrect=function(t,e){this._removeWordsMarkedAsCorrect(e)},EditManager.prototype.destroy=function(){this._editBox.off("rteSpellCheckMarkAsCorrect",$.proxy(this._onMarkAsCorrect,this))};var SpellCheck=function(t,e,i,n){this._spellURL=t,this.element=e,this._editBox=i,this._seenWords=[],this._spellings={},this._tempWords=[],this._wordsMarkedCorrect=[],this._isIE=n.isIE,this._isEdge=n.isEdge,this._isWebkit=n.isWebkit,this._noticeWorking=null,this._notice=null,this._noticeTimer=null,this._noticeDuration=4,this._noticeMsgDone='<i class="icon-ok"></i> '+($.i18n?$.i18n.t("extendedText:spellCheckComplete"):"Spell Check Complete"),this._noticeMsgError='<i class="icon-remove"></i> '+($.i18n?$.i18n.t("extendedText:spellCheckFailed"):"Spell Check Failed"),this._popupOpen=!1,this.startTime=null,this.finishTime=null,this.FRONT=0,this.BACK=1,this._nonWordChar=/[\s!-&(-\/:-@\[-`\{-~Â¡Â¿\u2039\u203aÂ«Â»]/,this._nonWordAtStart=/^[\s!-\/:-@\[-`\{-~Â¡Â¿\u2039\u203aÂ«Â»]/,this._nonWordAtEnd=/[\s!-\/:-@\[-`\{-~Â¡Â¿\u2039\u203aÂ«Â»]$/,this._onNoticeTimeUp=this._onNoticeTimeUp.bind(this),this.observer||(this._checkCharacterMutation=this._checkCharacterMutation.bind(this),this._processMutations=this._processMutations.bind(this),this.observer=new MutationObserver(this._processMutations)),this.observer.disconnect(),this._startObserving()};SpellCheck.prototype._startObserving=function(){this.observer.observe(this._editBox[0],{subtree:!0,characterData:!0,childList:!0})},SpellCheck.prototype._processMutations=function(t){for(var e=0;e<t.length;e++)this._checkCharacterMutation(t[e])},SpellCheck.prototype._checkCharacterMutation=function(t){var e,i,n,o=[];if("characterData"==t.type)o.push(t.target);else if("childList"==t.type&&t.addedNodes.length>0)for(e=0;e<t.addedNodes.length;e++)i=t.addedNodes[e],i.nodeType==Node.TEXT_NODE&&o.push(i);for(t.removedNodes.length>0&&o.push(t.target),this.observer.disconnect(),e=0;e<o.length;e++)if(n=$(o[e]).closest(".misspelled"),n.length>0){this._moveLeadingNonWordChar(n[0]),this._moveTrailingNonWordChar(n[0]);var s=n.attr("data-key"),a=n[0].textContent;s!=a&&n.removeClass("misspelled").addClass("badmisspelled"),this._editBox.find(".badmisspelled").attr("style","")}this._startObserving()},SpellCheck.prototype._findIndex=function(t,e){for(var i,n,o,s=0,a=t.length-1;a>=s;){if(i=(s+a)/2|0,n=t[i],o=a>i?t[i+1]:null,e>n&&(!o||o>e))return i;if(e>n)s=i+1;else{if(!(n>e))return i;a=i-1}}return-1},SpellCheck.prototype.init=function(){this._createNotices(),this._menu=null},SpellCheck.prototype._showPopup=function(t){var e=SelectionUtils.getSelection(),i=0!=e.rangeCount?e.getRangeAt(0):null;i&&i.collapsed||(e.removeAllRanges(),i=document.createRange(),i.setStart(t,0),i.setEnd(t,0),e.addRange(i)),SelectionUtils.markCaretPos(this._editBox);var n=this,o=$(t),s=o.data("key"),a=this._spellings[s];if(s!==t.textContent)return t.outerHTML=t.innerHTML;var r=$("<ul/>",{"class":"dropdown-menu spellpop",role:"menu"}).css({top:t.offsetTop+o.height()-this._editBox.scrollTop(),left:t.offsetLeft}).appendTo(this.element),l=function(){setTimeout(function(){r[0].contains(document.activeElement)||n.removePopup()},0)},h=function(t){return function(e){e.preventDefault(),n._editBox.trigger("rteSaveContent"),$(".spellpop").remove(),n._replaceText(i,t);try{i.outerHTML=i.innerHTML}catch(i){}SelectionUtils.restoreCaretPos(n._editBox),n._editBox.trigger("rteSpellCheckWordChange")}},d=function(t){t.preventDefault(),$(".spellpop").remove(),delete n._spellings[s],n._wordsMarkedCorrect.push(s),n.unmarkMarkedAsCorrect(),SelectionUtils.restoreCaretPos(n._editBox),n._editBox.trigger("rteSpellCheckMarkAsCorrect",s),n._editBox.trigger("rteSpellCheckWordChange")};a.forEach(function(t){$('<li tabindex="-1"><a href="#">'+t+"</a></li>").appendTo(r).click(h(t)).children().blur(l)}),a.length&&$(r).append('<li class="divider"/>'),$('<li tabindex="-1"><a href="#">'+($.i18n?$.i18n.t("extendedText:markCorrect"):"mark as correct")+"</a></li>").appendTo(r).click(d).children().blur(l),this._editBox.on("scroll",this.removePopup.bind(this)),this._popupOpen=!0},SpellCheck.prototype.unmarkMarkedAsCorrect=function(){for(var t=!1,e=0;e<this._wordsMarkedCorrect.length;e++)this._editBox.find('[data-key="'+this._wordsMarkedCorrect[e]+'"]').each(function(e,i){i.outerHTML=i.innerHTML,t=!0});return t},SpellCheck.prototype.removePopup=function(){this._popupOpen&&(this._editBox.find("caret").remove(),window.setTimeout(function(t){$(t._editBox).off("scroll",t.removePopup),$(".spellpop").remove(),t._popupOpen=!1}(this),0))},SpellCheck.prototype.spellcheck=function(){if(this.startTime=new Date,null!=this.finishTime&&this.startTime-this.finishTime<1e3)return void this._editBox.trigger("rteSpellCheckComplete");var t=this.breakWords(this._editBox[0]),e=this._diff(t,this._seenWords);this._tempWords=e,this._updateWorkingNotice(!0),e.length?this.callServer(e):this._createSpellMarks()},SpellCheck.prototype.callServer=function(t){$.ajax({url:this._spellURL,type:"POST",data:JSON.stringify({Words:t}),crossDomain:!0,success:this._onSuccess.bind(this),error:this._onFailure.bind(this)})},SpellCheck.prototype._onSuccess=function(t){this._editBox.trigger("rteRestoreRange"),this._seenWords=this._union(this._tempWords,this._seenWords);for(var e in t)this._unique(t[e],[e,""]);$.extend(this._spellings,t),this._createSpellMarks()},SpellCheck.prototype._wrapStrings=function(){var t=[];for(var e in this._spellings)t.push(e);this.wrapStr(this._editBox[0],t)},SpellCheck.prototype._createSpellMarks=function(){var t=new Date;this.observer&&(this.observer.disconnect(),SelectionUtils.markCaretPos(this._editBox),this._editBox.html(this._editBox.html()),this._wrapStrings(),this._updateNotice(this._noticeMsgDone,!0),this._editBox.trigger("rteSpellCheckComplete"),this.finishTime=new Date,SelectionUtils.restoreCaretPos(this._editBox),this._startObserving(),window.rte&&1==window.rte.showDiagnostics&&$(document).trigger({type:"rte.wrapTime",time:new Date-t}))},SpellCheck.prototype._onFailure=function(){this._updateNotice(this._noticeMsgError,!0),this._editBox.trigger("rteSpellCheckComplete")},SpellCheck.prototype.unspellcheck=function(){for(var t=this._editBox.find(".misspelled"),e=t.length-1;e>=0;e--)t[e].outerHTML=t[e].innerHTML},SpellCheck.prototype.breakWords=function(t){var e=JetUtils.getTextNodes(t,!0),i=this._getTextContent(e),n=this._unique(i.split(this._nonWordChar));n.forEach(this._cleanSingleQuotes);var o=n.indexOf("");return-1!=o&&n.splice(o,1),n},SpellCheck.prototype._cleanSingleQuotes=function(t,e,i){for(;"'"===t.charAt(0);)t=t.substr(1);for(;"'"===t.charAt(t.length-1);)t=t.substr(0,t.length-1);i[e]=t},SpellCheck.prototype.wrapStr=function(t,e){var i,n,o,s,a,r,l,h,d;i=JetUtils.getTextNodes(this._editBox[0],!0);var c=this._getSearchIndexes(i,e),u=document.createRange();for(l=c.length-1;l>=0;l--)if(n=-1,o=-1,s=c[l].i,a=s+c[l].w.length,r=this._getNodeLengths(i),n=this._findIndex(r,c[l].i),s=c[l].i-r[n],0==$(i[n]).closest(".misspelled").length){o=n;for(var p=c[l].i+c[l].w.length;o<i.length&&p>r[o+1];)o++;for(a=c[l].i+c[l].w.length-r[o],d=i[o].splitText(a),i.splice(o+1,0,d),h=i[n].splitText(s),i.splice(n+1,0,h);0==i[n+1].nodeValue.length;)n+=1;u.setStartBefore(i[n+1]),u.setEndAfter(i[o+1]);var _=this._isWebkit?"a":"span",m=document.createElement(_);m.setAttribute("data-key",c[l].w),m.setAttribute("class","misspelled"),m.appendChild(u.extractContents()),u.insertNode(m)}this._editBox[0].normalize()},SpellCheck.prototype.fixBreakInMisspelled=function(){var t=this._findNearestMisspelled(SelectionUtils.getRange().startContainer);if(t&&$(t).find("BR").length>0){SelectionUtils.markCaretPos(this._editBox);var e=t.textContent,i=JetUtils.getTextNodes(t),n=i[i.length-1].splitText(i[i.length-1].nodeValue.length),o=i[0].splitText(0),s=document.createRange();s.setStartBefore(o),s.setEndAfter(n);var a=document.createElement("span");a.setAttribute("data-key",e),a.setAttribute("class","misspelled"),a.appendChild(s.extractContents()),s.insertNode(a),t.outerHTML=t.innerHTML,SelectionUtils.restoreCaretPos(this._editBox)}},SpellCheck.prototype.fixSpellCheckMarkup=function(t){var e,i=new Date,n=this._findAllMisspelled(t),o=n.allMisspelled,s=n.nodeList;for(e=0;e<o.length;e++)this._checkRight(s,o[e]),this._checkLeft(s,o[e]),this._checkMiddle(s,o[e]);window.rte&&1==window.rte.showDiagnostics&&$(document).trigger({type:"rte.examineTime",time:new Date-i}),this._removeBadMisspelled(t)},SpellCheck.prototype._findAllMisspelled=function(t){var e,i,n=t[0],o=[],s=0,a=null,r=[];t.find("div, br, li, p").after("<lb />"),t.find("div, li, p").before("<lb />");for(var l=document.createTreeWalker(n,NodeFilter.SHOW_ALL,null,!1);e=l.nextNode();)e.nodeType==Node.TEXT_NODE?(e.isLineBreak=!1,i=$(e).closest(".misspelled",t),i.length>0?a!=i[0]?(a=i[0],r.push({start:s,end:s,el:$(a)})):r[r.length-1].end=s:a=null,o.push(e),s++):e.nodeType==Node.ELEMENT_NODE&&"LB"==e.nodeName&&o.length>0&&(o[o.length-1].isLineBreak=!0);return t.find("lb").remove(),{allMisspelled:r,nodeList:o}},SpellCheck.prototype._checkRight=function(t,e){if(!t[e.end].isLineBreak)for(var i=!1,n=e.end+1;n<=t.length-1&&!i;n++)""!=t[n].nodeValue&&(i=!0,this._nonWordAtStart.test(t[n].nodeValue)||e.el.removeClass("misspelled").addClass("badmisspelled")),t[n].isLineBreak&&(i=!0)},SpellCheck.prototype._checkLeft=function(t,e){for(var i=!1,n=e.start-1;n>=0&&!i;n--)t[n].isLineBreak?i=!0:""!=t[n].nodeValue&&(i=!0,this._nonWordAtEnd.test(t[n].nodeValue)||e.el.removeClass("misspelled").addClass("badmisspelled"))},SpellCheck.prototype._checkMiddle=function(t,e){for(var i=-1,n=-1,o=e.start;o<=e.end;o++)t[o].isLineBreak&&-1==i&&(i=o),""!=t[o].nodeValue&&(n=o);-1!=i&&n>i&&e.el.removeClass("misspelled").addClass("badmisspelled")},SpellCheck.prototype._checkInvalid=function(t,e){var i=t.data("key"),n=null==e[i],o=i!=t[0].textContent;(n||o)&&t.removeClass("misspelled").addClass("badmisspelled")},SpellCheck.prototype.validateAllMisspelled=function(t){for(var e=t.find(".misspelled"),i=0;i<e.length;i++)this._checkInvalid($(e[i]),this._spellings);this._removeBadMisspelled(this._editBox)},SpellCheck.prototype._removeBadMisspelled=function(t){var e=t.find(".badmisspelled");if(e.length>0){SelectionUtils.markCaretPos(t);for(var i=e.length-1;i>=0;i--)e[i].outerHTML=e[i].innerHTML;SelectionUtils.restoreCaretPos(t)}},SpellCheck.prototype._insertAfter=function(t,e){var i=SelectionUtils.getSelection(),n=0!=i.rangeCount?i.getRangeAt(0):document.createRange();n.setStartAfter(t),n.setEndAfter(t),n.insertNode(e),0!=i.rangeCount&&i.removeAllRanges(),i.addRange(n)},SpellCheck.prototype._getNodeLengths=function(t){for(var e=[],i=0,n=0;n<t.length;n++)e.push(i),i+=t[n].nodeValue.length;return e},SpellCheck.prototype._getSearchIndexes=function(t,e){var i,n,o,s,a=[],r="",l=/[\s\!-&(-\/:-@\[-`\{-~Â¡Â¿\u2039\u203aÂ«Â»']/,h=[],d=0;for(o=0;o<t.length;o++)r+=t[o].nodeValue,t[o].isLineBreak&&(a.push(r),r="");for(t.length&&!t[t.length-1].isLineBreak&&a.push(r),s=0;s<e.length;s++)for(d=0,i=new RegExp(e[s],"g"),o=0;o<a.length;o++){for(;n=i.exec(a[o]);){var c=0==n.index,u=n.index+e[s].length==a[o].length;(c||l.test(a[o].charAt(n.index-1)))&&(u||l.test(a[o].charAt(n.index+e[s].length)))&&h.push({w:e[s],i:n.index+d})}d+=a[o].length}return h=this._sortList(h,0,h.length-1)},SpellCheck.prototype._sortList=function(t,e,i){var n;return t.length>1&&(n=this._partition(t,e,i),n-1>e&&this._sortList(t,e,n-1),i>n&&this._sortList(t,n,i)),t},SpellCheck.prototype._swap=function(t,e,i){var n=t[e];t[e]=t[i],t[i]=n},SpellCheck.prototype._partition=function(t,e,i){for(var n=t[Math.floor((i+e)/2)].i,o=e,s=i;s>=o;){for(;t[o].i<n;)o++;for(;t[s].i>n;)s--;s>=o&&(this._swap(t,o,s),o++,s--)}return o},SpellCheck.prototype._getTextContent=function(t){for(var e,i,n="",o=0;o<t.length;o++)i=t[o],e=i.isLineBreak?i.nodeValue+" ":i.nodeValue,n+=e;return n},SpellCheck.prototype._unique=function(t,e,i){var n,o=Object.create(null),s=0;if(e)for(var a=0,r=e.length;r>a;a++)o[e[a]]=1;for(var l=i?[]:t,a=0,r=t.length;r>a;a++)n=!o[t[a]],o[t[a]]=1,n&&(l[s++]=t[a]);return l.length=s,l},SpellCheck.prototype._diff=function(t,e){return this._unique(t,e,!0)},SpellCheck.prototype._union=function(t,e){return this._unique(t.concat(e))},SpellCheck.prototype._replaceText=function(t,e){for(var i=JetUtils.getTextNodes(t),n=this._getTextContent(i).length,o=0,s=0,a=0;a<i.length;a++)a===i.length-1&&(o=e.length-n),i[a].nodeValue=e.slice(s,s+i[a].nodeValue.length+o),s+=i[a].nodeValue.length},SpellCheck.prototype._createNotices=function(){var t=this.element.find(".rte-toolbar");t.find(".rteSpellCheckNotice").remove(),t.append("<div class='rteSpellCheckNotice rteChecking'><i class='icon-repeat'></i> "+($.i18n?$.i18n.t("extendedText:checkingSpelling"):"Checking Spelling")+"</div>"),t.append("<div class='rteSpellCheckNotice rteDone'></div>"),this._noticeWorking=this.element.find(".rteChecking"),this._notice=this.element.find(".rteDone"),this._notice.on("click touchstart",this._onDoneClick.bind(this))},SpellCheck.prototype._updateNotice=function(t,e){this._updateWorkingNotice(!1);var i=e?"block":"none";this._notice.html(t).css("display",i),e&&(this._noticeTimer=window.setTimeout(this._onNoticeTimeUp,1e3*this._noticeDuration))},SpellCheck.prototype._updateWorkingNotice=function(t){var e=t?"block":"none",i=this._noticeWorking.css("display");i!=e&&this._noticeWorking.css("display",e)},SpellCheck.prototype._onDoneClick=function(){this.clearNotice()},SpellCheck.prototype._onNoticeTimeUp=function(){this.clearNotice()},SpellCheck.prototype.clearNotice=function(){this._updateNotice("",!1)},SpellCheck.prototype._moveTrailingNonWordChar=function(t){var e,i,n,o,s,a,r=JetUtils.getTextNodes(t),l=t.nextSibling,h=this._nonWordAtEnd.test(t.textContent);if(h){for(var d=r.length-1;d>0&&0==r[d].nodeValue.length;d--);a=r[d].nodeValue,e=a.substring(a.length-1,a.length),r[d].nodeValue=a.substring(0,a.length-1),l&&l.nodeType==Node.TEXT_NODE&&l.nodeValue.length>0?this._addCharToTextNode(l,e,this.FRONT):(" "!=e||l||(e=String.fromCharCode(160)),i=$(t).closest("li"),0!=i.length&&$(t).find("br").length>0&&$(t).find("br").remove(),n=document.createTextNode(e),o=document.createRange(),o.setStartAfter(t),o.setEndAfter(t),o.insertNode(n)),o=document.createRange(),o.setStart(t.nextSibling,1),o.setEnd(t.nextSibling,1),s=SelectionUtils.getSelection(),s.removeAllRanges(),s.addRange(o)}},SpellCheck.prototype._moveLeadingNonWordChar=function(t){var e,i,n,o,s,a=JetUtils.getTextNodes(t),r=t.previousSibling,l=this._nonWordAtStart.test(t.textContent);if(l){for(var h=0;h<a.length&&0==a[h].nodeValue.length;h++);s=a[h].nodeValue,i=s.substring(0,1),a[h].nodeValue=s.substring(1,s.length),r&&r.nodeType==Node.TEXT_NODE&&r.nodeValue.length>0?this._addCharToTextNode(r,i,this.BACK):(" "!=i||r&&!JetUtils.nodeIsElement(r,"BR")||(i=String.fromCharCode(160)),e=document.createTextNode(i),n=document.createRange(),n.setStartBefore(t),n.setEndBefore(t),n.insertNode(e)),n=document.createRange(),n.setStartBefore(t),n.setEndBefore(t),o=SelectionUtils.getSelection(),o.removeAllRanges(),o.addRange(n)}},SpellCheck.prototype._hasLeadingNonWordChars=function(t){return this._nonWordAtStart.test(t)},SpellCheck.prototype._hasTrailingNonWordChars=function(t){return this._nonWordAtEnd.test(t)},SpellCheck.prototype._isBlockElement=function(t){var e=null!=t&&("BR"==t.nodeName||"P"==t.nodeName||"LI"==t.nodeName||"DIV"==t.nodeName);return e},SpellCheck.prototype._addCharToTextNode=function(t,e,i){var n=t.nodeValue,o=n.charCodeAt(i==this.FRONT?0:n.length-1);" "==e&&(32==o?e=String.fromCharCode(160):160==o&&(e=" ")),t.nodeValue=i==this.FRONT?e+t.nodeValue:t.nodeValue+e},SpellCheck.prototype.handleClick=function(t){this.removePopup();var e=this._findNearestMisspelled(t.target);e&&this._showPopup(e)},SpellCheck.prototype._findNearestMisspelled=function(t){var e=null,i=SelectionUtils.getSelection(),n=i?i.anchorOffset:-1,o=$(t).hasClass("misspelled")?$(t):$(t).closest(".misspelled");return $(t).hasClass("rte-editbox")?e=null:o.length>0?e=o[0]:0==n&&t&&t.firstChild&&$(t.firstChild).hasClass("misspelled")&&(e=t.firstChild),e},SpellCheck.prototype.destroy=function(){this.observer.disconnect(),this.observer=null,this._noticeTimer&&window.clearTimeout(this._noticeTimer)},$.widget("pearson.richText",{options:{identifier:"anonymous",showCounter:!1,maxChars:1e4},_toolBar:null,_editBox:null,_counter:null,_customCommands:{},_doSpecialInsert:!1,_lastRange:null,_lastContent:"",_shouldUpdateButtons:!0,_allowPaste:!0,_isIE:!1,_isWebkit:!1,_isAndroid:!1,_isIOS:!1,_isFirefox:!1,_isEdge:!1,_isChrome:!1,_initialHeight:0,_savedStyle:{bold:!1,italic:!1,underline:!1,insertordreedlist:!1,insertUnorderedList:!1},_savedContent:"",_emptyOnKeyDown:!0,_keyReleased:!1,_editManager:null,_spellChecker:null,_actionTimer:null,_maxChars:1e4,_showCounter:!1,_hasFocus:!1,_waitForNextKey:!1,_doingSpellCheck:!1,_killKeyEvent:!1,_keydown:!1,_nonCharacterKey:!1,_inCompositionMode:!1,_wasAnswered:!1,_charMapContainer:null,_charMap:null,_hasCharacterMap:!1,_charMapOpen:!1,_MAX_CHAR_LIMIT:1e4,_UNDO_SAVE_TIME:500,_DEFAULT_SPELL_SERVER:"https://spellcheck.testnav.com/spellcheck",_create:function(){this._cleanPreviewerHTML(this.element),this._createEditor()},_refresh:function(){},_ready:function(){$(document).trigger("rtEditorReady",this.options.identifier)},destroy:function(){this._editBox.attr("contenteditable",!1),this._editManager.destroy(),this._spellChecker&&this._spellChecker.destroy(),this._charMap&&this._charMap.destroy(),this._stopActionTimer(),$(window).off("resize",$.proxy(this._handleResize,this)),$(document).off("timerTimeout tn.ews.on",$.proxy(this._closeCharMap,this)).off("timerTimeout tn.ews.on",$.proxy(this.killAllInteraction,this)).off("overtimeStart tn.ews.off",$.proxy(this.restoreAllInteraction,this)),$.Widget.prototype.destroy.call(this),this.element.remove()},killAllInteraction:function(){this._editBox.off("click",$.proxy(this._handleClick,this)).off("touchstart",$.proxy(this._handleTouchStart,this)).off("touchend",$.proxy(this._handleTouchEnd,this)).off("keydown",$.proxy(this._handleKeyDown,this)).off("keypress",$.proxy(this._handleKeypress,this)).off("keyup",$.proxy(this._handleKeyUp,this)).off("input",$.proxy(this._handleInput,this)).off("focus",$.proxy(this._handleFocus,this)).off("focusout",$.proxy(this._handleLostFocus,this)).off("paste",$.proxy(this._handlePaste,this)).off("cut",$.proxy(this._handleCut,this)).off("rteSaveContent",this._handleSaveContent).off("rteRestoreRange",$.proxy(this._restoreLastRange,this)).off("mouseup touchend",$.proxy(this._handleMouseUp,this)).off("compositionstart",$.proxy(this._handleCompositionStart,this)).off("compositionend",$.proxy(this._handleCompositionEnd,this)),this._isIOS&&this._editBox.off("input",$.proxy(this._handleInputIOS,this)),window.getSelection().removeAllRanges(),this._editBox.on("input keyup keydown keypress touchstart touchend click focus focusout paste cut touchend",$.proxy(this._killEvent,this))},restoreAllInteraction:function(){this._editBox.off("input keyup keydown keypress touchstart touchend click focus focusout paste cut touchend",$.proxy(this._killEvent,this)),this._editBox.on("click",$.proxy(this._handleClick,this)).on("touchstart",$.proxy(this._handleTouchStart,this)).on("touchend",$.proxy(this._handleTouchEnd,this)).on("keydown",$.proxy(this._handleKeyDown,this)).on("keypress",$.proxy(this._handleKeypress,this)).on("keyup",$.proxy(this._handleKeyUp,this)).on("input",$.proxy(this._handleInput,this)).on("focus",$.proxy(this._handleFocus,this)).on("focusout",$.proxy(this._handleLostFocus,this)).on("paste",$.proxy(this._handlePaste,this)).on("cut",$.proxy(this._handleCut,this)).on("rteSaveContent",this._handleSaveContent).on("rteRestoreRange",$.proxy(this._restoreLastRange,this)).on("mouseup touchend",$.proxy(this._handleMouseUp,this)).on("compositionstart",$.proxy(this._handleCompositionStart,this)).on("compositionend",$.proxy(this._handleCompositionEnd,this)),this._isIOS&&this._editBox.on("input",$.proxy(this._handleInputIOS,this))
},_suspendTextEntry:function(){this._editBox.off("keypress",$.proxy(this._handleKeypress,this)).off("keydown",$.proxy(this._handleKeyDown,this)).off("keyup",$.proxy(this._handleKeyUp,this)).off("paste",$.proxy(this._handlePaste,this)).off("cut",$.proxy(this._handleCut,this)),this._isIOS&&this._editBox.off("input",$.proxy(this._handleInputIOS,this)),this._editBox.on("input keyup keydown keypress cut paste",$.proxy(this._killEvent,this))},_resumeTextEntry:function(){this._editBox.off("input keyup keydown keypress cut paste",$.proxy(this._killEvent,this)),this._editBox.on("keypress",$.proxy(this._handleKeypress,this)).on("keydown",$.proxy(this._handleKeyDown,this)).on("keyup",$.proxy(this._handleKeyUp,this)).on("paste",$.proxy(this._handlePaste,this)).on("cut",$.proxy(this._handleCut,this)),this._isIOS&&this._editBox.on("input",$.proxy(this._handleInputIOS,this))},_killEvent:function(t){t.preventDefault(),t.stopImmediatePropagation()},_cleanPreviewerHTML:function(t){t.removeAttr("role"),t.removeAttr("aria-multiline")},_createEditor:function(){this.options.showCounter&&this.options.showCounter===!0&&(this._showCounter=!0);var t=this.options.maxChars;this._maxChars=t&&"number"==typeof t&&t>0&&t<this._MAX_CHAR_LIMIT?Math.floor(this.options.maxChars):this._MAX_CHAR_LIMIT,this._hasSpellCheck=this.options.spellcheck===!0,window.TN8&&window.TN8.Application&&window.TN8.Application.PNPOverride&&(this._hasSpellCheck=TN8.Application.PNPOverride.isSpellCheck(this._hasSpellCheck)),this._hasCharacterMap=void 0!=this.options.charmap&&""!=this.options.charmap,this.element.removeClass("charmap-spanish");var e=this.element.attr("id"),i=navigator.userAgent.toLowerCase();this._isChrome=i.indexOf("chrome")>=0&&-1==i.indexOf("edge"),this._isIE=!document.queryCommandSupported("insertHTML"),this._isWebkit=document.queryCommandSupported("insertHTML")&&!document.queryCommandSupported("insertbronreturn")&&void 0==window.PointerEvent||this._isChrome,this._isFirefox=document.queryCommandSupported("insertbronreturn"),this._isEdge=document.queryCommandSupported("insertHTML")&&!document.queryCommandSupported("insertbronreturn")&&void 0!=window.PointerEvent&&!this._isChrome,this._isAndroid=/android/i.test(navigator.userAgent.toLowerCase()),this._isIOS=/iphone|ipad|ipod|ipad simulator/i.test(navigator.platform.toLowerCase()),this.element=$("#"+e),this.element.addClass("rich-text-editor");var n='<div class="rte-toolbar jet-tinymce jet-container jet-panel" role="toolbar" style="border-width: 1px;"><div class="jet-container-body jet-stack-layout"><div class="jet-container-body jet-flow-layout"><div class="jet-container jet-first jet-flow-layout-item jet-btn-group"><button class="jet-widget jet-btn jet-first" role="button" data-command="bold" aria-pressed="false"><i class="tn8-icon-bold"></i></button><button class="jet-widget jet-btn" data-command="italic" role="button" aria-pressed="false"><i class="tn8-icon-italic"></i></button><button class="jet-widget jet-btn jet-last" data-command="underline" role="button" aria-pressed="false"><i class="tn8-icon-underline"></i></button></div><div class="jet-container jet-flow-layout-item jet-btn-group"><button class="jet-widget jet-btn jet-first" data-command="insertunorderedlist" role="button" aria-pressed="false"><i class="tn8-icon-ul"></i></button><button class="jet-widget jet-btn jet-last" data-command="insertorderedlist" role="button" aria-pressed="false"><i class="tn8-icon-ol" ></i></button></div><div class="jet-container jet-last jet-flow-layout-item jet-btn-group"><button class="jet-widget jet-btn jet-first jet-disabled" data-command="undo" role="button" aria-disabled="true"><i class="tn8-icon-undo"></i></button><button class="jet-widget jet-btn jet-last jet-disabled" data-command="redo" role="button" aria-disabled="true"><i class="tn8-icon-redo"></i></button></div>';this._hasSpellCheck&&(n+='<div class="jet-container jet-flow-layout-item jet-btn-group"><button class="jet-widget jet-btn jet-last jet-first jet-disabled" data-command="spellcheck" role="button" aria-disabled="true"><i class="tn8-icon-spellcheck"></i></button></div>'),this._hasCharacterMap&&(n+='<div class="jet-container jet-flow-layout-item jet-btn-group"><button class="jet-widget jet-btn jet-last jet-first" data-command="charmap" role="button" ><i class="tn8-icon-charmap"></i> '+($.i18n?$.i18n.t("extendedText:symbols"):"Symbols")+"</button></div>"),n+='</div><div class="rte-counter"></div></div></div>',this.element.append(n),this._toolBar=this.element.children(".rte-toolbar"),this._counter=this.element.find(".rte-counter"),this._counter.text(this._maxChars),this._showCounter&&this._counter.css("visibility","visible");var o=this._toolBar.outerHeight(),s=this.element.height();this._initalHeight=s-o,this.element.append("<div class='rte-editbox' contenteditable='true' spellcheck='false' autocapitalize='off' autocomplete='off' autocorrect='off' role='textbox' aria-multiline='true' aria-label='Rich Text Edit Box'/>"),this._editBox=this.element.children(".rte-editbox"),this._isEdge&&this._editBox.append("<div></div>"),this._editBox.css("height",this._initalHeight),this._handleSaveContent=this._handleSaveContent.bind(this),this._doTimedActions=this._doTimedActions.bind(this),this._editBox.on("click",$.proxy(this._handleClick,this)).on("touchstart",$.proxy(this._handleTouchStart,this)).on("touchend",$.proxy(this._handleTouchEnd,this)).on("keypress",$.proxy(this._handleKeypress,this)).on("keydown",$.proxy(this._handleKeyDown,this)).on("keyup",$.proxy(this._handleKeyUp,this)).on("input",$.proxy(this._handleInput,this)).on("focus",$.proxy(this._handleFocus,this)).on("focusout",$.proxy(this._handleLostFocus,this)).on("paste",$.proxy(this._handlePaste,this)).on("cut",$.proxy(this._handleCut,this)).on("rteSaveContent",this._handleSaveContent).on("rteRestoreRange",$.proxy(this._restoreLastRange,this)).on("mouseup touchend",$.proxy(this._handleMouseUp,this)).on("compositionstart",$.proxy(this._handleCompositionStart,this)).on("compositionend",$.proxy(this._handleCompositionEnd,this)),this._isIOS&&this._editBox.on("input",$.proxy(this._handleInputIOS,this));for(var a=this._toolBar.find("button"),r=0;r<a.length;r++){var l=this._isAndroid?"click":"click touchstart";$(a[r]).on(l,$.proxy(this._buttonClick,this)).on("selectStart",!1),$(a[r]).on("keyup",$.proxy(this._buttonKeyUp,this)).on("keydown",$.proxy(this._buttonKeyDown,this)).on("selectStart",!1)}document.queryCommandSupported("AutoUrlDetect")&&document.execCommand("AutoUrlDetect",!1,!1),this._editManager=this._createEditManager(),this.element.on("EditManagerChange",$.proxy(this._onEditManagerChange,this)),this._hasCharacterMap&&(this.element.append('<div class="charmap-container"></div>'),this._charMapContainer=this.element.find(".charmap-container"),this._charMap=new CharacterMap(this._charMapContainer,this._isIOS||this._isAndroid),this._charMap.setCharacterSet(this.options.charmap),this._charMap.setSelectionCallback(this,this._addSymbolFromCharMap),$(document).on("timerTimeout tn.ews.on",$.proxy(this._closeCharMap,this))),this._createToolTips(window.navigator.platform),this._showCounter&&($(window).on("resize",$.proxy(this._handleResize,this)),this._handleResize()),this.setSpellCheckServer(this._DEFAULT_SPELL_SERVER),this._setupATEnabled(),this._ready()},_setupATEnabled:function(){this.element.hasClass("at-enable")&&(this.element.attr({tabindex:0,"aria-label":"Rich text editor"}),this._toolBar.attr({tabindex:0,"aria-label":"Rich text editor toolbar"}),this._counter.attr({tabindex:0}),this._updateCounter())},_addSymbolFromCharMap:function(t){if(this._charMapOpen=!1,this._editBox.focus(),this._restoreLastRange(),""!=t){var e=SelectionUtils.getRange(),i=e?e.toString().length:0;if(!(this._getLength()-i>=this._maxChars)){var n=SelectionUtils.getSelection();if(0!=n.rangeCount){var e=n.getRangeAt(0);e.deleteContents(),e=n.getRangeAt(0);var o=document.createTextNode(t),s=n.anchorNode;if(JetUtils.nodeIsElement(s,"UL")||JetUtils.nodeIsElement(s,"OL")){if(0==s.childNodes.length)for(var a=0;2>a;a++){var r=document.createElement("LI");s.appendChild(r)}e.setStart(s.firstChild,0),e.setEnd(s.firstChild,0),e.insertNode(o)}else e.insertNode(o);n.removeAllRanges(),e.setStartBefore(o),e.setEndAfter(o),n.addRange(e),this._reapplyStyles(),n.removeAllRanges(),e.setStartAfter(o),e.setEndAfter(o),n.addRange(e),this._lastRange=e}var l;this._isIE?(l=document.createEvent("CustomEvent"),l.initEvent("AddFromCharMap",!1,!0),l.keyCode=t):(this._editBox.trigger("input"),l=new CustomEvent("AddFromChapMap",{bubbles:!1,keyCode:t})),this._handleKeyUp(l),this._savedContent=this._editBox.html(),this._checkForAnsweredChange(),this._startActionTimer()}}},_openCharMap:function(){this._checkForAnsweredChange(),this._charMapOpen=!0,this._saveUndoState(),this._savedContent=this._editBox.html(),this._charMap.show()},_closeCharMap:function(){this._charMap.hide(!0)},_handleSaveContent:function(){this._savedContent=this._editBox.html()},_createEditManager:function(){return new EditManager(this)},_doTimedActions:function(){this._actionTimer=null,this._hasSpellCheck&&this._spellChecker.fixSpellCheckMarkup(this._editBox),this._saveUndoState()},_saveUndoState:function(){var t=!1;this._cleanHtml();var e=this._makeRawText(this._getRichText(this._lastContent));if(0===e.length){var i=this._makeRawText(this._getRichText(this._editBox.html()));t=0===i.length}var n=this._editBox.html();this._removeCarets(n)==this._removeCarets(this._lastContent)||t||(this._lastContent=n,this._editManager.save(this._editBox))},_removeCarets:function(t){return t.replace(/<caret><\/caret>/g,"")},_onEditManagerChange:function(){this._setButtonEnabled("undo",this._editManager.canUndo()),this._setButtonEnabled("redo",this._editManager.canRedo())},_startActionTimer:function(){this._inCompositionMode||(this._stopActionTimer(),this._actionTimer=setTimeout(this._doTimedActions,this._UNDO_SAVE_TIME))},_stopActionTimer:function(){this._actionTimer&&(clearTimeout(this._actionTimer),this._actionTimer=null)},_handleResize:function(){var t=this.element.innerWidth(),e=this._counter.outerWidth(),i=t-e-10,n=this._toolBar.children(".jet-stack-layout");n.css("width",i);var o=this._editBox.outerHeight(),s=this._toolBar.outerHeight(),a=this.element.height();a>o+s&&(this._initialHeight=a-s,this._editBox.css("height",this._initialHeight))},_updateCounter:function(){if(this._showCounter){var t=this._maxChars-this._getLength();t=0>t?0:t,this._counter.text(t)}this.element.hasClass("at-enable")&&this._counter.attr("aria-label",t+" characters available of "+this._maxChars)},_formatDoc:function(t,e){t=t.toLowerCase(),this._editBox[0].normalize(),document.execCommand(t,!1,e)},_checkForSpecialInsertIE:function(t){this._checkResetSpecialInsert();var e;if(this._doSpecialInsert&&!this._isNonCharacterKey(t)){t.preventDefault(),this._doSpecialInsert=!1;var i=this._savedStyle,n=document.getSelection(),o=n.getRangeAt(0),s=document.createTextNode(String.fromCharCode(t.charCode));o.insertNode(s),o.setStartBefore(s),o.setEndAfter(s),n.removeAllRanges(),n.addRange(o),document.execCommand("removeFormat"),o.setStartBefore(s),o.setEndAfter(s),n.removeAllRanges(),n.addRange(o),i.bold&&(e=this._isIE?"strong":"b",o.surroundContents(document.createElement(e))),i.italic&&(e=this._isIE?"em":"i",o.surroundContents(document.createElement(e))),i.underline&&o.surroundContents(document.createElement("u")),n.removeAllRanges(),o.setStartAfter(s),o.setEndAfter(s),n.addRange(o)}},_checkResetSpecialInsert:function(){var t,e;t=SelectionUtils.getSelection(),t&&t.rangeCount>0&&(e=t.getRangeAt(0),0!=e.toString().length&&(this._doSpecialInsert=!1))},_isNonCharacterKey:function(t){var e=t.keyCode,i=t.ctrlKey||t.metaKey||t.altKey||17===t.keyCode||224===t.keyCode,n=8===e||9===e||13===e||e>=33&&40>=e||46===e||229===e||e>=63232&&63250>=e||e>=63272&&63277>=e||63289==e;return i||n},_buttonClick:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-command");this._handleButtonClick(e)},_buttonKeyDown:function(t){if(32!==t.keyCode&&13!==t.keyCode||t.preventDefault(),13==t.keyCode){var e=$(t.currentTarget).attr("data-command");this._handleButtonClick(e)}},_buttonKeyUp:function(t){if(32!==t.keyCode&&13!==t.keyCode||t.preventDefault(),32===t.keyCode){var e=$(t.currentTarget).attr("data-command");this._handleButtonClick(e)}},_handleButtonClick:function(t){this._hasSpellCheck&&this._spellChecker.removePopup(),"undo"===t||"redo"===t?this._doEditCommand(t):"spellcheck"===t?this._doSpellCheck():"charmap"===t?this._openCharMap():(this._doSpecialInsert=!0,this._doFormatCommand(t)),this._cleanHtml(),this._updateCounter()},_doSpellCheck:function(){$(document).trigger("rte.spellCheckStart"),this._hasFocus||this._restoreLastRange();var t=this._findButton("spellcheck");t.hasClass("jet-disabled")||(this._stopActionTimer(),this._suspendTextEntry(),this._saveUndoState(),this._lastRange=SelectionUtils.getRange(),this._doingSpellCheck=!0,this._setButtonEnabled("spellcheck",!1),this._spellChecker.spellcheck(),$(document).trigger("Used.Spellcheck"))},_handleSpellCheckComplete:function(){this._resumeTextEntry(),this._updateEditorState(),this._doingSpellCheck=!1,this._saveUndoState(),this._checkForAnsweredChange(),$(document).trigger("rte.spellCheckComplete")},_handlSpellCheckWordChange:function(){this._handleKeyUp(null),this._savedContent=this._editBox.html();var t=this._editBox.scrollTop();this._updateEditorState(),this._editBox.scrollTop(t),this._saveUndoState()},_doFormatCommand:function(t){this._saveUndoState(),this._editBox.focus(),this._checkResetSpecialInsert(),this._toggleButton(t),this._savedStyle=this._getButtonStyles(),this._doListCommandPreprocessing(t),this._formatDoc(t,null),this._shouldUpdateButtons=!1},_doListCommandPreprocessing:function(t){this._isListCommand(t)&&(this._updateListButtons(t),this._nonCharacterKey=!0)},_isListCommand:function(t){return"insertunorderedlist"==t||"insertorderedlist"==t},_updateListButtons:function(t){var e=this._findButton(t),i=e.hasClass("jet-active");this._updateButton("insertorderedlist",!1),this._updateButton("insertunorderedlist",!1),this._updateButton(t,i)},_doEditCommand:function(t){var e;if(this._stopActionTimer(),"undo"==t&&this._editManager.canUndo())this._makeRawText(this._lastContent)!=this._makeRawText(this._editBox.html())&&this._doTimedActions(),e=this._editManager.undo(),this._updateEditorState(e),this._shouldUpdateButtons=!0,this._lastContent=this._editBox.html();else{if("redo"!=t||!this._editManager.canRedo())return void this._editBox.focus();e=this._editManager.redo(),this._updateEditorState(e),this._shouldUpdateButtons=!0,this._lastContent=this._editBox.html()}this._handleEditBoxCleared(),this._updateFormatButtonState(),this._checkForAnsweredChange(),this._doSpecialInsert&&(this._savedStyle=this._getButtonStyles())},_updateEditorState:function(t){t&&this._editBox.html(t.text),this._charMapOpen||(this._editBox.focus(),SelectionUtils.restoreCaretPos(this._editBox))},_createToolTips:function(t){var e=0===t.toLowerCase().indexOf("win"),i=0===t.toLowerCase().indexOf("mac"),n="",o={bold:$.i18n?$.i18n.t("extendedText:bold"):"Bold",italic:$.i18n?$.i18n.t("extendedText:italic"):"Italic",underline:$.i18n?$.i18n.t("extendedText:underline"):"Underline",numberedlist:$.i18n?$.i18n.t("extendedText:numberedList"):"Numbered List",bulletedlist:$.i18n?$.i18n.t("extendedText:bulletList"):"Bullet List",undo:$.i18n?$.i18n.t("extendedText:undo"):"Undo",redo:$.i18n?$.i18n.t("extendedText:redo"):"Redo",spellcheck:$.i18n?$.i18n.t("extendedText:spellCheck"):"Spell Check"};return(e||i)&&(n=e?": Ctrl+":": Cmd+",o.bold=o.bold+n+"B",o.italic=o.italic+n+"I",o.underline=o.underline+n+"U",o.undo=o.undo+n+"Z",o.redo=e?o.redo+n+"Y":o.redo+n+"Shift+Z"),this._findButton("bold").attr("aria-label",o.bold).tooltip({title:o.bold,delay:0,animation:!1}),this._findButton("italic").attr("aria-label",o.italic).tooltip({title:o.italic,delay:0,animation:!1}),this._findButton("underline").attr("aria-label",o.underline).tooltip({title:o.underline,delay:0,animation:!1}),this._findButton("insertorderedlist").attr("aria-label",o.numberedlist).tooltip({title:o.numberedlist,delay:0,animation:!1}),this._findButton("insertunorderedlist").attr("aria-label",o.bulletedlist).tooltip({title:o.bulletedlist,delay:0,animation:!1}),this._findButton("undo").attr("aria-label",o.undo).tooltip({title:o.undo,delay:0,animation:!1}),this._findButton("redo").attr("aria-label",o.redo).tooltip({title:o.redo,delay:0,animation:!1}),this._hasSpellCheck&&this._findButton("spellcheck").attr("aria-label",o.spellcheck).tooltip({title:o.spellcheck,delay:0,animation:!1}),this._hasCharacterMap&&this._findButton("charmap").attr("aria-label",this._charMap.getLabel()).tooltip({title:this._charMap.getLabel(),delay:0,animation:!1}),o},_handleClick:function(t){var e=this;window.setTimeout(function(){e._shouldUpdateButtons=!0,e._updateFormatButtonState()},0),this._cleanHtml(),this._hasSpellCheck&&this._spellChecker.handleClick(t)},_handleFocus:function(t){return this._hasFocus||this._charMapOpen?void t.preventDefault():(this._hasFocus=!0,void this._restoreCaret())},_restoreCaret:function(){this._webkitRestoreRange(),this._doWebkitReformat()},_webkitRestoreRange:function(){this._isWebkit&&!this._isIOS&&this._restoreLastRange()},_doWebkitReformat:function(){this._isWebkit&&SelectionUtils.getSelection().isCollapsed&&this._reapplyStyles()},_handleLostFocus:function(){this._hasFocus=!1,this._checkForAnsweredChange(),this._stopActionTimer();var t=SelectionUtils.getRange();null!=t&&(this._lastRange=t),window.getSelection().removeAllRanges()},_handleTouchStart:function(t){this._hasSpellCheck&&this._spellChecker.removePopup();var e=$(t.originalEvent.target);e.hasClass("misspelled")&&(t.preventDefault(),this._spellChecker.handleClick(t,this._isIE))},_handleTouchEnd:function(){window.setTimeout(function(t){return function(){t._updateFormatButtonState()}}(this),100)},_handleMouseUp:function(){this._lastRange=SelectionUtils.getRange()},_handleInputIOS:function(t){this._handleKeyUp(t),(this._getLength()>this._maxChars||!this._isValidHtml(this._editBox.html()))&&(this._editBox.html(this._savedContent),this._restoreLastRange()),this._savedContent=this._editBox.html(),this._lastRange=SelectionUtils.getRange()},_handleInput:function(){this._hasSpellCheck&&this._spellChecker.removePopup(),this._updateCounter()},_handleKeyDown:function(t){this._shouldUpdateButtons=!(t.ctrlKey||t.metaKey||17===t.keyCode||224===t.keyCode),this._keydown=!0,this._nonCharacterKey=this._isNonCharacterKey(t),this._getLength()<=this._maxChars&&this._shouldUpdateButtons&&(this._savedContent=this._editBox.html());var e=187==t.keyCode&&1==t.metaKey;return this._shouldBlockText(t.keyCode,!this._shouldUpdateButtons)||e?void(this._isAndroid||(t.preventDefault(),this._killKeyEvent=!0)):(this._keyReleased&&(this._emptyOnKeyDown=0===this._editBox.text().length),this._keyReleased=!1,this._lastRange=SelectionUtils.getRange(),this._handleFormatKeys(t),this._handleUndoRedoKeys(t),void(this._hasSpellCheck&&(this._spellChecker.clearNotice(),this._spellChecker.removePopup())))},_handleKeyUp:function(t){if(this._keydown=!1,this._keyReleased=!0,this._killKeyEvent||t&&187==t.keyCode&&1==t.metaKey)return this._killKeyEvent=!1,void(t&&t.preventDefault());var e=this._getLength();return e>this._maxChars?(this._editBox.html(this._savedContent),this._updateCounter(),void(t&&t.preventDefault())):(this._cleanHtml(),!this._isIOS&&t&&13!==t.keyCode&&this._updateFormatButtonState(),t&&"input"!==t.type&&!this._emptyOnKeyDown&&this._handleEditBoxCleared(),this._checkForAnsweredChange(),t&&!(t.metaKey||91==t.keyCode||224==t.keyCode||t.ctrlKey||17==t.keyCode||9==t.keyCode||t.keyCode>=33&&t.keyCode<=40||16==t.keyCode||18==t.keyCode||93==t.keyCode||this._waitForNextKey)&&this._startActionTimer(),this._waitForNextKey=t&&(17==t.keyCode||224==t.keyCode||91==t.keyCode),this._waitForNextKey&&window.setTimeout(function(t){return function(){t._waitForNextKey=!1}}(this),100),this._updateCounter(),this._fixInsignificantSpace(t),t&&13==t.which&&(this._isIE&&(document.execCommand("removeFormat"),this._doSpecialInsert=!0),this._hasSpellCheck&&(this._spellChecker.validateAllMisspelled(this._editBox),this._spellChecker.fixBreakInMisspelled())),void(this._lastRange=SelectionUtils.getRange()))},_handleCompositionStart:function(){this._inCompositionMode=!0,this._stopActionTimer()},_handleCompositionEnd:function(){this._inCompositionMode=!1,this._startActionTimer()},_fixInsignificantSpace:function(t){if(t&&32==t.which){var e=SelectionUtils.getSelection(),i=e.getRangeAt(0).cloneRange(),n=i.startContainer,o=i.startOffset;if(o>=1){i.setStart(n,o-1),i.setEnd(n,o),e.removeAllRanges(),e.addRange(i);var s=i.getClientRects();if(0==s.length||0==s[0].width){i.deleteContents();var a=document.createTextNode(String.fromCharCode(160));i.insertNode(a),i.setStartAfter(a),i.setEndAfter(a)}else i.setStart(n,o),i.setEnd(n,o);e.removeAllRanges(),e.addRange(i)}}},_handleKeypress:function(t){(this._isIE||this._isFirefox||this._isIOS)&&!this._isNonCharacterKey(t)&&this._checkForSpecialInsertIE(t),this._isIOS&&t&&13!==t.keyCode&&this._updateFormatButtonState(),0==this._keydown&&window.setTimeout(function(e){return function(){e._handleKeyUp(t)}}(this),0),this._isIE&&window.setTimeout(function(t){return function(){t._updateCounter()}}(this),0)},_handlePaste:function(t){return this._doSpecialInsert=!1,this._allowPaste?(this._allowPaste=!1,this._stopActionTimer(),this._lastRange=SelectionUtils.markCaretPos(this._editBox),this._savedContent=this._editBox.html(),SelectionUtils.restoreCaretPos(this._editBox),this._editBox[0].normalize(),void window.setTimeout(function(t){return function(){t._doPostPasteValidation()}}(this),0)):void t.preventDefault()},_doPostPasteValidation:function(){this._cleanHtml(),this._isFirefox&&this._editBox.find("p").each(function(t,e){var i=document.createElement("br");e.appendChild(i),e.outerHTML=e.innerHTML}),this._hasSpellCheck&&(this._spellChecker.fixSpellCheckMarkup(this._editBox),this._spellChecker.validateAllMisspelled(this._editBox)),(!this._isValidHtml(this._editBox.html())||this._getLength()>this._maxChars)&&this._editBox.html(this._savedContent),this._editBox.find(".misspelled, span").attr("style",""),this._checkForAnsweredChange(),this._doTimedActions(),SelectionUtils.restoreCaretPos(this._editBox),this._shouldUpdateButtons=!0,this._updateFormatButtonState(),this._updateCounter(),this._validateSpellMarks(),this._savedContent=this._editBox.html(),this._lastContent=this._editBox.html(),this._allowPaste=!0},_handleCut:function(){window.setTimeout(function(t){return function(){t._checkForAnsweredChange(),t._updateFormatButtonState(t._getSelectionStyles()),t._shouldUpdateButtons=!0,t._handleEditBoxCleared(),t._doTimedActions(),t._updateCounter()}}(this),0)},_getLength:function(){var t=this._makeRawText(this._getRichText(this._editBox.html())),e=""===t?0:t.length-1;if(this._isWebkit){var i=this._editBox[0].firstChild,n=this._editBox.find("div, ul, ol").length;n>0&&!JetUtils.nodeIsBlockElement(i)&&e++,this._editBox.find("div div").parent().closest("div").attr("data-ignore",!0),this._editBox.find("div ol").parent().closest("div").attr("data-ignore",!0),this._editBox.find("div ul").parent().closest("div").attr("data-ignore",!0);for(var o=this._editBox.find("[data-ignore='true']").length,s=this._editBox.find("[data-ignore='true']"),a=0;a<s.length;a++){var i=s[a].firstChild;null==i||JetUtils.nodeIsBlockElement(i)||e++}e-=o}return e},_isValidHtml:function(t){var e,i=$("<div>"+t+"</div>");e=this._isIE?"strong, em, u, p, br, ul, ol, li, caret":"div, span, b, i, u, br, ul, ol, li, caret",e+=", .misspelled, .badmisspelled";var n=i.find(":not("+e+")");return 0==n.length},_shouldBlockText:function(t,e){var i=8===t||9===t||t>=33&&40>=t||46===t,n=SelectionUtils.getRange(),o=n?n.toString().length:0,s=this._getLength()-o<this._maxChars;return!s&&!e&&!i},_handleEditBoxCleared:function(){var t={bold:!1,italic:!1,underline:!1},e={bold:!1,italic:!1,underline:!1,insertordreedlist:!1,insertUnorderedList:!1};if(this._isWebkit&&this._editBox.find("div").each(function(){""==this.innerHTML&&this.parentElement.removeChild(this)}),0===this._editBox.text().length){if(this._editBox.find("ul, ol").remove(),$.each(t,function(t){document.queryCommandState(t)&&document.execCommand(t)}),this._isWebkit){this._editBox.html("");var i=SelectionUtils.getSelection(),n=document.createRange();n.setStart(this._editBox[0],0),i.removeAllRanges(),i.addRange(n)}this._savedStyle=e,this._doSpecialInsert=!0,this._updateFormatButtonState(e),this._saveUndoState()}},_handleFormatKeys:function(t){this._lastRange=SelectionUtils.getRange(),(t.metaKey||t.ctrlKey)&&(66===t.keyCode?(t.preventDefault(),this._doFormatCommand("bold")):73===t.keyCode?(t.preventDefault(),this._doFormatCommand("italic")):85===t.keyCode&&(t.preventDefault(),this._doFormatCommand("underline")))},_handleUndoRedoKeys:function(t){var e=t.keyCode,i=t.ctrlKey,n=t.metaKey,o=t.shiftKey,s=90===e&&i||90===e&&n&&!o,a=89===e&&i||90===e&&n&&o;(s||a)&&(t.preventDefault(),s?this._doEditCommand("undo"):a&&this._doEditCommand("redo"))},_checkForAnsweredChange:function(){var t=this.answered();t!=this._wasAnswered&&(this._sendAnsweredToTestNav(t),this._wasAnswered=t),this._hasSpellCheck&&!this._doingSpellCheck&&this._setButtonEnabled("spellcheck",t)},_sendAnsweredToTestNav:function(){$(document).trigger("ItemResponseChanged")},_restoreLastRange:function(){if(this._lastRange){var t=this._lastRange;this._setRange(t),this._lastRange=null}},_setRange:function(t){var e=SelectionUtils.getSelection();0!=e.rangeCount&&e.removeAllRanges(),e.addRange(t),this._lastRange=t},_updateFormatButtonState:function(t){if(this._shouldUpdateButtons){var e=this;t||(t=this._getSelectionStyles()),$.each(t,function(t,i){e._updateButton(t,i)})}},_findButton:function(t){return this._toolBar.find("[data-command='"+t+"']")},_updateButton:function(t,e){var i=this._findButton(t);i.attr("aria-pressed",e),e?i.addClass("jet-active"):i.removeClass("jet-active")},_toggleButton:function(t){var e=this._findButton(t),i=e.hasClass("jet-active");this._updateButton(t,!i)},_setButtonEnabled:function(t,e){var i=this._findButton(t);i.attr("aria-disabled",!e),e?i.removeClass("jet-disabled"):i.addClass("jet-disabled")},_isSelectionInEditor:function(t){var e=t.anchorNode;if(!e)return!1;var i=3===e.nodeType?$(e).parent():$(e);return i.closest(".rte-editbox").length>0||i.hasClass(".rte-editbox")},_getSelectionStyles:function(){var t,e,i,n,o,s=!1,a=[],r={bold:!1,italic:!1,underline:!1,insertorderedlist:!1,insertunorderedlist:!1};if(t=SelectionUtils.getSelection(),!t||!this._isSelectionInEditor(t))return r;for(e=t.anchorNode,i=3===e.nodeType?$(e).parent():$(e),r.bold="bold"===i.css("font-weight")||700==i.css("font-weight"),r.italic="italic"===i.css("font-style"),r.underline="underline"===i.css("text-decoration");e&&!s;)n=e.nodeName,"DIV"==n?s=!0:"#text"!=n&&a.push(n),e=e.parentNode;for(var l=0;l<a.length;l++)o=a[l],"B"==o||"STRONG"==o?r.bold=!0:"I"==o||"EM"==o?r.italic=!0:"U"==o?r.underline=!0:"UL"==o?r.insertunorderedlist=!0:"OL"==o&&(r.insertorderedlist=!0);return r},_getButtonStyles:function(){var t={bold:!1,italic:!1,underline:!1,insertorderedlist:!1,insertunorderedlist:!1},e=this;return $.each(t,function(i){var n=e._toolBar.find("[data-command='"+i+"']");t[i]=n.hasClass("jet-active")}),t},_reapplyStyles:function(){var t=this._getButtonStyles(),e=this._getSelectionStyles(),i=t.bold!=e.bold,n=t.italic!=e.italic,o=t.underline!=e.underline;i&&document.execCommand("bold"),n&&document.execCommand("italic"),o&&document.execCommand("underline")},_cleanHtml:function(){-1!=this._editBox.html().indexOf("\n")&&(this._lastRange=SelectionUtils.markCaretPos(this._editBox),this._editBox.html(this._editBox.html().replace(/\n/g,"")),SelectionUtils.restoreCaretPos(this._editBox)),this._editBox.find("li ul, li ol").each(function(t,e){var i=$(e).parent().closest("li");i.after(e.innerHTML),e.outerHTML=""}),this._cleanTag("font")},_cleanTag:function(t){var e=this._editBox.find(t);if(e.length>0){this._lastRange=SelectionUtils.markCaretPos(this._editBox);for(var i=e.length-1;i>=0;i--)e[i].outerHTML=e[i].innerHTML;SelectionUtils.restoreCaretPos(this._editBox)}},answered:function(){var t=this._getRichText(this._editBox.html()),e=this._makeRawText(t);return e.length>0},getResponse:function(){this._getLength()>this._maxChars&&this._editBox.html(this._savedContent),this._cleanHtml();var t={},e=this._getRichText(this._editBox.html());return t.rawText=this._makeRawText(e),t.richText=0==t.rawText.length?"":e,t},_getRichText:function(t){var e=t;return this._isIE&&(e=this._makeIESaveHtml(e)),e=this._sanitizeHtml(e)},_sanitizeHtml:function(t){var e=$("<div>"+t+"</div>");return e.find(".misspelled").each(function(t,e){e.outerHTML=e.innerHTML}),e.find("u,i,a,b,span").each(function(t,e){0==e.innerHTML.length?$(e).remove():0==e.textContent.length&&(e.outerHTML=e.innerHTML)}),e.html()},_makeIESaveHtml:function(t){return t=t.replace(/<p><br><\/p>/g,"<p></p>"),t=t.replace(/<\/p>/g,"<br>"),t=t.replace(/<p>/g,""),t=t.replace(/<li><\/li>/g,"<li><br></li>")},_makeIERestoreHtml:function(t){t=t.replace(/<li><br><\/li>/g,"<li></li>"),t=t.replace(/<br>/g,"</p>");var e,i,n,o,s=["</p>","</ol>","</ul>"];for(n=0;n<s.length;n++)for(i=s[n],e=t.indexOf(s[n]);-1!=e;)o=e+i.length,this._startTagAtPos(t,o)||o==t.length||(t=t.substring(0,o)+"<p>"+t.substring(o,t.length)),e=t.indexOf(i,e+i.length);var a=0==t.indexOf("<p>")||0==t.indexOf("<ul>")||0==t.indexOf("<ol>"),r=-1!=t.indexOf("</p>");return t.length>0&&!a&&r&&(t="<p>"+t),t=t.replace(/<p><\/p>/g,"<p><br></p>")},_startTagAtPos:function(t,e){var i,n,o,s=["<p>","<ul>","<ol>"],a=!1;for(i=0;i<s.length&&!a;i++)n=s[i],o=t.indexOf(n,e),o==e&&(a=!0);return a},_makeRawText:function(t){var e=t.replace(/<\/?(b|i|u|strong|em)>/g,"");e=e.replace(/(<br><\/li>)/g,"</li>"),e=e.replace(/(<br><\/div>)/g,"</div>"),e=e.replace(/(<br><\/p>)/g,"</p>"),e=e.replace(/(<br><div>)|(<br><ul>)|(<br><ol>)/g,""),e=e.replace(/(<\/div>)|(<br[^>]*>)|(<\/li>)|(<\/p>)/g,"\n"),e=e.replace(/<[^>]*>/g,""),e=e.replace(/\uFEFF/g,"");for(var i=[/\&amp;/g,/\&quot;/g,/\&lt;/g,/\&gt;/g,/\&nbsp;/g],n=["&",'"',"<",">"," "],o=0;o<i.length;o++)e=e.replace(i[o],n[o]);return e=e.replace(/\r/g,""),"\n"!=e.charAt(e.length-1)&&(e+="\n"),"\n"===e&&(e=""),e},setResponse:function(t){var e=null==t?"":t.hasOwnProperty("richText")?t.richText:"";this._isIE&&(e=this._makeIERestoreHtml(e)),this._editBox.html(e),this._updateCounter(),this._emptyOnKeyDown=""==e,this._lastContent=e,this._editManager.clear(),this._editManager.save(this._editBox),this._savedContent=this._editBox.html(),this._checkForAnsweredChange()},setSpellCheckServer:function(t){if(this._hasSpellCheck&&t&&""!=t){this._spellChecker&&this._spellChecker.destroy();var e={isIE:this._isIE,isEdge:this._isEdge,isWebkit:this._isWebkit};this._spellChecker=new SpellCheck(t,this.element,this._editBox,e),this._spellChecker.init(),this._editBox.off("rteSpellCheckComplete",$.proxy(this._handleSpellCheckComplete,this)).on("rteSpellCheckComplete",$.proxy(this._handleSpellCheckComplete,this)),this._editBox.off("rteSpellCheckWordChange",$.proxy(this._handlSpellCheckWordChange,this)).on("rteSpellCheckWordChange",$.proxy(this._handlSpellCheckWordChange,this))}},_validateSpellMarks:function(){this._hasSpellCheck||(this._lastRange=SelectionUtils.markCaretPos(this._editBox),this._editBox.find(".misspelled").each(function(t,e){e.outerHTML=e.innerHTML}),SelectionUtils.restoreCaretPos(this._editBox))}}),function(t){"use strict";t.module("JetRichtextEditor",["ngSanitize"]).directive("jetRichtextEditor",["$sce","$log",function(e,i){var n=0;return{require:"ngModel",link:function(o,s,a,r){function l(){var t=h.richText("getResponse").richText;r.$setViewValue(t)}var h,d,c,u,p;t.isUndefined(a.id)&&a.$set("id","jetRichtext-"+n++),h=s.richText({showCounter:o.$eval(a.showCounter),maxChars:o.$eval(a.maxChars)}),r.$isEmpty=function(){return o.$eval(a.considerTrailingSpacesForEmptyCheck)?!h.richText("answered"):0===h.richText("getResponse").rawText.trim().length
},r.$formatters.push(function(t){try{var n,o;return n=e.getTrustedHtml(t||""),h.richText("setResponse",{richText:n}),o=h.richText("getResponse").richText}catch(s){return void i.log("Untrusted response")}}),d=s.find(".rte-editbox"),c=s.find(".jet-btn"),u=p=function(){o.$evalAsync(l)},d.on("blur keyup change input",u),c.on("click keypress touchend",p),o.$eval(a.focusEditor)&&d.focus(),o.$on("$destroy",function(){d.off("blur keyup change input",u),c.off("click keypress touchend",p)})}}}])}(angular);